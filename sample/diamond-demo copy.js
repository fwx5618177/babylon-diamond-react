(() => {



















  var Ha = (function () {
    function e(t, i, n) {
      (this.name = t),
        (this.lensFlares = new Array()),
        (this.borderLimit = 300),
        (this.viewportBorder = 0),
        (this.layerMask = 268435455),
        (this._vertexBuffers = {}),
        (this._isEnabled = !0),
        (this._scene = n || j.LastCreatedScene),
        e._SceneComponentInitialization(this._scene),
        (this._emitter = i),
        (this.id = t),
        n.lensFlareSystems.push(this),
        (this.meshesSelectionPredicate = function (e) {
          return (
            n.activeCamera &&
            e.material &&
            e.isVisible &&
            e.isEnabled() &&
            e.isBlocker &&
            0 != (e.layerMask & n.activeCamera.layerMask)
          );
        });
      var r = n.getEngine(),
        o = [];
      o.push(1, 1),
        o.push(-1, 1),
        o.push(-1, -1),
        o.push(1, -1),
        (this._vertexBuffers[wt.PositionKind] = new wt(
          r,
          o,
          wt.PositionKind,
          !1,
          !1,
          2
        ));
      var s = [];
      s.push(0),
        s.push(1),
        s.push(2),
        s.push(0),
        s.push(2),
        s.push(3),
        (this._indexBuffer = r.createIndexBuffer(s)),
        (this._effect = r.createEffect(
          "lensFlare",
          [wt.PositionKind],
          ["color", "viewportMatrix"],
          ["textureSampler"],
          ""
        ));
    }
    return (
      Object.defineProperty(e.prototype, "isEnabled", {
        get: function () {
          return this._isEnabled;
        },
        set: function (e) {
          this._isEnabled = e;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (e.prototype.getScene = function () {
        return this._scene;
      }),
      (e.prototype.getEmitter = function () {
        return this._emitter;
      }),
      (e.prototype.setEmitter = function (e) {
        this._emitter = e;
      }),
      (e.prototype.getEmitterPosition = function () {
        return this._emitter.getAbsolutePosition
          ? this._emitter.getAbsolutePosition()
          : this._emitter.position;
      }),
      (e.prototype.computeEffectivePosition = function (e) {
        var t = this.getEmitterPosition();
        return (
          (t = f.Project(t, g.Identity(), this._scene.getTransformMatrix(), e)),
          (this._positionX = t.x),
          (this._positionY = t.y),
          (t = f.TransformCoordinates(
            this.getEmitterPosition(),
            this._scene.getViewMatrix()
          )),
          this.viewportBorder > 0 &&
            ((e.x -= this.viewportBorder),
            (e.y -= this.viewportBorder),
            (e.width += 2 * this.viewportBorder),
            (e.height += 2 * this.viewportBorder),
            (t.x += this.viewportBorder),
            (t.y += this.viewportBorder),
            (this._positionX += this.viewportBorder),
            (this._positionY += this.viewportBorder)),
          t.z > 0 &&
            (this._positionX > e.x &&
              this._positionX < e.x + e.width &&
              this._positionY > e.y &&
              (this._positionY, e.y, e.height),
            !0)
        );
      }),
      (e.prototype._isVisible = function () {
        if (!this._isEnabled || !this._scene.activeCamera) return !1;
        var e = this.getEmitterPosition().subtract(
            this._scene.activeCamera.globalPosition
          ),
          t = e.length();
        e.normalize();
        var i = new cn(this._scene.activeCamera.globalPosition, e),
          n = this._scene.pickWithRay(i, this.meshesSelectionPredicate, !0);
        return !n || !n.hit || n.distance > t;
      }),
      (e.prototype.render = function () {
        if (!this._effect.isReady() || !this._scene.activeCamera) return !1;
        var e,
          t,
          i = this._scene.getEngine(),
          n = this._scene.activeCamera.viewport.toGlobal(
            i.getRenderWidth(!0),
            i.getRenderHeight(!0)
          );
        if (!this.computeEffectivePosition(n)) return !1;
        if (!this._isVisible()) return !1;
        var r =
          (e =
            this._positionX < this.borderLimit + n.x
              ? this.borderLimit + n.x - this._positionX
              : this._positionX > n.x + n.width - this.borderLimit
                ? this._positionX - n.x - n.width + this.borderLimit
                : 0) >
          (t =
            this._positionY < this.borderLimit + n.y
              ? this.borderLimit + n.y - this._positionY
              : this._positionY > n.y + n.height - this.borderLimit
                ? this._positionY - n.y - n.height + this.borderLimit
                : 0)
            ? e
            : t;
        (r -= this.viewportBorder) > this.borderLimit && (r = this.borderLimit);
        var o = 1 - s.Clamp(r / this.borderLimit, 0, 1);
        if (o < 0) return !1;
        o > 1 && (o = 1),
          this.viewportBorder > 0 &&
            ((n.x += this.viewportBorder),
            (n.y += this.viewportBorder),
            (n.width -= 2 * this.viewportBorder),
            (n.height -= 2 * this.viewportBorder),
            (this._positionX -= this.viewportBorder),
            (this._positionY -= this.viewportBorder));
        var a = n.x + n.width / 2,
          l = n.y + n.height / 2,
          c = a - this._positionX,
          u = l - this._positionY;
        i.enableEffect(this._effect),
          i.setState(!1),
          i.setDepthBuffer(!1),
          i.bindBuffers(this._vertexBuffers, this._indexBuffer, this._effect);
        for (var h = 0; h < this.lensFlares.length; h++) {
          var d = this.lensFlares[h];
          if (!d.texture || d.texture.isReady()) {
            i.setAlphaMode(d.alphaMode);
            var p = a - c * d.position,
              f = l - u * d.position,
              _ = d.size,
              m = d.size * i.getAspectRatio(this._scene.activeCamera, !0),
              v = (p / (n.width + 2 * n.x)) * 2 - 1,
              y = 1 - (f / (n.height + 2 * n.y)) * 2,
              b = g.FromValues(
                _ / 2,
                0,
                0,
                0,
                0,
                m / 2,
                0,
                0,
                0,
                0,
                1,
                0,
                v,
                y,
                0,
                1
              );
            this._effect.setMatrix("viewportMatrix", b),
              this._effect.setTexture("textureSampler", d.texture),
              this._effect.setFloat4(
                "color",
                d.color.r * o,
                d.color.g * o,
                d.color.b * o,
                1
              ),
              i.drawElementsType(si.TriangleFillMode, 0, 6);
          }
        }
        return i.setDepthBuffer(!0), i.setAlphaMode(0), !0;
      }),
      (e.prototype.dispose = function () {
        var e = this._vertexBuffers[wt.PositionKind];
        for (
          e && (e.dispose(), (this._vertexBuffers[wt.PositionKind] = null)),
            this._indexBuffer &&
              (this._scene.getEngine()._releaseBuffer(this._indexBuffer),
              (this._indexBuffer = null));
          this.lensFlares.length;

        )
          this.lensFlares[0].dispose();
        var t = this._scene.lensFlareSystems.indexOf(this);
        this._scene.lensFlareSystems.splice(t, 1);
      }),
      (e.Parse = function (t, i, n) {
        var r = i.getLastEntryByID(t.emitterId),
          o = t.name || "lensFlareSystem#" + t.emitterId,
          s = new e(o, r, i);
        (s.id = t.id || o), (s.borderLimit = t.borderLimit);
        for (var a = 0; a < t.flares.length; a++) {
          var l = t.flares[a];
          Wa.AddFlare(
            l.size,
            l.position,
            b.FromArray(l.color),
            l.textureName ? n + l.textureName : "",
            s
          );
        }
        return s;
      }),
      (e.prototype.serialize = function () {
        var e = {};
        (e.id = this.id),
          (e.name = this.name),
          (e.emitterId = this.getEmitter().id),
          (e.borderLimit = this.borderLimit),
          (e.flares = []);
        for (var t = 0; t < this.lensFlares.length; t++) {
          var i = this.lensFlares[t];
          e.flares.push({
            size: i.size,
            position: i.position,
            color: i.color.asArray(),
            textureName: yt.GetFilename(i.texture ? i.texture.name : ""),
          });
        }
        return e;
      }),
      (e._SceneComponentInitialization = function (e) {
        throw $.WarnImport("LensFlareSystemSceneComponent");
      }),
      e
    );
  })();
  t.AddParser(hi.NAME_LENSFLARESYSTEM, function (e, t, i, n) {
    if (void 0 !== e.lensFlareSystems && null !== e.lensFlareSystems) {
      i.lensFlareSystems || (i.lensFlareSystems = new Array());
      for (var r = 0, o = e.lensFlareSystems.length; r < o; r++) {
        var s = e.lensFlareSystems[r],
          a = Ha.Parse(s, t, n);
        i.lensFlareSystems.push(a);
      }
    }
  }),
    (t.prototype.getLensFlareSystemByName = function (e) {
      for (var t = 0; t < this.lensFlareSystems.length; t++)
        if (this.lensFlareSystems[t].name === e)
          return this.lensFlareSystems[t];
      return null;
    }),
    (t.prototype.getLensFlareSystemByID = function (e) {
      for (var t = 0; t < this.lensFlareSystems.length; t++)
        if (this.lensFlareSystems[t].id === e) return this.lensFlareSystems[t];
      return null;
    }),
    (t.prototype.removeLensFlareSystem = function (e) {
      var t = this.lensFlareSystems.indexOf(e);
      return -1 !== t && this.lensFlareSystems.splice(t, 1), t;
    }),
    (t.prototype.addLensFlareSystem = function (e) {
      this.lensFlareSystems.push(e);
    });
  var ja = (function () {
    function e(e) {
      (this.name = hi.NAME_LENSFLARESYSTEM),
        (this.scene = e),
        (e.lensFlareSystems = new Array());
    }
    return (
      (e.prototype.register = function () {
        this.scene._afterCameraDrawStage.registerStep(
          hi.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM,
          this,
          this._draw
        );
      }),
      (e.prototype.rebuild = function () {}),
      (e.prototype.addFromContainer = function (e) {
        var t = this;
        e.lensFlareSystems &&
          e.lensFlareSystems.forEach(function (e) {
            t.scene.addLensFlareSystem(e);
          });
      }),
      (e.prototype.removeFromContainer = function (e, t) {
        var i = this;
        e.lensFlareSystems &&
          e.lensFlareSystems.forEach(function (e) {
            i.scene.removeLensFlareSystem(e), t && e.dispose();
          });
      }),
      (e.prototype.serialize = function (e) {
        e.lensFlareSystems = [];
        for (var t = 0, i = this.scene.lensFlareSystems; t < i.length; t++) {
          var n = i[t];
          e.lensFlareSystems.push(n.serialize());
        }
      }),
      (e.prototype.dispose = function () {
        for (var e = this.scene.lensFlareSystems; e.length; ) e[0].dispose();
      }),
      (e.prototype._draw = function (e) {
        if (this.scene.lensFlaresEnabled) {
          var t = this.scene.lensFlareSystems;
          yt.StartPerformanceCounter("Lens flares", t.length > 0);
          for (var i = 0, n = t; i < n.length; i++) {
            var r = n[i];
            0 != (e.layerMask & r.layerMask) && r.render();
          }
          yt.EndPerformanceCounter("Lens flares", t.length > 0);
        }
      }),
      e
    );
  })();
  Ha._SceneComponentInitialization = function (e) {
    var t = e._getComponent(hi.NAME_LENSFLARESYSTEM);
    t || ((t = new ja(e)), e._addComponent(t));
  };
  Ke.IncludesShadersStore.bayerDitherFunctions =
    "\n\n\n\n\nfloat bayerDither2(vec2 _P) {\nreturn mod(2.0*_P.y+_P.x+1.0,4.0);\n}\n\n\nfloat bayerDither4(vec2 _P) {\nvec2 P1=mod(_P,2.0);\nvec2 P2=floor(0.5*mod(_P,4.0));\nreturn 4.0*bayerDither2(P1)+bayerDither2(P2);\n}\n\nfloat bayerDither8(vec2 _P) {\nvec2 P1=mod(_P,2.0);\nvec2 P2=floor(0.5*mod(_P,4.0));\nvec2 P4=floor(0.25*mod(_P,8.0));\nreturn 4.0*(4.0*bayerDither2(P1)+bayerDither2(P2))+bayerDither2(P4);\n}\n";
  Ke.IncludesShadersStore.shadowMapFragmentDeclaration =
    "#if SM_FLOAT == 0\n#include<packingFunctions>\n#endif\n#if SM_SOFTTRANSPARENTSHADOW == 1\n#include<bayerDitherFunctions>\nuniform float softTransparentShadowSM;\n#endif\nvarying float vDepthMetricSM;\n#if SM_USEDISTANCE == 1\nuniform vec3 lightDataSM;\nvarying vec3 vPositionWSM;\n#endif\nuniform vec3 biasAndScaleSM;\nuniform vec2 depthValuesSM;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1\nvarying float zSM;\n#endif\n";
  Ke.IncludesShadersStore.shadowMapFragment =
    " float depthSM=vDepthMetricSM;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1\n#if SM_USEDISTANCE == 1\ndepthSM=clamp(((length(vPositionWSM-lightDataSM)+depthValuesSM.x)/(depthValuesSM.y))+biasAndScaleSM.x,0.0,1.0);\n#else\ndepthSM=clamp(((zSM+depthValuesSM.x)/(depthValuesSM.y))+biasAndScaleSM.x,0.0,1.0);\n#endif\ngl_FragDepth=depthSM;\n#elif SM_USEDISTANCE == 1\ndepthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/(depthValuesSM.y)+biasAndScaleSM.x;\n#endif\n#if SM_ESM == 1\ndepthSM=clamp(exp(-min(87.,biasAndScaleSM.z*depthSM)),0.,1.);\n#endif\n#if SM_FLOAT == 1\ngl_FragColor=vec4(depthSM,1.0,1.0,1.0);\n#else\ngl_FragColor=pack(depthSM);\n#endif\nreturn;";
  Ke.ShadersStore.shadowMapPixelShader =
    "#include<shadowMapFragmentDeclaration>\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvoid main(void)\n{\n#include<clipPlaneFragment>\n#ifdef ALPHATEST\nfloat alphaFromAlphaTexture=texture2D(diffuseSampler,vUV).a;\nif (alphaFromAlphaTexture<0.4)\ndiscard;\n#endif\n#if SM_SOFTTRANSPARENTSHADOW == 1\n#ifdef ALPHATEST\nif ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM*alphaFromAlphaTexture) discard;\n#else\nif ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM) discard;\n#endif\n#endif\n#include<shadowMapFragment>\n}";
  Ke.IncludesShadersStore.shadowMapVertexDeclaration =
    "#if SM_NORMALBIAS == 1\nuniform vec3 lightDataSM;\n#endif\nuniform vec3 biasAndScaleSM;\nuniform vec2 depthValuesSM;\nvarying float vDepthMetricSM;\n#if SM_USEDISTANCE == 1\nvarying vec3 vPositionWSM;\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1\nvarying float zSM;\n#endif\n";
  Ke.IncludesShadersStore.shadowMapVertexNormalBias =
    "\n#if SM_NORMALBIAS == 1\n#if SM_DIRECTIONINLIGHTDATA == 1\nvec3 worldLightDirSM=normalize(-lightDataSM.xyz);\n#else\nvec3 directionToLightSM=lightDataSM.xyz-worldPos.xyz;\nvec3 worldLightDirSM=normalize(directionToLightSM);\n#endif\nfloat ndlSM=dot(vNormalW,worldLightDirSM);\nfloat sinNLSM=sqrt(1.0-ndlSM*ndlSM);\nfloat normalBiasSM=biasAndScaleSM.y*sinNLSM;\nworldPos.xyz-=vNormalW*normalBiasSM;\n#endif\n";
  Ke.IncludesShadersStore.shadowMapVertexMetric =
    "#if SM_USEDISTANCE == 1\nvPositionWSM=worldPos.xyz;\n#endif\n#if SM_DEPTHTEXTURE == 1\n\ngl_Position.z+=biasAndScaleSM.x*gl_Position.w;\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP == 1\nzSM=gl_Position.z;\ngl_Position.z=0.0;\n#elif SM_USEDISTANCE == 0\n\nvDepthMetricSM=((gl_Position.z+depthValuesSM.x)/(depthValuesSM.y))+biasAndScaleSM.x;\n#endif\n";
  Ke.ShadersStore.shadowMapVertexShader =
    "\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\n#include<helperFunctions>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<shadowMapVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef NORMAL\nmat3 normWorldSM=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvec3 vNormalW=normalUpdated/vec3(dot(normWorldSM[0],normWorldSM[0]),dot(normWorldSM[1],normWorldSM[1]),dot(normWorldSM[2],normWorldSM[2]));\nvNormalW=normalize(normWorldSM*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormWorldSM=transposeMat3(inverseMat3(normWorldSM));\n#endif\nvec3 vNormalW=normalize(normWorldSM*normalUpdated);\n#endif\n#endif\n#include<shadowMapVertexNormalBias>\n\ngl_Position=viewProjection*worldPos;\n#include<shadowMapVertexMetric>\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<clipPlaneVertex>\n}";
  Ke.ShadersStore.depthBoxBlurPixelShader =
    "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}";
  Ke.IncludesShadersStore.shadowMapFragmentSoftTransparentShadow =
    "#if SM_SOFTTRANSPARENTSHADOW == 1\nif ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM*alpha) discard;\n#endif\n";
  var Xa = new g(),
    Ya = new g(),
    Ka = (function () {
      function e(t, i, n) {
        (this.onBeforeShadowMapRenderObservable = new o()),
          (this.onAfterShadowMapRenderObservable = new o()),
          (this.onBeforeShadowMapRenderMeshObservable = new o()),
          (this.onAfterShadowMapRenderMeshObservable = new o()),
          (this._bias = 5e-5),
          (this._normalBias = 0),
          (this._blurBoxOffset = 1),
          (this._blurScale = 2),
          (this._blurKernel = 1),
          (this._useKernelBlur = !1),
          (this._filter = e.FILTER_NONE),
          (this._filteringQuality = e.QUALITY_HIGH),
          (this._contactHardeningLightSizeUVRatio = 0.1),
          (this._darkness = 0),
          (this._transparencyShadow = !1),
          (this.enableSoftTransparentShadow = !1),
          (this.frustumEdgeFalloff = 0),
          (this.forceBackFacesOnly = !1),
          (this._lightDirection = f.Zero()),
          (this._viewMatrix = g.Zero()),
          (this._projectionMatrix = g.Zero()),
          (this._transformMatrix = g.Zero()),
          (this._cachedPosition = new f(
            Number.MAX_VALUE,
            Number.MAX_VALUE,
            Number.MAX_VALUE
          )),
          (this._cachedDirection = new f(
            Number.MAX_VALUE,
            Number.MAX_VALUE,
            Number.MAX_VALUE
          )),
          (this._currentFaceIndex = 0),
          (this._currentFaceIndexCache = 0),
          (this._defaultTextureMatrix = g.Identity()),
          (this._mapSize = t),
          (this._light = i),
          (this._scene = i.getScene()),
          (i._shadowGenerator = this),
          (this.id = i.id),
          e._SceneComponentInitialization(this._scene);
        var r = this._scene.getEngine().getCaps();
        n
          ? r.textureFloatRender && r.textureFloatLinearFiltering
            ? (this._textureType = 1)
            : r.textureHalfFloatRender && r.textureHalfFloatLinearFiltering
              ? (this._textureType = 2)
              : (this._textureType = 0)
          : r.textureHalfFloatRender && r.textureHalfFloatLinearFiltering
            ? (this._textureType = 2)
            : r.textureFloatRender && r.textureFloatLinearFiltering
              ? (this._textureType = 1)
              : (this._textureType = 0),
          this._initializeGenerator(),
          this._applyFilterValues();
      }
      return (
        Object.defineProperty(e.prototype, "bias", {
          get: function () {
            return this._bias;
          },
          set: function (e) {
            this._bias = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "normalBias", {
          get: function () {
            return this._normalBias;
          },
          set: function (e) {
            this._normalBias = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "blurBoxOffset", {
          get: function () {
            return this._blurBoxOffset;
          },
          set: function (e) {
            this._blurBoxOffset !== e &&
              ((this._blurBoxOffset = e), this._disposeBlurPostProcesses());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "blurScale", {
          get: function () {
            return this._blurScale;
          },
          set: function (e) {
            this._blurScale !== e &&
              ((this._blurScale = e), this._disposeBlurPostProcesses());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "blurKernel", {
          get: function () {
            return this._blurKernel;
          },
          set: function (e) {
            this._blurKernel !== e &&
              ((this._blurKernel = e), this._disposeBlurPostProcesses());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "useKernelBlur", {
          get: function () {
            return this._useKernelBlur;
          },
          set: function (e) {
            this._useKernelBlur !== e &&
              ((this._useKernelBlur = e), this._disposeBlurPostProcesses());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "depthScale", {
          get: function () {
            return void 0 !== this._depthScale
              ? this._depthScale
              : this._light.getDepthScale();
          },
          set: function (e) {
            this._depthScale = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype._validateFilter = function (e) {
          return e;
        }),
        Object.defineProperty(e.prototype, "filter", {
          get: function () {
            return this._filter;
          },
          set: function (t) {
            if (((t = this._validateFilter(t)), this._light.needCube())) {
              if (t === e.FILTER_BLUREXPONENTIALSHADOWMAP)
                return void (this.useExponentialShadowMap = !0);
              if (t === e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP)
                return void (this.useCloseExponentialShadowMap = !0);
              if (t === e.FILTER_PCF || t === e.FILTER_PCSS)
                return void (this.usePoissonSampling = !0);
            }
            (t !== e.FILTER_PCF && t !== e.FILTER_PCSS) ||
            1 !== this._scene.getEngine().webGLVersion
              ? this._filter !== t &&
                ((this._filter = t),
                this._disposeBlurPostProcesses(),
                this._applyFilterValues(),
                this._light._markMeshesAsLightDirty())
              : (this.usePoissonSampling = !0);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "usePoissonSampling", {
          get: function () {
            return this.filter === e.FILTER_POISSONSAMPLING;
          },
          set: function (t) {
            var i = this._validateFilter(e.FILTER_POISSONSAMPLING);
            (t || this.filter === e.FILTER_POISSONSAMPLING) &&
              (this.filter = t ? i : e.FILTER_NONE);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "useExponentialShadowMap", {
          get: function () {
            return this.filter === e.FILTER_EXPONENTIALSHADOWMAP;
          },
          set: function (t) {
            var i = this._validateFilter(e.FILTER_EXPONENTIALSHADOWMAP);
            (t || this.filter === e.FILTER_EXPONENTIALSHADOWMAP) &&
              (this.filter = t ? i : e.FILTER_NONE);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "useBlurExponentialShadowMap", {
          get: function () {
            return this.filter === e.FILTER_BLUREXPONENTIALSHADOWMAP;
          },
          set: function (t) {
            var i = this._validateFilter(e.FILTER_BLUREXPONENTIALSHADOWMAP);
            (t || this.filter === e.FILTER_BLUREXPONENTIALSHADOWMAP) &&
              (this.filter = t ? i : e.FILTER_NONE);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "useCloseExponentialShadowMap", {
          get: function () {
            return this.filter === e.FILTER_CLOSEEXPONENTIALSHADOWMAP;
          },
          set: function (t) {
            var i = this._validateFilter(e.FILTER_CLOSEEXPONENTIALSHADOWMAP);
            (t || this.filter === e.FILTER_CLOSEEXPONENTIALSHADOWMAP) &&
              (this.filter = t ? i : e.FILTER_NONE);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "useBlurCloseExponentialShadowMap", {
          get: function () {
            return this.filter === e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP;
          },
          set: function (t) {
            var i = this._validateFilter(
              e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP
            );
            (t || this.filter === e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP) &&
              (this.filter = t ? i : e.FILTER_NONE);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "usePercentageCloserFiltering", {
          get: function () {
            return this.filter === e.FILTER_PCF;
          },
          set: function (t) {
            var i = this._validateFilter(e.FILTER_PCF);
            (t || this.filter === e.FILTER_PCF) &&
              (this.filter = t ? i : e.FILTER_NONE);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "filteringQuality", {
          get: function () {
            return this._filteringQuality;
          },
          set: function (e) {
            this._filteringQuality !== e &&
              ((this._filteringQuality = e),
              this._disposeBlurPostProcesses(),
              this._applyFilterValues(),
              this._light._markMeshesAsLightDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "useContactHardeningShadow", {
          get: function () {
            return this.filter === e.FILTER_PCSS;
          },
          set: function (t) {
            var i = this._validateFilter(e.FILTER_PCSS);
            (t || this.filter === e.FILTER_PCSS) &&
              (this.filter = t ? i : e.FILTER_NONE);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "contactHardeningLightSizeUVRatio", {
          get: function () {
            return this._contactHardeningLightSizeUVRatio;
          },
          set: function (e) {
            this._contactHardeningLightSizeUVRatio = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "darkness", {
          get: function () {
            return this._darkness;
          },
          set: function (e) {
            this.setDarkness(e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.getDarkness = function () {
          return this._darkness;
        }),
        (e.prototype.setDarkness = function (e) {
          return (this._darkness = e >= 1 ? 1 : e <= 0 ? 0 : e), this;
        }),
        Object.defineProperty(e.prototype, "transparencyShadow", {
          get: function () {
            return this._transparencyShadow;
          },
          set: function (e) {
            this.setTransparencyShadow(e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.setTransparencyShadow = function (e) {
          return (this._transparencyShadow = e), this;
        }),
        (e.prototype.getShadowMap = function () {
          return this._shadowMap;
        }),
        (e.prototype.getShadowMapForRendering = function () {
          return this._shadowMap2 ? this._shadowMap2 : this._shadowMap;
        }),
        (e.prototype.getClassName = function () {
          return e.CLASSNAME;
        }),
        (e.prototype.addShadowCaster = function (e, t) {
          var i;
          return (
            void 0 === t && (t = !0),
            this._shadowMap
              ? (this._shadowMap.renderList ||
                  (this._shadowMap.renderList = []),
                this._shadowMap.renderList.push(e),
                t &&
                  (i = this._shadowMap.renderList).push.apply(
                    i,
                    e.getChildMeshes()
                  ),
                this)
              : this
          );
        }),
        (e.prototype.removeShadowCaster = function (e, t) {
          if (
            (void 0 === t && (t = !0),
            !this._shadowMap || !this._shadowMap.renderList)
          )
            return this;
          var i = this._shadowMap.renderList.indexOf(e);
          if ((-1 !== i && this._shadowMap.renderList.splice(i, 1), t))
            for (var n = 0, r = e.getChildren(); n < r.length; n++) {
              var o = r[n];
              this.removeShadowCaster(o);
            }
          return this;
        }),
        (e.prototype.getLight = function () {
          return this._light;
        }),
        Object.defineProperty(e.prototype, "mapSize", {
          get: function () {
            return this._mapSize;
          },
          set: function (e) {
            (this._mapSize = e),
              this._light._markMeshesAsLightDirty(),
              this.recreateShadowMap();
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype._initializeGenerator = function () {
          this._light._markMeshesAsLightDirty(), this._initializeShadowMap();
        }),
        (e.prototype._createTargetRenderTexture = function () {
          this._scene.getEngine().webGLVersion > 1
            ? ((this._shadowMap = new Dr(
                this._light.name + "_shadowMap",
                this._mapSize,
                this._scene,
                !1,
                !0,
                this._textureType,
                this._light.needCube(),
                void 0,
                !1,
                !1
              )),
              this._shadowMap.createDepthStencilTexture(513, !0))
            : (this._shadowMap = new Dr(
                this._light.name + "_shadowMap",
                this._mapSize,
                this._scene,
                !1,
                !0,
                this._textureType,
                this._light.needCube()
              ));
        }),
        (e.prototype._initializeShadowMap = function () {
          var t = this;
          if ((this._createTargetRenderTexture(), null !== this._shadowMap)) {
            (this._shadowMap.wrapU = mn.CLAMP_ADDRESSMODE),
              (this._shadowMap.wrapV = mn.CLAMP_ADDRESSMODE),
              (this._shadowMap.anisotropicFilteringLevel = 1),
              this._shadowMap.updateSamplingMode(mn.BILINEAR_SAMPLINGMODE),
              (this._shadowMap.renderParticles = !1),
              (this._shadowMap.ignoreCameraViewport = !0),
              this._storedUniqueId &&
                (this._shadowMap.uniqueId = this._storedUniqueId),
              (this._shadowMap.customRenderFunction =
                this._renderForShadowMap.bind(this)),
              (this._shadowMap.customIsReadyFunction = function (e, t) {
                return !0;
              });
            var i = this._scene.getEngine();
            this._shadowMap.onBeforeRenderObservable.add(function (n) {
              if (
                ((t._currentFaceIndex = n),
                t._filter === e.FILTER_PCF && i.setColorWrite(!1),
                t._scene.getSceneUniformBuffer().useUbo)
              ) {
                var r = t._scene.getSceneUniformBuffer();
                r.updateMatrix("viewProjection", t.getTransformMatrix()),
                  r.updateMatrix("view", t._viewMatrix),
                  r.update();
              }
            }),
              this._shadowMap.onAfterUnbindObservable.add(function () {
                if (t._scene.getSceneUniformBuffer().useUbo) {
                  var n = t._scene.getSceneUniformBuffer();
                  n.updateMatrix(
                    "viewProjection",
                    t._scene.getTransformMatrix()
                  ),
                    n.updateMatrix("view", t._scene.getViewMatrix()),
                    n.update();
                }
                if (
                  (t._filter === e.FILTER_PCF && i.setColorWrite(!0),
                  t.useBlurExponentialShadowMap ||
                    t.useBlurCloseExponentialShadowMap)
                ) {
                  var r = t.getShadowMapForRendering();
                  if (r) {
                    var o = r.getInternalTexture();
                    t._scene.postProcessManager.directRender(
                      t._blurPostProcesses,
                      o,
                      !0
                    ),
                      i.unBindFramebuffer(o, !0);
                  }
                }
              });
            var n = new T(0, 0, 0, 0),
              r = new T(1, 1, 1, 1);
            this._shadowMap.onClearObservable.add(function (i) {
              t._filter === e.FILTER_PCF
                ? i.clear(r, !1, !0, !1)
                : t.useExponentialShadowMap || t.useBlurExponentialShadowMap
                  ? i.clear(n, !0, !0, !1)
                  : i.clear(r, !0, !0, !1);
            }),
              this._shadowMap.onResizeObservable.add(function (e) {
                (t._storedUniqueId = t._shadowMap.uniqueId),
                  (t._mapSize = e.getRenderSize()),
                  t._light._markMeshesAsLightDirty(),
                  t.recreateShadowMap();
              });
            for (
              var o = ui.MIN_RENDERINGGROUPS;
              o < ui.MAX_RENDERINGGROUPS;
              o++
            )
              this._shadowMap.setRenderingAutoClearDepthStencil(o, !1);
          }
        }),
        (e.prototype._initializeBlurRTTAndPostProcesses = function () {
          var e = this,
            t = this._scene.getEngine(),
            i = this._mapSize / this.blurScale;
          (this.useKernelBlur && 1 === this.blurScale) ||
            ((this._shadowMap2 = new Dr(
              this._light.name + "_shadowMap2",
              i,
              this._scene,
              !1,
              !0,
              this._textureType
            )),
            (this._shadowMap2.wrapU = mn.CLAMP_ADDRESSMODE),
            (this._shadowMap2.wrapV = mn.CLAMP_ADDRESSMODE),
            this._shadowMap2.updateSamplingMode(mn.BILINEAR_SAMPLINGMODE)),
            this.useKernelBlur
              ? ((this._kernelBlurXPostprocess = new Ns(
                  this._light.name + "KernelBlurX",
                  new p(1, 0),
                  this.blurKernel,
                  1,
                  null,
                  mn.BILINEAR_SAMPLINGMODE,
                  t,
                  !1,
                  this._textureType
                )),
                (this._kernelBlurXPostprocess.width = i),
                (this._kernelBlurXPostprocess.height = i),
                this._kernelBlurXPostprocess.onApplyObservable.add(
                  function (t) {
                    t.setTexture("textureSampler", e._shadowMap);
                  }
                ),
                (this._kernelBlurYPostprocess = new Ns(
                  this._light.name + "KernelBlurY",
                  new p(0, 1),
                  this.blurKernel,
                  1,
                  null,
                  mn.BILINEAR_SAMPLINGMODE,
                  t,
                  !1,
                  this._textureType
                )),
                (this._kernelBlurXPostprocess.autoClear = !1),
                (this._kernelBlurYPostprocess.autoClear = !1),
                0 === this._textureType &&
                  ((this._kernelBlurXPostprocess.packedFloat = !0),
                  (this._kernelBlurYPostprocess.packedFloat = !0)),
                (this._blurPostProcesses = [
                  this._kernelBlurXPostprocess,
                  this._kernelBlurYPostprocess,
                ]))
              : ((this._boxBlurPostprocess = new vr(
                  this._light.name + "DepthBoxBlur",
                  "depthBoxBlur",
                  ["screenSize", "boxOffset"],
                  [],
                  1,
                  null,
                  mn.BILINEAR_SAMPLINGMODE,
                  t,
                  !1,
                  "#define OFFSET " + this._blurBoxOffset,
                  this._textureType
                )),
                this._boxBlurPostprocess.onApplyObservable.add(function (t) {
                  t.setFloat2("screenSize", i, i),
                    t.setTexture("textureSampler", e._shadowMap);
                }),
                (this._boxBlurPostprocess.autoClear = !1),
                (this._blurPostProcesses = [this._boxBlurPostprocess]));
        }),
        (e.prototype._renderForShadowMap = function (e, t, i, n) {
          var r,
            o = this._scene.getEngine(),
            s = o.getColorWrite();
          if (n.length) {
            for (o.setColorWrite(!1), r = 0; r < n.length; r++)
              this._renderSubMeshForShadowMap(n.data[r]);
            o.setColorWrite(s);
          }
          for (r = 0; r < e.length; r++)
            this._renderSubMeshForShadowMap(e.data[r]);
          for (r = 0; r < t.length; r++)
            this._renderSubMeshForShadowMap(t.data[r]);
          if (this._transparencyShadow)
            for (r = 0; r < i.length; r++)
              this._renderSubMeshForShadowMap(i.data[r], !0);
          else
            for (r = 0; r < i.length; r++)
              i.data[
                r
              ].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate =
                !1;
        }),
        (e.prototype._bindCustomEffectForRenderSubMeshForShadowMap = function (
          e,
          t,
          i,
          n
        ) {
          var r, o, s, a, l, c;
          t.setMatrix(
            null !== (r = null == i ? void 0 : i.viewProjection) && void 0 !== r
              ? r
              : "viewProjection",
            this.getTransformMatrix()
          ),
            t.setMatrix(
              null !== (o = null == i ? void 0 : i.view) && void 0 !== o
                ? o
                : "view",
              this._viewMatrix
            ),
            t.setMatrix(
              null !== (s = null == i ? void 0 : i.projection) && void 0 !== s
                ? s
                : "projection",
              this._projectionMatrix
            );
          var u = n.getWorldMatrix();
          t.setMatrix(
            null !== (a = null == i ? void 0 : i.world) && void 0 !== a
              ? a
              : "world",
            u
          ),
            u.multiplyToRef(this.getTransformMatrix(), Xa),
            t.setMatrix(
              null !== (l = null == i ? void 0 : i.worldViewProjection) &&
                void 0 !== l
                ? l
                : "worldViewProjection",
              Xa
            ),
            u.multiplyToRef(this._viewMatrix, Ya),
            t.setMatrix(
              null !== (c = null == i ? void 0 : i.worldView) && void 0 !== c
                ? c
                : "worldView",
              Ya
            );
        }),
        (e.prototype._renderSubMeshForShadowMap = function (e, t) {
          var i, n;
          void 0 === t && (t = !1);
          var r = e.getRenderingMesh(),
            o = e.getEffectiveMesh(),
            s = this._scene,
            a = s.getEngine(),
            l = e.getMaterial();
          if (
            ((o._internalAbstractMeshDataInfo._isActiveIntermediate = !1),
            l && 0 !== e.verticesCount && e._renderId !== s.getRenderId())
          ) {
            a.setState(l.backFaceCulling);
            var c = r._getInstancesRenderList(e._id, !!e.getReplacementMesh());
            if (!c.mustReturn) {
              var u =
                a.getCaps().instancedArrays &&
                ((null !== c.visibleInstances[e._id] &&
                  void 0 !== c.visibleInstances[e._id]) ||
                  r.hasThinInstances);
              if (!this.customAllowRendering || this.customAllowRendering(e))
                if (this.isReady(e, u, t)) {
                  e._renderId = s.getRenderId();
                  var h =
                      null === (i = r.material) || void 0 === i
                        ? void 0
                        : i.shadowDepthWrapper,
                    d =
                      null !==
                        (n = null == h ? void 0 : h.getEffect(e, this)) &&
                      void 0 !== n
                        ? n
                        : this._effect;
                  if (
                    (a.enableEffect(d),
                    r._bind(e, d, l.fillMode),
                    this.getTransformMatrix(),
                    d.setFloat3(
                      "biasAndScaleSM",
                      this.bias,
                      this.normalBias,
                      this.depthScale
                    ),
                    this.getLight().getTypeID() ===
                    ni.LIGHTTYPEID_DIRECTIONALLIGHT
                      ? d.setVector3("lightDataSM", this._cachedDirection)
                      : d.setVector3("lightDataSM", this._cachedPosition),
                    s.activeCamera &&
                      d.setFloat2(
                        "depthValuesSM",
                        this.getLight().getDepthMinZ(s.activeCamera),
                        this.getLight().getDepthMinZ(s.activeCamera) +
                          this.getLight().getDepthMaxZ(s.activeCamera)
                      ),
                    t &&
                      this.enableSoftTransparentShadow &&
                      d.setFloat("softTransparentShadowSM", o.visibility),
                    h)
                  )
                    (e._effectOverride = d),
                      h.standalone
                        ? h.baseMaterial.bindForSubMesh(
                            o.getWorldMatrix(),
                            r,
                            e
                          )
                        : l.bindForSubMesh(o.getWorldMatrix(), r, e),
                      (e._effectOverride = null);
                  else {
                    if (
                      (d.setMatrix("viewProjection", this.getTransformMatrix()),
                      l && l.needAlphaTesting())
                    ) {
                      var p = l.getAlphaTestTexture();
                      p &&
                        (d.setTexture("diffuseSampler", p),
                        d.setMatrix(
                          "diffuseMatrix",
                          p.getTextureMatrix() || this._defaultTextureMatrix
                        ));
                    }
                    if (
                      r.useBones &&
                      r.computeBonesUsingShaders &&
                      r.skeleton
                    ) {
                      var f = r.skeleton;
                      if (f.isUsingTextureForMatrices) {
                        var _ = f.getTransformMatrixTexture(r);
                        if (!_) return;
                        d.setTexture("boneSampler", _),
                          d.setFloat(
                            "boneTextureWidth",
                            4 * (f.bones.length + 1)
                          );
                      } else d.setMatrices("mBones", f.getTransformMatrices(r));
                    }
                    Hr.BindMorphTargetParameters(r, d), Hr.BindClipPlane(d, s);
                  }
                  this._bindCustomEffectForRenderSubMeshForShadowMap(
                    e,
                    d,
                    null == h ? void 0 : h._matriceNames,
                    o
                  ),
                    this.forceBackFacesOnly && a.setState(!0, 0, !1, !0),
                    this.onBeforeShadowMapRenderMeshObservable.notifyObservers(
                      r
                    ),
                    this.onBeforeShadowMapRenderObservable.notifyObservers(d),
                    r._processRendering(
                      o,
                      e,
                      d,
                      l.fillMode,
                      c,
                      u,
                      function (e, t) {
                        return d.setMatrix("world", t);
                      }
                    ),
                    this.forceBackFacesOnly && a.setState(!0, 0, !1, !1),
                    this.onAfterShadowMapRenderObservable.notifyObservers(d),
                    this.onAfterShadowMapRenderMeshObservable.notifyObservers(
                      r
                    );
                } else this._shadowMap && this._shadowMap.resetRefreshCounter();
            }
          }
        }),
        (e.prototype._applyFilterValues = function () {
          this._shadowMap &&
            (this.filter === e.FILTER_NONE || this.filter === e.FILTER_PCSS
              ? this._shadowMap.updateSamplingMode(mn.NEAREST_SAMPLINGMODE)
              : this._shadowMap.updateSamplingMode(mn.BILINEAR_SAMPLINGMODE));
        }),
        (e.prototype.forceCompilation = function (e, t) {
          var i = this,
            n = A(
              {
                useInstances: !1,
              },
              t
            ),
            r = this.getShadowMap();
          if (r) {
            var o = r.renderList;
            if (o) {
              for (var s = new Array(), a = 0, l = o; a < l.length; a++) {
                var c = l[a];
                s.push.apply(s, c.subMeshes);
              }
              if (0 !== s.length) {
                var u = 0,
                  h = function () {
                    var t, r;
                    if (i._scene && i._scene.getEngine()) {
                      for (
                        ;
                        i.isReady(
                          s[u],
                          n.useInstances,
                          null !==
                            (r =
                              null === (t = s[u].getMaterial()) || void 0 === t
                                ? void 0
                                : t.needAlphaBlendingForMesh(s[u].getMesh())) &&
                            void 0 !== r &&
                            r
                        );

                      )
                        if (++u >= s.length) return void (e && e(i));
                      setTimeout(h, 16);
                    }
                  };
                h();
              } else e && e(this);
            } else e && e(this);
          } else e && e(this);
        }),
        (e.prototype.forceCompilationAsync = function (e) {
          var t = this;
          return new Promise(function (i) {
            t.forceCompilation(function () {
              i();
            }, e);
          });
        }),
        (e.prototype._isReadyCustomDefines = function (e, t, i) {}),
        (e.prototype._prepareShadowDefines = function (e, t, i, n) {
          i.push("#define SM_FLOAT " + (0 !== this._textureType ? "1" : "0")),
            i.push(
              "#define SM_ESM " +
                (this.useExponentialShadowMap ||
                this.useBlurExponentialShadowMap
                  ? "1"
                  : "0")
            ),
            i.push(
              "#define SM_DEPTHTEXTURE " +
                (this.usePercentageCloserFiltering ||
                this.useContactHardeningShadow
                  ? "1"
                  : "0")
            );
          var r = e.getMesh();
          return (
            i.push(
              "#define SM_NORMALBIAS " +
                (this.normalBias && r.isVerticesDataPresent(wt.NormalKind)
                  ? "1"
                  : "0")
            ),
            i.push(
              "#define SM_DIRECTIONINLIGHTDATA " +
                (this.getLight().getTypeID() === ni.LIGHTTYPEID_DIRECTIONALLIGHT
                  ? "1"
                  : "0")
            ),
            i.push(
              "#define SM_USEDISTANCE " + (this._light.needCube() ? "1" : "0")
            ),
            i.push(
              "#define SM_SOFTTRANSPARENTSHADOW " +
                (this.enableSoftTransparentShadow && n ? "1" : "0")
            ),
            this._isReadyCustomDefines(i, e, t),
            i
          );
        }),
        (e.prototype.isReady = function (e, t, i) {
          var n = e.getMaterial(),
            r = null == n ? void 0 : n.shadowDepthWrapper,
            o = [];
          if ((this._prepareShadowDefines(e, t, o, i), r)) {
            if (!r.isReadyForSubMesh(e, o, this, t)) return !1;
          } else {
            var s = [wt.PositionKind],
              a = e.getMesh();
            if (
              (this.normalBias &&
                a.isVerticesDataPresent(wt.NormalKind) &&
                (s.push(wt.NormalKind),
                o.push("#define NORMAL"),
                a.nonUniformScaling && o.push("#define NONUNIFORMSCALING")),
              n && n.needAlphaTesting())
            ) {
              var l = n.getAlphaTestTexture();
              if (l) {
                if (!l.isReady()) return !1;
                o.push("#define ALPHATEST"),
                  a.isVerticesDataPresent(wt.UVKind) &&
                    (s.push(wt.UVKind), o.push("#define UV1")),
                  a.isVerticesDataPresent(wt.UV2Kind) &&
                    1 === l.coordinatesIndex &&
                    (s.push(wt.UV2Kind), o.push("#define UV2"));
              }
            }
            var c = new Xr();
            if (a.useBones && a.computeBonesUsingShaders && a.skeleton) {
              s.push(wt.MatricesIndicesKind),
                s.push(wt.MatricesWeightsKind),
                a.numBoneInfluencers > 4 &&
                  (s.push(wt.MatricesIndicesExtraKind),
                  s.push(wt.MatricesWeightsExtraKind));
              var u = a.skeleton;
              o.push("#define NUM_BONE_INFLUENCERS " + a.numBoneInfluencers),
                a.numBoneInfluencers > 0 && c.addCPUSkinningFallback(0, a),
                u.isUsingTextureForMatrices
                  ? o.push("#define BONETEXTURE")
                  : o.push("#define BonesPerMesh " + (u.bones.length + 1));
            } else o.push("#define NUM_BONE_INFLUENCERS 0");
            var h = a.morphTargetManager,
              d = 0;
            h &&
              h.numInfluencers > 0 &&
              (o.push("#define MORPHTARGETS"),
              (d = h.numInfluencers),
              o.push("#define NUM_MORPH_INFLUENCERS " + d),
              Hr.PrepareAttributesForMorphTargetsInfluencers(s, a, d));
            var p = this._scene;
            if (
              (p.clipPlane && o.push("#define CLIPPLANE"),
              p.clipPlane2 && o.push("#define CLIPPLANE2"),
              p.clipPlane3 && o.push("#define CLIPPLANE3"),
              p.clipPlane4 && o.push("#define CLIPPLANE4"),
              p.clipPlane5 && o.push("#define CLIPPLANE5"),
              p.clipPlane6 && o.push("#define CLIPPLANE6"),
              t &&
                (o.push("#define INSTANCES"),
                Hr.PushAttributesForInstances(s),
                e.getRenderingMesh().hasThinInstances &&
                  o.push("#define THIN_INSTANCES")),
              this.customShaderOptions && this.customShaderOptions.defines)
            )
              for (
                var f = 0, _ = this.customShaderOptions.defines;
                f < _.length;
                f++
              ) {
                var m = _[f];
                -1 === o.indexOf(m) && o.push(m);
              }
            var g = o.join("\n");
            if (this._cachedDefines !== g) {
              this._cachedDefines = g;
              var v = "shadowMap",
                y = [
                  "world",
                  "mBones",
                  "viewProjection",
                  "diffuseMatrix",
                  "lightDataSM",
                  "depthValuesSM",
                  "biasAndScaleSM",
                  "morphTargetInfluences",
                  "boneTextureWidth",
                  "vClipPlane",
                  "vClipPlane2",
                  "vClipPlane3",
                  "vClipPlane4",
                  "vClipPlane5",
                  "vClipPlane6",
                  "softTransparentShadowSM",
                ],
                b = ["diffuseSampler", "boneSampler"];
              if (this.customShaderOptions) {
                if (
                  ((v = this.customShaderOptions.shaderName),
                  this.customShaderOptions.attributes)
                )
                  for (
                    var T = 0, S = this.customShaderOptions.attributes;
                    T < S.length;
                    T++
                  ) {
                    var C = S[T];
                    -1 === s.indexOf(C) && s.push(C);
                  }
                if (this.customShaderOptions.uniforms)
                  for (
                    var x = 0, E = this.customShaderOptions.uniforms;
                    x < E.length;
                    x++
                  ) {
                    var P = E[x];
                    -1 === y.indexOf(P) && y.push(P);
                  }
                if (this.customShaderOptions.samplers)
                  for (
                    var A = 0, R = this.customShaderOptions.samplers;
                    A < R.length;
                    A++
                  ) {
                    var M = R[A];
                    -1 === b.indexOf(M) && b.push(M);
                  }
              }
              this._effect = this._scene
                .getEngine()
                .createEffect(v, s, y, b, g, c, void 0, void 0, {
                  maxSimultaneousMorphTargets: d,
                });
            }
            if (!this._effect.isReady()) return !1;
          }
          return (
            (this.useBlurExponentialShadowMap ||
              this.useBlurCloseExponentialShadowMap) &&
              ((this._blurPostProcesses && this._blurPostProcesses.length) ||
                this._initializeBlurRTTAndPostProcesses()),
            !(
              (this._kernelBlurXPostprocess &&
                !this._kernelBlurXPostprocess.isReady()) ||
              (this._kernelBlurYPostprocess &&
                !this._kernelBlurYPostprocess.isReady()) ||
              (this._boxBlurPostprocess && !this._boxBlurPostprocess.isReady())
            )
          );
        }),
        (e.prototype.prepareDefines = function (t, i) {
          var n = this._scene,
            r = this._light;
          n.shadowsEnabled &&
            r.shadowEnabled &&
            ((t["SHADOW" + i] = !0),
            this.useContactHardeningShadow
              ? ((t["SHADOWPCSS" + i] = !0),
                this._filteringQuality === e.QUALITY_LOW
                  ? (t["SHADOWLOWQUALITY" + i] = !0)
                  : this._filteringQuality === e.QUALITY_MEDIUM &&
                    (t["SHADOWMEDIUMQUALITY" + i] = !0))
              : this.usePercentageCloserFiltering
                ? ((t["SHADOWPCF" + i] = !0),
                  this._filteringQuality === e.QUALITY_LOW
                    ? (t["SHADOWLOWQUALITY" + i] = !0)
                    : this._filteringQuality === e.QUALITY_MEDIUM &&
                      (t["SHADOWMEDIUMQUALITY" + i] = !0))
                : this.usePoissonSampling
                  ? (t["SHADOWPOISSON" + i] = !0)
                  : this.useExponentialShadowMap ||
                      this.useBlurExponentialShadowMap
                    ? (t["SHADOWESM" + i] = !0)
                    : (this.useCloseExponentialShadowMap ||
                        this.useBlurCloseExponentialShadowMap) &&
                      (t["SHADOWCLOSEESM" + i] = !0),
            r.needCube() && (t["SHADOWCUBE" + i] = !0));
        }),
        (e.prototype.bindShadowLight = function (t, i) {
          var n = this._light,
            r = this._scene;
          if (r.shadowsEnabled && n.shadowEnabled) {
            var o = r.activeCamera;
            if (o) {
              var s = this.getShadowMap();
              s &&
                (n.needCube() ||
                  i.setMatrix("lightMatrix" + t, this.getTransformMatrix()),
                this._filter === e.FILTER_PCF
                  ? (i.setDepthStencilTexture(
                      "shadowSampler" + t,
                      this.getShadowMapForRendering()
                    ),
                    n._uniformBuffer.updateFloat4(
                      "shadowsInfo",
                      this.getDarkness(),
                      s.getSize().width,
                      1 / s.getSize().width,
                      this.frustumEdgeFalloff,
                      t
                    ))
                  : this._filter === e.FILTER_PCSS
                    ? (i.setDepthStencilTexture(
                        "shadowSampler" + t,
                        this.getShadowMapForRendering()
                      ),
                      i.setTexture(
                        "depthSampler" + t,
                        this.getShadowMapForRendering()
                      ),
                      n._uniformBuffer.updateFloat4(
                        "shadowsInfo",
                        this.getDarkness(),
                        1 / s.getSize().width,
                        this._contactHardeningLightSizeUVRatio *
                          s.getSize().width,
                        this.frustumEdgeFalloff,
                        t
                      ))
                    : (i.setTexture(
                        "shadowSampler" + t,
                        this.getShadowMapForRendering()
                      ),
                      n._uniformBuffer.updateFloat4(
                        "shadowsInfo",
                        this.getDarkness(),
                        this.blurScale / s.getSize().width,
                        this.depthScale,
                        this.frustumEdgeFalloff,
                        t
                      )),
                n._uniformBuffer.updateFloat2(
                  "depthValues",
                  this.getLight().getDepthMinZ(o),
                  this.getLight().getDepthMinZ(o) +
                    this.getLight().getDepthMaxZ(o),
                  t
                ));
            }
          }
        }),
        (e.prototype.getTransformMatrix = function () {
          var e = this._scene;
          if (
            this._currentRenderID === e.getRenderId() &&
            this._currentFaceIndexCache === this._currentFaceIndex
          )
            return this._transformMatrix;
          (this._currentRenderID = e.getRenderId()),
            (this._currentFaceIndexCache = this._currentFaceIndex);
          var t = this._light.position;
          if (
            (this._light.computeTransformedInformation() &&
              (t = this._light.transformedPosition),
            f.NormalizeToRef(
              this._light.getShadowDirection(this._currentFaceIndex),
              this._lightDirection
            ),
            1 === Math.abs(f.Dot(this._lightDirection, f.Up())) &&
              (this._lightDirection.z = 1e-13),
            this._light.needProjectionMatrixCompute() ||
              !this._cachedPosition ||
              !this._cachedDirection ||
              !t.equals(this._cachedPosition) ||
              !this._lightDirection.equals(this._cachedDirection))
          ) {
            this._cachedPosition.copyFrom(t),
              this._cachedDirection.copyFrom(this._lightDirection),
              g.LookAtLHToRef(
                t,
                t.add(this._lightDirection),
                f.Up(),
                this._viewMatrix
              );
            var i = this.getShadowMap();
            if (i) {
              var n = i.renderList;
              n &&
                this._light.setShadowProjectionMatrix(
                  this._projectionMatrix,
                  this._viewMatrix,
                  n
                );
            }
            this._viewMatrix.multiplyToRef(
              this._projectionMatrix,
              this._transformMatrix
            );
          }
          return this._transformMatrix;
        }),
        (e.prototype.recreateShadowMap = function () {
          var e = this._shadowMap;
          if (e) {
            var t = e.renderList;
            this._disposeRTTandPostProcesses(),
              this._initializeGenerator(),
              (this.filter = this.filter),
              this._applyFilterValues(),
              (this._shadowMap.renderList = t);
          }
        }),
        (e.prototype._disposeBlurPostProcesses = function () {
          this._shadowMap2 &&
            (this._shadowMap2.dispose(), (this._shadowMap2 = null)),
            this._boxBlurPostprocess &&
              (this._boxBlurPostprocess.dispose(),
              (this._boxBlurPostprocess = null)),
            this._kernelBlurXPostprocess &&
              (this._kernelBlurXPostprocess.dispose(),
              (this._kernelBlurXPostprocess = null)),
            this._kernelBlurYPostprocess &&
              (this._kernelBlurYPostprocess.dispose(),
              (this._kernelBlurYPostprocess = null)),
            (this._blurPostProcesses = []);
        }),
        (e.prototype._disposeRTTandPostProcesses = function () {
          this._shadowMap &&
            (this._shadowMap.dispose(), (this._shadowMap = null)),
            this._disposeBlurPostProcesses();
        }),
        (e.prototype.dispose = function () {
          this._disposeRTTandPostProcesses(),
            this._light &&
              ((this._light._shadowGenerator = null),
              this._light._markMeshesAsLightDirty()),
            this.onBeforeShadowMapRenderMeshObservable.clear(),
            this.onBeforeShadowMapRenderObservable.clear(),
            this.onAfterShadowMapRenderMeshObservable.clear(),
            this.onAfterShadowMapRenderObservable.clear();
        }),
        (e.prototype.serialize = function () {
          var e = {},
            t = this.getShadowMap();
          if (!t) return e;
          if (
            ((e.className = this.getClassName()),
            (e.lightId = this._light.id),
            (e.id = this._light.id),
            (e.mapSize = t.getRenderSize()),
            (e.forceBackFacesOnly = this.forceBackFacesOnly),
            (e.darkness = this.getDarkness()),
            (e.transparencyShadow = this._transparencyShadow),
            (e.frustumEdgeFalloff = this.frustumEdgeFalloff),
            (e.bias = this.bias),
            (e.normalBias = this.normalBias),
            (e.usePercentageCloserFiltering =
              this.usePercentageCloserFiltering),
            (e.useContactHardeningShadow = this.useContactHardeningShadow),
            (e.contactHardeningLightSizeUVRatio =
              this.contactHardeningLightSizeUVRatio),
            (e.filteringQuality = this.filteringQuality),
            (e.useExponentialShadowMap = this.useExponentialShadowMap),
            (e.useBlurExponentialShadowMap = this.useBlurExponentialShadowMap),
            (e.useCloseExponentialShadowMap = this.useBlurExponentialShadowMap),
            (e.useBlurCloseExponentialShadowMap =
              this.useBlurExponentialShadowMap),
            (e.usePoissonSampling = this.usePoissonSampling),
            (e.depthScale = this.depthScale),
            (e.blurBoxOffset = this.blurBoxOffset),
            (e.blurKernel = this.blurKernel),
            (e.blurScale = this.blurScale),
            (e.useKernelBlur = this.useKernelBlur),
            (e.renderList = []),
            t.renderList)
          )
            for (var i = 0; i < t.renderList.length; i++) {
              var n = t.renderList[i];
              e.renderList.push(n.id);
            }
          return e;
        }),
        (e.Parse = function (t, i, n) {
          for (
            var r = i.getLightByID(t.lightId),
              o = n ? n(t.mapSize, r) : new e(t.mapSize, r),
              s = o.getShadowMap(),
              a = 0;
            a < t.renderList.length;
            a++
          )
            i.getMeshesByID(t.renderList[a]).forEach(function (e) {
              s && (s.renderList || (s.renderList = []), s.renderList.push(e));
            });
          return (
            void 0 !== t.id && (o.id = t.id),
            (o.forceBackFacesOnly = !!t.forceBackFacesOnly),
            void 0 !== t.darkness && o.setDarkness(t.darkness),
            t.transparencyShadow && o.setTransparencyShadow(!0),
            void 0 !== t.frustumEdgeFalloff &&
              (o.frustumEdgeFalloff = t.frustumEdgeFalloff),
            void 0 !== t.bias && (o.bias = t.bias),
            void 0 !== t.normalBias && (o.normalBias = t.normalBias),
            t.usePercentageCloserFiltering
              ? (o.usePercentageCloserFiltering = !0)
              : t.useContactHardeningShadow
                ? (o.useContactHardeningShadow = !0)
                : t.usePoissonSampling
                  ? (o.usePoissonSampling = !0)
                  : t.useExponentialShadowMap
                    ? (o.useExponentialShadowMap = !0)
                    : t.useBlurExponentialShadowMap
                      ? (o.useBlurExponentialShadowMap = !0)
                      : t.useCloseExponentialShadowMap
                        ? (o.useCloseExponentialShadowMap = !0)
                        : t.useBlurCloseExponentialShadowMap
                          ? (o.useBlurCloseExponentialShadowMap = !0)
                          : t.useVarianceShadowMap
                            ? (o.useExponentialShadowMap = !0)
                            : t.useBlurVarianceShadowMap &&
                              (o.useBlurExponentialShadowMap = !0),
            void 0 !== t.contactHardeningLightSizeUVRatio &&
              (o.contactHardeningLightSizeUVRatio =
                t.contactHardeningLightSizeUVRatio),
            void 0 !== t.filteringQuality &&
              (o.filteringQuality = t.filteringQuality),
            t.depthScale && (o.depthScale = t.depthScale),
            t.blurScale && (o.blurScale = t.blurScale),
            t.blurBoxOffset && (o.blurBoxOffset = t.blurBoxOffset),
            t.useKernelBlur && (o.useKernelBlur = t.useKernelBlur),
            t.blurKernel && (o.blurKernel = t.blurKernel),
            o
          );
        }),
        (e.CLASSNAME = "ShadowGenerator"),
        (e.FILTER_NONE = 0),
        (e.FILTER_EXPONENTIALSHADOWMAP = 1),
        (e.FILTER_POISSONSAMPLING = 2),
        (e.FILTER_BLUREXPONENTIALSHADOWMAP = 3),
        (e.FILTER_CLOSEEXPONENTIALSHADOWMAP = 4),
        (e.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP = 5),
        (e.FILTER_PCF = 6),
        (e.FILTER_PCSS = 7),
        (e.QUALITY_HIGH = 0),
        (e.QUALITY_MEDIUM = 1),
        (e.QUALITY_LOW = 2),
        (e._SceneComponentInitialization = function (e) {
          throw $.WarnImport("ShadowGeneratorSceneComponent");
        }),
        e
      );
    })();
  Ke.ShadersStore.depthPixelShader =
    "#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvarying float vDepthMetric;\n#ifdef PACKED\n#include<packingFunctions>\n#endif\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef NONLINEARDEPTH\n#ifdef PACKED\ngl_FragColor=pack(gl_FragCoord.z);\n#else\ngl_FragColor=vec4(gl_FragCoord.z,0.0,0.0,0.0);\n#endif\n#else\n#ifdef PACKED\ngl_FragColor=pack(vDepthMetric);\n#else\ngl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);\n#endif\n#endif\n}";
  Ke.ShadersStore.depthVertexShader =
    "\nattribute vec3 position;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvarying float vDepthMetric;\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}\n";
  var Qa = (function () {
    function e(t, i, n, r) {
      var o = this;
      void 0 === i && (i = 1),
        void 0 === n && (n = null),
        void 0 === r && (r = !1),
        (this.enabled = !0),
        (this.useOnlyInActiveCamera = !1),
        (this._scene = t),
        (this._storeNonLinearDepth = r),
        (this.isPacked = 0 === i),
        this.isPacked
          ? (this._clearColor = new T(1, 1, 1, 1))
          : (this._clearColor = new T(1, 0, 0, 1)),
        e._SceneComponentInitialization(this._scene),
        (this._camera = n);
      var s = t.getEngine(),
        a = this.isPacked || 1 === s.webGLVersion ? 5 : 6;
      (this._depthMap = new Dr(
        "depthMap",
        {
          width: s.getRenderWidth(),
          height: s.getRenderHeight(),
        },
        this._scene,
        !1,
        !0,
        i,
        !1,
        void 0,
        void 0,
        void 0,
        void 0,
        a
      )),
        (this._depthMap.wrapU = mn.CLAMP_ADDRESSMODE),
        (this._depthMap.wrapV = mn.CLAMP_ADDRESSMODE),
        (this._depthMap.refreshRate = 1),
        (this._depthMap.renderParticles = !1),
        (this._depthMap.renderList = null),
        (this._depthMap.activeCamera = this._camera),
        (this._depthMap.ignoreCameraViewport = !0),
        (this._depthMap.useCameraPostProcesses = !1),
        this._depthMap.onClearObservable.add(function (e) {
          e.clear(o._clearColor, !0, !0, !0);
        });
      var l = function (e) {
        var t = e.getRenderingMesh(),
          i = e.getEffectiveMesh(),
          n = o._scene,
          r = n.getEngine(),
          s = e.getMaterial();
        if (
          ((i._internalAbstractMeshDataInfo._isActiveIntermediate = !1),
          s && 0 !== e.verticesCount && e._renderId !== n.getRenderId())
        ) {
          r.setState(s.backFaceCulling, 0, !1, n.useRightHandedSystem);
          var a = t._getInstancesRenderList(e._id, !!e.getReplacementMesh());
          if (!a.mustReturn) {
            var l =
                r.getCaps().instancedArrays &&
                ((null !== a.visibleInstances[e._id] &&
                  void 0 !== a.visibleInstances[e._id]) ||
                  t.hasThinInstances),
              c = o._camera || n.activeCamera;
            if (o.isReady(e, l) && c) {
              if (
                ((e._renderId = n.getRenderId()),
                r.enableEffect(o._effect),
                t._bind(e, o._effect, s.fillMode),
                o._effect.setMatrix("viewProjection", n.getTransformMatrix()),
                o._effect.setFloat2("depthValues", c.minZ, c.minZ + c.maxZ),
                s && s.needAlphaTesting())
              ) {
                var u = s.getAlphaTestTexture();
                u &&
                  (o._effect.setTexture("diffuseSampler", u),
                  o._effect.setMatrix("diffuseMatrix", u.getTextureMatrix()));
              }
              t.useBones &&
                t.computeBonesUsingShaders &&
                t.skeleton &&
                o._effect.setMatrices(
                  "mBones",
                  t.skeleton.getTransformMatrices(t)
                ),
                Hr.BindMorphTargetParameters(t, o._effect),
                t._processRendering(
                  i,
                  e,
                  o._effect,
                  s.fillMode,
                  a,
                  l,
                  function (e, t) {
                    return o._effect.setMatrix("world", t);
                  }
                );
            }
          }
        }
      };
      this._depthMap.customRenderFunction = function (e, t, i, n) {
        var r;
        if (n.length) {
          for (s.setColorWrite(!1), r = 0; r < n.length; r++) l(n.data[r]);
          s.setColorWrite(!0);
        }
        for (r = 0; r < e.length; r++) l(e.data[r]);
        for (r = 0; r < t.length; r++) l(t.data[r]);
      };
    }
    return (
      (e.prototype.isReady = function (e, t) {
        var i = e.getMaterial();
        if (i.disableDepthWrite) return !1;
        var n = [],
          r = [wt.PositionKind],
          o = e.getMesh();
        i &&
          i.needAlphaTesting() &&
          i.getAlphaTestTexture() &&
          (n.push("#define ALPHATEST"),
          o.isVerticesDataPresent(wt.UVKind) &&
            (r.push(wt.UVKind), n.push("#define UV1")),
          o.isVerticesDataPresent(wt.UV2Kind) &&
            (r.push(wt.UV2Kind), n.push("#define UV2"))),
          o.useBones && o.computeBonesUsingShaders
            ? (r.push(wt.MatricesIndicesKind),
              r.push(wt.MatricesWeightsKind),
              o.numBoneInfluencers > 4 &&
                (r.push(wt.MatricesIndicesExtraKind),
                r.push(wt.MatricesWeightsExtraKind)),
              n.push("#define NUM_BONE_INFLUENCERS " + o.numBoneInfluencers),
              n.push(
                "#define BonesPerMesh " +
                  (o.skeleton ? o.skeleton.bones.length + 1 : 0)
              ))
            : n.push("#define NUM_BONE_INFLUENCERS 0");
        var s = o.morphTargetManager,
          a = 0;
        s &&
          s.numInfluencers > 0 &&
          ((a = s.numInfluencers),
          n.push("#define MORPHTARGETS"),
          n.push("#define NUM_MORPH_INFLUENCERS " + a),
          Hr.PrepareAttributesForMorphTargetsInfluencers(r, o, a)),
          t &&
            (n.push("#define INSTANCES"),
            Hr.PushAttributesForInstances(r),
            e.getRenderingMesh().hasThinInstances &&
              n.push("#define THIN_INSTANCES")),
          this._storeNonLinearDepth && n.push("#define NONLINEARDEPTH"),
          this.isPacked && n.push("#define PACKED");
        var l = n.join("\n");
        return (
          this._cachedDefines !== l &&
            ((this._cachedDefines = l),
            (this._effect = this._scene
              .getEngine()
              .createEffect(
                "depth",
                r,
                [
                  "world",
                  "mBones",
                  "viewProjection",
                  "diffuseMatrix",
                  "depthValues",
                  "morphTargetInfluences",
                ],
                ["diffuseSampler"],
                l,
                void 0,
                void 0,
                void 0,
                {
                  maxSimultaneousMorphTargets: a,
                }
              ))),
          this._effect.isReady()
        );
      }),
      (e.prototype.getDepthMap = function () {
        return this._depthMap;
      }),
      (e.prototype.dispose = function () {
        this._depthMap.dispose();
      }),
      (e._SceneComponentInitialization = function (e) {
        throw $.WarnImport("DepthRendererSceneComponent");
      }),
      e
    );
  })();
  Ke.ShadersStore.minmaxReduxPixelShader =
    "attribute vec2 vUV;\nuniform sampler2D textureSampler;\n#if defined(INITIAL)\nuniform sampler2D sourceTexture;\nuniform vec2 texSize;\nvoid main(void)\n{\nivec2 coord=ivec2(vUV*(texSize-1.0));\nfloat f1=texelFetch(sourceTexture,coord,0).r;\nfloat f2=texelFetch(sourceTexture,coord+ivec2(1,0),0).r;\nfloat f3=texelFetch(sourceTexture,coord+ivec2(1,1),0).r;\nfloat f4=texelFetch(sourceTexture,coord+ivec2(0,1),0).r;\nfloat minz=min(min(min(f1,f2),f3),f4);\n#ifdef DEPTH_REDUX\nfloat maxz=max(max(max(sign(1.0-f1)*f1,sign(1.0-f2)*f2),sign(1.0-f3)*f3),sign(1.0-f4)*f4);\n#else\nfloat maxz=max(max(max(f1,f2),f3),f4);\n#endif\nglFragColor=vec4(minz,maxz,0.,0.);\n}\n#elif defined(MAIN)\nuniform vec2 texSize;\nvoid main(void)\n{\nivec2 coord=ivec2(vUV*(texSize-1.0));\nvec2 f1=texelFetch(textureSampler,coord,0).rg;\nvec2 f2=texelFetch(textureSampler,coord+ivec2(1,0),0).rg;\nvec2 f3=texelFetch(textureSampler,coord+ivec2(1,1),0).rg;\nvec2 f4=texelFetch(textureSampler,coord+ivec2(0,1),0).rg;\nfloat minz=min(min(min(f1.x,f2.x),f3.x),f4.x);\nfloat maxz=max(max(max(f1.y,f2.y),f3.y),f4.y);\nglFragColor=vec4(minz,maxz,0.,0.);\n}\n#elif defined(ONEBEFORELAST)\nuniform ivec2 texSize;\nvoid main(void)\n{\nivec2 coord=ivec2(vUV*vec2(texSize-1));\nvec2 f1=texelFetch(textureSampler,coord % texSize,0).rg;\nvec2 f2=texelFetch(textureSampler,(coord+ivec2(1,0)) % texSize,0).rg;\nvec2 f3=texelFetch(textureSampler,(coord+ivec2(1,1)) % texSize,0).rg;\nvec2 f4=texelFetch(textureSampler,(coord+ivec2(0,1)) % texSize,0).rg;\nfloat minz=min(f1.x,f2.x);\nfloat maxz=max(f1.y,f2.y);\nglFragColor=vec4(minz,maxz,0.,0.);\n}\n#elif defined(LAST)\nvoid main(void)\n{\ndiscard;\nglFragColor=vec4(0.);\n}\n#endif\n";
  var qa = (function (e) {
      function t(t) {
        return e.call(this, t) || this;
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "depthRenderer", {
          get: function () {
            return this._depthRenderer;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.setDepthRenderer = function (t, i, n) {
          void 0 === t && (t = null),
            void 0 === i && (i = 2),
            void 0 === n && (n = !0);
          var r = this._camera.getScene();
          this._depthRenderer &&
            (delete r._depthRenderer[this._depthRendererId],
            this._depthRenderer.dispose(),
            (this._depthRenderer = null)),
            null === t &&
              (r._depthRenderer || (r._depthRenderer = {}),
              ((t = this._depthRenderer =
                new Qa(r, i, this._camera, !1)).enabled = !1),
              (this._depthRendererId = "minmax" + this._camera.id),
              (r._depthRenderer[this._depthRendererId] = t)),
            e.prototype.setSourceTexture.call(this, t.getDepthMap(), !0, i, n);
        }),
        (t.prototype.setSourceTexture = function (t, i, n, r) {
          void 0 === n && (n = 2),
            void 0 === r && (r = !0),
            e.prototype.setSourceTexture.call(this, t, i, n, r);
        }),
        (t.prototype.activate = function () {
          this._depthRenderer && (this._depthRenderer.enabled = !0),
            e.prototype.activate.call(this);
        }),
        (t.prototype.deactivate = function () {
          e.prototype.deactivate.call(this),
            this._depthRenderer && (this._depthRenderer.enabled = !1);
        }),
        (t.prototype.dispose = function (t) {
          if (
            (void 0 === t && (t = !0),
            e.prototype.dispose.call(this, t),
            this._depthRenderer && t)
          ) {
            var i = this._depthRenderer.getDepthMap().getScene();
            i && delete i._depthRenderer[this._depthRendererId],
              this._depthRenderer.dispose(),
              (this._depthRenderer = null);
          }
        }),
        t
      );
    })(
      (function () {
        function e(e) {
          (this.onAfterReductionPerformed = new o()),
            (this._forceFullscreenViewport = !0),
            (this._activated = !1),
            (this._camera = e),
            (this._postProcessManager = new ai(e.getScene()));
        }
        return (
          Object.defineProperty(e.prototype, "sourceTexture", {
            get: function () {
              return this._sourceTexture;
            },
            enumerable: !1,
            configurable: !0,
          }),
          (e.prototype.setSourceTexture = function (e, t, i, n) {
            var r = this;
            if (
              (void 0 === i && (i = 2),
              void 0 === n && (n = !0),
              e !== this._sourceTexture)
            ) {
              this.dispose(!1),
                (this._sourceTexture = e),
                (this._reductionSteps = []),
                (this._forceFullscreenViewport = n);
              var o = this._camera.getScene(),
                s = new vr(
                  "Initial reduction phase",
                  "minmaxRedux",
                  ["texSize"],
                  ["sourceTexture"],
                  1,
                  null,
                  1,
                  o.getEngine(),
                  !1,
                  "#define INITIAL" + (t ? "\n#define DEPTH_REDUX" : ""),
                  i,
                  void 0,
                  void 0,
                  void 0,
                  7
                );
              (s.autoClear = !1), (s.forceFullscreenViewport = n);
              var a = this._sourceTexture.getRenderWidth(),
                l = this._sourceTexture.getRenderHeight();
              (s.onApply = (function (e, t) {
                return function (i) {
                  i.setTexture("sourceTexture", r._sourceTexture),
                    i.setFloatArray2("texSize", new Float32Array([e, t]));
                };
              })(a, l)),
                this._reductionSteps.push(s);
              for (var c = 1; a > 1 || l > 1; ) {
                (a = Math.max(Math.round(a / 2), 1)),
                  (l = Math.max(Math.round(l / 2), 1));
                var u = new vr(
                  "Reduction phase " + c,
                  "minmaxRedux",
                  ["texSize"],
                  null,
                  {
                    width: a,
                    height: l,
                  },
                  null,
                  1,
                  o.getEngine(),
                  !1,
                  "#define " +
                    (1 == a && 1 == l
                      ? "LAST"
                      : 1 == a || 1 == l
                        ? "ONEBEFORELAST"
                        : "MAIN"),
                  i,
                  void 0,
                  void 0,
                  void 0,
                  7
                );
                (u.autoClear = !1),
                  (u.forceFullscreenViewport = n),
                  (u.onApply = (function (e, t) {
                    return function (i) {
                      1 == e || 1 == t
                        ? i.setIntArray2("texSize", new Int32Array([e, t]))
                        : i.setFloatArray2("texSize", new Float32Array([e, t]));
                    };
                  })(a, l)),
                  this._reductionSteps.push(u),
                  c++,
                  1 == a &&
                    1 == l &&
                    u.onAfterRenderObservable.add(
                      (function (e, t, i) {
                        var n = new Float32Array(4 * e * t),
                          s = {
                            min: 0,
                            max: 0,
                          };
                        return function () {
                          o
                            .getEngine()
                            ._readTexturePixels(i.inputTexture, e, t, -1, 0, n),
                            (s.min = n[0]),
                            (s.max = n[1]),
                            r.onAfterReductionPerformed.notifyObservers(s);
                        };
                      })(a, l, u)
                    );
              }
            }
          }),
          Object.defineProperty(e.prototype, "refreshRate", {
            get: function () {
              return this._sourceTexture ? this._sourceTexture.refreshRate : -1;
            },
            set: function (e) {
              this._sourceTexture && (this._sourceTexture.refreshRate = e);
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "activated", {
            get: function () {
              return this._activated;
            },
            enumerable: !1,
            configurable: !0,
          }),
          (e.prototype.activate = function () {
            var e = this;
            !this._onAfterUnbindObserver &&
              this._sourceTexture &&
              ((this._onAfterUnbindObserver =
                this._sourceTexture.onAfterUnbindObservable.add(function () {
                  e._reductionSteps[0].activate(e._camera),
                    e._postProcessManager.directRender(
                      e._reductionSteps,
                      e._reductionSteps[0].inputTexture,
                      e._forceFullscreenViewport
                    ),
                    e._camera
                      .getScene()
                      .getEngine()
                      .unBindFramebuffer(e._reductionSteps[0].inputTexture, !1);
                })),
              (this._activated = !0));
          }),
          (e.prototype.deactivate = function () {
            this._onAfterUnbindObserver &&
              this._sourceTexture &&
              (this._sourceTexture.onAfterUnbindObservable.remove(
                this._onAfterUnbindObserver
              ),
              (this._onAfterUnbindObserver = null),
              (this._activated = !1));
          }),
          (e.prototype.dispose = function (e) {
            if (
              (void 0 === e && (e = !0),
              e && this.onAfterReductionPerformed.clear(),
              this.deactivate(),
              this._reductionSteps)
            ) {
              for (var t = 0; t < this._reductionSteps.length; ++t)
                this._reductionSteps[t].dispose();
              this._reductionSteps = null;
            }
            this._postProcessManager && e && this._postProcessManager.dispose(),
              (this._sourceTexture = null);
          }),
          e
        );
      })()
    ),
    Za = f.Up(),
    Ja = f.Zero(),
    $a = new f(),
    el = new f(),
    tl = new g(),
    il = new g(),
    nl = (function (e) {
      function t(i, n, r) {
        var o = this;
        if (t.IsSupported)
          return (
            ((o = e.call(this, i, n, r) || this).usePercentageCloserFiltering =
              !0),
            o
          );
        F.Error("CascadedShadowMap needs WebGL 2 support.");
      }
      return (
        P(t, e),
        (t.prototype._validateFilter = function (e) {
          return e === Ka.FILTER_NONE ||
            e === Ka.FILTER_PCF ||
            e === Ka.FILTER_PCSS
            ? e
            : (console.error('Unsupported filter "' + e + '"!'),
              Ka.FILTER_NONE);
        }),
        Object.defineProperty(t.prototype, "numCascades", {
          get: function () {
            return this._numCascades;
          },
          set: function (e) {
            (e = Math.min(
              Math.max(e, t.MIN_CASCADES_COUNT),
              t.MAX_CASCADES_COUNT
            )) !== this._numCascades &&
              ((this._numCascades = e), this.recreateShadowMap());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "freezeShadowCastersBoundingInfo", {
          get: function () {
            return this._freezeShadowCastersBoundingInfo;
          },
          set: function (e) {
            this._freezeShadowCastersBoundingInfoObservable &&
              e &&
              (this._scene.onBeforeRenderObservable.remove(
                this._freezeShadowCastersBoundingInfoObservable
              ),
              (this._freezeShadowCastersBoundingInfoObservable = null)),
              this._freezeShadowCastersBoundingInfoObservable ||
                e ||
                (this._freezeShadowCastersBoundingInfoObservable =
                  this._scene.onBeforeRenderObservable.add(
                    this._computeShadowCastersBoundingInfo.bind(this)
                  )),
              (this._freezeShadowCastersBoundingInfo = e),
              e && this._computeShadowCastersBoundingInfo();
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._computeShadowCastersBoundingInfo = function () {
          if (
            (this._scbiMin.copyFromFloats(
              Number.MAX_VALUE,
              Number.MAX_VALUE,
              Number.MAX_VALUE
            ),
            this._scbiMax.copyFromFloats(
              Number.MIN_VALUE,
              Number.MIN_VALUE,
              Number.MIN_VALUE
            ),
            this._shadowMap && this._shadowMap.renderList)
          ) {
            for (var e = this._shadowMap.renderList, t = 0; t < e.length; t++)
              if ((r = e[t])) {
                var i = r.getBoundingInfo().boundingBox;
                this._scbiMin.minimizeInPlace(i.minimumWorld),
                  this._scbiMax.maximizeInPlace(i.maximumWorld);
              }
            var n = this._scene.meshes;
            for (t = 0; t < n.length; t++) {
              var r;
              (r = n[t]) &&
                r.isVisible &&
                r.isEnabled &&
                r.receiveShadows &&
                ((i = r.getBoundingInfo().boundingBox),
                this._scbiMin.minimizeInPlace(i.minimumWorld),
                this._scbiMax.maximizeInPlace(i.maximumWorld));
            }
          }
          this._shadowCastersBoundingInfo.reConstruct(
            this._scbiMin,
            this._scbiMax
          );
        }),
        Object.defineProperty(t.prototype, "shadowCastersBoundingInfo", {
          get: function () {
            return this._shadowCastersBoundingInfo;
          },
          set: function (e) {
            this._shadowCastersBoundingInfo = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.setMinMaxDistance = function (e, t) {
          (this._minDistance === e && this._maxDistance === t) ||
            (e > t && ((e = 0), (t = 1)),
            e < 0 && (e = 0),
            t > 1 && (t = 1),
            (this._minDistance = e),
            (this._maxDistance = t),
            (this._breaksAreDirty = !0));
        }),
        Object.defineProperty(t.prototype, "minDistance", {
          get: function () {
            return this._minDistance;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "maxDistance", {
          get: function () {
            return this._maxDistance;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getClassName = function () {
          return t.CLASSNAME;
        }),
        (t.prototype.getCascadeMinExtents = function (e) {
          return e >= 0 && e < this._numCascades
            ? this._cascadeMinExtents[e]
            : null;
        }),
        (t.prototype.getCascadeMaxExtents = function (e) {
          return e >= 0 && e < this._numCascades
            ? this._cascadeMaxExtents[e]
            : null;
        }),
        Object.defineProperty(t.prototype, "shadowMaxZ", {
          get: function () {
            return this._scene && this._scene.activeCamera
              ? this._shadowMaxZ
              : 0;
          },
          set: function (e) {
            this._scene && this._scene.activeCamera
              ? this._shadowMaxZ === e ||
                e < this._scene.activeCamera.minZ ||
                e > this._scene.activeCamera.maxZ ||
                ((this._shadowMaxZ = e),
                this._light._markMeshesAsLightDirty(),
                (this._breaksAreDirty = !0))
              : (this._shadowMaxZ = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "debug", {
          get: function () {
            return this._debug;
          },
          set: function (e) {
            (this._debug = e), this._light._markMeshesAsLightDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "depthClamp", {
          get: function () {
            return this._depthClamp;
          },
          set: function (e) {
            this._depthClamp = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "cascadeBlendPercentage", {
          get: function () {
            return this._cascadeBlendPercentage;
          },
          set: function (e) {
            (this._cascadeBlendPercentage = e),
              this._light._markMeshesAsLightDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "lambda", {
          get: function () {
            return this._lambda;
          },
          set: function (e) {
            var t = Math.min(Math.max(e, 0), 1);
            this._lambda != t &&
              ((this._lambda = t), (this._breaksAreDirty = !0));
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getCascadeViewMatrix = function (e) {
          return e >= 0 && e < this._numCascades ? this._viewMatrices[e] : null;
        }),
        (t.prototype.getCascadeProjectionMatrix = function (e) {
          return e >= 0 && e < this._numCascades
            ? this._projectionMatrices[e]
            : null;
        }),
        (t.prototype.getCascadeTransformMatrix = function (e) {
          return e >= 0 && e < this._numCascades
            ? this._transformMatrices[e]
            : null;
        }),
        (t.prototype.setDepthRenderer = function (e) {
          (this._depthRenderer = e),
            this._depthReducer &&
              this._depthReducer.setDepthRenderer(this._depthRenderer);
        }),
        Object.defineProperty(t.prototype, "autoCalcDepthBounds", {
          get: function () {
            return this._autoCalcDepthBounds;
          },
          set: function (e) {
            var t = this,
              i = this._scene.activeCamera;
            if (i) {
              if (((this._autoCalcDepthBounds = e), !e))
                return (
                  this._depthReducer && this._depthReducer.deactivate(),
                  void this.setMinMaxDistance(0, 1)
                );
              this._depthReducer ||
                ((this._depthReducer = new qa(i)),
                this._depthReducer.onAfterReductionPerformed.add(function (e) {
                  var i = e.min,
                    n = e.max;
                  i >= n && ((i = 0), (n = 1)),
                    (i == t._minDistance && n == t._maxDistance) ||
                      t.setMinMaxDistance(i, n);
                }),
                this._depthReducer.setDepthRenderer(this._depthRenderer)),
                this._depthReducer.activate();
            }
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "autoCalcDepthBoundsRefreshRate", {
          get: function () {
            var e, t, i;
            return null !==
              (i =
                null ===
                  (t =
                    null === (e = this._depthReducer) || void 0 === e
                      ? void 0
                      : e.depthRenderer) || void 0 === t
                  ? void 0
                  : t.getDepthMap().refreshRate) && void 0 !== i
              ? i
              : -1;
          },
          set: function (e) {
            var t;
            (null === (t = this._depthReducer) || void 0 === t
              ? void 0
              : t.depthRenderer) &&
              (this._depthReducer.depthRenderer.getDepthMap().refreshRate = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.splitFrustum = function () {
          this._breaksAreDirty = !0;
        }),
        (t.prototype._splitFrustum = function () {
          var e = this._scene.activeCamera;
          if (e) {
            for (
              var t = e.minZ,
                i = e.maxZ,
                n = i - t,
                r = this._minDistance,
                o = t + r * n,
                s =
                  t +
                  (this._shadowMaxZ < i && this._shadowMaxZ >= t
                    ? Math.min(
                        (this._shadowMaxZ - t) / (i - t),
                        this._maxDistance
                      )
                    : this._maxDistance) *
                    n,
                a = s - o,
                l = s / o,
                c = 0;
              c < this._cascades.length;
              ++c
            ) {
              var u = (c + 1) / this._numCascades,
                h = o * Math.pow(l, u),
                d = o + a * u,
                p = this._lambda * (h - d) + d;
              (this._cascades[c].prevBreakDistance =
                0 === c ? r : this._cascades[c - 1].breakDistance),
                (this._cascades[c].breakDistance = (p - t) / n),
                (this._viewSpaceFrustumsZ[c] =
                  t + this._cascades[c].breakDistance * n),
                (this._frustumLengths[c] =
                  (this._cascades[c].breakDistance -
                    this._cascades[c].prevBreakDistance) *
                  n);
            }
            this._breaksAreDirty = !1;
          }
        }),
        (t.prototype._computeMatrices = function () {
          if (this._scene.activeCamera) {
            f.NormalizeToRef(
              this._light.getShadowDirection(0),
              this._lightDirection
            ),
              1 === Math.abs(f.Dot(this._lightDirection, f.Up())) &&
                (this._lightDirection.z = 1e-13),
              this._cachedDirection.copyFrom(this._lightDirection);
            for (var e = 0; e < this._numCascades; ++e) {
              this._computeFrustumInWorldSpace(e),
                this._computeCascadeFrustum(e),
                this._cascadeMaxExtents[e].subtractToRef(
                  this._cascadeMinExtents[e],
                  $a
                ),
                this._frustumCenter[e].addToRef(
                  this._lightDirection.scale(this._cascadeMinExtents[e].z),
                  this._shadowCameraPos[e]
                ),
                g.LookAtLHToRef(
                  this._shadowCameraPos[e],
                  this._frustumCenter[e],
                  Za,
                  this._viewMatrices[e]
                );
              var t = 0,
                i = $a.z,
                n = this._shadowCastersBoundingInfo;
              n.update(this._viewMatrices[e]),
                (i = Math.min(i, n.boundingBox.maximumWorld.z)),
                (t =
                  this._depthClamp && this.filter !== Ka.FILTER_PCSS
                    ? Math.max(t, n.boundingBox.minimumWorld.z)
                    : Math.min(t, n.boundingBox.minimumWorld.z)),
                g.OrthoOffCenterLHToRef(
                  this._cascadeMinExtents[e].x,
                  this._cascadeMaxExtents[e].x,
                  this._cascadeMinExtents[e].y,
                  this._cascadeMaxExtents[e].y,
                  t,
                  i,
                  this._projectionMatrices[e]
                ),
                (this._cascadeMinExtents[e].z = t),
                (this._cascadeMaxExtents[e].z = i),
                this._viewMatrices[e].multiplyToRef(
                  this._projectionMatrices[e],
                  this._transformMatrices[e]
                ),
                f.TransformCoordinatesToRef(Ja, this._transformMatrices[e], $a),
                $a.scaleInPlace(this._mapSize / 2),
                el.copyFromFloats(
                  Math.round($a.x),
                  Math.round($a.y),
                  Math.round($a.z)
                ),
                el.subtractInPlace($a).scaleInPlace(2 / this._mapSize),
                g.TranslationToRef(el.x, el.y, 0, tl),
                this._projectionMatrices[e].multiplyToRef(
                  tl,
                  this._projectionMatrices[e]
                ),
                this._viewMatrices[e].multiplyToRef(
                  this._projectionMatrices[e],
                  this._transformMatrices[e]
                ),
                this._transformMatrices[e].copyToArray(
                  this._transformMatricesAsArray,
                  16 * e
                );
            }
          }
        }),
        (t.prototype._computeFrustumInWorldSpace = function (e) {
          if (this._scene.activeCamera) {
            var i = this._cascades[e].prevBreakDistance,
              n = this._cascades[e].breakDistance;
            this._scene.activeCamera.getViewMatrix();
            for (
              var r = g.Invert(
                  this._scene.activeCamera.getTransformationMatrix()
                ),
                o = 0;
              o < t.frustumCornersNDCSpace.length;
              ++o
            )
              f.TransformCoordinatesToRef(
                t.frustumCornersNDCSpace[o],
                r,
                this._frustumCornersWorldSpace[e][o]
              );
            for (o = 0; o < t.frustumCornersNDCSpace.length / 2; ++o)
              $a
                .copyFrom(this._frustumCornersWorldSpace[e][o + 4])
                .subtractInPlace(this._frustumCornersWorldSpace[e][o]),
                el.copyFrom($a).scaleInPlace(i),
                $a.scaleInPlace(n),
                $a.addInPlace(this._frustumCornersWorldSpace[e][o]),
                this._frustumCornersWorldSpace[e][o + 4].copyFrom($a),
                this._frustumCornersWorldSpace[e][o].addInPlace(el);
          }
        }),
        (t.prototype._computeCascadeFrustum = function (e) {
          if (
            (this._cascadeMinExtents[e].copyFromFloats(
              Number.MAX_VALUE,
              Number.MAX_VALUE,
              Number.MAX_VALUE
            ),
            this._cascadeMaxExtents[e].copyFromFloats(
              Number.MIN_VALUE,
              Number.MIN_VALUE,
              Number.MIN_VALUE
            ),
            this._frustumCenter[e].copyFromFloats(0, 0, 0),
            this._scene.activeCamera)
          ) {
            for (var t = 0; t < this._frustumCornersWorldSpace[e].length; ++t)
              this._frustumCenter[e].addInPlace(
                this._frustumCornersWorldSpace[e][t]
              );
            if (
              (this._frustumCenter[e].scaleInPlace(
                1 / this._frustumCornersWorldSpace[e].length
              ),
              this.stabilizeCascades)
            ) {
              var i = 0;
              for (t = 0; t < this._frustumCornersWorldSpace[e].length; ++t) {
                var n = this._frustumCornersWorldSpace[e][t]
                  .subtractToRef(this._frustumCenter[e], $a)
                  .length();
                i = Math.max(i, n);
              }
              (i = Math.ceil(16 * i) / 16),
                this._cascadeMaxExtents[e].copyFromFloats(i, i, i),
                this._cascadeMinExtents[e].copyFromFloats(-i, -i, -i);
            } else {
              var r = this._frustumCenter[e];
              for (
                this._frustumCenter[e].addToRef(this._lightDirection, $a),
                  g.LookAtLHToRef(r, $a, Za, tl),
                  t = 0;
                t < this._frustumCornersWorldSpace[e].length;
                ++t
              )
                f.TransformCoordinatesToRef(
                  this._frustumCornersWorldSpace[e][t],
                  tl,
                  $a
                ),
                  this._cascadeMinExtents[e].minimizeInPlace($a),
                  this._cascadeMaxExtents[e].maximizeInPlace($a);
            }
          }
        }),
        Object.defineProperty(t, "IsSupported", {
          get: function () {
            var e = j.LastCreatedEngine;
            return !!e && 1 != e.webGLVersion;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._initializeGenerator = function () {
          var i, n, r, o, s, a, l, c, u, h, d, p, _, m, g, v, y, b, T, S;
          (this.penumbraDarkness =
            null !== (i = this.penumbraDarkness) && void 0 !== i ? i : 1),
            (this._numCascades =
              null !== (n = this._numCascades) && void 0 !== n
                ? n
                : t.DEFAULT_CASCADES_COUNT),
            (this.stabilizeCascades =
              null !== (r = this.stabilizeCascades) && void 0 !== r && r),
            (this._freezeShadowCastersBoundingInfoObservable =
              null !== (o = this._freezeShadowCastersBoundingInfoObservable) &&
              void 0 !== o
                ? o
                : null),
            (this.freezeShadowCastersBoundingInfo =
              null !== (s = this.freezeShadowCastersBoundingInfo) &&
              void 0 !== s &&
              s),
            (this._scbiMin =
              null !== (a = this._scbiMin) && void 0 !== a
                ? a
                : new f(0, 0, 0)),
            (this._scbiMax =
              null !== (l = this._scbiMax) && void 0 !== l
                ? l
                : new f(0, 0, 0)),
            (this._shadowCastersBoundingInfo =
              null !== (c = this._shadowCastersBoundingInfo) && void 0 !== c
                ? c
                : new Gt(new f(0, 0, 0), new f(0, 0, 0))),
            (this._breaksAreDirty =
              null === (u = this._breaksAreDirty) || void 0 === u || u),
            (this._minDistance =
              null !== (h = this._minDistance) && void 0 !== h ? h : 0),
            (this._maxDistance =
              null !== (d = this._maxDistance) && void 0 !== d ? d : 1),
            (this._currentLayer =
              null !== (p = this._currentLayer) && void 0 !== p ? p : 0),
            (this._shadowMaxZ =
              null !==
                (g =
                  null !== (_ = this._shadowMaxZ) && void 0 !== _
                    ? _
                    : null === (m = this._scene.activeCamera) || void 0 === m
                      ? void 0
                      : m.maxZ) && void 0 !== g
                ? g
                : 1e4),
            (this._debug = null !== (v = this._debug) && void 0 !== v && v),
            (this._depthClamp =
              null === (y = this._depthClamp) || void 0 === y || y),
            (this._cascadeBlendPercentage =
              null !== (b = this._cascadeBlendPercentage) && void 0 !== b
                ? b
                : 0.1),
            (this._lambda =
              null !== (T = this._lambda) && void 0 !== T ? T : 0.5),
            (this._autoCalcDepthBounds =
              null !== (S = this._autoCalcDepthBounds) && void 0 !== S && S),
            e.prototype._initializeGenerator.call(this);
        }),
        (t.prototype._createTargetRenderTexture = function () {
          var e = {
            width: this._mapSize,
            height: this._mapSize,
            layers: this.numCascades,
          };
          (this._shadowMap = new Dr(
            this._light.name + "_shadowMap",
            e,
            this._scene,
            !1,
            !0,
            this._textureType,
            !1,
            void 0,
            !1,
            !1,
            void 0
          )),
            this._shadowMap.createDepthStencilTexture(513, !0);
        }),
        (t.prototype._initializeShadowMap = function () {
          var i = this;
          if (
            (e.prototype._initializeShadowMap.call(this),
            null !== this._shadowMap)
          ) {
            (this._transformMatricesAsArray = new Float32Array(
              16 * this._numCascades
            )),
              (this._viewSpaceFrustumsZ = new Array(this._numCascades)),
              (this._frustumLengths = new Array(this._numCascades)),
              (this._lightSizeUVCorrection = new Array(2 * this._numCascades)),
              (this._depthCorrection = new Array(this._numCascades)),
              (this._cascades = []),
              (this._viewMatrices = []),
              (this._projectionMatrices = []),
              (this._transformMatrices = []),
              (this._cascadeMinExtents = []),
              (this._cascadeMaxExtents = []),
              (this._frustumCenter = []),
              (this._shadowCameraPos = []),
              (this._frustumCornersWorldSpace = []);
            for (var n = 0; n < this._numCascades; ++n) {
              (this._cascades[n] = {
                prevBreakDistance: 0,
                breakDistance: 0,
              }),
                (this._viewMatrices[n] = g.Zero()),
                (this._projectionMatrices[n] = g.Zero()),
                (this._transformMatrices[n] = g.Zero()),
                (this._cascadeMinExtents[n] = new f()),
                (this._cascadeMaxExtents[n] = new f()),
                (this._frustumCenter[n] = new f()),
                (this._shadowCameraPos[n] = new f()),
                (this._frustumCornersWorldSpace[n] = new Array(
                  t.frustumCornersNDCSpace.length
                ));
              for (var r = 0; r < t.frustumCornersNDCSpace.length; ++r)
                this._frustumCornersWorldSpace[n][r] = new f();
            }
            this._shadowMap.onBeforeRenderObservable.add(function (e) {
              if (
                ((i._currentLayer = e), i._scene.getSceneUniformBuffer().useUbo)
              ) {
                var t = i._scene.getSceneUniformBuffer();
                t.updateMatrix(
                  "viewProjection",
                  i.getCascadeTransformMatrix(e)
                ),
                  t.updateMatrix("view", i.getCascadeViewMatrix(e)),
                  t.update();
              }
            }),
              this._shadowMap.onBeforeBindObservable.add(function () {
                i._breaksAreDirty && i._splitFrustum(), i._computeMatrices();
              }),
              this._splitFrustum();
          }
        }),
        (t.prototype._bindCustomEffectForRenderSubMeshForShadowMap = function (
          e,
          t,
          i,
          n
        ) {
          var r, o, s, a, l, c;
          t.setMatrix(
            null !== (r = null == i ? void 0 : i.viewProjection) && void 0 !== r
              ? r
              : "viewProjection",
            this.getCascadeTransformMatrix(this._currentLayer)
          ),
            t.setMatrix(
              null !== (o = null == i ? void 0 : i.view) && void 0 !== o
                ? o
                : "view",
              this.getCascadeViewMatrix(this._currentLayer)
            ),
            t.setMatrix(
              null !== (s = null == i ? void 0 : i.projection) && void 0 !== s
                ? s
                : "projection",
              this.getCascadeProjectionMatrix(this._currentLayer)
            );
          var u = n.getWorldMatrix();
          t.setMatrix(
            null !== (a = null == i ? void 0 : i.world) && void 0 !== a
              ? a
              : "world",
            u
          ),
            u.multiplyToRef(
              this.getCascadeTransformMatrix(this._currentLayer),
              tl
            ),
            t.setMatrix(
              null !== (l = null == i ? void 0 : i.worldViewProjection) &&
                void 0 !== l
                ? l
                : "worldViewProjection",
              tl
            ),
            u.multiplyToRef(this.getCascadeViewMatrix(this._currentLayer), il),
            t.setMatrix(
              null !== (c = null == i ? void 0 : i.worldView) && void 0 !== c
                ? c
                : "worldView",
              il
            );
        }),
        (t.prototype._isReadyCustomDefines = function (e, t, i) {
          e.push(
            "#define SM_DEPTHCLAMP " +
              (this._depthClamp && this._filter !== Ka.FILTER_PCSS ? "1" : "0")
          );
        }),
        (t.prototype.prepareDefines = function (t, i) {
          e.prototype.prepareDefines.call(this, t, i);
          var n = this._scene,
            r = this._light;
          if (n.shadowsEnabled && r.shadowEnabled) {
            (t["SHADOWCSM" + i] = !0),
              (t["SHADOWCSMDEBUG" + i] = this.debug),
              (t["SHADOWCSMNUM_CASCADES" + i] = this.numCascades),
              (t["SHADOWCSM_RIGHTHANDED" + i] = n.useRightHandedSystem);
            var o = n.activeCamera;
            o &&
              this._shadowMaxZ < o.maxZ &&
              (t["SHADOWCSMUSESHADOWMAXZ" + i] = !0),
              0 === this.cascadeBlendPercentage &&
                (t["SHADOWCSMNOBLEND" + i] = !0);
          }
        }),
        (t.prototype.bindShadowLight = function (e, t) {
          var i = this._light,
            n = this._scene;
          if (n.shadowsEnabled && i.shadowEnabled) {
            var r = n.activeCamera;
            if (r) {
              var o = this.getShadowMap();
              if (o) {
                var s = o.getSize().width;
                if (
                  (t.setMatrices(
                    "lightMatrix" + e,
                    this._transformMatricesAsArray
                  ),
                  t.setArray("viewFrustumZ" + e, this._viewSpaceFrustumsZ),
                  t.setFloat(
                    "cascadeBlendFactor" + e,
                    0 === this.cascadeBlendPercentage
                      ? 1e4
                      : 1 / this.cascadeBlendPercentage
                  ),
                  t.setArray("frustumLengths" + e, this._frustumLengths),
                  this._filter === Ka.FILTER_PCF)
                )
                  t.setDepthStencilTexture("shadowSampler" + e, o),
                    i._uniformBuffer.updateFloat4(
                      "shadowsInfo",
                      this.getDarkness(),
                      s,
                      1 / s,
                      this.frustumEdgeFalloff,
                      e
                    );
                else if (this._filter === Ka.FILTER_PCSS) {
                  for (var a = 0; a < this._numCascades; ++a)
                    (this._lightSizeUVCorrection[2 * a + 0] =
                      0 === a
                        ? 1
                        : (this._cascadeMaxExtents[0].x -
                            this._cascadeMinExtents[0].x) /
                          (this._cascadeMaxExtents[a].x -
                            this._cascadeMinExtents[a].x)),
                      (this._lightSizeUVCorrection[2 * a + 1] =
                        0 === a
                          ? 1
                          : (this._cascadeMaxExtents[0].y -
                              this._cascadeMinExtents[0].y) /
                            (this._cascadeMaxExtents[a].y -
                              this._cascadeMinExtents[a].y)),
                      (this._depthCorrection[a] =
                        0 === a
                          ? 1
                          : (this._cascadeMaxExtents[a].z -
                              this._cascadeMinExtents[a].z) /
                            (this._cascadeMaxExtents[0].z -
                              this._cascadeMinExtents[0].z));
                  t.setDepthStencilTexture("shadowSampler" + e, o),
                    t.setTexture("depthSampler" + e, o),
                    t.setArray2(
                      "lightSizeUVCorrection" + e,
                      this._lightSizeUVCorrection
                    ),
                    t.setArray("depthCorrection" + e, this._depthCorrection),
                    t.setFloat("penumbraDarkness" + e, this.penumbraDarkness),
                    i._uniformBuffer.updateFloat4(
                      "shadowsInfo",
                      this.getDarkness(),
                      1 / s,
                      this._contactHardeningLightSizeUVRatio * s,
                      this.frustumEdgeFalloff,
                      e
                    );
                } else
                  t.setTexture("shadowSampler" + e, o),
                    i._uniformBuffer.updateFloat4(
                      "shadowsInfo",
                      this.getDarkness(),
                      s,
                      1 / s,
                      this.frustumEdgeFalloff,
                      e
                    );
                i._uniformBuffer.updateFloat2(
                  "depthValues",
                  this.getLight().getDepthMinZ(r),
                  this.getLight().getDepthMinZ(r) +
                    this.getLight().getDepthMaxZ(r),
                  e
                );
              }
            }
          }
        }),
        (t.prototype.getTransformMatrix = function () {
          return this.getCascadeTransformMatrix(0);
        }),
        (t.prototype.dispose = function () {
          e.prototype.dispose.call(this),
            this._freezeShadowCastersBoundingInfoObservable &&
              (this._scene.onBeforeRenderObservable.remove(
                this._freezeShadowCastersBoundingInfoObservable
              ),
              (this._freezeShadowCastersBoundingInfoObservable = null)),
            this._depthReducer &&
              (this._depthReducer.dispose(), (this._depthReducer = null));
        }),
        (t.prototype.serialize = function () {
          var t = e.prototype.serialize.call(this),
            i = this.getShadowMap();
          if (!i) return t;
          if (
            ((t.numCascades = this._numCascades),
            (t.debug = this._debug),
            (t.stabilizeCascades = this.stabilizeCascades),
            (t.lambda = this._lambda),
            (t.cascadeBlendPercentage = this.cascadeBlendPercentage),
            (t.depthClamp = this._depthClamp),
            (t.autoCalcDepthBounds = this.autoCalcDepthBounds),
            (t.shadowMaxZ = this._shadowMaxZ),
            (t.penumbraDarkness = this.penumbraDarkness),
            (t.freezeShadowCastersBoundingInfo =
              this._freezeShadowCastersBoundingInfo),
            (t.minDistance = this.minDistance),
            (t.maxDistance = this.maxDistance),
            (t.renderList = []),
            i.renderList)
          )
            for (var n = 0; n < i.renderList.length; n++) {
              var r = i.renderList[n];
              t.renderList.push(r.id);
            }
          return t;
        }),
        (t.Parse = function (e, i) {
          var n = Ka.Parse(e, i, function (e, i) {
            return new t(e, i);
          });
          return (
            void 0 !== e.numCascades && (n.numCascades = e.numCascades),
            void 0 !== e.debug && (n.debug = e.debug),
            void 0 !== e.stabilizeCascades &&
              (n.stabilizeCascades = e.stabilizeCascades),
            void 0 !== e.lambda && (n.lambda = e.lambda),
            void 0 !== e.cascadeBlendPercentage &&
              (n.cascadeBlendPercentage = e.cascadeBlendPercentage),
            void 0 !== e.depthClamp && (n.depthClamp = e.depthClamp),
            void 0 !== e.autoCalcDepthBounds &&
              (n.autoCalcDepthBounds = e.autoCalcDepthBounds),
            void 0 !== e.shadowMaxZ && (n.shadowMaxZ = e.shadowMaxZ),
            void 0 !== e.penumbraDarkness &&
              (n.penumbraDarkness = e.penumbraDarkness),
            void 0 !== e.freezeShadowCastersBoundingInfo &&
              (n.freezeShadowCastersBoundingInfo =
                e.freezeShadowCastersBoundingInfo),
            void 0 !== e.minDistance &&
              void 0 !== e.maxDistance &&
              n.setMinMaxDistance(e.minDistance, e.maxDistance),
            n
          );
        }),
        (t.frustumCornersNDCSpace = [
          new f(-1, 1, -1),
          new f(1, 1, -1),
          new f(1, -1, -1),
          new f(-1, -1, -1),
          new f(-1, 1, 1),
          new f(1, 1, 1),
          new f(1, -1, 1),
          new f(-1, -1, 1),
        ]),
        (t.CLASSNAME = "CascadedShadowGenerator"),
        (t.DEFAULT_CASCADES_COUNT = 4),
        (t.MIN_CASCADES_COUNT = 2),
        (t.MAX_CASCADES_COUNT = 4),
        (t._SceneComponentInitialization = function (e) {
          throw $.WarnImport("ShadowGeneratorSceneComponent");
        }),
        t
      );
    })(Ka);
  t.AddParser(hi.NAME_SHADOWGENERATOR, function (e, t) {
    if (void 0 !== e.shadowGenerators && null !== e.shadowGenerators)
      for (var i = 0, n = e.shadowGenerators.length; i < n; i++) {
        var r = e.shadowGenerators[i];
        r.className === nl.CLASSNAME ? nl.Parse(r, t) : Ka.Parse(r, t);
      }
  });
  var rl = (function () {
    function e(e) {
      (this.name = hi.NAME_SHADOWGENERATOR), (this.scene = e);
    }
    return (
      (e.prototype.register = function () {
        this.scene._gatherRenderTargetsStage.registerStep(
          hi.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,
          this,
          this._gatherRenderTargets
        );
      }),
      (e.prototype.rebuild = function () {}),
      (e.prototype.serialize = function (e) {
        e.shadowGenerators = [];
        for (var t = 0, i = this.scene.lights; t < i.length; t++) {
          var n = i[t].getShadowGenerator();
          n && e.shadowGenerators.push(n.serialize());
        }
      }),
      (e.prototype.addFromContainer = function (e) {}),
      (e.prototype.removeFromContainer = function (e, t) {}),
      (e.prototype.dispose = function () {}),
      (e.prototype._gatherRenderTargets = function (e) {
        var t = this.scene;
        if (this.scene.shadowsEnabled)
          for (var i = 0; i < t.lights.length; i++) {
            var n = t.lights[i],
              r = n.getShadowGenerator();
            if (n.isEnabled() && n.shadowEnabled && r) {
              var o = r.getShadowMap();
              -1 !== t.textures.indexOf(o) && e.push(o);
            }
          }
      }),
      e
    );
  })();
  (Ka._SceneComponentInitialization = function (e) {
    var t = e._getComponent(hi.NAME_SHADOWGENERATOR);
    t || ((t = new rl(e)), e._addComponent(t));
  }),
    ye.AddNodeConstructor("Light_Type_0", function (e, t) {
      return function () {
        return new ol(e, f.Zero(), t);
      };
    });
  var ol = (function (e) {
      function t(t, i, n) {
        var r = e.call(this, t, n) || this;
        return (r._shadowAngle = Math.PI / 2), (r.position = i), r;
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "shadowAngle", {
          get: function () {
            return this._shadowAngle;
          },
          set: function (e) {
            (this._shadowAngle = e), this.forceProjectionMatrixCompute();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "direction", {
          get: function () {
            return this._direction;
          },
          set: function (e) {
            var t = this.needCube();
            (this._direction = e),
              this.needCube() !== t &&
                this._shadowGenerator &&
                this._shadowGenerator.recreateShadowMap();
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getClassName = function () {
          return "PointLight";
        }),
        (t.prototype.getTypeID = function () {
          return ni.LIGHTTYPEID_POINTLIGHT;
        }),
        (t.prototype.needCube = function () {
          return !this.direction;
        }),
        (t.prototype.getShadowDirection = function (t) {
          if (this.direction)
            return e.prototype.getShadowDirection.call(this, t);
          switch (t) {
            case 0:
              return new f(1, 0, 0);
            case 1:
              return new f(-1, 0, 0);
            case 2:
              return new f(0, -1, 0);
            case 3:
              return new f(0, 1, 0);
            case 4:
              return new f(0, 0, 1);
            case 5:
              return new f(0, 0, -1);
          }
          return f.Zero();
        }),
        (t.prototype._setDefaultShadowProjectionMatrix = function (e, t, i) {
          var n = this.getScene().activeCamera;
          n &&
            g.PerspectiveFovLHToRef(
              this.shadowAngle,
              1,
              this.getDepthMinZ(n),
              this.getDepthMaxZ(n),
              e
            );
        }),
        (t.prototype._buildUniformLayout = function () {
          this._uniformBuffer.addUniform("vLightData", 4),
            this._uniformBuffer.addUniform("vLightDiffuse", 4),
            this._uniformBuffer.addUniform("vLightSpecular", 4),
            this._uniformBuffer.addUniform("vLightFalloff", 4),
            this._uniformBuffer.addUniform("shadowsInfo", 3),
            this._uniformBuffer.addUniform("depthValues", 2),
            this._uniformBuffer.create();
        }),
        (t.prototype.transferToEffect = function (e, t) {
          return (
            this.computeTransformedInformation()
              ? this._uniformBuffer.updateFloat4(
                  "vLightData",
                  this.transformedPosition.x,
                  this.transformedPosition.y,
                  this.transformedPosition.z,
                  0,
                  t
                )
              : this._uniformBuffer.updateFloat4(
                  "vLightData",
                  this.position.x,
                  this.position.y,
                  this.position.z,
                  0,
                  t
                ),
            this._uniformBuffer.updateFloat4(
              "vLightFalloff",
              this.range,
              this._inverseSquaredRange,
              0,
              0,
              t
            ),
            this
          );
        }),
        (t.prototype.transferToNodeMaterialEffect = function (e, t) {
          return (
            this.computeTransformedInformation()
              ? e.setFloat3(
                  t,
                  this.transformedPosition.x,
                  this.transformedPosition.y,
                  this.transformedPosition.z
                )
              : e.setFloat3(
                  t,
                  this.position.x,
                  this.position.y,
                  this.position.z
                ),
            this
          );
        }),
        (t.prototype.prepareLightSpecificDefines = function (e, t) {
          e["POINTLIGHT" + t] = !0;
        }),
        R([se()], t.prototype, "shadowAngle", null),
        t
      );
    })(Rs),
    sl = (function () {
      function e(e, t, i) {
        var n = this;
        void 0 === t && (t = ""),
          void 0 === i && (i = "black"),
          (this._renderingCanvas = e),
          (this._loadingText = t),
          (this._loadingDivBackgroundColor = i),
          (this._resizeLoadingUI = function () {
            var e = n._renderingCanvas.getBoundingClientRect(),
              t = window.getComputedStyle(n._renderingCanvas).position;
            n._loadingDiv &&
              ((n._loadingDiv.style.position =
                "fixed" === t ? "fixed" : "absolute"),
              (n._loadingDiv.style.left = e.left + "px"),
              (n._loadingDiv.style.top = e.top + "px"),
              (n._loadingDiv.style.width = e.width + "px"),
              (n._loadingDiv.style.height = e.height + "px"));
          });
      }
      return (
        (e.prototype.displayLoadingUI = function () {
          if (!this._loadingDiv) {
            (this._loadingDiv = document.createElement("div")),
              (this._loadingDiv.id = "babylonjsLoadingDiv"),
              (this._loadingDiv.style.opacity = "0"),
              (this._loadingDiv.style.transition = "opacity 1.5s ease"),
              (this._loadingDiv.style.pointerEvents = "none"),
              (this._loadingDiv.style.display = "grid"),
              (this._loadingDiv.style.gridTemplateRows = "100%"),
              (this._loadingDiv.style.gridTemplateColumns = "100%"),
              (this._loadingDiv.style.justifyItems = "center"),
              (this._loadingDiv.style.alignItems = "center"),
              (this._loadingTextDiv = document.createElement("div")),
              (this._loadingTextDiv.style.position = "absolute"),
              (this._loadingTextDiv.style.left = "0"),
              (this._loadingTextDiv.style.top = "50%"),
              (this._loadingTextDiv.style.marginTop = "80px"),
              (this._loadingTextDiv.style.width = "100%"),
              (this._loadingTextDiv.style.height = "20px"),
              (this._loadingTextDiv.style.fontFamily = "Arial"),
              (this._loadingTextDiv.style.fontSize = "14px"),
              (this._loadingTextDiv.style.color = "white"),
              (this._loadingTextDiv.style.textAlign = "center"),
              (this._loadingTextDiv.style.zIndex = "1"),
              (this._loadingTextDiv.innerHTML = "Loading"),
              this._loadingDiv.appendChild(this._loadingTextDiv),
              (this._loadingTextDiv.innerHTML = this._loadingText);
            var t = document.createElement("style");
            (t.type = "text/css"),
              (t.innerHTML =
                "@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }"),
              document.getElementsByTagName("head")[0].appendChild(t);
            var i = !!window.SVGSVGElement,
              n = new Image();
            e.DefaultLogoUrl
              ? (n.src = e.DefaultLogoUrl)
              : (n.src = i
                  ? "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+"
                  : "https://cdn.babylonjs.com/Assets/babylonLogo.png"),
              (n.style.width = "150px"),
              (n.style.gridColumn = "1"),
              (n.style.gridRow = "1"),
              (n.style.top = "50%"),
              (n.style.left = "50%"),
              (n.style.transform = "translate(-50%, -50%)"),
              (n.style.position = "absolute");
            var r = document.createElement("div");
            (r.style.width = "300px"),
              (r.style.gridColumn = "1"),
              (r.style.gridRow = "1"),
              (r.style.top = "50%"),
              (r.style.left = "50%"),
              (r.style.transform = "translate(-50%, -50%)"),
              (r.style.position = "absolute");
            var o = new Image();
            if (
              (e.DefaultSpinnerUrl
                ? (o.src = e.DefaultSpinnerUrl)
                : (o.src = i
                    ? "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg=="
                    : "https://cdn.babylonjs.com/Assets/loadingIcon.png"),
              (o.style.animation = "spin1 0.75s infinite linear"),
              (o.style.webkitAnimation = "spin1 0.75s infinite linear"),
              (o.style.transformOrigin = "50% 50%"),
              (o.style.webkitTransformOrigin = "50% 50%"),
              !i)
            ) {
              var s = {
                  w: 16,
                  h: 18.5,
                },
                a = {
                  w: 30,
                  h: 30,
                };
              (n.style.width = s.w + "vh"),
                (n.style.height = s.h + "vh"),
                (n.style.left = "calc(50% - " + s.w / 2 + "vh)"),
                (n.style.top = "calc(50% - " + s.h / 2 + "vh)"),
                (o.style.width = a.w + "vh"),
                (o.style.height = a.h + "vh"),
                (o.style.left = "calc(50% - " + a.w / 2 + "vh)"),
                (o.style.top = "calc(50% - " + a.h / 2 + "vh)");
            }
            r.appendChild(o),
              this._loadingDiv.appendChild(n),
              this._loadingDiv.appendChild(r),
              this._resizeLoadingUI(),
              window.addEventListener("resize", this._resizeLoadingUI),
              (this._loadingDiv.style.backgroundColor =
                this._loadingDivBackgroundColor),
              document.body.appendChild(this._loadingDiv),
              (this._loadingDiv.style.opacity = "1");
          }
        }),
        (e.prototype.hideLoadingUI = function () {
          var e = this;
          this._loadingDiv &&
            ((this._loadingDiv.style.opacity = "0"),
            this._loadingDiv.addEventListener("transitionend", function () {
              e._loadingDiv &&
                (e._loadingDiv.parentElement &&
                  e._loadingDiv.parentElement.removeChild(e._loadingDiv),
                window.removeEventListener("resize", e._resizeLoadingUI),
                (e._loadingDiv = null));
            }));
        }),
        Object.defineProperty(e.prototype, "loadingUIText", {
          get: function () {
            return this._loadingText;
          },
          set: function (e) {
            (this._loadingText = e),
              this._loadingTextDiv &&
                (this._loadingTextDiv.innerHTML = this._loadingText);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "loadingUIBackgroundColor", {
          get: function () {
            return this._loadingDivBackgroundColor;
          },
          set: function (e) {
            (this._loadingDivBackgroundColor = e),
              this._loadingDiv &&
                (this._loadingDiv.style.backgroundColor =
                  this._loadingDivBackgroundColor);
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.DefaultLogoUrl = ""),
        (e.DefaultSpinnerUrl = ""),
        e
      );
    })();
  It.DefaultLoadingScreenFactory = function (e) {
    return new sl(e);
  };
  var al = (function () {
      function e() {}
      return (
        (e.ConvertPanoramaToCubemap = function (e, t, i, n) {
          if (!e) throw "ConvertPanoramaToCubemap: input cannot be null";
          if (e.length != t * i * 3)
            throw "ConvertPanoramaToCubemap: input size is wrong";
          return {
            front: this.CreateCubemapTexture(n, this.FACE_FRONT, e, t, i),
            back: this.CreateCubemapTexture(n, this.FACE_BACK, e, t, i),
            left: this.CreateCubemapTexture(n, this.FACE_LEFT, e, t, i),
            right: this.CreateCubemapTexture(n, this.FACE_RIGHT, e, t, i),
            up: this.CreateCubemapTexture(n, this.FACE_UP, e, t, i),
            down: this.CreateCubemapTexture(n, this.FACE_DOWN, e, t, i),
            size: n,
            type: 1,
            format: 4,
            gammaSpace: !1,
          };
        }),
        (e.CreateCubemapTexture = function (e, t, i, n, r) {
          for (
            var o = new ArrayBuffer(e * e * 4 * 3),
              s = new Float32Array(o),
              a = t[1].subtract(t[0]).scale(1 / e),
              l = t[3].subtract(t[2]).scale(1 / e),
              c = 1 / e,
              u = 0,
              h = 0;
            h < e;
            h++
          ) {
            for (var d = t[0], p = t[2], f = 0; f < e; f++) {
              var _ = p.subtract(d).scale(u).add(d);
              _.normalize();
              var m = this.CalcProjectionSpherical(_, i, n, r);
              (s[h * e * 3 + 3 * f + 0] = m.r),
                (s[h * e * 3 + 3 * f + 1] = m.g),
                (s[h * e * 3 + 3 * f + 2] = m.b),
                (d = d.add(a)),
                (p = p.add(l));
            }
            u += c;
          }
          return s;
        }),
        (e.CalcProjectionSpherical = function (e, t, i, n) {
          for (var r = Math.atan2(e.z, e.x), o = Math.acos(e.y); r < -Math.PI; )
            r += 2 * Math.PI;
          for (; r > Math.PI; ) r -= 2 * Math.PI;
          var s = r / Math.PI,
            a = o / Math.PI;
          s = 0.5 * s + 0.5;
          var l = Math.round(s * i);
          l < 0 ? (l = 0) : l >= i && (l = i - 1);
          var c = Math.round(a * n);
          c < 0 ? (c = 0) : c >= n && (c = n - 1);
          var u = n - c - 1;
          return {
            r: t[u * i * 3 + 3 * l + 0],
            g: t[u * i * 3 + 3 * l + 1],
            b: t[u * i * 3 + 3 * l + 2],
          };
        }),
        (e.FACE_LEFT = [
          new f(-1, -1, -1),
          new f(1, -1, -1),
          new f(-1, 1, -1),
          new f(1, 1, -1),
        ]),
        (e.FACE_RIGHT = [
          new f(1, -1, 1),
          new f(-1, -1, 1),
          new f(1, 1, 1),
          new f(-1, 1, 1),
        ]),
        (e.FACE_FRONT = [
          new f(1, -1, -1),
          new f(1, -1, 1),
          new f(1, 1, -1),
          new f(1, 1, 1),
        ]),
        (e.FACE_BACK = [
          new f(-1, -1, 1),
          new f(-1, -1, -1),
          new f(-1, 1, 1),
          new f(-1, 1, -1),
        ]),
        (e.FACE_DOWN = [
          new f(1, 1, -1),
          new f(1, 1, 1),
          new f(-1, 1, -1),
          new f(-1, 1, 1),
        ]),
        (e.FACE_UP = [
          new f(-1, -1, -1),
          new f(-1, -1, 1),
          new f(1, -1, -1),
          new f(1, -1, 1),
        ]),
        e
      );
    })(),
    ll = (function () {
      function e() {}
      return (
        (e.Ldexp = function (e, t) {
          return t > 1023
            ? e * Math.pow(2, 1023) * Math.pow(2, t - 1023)
            : t < -1074
              ? e * Math.pow(2, -1074) * Math.pow(2, t + 1074)
              : e * Math.pow(2, t);
        }),
        (e.Rgbe2float = function (e, t, i, n, r, o) {
          r > 0
            ? ((r = this.Ldexp(1, r - 136)),
              (e[o + 0] = t * r),
              (e[o + 1] = i * r),
              (e[o + 2] = n * r))
            : ((e[o + 0] = 0), (e[o + 1] = 0), (e[o + 2] = 0));
        }),
        (e.readStringLine = function (e, t) {
          for (
            var i = "", n = "", r = t;
            r < e.length - t && "\n" != (n = String.fromCharCode(e[r]));
            r++
          )
            i += n;
          return i;
        }),
        (e.RGBE_ReadHeader = function (e) {
          var t,
            i,
            n = this.readStringLine(e, 0);
          if ("#" != n[0] || "?" != n[1]) throw "Bad HDR Format.";
          var r = !1,
            o = !1,
            s = 0;
          do {
            (s += n.length + 1),
              "FORMAT=32-bit_rle_rgbe" == (n = this.readStringLine(e, s))
                ? (o = !0)
                : 0 == n.length && (r = !0);
          } while (!r);
          if (!o) throw "HDR Bad header format, unsupported FORMAT";
          (s += n.length + 1), (n = this.readStringLine(e, s));
          var a = /^\-Y (.*) \+X (.*)$/g.exec(n);
          if (!a || a.length < 3) throw "HDR Bad header format, no size";
          if (((i = parseInt(a[2])), (t = parseInt(a[1])), i < 8 || i > 32767))
            throw "HDR Bad header format, unsupported size";
          return {
            height: t,
            width: i,
            dataPosition: (s += n.length + 1),
          };
        }),
        (e.GetCubeMapTextureData = function (e, t) {
          var i = new Uint8Array(e),
            n = this.RGBE_ReadHeader(i),
            r = this.RGBE_ReadPixels(i, n);
          return al.ConvertPanoramaToCubemap(r, n.width, n.height, t);
        }),
        (e.RGBE_ReadPixels = function (e, t) {
          return this.RGBE_ReadPixels_RLE(e, t);
        }),
        (e.RGBE_ReadPixels_RLE = function (e, t) {
          for (
            var i,
              n,
              r,
              o,
              s,
              a = t.height,
              l = t.width,
              c = t.dataPosition,
              u = 0,
              h = 0,
              d = 0,
              p = new ArrayBuffer(4 * l),
              f = new Uint8Array(p),
              _ = new ArrayBuffer(t.width * t.height * 4 * 3),
              m = new Float32Array(_);
            a > 0;

          ) {
            if (
              ((i = e[c++]),
              (n = e[c++]),
              (r = e[c++]),
              (o = e[c++]),
              2 != i || 2 != n || 128 & r || t.width < 8 || t.width > 32767)
            )
              return this.RGBE_ReadPixels_NOT_RLE(e, t);
            if (((r << 8) | o) != l)
              throw "HDR Bad header format, wrong scan line width";
            for (u = 0, d = 0; d < 4; d++)
              for (h = (d + 1) * l; u < h; )
                if (((i = e[c++]), (n = e[c++]), i > 128)) {
                  if (0 == (s = i - 128) || s > h - u)
                    throw "HDR Bad Format, bad scanline data (run)";
                  for (; s-- > 0; ) f[u++] = n;
                } else {
                  if (0 == (s = i) || s > h - u)
                    throw "HDR Bad Format, bad scanline data (non-run)";
                  if (((f[u++] = n), --s > 0))
                    for (var g = 0; g < s; g++) f[u++] = e[c++];
                }
            for (d = 0; d < l; d++)
              (i = f[d]),
                (n = f[d + l]),
                (r = f[d + 2 * l]),
                (o = f[d + 3 * l]),
                this.Rgbe2float(m, i, n, r, o, (t.height - a) * l * 3 + 3 * d);
            a--;
          }
          return m;
        }),
        (e.RGBE_ReadPixels_NOT_RLE = function (e, t) {
          for (
            var i,
              n,
              r,
              o,
              s,
              a = t.height,
              l = t.width,
              c = t.dataPosition,
              u = new ArrayBuffer(t.width * t.height * 4 * 3),
              h = new Float32Array(u);
            a > 0;

          ) {
            for (s = 0; s < t.width; s++)
              (i = e[c++]),
                (n = e[c++]),
                (r = e[c++]),
                (o = e[c++]),
                this.Rgbe2float(h, i, n, r, o, (t.height - a) * l * 3 + 3 * s);
            a--;
          }
          return h;
        }),
        e
      );
    })(),
    cl = (function () {
      function e(t, i) {
        var n;
        void 0 === i && (i = e._DefaultOptions),
          (this.engine = t),
          (this._fullscreenViewport = new Kt(0, 0, 1, 1)),
          (i = A(A({}, e._DefaultOptions), i)),
          (this._vertexBuffers =
            (((n = {})[wt.PositionKind] = new wt(
              t,
              i.positions,
              wt.PositionKind,
              !1,
              !1,
              2
            )),
            n)),
          (this._indexBuffer = t.createIndexBuffer(i.indices));
      }
      return (
        (e.prototype.setViewport = function (e) {
          void 0 === e && (e = this._fullscreenViewport),
            this.engine.setViewport(e);
        }),
        (e.prototype.bindBuffers = function (e) {
          this.engine.bindBuffers(this._vertexBuffers, this._indexBuffer, e);
        }),
        (e.prototype.applyEffectWrapper = function (e) {
          (this.engine.depthCullingState.depthTest = !1),
            (this.engine.stencilState.stencilTest = !1),
            this.engine.enableEffect(e.effect),
            this.bindBuffers(e.effect),
            e.onApplyObservable.notifyObservers({});
        }),
        (e.prototype.restoreStates = function () {
          (this.engine.depthCullingState.depthTest = !0),
            (this.engine.stencilState.stencilTest = !0);
        }),
        (e.prototype.draw = function () {
          this.engine.drawElementsType(0, 0, 6);
        }),
        (e.prototype.isRenderTargetTexture = function (e) {
          return void 0 !== e.renderList;
        }),
        (e.prototype.render = function (e, t) {
          if ((void 0 === t && (t = null), e.effect.isReady())) {
            this.setViewport();
            var i =
              null === t
                ? null
                : this.isRenderTargetTexture(t)
                  ? t.getInternalTexture()
                  : t;
            i && this.engine.bindFramebuffer(i),
              this.applyEffectWrapper(e),
              this.draw(),
              i && this.engine.unBindFramebuffer(i),
              this.restoreStates();
          }
        }),
        (e.prototype.dispose = function () {
          var e = this._vertexBuffers[wt.PositionKind];
          e && (e.dispose(), delete this._vertexBuffers[wt.PositionKind]),
            this._indexBuffer && this.engine._releaseBuffer(this._indexBuffer);
        }),
        (e._DefaultOptions = {
          positions: [1, 1, -1, 1, -1, -1, 1, -1],
          indices: [0, 1, 2, 0, 2, 3],
        }),
        e
      );
    })(),
    ul = (function () {
      function e(e) {
        var t,
          i = this;
        this.onApplyObservable = new o();
        var n = e.uniformNames || [];
        e.vertexShader
          ? (t = {
              fragmentSource: e.fragmentShader,
              vertexSource: e.vertexShader,
              spectorName: e.name || "effectWrapper",
            })
          : (n.push("scale"),
            (t = {
              fragmentSource: e.fragmentShader,
              vertex: "postprocess",
              spectorName: e.name || "effectWrapper",
            }),
            this.onApplyObservable.add(function () {
              i.effect.setFloat2("scale", 1, 1);
            }));
        var r = e.defines ? e.defines.join("\n") : "";
        e.useShaderStore
          ? ((t.fragment = t.fragmentSource),
            t.vertex || (t.vertex = t.vertexSource),
            delete t.fragmentSource,
            delete t.vertexSource,
            (this.effect = e.engine.createEffect(
              t.spectorName,
              e.attributeNames || ["position"],
              n,
              e.samplerNames,
              r,
              void 0,
              e.onCompiled
            )))
          : (this.effect = new Ke(
              t,
              e.attributeNames || ["position"],
              n,
              e.samplerNames,
              e.engine,
              r,
              void 0,
              e.onCompiled
            ));
      }
      return (
        (e.prototype.dispose = function () {
          this.effect.dispose();
        }),
        e
      );
    })();
  Ke.ShadersStore.hdrFilteringVertexShader =
    "\nattribute vec2 position;\n\nvarying vec3 direction;\n\nuniform vec3 up;\nuniform vec3 right;\nuniform vec3 front;\nvoid main(void) {\nmat3 view=mat3(up,right,front);\ndirection=view*vec3(position,1.0);\ngl_Position=vec4(position,0.0,1.0);\n}";
  Ke.ShadersStore.hdrFilteringPixelShader =
    "#include<helperFunctions>\n#include<importanceSampling>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\nuniform float alphaG;\nuniform samplerCube inputTexture;\nuniform vec2 vFilteringInfo;\nuniform float hdrScale;\nvarying vec3 direction;\nvoid main() {\nvec3 color=radiance(alphaG,inputTexture,direction,vFilteringInfo);\ngl_FragColor=vec4(color*hdrScale,1.0);\n}";
  var hl = (function () {
      function e(e, t) {
        void 0 === t && (t = {}),
          (this._lodGenerationOffset = 0),
          (this._lodGenerationScale = 0.8),
          (this.quality = 4096),
          (this.hdrScale = 1),
          (this._engine = e),
          (this.hdrScale = t.hdrScale || this.hdrScale),
          (this.quality = t.hdrScale || this.quality);
      }
      return (
        (e.prototype._createRenderTarget = function (e) {
          var t = 0;
          this._engine.getCaps().textureHalfFloatRender
            ? (t = 2)
            : this._engine.getCaps().textureFloatRender && (t = 1);
          var i = this._engine.createRenderTargetCubeTexture(e, {
            format: 5,
            type: t,
            generateMipMaps: !1,
            generateDepthBuffer: !1,
            generateStencilBuffer: !1,
            samplingMode: 1,
          });
          return (
            this._engine.updateTextureWrappingMode(i, 0, 0, 0),
            this._engine.updateTextureSamplingMode(3, i, !0),
            i
          );
        }),
        (e.prototype._prefilterInternal = function (e) {
          var t = e.getSize().width,
            i = Math.round(s.Log2(t)) + 1,
            n = this._effectWrapper.effect,
            r = this._createRenderTarget(t);
          this._effectRenderer.setViewport();
          var o = e.getInternalTexture();
          o && this._engine.updateTextureSamplingMode(3, o, !0),
            this._effectRenderer.applyEffectWrapper(this._effectWrapper);
          var a = [
            [new f(0, 0, -1), new f(0, -1, 0), new f(1, 0, 0)],
            [new f(0, 0, 1), new f(0, -1, 0), new f(-1, 0, 0)],
            [new f(1, 0, 0), new f(0, 0, 1), new f(0, 1, 0)],
            [new f(1, 0, 0), new f(0, 0, -1), new f(0, -1, 0)],
            [new f(1, 0, 0), new f(0, -1, 0), new f(0, 0, 1)],
            [new f(-1, 0, 0), new f(0, -1, 0), new f(0, 0, -1)],
          ];
          n.setFloat("hdrScale", this.hdrScale),
            n.setFloat2("vFilteringInfo", e.getSize().width, i),
            n.setTexture("inputTexture", e);
          for (var l = 0; l < 6; l++) {
            n.setVector3("up", a[l][0]),
              n.setVector3("right", a[l][1]),
              n.setVector3("front", a[l][2]);
            for (var c = 0; c < i; c++) {
              this._engine.bindFramebuffer(r, l, void 0, void 0, !0, c),
                this._effectRenderer.applyEffectWrapper(this._effectWrapper);
              var u =
                Math.pow(
                  2,
                  (c - this._lodGenerationOffset) / this._lodGenerationScale
                ) / t;
              0 === c && (u = 0),
                n.setFloat("alphaG", u),
                this._effectRenderer.draw();
            }
          }
          return (
            this._effectRenderer.restoreStates(),
            this._engine.restoreDefaultFramebuffer(),
            this._engine._releaseFramebufferObjects(r),
            this._engine._releaseTexture(e._texture),
            r._swapAndDie(e._texture),
            (e._prefiltered = !0),
            e
          );
        }),
        (e.prototype._createEffect = function (e, t) {
          var i = [];
          return (
            e.gammaSpace && i.push("#define GAMMA_INPUT"),
            i.push("#define NUM_SAMPLES " + this.quality + "u"),
            new ul({
              engine: this._engine,
              name: "hdrFiltering",
              vertexShader: "hdrFiltering",
              fragmentShader: "hdrFiltering",
              samplerNames: ["inputTexture"],
              uniformNames: [
                "vSampleDirections",
                "vWeights",
                "up",
                "right",
                "front",
                "vFilteringInfo",
                "hdrScale",
                "alphaG",
              ],
              useShaderStore: !0,
              defines: i,
              onCompiled: t,
            })
          );
        }),
        (e.prototype.isReady = function (e) {
          return e.isReady() && this._effectWrapper.effect.isReady();
        }),
        (e.prototype.prefilter = function (e, t) {
          var i = this;
          if ((void 0 === t && (t = null), 1 !== this._engine.webGLVersion))
            return new Promise(function (n) {
              (i._effectRenderer = new cl(i._engine)),
                (i._effectWrapper = i._createEffect(e)),
                i._effectWrapper.effect.executeWhenCompiled(function () {
                  i._prefilterInternal(e),
                    i._effectRenderer.dispose(),
                    i._effectWrapper.dispose(),
                    n(),
                    t && t();
                });
            });
          F.Warn(
            "HDR prefiltering is not available in WebGL 1., you can use real time filtering instead."
          );
        }),
        e
      );
    })(),
    dl = (function (e) {
      function t(t, i, n, r, o, s, a, l, c) {
        var u;
        void 0 === r && (r = !1),
          void 0 === o && (o = !0),
          void 0 === s && (s = !1),
          void 0 === a && (a = !1),
          void 0 === l && (l = null),
          void 0 === c && (c = null);
        var h = e.call(this, i) || this;
        return (
          (h._generateHarmonics = !0),
          (h._onLoad = null),
          (h._onError = null),
          (h._isBlocking = !0),
          (h._rotationY = 0),
          (h.boundingBoxPosition = f.Zero()),
          t
            ? ((h._coordinatesMode = mn.CUBIC_MODE),
              (h.name = t),
              (h.url = t),
              (h.hasAlpha = !1),
              (h.isCube = !0),
              (h._textureMatrix = g.Identity()),
              (h._prefilterOnLoad = a),
              (h._onLoad = l),
              (h._onError = c),
              (h.gammaSpace = s),
              (h._noMipmap = r),
              (h._size = n),
              (h._generateHarmonics = o),
              (h._texture = h._getFromCache(t, h._noMipmap)),
              h._texture
                ? l &&
                  (h._texture.isReady
                    ? yt.SetImmediate(function () {
                        return l();
                      })
                    : h._texture.onLoadedObservable.add(l))
                : (
                      null === (u = h.getScene()) || void 0 === u
                        ? void 0
                        : u.useDelayedTextureLoading
                    )
                  ? (h.delayLoadState = 4)
                  : h.loadTexture(),
              h)
            : h
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "isBlocking", {
          get: function () {
            return this._isBlocking;
          },
          set: function (e) {
            this._isBlocking = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "rotationY", {
          get: function () {
            return this._rotationY;
          },
          set: function (e) {
            (this._rotationY = e),
              this.setReflectionTextureMatrix(g.RotationY(this._rotationY));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "boundingBoxSize", {
          get: function () {
            return this._boundingBoxSize;
          },
          set: function (e) {
            if (!this._boundingBoxSize || !this._boundingBoxSize.equals(e)) {
              this._boundingBoxSize = e;
              var t = this.getScene();
              t && t.markAllMaterialsAsDirty(1);
            }
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getClassName = function () {
          return "HDRCubeTexture";
        }),
        (t.prototype.loadTexture = function () {
          var e = this,
            i = this._getEngine();
          if (this._getEngine().webGLVersion >= 2 && this._prefilterOnLoad) {
            var n = this._onLoad,
              r = new hl(i);
            this._onLoad = function () {
              r.prefilter(e, n);
            };
          }
          this._texture = i.createRawCubeTextureFromUrl(
            this.url,
            this.getScene(),
            this._size,
            4,
            i.getCaps().textureFloat ? 1 : 0,
            this._noMipmap,
            function (n) {
              (e.lodGenerationOffset = 0), (e.lodGenerationScale = 0.8);
              var r = ll.GetCubeMapTextureData(n, e._size);
              if (e._generateHarmonics) {
                var o = ns.ConvertCubeMapToSphericalPolynomial(r);
                e.sphericalPolynomial = o;
              }
              for (var s = [], l = null, c = 0; c < 6; c++) {
                if (!i.getCaps().textureFloat) {
                  var u = new ArrayBuffer(e._size * e._size * 3);
                  l = new Uint8Array(u);
                }
                var h = r[t._facesMapping[c]];
                if (e.gammaSpace || l)
                  for (var d = 0; d < e._size * e._size; d++)
                    if (
                      (e.gammaSpace &&
                        ((h[3 * d + 0] = Math.pow(h[3 * d + 0], a)),
                        (h[3 * d + 1] = Math.pow(h[3 * d + 1], a)),
                        (h[3 * d + 2] = Math.pow(h[3 * d + 2], a))),
                      l)
                    ) {
                      var p = Math.max(255 * h[3 * d + 0], 0),
                        f = Math.max(255 * h[3 * d + 1], 0),
                        _ = Math.max(255 * h[3 * d + 2], 0),
                        m = Math.max(Math.max(p, f), _);
                      if (m > 255) {
                        var g = 255 / m;
                        (p *= g), (f *= g), (_ *= g);
                      }
                      (l[3 * d + 0] = p),
                        (l[3 * d + 1] = f),
                        (l[3 * d + 2] = _);
                    }
                l ? s.push(l) : s.push(h);
              }
              return s;
            },
            null,
            this._onLoad,
            this._onError
          );
        }),
        (t.prototype.clone = function () {
          var e = new t(
            this.url,
            this.getScene() || this._getEngine(),
            this._size,
            this._noMipmap,
            this._generateHarmonics,
            this.gammaSpace
          );
          return (
            (e.level = this.level),
            (e.wrapU = this.wrapU),
            (e.wrapV = this.wrapV),
            (e.coordinatesIndex = this.coordinatesIndex),
            (e.coordinatesMode = this.coordinatesMode),
            e
          );
        }),
        (t.prototype.delayLoad = function () {
          4 === this.delayLoadState &&
            ((this.delayLoadState = 1),
            (this._texture = this._getFromCache(this.url, this._noMipmap)),
            this._texture || this.loadTexture());
        }),
        (t.prototype.getReflectionTextureMatrix = function () {
          return this._textureMatrix;
        }),
        (t.prototype.setReflectionTextureMatrix = function (e) {
          var t,
            i = this;
          (this._textureMatrix = e),
            e.updateFlag !== this._textureMatrix.updateFlag &&
              e.isIdentity() !== this._textureMatrix.isIdentity() &&
              (null === (t = this.getScene()) ||
                void 0 === t ||
                t.markAllMaterialsAsDirty(1, function (e) {
                  return -1 !== e.getActiveTextures().indexOf(i);
                }));
        }),
        (t.Parse = function (e, i, n) {
          var r = null;
          return (
            e.name &&
              !e.isRenderTarget &&
              (((r = new t(
                n + e.name,
                i,
                e.size,
                e.noMipmap,
                e.generateHarmonics,
                e.useInGammaSpace
              )).name = e.name),
              (r.hasAlpha = e.hasAlpha),
              (r.level = e.level),
              (r.coordinatesMode = e.coordinatesMode),
              (r.isBlocking = e.isBlocking)),
            r &&
              (e.boundingBoxPosition &&
                (r.boundingBoxPosition = f.FromArray(e.boundingBoxPosition)),
              e.boundingBoxSize &&
                (r.boundingBoxSize = f.FromArray(e.boundingBoxSize)),
              e.rotationY && (r.rotationY = e.rotationY)),
            r
          );
        }),
        (t.prototype.serialize = function () {
          if (!this.name) return null;
          var e = {};
          return (
            (e.name = this.name),
            (e.hasAlpha = this.hasAlpha),
            (e.isCube = !0),
            (e.level = this.level),
            (e.size = this._size),
            (e.coordinatesMode = this.coordinatesMode),
            (e.useInGammaSpace = this.gammaSpace),
            (e.generateHarmonics = this._generateHarmonics),
            (e.customType = "BABYLON.HDRCubeTexture"),
            (e.noMipmap = this._noMipmap),
            (e.isBlocking = this._isBlocking),
            (e.rotationY = this._rotationY),
            e
          );
        }),
        (t._facesMapping = ["right", "left", "up", "down", "front", "back"]),
        t
      );
    })(fn);
  h.RegisteredTypes["BABYLON.HDRCubeTexture"] = dl;
  var pl = (function () {
      function e(e, t, i) {
        void 0 === t && (t = 0),
          void 0 === i && (i = null),
          (this.name = e),
          (this.animations = new Array()),
          (this._positions = null),
          (this._normals = null),
          (this._tangents = null),
          (this._uvs = null),
          (this._uniqueId = 0),
          (this.onInfluenceChanged = new o()),
          (this._onDataLayoutChanged = new o()),
          (this._animationPropertiesOverride = null),
          (this._scene = i || j.LastCreatedScene),
          (this.influence = t),
          this._scene && (this._uniqueId = this._scene.getUniqueId());
      }
      return (
        Object.defineProperty(e.prototype, "influence", {
          get: function () {
            return this._influence;
          },
          set: function (e) {
            if (this._influence !== e) {
              var t = this._influence;
              (this._influence = e),
                this.onInfluenceChanged.hasObservers() &&
                  this.onInfluenceChanged.notifyObservers(0 === t || 0 === e);
            }
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "animationPropertiesOverride", {
          get: function () {
            return !this._animationPropertiesOverride && this._scene
              ? this._scene.animationPropertiesOverride
              : this._animationPropertiesOverride;
          },
          set: function (e) {
            this._animationPropertiesOverride = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "uniqueId", {
          get: function () {
            return this._uniqueId;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "hasPositions", {
          get: function () {
            return !!this._positions;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "hasNormals", {
          get: function () {
            return !!this._normals;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "hasTangents", {
          get: function () {
            return !!this._tangents;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "hasUVs", {
          get: function () {
            return !!this._uvs;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.setPositions = function (e) {
          var t = this.hasPositions;
          (this._positions = e),
            t !== this.hasPositions &&
              this._onDataLayoutChanged.notifyObservers(void 0);
        }),
        (e.prototype.getPositions = function () {
          return this._positions;
        }),
        (e.prototype.setNormals = function (e) {
          var t = this.hasNormals;
          (this._normals = e),
            t !== this.hasNormals &&
              this._onDataLayoutChanged.notifyObservers(void 0);
        }),
        (e.prototype.getNormals = function () {
          return this._normals;
        }),
        (e.prototype.setTangents = function (e) {
          var t = this.hasTangents;
          (this._tangents = e),
            t !== this.hasTangents &&
              this._onDataLayoutChanged.notifyObservers(void 0);
        }),
        (e.prototype.getTangents = function () {
          return this._tangents;
        }),
        (e.prototype.setUVs = function (e) {
          var t = this.hasUVs;
          (this._uvs = e),
            t !== this.hasUVs &&
              this._onDataLayoutChanged.notifyObservers(void 0);
        }),
        (e.prototype.getUVs = function () {
          return this._uvs;
        }),
        (e.prototype.clone = function () {
          var t = this,
            i = ge.Clone(function () {
              return new e(t.name, t.influence, t._scene);
            }, this);
          return (
            (i._positions = this._positions),
            (i._normals = this._normals),
            (i._tangents = this._tangents),
            (i._uvs = this._uvs),
            i
          );
        }),
        (e.prototype.serialize = function () {
          var e = {};
          return (
            (e.name = this.name),
            (e.influence = this.influence),
            (e.positions = Array.prototype.slice.call(this.getPositions())),
            null != this.id && (e.id = this.id),
            this.hasNormals &&
              (e.normals = Array.prototype.slice.call(this.getNormals())),
            this.hasTangents &&
              (e.tangents = Array.prototype.slice.call(this.getTangents())),
            this.hasUVs && (e.uvs = Array.prototype.slice.call(this.getUVs())),
            ge.AppendSerializedAnimations(this, e),
            e
          );
        }),
        (e.prototype.getClassName = function () {
          return "MorphTarget";
        }),
        (e.Parse = function (t) {
          var i = new e(t.name, t.influence);
          if (
            (i.setPositions(t.positions),
            null != t.id && (i.id = t.id),
            t.normals && i.setNormals(t.normals),
            t.tangents && i.setTangents(t.tangents),
            t.uvs && i.setUVs(t.uvs),
            t.animations)
          )
            for (var n = 0; n < t.animations.length; n++) {
              var r = t.animations[n],
                o = h.GetClass("BABYLON.Animation");
              o && i.animations.push(o.Parse(r));
            }
          return i;
        }),
        (e.FromMesh = function (t, i, n) {
          i || (i = t.name);
          var r = new e(i, n, t.getScene());
          return (
            r.setPositions(t.getVerticesData(wt.PositionKind)),
            t.isVerticesDataPresent(wt.NormalKind) &&
              r.setNormals(t.getVerticesData(wt.NormalKind)),
            t.isVerticesDataPresent(wt.TangentKind) &&
              r.setTangents(t.getVerticesData(wt.TangentKind)),
            t.isVerticesDataPresent(wt.UVKind) &&
              r.setUVs(t.getVerticesData(wt.UVKind)),
            r
          );
        }),
        R([se()], e.prototype, "id", void 0),
        e
      );
    })(),
    fl = (function () {
      function e(e) {
        void 0 === e && (e = null),
          (this._targets = new Array()),
          (this._targetInfluenceChangedObservers = new Array()),
          (this._targetDataLayoutChangedObservers = new Array()),
          (this._activeTargets = new St(16)),
          (this._supportsNormals = !1),
          (this._supportsTangents = !1),
          (this._supportsUVs = !1),
          (this._vertexCount = 0),
          (this._uniqueId = 0),
          (this._tempInfluences = new Array()),
          (this.enableNormalMorphing = !0),
          (this.enableTangentMorphing = !0),
          (this.enableUVMorphing = !0),
          e || (e = j.LastCreatedScene),
          (this._scene = e),
          this._scene &&
            (this._scene.morphTargetManagers.push(this),
            (this._uniqueId = this._scene.getUniqueId()));
      }
      return (
        Object.defineProperty(e.prototype, "uniqueId", {
          get: function () {
            return this._uniqueId;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "vertexCount", {
          get: function () {
            return this._vertexCount;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "supportsNormals", {
          get: function () {
            return this._supportsNormals && this.enableNormalMorphing;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "supportsTangents", {
          get: function () {
            return this._supportsTangents && this.enableTangentMorphing;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "supportsUVs", {
          get: function () {
            return this._supportsUVs && this.enableUVMorphing;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "numTargets", {
          get: function () {
            return this._targets.length;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "numInfluencers", {
          get: function () {
            return this._activeTargets.length;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "influences", {
          get: function () {
            return this._influences;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.getActiveTarget = function (e) {
          return this._activeTargets.data[e];
        }),
        (e.prototype.getTarget = function (e) {
          return this._targets[e];
        }),
        (e.prototype.addTarget = function (e) {
          var t = this;
          this._targets.push(e),
            this._targetInfluenceChangedObservers.push(
              e.onInfluenceChanged.add(function (e) {
                t._syncActiveTargets(e);
              })
            ),
            this._targetDataLayoutChangedObservers.push(
              e._onDataLayoutChanged.add(function () {
                t._syncActiveTargets(!0);
              })
            ),
            this._syncActiveTargets(!0);
        }),
        (e.prototype.removeTarget = function (e) {
          var t = this._targets.indexOf(e);
          t >= 0 &&
            (this._targets.splice(t, 1),
            e.onInfluenceChanged.remove(
              this._targetInfluenceChangedObservers.splice(t, 1)[0]
            ),
            e._onDataLayoutChanged.remove(
              this._targetDataLayoutChangedObservers.splice(t, 1)[0]
            ),
            this._syncActiveTargets(!0));
        }),
        (e.prototype.clone = function () {
          for (
            var t = new e(this._scene), i = 0, n = this._targets;
            i < n.length;
            i++
          ) {
            var r = n[i];
            t.addTarget(r.clone());
          }
          return (
            (t.enableNormalMorphing = this.enableNormalMorphing),
            (t.enableTangentMorphing = this.enableTangentMorphing),
            (t.enableUVMorphing = this.enableUVMorphing),
            t
          );
        }),
        (e.prototype.serialize = function () {
          var e = {};
          (e.id = this.uniqueId), (e.targets = []);
          for (var t = 0, i = this._targets; t < i.length; t++) {
            var n = i[t];
            e.targets.push(n.serialize());
          }
          return e;
        }),
        (e.prototype._syncActiveTargets = function (e) {
          var t = 0;
          this._activeTargets.reset(),
            (this._supportsNormals = !0),
            (this._supportsTangents = !0),
            (this._supportsUVs = !0),
            (this._vertexCount = 0);
          for (var i = 0, n = this._targets; i < n.length; i++) {
            var r = n[i];
            if (0 !== r.influence) {
              this._activeTargets.push(r),
                (this._tempInfluences[t++] = r.influence),
                (this._supportsNormals = this._supportsNormals && r.hasNormals),
                (this._supportsTangents =
                  this._supportsTangents && r.hasTangents),
                (this._supportsUVs = this._supportsUVs && r.hasUVs);
              var o = r.getPositions();
              if (o) {
                var s = o.length / 3;
                if (0 === this._vertexCount) this._vertexCount = s;
                else if (this._vertexCount !== s)
                  return void F.Error(
                    "Incompatible target. Targets must all have the same vertices count."
                  );
              }
            }
          }
          (this._influences && this._influences.length === t) ||
            (this._influences = new Float32Array(t));
          for (var a = 0; a < t; a++)
            this._influences[a] = this._tempInfluences[a];
          e && this.synchronize();
        }),
        (e.prototype.synchronize = function () {
          if (this._scene)
            for (var e = 0, t = this._scene.meshes; e < t.length; e++) {
              var i = t[e];
              i.morphTargetManager === this &&
                i._syncGeometryWithMorphTargetManager();
            }
        }),
        (e.Parse = function (t, i) {
          var n = new e(i);
          n._uniqueId = t.id;
          for (var r = 0, o = t.targets; r < o.length; r++) {
            var s = o[r];
            n.addTarget(pl.Parse(s));
          }
          return n;
        }),
        e
      );
    })(),
    _l = (function () {
      function e(t, i) {
        if (
          (void 0 === i && (i = e.DefaultPluginFactory()),
          (this._physicsPlugin = i),
          (this._impostors = []),
          (this._joints = []),
          (this._subTimeStep = 0),
          !this._physicsPlugin.isSupported())
        )
          throw new Error(
            "Physics Engine " +
              this._physicsPlugin.name +
              " cannot be found. Please make sure it is included."
          );
        (t = t || new f(0, -9.807, 0)), this.setGravity(t), this.setTimeStep();
      }
      return (
        (e.DefaultPluginFactory = function () {
          throw $.WarnImport("CannonJSPlugin");
        }),
        (e.prototype.setGravity = function (e) {
          (this.gravity = e), this._physicsPlugin.setGravity(this.gravity);
        }),
        (e.prototype.setTimeStep = function (e) {
          void 0 === e && (e = 1 / 60), this._physicsPlugin.setTimeStep(e);
        }),
        (e.prototype.getTimeStep = function () {
          return this._physicsPlugin.getTimeStep();
        }),
        (e.prototype.setSubTimeStep = function (e) {
          void 0 === e && (e = 0), (this._subTimeStep = e);
        }),
        (e.prototype.getSubTimeStep = function () {
          return this._subTimeStep;
        }),
        (e.prototype.dispose = function () {
          this._impostors.forEach(function (e) {
            e.dispose();
          }),
            this._physicsPlugin.dispose();
        }),
        (e.prototype.getPhysicsPluginName = function () {
          return this._physicsPlugin.name;
        }),
        (e.prototype.addImpostor = function (e) {
          (e.uniqueId = this._impostors.push(e)),
            e.parent || this._physicsPlugin.generatePhysicsBody(e);
        }),
        (e.prototype.removeImpostor = function (e) {
          var t = this._impostors.indexOf(e);
          t > -1 &&
            this._impostors.splice(t, 1).length &&
            this.getPhysicsPlugin().removePhysicsBody(e);
        }),
        (e.prototype.addJoint = function (e, t, i) {
          var n = {
            mainImpostor: e,
            connectedImpostor: t,
            joint: i,
          };
          (i.physicsPlugin = this._physicsPlugin),
            this._joints.push(n),
            this._physicsPlugin.generateJoint(n);
        }),
        (e.prototype.removeJoint = function (e, t, i) {
          var n = this._joints.filter(function (n) {
            return (
              n.connectedImpostor === t && n.joint === i && n.mainImpostor === e
            );
          });
          n.length && this._physicsPlugin.removeJoint(n[0]);
        }),
        (e.prototype._step = function (e) {
          var t = this;
          this._impostors.forEach(function (e) {
            e.isBodyInitRequired() && t._physicsPlugin.generatePhysicsBody(e);
          }),
            e > 0.1 ? (e = 0.1) : e <= 0 && (e = 1 / 60),
            this._physicsPlugin.executeStep(e, this._impostors);
        }),
        (e.prototype.getPhysicsPlugin = function () {
          return this._physicsPlugin;
        }),
        (e.prototype.getImpostors = function () {
          return this._impostors;
        }),
        (e.prototype.getImpostorForPhysicsObject = function (e) {
          for (var t = 0; t < this._impostors.length; ++t)
            if (this._impostors[t].object === e) return this._impostors[t];
          return null;
        }),
        (e.prototype.getImpostorWithPhysicsBody = function (e) {
          for (var t = 0; t < this._impostors.length; ++t)
            if (this._impostors[t].physicsBody === e) return this._impostors[t];
          return null;
        }),
        (e.prototype.raycast = function (e, t) {
          return this._physicsPlugin.raycast(e, t);
        }),
        (e.Epsilon = 0.001),
        e
      );
    })(),
    ml = (function () {
      function e() {
        (this._hasHit = !1),
          (this._hitDistance = 0),
          (this._hitNormalWorld = f.Zero()),
          (this._hitPointWorld = f.Zero()),
          (this._rayFromWorld = f.Zero()),
          (this._rayToWorld = f.Zero());
      }
      return (
        Object.defineProperty(e.prototype, "hasHit", {
          get: function () {
            return this._hasHit;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "hitDistance", {
          get: function () {
            return this._hitDistance;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "hitNormalWorld", {
          get: function () {
            return this._hitNormalWorld;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "hitPointWorld", {
          get: function () {
            return this._hitPointWorld;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "rayFromWorld", {
          get: function () {
            return this._rayFromWorld;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "rayToWorld", {
          get: function () {
            return this._rayToWorld;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.setHitData = function (e, t) {
          (this._hasHit = !0),
            (this._hitNormalWorld = new f(e.x, e.y, e.z)),
            (this._hitPointWorld = new f(t.x, t.y, t.z));
        }),
        (e.prototype.setHitDistance = function (e) {
          this._hitDistance = e;
        }),
        (e.prototype.calculateHitDistance = function () {
          this._hitDistance = f.Distance(
            this._rayFromWorld,
            this._hitPointWorld
          );
        }),
        (e.prototype.reset = function (e, t) {
          void 0 === e && (e = f.Zero()),
            void 0 === t && (t = f.Zero()),
            (this._rayFromWorld = e),
            (this._rayToWorld = t),
            (this._hasHit = !1),
            (this._hitDistance = 0),
            (this._hitNormalWorld = f.Zero()),
            (this._hitPointWorld = f.Zero());
        }),
        e
      );
    })(),
    gl = (function () {
      function e(e, t, i) {
        void 0 === e && (e = !0),
          void 0 === t && (t = 10),
          void 0 === i && (i = CANNON),
          (this._useDeltaForWorldStep = e),
          (this.name = "CannonJSPlugin"),
          (this._physicsMaterials = new Array()),
          (this._fixedTimeStep = 1 / 60),
          (this._physicsBodysToRemoveAfterStep = new Array()),
          (this._firstFrame = !0),
          (this._minus90X = new m(
            -0.7071067811865475,
            0,
            0,
            0.7071067811865475
          )),
          (this._plus90X = new m(0.7071067811865475, 0, 0, 0.7071067811865475)),
          (this._tmpPosition = f.Zero()),
          (this._tmpDeltaPosition = f.Zero()),
          (this._tmpUnityRotation = new m()),
          (this.BJSCANNON = i),
          this.isSupported()
            ? (this._extendNamespace(),
              (this.world = new this.BJSCANNON.World()),
              (this.world.broadphase = new this.BJSCANNON.NaiveBroadphase()),
              (this.world.solver.iterations = t),
              (this._cannonRaycastResult = new this.BJSCANNON.RaycastResult()),
              (this._raycastResult = new ml()))
            : F.Error(
                "CannonJS is not available. Please make sure you included the js file."
              );
      }
      return (
        (e.prototype.setGravity = function (e) {
          var t = e;
          this.world.gravity.set(t.x, t.y, t.z);
        }),
        (e.prototype.setTimeStep = function (e) {
          this._fixedTimeStep = e;
        }),
        (e.prototype.getTimeStep = function () {
          return this._fixedTimeStep;
        }),
        (e.prototype.executeStep = function (e, t) {
          if (this._firstFrame) {
            this._firstFrame = !1;
            for (var i = 0, n = t; i < n.length; i++) {
              var r = n[i];
              r.type != Mo.HeightmapImpostor &&
                r.type !== Mo.PlaneImpostor &&
                r.beforeStep();
            }
          }
          this.world.step(this._useDeltaForWorldStep ? e : this._fixedTimeStep),
            this._removeMarkedPhysicsBodiesFromWorld();
        }),
        (e.prototype._removeMarkedPhysicsBodiesFromWorld = function () {
          var e = this;
          this._physicsBodysToRemoveAfterStep.length > 0 &&
            (this._physicsBodysToRemoveAfterStep.forEach(function (t) {
              e.world.remove(t);
            }),
            (this._physicsBodysToRemoveAfterStep = []));
        }),
        (e.prototype.applyImpulse = function (e, t, i) {
          var n = new this.BJSCANNON.Vec3(i.x, i.y, i.z),
            r = new this.BJSCANNON.Vec3(t.x, t.y, t.z);
          e.physicsBody.applyImpulse(r, n);
        }),
        (e.prototype.applyForce = function (e, t, i) {
          var n = new this.BJSCANNON.Vec3(i.x, i.y, i.z),
            r = new this.BJSCANNON.Vec3(t.x, t.y, t.z);
          e.physicsBody.applyForce(r, n);
        }),
        (e.prototype.generatePhysicsBody = function (e) {
          if ((this._removeMarkedPhysicsBodiesFromWorld(), e.parent))
            e.physicsBody && (this.removePhysicsBody(e), e.forceUpdate());
          else {
            if (e.isBodyInitRequired()) {
              var t = this._createShape(e),
                i = e.physicsBody;
              i && this.removePhysicsBody(e);
              var n = this._addMaterial(
                  "mat-" + e.uniqueId,
                  e.getParam("friction"),
                  e.getParam("restitution")
                ),
                r = {
                  mass: e.getParam("mass"),
                  material: n,
                },
                o = e.getParam("nativeOptions");
              for (var s in o) o.hasOwnProperty(s) && (r[s] = o[s]);
              (e.physicsBody = new this.BJSCANNON.Body(r)),
                e.physicsBody.addEventListener("collide", e.onCollide),
                this.world.addEventListener("preStep", e.beforeStep),
                this.world.addEventListener("postStep", e.afterStep),
                e.physicsBody.addShape(t),
                this.world.add(e.physicsBody),
                i &&
                  ["force", "torque", "velocity", "angularVelocity"].forEach(
                    function (t) {
                      var n = i[t];
                      e.physicsBody[t].set(n.x, n.y, n.z);
                    }
                  ),
                this._processChildMeshes(e);
            }
            this._updatePhysicsBodyTransformation(e);
          }
        }),
        (e.prototype._processChildMeshes = function (e) {
          var t = this,
            i = e.object.getChildMeshes ? e.object.getChildMeshes(!0) : [],
            n = e.object.rotationQuaternion;
          if (i.length) {
            var r = function (i) {
              if (n && i.rotationQuaternion) {
                var o = i.getPhysicsImpostor();
                if (o && o.parent !== e) {
                  var s = i
                      .getAbsolutePosition()
                      .subtract(i.parent.getAbsolutePosition()),
                    a = i.rotationQuaternion;
                  o.physicsBody &&
                    (t.removePhysicsBody(o), (o.physicsBody = null)),
                    (o.parent = e),
                    o.resetUpdateFlags(),
                    e.physicsBody.addShape(
                      t._createShape(o),
                      new t.BJSCANNON.Vec3(s.x, s.y, s.z),
                      new t.BJSCANNON.Quaternion(a.x, a.y, a.z, a.w)
                    ),
                    (e.physicsBody.mass += o.getParam("mass"));
                }
                n.multiplyInPlace(i.rotationQuaternion),
                  i
                    .getChildMeshes(!0)
                    .filter(function (e) {
                      return !!e.physicsImpostor;
                    })
                    .forEach(r);
              }
            };
            i.filter(function (e) {
              return !!e.physicsImpostor;
            }).forEach(r);
          }
        }),
        (e.prototype.removePhysicsBody = function (e) {
          e.physicsBody.removeEventListener("collide", e.onCollide),
            this.world.removeEventListener("preStep", e.beforeStep),
            this.world.removeEventListener("postStep", e.afterStep),
            -1 === this._physicsBodysToRemoveAfterStep.indexOf(e.physicsBody) &&
              this._physicsBodysToRemoveAfterStep.push(e.physicsBody);
        }),
        (e.prototype.generateJoint = function (e) {
          var t = e.mainImpostor.physicsBody,
            i = e.connectedImpostor.physicsBody;
          if (t && i) {
            var n,
              r = e.joint.jointData,
              o = {
                pivotA: r.mainPivot
                  ? new this.BJSCANNON.Vec3().set(
                      r.mainPivot.x,
                      r.mainPivot.y,
                      r.mainPivot.z
                    )
                  : null,
                pivotB: r.connectedPivot
                  ? new this.BJSCANNON.Vec3().set(
                      r.connectedPivot.x,
                      r.connectedPivot.y,
                      r.connectedPivot.z
                    )
                  : null,
                axisA: r.mainAxis
                  ? new this.BJSCANNON.Vec3().set(
                      r.mainAxis.x,
                      r.mainAxis.y,
                      r.mainAxis.z
                    )
                  : null,
                axisB: r.connectedAxis
                  ? new this.BJSCANNON.Vec3().set(
                      r.connectedAxis.x,
                      r.connectedAxis.y,
                      r.connectedAxis.z
                    )
                  : null,
                maxForce: r.nativeParams.maxForce,
                collideConnected: !!r.collision,
              };
            switch (e.joint.type) {
              case Ao.HingeJoint:
              case Ao.Hinge2Joint:
                n = new this.BJSCANNON.HingeConstraint(t, i, o);
                break;
              case Ao.DistanceJoint:
                n = new this.BJSCANNON.DistanceConstraint(
                  t,
                  i,
                  r.maxDistance || 2
                );
                break;
              case Ao.SpringJoint:
                var s = r;
                n = new this.BJSCANNON.Spring(t, i, {
                  restLength: s.length,
                  stiffness: s.stiffness,
                  damping: s.damping,
                  localAnchorA: o.pivotA,
                  localAnchorB: o.pivotB,
                });
                break;
              case Ao.LockJoint:
                n = new this.BJSCANNON.LockConstraint(t, i, o);
                break;
              case Ao.PointToPointJoint:
              case Ao.BallAndSocketJoint:
              default:
                n = new this.BJSCANNON.PointToPointConstraint(
                  t,
                  o.pivotA,
                  i,
                  o.pivotB,
                  o.maxForce
                );
            }
            (n.collideConnected = !!r.collision),
              (e.joint.physicsJoint = n),
              e.joint.type !== Ao.SpringJoint
                ? this.world.addConstraint(n)
                : ((e.joint.jointData.forceApplicationCallback =
                    e.joint.jointData.forceApplicationCallback ||
                    function () {
                      n.applyForce();
                    }),
                  e.mainImpostor.registerAfterPhysicsStep(
                    e.joint.jointData.forceApplicationCallback
                  ));
          }
        }),
        (e.prototype.removeJoint = function (e) {
          e.joint.type !== Ao.SpringJoint
            ? this.world.removeConstraint(e.joint.physicsJoint)
            : e.mainImpostor.unregisterAfterPhysicsStep(
                e.joint.jointData.forceApplicationCallback
              );
        }),
        (e.prototype._addMaterial = function (e, t, i) {
          var n, r;
          for (n = 0; n < this._physicsMaterials.length; n++)
            if (
              (r = this._physicsMaterials[n]).friction === t &&
              r.restitution === i
            )
              return r;
          var o = new this.BJSCANNON.Material(e);
          return (
            (o.friction = t),
            (o.restitution = i),
            this._physicsMaterials.push(o),
            o
          );
        }),
        (e.prototype._checkWithEpsilon = function (e) {
          return e < _l.Epsilon ? _l.Epsilon : e;
        }),
        (e.prototype._createShape = function (e) {
          var t,
            i = e.object,
            n = e.getObjectExtendSize();
          switch (e.type) {
            case Mo.SphereImpostor:
              var r = n.x,
                o = n.y,
                s = n.z;
              t = new this.BJSCANNON.Sphere(
                Math.max(
                  this._checkWithEpsilon(r),
                  this._checkWithEpsilon(o),
                  this._checkWithEpsilon(s)
                ) / 2
              );
              break;
            case Mo.CylinderImpostor:
              var a = e.getParam("nativeOptions");
              a || (a = {});
              var l =
                  void 0 !== a.radiusTop
                    ? a.radiusTop
                    : this._checkWithEpsilon(n.x) / 2,
                c =
                  void 0 !== a.radiusBottom
                    ? a.radiusBottom
                    : this._checkWithEpsilon(n.x) / 2,
                u =
                  void 0 !== a.height ? a.height : this._checkWithEpsilon(n.y),
                h = void 0 !== a.numSegments ? a.numSegments : 16;
              t = new this.BJSCANNON.Cylinder(l, c, u, h);
              var d = new this.BJSCANNON.Quaternion();
              d.setFromAxisAngle(
                new this.BJSCANNON.Vec3(1, 0, 0),
                -Math.PI / 2
              );
              var p = new this.BJSCANNON.Vec3(0, 0, 0);
              t.transformAllPoints(p, d);
              break;
            case Mo.BoxImpostor:
              var _ = n.scale(0.5);
              t = new this.BJSCANNON.Box(
                new this.BJSCANNON.Vec3(
                  this._checkWithEpsilon(_.x),
                  this._checkWithEpsilon(_.y),
                  this._checkWithEpsilon(_.z)
                )
              );
              break;
            case Mo.PlaneImpostor:
              F.Warn(
                "Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"
              ),
                (t = new this.BJSCANNON.Plane());
              break;
            case Mo.MeshImpostor:
              var m = i.getVerticesData
                  ? i.getVerticesData(wt.PositionKind)
                  : [],
                g = i.getIndices ? i.getIndices() : [];
              if (!m) return;
              var v = i.position.clone(),
                y = i.rotation && i.rotation.clone(),
                b = i.rotationQuaternion && i.rotationQuaternion.clone();
              i.position.copyFromFloats(0, 0, 0),
                i.rotation && i.rotation.copyFromFloats(0, 0, 0),
                i.rotationQuaternion &&
                  i.rotationQuaternion.copyFrom(e.getParentsRotation()),
                i.rotationQuaternion &&
                  i.parent &&
                  i.rotationQuaternion.conjugateInPlace();
              var T,
                S = i.computeWorldMatrix(!0),
                C = new Array();
              for (T = 0; T < m.length; T += 3)
                f.TransformCoordinates(f.FromArray(m, T), S).toArray(C, T);
              F.Warn("MeshImpostor only collides against spheres."),
                (t = new this.BJSCANNON.Trimesh(C, g)),
                i.position.copyFrom(v),
                y && i.rotation && i.rotation.copyFrom(y),
                b && i.rotationQuaternion && i.rotationQuaternion.copyFrom(b);
              break;
            case Mo.HeightmapImpostor:
              var x = i.position.clone(),
                E = i.rotation && i.rotation.clone(),
                P = i.rotationQuaternion && i.rotationQuaternion.clone();
              i.position.copyFromFloats(0, 0, 0),
                i.rotation && i.rotation.copyFromFloats(0, 0, 0),
                i.rotationQuaternion &&
                  i.rotationQuaternion.copyFrom(e.getParentsRotation()),
                i.rotationQuaternion &&
                  i.parent &&
                  i.rotationQuaternion.conjugateInPlace(),
                i.rotationQuaternion &&
                  i.rotationQuaternion.multiplyInPlace(this._minus90X),
                (t = this._createHeightmap(i)),
                i.position.copyFrom(x),
                E && i.rotation && i.rotation.copyFrom(E),
                P && i.rotationQuaternion && i.rotationQuaternion.copyFrom(P),
                i.computeWorldMatrix(!0);
              break;
            case Mo.ParticleImpostor:
              t = new this.BJSCANNON.Particle();
              break;
            case Mo.NoImpostor:
              t = new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0, 0, 0));
          }
          return t;
        }),
        (e.prototype._createHeightmap = function (e, t) {
          var i,
            n = e.getVerticesData(wt.PositionKind),
            r = e.computeWorldMatrix(!0),
            o = new Array();
          for (i = 0; i < n.length; i += 3)
            f.TransformCoordinates(f.FromArray(n, i), r).toArray(o, i);
          n = o;
          for (
            var s = new Array(),
              a = t || ~~(Math.sqrt(n.length / 3) - 1),
              l = e.getBoundingInfo(),
              c = Math.min(
                l.boundingBox.extendSizeWorld.x,
                l.boundingBox.extendSizeWorld.y
              ),
              u = l.boundingBox.extendSizeWorld.z,
              h = (2 * c) / a,
              d = 0;
            d < n.length;
            d += 3
          ) {
            var p = Math.round(n[d + 0] / h + a / 2),
              _ = Math.round(-1 * (n[d + 1] / h - a / 2)),
              m = -n[d + 2] + u;
            s[p] || (s[p] = []),
              s[p][_] || (s[p][_] = m),
              (s[p][_] = Math.max(m, s[p][_]));
          }
          for (p = 0; p <= a; ++p) {
            if (!s[p]) {
              for (var g = 1; !s[(p + g) % a]; ) g++;
              s[p] = s[(p + g) % a].slice();
            }
            for (_ = 0; _ <= a; ++_)
              if (!s[p][_]) {
                var v;
                for (g = 1; void 0 === v; ) v = s[p][(_ + g++) % a];
                s[p][_] = v;
              }
          }
          var y = new this.BJSCANNON.Heightfield(s, {
            elementSize: h,
          });
          return (y.minY = u), y;
        }),
        (e.prototype._updatePhysicsBodyTransformation = function (e) {
          var t = e.object;
          if (
            (t.computeWorldMatrix && t.computeWorldMatrix(!0),
            t.getBoundingInfo())
          ) {
            var i = e.getObjectCenter();
            this._tmpDeltaPosition.copyFrom(
              t.getAbsolutePivotPoint().subtract(i)
            ),
              this._tmpDeltaPosition.divideInPlace(e.object.scaling),
              this._tmpPosition.copyFrom(i);
            var n = t.rotationQuaternion;
            if (n) {
              if (
                ((e.type !== Mo.PlaneImpostor &&
                  e.type !== Mo.HeightmapImpostor) ||
                  ((n = n.multiply(this._minus90X)),
                  e.setDeltaRotation(this._plus90X)),
                e.type === Mo.HeightmapImpostor)
              ) {
                var r = t,
                  o = r.getBoundingInfo(),
                  s = r.rotationQuaternion;
                (r.rotationQuaternion = this._tmpUnityRotation),
                  r.computeWorldMatrix(!0);
                var a = i.clone(),
                  l = r.getPivotMatrix();
                l = l ? l.clone() : g.Identity();
                var c = g.Translation(
                  o.boundingBox.extendSizeWorld.x,
                  0,
                  -o.boundingBox.extendSizeWorld.z
                );
                r.setPreTransformMatrix(c), r.computeWorldMatrix(!0);
                var u = o.boundingBox.centerWorld
                  .subtract(i)
                  .subtract(r.position)
                  .negate();
                this._tmpPosition.copyFromFloats(
                  u.x,
                  u.y - o.boundingBox.extendSizeWorld.y,
                  u.z
                ),
                  this._tmpDeltaPosition.copyFrom(
                    o.boundingBox.centerWorld.subtract(a)
                  ),
                  (this._tmpDeltaPosition.y += o.boundingBox.extendSizeWorld.y),
                  (r.rotationQuaternion = s),
                  r.setPreTransformMatrix(l),
                  r.computeWorldMatrix(!0);
              } else
                e.type === Mo.MeshImpostor &&
                  this._tmpDeltaPosition.copyFromFloats(0, 0, 0);
              e.setDeltaPosition(this._tmpDeltaPosition),
                e.physicsBody.position.set(
                  this._tmpPosition.x,
                  this._tmpPosition.y,
                  this._tmpPosition.z
                ),
                e.physicsBody.quaternion.set(n.x, n.y, n.z, n.w);
            }
          }
        }),
        (e.prototype.setTransformationFromPhysicsBody = function (e) {
          if (
            (e.object.position.set(
              e.physicsBody.position.x,
              e.physicsBody.position.y,
              e.physicsBody.position.z
            ),
            e.object.rotationQuaternion)
          ) {
            var t = e.physicsBody.quaternion;
            e.object.rotationQuaternion.set(t.x, t.y, t.z, t.w);
          }
        }),
        (e.prototype.setPhysicsBodyTransformation = function (e, t, i) {
          e.physicsBody.position.set(t.x, t.y, t.z),
            e.physicsBody.quaternion.set(i.x, i.y, i.z, i.w);
        }),
        (e.prototype.isSupported = function () {
          return void 0 !== this.BJSCANNON;
        }),
        (e.prototype.setLinearVelocity = function (e, t) {
          e.physicsBody.velocity.set(t.x, t.y, t.z);
        }),
        (e.prototype.setAngularVelocity = function (e, t) {
          e.physicsBody.angularVelocity.set(t.x, t.y, t.z);
        }),
        (e.prototype.getLinearVelocity = function (e) {
          var t = e.physicsBody.velocity;
          return t ? new f(t.x, t.y, t.z) : null;
        }),
        (e.prototype.getAngularVelocity = function (e) {
          var t = e.physicsBody.angularVelocity;
          return t ? new f(t.x, t.y, t.z) : null;
        }),
        (e.prototype.setBodyMass = function (e, t) {
          (e.physicsBody.mass = t), e.physicsBody.updateMassProperties();
        }),
        (e.prototype.getBodyMass = function (e) {
          return e.physicsBody.mass;
        }),
        (e.prototype.getBodyFriction = function (e) {
          return e.physicsBody.material.friction;
        }),
        (e.prototype.setBodyFriction = function (e, t) {
          e.physicsBody.material.friction = t;
        }),
        (e.prototype.getBodyRestitution = function (e) {
          return e.physicsBody.material.restitution;
        }),
        (e.prototype.setBodyRestitution = function (e, t) {
          e.physicsBody.material.restitution = t;
        }),
        (e.prototype.sleepBody = function (e) {
          e.physicsBody.sleep();
        }),
        (e.prototype.wakeUpBody = function (e) {
          e.physicsBody.wakeUp();
        }),
        (e.prototype.updateDistanceJoint = function (e, t) {
          e.physicsJoint.distance = t;
        }),
        (e.prototype.setMotor = function (e, t, i, n) {
          n ||
            (e.physicsJoint.enableMotor(),
            e.physicsJoint.setMotorSpeed(t),
            i && this.setLimit(e, i));
        }),
        (e.prototype.setLimit = function (e, t, i) {
          (e.physicsJoint.motorEquation.maxForce = t),
            (e.physicsJoint.motorEquation.minForce = void 0 === i ? -t : i);
        }),
        (e.prototype.syncMeshWithImpostor = function (e, t) {
          var i = t.physicsBody;
          (e.position.x = i.position.x),
            (e.position.y = i.position.y),
            (e.position.z = i.position.z),
            e.rotationQuaternion &&
              ((e.rotationQuaternion.x = i.quaternion.x),
              (e.rotationQuaternion.y = i.quaternion.y),
              (e.rotationQuaternion.z = i.quaternion.z),
              (e.rotationQuaternion.w = i.quaternion.w));
        }),
        (e.prototype.getRadius = function (e) {
          return e.physicsBody.shapes[0].boundingSphereRadius;
        }),
        (e.prototype.getBoxSizeToRef = function (e, t) {
          var i = e.physicsBody.shapes[0];
          (t.x = 2 * i.halfExtents.x),
            (t.y = 2 * i.halfExtents.y),
            (t.z = 2 * i.halfExtents.z);
        }),
        (e.prototype.dispose = function () {}),
        (e.prototype._extendNamespace = function () {
          var e = new this.BJSCANNON.Vec3(),
            t = this.BJSCANNON;
          this.BJSCANNON.World.prototype.step = function (i, n, r) {
            if (((r = r || 10), 0 === (n = n || 0)))
              this.internalStep(i), (this.time += i);
            else {
              var o =
                Math.floor((this.time + n) / i) - Math.floor(this.time / i);
              o = Math.min(o, r) || 1;
              for (
                var s = performance.now(), a = 0;
                a !== o &&
                (this.internalStep(i), !(performance.now() - s > 1e3 * i));
                a++
              );
              this.time += n;
              for (
                var l = (this.time % i) / i, c = e, u = this.bodies, h = 0;
                h !== u.length;
                h++
              ) {
                var d = u[h];
                d.type !== t.Body.STATIC && d.sleepState !== t.Body.SLEEPING
                  ? (d.position.vsub(d.previousPosition, c),
                    c.scale(l, c),
                    d.position.vadd(c, d.interpolatedPosition))
                  : (d.interpolatedPosition.set(
                      d.position.x,
                      d.position.y,
                      d.position.z
                    ),
                    d.interpolatedQuaternion.set(
                      d.quaternion.x,
                      d.quaternion.y,
                      d.quaternion.z,
                      d.quaternion.w
                    ));
              }
            }
          };
        }),
        (e.prototype.raycast = function (e, t) {
          return (
            this._cannonRaycastResult.reset(),
            this.world.raycastClosest(e, t, {}, this._cannonRaycastResult),
            this._raycastResult.reset(e, t),
            this._cannonRaycastResult.hasHit &&
              (this._raycastResult.setHitData(
                {
                  x: this._cannonRaycastResult.hitNormalWorld.x,
                  y: this._cannonRaycastResult.hitNormalWorld.y,
                  z: this._cannonRaycastResult.hitNormalWorld.z,
                },
                {
                  x: this._cannonRaycastResult.hitPointWorld.x,
                  y: this._cannonRaycastResult.hitPointWorld.y,
                  z: this._cannonRaycastResult.hitPointWorld.z,
                }
              ),
              this._raycastResult.setHitDistance(
                this._cannonRaycastResult.distance
              )),
            this._raycastResult
          );
        }),
        e
      );
    })();
  _l.DefaultPluginFactory = function () {
    return new gl();
  };
  var vl = (function () {
      function e(e, t, i) {
        void 0 === e && (e = !0),
          void 0 === i && (i = OIMO),
          (this._useDeltaForWorldStep = e),
          (this.name = "OimoJSPlugin"),
          (this._fixedTimeStep = 1 / 60),
          (this._tmpImpostorsArray = []),
          (this._tmpPositionVector = f.Zero()),
          (this.BJSOIMO = i),
          (this.world = new this.BJSOIMO.World({
            iterations: t,
          })),
          this.world.clear(),
          (this._raycastResult = new ml());
      }
      return (
        (e.prototype.setGravity = function (e) {
          this.world.gravity.set(e.x, e.y, e.z);
        }),
        (e.prototype.setTimeStep = function (e) {
          this.world.timeStep = e;
        }),
        (e.prototype.getTimeStep = function () {
          return this.world.timeStep;
        }),
        (e.prototype.executeStep = function (e, t) {
          var i = this;
          t.forEach(function (e) {
            e.beforeStep();
          }),
            (this.world.timeStep = this._useDeltaForWorldStep
              ? e
              : this._fixedTimeStep),
            this.world.step(),
            t.forEach(function (e) {
              e.afterStep(), (i._tmpImpostorsArray[e.uniqueId] = e);
            });
          for (var n = this.world.contacts; null !== n; )
            if (!n.touching || n.body1.sleeping || n.body2.sleeping) {
              var r = this._tmpImpostorsArray[+n.body1.name],
                o = this._tmpImpostorsArray[+n.body2.name];
              r && o
                ? (r.onCollide({
                    body: o.physicsBody,
                    point: null,
                  }),
                  o.onCollide({
                    body: r.physicsBody,
                    point: null,
                  }),
                  (n = n.next))
                : (n = n.next);
            } else n = n.next;
        }),
        (e.prototype.applyImpulse = function (e, t, i) {
          var n = e.physicsBody.mass;
          e.physicsBody.applyImpulse(
            i.scale(this.world.invScale),
            t.scale(this.world.invScale * n)
          );
        }),
        (e.prototype.applyForce = function (e, t, i) {
          F.Warn("Oimo doesn't support applying force. Using impule instead."),
            this.applyImpulse(e, t, i);
        }),
        (e.prototype.generatePhysicsBody = function (e) {
          var t = this;
          if (e.parent)
            e.physicsBody && (this.removePhysicsBody(e), e.forceUpdate());
          else {
            if (e.isBodyInitRequired()) {
              var i = {
                  name: e.uniqueId,
                  config: [
                    e.getParam("mass") || 0.001,
                    e.getParam("friction"),
                    e.getParam("restitution"),
                  ],
                  size: [],
                  type: [],
                  pos: [],
                  posShape: [],
                  rot: [],
                  rotShape: [],
                  move: 0 !== e.getParam("mass"),
                  density: e.getParam("mass"),
                  friction: e.getParam("friction"),
                  restitution: e.getParam("restitution"),
                  world: this.world,
                },
                n = [e];
              (s = e.object).getChildMeshes &&
                s.getChildMeshes().forEach(function (e) {
                  e.physicsImpostor && n.push(e.physicsImpostor);
                });
              var r = function (e) {
                  return Math.max(e, _l.Epsilon);
                },
                o = new m();
              n.forEach(function (n) {
                if (n.object.rotationQuaternion) {
                  var s = n.object.rotationQuaternion;
                  o.copyFrom(s),
                    n.object.rotationQuaternion.set(0, 0, 0, 1),
                    n.object.computeWorldMatrix(!0);
                  var a = o.toEulerAngles(),
                    l = n.getObjectExtendSize(),
                    c = 57.29577951308232;
                  if (n === e) {
                    var u = e.getObjectCenter();
                    e.object
                      .getAbsolutePivotPoint()
                      .subtractToRef(u, t._tmpPositionVector),
                      t._tmpPositionVector.divideInPlace(e.object.scaling),
                      i.pos.push(u.x),
                      i.pos.push(u.y),
                      i.pos.push(u.z),
                      i.posShape.push(0, 0, 0),
                      i.rotShape.push(0, 0, 0);
                  } else {
                    var h = n.object.position.clone();
                    i.posShape.push(h.x),
                      i.posShape.push(h.y),
                      i.posShape.push(h.z),
                      i.rotShape.push(a.x * c, a.y * c, a.z * c);
                  }
                  switch ((n.object.rotationQuaternion.copyFrom(o), n.type)) {
                    case Mo.ParticleImpostor:
                      F.Warn(
                        "No Particle support in OIMO.js. using SphereImpostor instead"
                      );
                    case Mo.SphereImpostor:
                      var d = l.x,
                        p = l.y,
                        f = l.z,
                        _ = Math.max(r(d), r(p), r(f)) / 2;
                      i.type.push("sphere"),
                        i.size.push(_),
                        i.size.push(_),
                        i.size.push(_);
                      break;
                    case Mo.CylinderImpostor:
                      var m = r(l.x) / 2,
                        g = r(l.y);
                      i.type.push("cylinder"),
                        i.size.push(m),
                        i.size.push(g),
                        i.size.push(g);
                      break;
                    case Mo.PlaneImpostor:
                    case Mo.BoxImpostor:
                    default:
                      (m = r(l.x)), (g = r(l.y));
                      var v = r(l.z);
                      i.type.push("box"),
                        i.size.push(m),
                        i.size.push(g),
                        i.size.push(v);
                  }
                  n.object.rotationQuaternion = s;
                }
              }),
                (e.physicsBody = this.world.add(i)),
                e.physicsBody.resetQuaternion(o),
                e.physicsBody.updatePosition(0);
            } else this._tmpPositionVector.copyFromFloats(0, 0, 0);
            var s;
            e.setDeltaPosition(this._tmpPositionVector);
          }
        }),
        (e.prototype.removePhysicsBody = function (e) {
          this.world.removeRigidBody(e.physicsBody);
        }),
        (e.prototype.generateJoint = function (e) {
          var t = e.mainImpostor.physicsBody,
            i = e.connectedImpostor.physicsBody;
          if (t && i) {
            var n,
              r = e.joint.jointData,
              o = r.nativeParams || {},
              s = {
                body1: t,
                body2: i,
                axe1: o.axe1 || (r.mainAxis ? r.mainAxis.asArray() : null),
                axe2:
                  o.axe2 ||
                  (r.connectedAxis ? r.connectedAxis.asArray() : null),
                pos1: o.pos1 || (r.mainPivot ? r.mainPivot.asArray() : null),
                pos2:
                  o.pos2 ||
                  (r.connectedPivot ? r.connectedPivot.asArray() : null),
                min: o.min,
                max: o.max,
                collision: o.collision || r.collision,
                spring: o.spring,
                world: this.world,
              };
            switch (e.joint.type) {
              case Ao.BallAndSocketJoint:
                n = "jointBall";
                break;
              case Ao.SpringJoint:
                F.Warn(
                  "OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead"
                );
                var a = r;
                (s.min = a.length || s.min), (s.max = Math.max(s.min, s.max));
              case Ao.DistanceJoint:
                (n = "jointDistance"), (s.max = r.maxDistance);
                break;
              case Ao.PrismaticJoint:
                n = "jointPrisme";
                break;
              case Ao.SliderJoint:
                n = "jointSlide";
                break;
              case Ao.WheelJoint:
                n = "jointWheel";
                break;
              case Ao.HingeJoint:
              default:
                n = "jointHinge";
            }
            (s.type = n), (e.joint.physicsJoint = this.world.add(s));
          }
        }),
        (e.prototype.removeJoint = function (e) {
          try {
            this.world.removeJoint(e.joint.physicsJoint);
          } catch (e) {
            F.Warn(e);
          }
        }),
        (e.prototype.isSupported = function () {
          return void 0 !== this.BJSOIMO;
        }),
        (e.prototype.setTransformationFromPhysicsBody = function (e) {
          if (!e.physicsBody.sleeping) {
            if (e.physicsBody.shapes.next) {
              for (var t = e.physicsBody.shapes; t.next; ) t = t.next;
              e.object.position.set(t.position.x, t.position.y, t.position.z);
            } else {
              var i = e.physicsBody.getPosition();
              e.object.position.set(i.x, i.y, i.z);
            }
            if (e.object.rotationQuaternion) {
              var n = e.physicsBody.getQuaternion();
              e.object.rotationQuaternion.set(n.x, n.y, n.z, n.w);
            }
          }
        }),
        (e.prototype.setPhysicsBodyTransformation = function (e, t, i) {
          var n = e.physicsBody;
          e.physicsBody.shapes.next ||
            (n.position.set(t.x, t.y, t.z),
            n.orientation.set(i.x, i.y, i.z, i.w),
            n.syncShapes(),
            n.awake());
        }),
        (e.prototype.setLinearVelocity = function (e, t) {
          e.physicsBody.linearVelocity.set(t.x, t.y, t.z);
        }),
        (e.prototype.setAngularVelocity = function (e, t) {
          e.physicsBody.angularVelocity.set(t.x, t.y, t.z);
        }),
        (e.prototype.getLinearVelocity = function (e) {
          var t = e.physicsBody.linearVelocity;
          return t ? new f(t.x, t.y, t.z) : null;
        }),
        (e.prototype.getAngularVelocity = function (e) {
          var t = e.physicsBody.angularVelocity;
          return t ? new f(t.x, t.y, t.z) : null;
        }),
        (e.prototype.setBodyMass = function (e, t) {
          var i = 0 === t;
          (e.physicsBody.shapes.density = i ? 1 : t),
            e.physicsBody.setupMass(i ? 2 : 1);
        }),
        (e.prototype.getBodyMass = function (e) {
          return e.physicsBody.shapes.density;
        }),
        (e.prototype.getBodyFriction = function (e) {
          return e.physicsBody.shapes.friction;
        }),
        (e.prototype.setBodyFriction = function (e, t) {
          e.physicsBody.shapes.friction = t;
        }),
        (e.prototype.getBodyRestitution = function (e) {
          return e.physicsBody.shapes.restitution;
        }),
        (e.prototype.setBodyRestitution = function (e, t) {
          e.physicsBody.shapes.restitution = t;
        }),
        (e.prototype.sleepBody = function (e) {
          e.physicsBody.sleep();
        }),
        (e.prototype.wakeUpBody = function (e) {
          e.physicsBody.awake();
        }),
        (e.prototype.updateDistanceJoint = function (e, t, i) {
          (e.physicsJoint.limitMotor.upperLimit = t),
            void 0 !== i && (e.physicsJoint.limitMotor.lowerLimit = i);
        }),
        (e.prototype.setMotor = function (e, t, i, n) {
          void 0 !== i
            ? F.Warn(
                "OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"
              )
            : (i = 1e6),
            (t *= -1);
          var r = n
            ? e.physicsJoint.rotationalLimitMotor2
            : e.physicsJoint.rotationalLimitMotor1 ||
              e.physicsJoint.rotationalLimitMotor ||
              e.physicsJoint.limitMotor;
          r && r.setMotor(t, i);
        }),
        (e.prototype.setLimit = function (e, t, i, n) {
          var r = n
            ? e.physicsJoint.rotationalLimitMotor2
            : e.physicsJoint.rotationalLimitMotor1 ||
              e.physicsJoint.rotationalLimitMotor ||
              e.physicsJoint.limitMotor;
          r && r.setLimit(t, void 0 === i ? -t : i);
        }),
        (e.prototype.syncMeshWithImpostor = function (e, t) {
          var i = t.physicsBody;
          (e.position.x = i.position.x),
            (e.position.y = i.position.y),
            (e.position.z = i.position.z),
            e.rotationQuaternion &&
              ((e.rotationQuaternion.x = i.orientation.x),
              (e.rotationQuaternion.y = i.orientation.y),
              (e.rotationQuaternion.z = i.orientation.z),
              (e.rotationQuaternion.w = i.orientation.s));
        }),
        (e.prototype.getRadius = function (e) {
          return e.physicsBody.shapes.radius;
        }),
        (e.prototype.getBoxSizeToRef = function (e, t) {
          var i = e.physicsBody.shapes;
          (t.x = 2 * i.halfWidth),
            (t.y = 2 * i.halfHeight),
            (t.z = 2 * i.halfDepth);
        }),
        (e.prototype.dispose = function () {
          this.world.clear();
        }),
        (e.prototype.raycast = function (e, t) {
          return (
            F.Warn(
              "raycast is not currently supported by the Oimo physics plugin"
            ),
            this._raycastResult.reset(e, t),
            this._raycastResult
          );
        }),
        e
      );
    })(),
    yl = (function () {
      function e(e, t, i) {
        var n = this;
        void 0 === e && (e = !0),
          void 0 === t && (t = Ammo),
          void 0 === i && (i = null),
          (this._useDeltaForWorldStep = e),
          (this.bjsAMMO = {}),
          (this.name = "AmmoJSPlugin"),
          (this._timeStep = 1 / 60),
          (this._fixedTimeStep = 1 / 60),
          (this._maxSteps = 5),
          (this._tmpQuaternion = new m()),
          (this._tmpContactCallbackResult = !1),
          (this._tmpContactPoint = new f()),
          (this._tmpMatrix = new g()),
          "function" == typeof t ? t(this.bjsAMMO) : (this.bjsAMMO = t),
          this.isSupported()
            ? ((this._collisionConfiguration =
                new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration()),
              (this._dispatcher = new this.bjsAMMO.btCollisionDispatcher(
                this._collisionConfiguration
              )),
              (this._overlappingPairCache =
                i || new this.bjsAMMO.btDbvtBroadphase()),
              (this._solver =
                new this.bjsAMMO.btSequentialImpulseConstraintSolver()),
              (this._softBodySolver =
                new this.bjsAMMO.btDefaultSoftBodySolver()),
              (this.world = new this.bjsAMMO.btSoftRigidDynamicsWorld(
                this._dispatcher,
                this._overlappingPairCache,
                this._solver,
                this._collisionConfiguration,
                this._softBodySolver
              )),
              (this._tmpAmmoConcreteContactResultCallback =
                new this.bjsAMMO.ConcreteContactResultCallback()),
              (this._tmpAmmoConcreteContactResultCallback.addSingleResult =
                function (e, t, i, r) {
                  var o = (e = n.bjsAMMO.wrapPointer(
                    e,
                    Ammo.btManifoldPoint
                  )).getPositionWorldOnA();
                  (n._tmpContactPoint.x = o.x()),
                    (n._tmpContactPoint.y = o.y()),
                    (n._tmpContactPoint.z = o.z()),
                    (n._tmpContactCallbackResult = !0);
                }),
              (this._raycastResult = new ml()),
              (this._tmpAmmoTransform = new this.bjsAMMO.btTransform()),
              this._tmpAmmoTransform.setIdentity(),
              (this._tmpAmmoQuaternion = new this.bjsAMMO.btQuaternion(
                0,
                0,
                0,
                1
              )),
              (this._tmpAmmoVectorA = new this.bjsAMMO.btVector3(0, 0, 0)),
              (this._tmpAmmoVectorB = new this.bjsAMMO.btVector3(0, 0, 0)),
              (this._tmpAmmoVectorC = new this.bjsAMMO.btVector3(0, 0, 0)),
              (this._tmpAmmoVectorD = new this.bjsAMMO.btVector3(0, 0, 0)))
            : F.Error(
                "AmmoJS is not available. Please make sure you included the js file."
              );
      }
      return (
        (e.prototype.setGravity = function (e) {
          this._tmpAmmoVectorA.setValue(e.x, e.y, e.z),
            this.world.setGravity(this._tmpAmmoVectorA),
            this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA);
        }),
        (e.prototype.setTimeStep = function (e) {
          this._timeStep = e;
        }),
        (e.prototype.setFixedTimeStep = function (e) {
          this._fixedTimeStep = e;
        }),
        (e.prototype.setMaxSteps = function (e) {
          this._maxSteps = e;
        }),
        (e.prototype.getTimeStep = function () {
          return this._timeStep;
        }),
        (e.prototype._isImpostorInContact = function (e) {
          return (
            (this._tmpContactCallbackResult = !1),
            this.world.contactTest(
              e.physicsBody,
              this._tmpAmmoConcreteContactResultCallback
            ),
            this._tmpContactCallbackResult
          );
        }),
        (e.prototype._isImpostorPairInContact = function (e, t) {
          return (
            (this._tmpContactCallbackResult = !1),
            this.world.contactPairTest(
              e.physicsBody,
              t.physicsBody,
              this._tmpAmmoConcreteContactResultCallback
            ),
            this._tmpContactCallbackResult
          );
        }),
        (e.prototype._stepSimulation = function (e, t, i) {
          if (
            (void 0 === e && (e = 1 / 60),
            void 0 === t && (t = 10),
            void 0 === i && (i = 1 / 60),
            0 == t)
          )
            this.world.stepSimulation(e, 0);
          else
            for (; t > 0 && e > 0; )
              e - i < i
                ? (this.world.stepSimulation(e, 0), (e = 0))
                : ((e -= i), this.world.stepSimulation(i, 0)),
                t--;
        }),
        (e.prototype.executeStep = function (e, t) {
          for (var i = 0, n = t; i < n.length; i++) {
            var r = n[i];
            r.soft || r.beforeStep();
          }
          this._stepSimulation(
            this._useDeltaForWorldStep ? e : this._timeStep,
            this._maxSteps,
            this._fixedTimeStep
          );
          for (var o = 0, s = t; o < s.length; o++) {
            var a = s[o];
            if (
              (a.soft ? this._afterSoftStep(a) : a.afterStep(),
              a._onPhysicsCollideCallbacks.length > 0 &&
                this._isImpostorInContact(a))
            )
              for (
                var l = 0, c = a._onPhysicsCollideCallbacks;
                l < c.length;
                l++
              )
                for (var u = 0, h = c[l].otherImpostors; u < h.length; u++) {
                  var d = h[u];
                  (a.physicsBody.isActive() || d.physicsBody.isActive()) &&
                    this._isImpostorPairInContact(a, d) &&
                    (a.onCollide({
                      body: d.physicsBody,
                      point: this._tmpContactPoint,
                    }),
                    d.onCollide({
                      body: a.physicsBody,
                      point: this._tmpContactPoint,
                    }));
                }
          }
        }),
        (e.prototype._afterSoftStep = function (e) {
          e.type === Mo.RopeImpostor
            ? this._ropeStep(e)
            : this._softbodyOrClothStep(e);
        }),
        (e.prototype._ropeStep = function (e) {
          for (
            var t,
              i,
              n,
              r,
              o = e.physicsBody.get_m_nodes(),
              s = o.size(),
              a = new Array(),
              l = 0;
            l < s;
            l++
          )
            (i = (t = o.at(l).get_m_x()).x()),
              (n = t.y()),
              (r = t.z()),
              a.push(new f(i, n, r));
          var c = e.object,
            u = e.getParam("shape");
          e._isFromLine
            ? (e.object = Lo.CreateLines("lines", {
                points: a,
                instance: c,
              }))
            : (e.object = Go.ExtrudeShape("ext", {
                shape: u,
                path: a,
                instance: c,
              }));
        }),
        (e.prototype._softbodyOrClothStep = function (e) {
          var t = e.type === Mo.ClothImpostor ? 1 : -1,
            i = e.object,
            n = i.getVerticesData(wt.PositionKind);
          n || (n = []);
          var r = i.getVerticesData(wt.NormalKind);
          r || (r = []);
          for (
            var o,
              s,
              a,
              l,
              c,
              u,
              h,
              d,
              p = n.length / 3,
              f = e.physicsBody.get_m_nodes(),
              _ = 0;
            _ < p;
            _++
          ) {
            var m;
            (a = (s = (o = f.at(_)).get_m_x()).x()),
              (l = s.y()),
              (c = s.z() * t),
              (u = (m = o.get_m_n()).x()),
              (h = m.y()),
              (d = m.z() * t),
              (n[3 * _] = a),
              (n[3 * _ + 1] = l),
              (n[3 * _ + 2] = c),
              (r[3 * _] = u),
              (r[3 * _ + 1] = h),
              (r[3 * _ + 2] = d);
          }
          var g = new Nt();
          (g.positions = n),
            (g.normals = r),
            (g.uvs = i.getVerticesData(wt.UVKind)),
            (g.colors = i.getVerticesData(wt.ColorKind)),
            i && i.getIndices && (g.indices = i.getIndices()),
            g.applyToMesh(i);
        }),
        (e.prototype.applyImpulse = function (e, t, i) {
          if (e.soft) F.Warn("Cannot be applied to a soft body");
          else {
            e.physicsBody.activate();
            var n = this._tmpAmmoVectorA,
              r = this._tmpAmmoVectorB;
            e.object &&
              e.object.getWorldMatrix &&
              i.subtractInPlace(e.object.getWorldMatrix().getTranslation()),
              n.setValue(i.x, i.y, i.z),
              r.setValue(t.x, t.y, t.z),
              e.physicsBody.applyImpulse(r, n);
          }
        }),
        (e.prototype.applyForce = function (e, t, i) {
          if (e.soft) F.Warn("Cannot be applied to a soft body");
          else {
            e.physicsBody.activate();
            var n = this._tmpAmmoVectorA,
              r = this._tmpAmmoVectorB;
            e.object &&
              e.object.getWorldMatrix &&
              i.subtractInPlace(e.object.getWorldMatrix().getTranslation()),
              n.setValue(i.x, i.y, i.z),
              r.setValue(t.x, t.y, t.z),
              e.physicsBody.applyForce(r, n);
          }
        }),
        (e.prototype.generatePhysicsBody = function (t) {
          if (((t._pluginData.toDispose = []), t.parent))
            t.physicsBody && (this.removePhysicsBody(t), t.forceUpdate());
          else if (t.isBodyInitRequired()) {
            var i = this._createShape(t),
              n = t.getParam("mass");
            if (((t._pluginData.mass = n), t.soft))
              i.get_m_cfg().set_collisions(17),
                i.get_m_cfg().set_kDP(t.getParam("damping")),
                this.bjsAMMO
                  .castObject(i, this.bjsAMMO.btCollisionObject)
                  .getCollisionShape()
                  .setMargin(t.getParam("margin")),
                i.setActivationState(e.DISABLE_DEACTIVATION_FLAG),
                this.world.addSoftBody(i, 1, -1),
                (t.physicsBody = i),
                t._pluginData.toDispose.push(i),
                this.setBodyPressure(t, 0),
                t.type === Mo.SoftbodyImpostor &&
                  this.setBodyPressure(t, t.getParam("pressure")),
                this.setBodyStiffness(t, t.getParam("stiffness")),
                this.setBodyVelocityIterations(
                  t,
                  t.getParam("velocityIterations")
                ),
                this.setBodyPositionIterations(
                  t,
                  t.getParam("positionIterations")
                );
            else {
              var r = new this.bjsAMMO.btVector3(0, 0, 0),
                o = new this.bjsAMMO.btTransform();
              o.setIdentity(),
                0 !== n && i.calculateLocalInertia(n, r),
                this._tmpAmmoVectorA.setValue(
                  t.object.position.x,
                  t.object.position.y,
                  t.object.position.z
                ),
                this._tmpAmmoQuaternion.setValue(
                  t.object.rotationQuaternion.x,
                  t.object.rotationQuaternion.y,
                  t.object.rotationQuaternion.z,
                  t.object.rotationQuaternion.w
                ),
                o.setOrigin(this._tmpAmmoVectorA),
                o.setRotation(this._tmpAmmoQuaternion);
              var s = new this.bjsAMMO.btDefaultMotionState(o),
                a = new this.bjsAMMO.btRigidBodyConstructionInfo(n, s, i, r),
                l = new this.bjsAMMO.btRigidBody(a);
              0 === n &&
                (l.setCollisionFlags(l.getCollisionFlags() | e.KINEMATIC_FLAG),
                l.setActivationState(e.DISABLE_DEACTIVATION_FLAG)),
                t.type != Mo.NoImpostor ||
                  i.getChildShape ||
                  l.setCollisionFlags(
                    l.getCollisionFlags() | e.DISABLE_COLLISION_FLAG
                  );
              var c = t.getParam("group"),
                u = t.getParam("mask");
              c && u
                ? this.world.addRigidBody(l, c, u)
                : this.world.addRigidBody(l),
                (t.physicsBody = l),
                (t._pluginData.toDispose = t._pluginData.toDispose.concat([
                  l,
                  a,
                  s,
                  o,
                  r,
                  i,
                ]));
            }
            this.setBodyRestitution(t, t.getParam("restitution")),
              this.setBodyFriction(t, t.getParam("friction"));
          }
        }),
        (e.prototype.removePhysicsBody = function (e) {
          var t = this;
          this.world &&
            (e.soft
              ? this.world.removeSoftBody(e.physicsBody)
              : this.world.removeRigidBody(e.physicsBody),
            e._pluginData &&
              (e._pluginData.toDispose.forEach(function (e) {
                t.bjsAMMO.destroy(e);
              }),
              (e._pluginData.toDispose = [])));
        }),
        (e.prototype.generateJoint = function (e) {
          var t = e.mainImpostor.physicsBody,
            i = e.connectedImpostor.physicsBody;
          if (t && i) {
            var n,
              r = e.joint.jointData;
            switch (
              (r.mainPivot || (r.mainPivot = new f(0, 0, 0)),
              r.connectedPivot || (r.connectedPivot = new f(0, 0, 0)),
              e.joint.type)
            ) {
              case Ao.DistanceJoint:
                var o = r.maxDistance;
                o &&
                  ((r.mainPivot = new f(0, -o / 2, 0)),
                  (r.connectedPivot = new f(0, o / 2, 0))),
                  (n = new this.bjsAMMO.btPoint2PointConstraint(
                    t,
                    i,
                    new this.bjsAMMO.btVector3(
                      r.mainPivot.x,
                      r.mainPivot.y,
                      r.mainPivot.z
                    ),
                    new this.bjsAMMO.btVector3(
                      r.connectedPivot.x,
                      r.connectedPivot.y,
                      r.connectedPivot.z
                    )
                  ));
                break;
              case Ao.HingeJoint:
                r.mainAxis || (r.mainAxis = new f(0, 0, 0)),
                  r.connectedAxis || (r.connectedAxis = new f(0, 0, 0));
                var s = new this.bjsAMMO.btVector3(
                    r.mainAxis.x,
                    r.mainAxis.y,
                    r.mainAxis.z
                  ),
                  a = new this.bjsAMMO.btVector3(
                    r.connectedAxis.x,
                    r.connectedAxis.y,
                    r.connectedAxis.z
                  );
                n = new this.bjsAMMO.btHingeConstraint(
                  t,
                  i,
                  new this.bjsAMMO.btVector3(
                    r.mainPivot.x,
                    r.mainPivot.y,
                    r.mainPivot.z
                  ),
                  new this.bjsAMMO.btVector3(
                    r.connectedPivot.x,
                    r.connectedPivot.y,
                    r.connectedPivot.z
                  ),
                  s,
                  a
                );
                break;
              case Ao.BallAndSocketJoint:
                n = new this.bjsAMMO.btPoint2PointConstraint(
                  t,
                  i,
                  new this.bjsAMMO.btVector3(
                    r.mainPivot.x,
                    r.mainPivot.y,
                    r.mainPivot.z
                  ),
                  new this.bjsAMMO.btVector3(
                    r.connectedPivot.x,
                    r.connectedPivot.y,
                    r.connectedPivot.z
                  )
                );
                break;
              default:
                F.Warn(
                  "JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"
                ),
                  (n = new this.bjsAMMO.btPoint2PointConstraint(
                    t,
                    i,
                    new this.bjsAMMO.btVector3(
                      r.mainPivot.x,
                      r.mainPivot.y,
                      r.mainPivot.z
                    ),
                    new this.bjsAMMO.btVector3(
                      r.connectedPivot.x,
                      r.connectedPivot.y,
                      r.connectedPivot.z
                    )
                  ));
            }
            this.world.addConstraint(n, !e.joint.jointData.collision),
              (e.joint.physicsJoint = n);
          }
        }),
        (e.prototype.removeJoint = function (e) {
          this.world && this.world.removeConstraint(e.joint.physicsJoint);
        }),
        (e.prototype._addMeshVerts = function (e, t, i) {
          var n = this,
            r = 0;
          if (i && i.getIndices && i.getWorldMatrix && i.getChildMeshes) {
            var o = i.getIndices();
            o || (o = []);
            var s = i.getVerticesData(wt.PositionKind);
            s || (s = []), i.computeWorldMatrix(!1);
            for (var a = o.length / 3, l = 0; l < a; l++) {
              for (var c = [], u = 0; u < 3; u++) {
                var h,
                  d = new f(
                    s[3 * o[3 * l + u] + 0],
                    s[3 * o[3 * l + u] + 1],
                    s[3 * o[3 * l + u] + 2]
                  );
                g.ScalingToRef(
                  i.scaling.x,
                  i.scaling.y,
                  i.scaling.z,
                  this._tmpMatrix
                ),
                  (d = f.TransformCoordinates(d, this._tmpMatrix)),
                  (h =
                    0 == u
                      ? this._tmpAmmoVectorA
                      : 1 == u
                        ? this._tmpAmmoVectorB
                        : this._tmpAmmoVectorC).setValue(d.x, d.y, d.z),
                  c.push(h);
              }
              e.addTriangle(c[0], c[1], c[2]), r++;
            }
            i.getChildMeshes().forEach(function (i) {
              r += n._addMeshVerts(e, t, i);
            });
          }
          return r;
        }),
        (e.prototype._softVertexData = function (e) {
          var t = e.object;
          if (t && t.getIndices && t.getWorldMatrix && t.getChildMeshes) {
            var i = t.getIndices();
            i || (i = []);
            var n = t.getVerticesData(wt.PositionKind);
            n || (n = []);
            var r = t.getVerticesData(wt.NormalKind);
            r || (r = []), t.computeWorldMatrix(!1);
            for (var o = [], s = [], a = 0; a < n.length; a += 3) {
              var l = new f(n[a], n[a + 1], n[a + 2]),
                c = new f(r[a], r[a + 1], r[a + 2]);
              (l = f.TransformCoordinates(l, t.getWorldMatrix())),
                (c = f.TransformNormal(c, t.getWorldMatrix())),
                o.push(l.x, l.y, l.z),
                s.push(c.x, c.y, c.z);
            }
            var u = new Nt();
            return (
              (u.positions = o),
              (u.normals = s),
              (u.uvs = t.getVerticesData(wt.UVKind)),
              (u.colors = t.getVerticesData(wt.ColorKind)),
              t && t.getIndices && (u.indices = t.getIndices()),
              u.applyToMesh(t),
              (t.position = f.Zero()),
              (t.rotationQuaternion = null),
              (t.rotation = f.Zero()),
              t.computeWorldMatrix(!0),
              u
            );
          }
          return Nt.ExtractFromMesh(t);
        }),
        (e.prototype._createSoftbody = function (e) {
          var t = e.object;
          if (t && t.getIndices) {
            var i = t.getIndices();
            i || (i = []);
            var n = this._softVertexData(e),
              r = n.positions,
              o = n.normals;
            if (null === r || null === o)
              return new this.bjsAMMO.btCompoundShape();
            for (var s = [], a = [], l = 0; l < r.length; l += 3) {
              var c = new f(r[l], r[l + 1], r[l + 2]),
                u = new f(o[l], o[l + 1], o[l + 2]);
              s.push(c.x, c.y, -c.z), a.push(u.x, u.y, -u.z);
            }
            var h = new this.bjsAMMO.btSoftBodyHelpers().CreateFromTriMesh(
                this.world.getWorldInfo(),
                s,
                t.getIndices(),
                i.length / 3,
                !0
              ),
              d = r.length / 3,
              p = h.get_m_nodes();
            for (l = 0; l < d; l++) {
              var _;
              (_ = p.at(l).get_m_n()).setX(a[3 * l]),
                _.setY(a[3 * l + 1]),
                _.setZ(a[3 * l + 2]);
            }
            return h;
          }
        }),
        (e.prototype._createCloth = function (e) {
          var t = e.object;
          if (t && t.getIndices) {
            var i = t.getIndices();
            i || (i = []);
            var n = this._softVertexData(e),
              r = n.positions,
              o = n.normals;
            if (null === r || null === o)
              return new this.bjsAMMO.btCompoundShape();
            var s = r.length,
              a = Math.sqrt(s / 3);
            e.segments = a;
            var l = a - 1;
            return (
              this._tmpAmmoVectorA.setValue(r[0], r[1], r[2]),
              this._tmpAmmoVectorB.setValue(
                r[3 * l],
                r[3 * l + 1],
                r[3 * l + 2]
              ),
              this._tmpAmmoVectorD.setValue(r[s - 3], r[s - 2], r[s - 1]),
              this._tmpAmmoVectorC.setValue(
                r[s - 3 - 3 * l],
                r[s - 2 - 3 * l],
                r[s - 1 - 3 * l]
              ),
              new this.bjsAMMO.btSoftBodyHelpers().CreatePatch(
                this.world.getWorldInfo(),
                this._tmpAmmoVectorA,
                this._tmpAmmoVectorB,
                this._tmpAmmoVectorC,
                this._tmpAmmoVectorD,
                a,
                a,
                e.getParam("fixedPoints"),
                !0
              )
            );
          }
        }),
        (e.prototype._createRope = function (e) {
          var t,
            i,
            n = this._softVertexData(e),
            r = n.positions,
            o = n.normals;
          if (null === r || null === o)
            return new this.bjsAMMO.btCompoundShape();
          if (
            (n.applyToMesh(e.object, !0),
            (e._isFromLine = !0),
            0 ===
              o
                .map(function (e) {
                  return e * e;
                })
                .reduce(function (e, t) {
                  return e + t;
                }))
          )
            (i = (t = r.length) / 3 - 1),
              this._tmpAmmoVectorA.setValue(r[0], r[1], r[2]),
              this._tmpAmmoVectorB.setValue(r[t - 3], r[t - 2], r[t - 1]);
          else {
            e._isFromLine = !1;
            var s = e.getParam("path");
            if (null === e.getParam("shape"))
              return (
                F.Warn("No shape available for extruded mesh"),
                new this.bjsAMMO.btCompoundShape()
              );
            if (r.length % (3 * s.length) != 0)
              return (
                F.Warn("Path does not match extrusion"),
                new this.bjsAMMO.btCompoundShape()
              );
            (i = (t = s.length) - 1),
              this._tmpAmmoVectorA.setValue(s[0].x, s[0].y, s[0].z),
              this._tmpAmmoVectorB.setValue(s[t - 1].x, s[t - 1].y, s[t - 1].z);
          }
          e.segments = i;
          var a = e.getParam("fixedPoints");
          a = a > 3 ? 3 : a;
          var l = new this.bjsAMMO.btSoftBodyHelpers().CreateRope(
            this.world.getWorldInfo(),
            this._tmpAmmoVectorA,
            this._tmpAmmoVectorB,
            i - 1,
            a
          );
          return l.get_m_cfg().set_collisions(17), l;
        }),
        (e.prototype._createCustom = function (e) {
          var t = null;
          return (
            this.onCreateCustomShape && (t = this.onCreateCustomShape(e)),
            null == t && (t = new this.bjsAMMO.btCompoundShape()),
            t
          );
        }),
        (e.prototype._addHullVerts = function (e, t, i) {
          var n = this,
            r = 0;
          if (i && i.getIndices && i.getWorldMatrix && i.getChildMeshes) {
            var o = i.getIndices();
            o || (o = []);
            var s = i.getVerticesData(wt.PositionKind);
            s || (s = []), i.computeWorldMatrix(!1);
            for (var a = o.length / 3, l = 0; l < a; l++) {
              for (var c = [], u = 0; u < 3; u++) {
                var h,
                  d = new f(
                    s[3 * o[3 * l + u] + 0],
                    s[3 * o[3 * l + u] + 1],
                    s[3 * o[3 * l + u] + 2]
                  );
                g.ScalingToRef(
                  i.scaling.x,
                  i.scaling.y,
                  i.scaling.z,
                  this._tmpMatrix
                ),
                  (d = f.TransformCoordinates(d, this._tmpMatrix)),
                  (h =
                    0 == u
                      ? this._tmpAmmoVectorA
                      : 1 == u
                        ? this._tmpAmmoVectorB
                        : this._tmpAmmoVectorC).setValue(d.x, d.y, d.z),
                  c.push(h);
              }
              e.addPoint(c[0], !0),
                e.addPoint(c[1], !0),
                e.addPoint(c[2], !0),
                r++;
            }
            i.getChildMeshes().forEach(function (i) {
              r += n._addHullVerts(e, t, i);
            });
          }
          return r;
        }),
        (e.prototype._createShape = function (e, t) {
          var i = this;
          void 0 === t && (t = !1);
          var n,
            r = e.object,
            o = e.getObjectExtendSize();
          if (!t) {
            var a = e.object.getChildMeshes ? e.object.getChildMeshes(!0) : [];
            n = new this.bjsAMMO.btCompoundShape();
            var l = 0;
            if (
              (a.forEach(function (e) {
                var t = e.getPhysicsImpostor();
                if (t) {
                  if (t.type == Mo.MeshImpostor)
                    throw "A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";
                  var r = i._createShape(t),
                    o = e.parent.getWorldMatrix().clone(),
                    s = new f();
                  o.decompose(s),
                    i._tmpAmmoTransform
                      .getOrigin()
                      .setValue(
                        e.position.x * s.x,
                        e.position.y * s.y,
                        e.position.z * s.z
                      ),
                    i._tmpAmmoQuaternion.setValue(
                      e.rotationQuaternion.x,
                      e.rotationQuaternion.y,
                      e.rotationQuaternion.z,
                      e.rotationQuaternion.w
                    ),
                    i._tmpAmmoTransform.setRotation(i._tmpAmmoQuaternion),
                    n.addChildShape(i._tmpAmmoTransform, r),
                    t.dispose(),
                    l++;
                }
              }),
              l > 0)
            ) {
              if (e.type != Mo.NoImpostor) {
                var c = this._createShape(e, !0);
                c &&
                  (this._tmpAmmoTransform.getOrigin().setValue(0, 0, 0),
                  this._tmpAmmoQuaternion.setValue(0, 0, 0, 1),
                  this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),
                  n.addChildShape(this._tmpAmmoTransform, c));
              }
              return n;
            }
            this.bjsAMMO.destroy(n), (n = null);
          }
          switch (e.type) {
            case Mo.SphereImpostor:
              if (
                s.WithinEpsilon(o.x, o.y, 1e-4) &&
                s.WithinEpsilon(o.x, o.z, 1e-4)
              )
                n = new this.bjsAMMO.btSphereShape(o.x / 2);
              else {
                var u = [new this.bjsAMMO.btVector3(0, 0, 0)];
                (n = new this.bjsAMMO.btMultiSphereShape(
                  u,
                  [1],
                  1
                )).setLocalScaling(
                  new this.bjsAMMO.btVector3(o.x / 2, o.y / 2, o.z / 2)
                );
              }
              break;
            case Mo.CapsuleImpostor:
              n = new this.bjsAMMO.btCapsuleShape(o.x / 2, o.y / 2);
              break;
            case Mo.CylinderImpostor:
              this._tmpAmmoVectorA.setValue(o.x / 2, o.y / 2, o.z / 2),
                (n = new this.bjsAMMO.btCylinderShape(this._tmpAmmoVectorA));
              break;
            case Mo.PlaneImpostor:
            case Mo.BoxImpostor:
              this._tmpAmmoVectorA.setValue(o.x / 2, o.y / 2, o.z / 2),
                (n = new this.bjsAMMO.btBoxShape(this._tmpAmmoVectorA));
              break;
            case Mo.MeshImpostor:
              if (0 == e.getParam("mass")) {
                var h = new this.bjsAMMO.btTriangleMesh();
                e._pluginData.toDispose.push(h);
                var d = this._addMeshVerts(h, r, r);
                n =
                  0 == d
                    ? new this.bjsAMMO.btCompoundShape()
                    : new this.bjsAMMO.btBvhTriangleMeshShape(h);
                break;
              }
            case Mo.ConvexHullImpostor:
              var p = new this.bjsAMMO.btConvexHullShape();
              0 == (d = this._addHullVerts(p, r, r))
                ? (e._pluginData.toDispose.push(p),
                  (n = new this.bjsAMMO.btCompoundShape()))
                : (n = p);
              break;
            case Mo.NoImpostor:
              n = new this.bjsAMMO.btSphereShape(o.x / 2);
              break;
            case Mo.CustomImpostor:
              n = this._createCustom(e);
              break;
            case Mo.SoftbodyImpostor:
              n = this._createSoftbody(e);
              break;
            case Mo.ClothImpostor:
              n = this._createCloth(e);
              break;
            case Mo.RopeImpostor:
              n = this._createRope(e);
              break;
            default:
              F.Warn(
                "The impostor type is not currently supported by the ammo plugin."
              );
          }
          return n;
        }),
        (e.prototype.setTransformationFromPhysicsBody = function (e) {
          e.physicsBody
            .getMotionState()
            .getWorldTransform(this._tmpAmmoTransform),
            e.object.position.set(
              this._tmpAmmoTransform.getOrigin().x(),
              this._tmpAmmoTransform.getOrigin().y(),
              this._tmpAmmoTransform.getOrigin().z()
            ),
            e.object.rotationQuaternion
              ? e.object.rotationQuaternion.set(
                  this._tmpAmmoTransform.getRotation().x(),
                  this._tmpAmmoTransform.getRotation().y(),
                  this._tmpAmmoTransform.getRotation().z(),
                  this._tmpAmmoTransform.getRotation().w()
                )
              : e.object.rotation &&
                (this._tmpQuaternion.set(
                  this._tmpAmmoTransform.getRotation().x(),
                  this._tmpAmmoTransform.getRotation().y(),
                  this._tmpAmmoTransform.getRotation().z(),
                  this._tmpAmmoTransform.getRotation().w()
                ),
                this._tmpQuaternion.toEulerAnglesToRef(e.object.rotation));
        }),
        (e.prototype.setPhysicsBodyTransformation = function (e, t, i) {
          var n = e.physicsBody.getWorldTransform();
          if (
            Math.abs(n.getOrigin().x() - t.x) > c ||
            Math.abs(n.getOrigin().y() - t.y) > c ||
            Math.abs(n.getOrigin().z() - t.z) > c ||
            Math.abs(n.getRotation().x() - i.x) > c ||
            Math.abs(n.getRotation().y() - i.y) > c ||
            Math.abs(n.getRotation().z() - i.z) > c ||
            Math.abs(n.getRotation().w() - i.w) > c
          )
            if (
              (this._tmpAmmoVectorA.setValue(t.x, t.y, t.z),
              n.setOrigin(this._tmpAmmoVectorA),
              this._tmpAmmoQuaternion.setValue(i.x, i.y, i.z, i.w),
              n.setRotation(this._tmpAmmoQuaternion),
              e.physicsBody.setWorldTransform(n),
              0 == e.mass)
            ) {
              var r = e.physicsBody.getMotionState();
              r && r.setWorldTransform(n);
            } else e.physicsBody.activate();
        }),
        (e.prototype.isSupported = function () {
          return void 0 !== this.bjsAMMO;
        }),
        (e.prototype.setLinearVelocity = function (e, t) {
          this._tmpAmmoVectorA.setValue(t.x, t.y, t.z),
            e.soft
              ? e.physicsBody.linearVelocity(this._tmpAmmoVectorA)
              : e.physicsBody.setLinearVelocity(this._tmpAmmoVectorA);
        }),
        (e.prototype.setAngularVelocity = function (e, t) {
          this._tmpAmmoVectorA.setValue(t.x, t.y, t.z),
            e.soft
              ? e.physicsBody.angularVelocity(this._tmpAmmoVectorA)
              : e.physicsBody.setAngularVelocity(this._tmpAmmoVectorA);
        }),
        (e.prototype.getLinearVelocity = function (e) {
          if (e.soft) var t = e.physicsBody.linearVelocity();
          else t = e.physicsBody.getLinearVelocity();
          if (!t) return null;
          var i = new f(t.x(), t.y(), t.z());
          return this.bjsAMMO.destroy(t), i;
        }),
        (e.prototype.getAngularVelocity = function (e) {
          if (e.soft) var t = e.physicsBody.angularVelocity();
          else t = e.physicsBody.getAngularVelocity();
          if (!t) return null;
          var i = new f(t.x(), t.y(), t.z());
          return this.bjsAMMO.destroy(t), i;
        }),
        (e.prototype.setBodyMass = function (e, t) {
          e.soft
            ? e.physicsBody.setTotalMass(t, !1)
            : e.physicsBody.setMassProps(t),
            (e._pluginData.mass = t);
        }),
        (e.prototype.getBodyMass = function (e) {
          return e._pluginData.mass || 0;
        }),
        (e.prototype.getBodyFriction = function (e) {
          return e._pluginData.friction || 0;
        }),
        (e.prototype.setBodyFriction = function (e, t) {
          e.soft
            ? e.physicsBody.get_m_cfg().set_kDF(t)
            : e.physicsBody.setFriction(t),
            (e._pluginData.friction = t);
        }),
        (e.prototype.getBodyRestitution = function (e) {
          return e._pluginData.restitution || 0;
        }),
        (e.prototype.setBodyRestitution = function (e, t) {
          e.physicsBody.setRestitution(t), (e._pluginData.restitution = t);
        }),
        (e.prototype.getBodyPressure = function (e) {
          return e.soft
            ? e._pluginData.pressure || 0
            : (F.Warn("Pressure is not a property of a rigid body"), 0);
        }),
        (e.prototype.setBodyPressure = function (e, t) {
          e.soft
            ? e.type === Mo.SoftbodyImpostor
              ? (e.physicsBody.get_m_cfg().set_kPR(t),
                (e._pluginData.pressure = t))
              : (e.physicsBody.get_m_cfg().set_kPR(0),
                (e._pluginData.pressure = 0))
            : F.Warn("Pressure can only be applied to a softbody");
        }),
        (e.prototype.getBodyStiffness = function (e) {
          return e.soft
            ? e._pluginData.stiffness || 0
            : (F.Warn("Stiffness is not a property of a rigid body"), 0);
        }),
        (e.prototype.setBodyStiffness = function (e, t) {
          e.soft
            ? ((t = (t = t < 0 ? 0 : t) > 1 ? 1 : t),
              e.physicsBody.get_m_materials().at(0).set_m_kLST(t),
              (e._pluginData.stiffness = t))
            : F.Warn("Stiffness cannot be applied to a rigid body");
        }),
        (e.prototype.getBodyVelocityIterations = function (e) {
          return e.soft
            ? e._pluginData.velocityIterations || 0
            : (F.Warn("Velocity iterations is not a property of a rigid body"),
              0);
        }),
        (e.prototype.setBodyVelocityIterations = function (e, t) {
          e.soft
            ? ((t = t < 0 ? 0 : t),
              e.physicsBody.get_m_cfg().set_viterations(t),
              (e._pluginData.velocityIterations = t))
            : F.Warn("Velocity iterations cannot be applied to a rigid body");
        }),
        (e.prototype.getBodyPositionIterations = function (e) {
          return e.soft
            ? e._pluginData.positionIterations || 0
            : (F.Warn("Position iterations is not a property of a rigid body"),
              0);
        }),
        (e.prototype.setBodyPositionIterations = function (e, t) {
          e.soft
            ? ((t = t < 0 ? 0 : t),
              e.physicsBody.get_m_cfg().set_piterations(t),
              (e._pluginData.positionIterations = t))
            : F.Warn("Position iterations cannot be applied to a rigid body");
        }),
        (e.prototype.appendAnchor = function (e, t, i, n, r, o) {
          void 0 === r && (r = 1), void 0 === o && (o = !1);
          var s = e.segments,
            a = Math.round((s - 1) * i) + s * (s - 1 - Math.round((s - 1) * n));
          e.physicsBody.appendAnchor(a, t.physicsBody, o, r);
        }),
        (e.prototype.appendHook = function (e, t, i, n, r) {
          void 0 === n && (n = 1), void 0 === r && (r = !1);
          var o = Math.round(e.segments * i);
          e.physicsBody.appendAnchor(o, t.physicsBody, r, n);
        }),
        (e.prototype.sleepBody = function (e) {
          F.Warn(
            "sleepBody is not currently supported by the Ammo physics plugin"
          );
        }),
        (e.prototype.wakeUpBody = function (e) {
          e.physicsBody.activate();
        }),
        (e.prototype.updateDistanceJoint = function (e, t, i) {
          F.Warn(
            "updateDistanceJoint is not currently supported by the Ammo physics plugin"
          );
        }),
        (e.prototype.setMotor = function (e, t, i, n) {
          e.physicsJoint.enableAngularMotor(!0, t, i);
        }),
        (e.prototype.setLimit = function (e, t, i) {
          F.Warn(
            "setLimit is not currently supported by the Ammo physics plugin"
          );
        }),
        (e.prototype.syncMeshWithImpostor = function (e, t) {
          t.physicsBody
            .getMotionState()
            .getWorldTransform(this._tmpAmmoTransform),
            (e.position.x = this._tmpAmmoTransform.getOrigin().x()),
            (e.position.y = this._tmpAmmoTransform.getOrigin().y()),
            (e.position.z = this._tmpAmmoTransform.getOrigin().z()),
            e.rotationQuaternion &&
              ((e.rotationQuaternion.x = this._tmpAmmoTransform
                .getRotation()
                .x()),
              (e.rotationQuaternion.y = this._tmpAmmoTransform
                .getRotation()
                .y()),
              (e.rotationQuaternion.z = this._tmpAmmoTransform
                .getRotation()
                .z()),
              (e.rotationQuaternion.w = this._tmpAmmoTransform
                .getRotation()
                .w()));
        }),
        (e.prototype.getRadius = function (e) {
          return e.getObjectExtendSize().x / 2;
        }),
        (e.prototype.getBoxSizeToRef = function (e, t) {
          var i = e.getObjectExtendSize();
          (t.x = i.x), (t.y = i.y), (t.z = i.z);
        }),
        (e.prototype.dispose = function () {
          this.bjsAMMO.destroy(this.world),
            this.bjsAMMO.destroy(this._solver),
            this.bjsAMMO.destroy(this._overlappingPairCache),
            this.bjsAMMO.destroy(this._dispatcher),
            this.bjsAMMO.destroy(this._collisionConfiguration),
            this.bjsAMMO.destroy(this._tmpAmmoVectorA),
            this.bjsAMMO.destroy(this._tmpAmmoVectorB),
            this.bjsAMMO.destroy(this._tmpAmmoVectorC),
            this.bjsAMMO.destroy(this._tmpAmmoTransform),
            this.bjsAMMO.destroy(this._tmpAmmoQuaternion),
            this.bjsAMMO.destroy(this._tmpAmmoConcreteContactResultCallback),
            (this.world = null);
        }),
        (e.prototype.raycast = function (e, t) {
          (this._tmpAmmoVectorRCA = new this.bjsAMMO.btVector3(e.x, e.y, e.z)),
            (this._tmpAmmoVectorRCB = new this.bjsAMMO.btVector3(
              t.x,
              t.y,
              t.z
            ));
          var i = new this.bjsAMMO.ClosestRayResultCallback(
            this._tmpAmmoVectorRCA,
            this._tmpAmmoVectorRCB
          );
          return (
            this.world.rayTest(
              this._tmpAmmoVectorRCA,
              this._tmpAmmoVectorRCB,
              i
            ),
            this._raycastResult.reset(e, t),
            i.hasHit() &&
              (this._raycastResult.setHitData(
                {
                  x: i.get_m_hitNormalWorld().x(),
                  y: i.get_m_hitNormalWorld().y(),
                  z: i.get_m_hitNormalWorld().z(),
                },
                {
                  x: i.get_m_hitPointWorld().x(),
                  y: i.get_m_hitPointWorld().y(),
                  z: i.get_m_hitPointWorld().z(),
                }
              ),
              this._raycastResult.calculateHitDistance()),
            this.bjsAMMO.destroy(i),
            this.bjsAMMO.destroy(this._tmpAmmoVectorRCA),
            this.bjsAMMO.destroy(this._tmpAmmoVectorRCB),
            this._raycastResult
          );
        }),
        (e.DISABLE_COLLISION_FLAG = 4),
        (e.KINEMATIC_FLAG = 2),
        (e.DISABLE_DEACTIVATION_FLAG = 4),
        e
      );
    })();
  (t.prototype.removeReflectionProbe = function (e) {
    if (!this.reflectionProbes) return -1;
    var t = this.reflectionProbes.indexOf(e);
    return -1 !== t && this.reflectionProbes.splice(t, 1), t;
  }),
    (t.prototype.addReflectionProbe = function (e) {
      this.reflectionProbes || (this.reflectionProbes = []),
        this.reflectionProbes.push(e);
    });
  var bl = (function () {
      function e(e, t, i, n, r) {
        var o = this;
        void 0 === n && (n = !0),
          void 0 === r && (r = !1),
          (this.name = e),
          (this._viewMatrix = g.Identity()),
          (this._target = f.Zero()),
          (this._add = f.Zero()),
          (this._invertYAxis = !1),
          (this.position = f.Zero()),
          (this._scene = i),
          this._scene.reflectionProbes ||
            (this._scene.reflectionProbes = new Array()),
          this._scene.reflectionProbes.push(this);
        var s = 0;
        if (r) {
          var a = this._scene.getEngine().getCaps();
          a.textureHalfFloatRender ? (s = 2) : a.textureFloatRender && (s = 1);
        }
        (this._renderTargetTexture = new Dr(e, t, i, n, !0, s, !0)),
          this._renderTargetTexture.onBeforeRenderObservable.add(function (e) {
            switch (e) {
              case 0:
                o._add.copyFromFloats(1, 0, 0);
                break;
              case 1:
                o._add.copyFromFloats(-1, 0, 0);
                break;
              case 2:
                o._add.copyFromFloats(0, o._invertYAxis ? 1 : -1, 0);
                break;
              case 3:
                o._add.copyFromFloats(0, o._invertYAxis ? -1 : 1, 0);
                break;
              case 4:
                o._add.copyFromFloats(0, 0, 1);
                break;
              case 5:
                o._add.copyFromFloats(0, 0, -1);
            }
            o._attachedMesh &&
              o.position.copyFrom(o._attachedMesh.getAbsolutePosition()),
              o.position.addToRef(o._add, o._target),
              g.LookAtLHToRef(o.position, o._target, f.Up(), o._viewMatrix),
              i.activeCamera &&
                ((o._projectionMatrix = g.PerspectiveFovLH(
                  Math.PI / 2,
                  1,
                  i.activeCamera.minZ,
                  i.activeCamera.maxZ
                )),
                i.setTransformMatrix(o._viewMatrix, o._projectionMatrix)),
              (i._forcedViewPosition = o.position);
          }),
          this._renderTargetTexture.onAfterUnbindObservable.add(function () {
            (i._forcedViewPosition = null), i.updateTransformMatrix(!0);
          });
      }
      return (
        Object.defineProperty(e.prototype, "samples", {
          get: function () {
            return this._renderTargetTexture.samples;
          },
          set: function (e) {
            this._renderTargetTexture.samples = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "refreshRate", {
          get: function () {
            return this._renderTargetTexture.refreshRate;
          },
          set: function (e) {
            this._renderTargetTexture.refreshRate = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.getScene = function () {
          return this._scene;
        }),
        Object.defineProperty(e.prototype, "cubeTexture", {
          get: function () {
            return this._renderTargetTexture;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "renderList", {
          get: function () {
            return this._renderTargetTexture.renderList;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.attachToMesh = function (e) {
          this._attachedMesh = e;
        }),
        (e.prototype.setRenderingAutoClearDepthStencil = function (e, t) {
          this._renderTargetTexture.setRenderingAutoClearDepthStencil(e, t);
        }),
        (e.prototype.dispose = function () {
          var e = this._scene.reflectionProbes.indexOf(this);
          -1 !== e && this._scene.reflectionProbes.splice(e, 1),
            this._renderTargetTexture &&
              (this._renderTargetTexture.dispose(),
              (this._renderTargetTexture = null));
        }),
        (e.prototype.toString = function (e) {
          var t = "Name: " + this.name;
          return (
            e &&
              ((t += ", position: " + this.position.toString()),
              this._attachedMesh &&
                (t += ", attached mesh: " + this._attachedMesh.name)),
            t
          );
        }),
        (e.prototype.getClassName = function () {
          return "ReflectionProbe";
        }),
        (e.prototype.serialize = function () {
          var e = ge.Serialize(this, this._renderTargetTexture.serialize());
          return (e.isReflectionProbe = !0), e;
        }),
        (e.Parse = function (t, i, n) {
          var r = null;
          if (i.reflectionProbes)
            for (var o = 0; o < i.reflectionProbes.length; o++) {
              var s = i.reflectionProbes[o];
              if (s.name === t.name) {
                r = s;
                break;
              }
            }
          return (
            ((r = ge.Parse(
              function () {
                return (
                  r || new e(t.name, t.renderTargetSize, i, t._generateMipMaps)
                );
              },
              t,
              i,
              n
            )).cubeTexture._waitingRenderList = t.renderList),
            t._attachedMesh && r.attachToMesh(i.getMeshByID(t._attachedMesh)),
            r
          );
        }),
        R([de()], e.prototype, "_attachedMesh", void 0),
        R([he()], e.prototype, "position", void 0),
        e
      );
    })(),
    Tl = (function () {
      function e() {}
      return (e.LoaderInjectedPhysicsEngine = void 0), e;
    })(),
    Sl = function (e, t, i, n) {
      for (var r = 0, o = t.materials.length; r < o; r++) {
        var s = t.materials[r];
        if (s.id === e) return si.Parse(s, i, n);
      }
      return null;
    },
    Cl = function (e, t, i) {
      for (var n in t) if (e.name === t[n]) return i.push(e.id), !0;
      return !(
        !e.parentId ||
        -1 === i.indexOf(e.parentId) ||
        (i.push(e.id), 0)
      );
    },
    xl = function (e, t) {
      return (
        e +
        " of " +
        (t
          ? t.file +
            " from " +
            t.name +
            " version: " +
            t.version +
            ", exporter version: " +
            t.exporter_version
          : "unknown")
      );
    },
    El = function (e, t) {
      var i = t;
      if (t._waitingData.lods) {
        if (t._waitingData.lods.ids && t._waitingData.lods.ids.length > 0) {
          var n = t._waitingData.lods.ids,
            r = i.isEnabled(!1);
          if (t._waitingData.lods.distances) {
            var o = t._waitingData.lods.distances;
            if (o.length >= n.length) {
              var s = o.length > n.length ? o[o.length - 1] : 0;
              i.setEnabled(!1);
              for (var a = 0; a < n.length; a++) {
                var l = n[a],
                  c = e.getMeshByID(l);
                null != c && i.addLODLevel(o[a], c);
              }
              s > 0 && i.addLODLevel(s, null), !0 === r && i.setEnabled(!0);
            } else yt.Warn("Invalid level of detail distances for " + t.name);
          }
        }
        t._waitingData.lods = null;
      }
    },
    Pl = function (e, i, n, r, o) {
      void 0 === o && (o = !1);
      var s = new Ji(e),
        a = "importScene has failed JSON parse";
      try {
        var l = JSON.parse(i);
        a = "";
        var c,
          u,
          d = ds.loggingLevel === ds.DETAILED_LOGGING;
        if (void 0 !== l.environmentTexture && null !== l.environmentTexture) {
          var p = void 0 === l.isPBR || l.isPBR;
          if (
            l.environmentTextureType &&
            "BABYLON.HDRCubeTexture" === l.environmentTextureType
          ) {
            var f = l.environmentTextureSize ? l.environmentTextureSize : 128,
              _ = new dl(
                (l.environmentTexture.match(/https?:\/\//g) ? "" : n) +
                  l.environmentTexture,
                e,
                f,
                !0,
                !p
              );
            l.environmentTextureRotationY &&
              (_.rotationY = l.environmentTextureRotationY),
              (e.environmentTexture = _);
          } else if (X.EndsWith(l.environmentTexture, ".env")) {
            var m = new Fs(
              (l.environmentTexture.match(/https?:\/\//g) ? "" : n) +
                l.environmentTexture,
              e
            );
            l.environmentTextureRotationY &&
              (m.rotationY = l.environmentTextureRotationY),
              (e.environmentTexture = m);
          } else {
            var g = Fs.CreateFromPrefilteredData(
              (l.environmentTexture.match(/https?:\/\//g) ? "" : n) +
                l.environmentTexture,
              e
            );
            l.environmentTextureRotationY &&
              (g.rotationY = l.environmentTextureRotationY),
              (e.environmentTexture = g);
          }
          if (!0 === l.createDefaultSkybox) {
            var v =
                void 0 !== e.activeCamera && null !== e.activeCamera
                  ? (e.activeCamera.maxZ - e.activeCamera.minZ) / 2
                  : 1e3,
              y = l.skyboxBlurLevel || 0;
            e.createDefaultSkybox(e.environmentTexture, p, v, y);
          }
          s.environmentTexture = e.environmentTexture;
        }
        if (
          (void 0 !== l.environmentIntensity &&
            null !== l.environmentIntensity &&
            (e.environmentIntensity = l.environmentIntensity),
          void 0 !== l.lights && null !== l.lights)
        )
          for (c = 0, u = l.lights.length; c < u; c++) {
            var b = l.lights[c],
              T = ni.Parse(b, e);
            T &&
              (s.lights.push(T),
              (a += 0 === c ? "\n\tLights:" : ""),
              (a += "\n\t\t" + T.toString(d)));
          }
        if (void 0 !== l.reflectionProbes && null !== l.reflectionProbes)
          for (c = 0, u = l.reflectionProbes.length; c < u; c++) {
            var S = l.reflectionProbes[c],
              C = bl.Parse(S, e, n);
            C &&
              (s.reflectionProbes.push(C),
              (a += 0 === c ? "\n\tReflection Probes:" : ""),
              (a += "\n\t\t" + C.toString(d)));
          }
        if (void 0 !== l.animations && null !== l.animations)
          for (c = 0, u = l.animations.length; c < u; c++) {
            var x = l.animations[c],
              E = h.GetClass("BABYLON.Animation");
            if (E) {
              var P = E.Parse(x);
              e.animations.push(P),
                s.animations.push(P),
                (a += 0 === c ? "\n\tAnimations:" : ""),
                (a += "\n\t\t" + P.toString(d));
            }
          }
        if (void 0 !== l.materials && null !== l.materials)
          for (c = 0, u = l.materials.length; c < u; c++) {
            var A = l.materials[c],
              R = si.Parse(A, e, n);
            R &&
              (s.materials.push(R),
              (a += 0 === c ? "\n\tMaterials:" : ""),
              (a += "\n\t\t" + R.toString(d)),
              R.getActiveTextures().forEach(function (e) {
                -1 == s.textures.indexOf(e) && s.textures.push(e);
              }));
          }
        if (void 0 !== l.multiMaterials && null !== l.multiMaterials)
          for (c = 0, u = l.multiMaterials.length; c < u; c++) {
            var M = l.multiMaterials[c],
              O = Gi.ParseMultiMaterial(M, e);
            s.multiMaterials.push(O),
              (a += 0 === c ? "\n\tMultiMaterials:" : ""),
              (a += "\n\t\t" + O.toString(d)),
              O.getActiveTextures().forEach(function (e) {
                -1 == s.textures.indexOf(e) && s.textures.push(e);
              });
          }
        if (void 0 !== l.morphTargetManagers && null !== l.morphTargetManagers)
          for (var I = 0, D = l.morphTargetManagers; I < D.length; I++) {
            var w = D[I];
            s.morphTargetManagers.push(fl.Parse(w, e));
          }
        if (void 0 !== l.skeletons && null !== l.skeletons)
          for (c = 0, u = l.skeletons.length; c < u; c++) {
            var N = l.skeletons[c],
              L = Tn.Parse(N, e);
            s.skeletons.push(L),
              (a += 0 === c ? "\n\tSkeletons:" : ""),
              (a += "\n\t\t" + L.toString(d));
          }
        var B = l.geometries;
        if (null != B) {
          var V = new Array(),
            k = B.vertexData;
          if (null != k)
            for (c = 0, u = k.length; c < u; c++) {
              var U = k[c];
              V.push(zi.Parse(U, e, n));
            }
          V.forEach(function (e) {
            e && s.geometries.push(e);
          });
        }
        if (void 0 !== l.transformNodes && null !== l.transformNodes)
          for (c = 0, u = l.transformNodes.length; c < u; c++) {
            var z = l.transformNodes[c],
              G = At.Parse(z, e, n);
            s.transformNodes.push(G);
          }
        if (void 0 !== l.meshes && null !== l.meshes)
          for (c = 0, u = l.meshes.length; c < u; c++) {
            var W = l.meshes[c],
              H = Qi.Parse(W, e, n);
            if ((s.meshes.push(H), H.hasInstances))
              for (var j = 0, Y = H.instances; j < Y.length; j++) {
                var K = Y[j];
                s.meshes.push(K);
              }
            (a += 0 === c ? "\n\tMeshes:" : ""),
              (a += "\n\t\t" + H.toString(d));
          }
        if (void 0 !== l.cameras && null !== l.cameras)
          for (c = 0, u = l.cameras.length; c < u; c++) {
            var q = l.cameras[c],
              Z = Zt.Parse(q, e);
            s.cameras.push(Z),
              (a += 0 === c ? "\n\tCameras:" : ""),
              (a += "\n\t\t" + Z.toString(d));
          }
        if (void 0 !== l.postProcesses && null !== l.postProcesses)
          for (c = 0, u = l.postProcesses.length; c < u; c++) {
            var J = l.postProcesses[c],
              $ = vr.Parse(J, e, n);
            $ &&
              (s.postProcesses.push($),
              (a += 0 === c ? "\nPostprocesses:" : ""),
              (a += "\n\t\t" + $.toString()));
          }
        if (void 0 !== l.animationGroups && null !== l.animationGroups)
          for (c = 0, u = l.animationGroups.length; c < u; c++) {
            var ee = l.animationGroups[c],
              te = Ri.Parse(ee, e);
            s.animationGroups.push(te),
              (a += 0 === c ? "\n\tAnimationGroups:" : ""),
              (a += "\n\t\t" + te.toString(d));
          }
        for (c = 0, u = e.cameras.length; c < u; c++)
          (Z = e.cameras[c])._waitingParentId &&
            ((Z.parent = e.getLastEntryByID(Z._waitingParentId)),
            (Z._waitingParentId = null));
        for (c = 0, u = e.lights.length; c < u; c++) {
          var ie = e.lights[c];
          ie &&
            ie._waitingParentId &&
            ((ie.parent = e.getLastEntryByID(ie._waitingParentId)),
            (ie._waitingParentId = null));
        }
        for (c = 0, u = e.transformNodes.length; c < u; c++) {
          var ne = e.transformNodes[c];
          ne._waitingParentId &&
            ((ne.parent = e.getLastEntryByID(ne._waitingParentId)),
            (ne._waitingParentId = null));
        }
        for (c = 0, u = e.meshes.length; c < u; c++)
          (H = e.meshes[c])._waitingParentId &&
            ((H.parent = e.getLastEntryByID(H._waitingParentId)),
            (H._waitingParentId = null)),
            H._waitingData.lods && El(e, H);
        for (c = 0, u = e.skeletons.length; c < u; c++)
          (L = e.skeletons[c])._hasWaitingData &&
            (null != L.bones &&
              L.bones.forEach(function (t) {
                if (t._waitingTransformNodeId) {
                  var i = e.getLastEntryByID(t._waitingTransformNodeId);
                  i && t.linkTransformNode(i),
                    (t._waitingTransformNodeId = null);
                }
              }),
            L._waitingOverrideMeshId &&
              ((L.overrideMesh = e.getMeshByID(L._waitingOverrideMeshId)),
              (L._waitingOverrideMeshId = null)),
            (L._hasWaitingData = null));
        for (c = 0, u = e.meshes.length; c < u; c++) {
          var re = e.meshes[c];
          re._waitingData.freezeWorldMatrix
            ? (re.freezeWorldMatrix(),
              (re._waitingData.freezeWorldMatrix = null))
            : re.computeWorldMatrix(!0);
        }
        for (c = 0, u = e.lights.length; c < u; c++) {
          var oe = e.lights[c];
          if (oe._excludedMeshesIds.length > 0) {
            for (var se = 0; se < oe._excludedMeshesIds.length; se++) {
              var ae = e.getMeshByID(oe._excludedMeshesIds[se]);
              ae && oe.excludedMeshes.push(ae);
            }
            oe._excludedMeshesIds = [];
          }
          if (oe._includedOnlyMeshesIds.length > 0) {
            for (var le = 0; le < oe._includedOnlyMeshesIds.length; le++) {
              var ce = e.getMeshByID(oe._includedOnlyMeshesIds[le]);
              ce && oe.includedOnlyMeshes.push(ce);
            }
            oe._includedOnlyMeshesIds = [];
          }
        }
        for (t.Parse(l, e, s, n), c = 0, u = e.meshes.length; c < u; c++)
          (H = e.meshes[c])._waitingData.actions &&
            (Q.Parse(H._waitingData.actions, H, e),
            (H._waitingData.actions = null));
        void 0 !== l.actions &&
          null !== l.actions &&
          Q.Parse(l.actions, null, e);
      } catch (e) {
        var ue = xl("loadAssets", l ? l.producer : "Unknown") + a;
        if (!r) throw (F.Log(ue), e);
        r(ue, e);
      } finally {
        o || s.removeAllFromScene(),
          null !== a &&
            ds.loggingLevel !== ds.NO_LOGGING &&
            F.Log(
              xl("loadAssets", l ? l.producer : "Unknown") +
                (ds.loggingLevel !== ds.MINIMAL_LOGGING ? a : "")
            );
      }
      return s;
    };
  ds.RegisterPlugin({
    name: "babylon.js",
    extensions: ".babylon",
    canDirectLoad: function (e) {
      return -1 !== e.indexOf("babylon");
    },
    importMesh: function (e, i, n, r, o, s, a, l) {
      var c = "importMesh has failed JSON parse";
      try {
        var u = JSON.parse(n);
        c = "";
        var h = ds.loggingLevel === ds.DETAILED_LOGGING;
        e ? Array.isArray(e) || (e = [e]) : (e = null);
        var d = new Array();
        if (void 0 !== u.meshes && null !== u.meshes) {
          var p,
            f,
            _,
            m = [],
            g = [];
          for (p = 0, f = u.meshes.length; p < f; p++) {
            var v = u.meshes[p];
            if (null === e || Cl(v, e, d)) {
              if (
                (null !== e && delete e[e.indexOf(v.name)],
                void 0 !== v.geometryId &&
                  null !== v.geometryId &&
                  void 0 !== u.geometries &&
                  null !== u.geometries)
              ) {
                var y = !1;
                [
                  "boxes",
                  "spheres",
                  "cylinders",
                  "toruses",
                  "grounds",
                  "planes",
                  "torusKnots",
                  "vertexData",
                ].forEach(function (e) {
                  !0 !== y &&
                    u.geometries[e] &&
                    Array.isArray(u.geometries[e]) &&
                    u.geometries[e].forEach(function (t) {
                      if (t.id === v.geometryId) {
                        switch (e) {
                          case "vertexData":
                            zi.Parse(t, i, r);
                        }
                        y = !0;
                      }
                    });
                }),
                  !1 === y && F.Warn("Geometry not found for mesh " + v.id);
              }
              if (v.materialId) {
                var b = -1 !== g.indexOf(v.materialId);
                if (
                  !1 === b &&
                  void 0 !== u.multiMaterials &&
                  null !== u.multiMaterials
                )
                  for (var T = 0, S = u.multiMaterials.length; T < S; T++) {
                    var C = u.multiMaterials[T];
                    if (C.id === v.materialId) {
                      for (var x = 0, E = C.materials.length; x < E; x++) {
                        var P,
                          A = C.materials[x];
                        g.push(A),
                          (P = Sl(A, u, i, r)) &&
                            (c += "\n\tMaterial " + P.toString(h));
                      }
                      g.push(C.id);
                      var R = Gi.ParseMultiMaterial(C, i);
                      R &&
                        ((b = !0),
                        (c += "\n\tMulti-Material " + R.toString(h)));
                      break;
                    }
                  }
                !1 === b &&
                  (g.push(v.materialId),
                  (P = Sl(v.materialId, u, i, r))
                    ? (c += "\n\tMaterial " + P.toString(h))
                    : F.Warn("Material not found for mesh " + v.id));
              }
              if (
                v.skeletonId > -1 &&
                void 0 !== u.skeletons &&
                null !== u.skeletons &&
                !1 == m.indexOf(v.skeletonId) > -1
              )
                for (var M = 0, O = u.skeletons.length; M < O; M++) {
                  var I = u.skeletons[M];
                  if (I.id === v.skeletonId) {
                    var D = Tn.Parse(I, i);
                    a.push(D),
                      m.push(I.id),
                      (c += "\n\tSkeleton " + D.toString(h));
                  }
                }
              if (
                void 0 !== u.morphTargetManagers &&
                null !== u.morphTargetManagers
              )
                for (var w = 0, N = u.morphTargetManagers; w < N.length; w++) {
                  var L = N[w];
                  fl.Parse(L, i);
                }
              var B = Qi.Parse(v, i, r);
              o.push(B), (c += "\n\tMesh " + B.toString(h));
            }
          }
          for (p = 0, f = i.meshes.length; p < f; p++)
            (_ = i.meshes[p])._waitingParentId &&
              ((_.parent = i.getLastEntryByID(_._waitingParentId)),
              (_._waitingParentId = null)),
              _._waitingData.lods && El(i, _);
          for (p = 0, f = i.skeletons.length; p < f; p++)
            (D = i.skeletons[p])._hasWaitingData &&
              (null != D.bones &&
                D.bones.forEach(function (e) {
                  if (e._waitingTransformNodeId) {
                    var t = i.getLastEntryByID(e._waitingTransformNodeId);
                    t && e.linkTransformNode(t),
                      (e._waitingTransformNodeId = null);
                  }
                }),
              D._waitingOverrideMeshId &&
                ((D.overrideMesh = i.getMeshByID(D._waitingOverrideMeshId)),
                (D._waitingOverrideMeshId = null)),
              (D._hasWaitingData = null));
          for (p = 0, f = i.meshes.length; p < f; p++)
            (_ = i.meshes[p])._waitingData.freezeWorldMatrix
              ? (_.freezeWorldMatrix(),
                (_._waitingData.freezeWorldMatrix = null))
              : _.computeWorldMatrix(!0);
        }
        if (void 0 !== u.particleSystems && null !== u.particleSystems) {
          var V = t.GetIndividualParser(hi.NAME_PARTICLESYSTEM);
          if (V)
            for (p = 0, f = u.particleSystems.length; p < f; p++) {
              var k = u.particleSystems[p];
              -1 !== d.indexOf(k.emitterId) && s.push(V(k, i, r));
            }
        }
        return !0;
      } catch (e) {
        var U = xl("importMesh", u ? u.producer : "Unknown") + c;
        if (!l) throw (F.Log(U), e);
        l(U, e);
      } finally {
        null !== c &&
          ds.loggingLevel !== ds.NO_LOGGING &&
          F.Log(
            xl("importMesh", u ? u.producer : "Unknown") +
              (ds.loggingLevel !== ds.MINIMAL_LOGGING ? c : "")
          );
      }
      return !1;
    },
    load: function (e, t, i, n) {
      var r = "importScene has failed JSON parse";
      try {
        var o = JSON.parse(t);
        if (
          ((r = ""),
          void 0 !== o.useDelayedTextureLoading &&
            null !== o.useDelayedTextureLoading &&
            (e.useDelayedTextureLoading =
              o.useDelayedTextureLoading &&
              !ds.ForceFullSceneLoadingForIncremental),
          void 0 !== o.autoClear &&
            null !== o.autoClear &&
            (e.autoClear = o.autoClear),
          void 0 !== o.clearColor &&
            null !== o.clearColor &&
            (e.clearColor = T.FromArray(o.clearColor)),
          void 0 !== o.ambientColor &&
            null !== o.ambientColor &&
            (e.ambientColor = b.FromArray(o.ambientColor)),
          void 0 !== o.gravity &&
            null !== o.gravity &&
            (e.gravity = f.FromArray(o.gravity)),
          o.fogMode && 0 !== o.fogMode)
        )
          switch (
            ((e.fogMode = o.fogMode),
            (e.fogColor = b.FromArray(o.fogColor)),
            (e.fogStart = o.fogStart),
            (e.fogEnd = o.fogEnd),
            (e.fogDensity = o.fogDensity),
            (r += "\tFog mode for scene:  "),
            e.fogMode)
          ) {
            case 1:
              r += "exp\n";
              break;
            case 2:
              r += "exp2\n";
              break;
            case 3:
              r += "linear\n";
          }
        if (o.physicsEnabled) {
          var s;
          "cannon" === o.physicsEngine
            ? (s = new gl(void 0, void 0, Tl.LoaderInjectedPhysicsEngine))
            : "oimo" === o.physicsEngine
              ? (s = new vl(void 0, Tl.LoaderInjectedPhysicsEngine))
              : "ammo" === o.physicsEngine &&
                (s = new yl(void 0, Tl.LoaderInjectedPhysicsEngine, void 0)),
            (r =
              "\tPhysics engine " +
              (o.physicsEngine ? o.physicsEngine : "oimo") +
              " enabled\n");
          var a = o.physicsGravity ? f.FromArray(o.physicsGravity) : null;
          e.enablePhysics(a, s);
        }
        return (
          void 0 !== o.metadata &&
            null !== o.metadata &&
            (e.metadata = o.metadata),
          void 0 !== o.collisionsEnabled &&
            null !== o.collisionsEnabled &&
            (e.collisionsEnabled = o.collisionsEnabled),
          !!Pl(e, t, i, n, !0) &&
            (o.autoAnimate &&
              e.beginAnimation(
                e,
                o.autoAnimateFrom,
                o.autoAnimateTo,
                o.autoAnimateLoop,
                o.autoAnimateSpeed || 1
              ),
            void 0 !== o.activeCameraID &&
              null !== o.activeCameraID &&
              e.setActiveCameraByID(o.activeCameraID),
            !0)
        );
      } catch (e) {
        var l = xl("importScene", o ? o.producer : "Unknown") + r;
        if (!n) throw (F.Log(l), e);
        n(l, e);
      } finally {
        null !== r &&
          ds.loggingLevel !== ds.NO_LOGGING &&
          F.Log(
            xl("importScene", o ? o.producer : "Unknown") +
              (ds.loggingLevel !== ds.MINIMAL_LOGGING ? r : "")
          );
      }
      return !1;
    },
    loadAssetContainer: function (e, t, i, n) {
      return Pl(e, t, i, n);
    },
  });
  var Al = (function () {
    function e(e) {
      void 0 === e && (e = {}),
        (this._isEnabled = !0),
        (this.bias = void 0 === e.bias ? 0 : e.bias),
        (this.power = void 0 === e.power ? 1 : e.power),
        (this.leftColor = e.leftColor || b.White()),
        (this.rightColor = e.rightColor || b.Black()),
        !1 === e.isEnabled && (this.isEnabled = !1);
    }
    return (
      Object.defineProperty(e.prototype, "isEnabled", {
        get: function () {
          return this._isEnabled;
        },
        set: function (e) {
          this._isEnabled !== e &&
            ((this._isEnabled = e), It.MarkAllMaterialsAsDirty(20));
        },
        enumerable: !1,
        configurable: !0,
      }),
      (e.prototype.clone = function () {
        var t = new e();
        return K.DeepCopy(this, t), t;
      }),
      (e.prototype.equals = function (e) {
        return (
          e &&
          this.bias === e.bias &&
          this.power === e.power &&
          this.leftColor.equals(e.leftColor) &&
          this.rightColor.equals(e.rightColor) &&
          this.isEnabled === e.isEnabled
        );
      }),
      (e.prototype.serialize = function () {
        return {
          isEnabled: this.isEnabled,
          leftColor: this.leftColor.asArray(),
          rightColor: this.rightColor.asArray(),
          bias: this.bias,
          power: this.power,
        };
      }),
      (e.Parse = function (t) {
        return new e({
          isEnabled: t.isEnabled,
          leftColor: b.FromArray(t.leftColor),
          rightColor: b.FromArray(t.rightColor),
          bias: t.bias,
          power: t.power || 1,
        });
      }),
      e
    );
  })();
  ge._FresnelParametersParser = Al.Parse;
  var Rl = (function (e) {
      function t(t, i) {
        var n = e.call(this, t, i) || this;
        return (
          (n.maxSimultaneousLights = 4),
          (n.disableLighting = !1),
          (n.invertNormalMapX = !1),
          (n.invertNormalMapY = !1),
          (n.emissiveColor = new b(0, 0, 0)),
          (n.occlusionStrength = 1),
          (n.useLightmapAsShadowmap = !1),
          (n._useAlphaFromAlbedoTexture = !0),
          (n._useAmbientInGrayScale = !0),
          n
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "doubleSided", {
          get: function () {
            return this._twoSidedLighting;
          },
          set: function (e) {
            this._twoSidedLighting !== e &&
              ((this._twoSidedLighting = e),
              (this.backFaceCulling = !e),
              this._markAllSubMeshesAsTexturesDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getClassName = function () {
          return "PBRBaseSimpleMaterial";
        }),
        R(
          [se(), oe("_markAllSubMeshesAsLightsDirty")],
          t.prototype,
          "maxSimultaneousLights",
          void 0
        ),
        R(
          [se(), oe("_markAllSubMeshesAsLightsDirty")],
          t.prototype,
          "disableLighting",
          void 0
        ),
        R(
          [ae(), oe("_markAllSubMeshesAsTexturesDirty", "_reflectionTexture")],
          t.prototype,
          "environmentTexture",
          void 0
        ),
        R(
          [se(), oe("_markAllSubMeshesAsTexturesDirty")],
          t.prototype,
          "invertNormalMapX",
          void 0
        ),
        R(
          [se(), oe("_markAllSubMeshesAsTexturesDirty")],
          t.prototype,
          "invertNormalMapY",
          void 0
        ),
        R(
          [ae(), oe("_markAllSubMeshesAsTexturesDirty", "_bumpTexture")],
          t.prototype,
          "normalTexture",
          void 0
        ),
        R(
          [le("emissive"), oe("_markAllSubMeshesAsTexturesDirty")],
          t.prototype,
          "emissiveColor",
          void 0
        ),
        R(
          [ae(), oe("_markAllSubMeshesAsTexturesDirty")],
          t.prototype,
          "emissiveTexture",
          void 0
        ),
        R(
          [
            se(),
            oe("_markAllSubMeshesAsTexturesDirty", "_ambientTextureStrength"),
          ],
          t.prototype,
          "occlusionStrength",
          void 0
        ),
        R(
          [ae(), oe("_markAllSubMeshesAsTexturesDirty", "_ambientTexture")],
          t.prototype,
          "occlusionTexture",
          void 0
        ),
        R(
          [se(), oe("_markAllSubMeshesAsTexturesDirty", "_alphaCutOff")],
          t.prototype,
          "alphaCutOff",
          void 0
        ),
        R([se()], t.prototype, "doubleSided", null),
        R(
          [ae(), oe("_markAllSubMeshesAsTexturesDirty", null)],
          t.prototype,
          "lightmapTexture",
          void 0
        ),
        R(
          [se(), oe("_markAllSubMeshesAsTexturesDirty")],
          t.prototype,
          "useLightmapAsShadowmap",
          void 0
        ),
        t
      );
    })(qs),
    Ml = (function (e) {
      function t(t, i) {
        var n = e.call(this, t, i) || this;
        return (
          (n._useRoughnessFromMetallicTextureAlpha = !1),
          (n._useRoughnessFromMetallicTextureGreen = !0),
          (n._useMetallnessFromMetallicTextureBlue = !0),
          (n.metallic = 1),
          (n.roughness = 1),
          n
        );
      }
      return (
        P(t, e),
        (t.prototype.getClassName = function () {
          return "PBRMetallicRoughnessMaterial";
        }),
        (t.prototype.clone = function (e) {
          var i = this,
            n = ge.Clone(function () {
              return new t(e, i.getScene());
            }, this);
          return (
            (n.id = e),
            (n.name = e),
            this.clearCoat.copyTo(n.clearCoat),
            this.anisotropy.copyTo(n.anisotropy),
            this.brdf.copyTo(n.brdf),
            this.sheen.copyTo(n.sheen),
            this.subSurface.copyTo(n.subSurface),
            n
          );
        }),
        (t.prototype.serialize = function () {
          var e = ge.Serialize(this);
          return (
            (e.customType = "BABYLON.PBRMetallicRoughnessMaterial"),
            (e.clearCoat = this.clearCoat.serialize()),
            (e.anisotropy = this.anisotropy.serialize()),
            (e.brdf = this.brdf.serialize()),
            (e.sheen = this.sheen.serialize()),
            (e.subSurface = this.subSurface.serialize()),
            e
          );
        }),
        (t.Parse = function (e, i, n) {
          var r = ge.Parse(
            function () {
              return new t(e.name, i);
            },
            e,
            i,
            n
          );
          return (
            e.clearCoat && r.clearCoat.parse(e.clearCoat, i, n),
            e.anisotropy && r.anisotropy.parse(e.anisotropy, i, n),
            e.brdf && r.brdf.parse(e.brdf, i, n),
            e.sheen && r.sheen.parse(e.sheen, i, n),
            e.subSurface && r.subSurface.parse(e.subSurface, i, n),
            r
          );
        }),
        R(
          [le(), oe("_markAllSubMeshesAsTexturesDirty", "_albedoColor")],
          t.prototype,
          "baseColor",
          void 0
        ),
        R(
          [ae(), oe("_markAllSubMeshesAsTexturesDirty", "_albedoTexture")],
          t.prototype,
          "baseTexture",
          void 0
        ),
        R(
          [se(), oe("_markAllSubMeshesAsTexturesDirty")],
          t.prototype,
          "metallic",
          void 0
        ),
        R(
          [se(), oe("_markAllSubMeshesAsTexturesDirty")],
          t.prototype,
          "roughness",
          void 0
        ),
        R(
          [ae(), oe("_markAllSubMeshesAsTexturesDirty", "_metallicTexture")],
          t.prototype,
          "metallicRoughnessTexture",
          void 0
        ),
        t
      );
    })(Rl);
  h.RegisteredTypes["BABYLON.PBRMetallicRoughnessMaterial"] = Ml;
  var Ol = (function (e) {
    function t(t, i) {
      var n = e.call(this, t, i) || this;
      return (n._useMicroSurfaceFromReflectivityMapAlpha = !0), n;
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "PBRSpecularGlossinessMaterial";
      }),
      (t.prototype.clone = function (e) {
        var i = this,
          n = ge.Clone(function () {
            return new t(e, i.getScene());
          }, this);
        return (
          (n.id = e),
          (n.name = e),
          this.clearCoat.copyTo(n.clearCoat),
          this.anisotropy.copyTo(n.anisotropy),
          this.brdf.copyTo(n.brdf),
          this.sheen.copyTo(n.sheen),
          this.subSurface.copyTo(n.subSurface),
          n
        );
      }),
      (t.prototype.serialize = function () {
        var e = ge.Serialize(this);
        return (
          (e.customType = "BABYLON.PBRSpecularGlossinessMaterial"),
          (e.clearCoat = this.clearCoat.serialize()),
          (e.anisotropy = this.anisotropy.serialize()),
          (e.brdf = this.brdf.serialize()),
          (e.sheen = this.sheen.serialize()),
          (e.subSurface = this.subSurface.serialize()),
          e
        );
      }),
      (t.Parse = function (e, i, n) {
        var r = ge.Parse(
          function () {
            return new t(e.name, i);
          },
          e,
          i,
          n
        );
        return (
          e.clearCoat && r.clearCoat.parse(e.clearCoat, i, n),
          e.anisotropy && r.anisotropy.parse(e.anisotropy, i, n),
          e.brdf && r.brdf.parse(e.brdf, i, n),
          e.sheen && r.sheen.parse(e.sheen, i, n),
          e.subSurface && r.subSurface.parse(e.subSurface, i, n),
          r
        );
      }),
      R(
        [le("diffuse"), oe("_markAllSubMeshesAsTexturesDirty", "_albedoColor")],
        t.prototype,
        "diffuseColor",
        void 0
      ),
      R(
        [ae(), oe("_markAllSubMeshesAsTexturesDirty", "_albedoTexture")],
        t.prototype,
        "diffuseTexture",
        void 0
      ),
      R(
        [
          le("specular"),
          oe("_markAllSubMeshesAsTexturesDirty", "_reflectivityColor"),
        ],
        t.prototype,
        "specularColor",
        void 0
      ),
      R(
        [se(), oe("_markAllSubMeshesAsTexturesDirty", "_microSurface")],
        t.prototype,
        "glossiness",
        void 0
      ),
      R(
        [ae(), oe("_markAllSubMeshesAsTexturesDirty", "_reflectivityTexture")],
        t.prototype,
        "specularGlossinessTexture",
        void 0
      ),
      t
    );
  })(Rl);
  h.RegisteredTypes["BABYLON.PBRSpecularGlossinessMaterial"] = Ol;
  var Il = (function (e) {
    function t(t, i, n) {
      void 0 === n && (n = null);
      var r = e.call(this, i) || this;
      if (!t) return r;
      if (
        ((r._textureMatrix = g.Identity()),
        (r.name = t),
        (r.url = t),
        (r._onLoad = n),
        (r._texture = r._getFromCache(t, !0)),
        r._texture)
      )
        r._triggerOnLoad();
      else {
        var o = r.getScene();
        o && o.useDelayedTextureLoading
          ? (r.delayLoadState = 4)
          : r.loadTexture();
      }
      return r;
    }
    return (
      P(t, e),
      (t.prototype._triggerOnLoad = function () {
        this._onLoad && this._onLoad();
      }),
      (t.prototype.getTextureMatrix = function () {
        return this._textureMatrix;
      }),
      (t.prototype.load3dlTexture = function () {
        var e,
          i = this,
          n = this._getEngine();
        (e =
          1 === n.webGLVersion
            ? n.createRawTexture(null, 1, 1, 5, !1, !1, 2, null, 0)
            : n.createRawTexture3D(null, 1, 1, 1, 5, !1, !1, 2, null, 0)),
          (this._texture = e),
          (this._texture.isReady = !1),
          (this.isCube = !1),
          (this.is3D = n.webGLVersion > 1),
          (this.wrapU = 0),
          (this.wrapV = 0),
          (this.wrapR = 0),
          (this.anisotropicFilteringLevel = 1);
        var r = function (r) {
            if ("string" == typeof r) {
              for (
                var o,
                  s = null,
                  a = null,
                  l = r.split("\n"),
                  c = 0,
                  u = 0,
                  h = 0,
                  d = 0,
                  p = 0,
                  f = 0;
                f < l.length;
                f++
              )
                if (
                  ((o = l[f]),
                  t._noneEmptyLineRegex.test(o) && 0 !== o.indexOf("#"))
                ) {
                  var _ = o.split(" ");
                  if (0 !== c) {
                    if (0 != c) {
                      var m = Math.max(parseInt(_[0]), 0),
                        g = Math.max(parseInt(_[1]), 0),
                        v = Math.max(parseInt(_[2]), 0);
                      (p = Math.max(m, p)),
                        (p = Math.max(g, p)),
                        (p = Math.max(v, p));
                      var y = 4 * (u + d * c + h * c * c);
                      a && ((a[y + 0] = m), (a[y + 1] = g), (a[y + 2] = v)),
                        ++h % c == 0 &&
                          ((h = 0), ++d % c == 0 && (u++, (d = 0)));
                    }
                  } else
                    (c = _.length),
                      (s = new Uint8Array(c * c * c * 4)),
                      (a = new Float32Array(c * c * c * 4));
                }
              if (a && s)
                for (f = 0; f < a.length; f++)
                  if (f > 0 && (f + 1) % 4 == 0) s[f] = 255;
                  else {
                    var b = a[f];
                    s[f] = (b / p) * 255;
                  }
              e.is3D
                ? (e.updateSize(c, c, c), n.updateRawTexture3D(e, s, 5, !1))
                : (e.updateSize(c * c, c), n.updateRawTexture(e, s, 5, !1)),
                (e.isReady = !0),
                i._triggerOnLoad();
            }
          },
          o = this.getScene();
        return (
          o ? o._loadFile(this.url, r) : n._loadFile(this.url, r), this._texture
        );
      }),
      (t.prototype.loadTexture = function () {
        this.url &&
          this.url.toLocaleLowerCase().indexOf(".3dl") == this.url.length - 4 &&
          this.load3dlTexture();
      }),
      (t.prototype.clone = function () {
        var e = new t(this.url, this.getScene() || this._getEngine());
        return (e.level = this.level), e;
      }),
      (t.prototype.delayLoad = function () {
        4 === this.delayLoadState &&
          ((this.delayLoadState = 1),
          (this._texture = this._getFromCache(this.url, !0)),
          this._texture || this.loadTexture());
      }),
      (t.Parse = function (e, i) {
        var n = null;
        return (
          e.name &&
            !e.isRenderTarget &&
            (((n = new t(e.name, i)).name = e.name), (n.level = e.level)),
          n
        );
      }),
      (t.prototype.serialize = function () {
        if (!this.name) return null;
        var e = {};
        return (
          (e.name = this.name),
          (e.level = this.level),
          (e.customType = "BABYLON.ColorGradingTexture"),
          e
        );
      }),
      (t._noneEmptyLineRegex = /\S+/),
      t
    );
  })(fn);
  h.RegisteredTypes["BABYLON.ColorGradingTexture"] = Il;
  var Dl,
    wl = (function (e) {
      function t(t, i, n, r, o, s, a) {
        void 0 === r && (r = !1),
          void 0 === o && (o = !0),
          void 0 === s && (s = null),
          void 0 === a && (a = null);
        var l = e.call(this, i) || this;
        if (((l._onLoad = null), (l._onError = null), !t))
          throw new Error("Image url is not set");
        return (
          (l._coordinatesMode = mn.CUBIC_MODE),
          (l.name = t),
          (l.url = t),
          (l._size = n),
          (l._noMipmap = r),
          (l.gammaSpace = o),
          (l._onLoad = s),
          (l._onError = a),
          (l.hasAlpha = !1),
          (l.isCube = !0),
          (l._texture = l._getFromCache(t, l._noMipmap)),
          l._texture
            ? s &&
              (l._texture.isReady
                ? yt.SetImmediate(function () {
                    return s();
                  })
                : l._texture.onLoadedObservable.add(s))
            : i.useDelayedTextureLoading
              ? (l.delayLoadState = 4)
              : l.loadImage(l.loadTexture.bind(l), l._onError),
          l
        );
      }
      return (
        P(t, e),
        (t.prototype.loadImage = function (e, t) {
          var i = this,
            n = document.createElement("canvas"),
            r = new Image();
          r.addEventListener("load", function () {
            (i._width = r.width),
              (i._height = r.height),
              (n.width = i._width),
              (n.height = i._height);
            var t = n.getContext("2d");
            t.drawImage(r, 0, 0);
            var o = t.getImageData(0, 0, r.width, r.height);
            (i._buffer = o.data.buffer), n.remove(), e();
          }),
            r.addEventListener("error", function (e) {
              t && t(i.getClassName() + " could not be loaded", e);
            }),
            (r.src = this.url);
        }),
        (t.prototype.loadTexture = function () {
          var e = this,
            i = this.getScene();
          i &&
            (this._texture = i.getEngine().createRawCubeTextureFromUrl(
              this.url,
              i,
              this._size,
              4,
              i.getEngine().getCaps().textureFloat ? 1 : 7,
              this._noMipmap,
              function () {
                for (
                  var i = e.getFloat32ArrayFromArrayBuffer(e._buffer),
                    n = al.ConvertPanoramaToCubemap(
                      i,
                      e._width,
                      e._height,
                      e._size
                    ),
                    r = [],
                    o = 0;
                  o < 6;
                  o++
                ) {
                  var s = n[t._FacesMapping[o]];
                  r.push(s);
                }
                return r;
              },
              null,
              this._onLoad,
              this._onError
            ));
        }),
        (t.prototype.getFloat32ArrayFromArrayBuffer = function (e) {
          for (
            var t = new DataView(e),
              i = new Float32Array((3 * e.byteLength) / 4),
              n = 0,
              r = 0;
            r < e.byteLength;
            r++
          )
            (r + 1) % 4 != 0 && (i[n++] = t.getUint8(r) / 255);
          return i;
        }),
        (t.prototype.getClassName = function () {
          return "EquiRectangularCubeTexture";
        }),
        (t.prototype.clone = function () {
          var e = this.getScene();
          if (!e) return this;
          var i = new t(
            this.url,
            e,
            this._size,
            this._noMipmap,
            this.gammaSpace
          );
          return (
            (i.level = this.level),
            (i.wrapU = this.wrapU),
            (i.wrapV = this.wrapV),
            (i.coordinatesIndex = this.coordinatesIndex),
            (i.coordinatesMode = this.coordinatesMode),
            i
          );
        }),
        (t._FacesMapping = ["right", "left", "up", "down", "front", "back"]),
        t
      );
    })(fn),
    Nl =
      ((function (e) {
        function t(i, n, r) {
          var o = e.call(this, r.scene || r.engine) || this;
          return n && (r.engine || r.scene)
            ? ((r = A(A({}, t.DefaultOptions), r)),
              (o._generateMipMaps = r.generateMipMaps),
              (o._samplingMode = r.samplingMode),
              (o._textureMatrix = g.Identity()),
              (o.name = i),
              (o.element = n),
              (o._isVideo = n instanceof HTMLVideoElement),
              (o.anisotropicFilteringLevel = 1),
              o._createInternalTexture(),
              o)
            : o;
        }
        P(t, e),
          (t.prototype._createInternalTexture = function () {
            var e = 0,
              t = 0;
            this._isVideo
              ? ((e = this.element.videoWidth), (t = this.element.videoHeight))
              : ((e = this.element.width), (t = this.element.height));
            var i = this._getEngine();
            i &&
              (this._texture = i.createDynamicTexture(
                e,
                t,
                this._generateMipMaps,
                this._samplingMode
              )),
              this.update();
          }),
          (t.prototype.getTextureMatrix = function () {
            return this._textureMatrix;
          }),
          (t.prototype.update = function (e) {
            void 0 === e && (e = null);
            var t = this._getEngine();
            if (null != this._texture && null != t)
              if (this._isVideo) {
                var i = this.element;
                if (i.readyState < i.HAVE_CURRENT_DATA) return;
                t.updateVideoTexture(this._texture, i, null === e || e);
              } else {
                var n = this.element;
                t.updateDynamicTexture(this._texture, n, null === e || e, !1);
              }
          }),
          (t.DefaultOptions = {
            generateMipMaps: !1,
            samplingMode: 2,
            engine: null,
            scene: null,
          });
      })(fn),
      (function () {
        function e() {}
        return (
          (e.GetTGAHeader = function (e) {
            var t = 0;
            return {
              id_length: e[t++],
              colormap_type: e[t++],
              image_type: e[t++],
              colormap_index: e[t++] | (e[t++] << 8),
              colormap_length: e[t++] | (e[t++] << 8),
              colormap_size: e[t++],
              origin: [e[t++] | (e[t++] << 8), e[t++] | (e[t++] << 8)],
              width: e[t++] | (e[t++] << 8),
              height: e[t++] | (e[t++] << 8),
              pixel_size: e[t++],
              flags: e[t++],
            };
          }),
          (e.UploadContent = function (t, i) {
            if (i.length < 19)
              F.Error(
                "Unable to load TGA file - Not enough data to contain header"
              );
            else {
              var n = 18,
                r = e.GetTGAHeader(i);
              if (r.id_length + n > i.length)
                F.Error("Unable to load TGA file - Not enough data");
              else {
                n += r.id_length;
                var o,
                  s = !1,
                  a = !1,
                  l = !1;
                switch (r.image_type) {
                  case e._TYPE_RLE_INDEXED:
                    s = !0;
                  case e._TYPE_INDEXED:
                    a = !0;
                    break;
                  case e._TYPE_RLE_RGB:
                    s = !0;
                  case e._TYPE_RGB:
                    break;
                  case e._TYPE_RLE_GREY:
                    s = !0;
                  case e._TYPE_GREY:
                    l = !0;
                }
                var c,
                  u,
                  h,
                  d,
                  p,
                  f,
                  _,
                  m = r.pixel_size >> 3,
                  g = r.width * r.height * m;
                if (
                  (a &&
                    (c = i.subarray(
                      n,
                      (n += r.colormap_length * (r.colormap_size >> 3))
                    )),
                  s)
                ) {
                  var v, y, b;
                  o = new Uint8Array(g);
                  for (var T = 0, S = new Uint8Array(m); n < g && T < g; )
                    if (((y = 1 + (127 & (v = i[n++]))), 128 & v)) {
                      for (b = 0; b < m; ++b) S[b] = i[n++];
                      for (b = 0; b < y; ++b) o.set(S, T + b * m);
                      T += m * y;
                    } else {
                      for (y *= m, b = 0; b < y; ++b) o[T + b] = i[n++];
                      T += y;
                    }
                } else o = i.subarray(n, (n += a ? r.width * r.height : g));
                switch ((r.flags & e._ORIGIN_MASK) >> e._ORIGIN_SHIFT) {
                  default:
                  case e._ORIGIN_UL:
                    (u = 0),
                      (d = 1),
                      (_ = r.width),
                      (h = 0),
                      (p = 1),
                      (f = r.height);
                    break;
                  case e._ORIGIN_BL:
                    (u = 0),
                      (d = 1),
                      (_ = r.width),
                      (h = r.height - 1),
                      (p = -1),
                      (f = -1);
                    break;
                  case e._ORIGIN_UR:
                    (u = r.width - 1),
                      (d = -1),
                      (_ = -1),
                      (h = 0),
                      (p = 1),
                      (f = r.height);
                    break;
                  case e._ORIGIN_BR:
                    (u = r.width - 1),
                      (d = -1),
                      (_ = -1),
                      (h = r.height - 1),
                      (p = -1),
                      (f = -1);
                }
                var C = e[
                  "_getImageData" + (l ? "Grey" : "") + r.pixel_size + "bits"
                ](r, c, o, h, p, f, u, d, _);
                t.getEngine()._uploadDataToTextureDirectly(t, C);
              }
            }
          }),
          (e._getImageData8bits = function (e, t, i, n, r, o, s, a, l) {
            var c,
              u,
              h,
              d = i,
              p = t,
              f = e.width,
              _ = e.height,
              m = 0,
              g = new Uint8Array(f * _ * 4);
            for (h = n; h !== o; h += r)
              for (u = s; u !== l; u += a, m++)
                (c = d[m]),
                  (g[4 * (u + f * h) + 3] = 255),
                  (g[4 * (u + f * h) + 2] = p[3 * c + 0]),
                  (g[4 * (u + f * h) + 1] = p[3 * c + 1]),
                  (g[4 * (u + f * h) + 0] = p[3 * c + 2]);
            return g;
          }),
          (e._getImageData16bits = function (e, t, i, n, r, o, s, a, l) {
            var c,
              u,
              h,
              d = i,
              p = e.width,
              f = e.height,
              _ = 0,
              m = new Uint8Array(p * f * 4);
            for (h = n; h !== o; h += r)
              for (u = s; u !== l; u += a, _ += 2) {
                var g =
                    ((255 *
                      ((31744 & (c = d[_ + 0] + (d[_ + 1] << 8))) >> 10)) /
                      31) |
                    0,
                  v = ((255 * ((992 & c) >> 5)) / 31) | 0,
                  y = ((255 * (31 & c)) / 31) | 0;
                (m[4 * (u + p * h) + 0] = g),
                  (m[4 * (u + p * h) + 1] = v),
                  (m[4 * (u + p * h) + 2] = y),
                  (m[4 * (u + p * h) + 3] = 32768 & c ? 0 : 255);
              }
            return m;
          }),
          (e._getImageData24bits = function (e, t, i, n, r, o, s, a, l) {
            var c,
              u,
              h = i,
              d = e.width,
              p = e.height,
              f = 0,
              _ = new Uint8Array(d * p * 4);
            for (u = n; u !== o; u += r)
              for (c = s; c !== l; c += a, f += 3)
                (_[4 * (c + d * u) + 3] = 255),
                  (_[4 * (c + d * u) + 2] = h[f + 0]),
                  (_[4 * (c + d * u) + 1] = h[f + 1]),
                  (_[4 * (c + d * u) + 0] = h[f + 2]);
            return _;
          }),
          (e._getImageData32bits = function (e, t, i, n, r, o, s, a, l) {
            var c,
              u,
              h = i,
              d = e.width,
              p = e.height,
              f = 0,
              _ = new Uint8Array(d * p * 4);
            for (u = n; u !== o; u += r)
              for (c = s; c !== l; c += a, f += 4)
                (_[4 * (c + d * u) + 2] = h[f + 0]),
                  (_[4 * (c + d * u) + 1] = h[f + 1]),
                  (_[4 * (c + d * u) + 0] = h[f + 2]),
                  (_[4 * (c + d * u) + 3] = h[f + 3]);
            return _;
          }),
          (e._getImageDataGrey8bits = function (e, t, i, n, r, o, s, a, l) {
            var c,
              u,
              h,
              d = i,
              p = e.width,
              f = e.height,
              _ = 0,
              m = new Uint8Array(p * f * 4);
            for (h = n; h !== o; h += r)
              for (u = s; u !== l; u += a, _++)
                (c = d[_]),
                  (m[4 * (u + p * h) + 0] = c),
                  (m[4 * (u + p * h) + 1] = c),
                  (m[4 * (u + p * h) + 2] = c),
                  (m[4 * (u + p * h) + 3] = 255);
            return m;
          }),
          (e._getImageDataGrey16bits = function (e, t, i, n, r, o, s, a, l) {
            var c,
              u,
              h = i,
              d = e.width,
              p = e.height,
              f = 0,
              _ = new Uint8Array(d * p * 4);
            for (u = n; u !== o; u += r)
              for (c = s; c !== l; c += a, f += 2)
                (_[4 * (c + d * u) + 0] = h[f + 0]),
                  (_[4 * (c + d * u) + 1] = h[f + 0]),
                  (_[4 * (c + d * u) + 2] = h[f + 0]),
                  (_[4 * (c + d * u) + 3] = h[f + 1]);
            return _;
          }),
          (e._TYPE_INDEXED = 1),
          (e._TYPE_RGB = 2),
          (e._TYPE_GREY = 3),
          (e._TYPE_RLE_INDEXED = 9),
          (e._TYPE_RLE_RGB = 10),
          (e._TYPE_RLE_GREY = 11),
          (e._ORIGIN_MASK = 48),
          (e._ORIGIN_SHIFT = 4),
          (e._ORIGIN_BL = 0),
          (e._ORIGIN_BR = 1),
          (e._ORIGIN_UL = 2),
          (e._ORIGIN_UR = 3),
          e
        );
      })()),
    Ll = (function () {
      function e() {
        this.supportCascades = !1;
      }
      return (
        (e.prototype.canLoad = function (e) {
          return X.EndsWith(e, ".tga");
        }),
        (e.prototype.loadCubeData = function (e, t, i, n, r) {
          throw ".env not supported in Cube.";
        }),
        (e.prototype.loadData = function (e, t, i) {
          var n = new Uint8Array(e.buffer, e.byteOffset, e.byteLength),
            r = Nl.GetTGAHeader(n);
          i(r.width, r.height, t.generateMipMaps, !1, function () {
            Nl.UploadContent(t, n);
          });
        }),
        e
      );
    })();
  It._TextureLoaders.push(new Ll()),
    (function (e) {
      (e[(e.cTFETC1 = 0)] = "cTFETC1"),
        (e[(e.cTFBC1 = 1)] = "cTFBC1"),
        (e[(e.cTFBC4 = 2)] = "cTFBC4"),
        (e[(e.cTFPVRTC1_4_OPAQUE_ONLY = 3)] = "cTFPVRTC1_4_OPAQUE_ONLY"),
        (e[(e.cTFBC7_M6_OPAQUE_ONLY = 4)] = "cTFBC7_M6_OPAQUE_ONLY"),
        (e[(e.cTFETC2 = 5)] = "cTFETC2"),
        (e[(e.cTFBC3 = 6)] = "cTFBC3"),
        (e[(e.cTFBC5 = 7)] = "cTFBC5");
    })(Dl || (Dl = {}));
  var Fl = (function () {
    function e() {}
    return (
      (e.GetInternalFormatFromBasisFormat = function (e) {
        if (e === Dl.cTFETC1) return 36196;
        if (e === Dl.cTFBC1) return 33776;
        if (e === Dl.cTFBC3) return 33779;
        throw "The chosen Basis transcoder format is not currently supported";
      }),
      (e._CreateWorkerAsync = function () {
        var t = this;
        return (
          this._WorkerPromise ||
            (this._WorkerPromise = new Promise(function (i) {
              t._Worker
                ? i(t._Worker)
                : yt.LoadFileAsync(e.WasmModuleURL).then(function (n) {
                    var r = URL.createObjectURL(
                      new Blob(["(" + Bl + ")()"], {
                        type: "application/javascript",
                      })
                    );
                    t._Worker = new Worker(r);
                    var o = function (e) {
                      "init" === e.data.action &&
                        (t._Worker.removeEventListener("message", o),
                        i(t._Worker));
                    };
                    t._Worker.addEventListener("message", o),
                      t._Worker.postMessage({
                        action: "init",
                        url: e.JSModuleURL,
                        wasmBinary: n,
                      });
                  });
            })),
          this._WorkerPromise
        );
      }),
      (e.TranscodeAsync = function (e, t) {
        var i = this,
          n = e instanceof ArrayBuffer ? new Uint8Array(e) : e;
        return new Promise(function (e, r) {
          i._CreateWorkerAsync().then(function () {
            var o = i._actionId++,
              s = function (t) {
                "transcode" === t.data.action &&
                  t.data.id === o &&
                  (i._Worker.removeEventListener("message", s),
                  t.data.success
                    ? e(t.data)
                    : r("Transcode is not supported on this device"));
              };
            i._Worker.addEventListener("message", s);
            var a = new Uint8Array(n.byteLength);
            a.set(new Uint8Array(n.buffer, n.byteOffset, n.byteLength)),
              i._Worker.postMessage(
                {
                  action: "transcode",
                  id: o,
                  imageData: a,
                  config: t,
                  ignoreSupportedFormats: i._IgnoreSupportedFormats,
                },
                [a.buffer]
              );
          });
        });
      }),
      (e.LoadTextureFromTranscodeResult = function (t, i) {
        for (
          var n,
            r = t.getEngine(),
            o = function () {
              if (
                ((n = i.fileInfo.images[a].levels[0]),
                (t._invertVScale = t.invertY),
                -1 === i.format)
              )
                if (
                  ((t.type = 10),
                  (t.format = 4),
                  r.webGLVersion < 2 &&
                    (s.Log2(n.width) % 1 != 0 || s.Log2(n.height) % 1 != 0))
                ) {
                  var o = new et(r, xe.Temp);
                  (t._invertVScale = t.invertY),
                    (o.type = 10),
                    (o.format = 4),
                    (o.width = (n.width + 3) & -4),
                    (o.height = (n.height + 3) & -4),
                    r._bindTextureDirectly(r._gl.TEXTURE_2D, o, !0),
                    r._uploadDataToTextureDirectly(
                      o,
                      n.transcodedPixels,
                      a,
                      0,
                      4,
                      !0
                    ),
                    r._rescaleTexture(
                      o,
                      t,
                      r.scenes[0],
                      r._getInternalFormat(4),
                      function () {
                        r._releaseTexture(o),
                          r._bindTextureDirectly(r._gl.TEXTURE_2D, t, !0);
                      }
                    );
                } else
                  (t._invertVScale = !t.invertY),
                    (t.width = (n.width + 3) & -4),
                    (t.height = (n.height + 3) & -4),
                    r._uploadDataToTextureDirectly(
                      t,
                      n.transcodedPixels,
                      a,
                      0,
                      4,
                      !0
                    );
              else
                (t.width = n.width),
                  (t.height = n.height),
                  i.fileInfo.images[a].levels.forEach(function (n, o) {
                    r._uploadCompressedDataToTextureDirectly(
                      t,
                      e.GetInternalFormatFromBasisFormat(i.format),
                      n.width,
                      n.height,
                      n.transcodedPixels,
                      a,
                      o
                    );
                  }),
                  r.webGLVersion < 2 &&
                    (s.Log2(t.width) % 1 != 0 || s.Log2(t.height) % 1 != 0) &&
                    (yt.Warn(
                      "Loaded .basis texture width and height are not a power of two. Texture wrapping will be set to Texture.CLAMP_ADDRESSMODE as other modes are not supported with non power of two dimensions in webGL 1."
                    ),
                    (t._cachedWrapU = mn.CLAMP_ADDRESSMODE),
                    (t._cachedWrapV = mn.CLAMP_ADDRESSMODE));
            },
            a = 0;
          a < i.fileInfo.images.length;
          a++
        )
          o();
      }),
      (e._IgnoreSupportedFormats = !1),
      (e.JSModuleURL =
        "https://preview.babylonjs.com/basisTranscoder/basis_transcoder.js"),
      (e.WasmModuleURL =
        "https://preview.babylonjs.com/basisTranscoder/basis_transcoder.wasm"),
      (e._WorkerPromise = null),
      (e._Worker = null),
      (e._actionId = 0),
      e
    );
  })();
  function Bl() {
    var e = null;
    function t(e, t, i, n, r) {
      var o = e.getImageTranscodedSizeInBytes(t, i, n),
        s = new Uint8Array(o);
      return e.transcodeImage(s, t, i, n, 1, 0)
        ? (r &&
            (s = (function (e, t, i, n) {
              for (
                var r = new Uint16Array(4),
                  o = new Uint16Array(i * n),
                  s = i / 4,
                  a = n / 4,
                  l = 0;
                l < a;
                l++
              )
                for (var c = 0; c < s; c++) {
                  var u = 0 + 8 * (l * s + c);
                  (r[0] = e[u] | (e[u + 1] << 8)),
                    (r[1] = e[u + 2] | (e[u + 3] << 8)),
                    (r[2] =
                      ((2 * (31 & r[0]) + 1 * (31 & r[1])) / 3) |
                      (((2 * (2016 & r[0]) + 1 * (2016 & r[1])) / 3) & 2016) |
                      (((2 * (63488 & r[0]) + 1 * (63488 & r[1])) / 3) &
                        63488)),
                    (r[3] =
                      ((2 * (31 & r[1]) + 1 * (31 & r[0])) / 3) |
                      (((2 * (2016 & r[1]) + 1 * (2016 & r[0])) / 3) & 2016) |
                      (((2 * (63488 & r[1]) + 1 * (63488 & r[0])) / 3) &
                        63488));
                  for (var h = 0; h < 4; h++) {
                    var d = e[u + 4 + h],
                      p = (4 * l + h) * i + 4 * c;
                    (o[p++] = r[3 & d]),
                      (o[p++] = r[(d >> 2) & 3]),
                      (o[p++] = r[(d >> 4) & 3]),
                      (o[p++] = r[(d >> 6) & 3]);
                  }
                }
              return o;
            })(
              s,
              0,
              (e.getImageWidth(t, i) + 3) & -4,
              (e.getImageHeight(t, i) + 3) & -4
            )),
          s)
        : null;
    }
    onmessage = function (i) {
      if ("init" === i.data.action)
        e ||
          ((Module = {
            wasmBinary: i.data.wasmBinary,
          }),
          importScripts(i.data.url),
          (e = new Promise(function (e) {
            Module.onRuntimeInitialized = function () {
              Module.initializeBasis(), e();
            };
          }))),
          e.then(function () {
            postMessage({
              action: "init",
            });
          });
      else if ("transcode" === i.data.action) {
        var n = i.data.config,
          r = i.data.imageData,
          o = new Module.BasisFile(r),
          s = (function (e) {
            for (
              var t = e.getHasAlpha(), i = e.getNumImages(), n = [], r = 0;
              r < i;
              r++
            ) {
              for (
                var o = {
                    levels: [],
                  },
                  s = e.getNumLevels(r),
                  a = 0;
                a < s;
                a++
              ) {
                var l = {
                  width: e.getImageWidth(r, a),
                  height: e.getImageHeight(r, a),
                };
                o.levels.push(l);
              }
              n.push(o);
            }
            return {
              hasAlpha: t,
              images: n,
            };
          })(o),
          a = i.data.ignoreSupportedFormats
            ? null
            : (function (e, t) {
                var i = null;
                return (
                  e.supportedCompressionFormats &&
                    (e.supportedCompressionFormats.etc1
                      ? (i = 0)
                      : e.supportedCompressionFormats.s3tc
                        ? (i = t.hasAlpha ? 6 : 1)
                        : e.supportedCompressionFormats.pvrtc ||
                          (e.supportedCompressionFormats.etc2 && (i = 5))),
                  i
                );
              })(i.data.config, s),
          l = !1;
        null === a && ((l = !0), (a = s.hasAlpha ? 6 : 1));
        var c = !0;
        o.startTranscoding() || (c = !1);
        for (var u = [], h = 0; h < s.images.length && c; h++) {
          var d = s.images[h];
          if (void 0 === n.loadSingleImage || n.loadSingleImage === h) {
            var p = d.levels.length;
            !1 === n.loadMipmapLevels && (p = 1);
            for (var f = 0; f < p; f++) {
              var _ = d.levels[f],
                m = t(o, h, f, a, l);
              if (!m) {
                c = !1;
                break;
              }
              (_.transcodedPixels = m), u.push(_.transcodedPixels.buffer);
            }
          }
        }
        o.close(),
          o.delete(),
          l && (a = -1),
          c
            ? postMessage(
                {
                  action: "transcode",
                  success: c,
                  id: i.data.id,
                  fileInfo: s,
                  format: a,
                },
                u
              )
            : postMessage({
                action: "transcode",
                success: c,
                id: i.data.id,
              });
      }
    };
  }
  var Vl = (function () {
    function e() {
      this.supportCascades = !1;
    }
    return (
      (e.prototype.canLoad = function (e) {
        return X.EndsWith(e, ".basis");
      }),
      (e.prototype.loadCubeData = function (e, t, i, n, r) {
        if (!Array.isArray(e)) {
          var o = t.getEngine().getCaps(),
            s = {
              supportedCompressionFormats: {
                etc1: !!o.etc1,
                s3tc: !!o.s3tc,
                pvrtc: !!o.pvrtc,
                etc2: !!o.etc2,
              },
            };
          Fl.TranscodeAsync(e, s)
            .then(function (e) {
              var i =
                e.fileInfo.images[0].levels.length > 1 && t.generateMipMaps;
              Fl.LoadTextureFromTranscodeResult(t, e),
                t.getEngine()._setCubeMapTextureParams(t, i),
                (t.isReady = !0),
                t.onLoadedObservable.notifyObservers(t),
                t.onLoadedObservable.clear(),
                n && n();
            })
            .catch(function (e) {
              yt.Warn(
                "Failed to transcode Basis file, transcoding may not be supported on this device"
              ),
                (t.isReady = !0);
            });
        }
      }),
      (e.prototype.loadData = function (e, t, i) {
        var n = t.getEngine().getCaps(),
          r = {
            supportedCompressionFormats: {
              etc1: !!n.etc1,
              s3tc: !!n.s3tc,
              pvrtc: !!n.pvrtc,
              etc2: !!n.etc2,
            },
          };
        Fl.TranscodeAsync(e, r)
          .then(function (e) {
            var n = e.fileInfo.images[0].levels[0],
              r = e.fileInfo.images[0].levels.length > 1 && t.generateMipMaps;
            i(n.width, n.height, r, -1 !== e.format, function () {
              Fl.LoadTextureFromTranscodeResult(t, e);
            });
          })
          .catch(function (e) {
            yt.Warn(
              "Failed to transcode Basis file, transcoding may not be supported on this device"
            ),
              i(0, 0, !1, !1, function () {});
          });
      }),
      e
    );
  })();
  It._TextureLoaders.push(new Vl());
  var kl = (function (e) {
      function t(t, i, n, r, o) {
        var s = this,
          a = !(!o || !o.generateMipMaps) && o.generateMipMaps,
          l = !(!o || !o.generateDepthTexture) && o.generateDepthTexture,
          c =
            !o ||
            void 0 === o.doNotChangeAspectRatio ||
            o.doNotChangeAspectRatio;
        if ((s = e.call(this, t, i, r, a, c) || this).isSupported) {
          var u = [],
            h = [];
          s._initTypes(n, u, h, o);
          var d =
              !o || void 0 === o.generateDepthBuffer || o.generateDepthBuffer,
            p =
              !(!o || void 0 === o.generateStencilBuffer) &&
              o.generateStencilBuffer;
          return (
            (s._size = i),
            (s._multiRenderTargetOptions = {
              samplingModes: h,
              generateMipMaps: a,
              generateDepthBuffer: d,
              generateStencilBuffer: p,
              generateDepthTexture: l,
              types: u,
              textureCount: n,
            }),
            (s._count = n),
            s._createInternalTextures(),
            s._createTextures(),
            s
          );
        }
        s.dispose();
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "isSupported", {
          get: function () {
            return (
              this._getEngine().webGLVersion > 1 ||
              this._getEngine().getCaps().drawBuffersExtension
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "textures", {
          get: function () {
            return this._textures;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "count", {
          get: function () {
            return this._count;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "depthTexture", {
          get: function () {
            return this._textures[this._textures.length - 1];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "wrapU", {
          set: function (e) {
            if (this._textures)
              for (var t = 0; t < this._textures.length; t++)
                this._textures[t].wrapU = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "wrapV", {
          set: function (e) {
            if (this._textures)
              for (var t = 0; t < this._textures.length; t++)
                this._textures[t].wrapV = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._initTypes = function (e, t, i, n) {
          for (var r = 0; r < e; r++)
            n && n.types && void 0 !== n.types[r]
              ? t.push(n.types[r])
              : t.push(n && n.defaultType ? n.defaultType : 0),
              n && n.samplingModes && void 0 !== n.samplingModes[r]
                ? i.push(n.samplingModes[r])
                : i.push(mn.BILINEAR_SAMPLINGMODE);
        }),
        (t.prototype._rebuild = function (e) {
          void 0 === e && (e = !1),
            this.releaseInternalTextures(),
            this._createInternalTextures(),
            e && this._createTextures();
          for (var t = 0; t < this._internalTextures.length; t++)
            this._textures[t]._texture = this._internalTextures[t];
          (this._texture = this._internalTextures[0]),
            1 !== this.samples &&
              this._getEngine().updateMultipleRenderTargetTextureSampleCount(
                this._internalTextures,
                this.samples
              );
        }),
        (t.prototype._createInternalTextures = function () {
          this._internalTextures = this._getEngine().createMultipleRenderTarget(
            this._size,
            this._multiRenderTargetOptions
          );
        }),
        (t.prototype._createTextures = function () {
          this._textures = [];
          for (var e = 0; e < this._internalTextures.length; e++) {
            var t = new mn(null, this.getScene());
            (t._texture = this._internalTextures[e]), this._textures.push(t);
          }
          this._texture = this._internalTextures[0];
        }),
        (t.prototype.replaceTexture = function (e, t) {
          e._texture &&
            ((this._textures[t] = e), (this._internalTextures[t] = e._texture));
        }),
        Object.defineProperty(t.prototype, "samples", {
          get: function () {
            return this._samples;
          },
          set: function (e) {
            this._samples !== e &&
              (this._samples =
                this._getEngine().updateMultipleRenderTargetTextureSampleCount(
                  this._internalTextures,
                  e
                ));
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.resize = function (e) {
          (this._size = e), this._rebuild();
        }),
        (t.prototype.updateCount = function (e, t) {
          (this._multiRenderTargetOptions.textureCount = e), (this._count = e);
          var i = [],
            n = [];
          this._initTypes(e, i, n, t),
            (this._multiRenderTargetOptions.types = i),
            (this._multiRenderTargetOptions.samplingModes = n),
            this._rebuild(!0);
        }),
        (t.prototype.unbindFrameBuffer = function (e, t) {
          var i = this;
          e.unBindMultiColorAttachmentFramebuffer(
            this._internalTextures,
            this.isCube,
            function () {
              i.onAfterRenderObservable.notifyObservers(t);
            }
          );
        }),
        (t.prototype.dispose = function () {
          this.releaseInternalTextures(), e.prototype.dispose.call(this);
        }),
        (t.prototype.releaseInternalTextures = function () {
          if (this._internalTextures)
            for (var e = this._internalTextures.length - 1; e >= 0; e--)
              void 0 !== this._internalTextures[e] &&
                (this._internalTextures[e].dispose(),
                this._internalTextures.splice(e, 1));
        }),
        t
      );
    })(Dr),
    Ul = function (e, t, i) {
      (this.id = e), (this.scale = t), (this.offset = i);
    },
    zl =
      ((function () {
        function e(t, i, n, r) {
          var o, s, a, l, c, u, h, d, p, f, _, m, g;
          return (
            (this.name = t),
            (this.meshes = i),
            (this.scene = r),
            (this.options = n),
            (this.options.map =
              null !== (o = this.options.map) && void 0 !== o
                ? o
                : [
                    "ambientTexture",
                    "bumpTexture",
                    "diffuseTexture",
                    "emissiveTexture",
                    "lightmapTexture",
                    "opacityTexture",
                    "reflectionTexture",
                    "refractionTexture",
                    "specularTexture",
                  ]),
            (this.options.uvsIn =
              null !== (s = this.options.uvsIn) && void 0 !== s
                ? s
                : wt.UVKind),
            (this.options.uvsOut =
              null !== (a = this.options.uvsOut) && void 0 !== a
                ? a
                : wt.UVKind),
            (this.options.layout =
              null !== (l = this.options.layout) && void 0 !== l
                ? l
                : e.LAYOUT_STRIP),
            this.options.layout === e.LAYOUT_COLNUM &&
              (this.options.colnum =
                null !== (c = this.options.colnum) && void 0 !== c ? c : 8),
            (this.options.updateInputMeshes =
              null === (u = this.options.updateInputMeshes) ||
              void 0 === u ||
              u),
            (this.options.disposeSources =
              null === (h = this.options.disposeSources) || void 0 === h || h),
            (this._expecting = 0),
            (this.options.fillBlanks =
              null === (d = this.options.fillBlanks) || void 0 === d || d),
            !0 === this.options.fillBlanks &&
              (this.options.customFillColor =
                null !== (p = this.options.customFillColor) && void 0 !== p
                  ? p
                  : "black"),
            (this.options.frameSize =
              null !== (f = this.options.frameSize) && void 0 !== f ? f : 256),
            (this.options.paddingRatio =
              null !== (_ = this.options.paddingRatio) && void 0 !== _
                ? _
                : 0.0115),
            (this._paddingValue = Math.ceil(
              this.options.frameSize * this.options.paddingRatio
            )),
            this._paddingValue % 2 != 0 && this._paddingValue++,
            (this.options.paddingMode =
              null !== (m = this.options.paddingMode) && void 0 !== m
                ? m
                : e.SUBUV_WRAP),
            this.options.paddingMode === e.SUBUV_COLOR &&
              (this.options.paddingColor =
                null !== (g = this.options.paddingColor) && void 0 !== g
                  ? g
                  : new T(0, 0, 0, 1)),
            (this.sets = {}),
            (this.frames = []),
            this
          );
        }
        (e.prototype._createFrames = function (e) {
          for (
            var t = this,
              i = this._calculateSize(),
              n = new p(1, 1).divide(i),
              r = 0,
              o = this._expecting,
              s = this.meshes.length,
              a = Object.keys(this.sets),
              l = 0;
            l < a.length;
            l++
          ) {
            var c = a[l],
              u = new Zr(
                this.name + ".TexturePack." + c + "Set",
                {
                  width: i.x,
                  height: i.y,
                },
                this.scene,
                !0,
                mn.TRILINEAR_SAMPLINGMODE,
                It.TEXTUREFORMAT_RGBA
              ),
              h = u.getContext();
            (h.fillStyle = "rgba(0,0,0,0)"),
              h.fillRect(0, 0, i.x, i.y),
              u.update(!1),
              (this.sets[c] = u);
          }
          var d = this.options.frameSize || 256,
            f = this._paddingValue,
            _ = d + 2 * f;
          for (l = 0; l < s; l++)
            for (
              var m = this.meshes[l].material,
                g = function (s) {
                  var c = new Zr("temp", _, v.scene, !0),
                    u = c.getContext(),
                    h = v._getFrameOffset(l),
                    p = function () {
                      r++, c.update(!1);
                      var s = u.getImageData(0, 0, _, _),
                        a = t.sets[g];
                      if (
                        (a.getContext().putImageData(s, i.x * h.x, i.y * h.y),
                        c.dispose(),
                        a.update(!1),
                        r == o)
                      )
                        return (
                          t._calculateMeshUVFrames(
                            d,
                            f,
                            i,
                            n,
                            t.options.updateInputMeshes || !1
                          ),
                          void e()
                        );
                    },
                    g = a[s] || "_blank";
                  if (m && null !== m[g]) {
                    var y = m[g],
                      T = new Image();
                    (T.src =
                      y instanceof Zr
                        ? y.getContext().canvas.toDataURL("image/png")
                        : y.url),
                      yt.SetCorsBehavior(T.src, T),
                      (T.onload = function () {
                        (u.fillStyle = "rgba(0,0,0,0)"),
                          u.fillRect(0, 0, _, _),
                          c.update(!1),
                          u.setTransform(1, 0, 0, -1, 0, 0);
                        var e = [
                          0, 0, 1, 0, 1, 1, 0, 1, -1, 1, -1, 0, -2, 0, -1, 1,
                          -1,
                        ];
                        switch (t.options.paddingMode) {
                          case 0:
                            for (var i = 0; i < 9; i++)
                              u.drawImage(
                                T,
                                0,
                                0,
                                T.width,
                                T.height,
                                f + d * e[i],
                                f + d * e[i + 1] - _,
                                d,
                                d
                              );
                            break;
                          case 1:
                            for (var n = 0; n < f; n++)
                              u.drawImage(
                                T,
                                0,
                                0,
                                T.width,
                                T.height,
                                n + d * e[0],
                                f - _,
                                d,
                                d
                              ),
                                u.drawImage(
                                  T,
                                  0,
                                  0,
                                  T.width,
                                  T.height,
                                  2 * f - n,
                                  f - _,
                                  d,
                                  d
                                ),
                                u.drawImage(
                                  T,
                                  0,
                                  0,
                                  T.width,
                                  T.height,
                                  f,
                                  n - _,
                                  d,
                                  d
                                ),
                                u.drawImage(
                                  T,
                                  0,
                                  0,
                                  T.width,
                                  T.height,
                                  f,
                                  2 * f - n - _,
                                  d,
                                  d
                                );
                            u.drawImage(
                              T,
                              0,
                              0,
                              T.width,
                              T.height,
                              f + d * e[0],
                              f + d * e[1] - _,
                              d,
                              d
                            );
                            break;
                          case 2:
                            (u.fillStyle = (
                              t.options.paddingColor || b.Black()
                            ).toHexString()),
                              u.fillRect(0, 0, _, -_),
                              u.clearRect(f, f, d, d),
                              u.drawImage(
                                T,
                                0,
                                0,
                                T.width,
                                T.height,
                                f + d * e[0],
                                f + d * e[1] - _,
                                d,
                                d
                              );
                        }
                        u.setTransform(1, 0, 0, 1, 0, 0), p();
                      });
                  } else
                    (u.fillStyle = "rgba(0,0,0,0)"),
                      v.options.fillBlanks &&
                        (u.fillStyle = v.options.customFillColor),
                      u.fillRect(0, 0, _, _),
                      p();
                },
                v = this,
                y = 0;
              y < a.length;
              y++
            )
              g(y);
        }),
          (e.prototype._calculateSize = function () {
            var e = this.meshes.length || 0,
              t = this.options.frameSize || 0,
              i = this._paddingValue || 0;
            switch (this.options.layout) {
              case 0:
                return new p(t * e + 2 * i * e, t + 2 * i);
              case 1:
                var n = Math.max(2, Math.ceil(Math.sqrt(e))),
                  r = t * n + 2 * i * n;
                return new p(r, r);
              case 2:
                var o = this.options.colnum || 1,
                  s = Math.max(1, Math.ceil(e / o));
                return new p(t * o + 2 * i * o, t * s + 2 * i * s);
            }
            return p.Zero();
          }),
          (e.prototype._calculateMeshUVFrames = function (e, t, i, n, r) {
            for (var o = this.meshes.length, s = 0; s < o; s++) {
              var a = this.meshes[s],
                l = new p(e / i.x, e / i.y),
                c = n.clone().scale(t),
                u = this._getFrameOffset(s).add(c),
                h = new Ul(s, l, u);
              this.frames.push(h),
                r &&
                  (this._updateMeshUV(a, s), this._updateTextureReferences(a));
            }
          }),
          (e.prototype._getFrameOffset = function (e) {
            var t,
              i,
              n,
              r = this.meshes.length;
            switch (this.options.layout) {
              case 0:
                return new p(e * (t = 1 / r), 0);
              case 1:
                var o = Math.max(2, Math.ceil(Math.sqrt(r)));
                return (
                  (i = Math.floor(e / o)),
                  new p((n = e - i * o) * (t = 1 / o), i * t)
                );
              case 2:
                var s = this.options.colnum || 1,
                  a = Math.max(1, Math.ceil(r / s));
                return (
                  (i = e - (n = Math.floor(e / a)) * a),
                  (t = new p(1 / s, 1 / a)),
                  new p(n * t.x, i * t.y)
                );
            }
            return p.Zero();
          }),
          (e.prototype._updateMeshUV = function (e, t) {
            var i = this.frames[t],
              n = e.getVerticesData(this.options.uvsIn || wt.UVKind),
              r = [],
              o = 0;
            n.length && (o = n.length || 0);
            for (var s = 0; s < o; s += 2)
              r.push(
                n[s] * i.scale.x + i.offset.x,
                n[s + 1] * i.scale.y + i.offset.y
              );
            e.setVerticesData(this.options.uvsOut || wt.UVKind, r);
          }),
          (e.prototype._updateTextureReferences = function (e, t) {
            void 0 === t && (t = !1);
            for (
              var i = e.material,
                n = Object.keys(this.sets),
                r = function (e) {
                  e.dispose && e.dispose();
                },
                o = 0;
              o < n.length;
              o++
            ) {
              var s = n[o];
              if (t) null !== i[s] && r(i[s]), (i[s] = this.sets[s]);
              else {
                if (!i) return;
                null !== i[s] && (r(i[s]), (i[s] = this.sets[s]));
              }
            }
          }),
          (e.prototype.setMeshToFrame = function (e, t, i) {
            void 0 === i && (i = !1),
              this._updateMeshUV(e, t),
              i && this._updateTextureReferences(e, !0);
          }),
          (e.prototype.processAsync = function () {
            var e = this;
            return new Promise(function (t, i) {
              try {
                if (0 === e.meshes.length) return void t();
                for (
                  var n = 0,
                    r = function (i) {
                      var r = e.meshes[i],
                        o = r.material;
                      if (!o)
                        return ++n === e.meshes.length
                          ? {
                              value: e._createFrames(t),
                            }
                          : "continue";
                      o.forceCompilationAsync(r).then(function () {
                        !(function (i) {
                          if ((n++, e.options.map)) {
                            for (var r = 0; r < e.options.map.length; r++)
                              null !== i[e.options.map[r]] &&
                                (e.sets[e.options.map[r]] ||
                                  (e.sets[e.options.map[r]] = !0),
                                e._expecting++);
                            n === e.meshes.length && e._createFrames(t);
                          }
                        })(o);
                      });
                    },
                    o = 0;
                  o < e.meshes.length;
                  o++
                ) {
                  var s = r(o);
                  if ("object" == typeof s) return s.value;
                }
              } catch (e) {
                return i(e);
              }
            });
          }),
          (e.prototype.dispose = function () {
            for (var e = Object.keys(this.sets), t = 0; t < e.length; t++) {
              var i = e[t];
              this.sets[i].dispose();
            }
          }),
          (e.prototype.download = function (e, t) {
            var i = this;
            void 0 === e && (e = "png"),
              void 0 === t && (t = 1),
              setTimeout(function () {
                var n = {
                    name: i.name,
                    sets: {},
                    options: {},
                    frames: [],
                  },
                  r = Object.keys(i.sets),
                  o = Object.keys(i.options);
                try {
                  for (var s = 0; s < r.length; s++) {
                    var a = r[s],
                      l = i.sets[a];
                    n.sets[a] = l
                      .getContext()
                      .canvas.toDataURL("image/" + e, t);
                  }
                  for (s = 0; s < o.length; s++) {
                    var c = o[s];
                    n.options[c] = i.options[c];
                  }
                  for (s = 0; s < i.frames.length; s++) {
                    var u = i.frames[s];
                    n.frames.push(u.scale.x, u.scale.y, u.offset.x, u.offset.y);
                  }
                } catch (e) {
                  return void F.Warn("Unable to download: " + e);
                }
                var h =
                    "data:text/json;charset=utf-8," +
                    encodeURIComponent(JSON.stringify(n, null, 4)),
                  d = document.createElement("a");
                d.setAttribute("href", h),
                  d.setAttribute("download", i.name + "_texurePackage.json"),
                  document.body.appendChild(d),
                  d.click(),
                  d.remove();
              }, 0);
          }),
          (e.prototype.updateFromJSON = function (e) {
            try {
              var t = JSON.parse(e);
              this.name = t.name;
              for (var i = Object.keys(t.options), n = 0; n < i.length; n++)
                this.options[i[n]] = t.options[i[n]];
              for (n = 0; n < t.frames.length; n += 4) {
                var r = new Ul(
                  n / 4,
                  new p(t.frames[n], t.frames[n + 1]),
                  new p(t.frames[n + 2], t.frames[n + 3])
                );
                this.frames.push(r);
              }
              var o = Object.keys(t.sets);
              for (n = 0; n < o.length; n++) {
                var s = new mn(t.sets[o[n]], this.scene, !1, !1);
                this.sets[o[n]] = s;
              }
            } catch (e) {
              F.Warn("Unable to update from JSON: " + e);
            }
          }),
          (e.LAYOUT_STRIP = 0),
          (e.LAYOUT_POWER2 = 1),
          (e.LAYOUT_COLNUM = 2),
          (e.SUBUV_WRAP = 0),
          (e.SUBUV_EXTEND = 1),
          (e.SUBUV_COLOR = 2);
      })(),
      (function () {
        function e(e) {
          (this.name = hi.NAME_PROCEDURALTEXTURE),
            (this.scene = e),
            (this.scene.proceduralTextures = new Array());
        }
        return (
          (e.prototype.register = function () {
            this.scene._beforeClearStage.registerStep(
              hi.STEP_BEFORECLEAR_PROCEDURALTEXTURE,
              this,
              this._beforeClear
            );
          }),
          (e.prototype.rebuild = function () {}),
          (e.prototype.dispose = function () {}),
          (e.prototype._beforeClear = function () {
            if (this.scene.proceduralTexturesEnabled) {
              yt.StartPerformanceCounter(
                "Procedural textures",
                this.scene.proceduralTextures.length > 0
              );
              for (var e = 0; e < this.scene.proceduralTextures.length; e++) {
                var t = this.scene.proceduralTextures[e];
                t._shouldRender() && t.render();
              }
              yt.EndPerformanceCounter(
                "Procedural textures",
                this.scene.proceduralTextures.length > 0
              );
            }
          }),
          e
        );
      })());
  Ke.ShadersStore.proceduralVertexShader =
    "\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}";
  var Gl = (function (e) {
    function t(t, i, n, r, s, a, l, c) {
      void 0 === s && (s = null),
        void 0 === a && (a = !0),
        void 0 === l && (l = !1),
        void 0 === c && (c = 0);
      var u = e.call(this, null, r, !a) || this;
      (u.isEnabled = !0),
        (u.autoClear = !0),
        (u.onGeneratedObservable = new o()),
        (u.onBeforeGenerationObservable = new o()),
        (u.nodeMaterialSource = null),
        (u._textures = {}),
        (u._currentRefreshId = -1),
        (u._frameId = -1),
        (u._refreshRate = 1),
        (u._vertexBuffers = {}),
        (u._uniforms = new Array()),
        (u._samplers = new Array()),
        (u._floats = {}),
        (u._ints = {}),
        (u._floatsArrays = {}),
        (u._colors3 = {}),
        (u._colors4 = {}),
        (u._vectors2 = {}),
        (u._vectors3 = {}),
        (u._matrices = {}),
        (u._fallbackTextureUsed = !1),
        (u._cachedDefines = ""),
        (u._contentUpdateId = -1);
      var h = (r = u.getScene() || j.LastCreatedScene)._getComponent(
        hi.NAME_PROCEDURALTEXTURE
      );
      h || ((h = new zl(r)), r._addComponent(h)),
        r.proceduralTextures.push(u),
        (u._fullEngine = r.getEngine()),
        (u.name = t),
        (u.isRenderTarget = !0),
        (u._size = i),
        (u._generateMipMaps = a),
        u.setFragment(n),
        (u._fallbackTexture = s),
        l
          ? ((u._texture = u._fullEngine.createRenderTargetCubeTexture(i, {
              generateMipMaps: a,
              generateDepthBuffer: !1,
              generateStencilBuffer: !1,
              type: c,
            })),
            u.setFloat("face", 0))
          : (u._texture = u._fullEngine.createRenderTargetTexture(i, {
              generateMipMaps: a,
              generateDepthBuffer: !1,
              generateStencilBuffer: !1,
              type: c,
            }));
      var d = [];
      return (
        d.push(1, 1),
        d.push(-1, 1),
        d.push(-1, -1),
        d.push(1, -1),
        (u._vertexBuffers[wt.PositionKind] = new wt(
          u._fullEngine,
          d,
          wt.PositionKind,
          !1,
          !1,
          2
        )),
        u._createIndexBuffer(),
        u
      );
    }
    return (
      P(t, e),
      (t.prototype.getEffect = function () {
        return this._effect;
      }),
      (t.prototype.getContent = function () {
        return (
          (this._contentData && this._frameId === this._contentUpdateId) ||
            ((this._contentData = this.readPixels(0, 0, this._contentData)),
            (this._contentUpdateId = this._frameId)),
          this._contentData
        );
      }),
      (t.prototype._createIndexBuffer = function () {
        var e = this._fullEngine,
          t = [];
        t.push(0),
          t.push(1),
          t.push(2),
          t.push(0),
          t.push(2),
          t.push(3),
          (this._indexBuffer = e.createIndexBuffer(t));
      }),
      (t.prototype._rebuild = function () {
        var e = this._vertexBuffers[wt.PositionKind];
        e && e._rebuild(),
          this._createIndexBuffer(),
          this.refreshRate === Dr.REFRESHRATE_RENDER_ONCE &&
            (this.refreshRate = Dr.REFRESHRATE_RENDER_ONCE);
      }),
      (t.prototype.reset = function () {
        void 0 !== this._effect && this._effect.dispose();
      }),
      (t.prototype._getDefines = function () {
        return "";
      }),
      (t.prototype.isReady = function () {
        var e,
          t = this,
          i = this._fullEngine;
        if (this.nodeMaterialSource) return this._effect.isReady();
        if (!this._fragment) return !1;
        if (this._fallbackTextureUsed) return !0;
        var n = this._getDefines();
        return (
          !(
            !this._effect ||
            n !== this._cachedDefines ||
            !this._effect.isReady()
          ) ||
          ((e =
            void 0 !== this._fragment.fragmentElement
              ? {
                  vertex: "procedural",
                  fragmentElement: this._fragment.fragmentElement,
                }
              : {
                  vertex: "procedural",
                  fragment: this._fragment,
                }),
          (this._cachedDefines = n),
          (this._effect = i.createEffect(
            e,
            [wt.PositionKind],
            this._uniforms,
            this._samplers,
            n,
            void 0,
            void 0,
            function () {
              t.releaseInternalTexture(),
                t._fallbackTexture &&
                  ((t._texture = t._fallbackTexture._texture),
                  t._texture && t._texture.incrementReferences()),
                (t._fallbackTextureUsed = !0);
            }
          )),
          this._effect.isReady())
        );
      }),
      (t.prototype.resetRefreshCounter = function () {
        this._currentRefreshId = -1;
      }),
      (t.prototype.setFragment = function (e) {
        this._fragment = e;
      }),
      Object.defineProperty(t.prototype, "refreshRate", {
        get: function () {
          return this._refreshRate;
        },
        set: function (e) {
          (this._refreshRate = e), this.resetRefreshCounter();
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._shouldRender = function () {
        return this.isEnabled && this.isReady() && this._texture
          ? !this._fallbackTextureUsed &&
              (-1 === this._currentRefreshId ||
              this.refreshRate === this._currentRefreshId
                ? ((this._currentRefreshId = 1), this._frameId++, !0)
                : (this._currentRefreshId++, !1))
          : (this._texture && (this._texture.isReady = !1), !1);
      }),
      (t.prototype.getRenderSize = function () {
        return this._size;
      }),
      (t.prototype.resize = function (e, t) {
        this._fallbackTextureUsed ||
          (this.releaseInternalTexture(),
          (this._texture = this._fullEngine.createRenderTargetTexture(e, t)),
          (this._size = e),
          (this._generateMipMaps = t));
      }),
      (t.prototype._checkUniform = function (e) {
        -1 === this._uniforms.indexOf(e) && this._uniforms.push(e);
      }),
      (t.prototype.setTexture = function (e, t) {
        return (
          -1 === this._samplers.indexOf(e) && this._samplers.push(e),
          (this._textures[e] = t),
          this
        );
      }),
      (t.prototype.setFloat = function (e, t) {
        return this._checkUniform(e), (this._floats[e] = t), this;
      }),
      (t.prototype.setInt = function (e, t) {
        return this._checkUniform(e), (this._ints[e] = t), this;
      }),
      (t.prototype.setFloats = function (e, t) {
        return this._checkUniform(e), (this._floatsArrays[e] = t), this;
      }),
      (t.prototype.setColor3 = function (e, t) {
        return this._checkUniform(e), (this._colors3[e] = t), this;
      }),
      (t.prototype.setColor4 = function (e, t) {
        return this._checkUniform(e), (this._colors4[e] = t), this;
      }),
      (t.prototype.setVector2 = function (e, t) {
        return this._checkUniform(e), (this._vectors2[e] = t), this;
      }),
      (t.prototype.setVector3 = function (e, t) {
        return this._checkUniform(e), (this._vectors3[e] = t), this;
      }),
      (t.prototype.setMatrix = function (e, t) {
        return this._checkUniform(e), (this._matrices[e] = t), this;
      }),
      (t.prototype.render = function (e) {
        var t = this.getScene();
        if (t) {
          var i = this._fullEngine;
          if (
            (i.enableEffect(this._effect),
            this.onBeforeGenerationObservable.notifyObservers(this),
            i.setState(!1),
            !this.nodeMaterialSource)
          ) {
            for (var n in this._textures)
              this._effect.setTexture(n, this._textures[n]);
            for (n in this._ints) this._effect.setInt(n, this._ints[n]);
            for (n in this._floats) this._effect.setFloat(n, this._floats[n]);
            for (n in this._floatsArrays)
              this._effect.setArray(n, this._floatsArrays[n]);
            for (n in this._colors3)
              this._effect.setColor3(n, this._colors3[n]);
            for (n in this._colors4) {
              var r = this._colors4[n];
              this._effect.setFloat4(n, r.r, r.g, r.b, r.a);
            }
            for (n in this._vectors2)
              this._effect.setVector2(n, this._vectors2[n]);
            for (n in this._vectors3)
              this._effect.setVector3(n, this._vectors3[n]);
            for (n in this._matrices)
              this._effect.setMatrix(n, this._matrices[n]);
          }
          if (this._texture) {
            if (this.isCube)
              for (var o = 0; o < 6; o++)
                i.bindFramebuffer(this._texture, o, void 0, void 0, !0),
                  i.bindBuffers(
                    this._vertexBuffers,
                    this._indexBuffer,
                    this._effect
                  ),
                  this._effect.setFloat("face", o),
                  this.autoClear && i.clear(t.clearColor, !0, !1, !1),
                  i.drawElementsType(si.TriangleFillMode, 0, 6),
                  5 === o && i.generateMipMapsForCubemap(this._texture);
            else
              i.bindFramebuffer(this._texture, 0, void 0, void 0, !0),
                i.bindBuffers(
                  this._vertexBuffers,
                  this._indexBuffer,
                  this._effect
                ),
                this.autoClear && i.clear(t.clearColor, !0, !1, !1),
                i.drawElementsType(si.TriangleFillMode, 0, 6);
            i.unBindFramebuffer(this._texture, this.isCube),
              this.onGenerated && this.onGenerated(),
              this.onGeneratedObservable.notifyObservers(this);
          }
        }
      }),
      (t.prototype.clone = function () {
        var e = this.getSize(),
          i = new t(
            this.name,
            e.width,
            this._fragment,
            this.getScene(),
            this._fallbackTexture,
            this._generateMipMaps
          );
        return (
          (i.hasAlpha = this.hasAlpha),
          (i.level = this.level),
          (i.coordinatesMode = this.coordinatesMode),
          i
        );
      }),
      (t.prototype.dispose = function () {
        var t = this.getScene();
        if (t) {
          var i = t.proceduralTextures.indexOf(this);
          i >= 0 && t.proceduralTextures.splice(i, 1);
          var n = this._vertexBuffers[wt.PositionKind];
          n && (n.dispose(), (this._vertexBuffers[wt.PositionKind] = null)),
            this._indexBuffer &&
              this._fullEngine._releaseBuffer(this._indexBuffer) &&
              (this._indexBuffer = null),
            this.onGeneratedObservable.clear(),
            this.onBeforeGenerationObservable.clear(),
            e.prototype.dispose.call(this);
        }
      }),
      R([se()], t.prototype, "isEnabled", void 0),
      R([se()], t.prototype, "autoClear", void 0),
      R([se()], t.prototype, "_generateMipMaps", void 0),
      R([se()], t.prototype, "_size", void 0),
      R([se()], t.prototype, "refreshRate", null),
      t
    );
  })(mn);
  (h.RegisteredTypes["BABYLON.ProceduralTexture"] = Gl),
    (function (e) {
      function t(t, i, n, r, o, s) {
        var a = e.call(this, t, n, null, r, o, s) || this;
        return (
          (a._animate = !0),
          (a._time = 0),
          (a._texturePath = i),
          a._loadJson(i),
          (a.refreshRate = 1),
          a
        );
      }
      P(t, e),
        (t.prototype._loadJson = function (e) {
          var t = this,
            i = function () {
              try {
                t.setFragment(t._texturePath);
              } catch (e) {
                F.Error(
                  "No json or ShaderStore or DOM element found for CustomProceduralTexture"
                );
              }
            },
            n = e + "/config.json",
            r = new Te();
          r.open("GET", n),
            r.addEventListener(
              "load",
              function () {
                if (
                  200 === r.status ||
                  (r.responseText && r.responseText.length > 0)
                )
                  try {
                    (t._config = JSON.parse(r.response)),
                      t.updateShaderUniforms(),
                      t.updateTextures(),
                      t.setFragment(t._texturePath + "/custom"),
                      (t._animate = t._config.animate),
                      (t.refreshRate = t._config.refreshrate);
                  } catch (e) {
                    i();
                  }
                else i();
              },
              !1
            ),
            r.addEventListener(
              "error",
              function () {
                i();
              },
              !1
            );
          try {
            r.send();
          } catch (e) {
            F.Error("CustomProceduralTexture: Error on XHR send request.");
          }
        }),
        (t.prototype.isReady = function () {
          if (!e.prototype.isReady.call(this)) return !1;
          for (var t in this._textures)
            if (!this._textures[t].isReady()) return !1;
          return !0;
        }),
        (t.prototype.render = function (t) {
          var i = this.getScene();
          this._animate &&
            i &&
            ((this._time += 0.03 * i.getAnimationRatio()),
            this.updateShaderUniforms()),
            e.prototype.render.call(this, t);
        }),
        (t.prototype.updateTextures = function () {
          for (var e = 0; e < this._config.sampler2Ds.length; e++)
            this.setTexture(
              this._config.sampler2Ds[e].sample2Dname,
              new mn(
                this._texturePath +
                  "/" +
                  this._config.sampler2Ds[e].textureRelativeUrl,
                this.getScene()
              )
            );
        }),
        (t.prototype.updateShaderUniforms = function () {
          if (this._config)
            for (var e = 0; e < this._config.uniforms.length; e++) {
              var t = this._config.uniforms[e];
              switch (t.type) {
                case "float":
                  this.setFloat(t.name, t.value);
                  break;
                case "color3":
                  this.setColor3(t.name, new b(t.r, t.g, t.b));
                  break;
                case "color4":
                  this.setColor4(t.name, new T(t.r, t.g, t.b, t.a));
                  break;
                case "vector2":
                  this.setVector2(t.name, new p(t.x, t.y));
                  break;
                case "vector3":
                  this.setVector3(t.name, new f(t.x, t.y, t.z));
              }
            }
          this.setFloat("time", this._time);
        }),
        Object.defineProperty(t.prototype, "animate", {
          get: function () {
            return this._animate;
          },
          set: function (e) {
            this._animate = e;
          },
          enumerable: !1,
          configurable: !0,
        });
    })(Gl);
  Ke.ShadersStore.noisePixelShader =
    "\n\nuniform float brightness;\nuniform float persistence;\nuniform float timeScale;\n\nvarying vec2 vUV;\n\nvec2 hash22(vec2 p)\n{\np=p*mat2(127.1,311.7,269.5,183.3);\np=-1.0+2.0*fract(sin(p)*43758.5453123);\nreturn sin(p*6.283+timeScale);\n}\nfloat interpolationNoise(vec2 p)\n{\nvec2 pi=floor(p);\nvec2 pf=p-pi;\nvec2 w=pf*pf*(3.-2.*pf);\nfloat f00=dot(hash22(pi+vec2(.0,.0)),pf-vec2(.0,.0));\nfloat f01=dot(hash22(pi+vec2(.0,1.)),pf-vec2(.0,1.));\nfloat f10=dot(hash22(pi+vec2(1.0,0.)),pf-vec2(1.0,0.));\nfloat f11=dot(hash22(pi+vec2(1.0,1.)),pf-vec2(1.0,1.));\nfloat xm1=mix(f00,f10,w.x);\nfloat xm2=mix(f01,f11,w.x);\nfloat ym=mix(xm1,xm2,w.y);\nreturn ym;\n}\nfloat perlinNoise2D(float x,float y)\n{\nfloat sum=0.0;\nfloat frequency=0.0;\nfloat amplitude=0.0;\nfor(int i=0; i<OCTAVES; i++)\n{\nfrequency=pow(2.0,float(i));\namplitude=pow(persistence,float(i));\nsum=sum+interpolationNoise(vec2(x*frequency,y*frequency))*amplitude;\n}\nreturn sum;\n}\n\nvoid main(void)\n{\nfloat x=abs(vUV.x);\nfloat y=abs(vUV.y);\nfloat noise=brightness+(1.0-brightness)*perlinNoise2D(x,y);\ngl_FragColor=vec4(noise,noise,noise,1.0);\n}\n";
  var Wl,
    Hl,
    jl,
    Xl,
    Yl,
    Kl,
    Ql,
    ql = (function (e) {
      function t(t, i, n, r, o) {
        void 0 === i && (i = 256), void 0 === n && (n = j.LastCreatedScene);
        var s = e.call(this, t, i, "noise", n, r, o) || this;
        return (
          (s.time = 0),
          (s.brightness = 0.2),
          (s.octaves = 3),
          (s.persistence = 0.8),
          (s.animationSpeedFactor = 1),
          (s.autoClear = !1),
          s._updateShaderUniforms(),
          s
        );
      }
      return (
        P(t, e),
        (t.prototype._updateShaderUniforms = function () {
          var e = this.getScene();
          e &&
            ((this.time +=
              e.getAnimationRatio() * this.animationSpeedFactor * 0.01),
            this.setFloat("brightness", this.brightness),
            this.setFloat("persistence", this.persistence),
            this.setFloat("timeScale", this.time));
        }),
        (t.prototype._getDefines = function () {
          return "#define OCTAVES " + (0 | this.octaves);
        }),
        (t.prototype.render = function (t) {
          this._updateShaderUniforms(), e.prototype.render.call(this, t);
        }),
        (t.prototype.serialize = function () {
          var e = {
            customType: "BABYLON.NoiseProceduralTexture",
          };
          return (
            (e.brightness = this.brightness),
            (e.octaves = this.octaves),
            (e.persistence = this.persistence),
            (e.animationSpeedFactor = this.animationSpeedFactor),
            (e.size = this.getSize().width),
            (e.generateMipMaps = this._generateMipMaps),
            (e.time = this.time),
            e
          );
        }),
        (t.prototype.clone = function () {
          var e = this.getSize(),
            i = new t(
              this.name,
              e.width,
              this.getScene(),
              this._fallbackTexture ? this._fallbackTexture : void 0,
              this._generateMipMaps
            );
          return (
            (i.hasAlpha = this.hasAlpha),
            (i.level = this.level),
            (i.coordinatesMode = this.coordinatesMode),
            (i.brightness = this.brightness),
            (i.octaves = this.octaves),
            (i.persistence = this.persistence),
            (i.animationSpeedFactor = this.animationSpeedFactor),
            (i.time = this.time),
            i
          );
        }),
        (t.Parse = function (e, i) {
          var n,
            r = new t(e.name, e.size, i, void 0, e.generateMipMaps);
          return (
            (r.brightness = e.brightness),
            (r.octaves = e.octaves),
            (r.persistence = e.persistence),
            (r.animationSpeedFactor = e.animationSpeedFactor),
            (r.time = null !== (n = e.time) && void 0 !== n ? n : 0),
            r
          );
        }),
        t
      );
    })(Gl);
  (h.RegisteredTypes["BABYLON.NoiseProceduralTexture"] = ql),
    (function (e) {
      function t(t, i, n, r, o, s, a, l, c) {
        void 0 === r && (r = 5),
          void 0 === o && (o = 0),
          void 0 === s && (s = !1),
          void 0 === a && (a = !1),
          void 0 === l && (l = 3),
          void 0 === c && (c = null);
        var u = e.call(this, "", t) || this;
        return (
          (u._texture = t
            .getEngine()
            .createRawCubeTexture(i, n, r, o, s, a, l, c)),
          u
        );
      }
      P(t, e),
        (t.prototype.update = function (e, t, i, n, r) {
          void 0 === r && (r = null),
            this._texture
              .getEngine()
              .updateRawCubeTexture(this._texture, e, t, i, n, r);
        }),
        (t.prototype.updateRGBDAsync = function (e, i, n, r) {
          return (
            void 0 === i && (i = null),
            void 0 === n && (n = 0.8),
            void 0 === r && (r = 0),
            t._UpdateRGBDAsync(this._texture, e, i, n, r)
          );
        }),
        (t.prototype.clone = function () {
          var e = this;
          return ge.Clone(function () {
            var i = e.getScene(),
              n = e._texture,
              r = new t(
                i,
                n._bufferViewArray,
                n.width,
                n.format,
                n.type,
                n.generateMipMaps,
                n.invertY,
                n.samplingMode,
                n._compression
              );
            return (
              n.source === xe.CubeRawRGBD &&
                r.updateRGBDAsync(
                  n._bufferViewArrayArray,
                  n._sphericalPolynomial,
                  n._lodGenerationScale,
                  n._lodGenerationOffset
                ),
              r
            );
          }, this);
        }),
        (t._UpdateRGBDAsync = function (e, t, i, n, r) {
          return (
            (e._source = xe.CubeRawRGBD),
            (e._bufferViewArrayArray = t),
            (e._lodGenerationScale = n),
            (e._lodGenerationOffset = r),
            (e._sphericalPolynomial = i),
            rs.UploadLevelsAsync(e, t).then(function () {
              e.isReady = !0;
            })
          );
        });
    })(Fs),
    (function (e) {
      function t(t, i, n, r, o, s, a, l, c, u) {
        void 0 === a && (a = !0),
          void 0 === l && (l = !1),
          void 0 === c && (c = mn.TRILINEAR_SAMPLINGMODE),
          void 0 === u && (u = 0);
        var h = e.call(this, null, s, !a, l) || this;
        return (
          (h.format = o),
          (h._texture = s
            .getEngine()
            .createRawTexture2DArray(t, i, n, r, o, a, l, c, null, u)),
          (h.is2DArray = !0),
          h
        );
      }
      P(t, e),
        (t.prototype.update = function (e) {
          this._texture &&
            this._getEngine().updateRawTexture2DArray(
              this._texture,
              e,
              this._texture.format,
              this._texture.invertY,
              null,
              this._texture.type
            );
        });
    })(mn),
    (function (e) {
      function t(t, i, n, r, o, s, a, l, c, u) {
        void 0 === a && (a = !0),
          void 0 === l && (l = !1),
          void 0 === c && (c = mn.TRILINEAR_SAMPLINGMODE),
          void 0 === u && (u = 0);
        var h = e.call(this, null, s, !a, l) || this;
        return (
          (h.format = o),
          (h._texture = s
            .getEngine()
            .createRawTexture3D(t, i, n, r, o, a, l, c, null, u)),
          (h.is3D = !0),
          h
        );
      }
      P(t, e),
        (t.prototype.update = function (e) {
          this._texture &&
            this._getEngine().updateRawTexture3D(
              this._texture,
              e,
              this._texture.format,
              this._texture.invertY,
              null,
              this._texture.type
            );
        });
    })(mn),
    (function (e) {
      function t(t, i, n, r) {
        var o = e.call(this, t, i, n, r, !0) || this;
        return (
          (o.refractionPlane = new Qt(0, 1, 0, 1)),
          (o.depth = 2),
          o.onBeforeRenderObservable.add(function () {
            n.clipPlane = o.refractionPlane;
          }),
          o.onAfterRenderObservable.add(function () {
            n.clipPlane = null;
          }),
          o
        );
      }
      P(t, e),
        (t.prototype.clone = function () {
          var e = this.getScene();
          if (!e) return this;
          var i = this.getSize(),
            n = new t(this.name, i.width, e, this._generateMipMaps);
          return (
            (n.hasAlpha = this.hasAlpha),
            (n.level = this.level),
            (n.refractionPlane = this.refractionPlane.clone()),
            this.renderList && (n.renderList = this.renderList.slice(0)),
            (n.depth = this.depth),
            n
          );
        }),
        (t.prototype.serialize = function () {
          if (!this.name) return null;
          var t = e.prototype.serialize.call(this);
          return (
            (t.mirrorPlane = this.refractionPlane.asArray()),
            (t.depth = this.depth),
            t
          );
        });
    })(Dr),
    (function (e) {
      (e[(e.Vertex = 1)] = "Vertex"),
        (e[(e.Fragment = 2)] = "Fragment"),
        (e[(e.Neutral = 4)] = "Neutral"),
        (e[(e.VertexAndFragment = 3)] = "VertexAndFragment");
    })(Wl || (Wl = {})),
    (function (e) {
      (e[(e.Float = 1)] = "Float"),
        (e[(e.Int = 2)] = "Int"),
        (e[(e.Vector2 = 4)] = "Vector2"),
        (e[(e.Vector3 = 8)] = "Vector3"),
        (e[(e.Vector4 = 16)] = "Vector4"),
        (e[(e.Color3 = 32)] = "Color3"),
        (e[(e.Color4 = 64)] = "Color4"),
        (e[(e.Matrix = 128)] = "Matrix"),
        (e[(e.Object = 256)] = "Object"),
        (e[(e.AutoDetect = 1024)] = "AutoDetect"),
        (e[(e.BasedOnInput = 2048)] = "BasedOnInput");
    })(Hl || (Hl = {})),
    (function (e) {
      (e[(e.Uniform = 0)] = "Uniform"),
        (e[(e.Attribute = 1)] = "Attribute"),
        (e[(e.Varying = 2)] = "Varying"),
        (e[(e.Undefined = 3)] = "Undefined");
    })(jl || (jl = {})),
    (function (e) {
      (e[(e.World = 1)] = "World"),
        (e[(e.View = 2)] = "View"),
        (e[(e.Projection = 3)] = "Projection"),
        (e[(e.ViewProjection = 4)] = "ViewProjection"),
        (e[(e.WorldView = 5)] = "WorldView"),
        (e[(e.WorldViewProjection = 6)] = "WorldViewProjection"),
        (e[(e.CameraPosition = 7)] = "CameraPosition"),
        (e[(e.FogColor = 8)] = "FogColor"),
        (e[(e.DeltaTime = 9)] = "DeltaTime");
    })(Xl || (Xl = {})),
    (function (e) {
      (e[(e.Material = 0)] = "Material"),
        (e[(e.PostProcess = 1)] = "PostProcess"),
        (e[(e.Particle = 2)] = "Particle"),
        (e[(e.ProceduralTexture = 3)] = "ProceduralTexture");
    })(Yl || (Yl = {})),
    (function (e) {
      (e[(e.Compatible = 0)] = "Compatible"),
        (e[(e.TypeIncompatible = 1)] = "TypeIncompatible"),
        (e[(e.TargetIncompatible = 2)] = "TargetIncompatible");
    })(Kl || (Kl = {})),
    (function (e) {
      (e[(e.Input = 0)] = "Input"), (e[(e.Output = 1)] = "Output");
    })(Ql || (Ql = {}));
  var Zl = (function () {
      function e(e, t, i) {
        (this._connectedPoint = null),
          (this._endpoints = new Array()),
          (this._typeConnectionSource = null),
          (this._linkedConnectionSource = null),
          (this._acceptedConnectionPointType = null),
          (this._type = Hl.Float),
          (this._enforceAssociatedVariableName = !1),
          (this.needDualDirectionValidation = !1),
          (this.acceptedConnectionPointTypes = new Array()),
          (this.excludedConnectionPointTypes = new Array()),
          (this.onConnectionObservable = new o()),
          (this.isExposedOnFrame = !1),
          (this.exposedPortPosition = -1),
          (this._prioritizeVertex = !1),
          (this._target = Wl.VertexAndFragment),
          (this._ownerBlock = t),
          (this.name = e),
          (this._direction = i);
      }
      return (
        (e.AreEquivalentTypes = function (e, t) {
          switch (e) {
            case Hl.Vector3:
              if (t === Hl.Color3) return !0;
              break;
            case Hl.Vector4:
              if (t === Hl.Color4) return !0;
              break;
            case Hl.Color3:
              if (t === Hl.Vector3) return !0;
              break;
            case Hl.Color4:
              if (t === Hl.Vector4) return !0;
          }
          return !1;
        }),
        Object.defineProperty(e.prototype, "direction", {
          get: function () {
            return this._direction;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "associatedVariableName", {
          get: function () {
            return this._ownerBlock.isInput
              ? this._ownerBlock.associatedVariableName
              : (this._enforceAssociatedVariableName &&
                    this._associatedVariableName) ||
                  !this._connectedPoint
                ? this._associatedVariableName
                : this._connectedPoint.associatedVariableName;
          },
          set: function (e) {
            this._associatedVariableName = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "innerType", {
          get: function () {
            return this._linkedConnectionSource &&
              this._linkedConnectionSource.isConnected
              ? this.type
              : this._type;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "type", {
          get: function () {
            if (this._type === Hl.AutoDetect) {
              if (this._ownerBlock.isInput) return this._ownerBlock.type;
              if (this._connectedPoint) return this._connectedPoint.type;
              if (
                this._linkedConnectionSource &&
                this._linkedConnectionSource.isConnected
              )
                return this._linkedConnectionSource.type;
            }
            return this._type === Hl.BasedOnInput && this._typeConnectionSource
              ? this._typeConnectionSource.type
              : this._type;
          },
          set: function (e) {
            this._type = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "target", {
          get: function () {
            return this._prioritizeVertex && this._ownerBlock
              ? this._target !== Wl.VertexAndFragment
                ? this._target
                : this._ownerBlock.target === Wl.Fragment
                  ? Wl.Fragment
                  : Wl.Vertex
              : this._target;
          },
          set: function (e) {
            this._target = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isConnected", {
          get: function () {
            return null !== this.connectedPoint || this.hasEndpoints;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isConnectedToInputBlock", {
          get: function () {
            return (
              null !== this.connectedPoint &&
              this.connectedPoint.ownerBlock.isInput
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "connectInputBlock", {
          get: function () {
            return this.isConnectedToInputBlock
              ? this.connectedPoint.ownerBlock
              : null;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "connectedPoint", {
          get: function () {
            return this._connectedPoint;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "ownerBlock", {
          get: function () {
            return this._ownerBlock;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "sourceBlock", {
          get: function () {
            return this._connectedPoint
              ? this._connectedPoint.ownerBlock
              : null;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "connectedBlocks", {
          get: function () {
            return 0 === this._endpoints.length
              ? []
              : this._endpoints.map(function (e) {
                  return e.ownerBlock;
                });
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "endpoints", {
          get: function () {
            return this._endpoints;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "hasEndpoints", {
          get: function () {
            return this._endpoints && this._endpoints.length > 0;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isConnectedInVertexShader", {
          get: function () {
            if (this.target === Wl.Vertex) return !0;
            if (!this.hasEndpoints) return !1;
            for (var e = 0, t = this._endpoints; e < t.length; e++) {
              var i = t[e];
              if (i.ownerBlock.target === Wl.Vertex) return !0;
              if (i.target === Wl.Vertex) return !0;
              if (
                (i.ownerBlock.target === Wl.Neutral ||
                  i.ownerBlock.target === Wl.VertexAndFragment) &&
                i.ownerBlock.outputs.some(function (e) {
                  return e.isConnectedInVertexShader;
                })
              )
                return !0;
            }
            return !1;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isConnectedInFragmentShader", {
          get: function () {
            if (this.target === Wl.Fragment) return !0;
            if (!this.hasEndpoints) return !1;
            for (var e = 0, t = this._endpoints; e < t.length; e++) {
              var i = t[e];
              if (i.ownerBlock.target === Wl.Fragment) return !0;
              if (
                (i.ownerBlock.target === Wl.Neutral ||
                  i.ownerBlock.target === Wl.VertexAndFragment) &&
                i.ownerBlock.outputs.some(function (e) {
                  return e.isConnectedInFragmentShader;
                })
              )
                return !0;
            }
            return !1;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.createCustomInputBlock = function () {
          return null;
        }),
        (e.prototype.getClassName = function () {
          return "NodeMaterialConnectionPoint";
        }),
        (e.prototype.canConnectTo = function (e) {
          return this.checkCompatibilityState(e) === Kl.Compatible;
        }),
        (e.prototype.checkCompatibilityState = function (t) {
          if (this._ownerBlock.target === Wl.Fragment) {
            var i = t.ownerBlock;
            if (i.target === Wl.Vertex) return Kl.TargetIncompatible;
            for (var n = 0, r = i.outputs; n < r.length; n++)
              if (r[n].isConnectedInVertexShader) return Kl.TargetIncompatible;
          }
          return this.type !== t.type && t.innerType !== Hl.AutoDetect
            ? e.AreEquivalentTypes(this.type, t.type) ||
              (t.acceptedConnectionPointTypes &&
                -1 !== t.acceptedConnectionPointTypes.indexOf(this.type)) ||
              (t._acceptedConnectionPointType &&
                e.AreEquivalentTypes(
                  t._acceptedConnectionPointType.type,
                  this.type
                ))
              ? Kl.Compatible
              : Kl.TypeIncompatible
            : t.excludedConnectionPointTypes &&
                -1 !== t.excludedConnectionPointTypes.indexOf(this.type)
              ? 1
              : Kl.Compatible;
        }),
        (e.prototype.connectTo = function (e, t) {
          if ((void 0 === t && (t = !1), !t && !this.canConnectTo(e)))
            throw "Cannot connect these two connectors.";
          return (
            this._endpoints.push(e),
            (e._connectedPoint = this),
            (this._enforceAssociatedVariableName = !1),
            this.onConnectionObservable.notifyObservers(e),
            e.onConnectionObservable.notifyObservers(this),
            this
          );
        }),
        (e.prototype.disconnectFrom = function (e) {
          var t = this._endpoints.indexOf(e);
          return (
            -1 === t ||
              (this._endpoints.splice(t, 1),
              (e._connectedPoint = null),
              (this._enforceAssociatedVariableName = !1),
              (e._enforceAssociatedVariableName = !1)),
            this
          );
        }),
        (e.prototype.serialize = function (e) {
          void 0 === e && (e = !0);
          var t = {};
          return (
            (t.name = this.name),
            (t.displayName = this.displayName),
            e &&
              this.connectedPoint &&
              ((t.inputName = this.name),
              (t.targetBlockId = this.connectedPoint.ownerBlock.uniqueId),
              (t.targetConnectionName = this.connectedPoint.name),
              (t.isExposedOnFrame = !0),
              (t.exposedPortPosition = this.exposedPortPosition)),
            (this.isExposedOnFrame || this.exposedPortPosition >= 0) &&
              ((t.isExposedOnFrame = !0),
              (t.exposedPortPosition = this.exposedPortPosition)),
            t
          );
        }),
        (e.prototype.dispose = function () {
          this.onConnectionObservable.clear();
        }),
        e
      );
    })(),
    Jl = (function () {
      function e(e, t, i, n) {
        void 0 === t && (t = Wl.Vertex),
          void 0 === i && (i = !1),
          void 0 === n && (n = !1),
          (this._isFinalMerger = !1),
          (this._isInput = !1),
          (this._name = ""),
          (this._isUnique = !1),
          (this.inputsAreExclusive = !1),
          (this._codeVariableName = ""),
          (this._inputs = new Array()),
          (this._outputs = new Array()),
          (this.comments = ""),
          (this.visibleInInspector = !1),
          (this._target = t),
          (this._isFinalMerger = i),
          (this._isInput = n),
          (this._name = e),
          (this.uniqueId = Si.UniqueId);
      }
      return (
        Object.defineProperty(e.prototype, "name", {
          get: function () {
            return this._name;
          },
          set: function (e) {
            this.validateBlockName(e) && (this._name = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isUnique", {
          get: function () {
            return this._isUnique;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isFinalMerger", {
          get: function () {
            return this._isFinalMerger;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isInput", {
          get: function () {
            return this._isInput;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "buildId", {
          get: function () {
            return this._buildId;
          },
          set: function (e) {
            this._buildId = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "target", {
          get: function () {
            return this._target;
          },
          set: function (e) {
            0 == (this._target & e) && (this._target = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "inputs", {
          get: function () {
            return this._inputs;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "outputs", {
          get: function () {
            return this._outputs;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.getInputByName = function (e) {
          var t = this._inputs.filter(function (t) {
            return t.name === e;
          });
          return t.length ? t[0] : null;
        }),
        (e.prototype.getOutputByName = function (e) {
          var t = this._outputs.filter(function (t) {
            return t.name === e;
          });
          return t.length ? t[0] : null;
        }),
        (e.prototype.initialize = function (e) {}),
        (e.prototype.bind = function (e, t, i, n) {}),
        (e.prototype._declareOutput = function (e, t) {
          return t._getGLType(e.type) + " " + e.associatedVariableName;
        }),
        (e.prototype._writeVariable = function (e) {
          return e.connectedPoint ? "" + e.associatedVariableName : "0.";
        }),
        (e.prototype._writeFloat = function (e) {
          var t = e.toString();
          return -1 === t.indexOf(".") && (t += ".0"), "" + t;
        }),
        (e.prototype.getClassName = function () {
          return "NodeMaterialBlock";
        }),
        (e.prototype.registerInput = function (e, t, i, n, r) {
          return (
            void 0 === i && (i = !1),
            ((r = null != r ? r : new Zl(e, this, Ql.Input)).type = t),
            (r.isOptional = i),
            n && (r.target = n),
            this._inputs.push(r),
            this
          );
        }),
        (e.prototype.registerOutput = function (e, t, i, n) {
          return (
            ((n = null != n ? n : new Zl(e, this, Ql.Output)).type = t),
            i && (n.target = i),
            this._outputs.push(n),
            this
          );
        }),
        (e.prototype.getFirstAvailableInput = function (e) {
          void 0 === e && (e = null);
          for (var t = 0, i = this._inputs; t < i.length; t++) {
            var n = i[t];
            if (
              !(
                n.connectedPoint ||
                (e && e.type !== n.type && n.type !== Hl.AutoDetect)
              )
            )
              return n;
          }
          return null;
        }),
        (e.prototype.getFirstAvailableOutput = function (e) {
          void 0 === e && (e = null);
          for (var t = 0, i = this._outputs; t < i.length; t++) {
            var n = i[t];
            if (
              !e ||
              !e.target ||
              e.target === Wl.Neutral ||
              0 != (e.target & n.target)
            )
              return n;
          }
          return null;
        }),
        (e.prototype.getSiblingOutput = function (e) {
          var t = this._outputs.indexOf(e);
          return -1 === t || t >= this._outputs.length
            ? null
            : this._outputs[t + 1];
        }),
        (e.prototype.connectTo = function (e, t) {
          if (0 !== this._outputs.length) {
            for (
              var i =
                  t && t.output
                    ? this.getOutputByName(t.output)
                    : this.getFirstAvailableOutput(e),
                n = !0;
              n;

            ) {
              var r =
                t && t.input
                  ? e.getInputByName(t.input)
                  : e.getFirstAvailableInput(i);
              if (i && r && i.canConnectTo(r)) i.connectTo(r), (n = !1);
              else {
                if (!i) throw "Unable to find a compatible match";
                i = this.getSiblingOutput(i);
              }
            }
            return this;
          }
        }),
        (e.prototype._buildBlock = function (e) {}),
        (e.prototype.updateUniformsAndSamples = function (e, t, i, n) {}),
        (e.prototype.provideFallbacks = function (e, t) {}),
        (e.prototype.initializeDefines = function (e, t, i, n) {
          void 0 === n && (n = !1);
        }),
        (e.prototype.prepareDefines = function (e, t, i, n, r) {
          void 0 === n && (n = !1);
        }),
        (e.prototype.autoConfigure = function (e) {}),
        (e.prototype.replaceRepeatableContent = function (e, t, i, n) {}),
        (e.prototype.isReady = function (e, t, i, n) {
          return void 0 === n && (n = !1), !0;
        }),
        (e.prototype._linkConnectionTypes = function (e, t, i) {
          void 0 === i && (i = !1),
            i
              ? (this._inputs[t]._acceptedConnectionPointType = this._inputs[e])
              : (this._inputs[e]._linkedConnectionSource = this._inputs[t]),
            (this._inputs[t]._linkedConnectionSource = this._inputs[e]);
        }),
        (e.prototype._processBuild = function (e, t, i, n) {
          e.build(t, n);
          var r = null != t._vertexState,
            o =
              e._buildTarget === Wl.Vertex && e.target !== Wl.VertexAndFragment;
          if (
            r &&
            (0 == (e.target & e._buildTarget) ||
              0 == (e.target & i.target) ||
              (this.target !== Wl.VertexAndFragment && o)) &&
            ((!e.isInput && t.target !== e._buildTarget) ||
              (e.isInput && e.isAttribute && !e._noContextSwitch))
          ) {
            var s = i.connectedPoint;
            t._vertexState._emitVaryingFromString(
              "v_" + s.associatedVariableName,
              t._getGLType(s.type)
            ) &&
              (t._vertexState.compilationString +=
                "v_" +
                s.associatedVariableName +
                " = " +
                s.associatedVariableName +
                ";\r\n"),
              (i.associatedVariableName = "v_" + s.associatedVariableName),
              (i._enforceAssociatedVariableName = !0);
          }
        }),
        (e.prototype.validateBlockName = function (e) {
          for (
            var t = 0,
              i = [
                "position",
                "normal",
                "tangent",
                "particle_positionw",
                "uv",
                "uv2",
                "position2d",
                "particle_uv",
                "matricesIndices",
                "matricesWeights",
                "world0",
                "world1",
                "world2",
                "world3",
                "particle_color",
                "particle_texturemask",
              ];
            t < i.length;
            t++
          )
            if (e === i[t]) return !1;
          return !0;
        }),
        (e.prototype.build = function (e, t) {
          if (this._buildId === e.sharedData.buildId) return !0;
          if (!this.isInput)
            for (var i = 0, n = this._outputs; i < n.length; i++)
              (c = n[i]).associatedVariableName ||
                (c.associatedVariableName = e._getFreeVariableName(c.name));
          for (var r = 0, o = this._inputs; r < o.length; r++) {
            var s = o[r];
            if (s.connectedPoint) {
              if (this.target !== Wl.Neutral) {
                if (0 == (s.target & this.target)) continue;
                if (0 == (s.target & e.target)) continue;
              }
              (d = s.connectedPoint.ownerBlock) &&
                d !== this &&
                this._processBuild(d, e, s, t);
            } else
              s.isOptional ||
                e.sharedData.checks.notConnectedNonOptionalInputs.push(s);
          }
          if (this._buildId === e.sharedData.buildId) return !0;
          if (
            (e.sharedData.verbose &&
              console.log(
                (e.target === Wl.Vertex ? "Vertex shader" : "Fragment shader") +
                  ": Building " +
                  this.name +
                  " [" +
                  this.getClassName() +
                  "]"
              ),
            this.isFinalMerger)
          )
            switch (e.target) {
              case Wl.Vertex:
                e.sharedData.checks.emitVertex = !0;
                break;
              case Wl.Fragment:
                e.sharedData.checks.emitFragment = !0;
            }
          !this.isInput &&
            e.sharedData.emitComments &&
            (e.compilationString += "\r\n//" + this.name + "\r\n"),
            this._buildBlock(e),
            (this._buildId = e.sharedData.buildId),
            (this._buildTarget = e.target);
          for (var a = 0, l = this._outputs; a < l.length; a++) {
            var c;
            if (0 != ((c = l[a]).target & e.target))
              for (var u = 0, h = c.endpoints; u < h.length; u++) {
                var d,
                  p = h[u];
                (d = p.ownerBlock) &&
                  0 != (d.target & e.target) &&
                  -1 !== t.indexOf(d) &&
                  this._processBuild(d, e, p, t);
              }
          }
          return !1;
        }),
        (e.prototype._inputRename = function (e) {
          return e;
        }),
        (e.prototype._outputRename = function (e) {
          return e;
        }),
        (e.prototype._dumpPropertiesCode = function () {
          return (
            this._codeVariableName +
            ".visibleInInspector = " +
            this.visibleInInspector +
            ";\r\n"
          );
        }),
        (e.prototype._dumpCode = function (e, t) {
          var i;
          t.push(this);
          var n = this.name.replace(/[^A-Za-z_]+/g, "");
          if (
            ((this._codeVariableName =
              n || this.getClassName() + "_" + this.uniqueId),
            -1 !== e.indexOf(this._codeVariableName))
          ) {
            var r = 0;
            do {
              r++, (this._codeVariableName = n + r);
            } while (-1 !== e.indexOf(this._codeVariableName));
          }
          e.push(this._codeVariableName),
            (i = "\r\n// " + this.getClassName() + "\r\n"),
            this.comments && (i += "// " + this.comments + "\r\n"),
            (i +=
              "var " +
              this._codeVariableName +
              " = new BABYLON." +
              this.getClassName() +
              '("' +
              this.name +
              '");\r\n'),
            (i += this._dumpPropertiesCode());
          for (var o = 0, s = this.inputs; o < s.length; o++) {
            var a = s[o];
            if (a.isConnected) {
              var l = a.connectedPoint.ownerBlock;
              -1 === t.indexOf(l) && (i += l._dumpCode(e, t));
            }
          }
          for (var c = 0, u = this.outputs; c < u.length; c++) {
            var h = u[c];
            if (h.hasEndpoints)
              for (var d = 0, p = h.endpoints; d < p.length; d++)
                (l = p[d].ownerBlock) &&
                  -1 === t.indexOf(l) &&
                  (i += l._dumpCode(e, t));
          }
          return i;
        }),
        (e.prototype._dumpCodeForOutputConnections = function (e) {
          var t = "";
          if (-1 !== e.indexOf(this)) return t;
          e.push(this);
          for (var i = 0, n = this.inputs; i < n.length; i++) {
            var r = n[i];
            if (r.isConnected) {
              var o = r.connectedPoint,
                s = o.ownerBlock;
              (t += s._dumpCodeForOutputConnections(e)),
                (t +=
                  s._codeVariableName +
                  "." +
                  s._outputRename(o.name) +
                  ".connectTo(" +
                  this._codeVariableName +
                  "." +
                  this._inputRename(r.name) +
                  ");\r\n");
            }
          }
          return t;
        }),
        (e.prototype.clone = function (e, t) {
          void 0 === t && (t = "");
          var i = this.serialize(),
            n = h.GetClass(i.customType);
          if (n) {
            var r = new n();
            return r._deserialize(i, e, t), r;
          }
          return null;
        }),
        (e.prototype.serialize = function () {
          var e = {};
          (e.customType = "BABYLON." + this.getClassName()),
            (e.id = this.uniqueId),
            (e.name = this.name),
            (e.comments = this.comments),
            (e.visibleInInspector = this.visibleInInspector),
            (e.inputs = []),
            (e.outputs = []);
          for (var t = 0, i = this.inputs; t < i.length; t++) {
            var n = i[t];
            e.inputs.push(n.serialize());
          }
          for (var r = 0, o = this.outputs; r < o.length; r++) {
            var s = o[r];
            e.outputs.push(s.serialize(!1));
          }
          return e;
        }),
        (e.prototype._deserialize = function (e, t, i) {
          (this.name = e.name),
            (this.comments = e.comments),
            (this.visibleInInspector = !!e.visibleInInspector),
            this._deserializePortDisplayNamesAndExposedOnFrame(e);
        }),
        (e.prototype._deserializePortDisplayNamesAndExposedOnFrame = function (
          e
        ) {
          var t = this,
            i = e.inputs,
            n = e.outputs;
          i &&
            i.forEach(function (e, i) {
              e.displayName && (t.inputs[i].displayName = e.displayName),
                e.isExposedOnFrame &&
                  ((t.inputs[i].isExposedOnFrame = e.isExposedOnFrame),
                  (t.inputs[i].exposedPortPosition = e.exposedPortPosition));
            }),
            n &&
              n.forEach(function (e, i) {
                e.displayName && (t.outputs[i].displayName = e.displayName),
                  e.isExposedOnFrame &&
                    ((t.outputs[i].isExposedOnFrame = e.isExposedOnFrame),
                    (t.outputs[i].exposedPortPosition = e.exposedPortPosition));
              });
        }),
        (e.prototype.dispose = function () {
          for (var e = 0, t = this.inputs; e < t.length; e++) t[e].dispose();
          for (var i = 0, n = this.outputs; i < n.length; i++) n[i].dispose();
        }),
        e
      );
    })(),
    $l = (function () {
      function e() {
        (this.supportUniformBuffers = !1),
          (this.attributes = new Array()),
          (this.uniforms = new Array()),
          (this.constants = new Array()),
          (this.samplers = new Array()),
          (this.functions = {}),
          (this.extensions = {}),
          (this.counters = {}),
          (this._attributeDeclaration = ""),
          (this._uniformDeclaration = ""),
          (this._constantDeclaration = ""),
          (this._samplerDeclaration = ""),
          (this._varyingTransfer = ""),
          (this._injectAtEnd = ""),
          (this._repeatableContentAnchorIndex = 0),
          (this._builtCompilationString = ""),
          (this.compilationString = "");
      }
      return (
        (e.prototype.finalize = function (e) {
          var t = e.sharedData.emitComments,
            i = this.target === Wl.Fragment;
          (this.compilationString =
            "\r\n" +
            (t ? "//Entry point\r\n" : "") +
            "void main(void) {\r\n" +
            this.compilationString),
            this._constantDeclaration &&
              (this.compilationString =
                "\r\n" +
                (t ? "//Constants\r\n" : "") +
                this._constantDeclaration +
                "\r\n" +
                this.compilationString);
          var n = "";
          for (var r in this.functions) n += this.functions[r] + "\r\n";
          for (var o in ((this.compilationString =
            "\r\n" + n + "\r\n" + this.compilationString),
          !i &&
            this._varyingTransfer &&
            (this.compilationString =
              this.compilationString + "\r\n" + this._varyingTransfer),
          this._injectAtEnd &&
            (this.compilationString =
              this.compilationString + "\r\n" + this._injectAtEnd),
          (this.compilationString = this.compilationString + "\r\n}"),
          this.sharedData.varyingDeclaration &&
            (this.compilationString =
              "\r\n" +
              (t ? "//Varyings\r\n" : "") +
              this.sharedData.varyingDeclaration +
              "\r\n" +
              this.compilationString),
          this._samplerDeclaration &&
            (this.compilationString =
              "\r\n" +
              (t ? "//Samplers\r\n" : "") +
              this._samplerDeclaration +
              "\r\n" +
              this.compilationString),
          this._uniformDeclaration &&
            (this.compilationString =
              "\r\n" +
              (t ? "//Uniforms\r\n" : "") +
              this._uniformDeclaration +
              "\r\n" +
              this.compilationString),
          this._attributeDeclaration &&
            !i &&
            (this.compilationString =
              "\r\n" +
              (t ? "//Attributes\r\n" : "") +
              this._attributeDeclaration +
              "\r\n" +
              this.compilationString),
          (this.compilationString =
            "precision highp float;\r\n" + this.compilationString),
          this.extensions)) {
            var s = this.extensions[o];
            this.compilationString =
              "\r\n" + s + "\r\n" + this.compilationString;
          }
          this._builtCompilationString = this.compilationString;
        }),
        Object.defineProperty(e.prototype, "_repeatableContentAnchor", {
          get: function () {
            return (
              "###___ANCHOR" + this._repeatableContentAnchorIndex++ + "___###"
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype._getFreeVariableName = function (e) {
          return (
            (e = e.replace(/[^a-zA-Z_]+/g, "")),
            void 0 === this.sharedData.variableNames[e]
              ? ((this.sharedData.variableNames[e] = 0),
                "output" === e || "texture" === e
                  ? e + this.sharedData.variableNames[e]
                  : e)
              : (this.sharedData.variableNames[e]++,
                e + this.sharedData.variableNames[e])
          );
        }),
        (e.prototype._getFreeDefineName = function (e) {
          return (
            void 0 === this.sharedData.defineNames[e]
              ? (this.sharedData.defineNames[e] = 0)
              : this.sharedData.defineNames[e]++,
            e + this.sharedData.defineNames[e]
          );
        }),
        (e.prototype._excludeVariableName = function (e) {
          this.sharedData.variableNames[e] = 0;
        }),
        (e.prototype._emit2DSampler = function (e) {
          this.samplers.indexOf(e) < 0 &&
            ((this._samplerDeclaration += "uniform sampler2D " + e + ";\r\n"),
            this.samplers.push(e));
        }),
        (e.prototype._getGLType = function (e) {
          switch (e) {
            case Hl.Float:
              return "float";
            case Hl.Int:
              return "int";
            case Hl.Vector2:
              return "vec2";
            case Hl.Color3:
            case Hl.Vector3:
              return "vec3";
            case Hl.Color4:
            case Hl.Vector4:
              return "vec4";
            case Hl.Matrix:
              return "mat4";
          }
          return "";
        }),
        (e.prototype._emitExtension = function (e, t, i) {
          void 0 === i && (i = ""),
            this.extensions[e] ||
              (i && (t = "#if " + i + "\r\n" + t + "\r\n#endif"),
              (this.extensions[e] = t));
        }),
        (e.prototype._emitFunction = function (e, t, i) {
          this.functions[e] ||
            (this.sharedData.emitComments && (t = i + "\r\n" + t),
            (this.functions[e] = t));
        }),
        (e.prototype._emitCodeFromInclude = function (e, t, i) {
          if (i && i.repeatKey)
            return "#include<" + e + ">[0.." + i.repeatKey + "]\r\n";
          var n = Ke.IncludesShadersStore[e] + "\r\n";
          if ((this.sharedData.emitComments && (n = t + "\r\n" + n), !i))
            return n;
          if (i.replaceStrings)
            for (var r = 0; r < i.replaceStrings.length; r++) {
              var o = i.replaceStrings[r];
              n = n.replace(o.search, o.replace);
            }
          return n;
        }),
        (e.prototype._emitFunctionFromInclude = function (e, t, i, n) {
          void 0 === n && (n = "");
          var r = e + n;
          if (!this.functions[r]) {
            if (
              !i ||
              !(
                i.removeAttributes ||
                i.removeUniforms ||
                i.removeVaryings ||
                i.removeIfDef ||
                i.replaceStrings
              )
            )
              return (
                i && i.repeatKey
                  ? (this.functions[r] =
                      "#include<" + e + ">[0.." + i.repeatKey + "]\r\n")
                  : (this.functions[r] = "#include<" + e + ">\r\n"),
                void (
                  this.sharedData.emitComments &&
                  (this.functions[r] = t + "\r\n" + this.functions[r])
                )
              );
            if (
              ((this.functions[r] = Ke.IncludesShadersStore[e]),
              this.sharedData.emitComments &&
                (this.functions[r] = t + "\r\n" + this.functions[r]),
              i.removeIfDef &&
                ((this.functions[r] = this.functions[r].replace(
                  /^\s*?#ifdef.+$/gm,
                  ""
                )),
                (this.functions[r] = this.functions[r].replace(
                  /^\s*?#endif.*$/gm,
                  ""
                )),
                (this.functions[r] = this.functions[r].replace(
                  /^\s*?#else.*$/gm,
                  ""
                )),
                (this.functions[r] = this.functions[r].replace(
                  /^\s*?#elif.*$/gm,
                  ""
                ))),
              i.removeAttributes &&
                (this.functions[r] = this.functions[r].replace(
                  /^\s*?attribute.+$/gm,
                  ""
                )),
              i.removeUniforms &&
                (this.functions[r] = this.functions[r].replace(
                  /^\s*?uniform.+$/gm,
                  ""
                )),
              i.removeVaryings &&
                (this.functions[r] = this.functions[r].replace(
                  /^\s*?varying.+$/gm,
                  ""
                )),
              i.replaceStrings)
            )
              for (var o = 0; o < i.replaceStrings.length; o++) {
                var s = i.replaceStrings[o];
                this.functions[r] = this.functions[r].replace(
                  s.search,
                  s.replace
                );
              }
          }
        }),
        (e.prototype._registerTempVariable = function (e) {
          return (
            -1 === this.sharedData.temps.indexOf(e) &&
            (this.sharedData.temps.push(e), !0)
          );
        }),
        (e.prototype._emitVaryingFromString = function (e, t, i, n) {
          return (
            void 0 === i && (i = ""),
            void 0 === n && (n = !1),
            -1 === this.sharedData.varyings.indexOf(e) &&
              (this.sharedData.varyings.push(e),
              i &&
                (X.StartsWith(i, "defined(")
                  ? (this.sharedData.varyingDeclaration += "#if " + i + "\r\n")
                  : (this.sharedData.varyingDeclaration +=
                      (n ? "#ifndef" : "#ifdef") + " " + i + "\r\n")),
              (this.sharedData.varyingDeclaration +=
                "varying " + t + " " + e + ";\r\n"),
              i && (this.sharedData.varyingDeclaration += "#endif\r\n"),
              !0)
          );
        }),
        (e.prototype._emitUniformFromString = function (e, t, i, n) {
          void 0 === i && (i = ""),
            void 0 === n && (n = !1),
            -1 === this.uniforms.indexOf(e) &&
              (this.uniforms.push(e),
              i &&
                (X.StartsWith(i, "defined(")
                  ? (this._uniformDeclaration += "#if " + i + "\r\n")
                  : (this._uniformDeclaration +=
                      (n ? "#ifndef" : "#ifdef") + " " + i + "\r\n")),
              (this._uniformDeclaration += "uniform " + t + " " + e + ";\r\n"),
              i && (this._uniformDeclaration += "#endif\r\n"));
        }),
        (e.prototype._emitFloat = function (e) {
          return e.toString() === e.toFixed(0) ? e + ".0" : e.toString();
        }),
        e
      );
    })(),
    ec = (function () {
      function e() {
        (this.temps = new Array()),
          (this.varyings = new Array()),
          (this.varyingDeclaration = ""),
          (this.inputBlocks = new Array()),
          (this.textureBlocks = new Array()),
          (this.bindableBlocks = new Array()),
          (this.blocksWithFallbacks = new Array()),
          (this.blocksWithDefines = new Array()),
          (this.repeatableContentBlocks = new Array()),
          (this.dynamicUniformBlocks = new Array()),
          (this.blockingBlocks = new Array()),
          (this.animatedInputs = new Array()),
          (this.variableNames = {}),
          (this.defineNames = {}),
          (this.hints = {
            needWorldViewMatrix: !1,
            needWorldViewProjectionMatrix: !1,
            needAlphaBlending: !1,
            needAlphaTesting: !1,
          }),
          (this.checks = {
            emitVertex: !1,
            emitFragment: !1,
            notConnectedNonOptionalInputs: new Array(),
          }),
          (this.allowEmptyVertexProgram = !1),
          (this.variableNames.position = 0),
          (this.variableNames.normal = 0),
          (this.variableNames.tangent = 0),
          (this.variableNames.uv = 0),
          (this.variableNames.uv2 = 0),
          (this.variableNames.uv3 = 0),
          (this.variableNames.uv4 = 0),
          (this.variableNames.uv4 = 0),
          (this.variableNames.uv5 = 0),
          (this.variableNames.uv6 = 0),
          (this.variableNames.color = 0),
          (this.variableNames.matricesIndices = 0),
          (this.variableNames.matricesWeights = 0),
          (this.variableNames.matricesIndicesExtra = 0),
          (this.variableNames.matricesWeightsExtra = 0),
          (this.variableNames.diffuseBase = 0),
          (this.variableNames.specularBase = 0),
          (this.variableNames.worldPos = 0),
          (this.variableNames.shadow = 0),
          (this.variableNames.view = 0),
          (this.variableNames.vTBN = 0),
          (this.defineNames.MAINUV0 = 0),
          (this.defineNames.MAINUV1 = 0),
          (this.defineNames.MAINUV2 = 0),
          (this.defineNames.MAINUV3 = 0),
          (this.defineNames.MAINUV4 = 0),
          (this.defineNames.MAINUV5 = 0),
          (this.defineNames.MAINUV6 = 0),
          (this.defineNames.MAINUV7 = 0);
      }
      return (
        (e.prototype.emitErrors = function () {
          var e = "";
          this.checks.emitVertex ||
            this.allowEmptyVertexProgram ||
            (e +=
              "NodeMaterial does not have a vertex output. You need to at least add a block that generates a glPosition value.\r\n"),
            this.checks.emitFragment ||
              (e +=
                "NodeMaterial does not have a fragment output. You need to at least add a block that generates a glFragColor value.\r\n");
          for (
            var t = 0, i = this.checks.notConnectedNonOptionalInputs;
            t < i.length;
            t++
          ) {
            var n = i[t];
            e +=
              "input " +
              n.name +
              " from block " +
              n.ownerBlock.name +
              "[" +
              n.ownerBlock.getClassName() +
              "] is not connected and is not optional.\r\n";
          }
          if (e) throw "Build of NodeMaterial failed:\r\n" + e;
        }),
        e
      );
    })(),
    tc = (function (e) {
      function t(t) {
        var i = e.call(this, t, Wl.Vertex) || this;
        return (
          (i.complementW = 1),
          (i.complementZ = 0),
          i.registerInput("vector", Hl.AutoDetect),
          i.registerInput("transform", Hl.Matrix),
          i.registerOutput("output", Hl.Vector4),
          i.registerOutput("xyz", Hl.Vector3),
          i._inputs[0].onConnectionObservable.add(function (e) {
            if (e.ownerBlock.isInput) {
              var t = e.ownerBlock;
              ("normal" !== t.name && "tangent" !== t.name) ||
                (i.complementW = 0);
            }
          }),
          i
        );
      }
      return (
        P(t, e),
        (t.prototype.getClassName = function () {
          return "TransformBlock";
        }),
        Object.defineProperty(t.prototype, "vector", {
          get: function () {
            return this._inputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "output", {
          get: function () {
            return this._outputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "xyz", {
          get: function () {
            return this._outputs[1];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "transform", {
          get: function () {
            return this._inputs[1];
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._buildBlock = function (t) {
          e.prototype._buildBlock.call(this, t);
          var i = this.vector,
            n = this.transform;
          if (i.connectedPoint) {
            if (0 === this.complementW) {
              var r = "//" + this.name;
              t._emitFunctionFromInclude("helperFunctions", r),
                t.sharedData.blocksWithDefines.push(this);
              var o = t._getFreeVariableName(n.associatedVariableName + "_NUS");
              switch (
                ((t.compilationString +=
                  "mat3 " +
                  o +
                  " = mat3(" +
                  n.associatedVariableName +
                  ");\r\n"),
                (t.compilationString += "#ifdef NONUNIFORMSCALING\r\n"),
                (t.compilationString +=
                  o + " = transposeMat3(inverseMat3(" + o + "));\r\n"),
                (t.compilationString += "#endif\r\n"),
                i.connectedPoint.type)
              ) {
                case Hl.Vector2:
                  t.compilationString +=
                    this._declareOutput(this.output, t) +
                    " = vec4(" +
                    o +
                    " * vec3(" +
                    i.associatedVariableName +
                    ", " +
                    this._writeFloat(this.complementZ) +
                    "), " +
                    this._writeFloat(this.complementW) +
                    ");\r\n";
                  break;
                case Hl.Vector3:
                case Hl.Color3:
                  t.compilationString +=
                    this._declareOutput(this.output, t) +
                    " = vec4(" +
                    o +
                    " * " +
                    i.associatedVariableName +
                    ", " +
                    this._writeFloat(this.complementW) +
                    ");\r\n";
                  break;
                default:
                  t.compilationString +=
                    this._declareOutput(this.output, t) +
                    " = vec4(" +
                    o +
                    " * " +
                    i.associatedVariableName +
                    ".xyz, " +
                    this._writeFloat(this.complementW) +
                    ");\r\n";
              }
            } else
              switch (((o = n.associatedVariableName), i.connectedPoint.type)) {
                case Hl.Vector2:
                  t.compilationString +=
                    this._declareOutput(this.output, t) +
                    " = " +
                    o +
                    " * vec4(" +
                    i.associatedVariableName +
                    ", " +
                    this._writeFloat(this.complementZ) +
                    ", " +
                    this._writeFloat(this.complementW) +
                    ");\r\n";
                  break;
                case Hl.Vector3:
                case Hl.Color3:
                  t.compilationString +=
                    this._declareOutput(this.output, t) +
                    " = " +
                    o +
                    " * vec4(" +
                    i.associatedVariableName +
                    ", " +
                    this._writeFloat(this.complementW) +
                    ");\r\n";
                  break;
                default:
                  t.compilationString +=
                    this._declareOutput(this.output, t) +
                    " = " +
                    o +
                    " * " +
                    i.associatedVariableName +
                    ";\r\n";
              }
            this.xyz.hasEndpoints &&
              (t.compilationString +=
                this._declareOutput(this.xyz, t) +
                " = " +
                this.output.associatedVariableName +
                ".xyz;\r\n");
          }
          return this;
        }),
        (t.prototype.prepareDefines = function (e, t, i, n, r) {
          void 0 === n && (n = !1),
            e.nonUniformScaling && i.setValue("NONUNIFORMSCALING", !0);
        }),
        (t.prototype.serialize = function () {
          var t = e.prototype.serialize.call(this);
          return (
            (t.complementZ = this.complementZ),
            (t.complementW = this.complementW),
            t
          );
        }),
        (t.prototype._deserialize = function (t, i, n) {
          e.prototype._deserialize.call(this, t, i, n),
            (this.complementZ = void 0 !== t.complementZ ? t.complementZ : 0),
            (this.complementW = void 0 !== t.complementW ? t.complementW : 1);
        }),
        (t.prototype._dumpPropertiesCode = function () {
          return (
            this._codeVariableName +
            ".complementZ = " +
            this.complementZ +
            ";\r\n" +
            (this._codeVariableName + ".complementW = ") +
            this.complementW +
            ";\r\n"
          );
        }),
        t
      );
    })(Jl);
  h.RegisteredTypes["BABYLON.TransformBlock"] = tc;
  var ic = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Vertex, !0) || this;
      return i.registerInput("vector", Hl.Vector4), i;
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "VertexOutputBlock";
      }),
      Object.defineProperty(t.prototype, "vector", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this.vector;
        return (
          (t.compilationString +=
            "gl_Position = " + i.associatedVariableName + ";\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.VertexOutputBlock"] = ic;
  var nc,
    rc = (function (e) {
      function t(t) {
        var i = e.call(this, t, Wl.Fragment, !0) || this;
        return (
          i.registerInput("rgba", Hl.Color4, !0),
          i.registerInput("rgb", Hl.Color3, !0),
          i.registerInput("a", Hl.Float, !0),
          i.rgb.acceptedConnectionPointTypes.push(Hl.Float),
          i
        );
      }
      return (
        P(t, e),
        (t.prototype.getClassName = function () {
          return "FragmentOutputBlock";
        }),
        Object.defineProperty(t.prototype, "rgba", {
          get: function () {
            return this._inputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "rgb", {
          get: function () {
            return this._inputs[1];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "a", {
          get: function () {
            return this._inputs[2];
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._buildBlock = function (t) {
          e.prototype._buildBlock.call(this, t);
          var i = this.rgba,
            n = this.rgb,
            r = this.a;
          if (
            ((t.sharedData.hints.needAlphaBlending =
              i.isConnected || r.isConnected),
            i.connectedPoint)
          )
            r.isConnected
              ? (t.compilationString +=
                  "gl_FragColor = vec4(" +
                  i.associatedVariableName +
                  ".rgb, " +
                  r.associatedVariableName +
                  ");\r\n")
              : (t.compilationString +=
                  "gl_FragColor = " + i.associatedVariableName + ";\r\n");
          else if (n.connectedPoint) {
            var o = "1.0";
            r.connectedPoint && (o = r.associatedVariableName),
              n.connectedPoint.type === Hl.Float
                ? (t.compilationString +=
                    "gl_FragColor = vec4(" +
                    n.associatedVariableName +
                    ", " +
                    n.associatedVariableName +
                    ", " +
                    n.associatedVariableName +
                    ", " +
                    o +
                    ");\r\n")
                : (t.compilationString +=
                    "gl_FragColor = vec4(" +
                    n.associatedVariableName +
                    ", " +
                    o +
                    ");\r\n");
          } else t.sharedData.checks.notConnectedNonOptionalInputs.push(i);
          return this;
        }),
        t
      );
    })(Jl);
  (h.RegisteredTypes["BABYLON.FragmentOutputBlock"] = rc),
    (function (e) {
      (e[(e.None = 0)] = "None"), (e[(e.Time = 1)] = "Time");
    })(nc || (nc = {}));
  var oc = {
      position2d: "position",
      particle_uv: "vUV",
      particle_color: "vColor",
      particle_texturemask: "textureMask",
      particle_positionw: "vPositionW",
    },
    sc = {
      particle_uv: !0,
      particle_color: !0,
      particle_texturemask: !0,
      particle_positionw: !0,
    },
    ac = {
      particle_texturemask: !0,
    },
    lc = (function (e) {
      function t(t, i, n) {
        void 0 === i && (i = Wl.Vertex), void 0 === n && (n = Hl.AutoDetect);
        var r = e.call(this, t, i, !1, !0) || this;
        return (
          (r._mode = jl.Undefined),
          (r._animationType = nc.None),
          (r.min = 0),
          (r.max = 0),
          (r.isBoolean = !1),
          (r.matrixMode = 0),
          (r._systemValue = null),
          (r.isConstant = !1),
          (r.groupInInspector = ""),
          (r.onValueChangedObservable = new o()),
          (r.convertToGammaSpace = !1),
          (r.convertToLinearSpace = !1),
          (r._type = n),
          r.setDefaultValue(),
          r.registerOutput("output", n),
          r
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "type", {
          get: function () {
            if (this._type === Hl.AutoDetect) {
              if (this.isUniform && null != this.value) {
                if (!isNaN(this.value))
                  return (this._type = Hl.Float), this._type;
                switch (this.value.getClassName()) {
                  case "Vector2":
                    return (this._type = Hl.Vector2), this._type;
                  case "Vector3":
                    return (this._type = Hl.Vector3), this._type;
                  case "Vector4":
                    return (this._type = Hl.Vector4), this._type;
                  case "Color3":
                    return (this._type = Hl.Color3), this._type;
                  case "Color4":
                    return (this._type = Hl.Color4), this._type;
                  case "Matrix":
                    return (this._type = Hl.Matrix), this._type;
                }
              }
              if (this.isAttribute)
                switch (this.name) {
                  case "position":
                  case "normal":
                  case "tangent":
                  case "particle_positionw":
                    return (this._type = Hl.Vector3), this._type;
                  case "uv":
                  case "uv2":
                  case "position2d":
                  case "particle_uv":
                    return (this._type = Hl.Vector2), this._type;
                  case "matricesIndices":
                  case "matricesWeights":
                  case "world0":
                  case "world1":
                  case "world2":
                  case "world3":
                    return (this._type = Hl.Vector4), this._type;
                  case "color":
                  case "particle_color":
                  case "particle_texturemask":
                    return (this._type = Hl.Color4), this._type;
                }
              if (this.isSystemValue)
                switch (this._systemValue) {
                  case Xl.World:
                  case Xl.WorldView:
                  case Xl.WorldViewProjection:
                  case Xl.View:
                  case Xl.ViewProjection:
                  case Xl.Projection:
                    return (this._type = Hl.Matrix), this._type;
                  case Xl.CameraPosition:
                    return (this._type = Hl.Vector3), this._type;
                  case Xl.FogColor:
                    return (this._type = Hl.Color3), this._type;
                  case Xl.DeltaTime:
                    return (this._type = Hl.Float), this._type;
                }
            }
            return this._type;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.validateBlockName = function (t) {
          return (
            !!this.isAttribute || e.prototype.validateBlockName.call(this, t)
          );
        }),
        Object.defineProperty(t.prototype, "output", {
          get: function () {
            return this._outputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.setAsAttribute = function (e) {
          return (this._mode = jl.Attribute), e && (this.name = e), this;
        }),
        (t.prototype.setAsSystemValue = function (e) {
          return (this.systemValue = e), this;
        }),
        Object.defineProperty(t.prototype, "value", {
          get: function () {
            return this._storedValue;
          },
          set: function (e) {
            this.type === Hl.Float &&
              (this.isBoolean
                ? (e = e ? 1 : 0)
                : this.min !== this.max &&
                  ((e = Math.max(this.min, e)), (e = Math.min(this.max, e)))),
              (this._storedValue = e),
              (this._mode = jl.Uniform),
              this.onValueChangedObservable.notifyObservers(this);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "valueCallback", {
          get: function () {
            return this._valueCallback;
          },
          set: function (e) {
            (this._valueCallback = e), (this._mode = jl.Uniform);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "associatedVariableName", {
          get: function () {
            return this._associatedVariableName;
          },
          set: function (e) {
            this._associatedVariableName = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "animationType", {
          get: function () {
            return this._animationType;
          },
          set: function (e) {
            this._animationType = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "isUndefined", {
          get: function () {
            return this._mode === jl.Undefined;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "isUniform", {
          get: function () {
            return this._mode === jl.Uniform;
          },
          set: function (e) {
            (this._mode = e ? jl.Uniform : jl.Undefined),
              (this.associatedVariableName = "");
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "isAttribute", {
          get: function () {
            return this._mode === jl.Attribute;
          },
          set: function (e) {
            (this._mode = e ? jl.Attribute : jl.Undefined),
              (this.associatedVariableName = "");
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "isVarying", {
          get: function () {
            return this._mode === jl.Varying;
          },
          set: function (e) {
            (this._mode = e ? jl.Varying : jl.Undefined),
              (this.associatedVariableName = "");
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "isSystemValue", {
          get: function () {
            return null != this._systemValue;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "systemValue", {
          get: function () {
            return this._systemValue;
          },
          set: function (e) {
            (this._mode = jl.Uniform),
              (this.associatedVariableName = ""),
              (this._systemValue = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getClassName = function () {
          return "InputBlock";
        }),
        (t.prototype.animate = function (e) {
          switch (this._animationType) {
            case nc.Time:
              this.type === Hl.Float &&
                (this.value += 0.01 * e.getAnimationRatio());
          }
        }),
        (t.prototype._emitDefine = function (e) {
          return "!" === e[0]
            ? "#ifndef " + e.substring(1) + "\r\n"
            : "#ifdef " + e + "\r\n";
        }),
        (t.prototype.initialize = function (e) {
          this.associatedVariableName = "";
        }),
        (t.prototype.setDefaultValue = function () {
          switch (this.type) {
            case Hl.Float:
              this.value = 0;
              break;
            case Hl.Vector2:
              this.value = p.Zero();
              break;
            case Hl.Vector3:
              this.value = f.Zero();
              break;
            case Hl.Vector4:
              this.value = _.Zero();
              break;
            case Hl.Color3:
              this.value = b.White();
              break;
            case Hl.Color4:
              this.value = new T(1, 1, 1, 1);
              break;
            case Hl.Matrix:
              this.value = g.Identity();
          }
        }),
        (t.prototype._emitConstant = function (e) {
          switch (this.type) {
            case Hl.Float:
              return "" + e._emitFloat(this.value);
            case Hl.Vector2:
              return "vec2(" + this.value.x + ", " + this.value.y + ")";
            case Hl.Vector3:
              return (
                "vec3(" +
                this.value.x +
                ", " +
                this.value.y +
                ", " +
                this.value.z +
                ")"
              );
            case Hl.Vector4:
              return (
                "vec4(" +
                this.value.x +
                ", " +
                this.value.y +
                ", " +
                this.value.z +
                ", " +
                this.value.w +
                ")"
              );
            case Hl.Color3:
              return (
                S.Color3[0].set(this.value.r, this.value.g, this.value.b),
                this.convertToGammaSpace &&
                  S.Color3[0].toGammaSpaceToRef(S.Color3[0]),
                this.convertToLinearSpace &&
                  S.Color3[0].toLinearSpaceToRef(S.Color3[0]),
                "vec3(" +
                  S.Color3[0].r +
                  ", " +
                  S.Color3[0].g +
                  ", " +
                  S.Color3[0].b +
                  ")"
              );
            case Hl.Color4:
              return (
                S.Color4[0].set(
                  this.value.r,
                  this.value.g,
                  this.value.b,
                  this.value.a
                ),
                this.convertToGammaSpace &&
                  S.Color4[0].toGammaSpaceToRef(S.Color4[0]),
                this.convertToLinearSpace &&
                  S.Color4[0].toLinearSpaceToRef(S.Color4[0]),
                "vec4(" +
                  S.Color4[0].r +
                  ", " +
                  S.Color4[0].g +
                  ", " +
                  S.Color4[0].b +
                  ", " +
                  S.Color4[0].a +
                  ")"
              );
          }
          return "";
        }),
        Object.defineProperty(t.prototype, "_noContextSwitch", {
          get: function () {
            return sc[this.name];
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._emit = function (e, t) {
          var i;
          if (this.isUniform) {
            if (
              (this.associatedVariableName ||
                (this.associatedVariableName = e._getFreeVariableName(
                  "u_" + this.name
                )),
              this.isConstant)
            ) {
              if (-1 !== e.constants.indexOf(this.associatedVariableName))
                return;
              return (
                e.constants.push(this.associatedVariableName),
                void (e._constantDeclaration +=
                  this._declareOutput(this.output, e) +
                  " = " +
                  this._emitConstant(e) +
                  ";\r\n")
              );
            }
            if (-1 !== e.uniforms.indexOf(this.associatedVariableName)) return;
            e.uniforms.push(this.associatedVariableName),
              t && (e._uniformDeclaration += this._emitDefine(t)),
              (e._uniformDeclaration +=
                "uniform " +
                e._getGLType(this.type) +
                " " +
                this.associatedVariableName +
                ";\r\n"),
              t && (e._uniformDeclaration += "#endif\r\n");
            var n = e.sharedData.hints;
            if (null !== this._systemValue && void 0 !== this._systemValue)
              switch (this._systemValue) {
                case Xl.WorldView:
                  n.needWorldViewMatrix = !0;
                  break;
                case Xl.WorldViewProjection:
                  n.needWorldViewProjectionMatrix = !0;
              }
            else
              this._animationType !== nc.None &&
                e.sharedData.animatedInputs.push(this);
          } else if (this.isAttribute) {
            if (
              ((this.associatedVariableName =
                null !== (i = oc[this.name]) && void 0 !== i ? i : this.name),
              this.target === Wl.Vertex && e._vertexState)
            )
              return void (sc[this.name]
                ? ac[this.name]
                  ? e._emitUniformFromString(
                      this.associatedVariableName,
                      e._getGLType(this.type),
                      t
                    )
                  : e._emitVaryingFromString(
                      this.associatedVariableName,
                      e._getGLType(this.type),
                      t
                    )
                : this._emit(e._vertexState, t));
            if (-1 !== e.attributes.indexOf(this.associatedVariableName))
              return;
            e.attributes.push(this.associatedVariableName),
              sc[this.name]
                ? ac[this.name]
                  ? e._emitUniformFromString(
                      this.associatedVariableName,
                      e._getGLType(this.type),
                      t
                    )
                  : e._emitVaryingFromString(
                      this.associatedVariableName,
                      e._getGLType(this.type),
                      t
                    )
                : (t && (e._attributeDeclaration += this._emitDefine(t)),
                  (e._attributeDeclaration +=
                    "attribute " +
                    e._getGLType(this.type) +
                    " " +
                    this.associatedVariableName +
                    ";\r\n"),
                  t && (e._attributeDeclaration += "#endif\r\n"));
          }
        }),
        (t.prototype._transmitWorld = function (e, t, i, n) {
          if (this._systemValue) {
            var r = this.associatedVariableName;
            switch (this._systemValue) {
              case Xl.World:
                e.setMatrix(r, t);
                break;
              case Xl.WorldView:
                e.setMatrix(r, i);
                break;
              case Xl.WorldViewProjection:
                e.setMatrix(r, n);
            }
          }
        }),
        (t.prototype._transmit = function (e, t) {
          if (!this.isAttribute) {
            var i = this.associatedVariableName;
            if (this._systemValue)
              switch (this._systemValue) {
                case Xl.World:
                case Xl.WorldView:
                case Xl.WorldViewProjection:
                  return;
                case Xl.View:
                  e.setMatrix(i, t.getViewMatrix());
                  break;
                case Xl.Projection:
                  e.setMatrix(i, t.getProjectionMatrix());
                  break;
                case Xl.ViewProjection:
                  e.setMatrix(i, t.getTransformMatrix());
                  break;
                case Xl.CameraPosition:
                  Hr.BindEyePosition(e, t, i);
                  break;
                case Xl.FogColor:
                  e.setColor3(i, t.fogColor);
                  break;
                case Xl.DeltaTime:
                  e.setFloat(i, t.deltaTime / 1e3);
              }
            else {
              var n = this._valueCallback
                ? this._valueCallback()
                : this._storedValue;
              if (null !== n)
                switch (this.type) {
                  case Hl.Float:
                    e.setFloat(i, n);
                    break;
                  case Hl.Int:
                    e.setInt(i, n);
                    break;
                  case Hl.Color3:
                    S.Color3[0].set(this.value.r, this.value.g, this.value.b),
                      this.convertToGammaSpace &&
                        S.Color3[0].toGammaSpaceToRef(S.Color3[0]),
                      this.convertToLinearSpace &&
                        S.Color3[0].toLinearSpaceToRef(S.Color3[0]),
                      e.setColor3(i, S.Color3[0]);
                    break;
                  case Hl.Color4:
                    S.Color4[0].set(
                      this.value.r,
                      this.value.g,
                      this.value.b,
                      this.value.a
                    ),
                      this.convertToGammaSpace &&
                        S.Color4[0].toGammaSpaceToRef(S.Color4[0]),
                      this.convertToLinearSpace &&
                        S.Color4[0].toLinearSpaceToRef(S.Color4[0]),
                      e.setDirectColor4(i, S.Color4[0]);
                    break;
                  case Hl.Vector2:
                    e.setVector2(i, n);
                    break;
                  case Hl.Vector3:
                    e.setVector3(i, n);
                    break;
                  case Hl.Vector4:
                    e.setVector4(i, n);
                    break;
                  case Hl.Matrix:
                    e.setMatrix(i, n);
                }
            }
          }
        }),
        (t.prototype._buildBlock = function (t) {
          e.prototype._buildBlock.call(this, t),
            (this.isUniform || this.isSystemValue) &&
              t.sharedData.inputBlocks.push(this),
            this._emit(t);
        }),
        (t.prototype._dumpPropertiesCode = function () {
          var e = this._codeVariableName;
          if (this.isAttribute)
            return e + '.setAsAttribute("' + this.name + '");\r\n';
          if (this.isSystemValue)
            return (
              e +
              ".setAsSystemValue(BABYLON.NodeMaterialSystemValues." +
              Xl[this._systemValue] +
              ");\r\n"
            );
          if (this.isUniform) {
            var t = [],
              i = "";
            switch (this.type) {
              case Hl.Float:
                i = "" + this.value;
                break;
              case Hl.Vector2:
                i =
                  "new BABYLON.Vector2(" +
                  this.value.x +
                  ", " +
                  this.value.y +
                  ")";
                break;
              case Hl.Vector3:
                i =
                  "new BABYLON.Vector3(" +
                  this.value.x +
                  ", " +
                  this.value.y +
                  ", " +
                  this.value.z +
                  ")";
                break;
              case Hl.Vector4:
                i =
                  "new BABYLON.Vector4(" +
                  this.value.x +
                  ", " +
                  this.value.y +
                  ", " +
                  this.value.z +
                  ", " +
                  this.value.w +
                  ")";
                break;
              case Hl.Color3:
                (i =
                  "new BABYLON.Color3(" +
                  this.value.r +
                  ", " +
                  this.value.g +
                  ", " +
                  this.value.b +
                  ")"),
                  this.convertToGammaSpace && (i += ".toGammaSpace()"),
                  this.convertToLinearSpace && (i += ".toLinearSpace()");
                break;
              case Hl.Color4:
                (i =
                  "new BABYLON.Color4(" +
                  this.value.r +
                  ", " +
                  this.value.g +
                  ", " +
                  this.value.b +
                  ", " +
                  this.value.a +
                  ")"),
                  this.convertToGammaSpace && (i += ".toGammaSpace()"),
                  this.convertToLinearSpace && (i += ".toLinearSpace()");
                break;
              case Hl.Matrix:
                i = "BABYLON.Matrix.FromArray([" + this.value.m + "])";
            }
            return (
              t.push(e + ".value = " + i),
              this.type === Hl.Float &&
                t.push(
                  e + ".min = " + this.min,
                  e + ".max = " + this.max,
                  e + ".isBoolean = " + this.isBoolean,
                  e + ".matrixMode = " + this.matrixMode,
                  e +
                    ".animationType = BABYLON.AnimatedInputBlockTypes." +
                    nc[this.animationType]
                ),
              t.push(e + ".isConstant = " + this.isConstant),
              t.push(""),
              t.join(";\r\n")
            );
          }
          return "";
        }),
        (t.prototype.dispose = function () {
          this.onValueChangedObservable.clear(), e.prototype.dispose.call(this);
        }),
        (t.prototype.serialize = function () {
          var t = e.prototype.serialize.call(this);
          return (
            (t.type = this.type),
            (t.mode = this._mode),
            (t.systemValue = this._systemValue),
            (t.animationType = this._animationType),
            (t.min = this.min),
            (t.max = this.max),
            (t.isBoolean = this.isBoolean),
            (t.matrixMode = this.matrixMode),
            (t.isConstant = this.isConstant),
            (t.groupInInspector = this.groupInInspector),
            (t.convertToGammaSpace = this.convertToGammaSpace),
            (t.convertToLinearSpace = this.convertToLinearSpace),
            null != this._storedValue &&
              this._mode === jl.Uniform &&
              (this._storedValue.asArray
                ? ((t.valueType =
                    "BABYLON." + this._storedValue.getClassName()),
                  (t.value = this._storedValue.asArray()))
                : ((t.valueType = "number"), (t.value = this._storedValue))),
            t
          );
        }),
        (t.prototype._deserialize = function (t, i, n) {
          if (
            ((this._mode = t.mode),
            e.prototype._deserialize.call(this, t, i, n),
            (this._type = t.type),
            (this._systemValue = t.systemValue || t.wellKnownValue),
            (this._animationType = t.animationType),
            (this.min = t.min || 0),
            (this.max = t.max || 0),
            (this.isBoolean = !!t.isBoolean),
            (this.matrixMode = t.matrixMode || 0),
            (this.isConstant = !!t.isConstant),
            (this.groupInInspector = t.groupInInspector || ""),
            (this.convertToGammaSpace = !!t.convertToGammaSpace),
            (this.convertToLinearSpace = !!t.convertToLinearSpace),
            t.valueType)
          )
            if ("number" === t.valueType) this._storedValue = t.value;
            else {
              var r = h.GetClass(t.valueType);
              r && (this._storedValue = r.FromArray(t.value));
            }
        }),
        t
      );
    })(Jl);
  h.RegisteredTypes["BABYLON.InputBlock"] = lc;
  var cc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.VertexAndFragment) || this;
      return (
        (i._samplerName = "textureSampler"),
        (i.convertToGammaSpace = !1),
        (i.convertToLinearSpace = !1),
        (i._isUnique = !1),
        i.registerInput("uv", Hl.Vector2, !1, Wl.VertexAndFragment),
        i.registerOutput("rgba", Hl.Color4, Wl.Neutral),
        i.registerOutput("rgb", Hl.Color3, Wl.Neutral),
        i.registerOutput("r", Hl.Float, Wl.Neutral),
        i.registerOutput("g", Hl.Float, Wl.Neutral),
        i.registerOutput("b", Hl.Float, Wl.Neutral),
        i.registerOutput("a", Hl.Float, Wl.Neutral),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector3),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector4),
        (i._inputs[0]._prioritizeVertex = !1),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "CurrentScreenBlock";
      }),
      Object.defineProperty(t.prototype, "uv", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rgba", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rgb", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "r", {
        get: function () {
          return this._outputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "g", {
        get: function () {
          return this._outputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "b", {
        get: function () {
          return this._outputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "a", {
        get: function () {
          return this._outputs[5];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.initialize = function (e) {
        e._excludeVariableName("textureSampler");
      }),
      Object.defineProperty(t.prototype, "target", {
        get: function () {
          return this.uv.isConnected
            ? this.uv.sourceBlock.isInput
              ? Wl.VertexAndFragment
              : Wl.Fragment
            : Wl.VertexAndFragment;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.prepareDefines = function (e, t, i) {
        i.setValue(this._linearDefineName, this.convertToGammaSpace, !0),
          i.setValue(this._gammaDefineName, this.convertToLinearSpace, !0);
      }),
      (t.prototype.isReady = function () {
        return !(this.texture && !this.texture.isReadyOrNotBlocking());
      }),
      (t.prototype._injectVertexCode = function (e) {
        var t = this.uv;
        if (
          (t.connectedPoint.ownerBlock.isInput &&
            (t.connectedPoint.ownerBlock.isAttribute ||
              e._emitUniformFromString(t.associatedVariableName, "vec2")),
          (this._mainUVName = "vMain" + t.associatedVariableName),
          e._emitVaryingFromString(this._mainUVName, "vec2"),
          (e.compilationString +=
            this._mainUVName + " = " + t.associatedVariableName + ".xy;\r\n"),
          this._outputs.some(function (e) {
            return e.isConnectedInVertexShader;
          }))
        ) {
          this._writeTextureRead(e, !0);
          for (var i = 0, n = this._outputs; i < n.length; i++) {
            var r = n[i];
            r.hasEndpoints && this._writeOutput(e, r, r.name, !0);
          }
        }
      }),
      (t.prototype._writeTextureRead = function (e, t) {
        void 0 === t && (t = !1);
        var i = this.uv;
        if (t) {
          if (e.target === Wl.Fragment) return;
          e.compilationString +=
            "vec4 " +
            this._tempTextureRead +
            " = texture2D(" +
            this._samplerName +
            ", " +
            i.associatedVariableName +
            ");\r\n";
        } else
          this.uv.ownerBlock.target !== Wl.Fragment
            ? (e.compilationString +=
                "vec4 " +
                this._tempTextureRead +
                " = texture2D(" +
                this._samplerName +
                ", " +
                this._mainUVName +
                ");\r\n")
            : (e.compilationString +=
                "vec4 " +
                this._tempTextureRead +
                " = texture2D(" +
                this._samplerName +
                ", " +
                i.associatedVariableName +
                ");\r\n");
      }),
      (t.prototype._writeOutput = function (e, t, i, n) {
        if ((void 0 === n && (n = !1), n)) {
          if (e.target === Wl.Fragment) return;
          e.compilationString +=
            this._declareOutput(t, e) +
            " = " +
            this._tempTextureRead +
            "." +
            i +
            ";\r\n";
        } else
          this.uv.ownerBlock.target !== Wl.Fragment
            ? ((e.compilationString +=
                this._declareOutput(t, e) +
                " = " +
                this._tempTextureRead +
                "." +
                i +
                ";\r\n"),
              (e.compilationString +=
                "#ifdef " + this._linearDefineName + "\r\n"),
              (e.compilationString +=
                t.associatedVariableName +
                " = toGammaSpace(" +
                t.associatedVariableName +
                ");\r\n"),
              (e.compilationString += "#endif\r\n"),
              (e.compilationString +=
                "#ifdef " + this._gammaDefineName + "\r\n"),
              (e.compilationString +=
                t.associatedVariableName +
                " = toLinearSpace(" +
                t.associatedVariableName +
                ");\r\n"),
              (e.compilationString += "#endif\r\n"))
            : (e.compilationString +=
                this._declareOutput(t, e) +
                " = " +
                this._tempTextureRead +
                "." +
                i +
                ";\r\n");
      }),
      (t.prototype._buildBlock = function (t) {
        if (
          (e.prototype._buildBlock.call(this, t),
          (this._tempTextureRead = t._getFreeVariableName("tempTextureRead")),
          t.sharedData.blockingBlocks.indexOf(this) < 0 &&
            t.sharedData.blockingBlocks.push(this),
          t.sharedData.textureBlocks.indexOf(this) < 0 &&
            t.sharedData.textureBlocks.push(this),
          t.sharedData.blocksWithDefines.indexOf(this) < 0 &&
            t.sharedData.blocksWithDefines.push(this),
          t.target !== Wl.Fragment)
        )
          return (
            t._emit2DSampler(this._samplerName), void this._injectVertexCode(t)
          );
        if (
          this._outputs.some(function (e) {
            return e.isConnectedInFragmentShader;
          })
        ) {
          t._emit2DSampler(this._samplerName),
            (this._linearDefineName = t._getFreeDefineName("ISLINEAR")),
            (this._gammaDefineName = t._getFreeDefineName("ISGAMMA"));
          var i = "//" + this.name;
          t._emitFunctionFromInclude("helperFunctions", i),
            this._writeTextureRead(t);
          for (var n = 0, r = this._outputs; n < r.length; n++) {
            var o = r[n];
            o.hasEndpoints && this._writeOutput(t, o, o.name);
          }
          return this;
        }
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return (
          (t.convertToGammaSpace = this.convertToGammaSpace),
          (t.convertToLinearSpace = this.convertToLinearSpace),
          this.texture && (t.texture = this.texture.serialize()),
          t
        );
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          (this.convertToGammaSpace = t.convertToGammaSpace),
          (this.convertToLinearSpace = !!t.convertToLinearSpace),
          t.texture &&
            ((n = 0 === t.texture.url.indexOf("data:") ? "" : n),
            (this.texture = mn.Parse(t.texture, i, n)));
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.CurrentScreenBlock"] = cc;
  var uc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Fragment) || this;
      return (
        (i._samplerName = "diffuseSampler"),
        (i.convertToGammaSpace = !1),
        (i.convertToLinearSpace = !1),
        (i._isUnique = !1),
        i.registerInput("uv", Hl.Vector2, !1, Wl.VertexAndFragment),
        i.registerOutput("rgba", Hl.Color4, Wl.Neutral),
        i.registerOutput("rgb", Hl.Color3, Wl.Neutral),
        i.registerOutput("r", Hl.Float, Wl.Neutral),
        i.registerOutput("g", Hl.Float, Wl.Neutral),
        i.registerOutput("b", Hl.Float, Wl.Neutral),
        i.registerOutput("a", Hl.Float, Wl.Neutral),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector3),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector4),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ParticleTextureBlock";
      }),
      Object.defineProperty(t.prototype, "uv", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rgba", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rgb", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "r", {
        get: function () {
          return this._outputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "g", {
        get: function () {
          return this._outputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "b", {
        get: function () {
          return this._outputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "a", {
        get: function () {
          return this._outputs[5];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.initialize = function (e) {
        e._excludeVariableName("diffuseSampler");
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.uv.isConnected) {
          var t = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "particle_uv" === e.name;
          });
          t || (t = new lc("uv")).setAsAttribute("particle_uv"),
            t.output.connectTo(this.uv);
        }
      }),
      (t.prototype.prepareDefines = function (e, t, i) {
        i.setValue(this._linearDefineName, this.convertToGammaSpace, !0),
          i.setValue(this._gammaDefineName, this.convertToLinearSpace, !0);
      }),
      (t.prototype.isReady = function () {
        return !(this.texture && !this.texture.isReadyOrNotBlocking());
      }),
      (t.prototype._writeOutput = function (e, t, i) {
        (e.compilationString +=
          this._declareOutput(t, e) +
          " = " +
          this._tempTextureRead +
          "." +
          i +
          ";\r\n"),
          (e.compilationString += "#ifdef " + this._linearDefineName + "\r\n"),
          (e.compilationString +=
            t.associatedVariableName +
            " = toGammaSpace(" +
            t.associatedVariableName +
            ");\r\n"),
          (e.compilationString += "#endif\r\n"),
          (e.compilationString += "#ifdef " + this._gammaDefineName + "\r\n"),
          (e.compilationString +=
            t.associatedVariableName +
            " = toLinearSpace(" +
            t.associatedVariableName +
            ");\r\n"),
          (e.compilationString += "#endif\r\n");
      }),
      (t.prototype._buildBlock = function (t) {
        if ((e.prototype._buildBlock.call(this, t), t.target !== Wl.Vertex)) {
          (this._tempTextureRead = t._getFreeVariableName("tempTextureRead")),
            t._emit2DSampler(this._samplerName),
            t.sharedData.blockingBlocks.push(this),
            t.sharedData.textureBlocks.push(this),
            t.sharedData.blocksWithDefines.push(this),
            (this._linearDefineName = t._getFreeDefineName("ISLINEAR")),
            (this._gammaDefineName = t._getFreeDefineName("ISGAMMA"));
          var i = "//" + this.name;
          t._emitFunctionFromInclude("helperFunctions", i),
            (t.compilationString +=
              "vec4 " +
              this._tempTextureRead +
              " = texture2D(" +
              this._samplerName +
              ", " +
              this.uv.associatedVariableName +
              ");\r\n");
          for (var n = 0, r = this._outputs; n < r.length; n++) {
            var o = r[n];
            o.hasEndpoints && this._writeOutput(t, o, o.name);
          }
          return this;
        }
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return (
          (t.convertToGammaSpace = this.convertToGammaSpace),
          (t.convertToLinearSpace = this.convertToLinearSpace),
          this.texture && (t.texture = this.texture.serialize()),
          t
        );
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          (this.convertToGammaSpace = t.convertToGammaSpace),
          (this.convertToLinearSpace = !!t.convertToLinearSpace),
          t.texture &&
            ((n = 0 === t.texture.url.indexOf("data:") ? "" : n),
            (this.texture = mn.Parse(t.texture, i, n)));
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ParticleTextureBlock"] = uc;
  var hc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Fragment) || this;
      return (
        (i._isUnique = !0),
        i.registerInput("color", Hl.Color4, !1, Wl.Fragment),
        i.registerOutput("rampColor", Hl.Color4, Wl.Fragment),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ParticleRampGradientBlock";
      }),
      Object.defineProperty(t.prototype, "color", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rampColor", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.initialize = function (e) {
        e._excludeVariableName("remapRanges"),
          e._excludeVariableName("rampSampler"),
          e._excludeVariableName("baseColor"),
          e._excludeVariableName("alpha"),
          e._excludeVariableName("remappedColorIndex"),
          e._excludeVariableName("rampColor"),
          e._excludeVariableName("finalAlpha");
      }),
      (t.prototype._buildBlock = function (t) {
        if ((e.prototype._buildBlock.call(this, t), t.target !== Wl.Vertex))
          return (
            t._emit2DSampler("rampSampler"),
            t._emitVaryingFromString("remapRanges", "vec4", "RAMPGRADIENT"),
            (t.compilationString +=
              "\n            #ifdef RAMPGRADIENT\n                vec4 baseColor = " +
              this.color.associatedVariableName +
              ";\n                float alpha = " +
              this.color.associatedVariableName +
              ".a;\n\n                float remappedColorIndex = clamp((alpha - remapRanges.x) / remapRanges.y, 0.0, 1.0);\n\n                vec4 rampColor = texture2D(rampSampler, vec2(1.0 - remappedColorIndex, 0.));\n                baseColor.rgb *= rampColor.rgb;\n\n                // Remapped alpha\n                float finalAlpha = baseColor.a;\n                baseColor.a = clamp((alpha * rampColor.a - remapRanges.z) / remapRanges.w, 0.0, 1.0);\n\n                " +
              this._declareOutput(this.rampColor, t) +
              " = baseColor;\n            #else\n                " +
              this._declareOutput(this.rampColor, t) +
              " = " +
              this.color.associatedVariableName +
              ";\n            #endif\n        "),
            this
          );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ParticleRampGradientBlock"] = hc;
  var dc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Fragment) || this;
      return (
        (i._isUnique = !0),
        i.registerInput("color", Hl.Color4, !1, Wl.Fragment),
        i.registerInput("alphaTexture", Hl.Float, !1, Wl.Fragment),
        i.registerInput("alphaColor", Hl.Float, !1, Wl.Fragment),
        i.registerOutput("blendColor", Hl.Color4, Wl.Fragment),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ParticleBlendMultiplyBlock";
      }),
      Object.defineProperty(t.prototype, "color", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "alphaTexture", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "alphaColor", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "blendColor", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.initialize = function (e) {
        e._excludeVariableName("sourceAlpha");
      }),
      (t.prototype._buildBlock = function (t) {
        if ((e.prototype._buildBlock.call(this, t), t.target !== Wl.Vertex))
          return (
            (t.compilationString +=
              "\n            #ifdef BLENDMULTIPLYMODE\n                " +
              this._declareOutput(this.blendColor, t) +
              ";\n                float sourceAlpha = " +
              this.alphaColor.associatedVariableName +
              " * " +
              this.alphaTexture.associatedVariableName +
              ";\n                " +
              this.blendColor.associatedVariableName +
              ".rgb = " +
              this.color.associatedVariableName +
              ".rgb * sourceAlpha + vec3(1.0) * (1.0 - sourceAlpha);\n                " +
              this.blendColor.associatedVariableName +
              ".a = " +
              this.color.associatedVariableName +
              ".a;\n            #else\n                " +
              this._declareOutput(this.blendColor, t) +
              " = " +
              this.color.associatedVariableName +
              ";\n            #endif\n        "),
            this
          );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ParticleBlendMultiplyBlock"] = dc;
  var pc,
    fc = (function (e) {
      function t(t) {
        var i = e.call(this, t, Wl.Neutral) || this;
        return (
          i.registerInput("xyz ", Hl.Vector3, !0),
          i.registerInput("xy ", Hl.Vector2, !0),
          i.registerInput("x", Hl.Float, !0),
          i.registerInput("y", Hl.Float, !0),
          i.registerInput("z", Hl.Float, !0),
          i.registerInput("w", Hl.Float, !0),
          i.registerOutput("xyzw", Hl.Vector4),
          i.registerOutput("xyz", Hl.Vector3),
          i.registerOutput("xy", Hl.Vector2),
          i
        );
      }
      return (
        P(t, e),
        (t.prototype.getClassName = function () {
          return "VectorMergerBlock";
        }),
        Object.defineProperty(t.prototype, "xyzIn", {
          get: function () {
            return this._inputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "xyIn", {
          get: function () {
            return this._inputs[1];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "x", {
          get: function () {
            return this._inputs[2];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "y", {
          get: function () {
            return this._inputs[3];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "z", {
          get: function () {
            return this._inputs[4];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "w", {
          get: function () {
            return this._inputs[5];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "xyzw", {
          get: function () {
            return this._outputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "xyzOut", {
          get: function () {
            return this._outputs[1];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "xyOut", {
          get: function () {
            return this._outputs[2];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "xy", {
          get: function () {
            return this.xyOut;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "xyz", {
          get: function () {
            return this.xyzOut;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._buildBlock = function (t) {
          e.prototype._buildBlock.call(this, t);
          var i = this.x,
            n = this.y,
            r = this.z,
            o = this.w,
            s = this.xyIn,
            a = this.xyzIn,
            l = this._outputs[0],
            c = this._outputs[1],
            u = this._outputs[2];
          return (
            a.isConnected
              ? l.hasEndpoints
                ? (t.compilationString +=
                    this._declareOutput(l, t) +
                    " = vec4(" +
                    a.associatedVariableName +
                    ", " +
                    (o.isConnected ? this._writeVariable(o) : "0.0") +
                    ");\r\n")
                : c.hasEndpoints
                  ? (t.compilationString +=
                      this._declareOutput(c, t) +
                      " = " +
                      a.associatedVariableName +
                      ";\r\n")
                  : u.hasEndpoints &&
                    (t.compilationString +=
                      this._declareOutput(u, t) +
                      " = " +
                      a.associatedVariableName +
                      ".xy;\r\n")
              : s.isConnected
                ? l.hasEndpoints
                  ? (t.compilationString +=
                      this._declareOutput(l, t) +
                      " = vec4(" +
                      s.associatedVariableName +
                      ", " +
                      (r.isConnected ? this._writeVariable(r) : "0.0") +
                      ", " +
                      (o.isConnected ? this._writeVariable(o) : "0.0") +
                      ");\r\n")
                  : c.hasEndpoints
                    ? (t.compilationString +=
                        this._declareOutput(c, t) +
                        " = vec3(" +
                        s.associatedVariableName +
                        ", " +
                        (r.isConnected ? this._writeVariable(r) : "0.0") +
                        ");\r\n")
                    : u.hasEndpoints &&
                      (t.compilationString +=
                        this._declareOutput(u, t) +
                        " = " +
                        s.associatedVariableName +
                        ";\r\n")
                : l.hasEndpoints
                  ? (t.compilationString +=
                      this._declareOutput(l, t) +
                      " = vec4(" +
                      (i.isConnected ? this._writeVariable(i) : "0.0") +
                      ", " +
                      (n.isConnected ? this._writeVariable(n) : "0.0") +
                      ", " +
                      (r.isConnected ? this._writeVariable(r) : "0.0") +
                      ", " +
                      (o.isConnected ? this._writeVariable(o) : "0.0") +
                      ");\r\n")
                  : c.hasEndpoints
                    ? (t.compilationString +=
                        this._declareOutput(c, t) +
                        " = vec3(" +
                        (i.isConnected ? this._writeVariable(i) : "0.0") +
                        ", " +
                        (n.isConnected ? this._writeVariable(n) : "0.0") +
                        ", " +
                        (r.isConnected ? this._writeVariable(r) : "0.0") +
                        ");\r\n")
                    : u.hasEndpoints &&
                      (t.compilationString +=
                        this._declareOutput(u, t) +
                        " = vec2(" +
                        (i.isConnected ? this._writeVariable(i) : "0.0") +
                        ", " +
                        (n.isConnected ? this._writeVariable(n) : "0.0") +
                        ");\r\n"),
            this
          );
        }),
        t
      );
    })(Jl);
  function _c(e, t, i, n) {
    return (
      void 0 === t && (t = pc.Boolean),
      void 0 === i && (i = "PROPERTIES"),
      function (r, o) {
        var s = r._propStore;
        s || ((s = []), (r._propStore = s)),
          s.push({
            propertyName: o,
            displayName: e,
            type: t,
            groupName: i,
            options: null != n ? n : {},
          });
      }
    );
  }
  (h.RegisteredTypes["BABYLON.VectorMergerBlock"] = fc),
    (function (e) {
      (e[(e.Boolean = 0)] = "Boolean"),
        (e[(e.Float = 1)] = "Float"),
        (e[(e.Vector2 = 2)] = "Vector2"),
        (e[(e.List = 3)] = "List");
    })(pc || (pc = {}));
  var mc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        (i.sourceRange = new p(-1, 1)),
        (i.targetRange = new p(0, 1)),
        i.registerInput("input", Hl.AutoDetect),
        i.registerInput("sourceMin", Hl.Float, !0),
        i.registerInput("sourceMax", Hl.Float, !0),
        i.registerInput("targetMin", Hl.Float, !0),
        i.registerInput("targetMax", Hl.Float, !0),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "RemapBlock";
      }),
      Object.defineProperty(t.prototype, "input", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "sourceMin", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "sourceMax", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "targetMin", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "targetMax", {
        get: function () {
          return this._inputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0],
          n = this.sourceMin.isConnected
            ? this.sourceMin.associatedVariableName
            : this._writeFloat(this.sourceRange.x),
          r = this.sourceMax.isConnected
            ? this.sourceMax.associatedVariableName
            : this._writeFloat(this.sourceRange.y),
          o = this.targetMin.isConnected
            ? this.targetMin.associatedVariableName
            : this._writeFloat(this.targetRange.x),
          s = this.targetMax.isConnected
            ? this.targetMax.associatedVariableName
            : this._writeFloat(this.targetRange.y);
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = " +
            o +
            " + (" +
            this._inputs[0].associatedVariableName +
            " - " +
            n +
            ") * (" +
            s +
            " - " +
            o +
            ") / (" +
            r +
            " - " +
            n +
            ");\r\n"),
          this
        );
      }),
      (t.prototype._dumpPropertiesCode = function () {
        return (
          this._codeVariableName +
          ".sourceRange = new BABYLON.Vector2(" +
          this.sourceRange.x +
          ", " +
          this.sourceRange.y +
          ");\r\n" +
          (this._codeVariableName + ".targetRange = new BABYLON.Vector2(") +
          this.targetRange.x +
          ", " +
          this.targetRange.y +
          ");\r\n"
        );
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return (
          (t.sourceRange = this.sourceRange.asArray()),
          (t.targetRange = this.targetRange.asArray()),
          t
        );
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          (this.sourceRange = p.FromArray(t.sourceRange)),
          (this.targetRange = p.FromArray(t.targetRange));
      }),
      R([_c("From", pc.Vector2)], t.prototype, "sourceRange", void 0),
      R([_c("To", pc.Vector2)], t.prototype, "targetRange", void 0),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.RemapBlock"] = mc;
  var gc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("left", Hl.AutoDetect),
        i.registerInput("right", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._linkConnectionTypes(0, 1),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "MultiplyBlock";
      }),
      Object.defineProperty(t.prototype, "left", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "right", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = " +
            this.left.associatedVariableName +
            " * " +
            this.right.associatedVariableName +
            ";\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.MultiplyBlock"] = gc;
  var vc,
    yc = (function () {
      function e() {
        (this.direction1 = new f(0, 1, 0)),
          (this.direction2 = new f(0, 1, 0)),
          (this.minEmitBox = new f(-0.5, -0.5, -0.5)),
          (this.maxEmitBox = new f(0.5, 0.5, 0.5));
      }
      return (
        (e.prototype.startDirectionFunction = function (e, t, i, n) {
          var r = s.RandomRange(this.direction1.x, this.direction2.x),
            o = s.RandomRange(this.direction1.y, this.direction2.y),
            a = s.RandomRange(this.direction1.z, this.direction2.z);
          if (n) return (t.x = r), (t.y = o), void (t.z = a);
          f.TransformNormalFromFloatsToRef(r, o, a, e, t);
        }),
        (e.prototype.startPositionFunction = function (e, t, i, n) {
          var r = s.RandomRange(this.minEmitBox.x, this.maxEmitBox.x),
            o = s.RandomRange(this.minEmitBox.y, this.maxEmitBox.y),
            a = s.RandomRange(this.minEmitBox.z, this.maxEmitBox.z);
          if (n) return (t.x = r), (t.y = o), void (t.z = a);
          f.TransformCoordinatesFromFloatsToRef(r, o, a, e, t);
        }),
        (e.prototype.clone = function () {
          var t = new e();
          return K.DeepCopy(this, t), t;
        }),
        (e.prototype.applyToShader = function (e) {
          e.setVector3("direction1", this.direction1),
            e.setVector3("direction2", this.direction2),
            e.setVector3("minEmitBox", this.minEmitBox),
            e.setVector3("maxEmitBox", this.maxEmitBox);
        }),
        (e.prototype.getEffectDefines = function () {
          return "#define BOXEMITTER";
        }),
        (e.prototype.getClassName = function () {
          return "BoxParticleEmitter";
        }),
        (e.prototype.serialize = function () {
          var e = {};
          return (
            (e.type = this.getClassName()),
            (e.direction1 = this.direction1.asArray()),
            (e.direction2 = this.direction2.asArray()),
            (e.minEmitBox = this.minEmitBox.asArray()),
            (e.maxEmitBox = this.maxEmitBox.asArray()),
            e
          );
        }),
        (e.prototype.parse = function (e) {
          f.FromArrayToRef(e.direction1, 0, this.direction1),
            f.FromArrayToRef(e.direction2, 0, this.direction2),
            f.FromArrayToRef(e.minEmitBox, 0, this.minEmitBox),
            f.FromArrayToRef(e.maxEmitBox, 0, this.maxEmitBox);
        }),
        e
      );
    })(),
    bc = (function () {
      function e(e, t, i) {
        void 0 === e && (e = 1),
          void 0 === t && (t = Math.PI),
          void 0 === i && (i = 0),
          (this.directionRandomizer = i),
          (this.radiusRange = 1),
          (this.heightRange = 1),
          (this.emitFromSpawnPointOnly = !1),
          (this.angle = t),
          (this.radius = e);
      }
      return (
        Object.defineProperty(e.prototype, "radius", {
          get: function () {
            return this._radius;
          },
          set: function (e) {
            (this._radius = e), this._buildHeight();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "angle", {
          get: function () {
            return this._angle;
          },
          set: function (e) {
            (this._angle = e), this._buildHeight();
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype._buildHeight = function () {
          0 !== this._angle
            ? (this._height = this._radius / Math.tan(this._angle / 2))
            : (this._height = 1);
        }),
        (e.prototype.startDirectionFunction = function (e, t, i, n) {
          n
            ? y.Vector3[0].copyFrom(i._localPosition).normalize()
            : i.position
                .subtractToRef(e.getTranslation(), y.Vector3[0])
                .normalize();
          var r = s.RandomRange(0, this.directionRandomizer),
            o = s.RandomRange(0, this.directionRandomizer),
            a = s.RandomRange(0, this.directionRandomizer);
          (t.x = y.Vector3[0].x + r),
            (t.y = y.Vector3[0].y + o),
            (t.z = y.Vector3[0].z + a),
            t.normalize();
        }),
        (e.prototype.startPositionFunction = function (e, t, i, n) {
          var r,
            o = s.RandomRange(0, 2 * Math.PI);
          r = this.emitFromSpawnPointOnly
            ? 1e-4
            : 1 - (r = s.RandomRange(0, this.heightRange)) * r;
          var a =
              this._radius - s.RandomRange(0, this._radius * this.radiusRange),
            l = (a *= r) * Math.sin(o),
            c = a * Math.cos(o),
            u = r * this._height;
          if (n) return (t.x = l), (t.y = u), void (t.z = c);
          f.TransformCoordinatesFromFloatsToRef(l, u, c, e, t);
        }),
        (e.prototype.clone = function () {
          var t = new e(this._radius, this._angle, this.directionRandomizer);
          return K.DeepCopy(this, t), t;
        }),
        (e.prototype.applyToShader = function (e) {
          e.setFloat2("radius", this._radius, this.radiusRange),
            e.setFloat("coneAngle", this._angle),
            e.setFloat2("height", this._height, this.heightRange),
            e.setFloat("directionRandomizer", this.directionRandomizer);
        }),
        (e.prototype.getEffectDefines = function () {
          var e = "#define CONEEMITTER";
          return (
            this.emitFromSpawnPointOnly &&
              (e += "\n#define CONEEMITTERSPAWNPOINT"),
            e
          );
        }),
        (e.prototype.getClassName = function () {
          return "ConeParticleEmitter";
        }),
        (e.prototype.serialize = function () {
          var e = {};
          return (
            (e.type = this.getClassName()),
            (e.radius = this._radius),
            (e.angle = this._angle),
            (e.directionRandomizer = this.directionRandomizer),
            (e.radiusRange = this.radiusRange),
            (e.heightRange = this.heightRange),
            (e.emitFromSpawnPointOnly = this.emitFromSpawnPointOnly),
            e
          );
        }),
        (e.prototype.parse = function (e) {
          (this.radius = e.radius),
            (this.angle = e.angle),
            (this.directionRandomizer = e.directionRandomizer),
            (this.radiusRange = void 0 !== e.radiusRange ? e.radiusRange : 1),
            (this.heightRange = void 0 !== e.radiusRange ? e.heightRange : 1),
            (this.emitFromSpawnPointOnly =
              void 0 !== e.emitFromSpawnPointOnly && e.emitFromSpawnPointOnly);
        }),
        e
      );
    })(),
    Tc = (function () {
      function e(e, t, i, n) {
        void 0 === e && (e = 1),
          void 0 === t && (t = 1),
          void 0 === i && (i = 1),
          void 0 === n && (n = 0),
          (this.radius = e),
          (this.height = t),
          (this.radiusRange = i),
          (this.directionRandomizer = n);
      }
      return (
        (e.prototype.startDirectionFunction = function (e, t, i, n) {
          var r = i.position.subtract(e.getTranslation()).normalize(),
            o = s.RandomRange(
              -this.directionRandomizer / 2,
              this.directionRandomizer / 2
            ),
            a = Math.atan2(r.x, r.z);
          (a +=
            s.RandomRange(-Math.PI / 2, Math.PI / 2) *
            this.directionRandomizer),
            (r.y = o),
            (r.x = Math.sin(a)),
            (r.z = Math.cos(a)),
            r.normalize(),
            n
              ? t.copyFrom(r)
              : f.TransformNormalFromFloatsToRef(r.x, r.y, r.z, e, t);
        }),
        (e.prototype.startPositionFunction = function (e, t, i, n) {
          var r = s.RandomRange(-this.height / 2, this.height / 2),
            o = s.RandomRange(0, 2 * Math.PI),
            a = s.RandomRange(
              (1 - this.radiusRange) * (1 - this.radiusRange),
              1
            ),
            l = Math.sqrt(a) * this.radius,
            c = l * Math.cos(o),
            u = l * Math.sin(o);
          n
            ? t.copyFromFloats(c, r, u)
            : f.TransformCoordinatesFromFloatsToRef(c, r, u, e, t);
        }),
        (e.prototype.clone = function () {
          var t = new e(this.radius, this.directionRandomizer);
          return K.DeepCopy(this, t), t;
        }),
        (e.prototype.applyToShader = function (e) {
          e.setFloat("radius", this.radius),
            e.setFloat("height", this.height),
            e.setFloat("radiusRange", this.radiusRange),
            e.setFloat("directionRandomizer", this.directionRandomizer);
        }),
        (e.prototype.getEffectDefines = function () {
          return "#define CYLINDEREMITTER";
        }),
        (e.prototype.getClassName = function () {
          return "CylinderParticleEmitter";
        }),
        (e.prototype.serialize = function () {
          var e = {};
          return (
            (e.type = this.getClassName()),
            (e.radius = this.radius),
            (e.height = this.height),
            (e.radiusRange = this.radiusRange),
            (e.directionRandomizer = this.directionRandomizer),
            e
          );
        }),
        (e.prototype.parse = function (e) {
          (this.radius = e.radius),
            (this.height = e.height),
            (this.radiusRange = e.radiusRange),
            (this.directionRandomizer = e.directionRandomizer);
        }),
        e
      );
    })(),
    Sc = (function (e) {
      function t(t, i, n, r, o) {
        void 0 === t && (t = 1),
          void 0 === i && (i = 1),
          void 0 === n && (n = 1),
          void 0 === r && (r = new f(0, 1, 0)),
          void 0 === o && (o = new f(0, 1, 0));
        var s = e.call(this, t, i, n) || this;
        return (s.direction1 = r), (s.direction2 = o), s;
      }
      return (
        P(t, e),
        (t.prototype.startDirectionFunction = function (e, t, i) {
          var n = s.RandomRange(this.direction1.x, this.direction2.x),
            r = s.RandomRange(this.direction1.y, this.direction2.y),
            o = s.RandomRange(this.direction1.z, this.direction2.z);
          f.TransformNormalFromFloatsToRef(n, r, o, e, t);
        }),
        (t.prototype.clone = function () {
          var e = new t(
            this.radius,
            this.height,
            this.radiusRange,
            this.direction1,
            this.direction2
          );
          return K.DeepCopy(this, e), e;
        }),
        (t.prototype.applyToShader = function (e) {
          e.setFloat("radius", this.radius),
            e.setFloat("height", this.height),
            e.setFloat("radiusRange", this.radiusRange),
            e.setVector3("direction1", this.direction1),
            e.setVector3("direction2", this.direction2);
        }),
        (t.prototype.getEffectDefines = function () {
          return "#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER";
        }),
        (t.prototype.getClassName = function () {
          return "CylinderDirectedParticleEmitter";
        }),
        (t.prototype.serialize = function () {
          var t = e.prototype.serialize.call(this);
          return (
            (t.direction1 = this.direction1.asArray()),
            (t.direction2 = this.direction2.asArray()),
            t
          );
        }),
        (t.prototype.parse = function (t) {
          e.prototype.parse.call(this, t),
            this.direction1.copyFrom(t.direction1),
            this.direction2.copyFrom(t.direction2);
        }),
        t
      );
    })(Tc),
    Cc = (function () {
      function e(e, t, i) {
        void 0 === e && (e = 1),
          void 0 === t && (t = 1),
          void 0 === i && (i = 0),
          (this.radius = e),
          (this.radiusRange = t),
          (this.directionRandomizer = i);
      }
      return (
        (e.prototype.startDirectionFunction = function (e, t, i, n) {
          var r = i.position.subtract(e.getTranslation()).normalize(),
            o = s.RandomRange(0, this.directionRandomizer),
            a = s.RandomRange(0, this.directionRandomizer),
            l = s.RandomRange(0, this.directionRandomizer);
          (r.x += o),
            (r.y += a),
            (r.z += l),
            r.normalize(),
            n
              ? t.copyFrom(r)
              : f.TransformNormalFromFloatsToRef(r.x, r.y, r.z, e, t);
        }),
        (e.prototype.startPositionFunction = function (e, t, i, n) {
          var r =
              this.radius - s.RandomRange(0, this.radius * this.radiusRange),
            o = s.RandomRange(0, 1),
            a = s.RandomRange(0, 2 * Math.PI),
            l = Math.acos(2 * o - 1),
            c = r * Math.cos(a) * Math.sin(l),
            u = r * Math.cos(l),
            h = r * Math.sin(a) * Math.sin(l);
          n
            ? t.copyFromFloats(c, Math.abs(u), h)
            : f.TransformCoordinatesFromFloatsToRef(c, Math.abs(u), h, e, t);
        }),
        (e.prototype.clone = function () {
          var t = new e(this.radius, this.directionRandomizer);
          return K.DeepCopy(this, t), t;
        }),
        (e.prototype.applyToShader = function (e) {
          e.setFloat("radius", this.radius),
            e.setFloat("radiusRange", this.radiusRange),
            e.setFloat("directionRandomizer", this.directionRandomizer);
        }),
        (e.prototype.getEffectDefines = function () {
          return "#define HEMISPHERICEMITTER";
        }),
        (e.prototype.getClassName = function () {
          return "HemisphericParticleEmitter";
        }),
        (e.prototype.serialize = function () {
          var e = {};
          return (
            (e.type = this.getClassName()),
            (e.radius = this.radius),
            (e.radiusRange = this.radiusRange),
            (e.directionRandomizer = this.directionRandomizer),
            e
          );
        }),
        (e.prototype.parse = function (e) {
          (this.radius = e.radius),
            (this.radiusRange = e.radiusRange),
            (this.directionRandomizer = e.directionRandomizer);
        }),
        e
      );
    })(),
    xc = (function () {
      function e() {
        (this.direction1 = new f(0, 1, 0)), (this.direction2 = new f(0, 1, 0));
      }
      return (
        (e.prototype.startDirectionFunction = function (e, t, i, n) {
          var r = s.RandomRange(this.direction1.x, this.direction2.x),
            o = s.RandomRange(this.direction1.y, this.direction2.y),
            a = s.RandomRange(this.direction1.z, this.direction2.z);
          n
            ? t.copyFromFloats(r, o, a)
            : f.TransformNormalFromFloatsToRef(r, o, a, e, t);
        }),
        (e.prototype.startPositionFunction = function (e, t, i, n) {
          n
            ? t.copyFromFloats(0, 0, 0)
            : f.TransformCoordinatesFromFloatsToRef(0, 0, 0, e, t);
        }),
        (e.prototype.clone = function () {
          var t = new e();
          return K.DeepCopy(this, t), t;
        }),
        (e.prototype.applyToShader = function (e) {
          e.setVector3("direction1", this.direction1),
            e.setVector3("direction2", this.direction2);
        }),
        (e.prototype.getEffectDefines = function () {
          return "#define POINTEMITTER";
        }),
        (e.prototype.getClassName = function () {
          return "PointParticleEmitter";
        }),
        (e.prototype.serialize = function () {
          var e = {};
          return (
            (e.type = this.getClassName()),
            (e.direction1 = this.direction1.asArray()),
            (e.direction2 = this.direction2.asArray()),
            e
          );
        }),
        (e.prototype.parse = function (e) {
          f.FromArrayToRef(e.direction1, 0, this.direction1),
            f.FromArrayToRef(e.direction2, 0, this.direction2);
        }),
        e
      );
    })(),
    Ec = (function () {
      function e(e, t, i) {
        void 0 === e && (e = 1),
          void 0 === t && (t = 1),
          void 0 === i && (i = 0),
          (this.radius = e),
          (this.radiusRange = t),
          (this.directionRandomizer = i);
      }
      return (
        (e.prototype.startDirectionFunction = function (e, t, i, n) {
          var r = i.position.subtract(e.getTranslation()).normalize(),
            o = s.RandomRange(0, this.directionRandomizer),
            a = s.RandomRange(0, this.directionRandomizer),
            l = s.RandomRange(0, this.directionRandomizer);
          (r.x += o),
            (r.y += a),
            (r.z += l),
            r.normalize(),
            n
              ? t.copyFrom(r)
              : f.TransformNormalFromFloatsToRef(r.x, r.y, r.z, e, t);
        }),
        (e.prototype.startPositionFunction = function (e, t, i, n) {
          var r =
              this.radius - s.RandomRange(0, this.radius * this.radiusRange),
            o = s.RandomRange(0, 1),
            a = s.RandomRange(0, 2 * Math.PI),
            l = Math.acos(2 * o - 1),
            c = r * Math.cos(a) * Math.sin(l),
            u = r * Math.cos(l),
            h = r * Math.sin(a) * Math.sin(l);
          n
            ? t.copyFromFloats(c, u, h)
            : f.TransformCoordinatesFromFloatsToRef(c, u, h, e, t);
        }),
        (e.prototype.clone = function () {
          var t = new e(this.radius, this.directionRandomizer);
          return K.DeepCopy(this, t), t;
        }),
        (e.prototype.applyToShader = function (e) {
          e.setFloat("radius", this.radius),
            e.setFloat("radiusRange", this.radiusRange),
            e.setFloat("directionRandomizer", this.directionRandomizer);
        }),
        (e.prototype.getEffectDefines = function () {
          return "#define SPHEREEMITTER";
        }),
        (e.prototype.getClassName = function () {
          return "SphereParticleEmitter";
        }),
        (e.prototype.serialize = function () {
          var e = {};
          return (
            (e.type = this.getClassName()),
            (e.radius = this.radius),
            (e.radiusRange = this.radiusRange),
            (e.directionRandomizer = this.directionRandomizer),
            e
          );
        }),
        (e.prototype.parse = function (e) {
          (this.radius = e.radius),
            (this.radiusRange = e.radiusRange),
            (this.directionRandomizer = e.directionRandomizer);
        }),
        e
      );
    })(),
    Pc = (function (e) {
      function t(t, i, n) {
        void 0 === t && (t = 1),
          void 0 === i && (i = new f(0, 1, 0)),
          void 0 === n && (n = new f(0, 1, 0));
        var r = e.call(this, t) || this;
        return (r.direction1 = i), (r.direction2 = n), r;
      }
      return (
        P(t, e),
        (t.prototype.startDirectionFunction = function (e, t, i) {
          var n = s.RandomRange(this.direction1.x, this.direction2.x),
            r = s.RandomRange(this.direction1.y, this.direction2.y),
            o = s.RandomRange(this.direction1.z, this.direction2.z);
          f.TransformNormalFromFloatsToRef(n, r, o, e, t);
        }),
        (t.prototype.clone = function () {
          var e = new t(this.radius, this.direction1, this.direction2);
          return K.DeepCopy(this, e), e;
        }),
        (t.prototype.applyToShader = function (e) {
          e.setFloat("radius", this.radius),
            e.setFloat("radiusRange", this.radiusRange),
            e.setVector3("direction1", this.direction1),
            e.setVector3("direction2", this.direction2);
        }),
        (t.prototype.getEffectDefines = function () {
          return "#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER";
        }),
        (t.prototype.getClassName = function () {
          return "SphereDirectedParticleEmitter";
        }),
        (t.prototype.serialize = function () {
          var t = e.prototype.serialize.call(this);
          return (
            (t.direction1 = this.direction1.asArray()),
            (t.direction2 = this.direction2.asArray()),
            t
          );
        }),
        (t.prototype.parse = function (t) {
          e.prototype.parse.call(this, t),
            this.direction1.copyFrom(t.direction1),
            this.direction2.copyFrom(t.direction2);
        }),
        t
      );
    })(Ec),
    Ac = (function () {
      function e() {
        (this.particlePositionGenerator = function () {}),
          (this.particleDestinationGenerator = function () {});
      }
      return (
        (e.prototype.startDirectionFunction = function (e, t, i, n) {
          var r = y.Vector3[0];
          if (this.particleDestinationGenerator) {
            this.particleDestinationGenerator(-1, i, r);
            var o = y.Vector3[1];
            r.subtractToRef(i.position, o), o.scaleToRef(1 / i.lifeTime, r);
          } else r.set(0, 0, 0);
          n ? t.copyFrom(r) : f.TransformNormalToRef(r, e, t);
        }),
        (e.prototype.startPositionFunction = function (e, t, i, n) {
          var r = y.Vector3[0];
          this.particlePositionGenerator
            ? this.particlePositionGenerator(-1, i, r)
            : r.set(0, 0, 0),
            n ? t.copyFrom(r) : f.TransformCoordinatesToRef(r, e, t);
        }),
        (e.prototype.clone = function () {
          var t = new e();
          return K.DeepCopy(this, t), t;
        }),
        (e.prototype.applyToShader = function (e) {}),
        (e.prototype.getEffectDefines = function () {
          return "#define CUSTOMEMITTER";
        }),
        (e.prototype.getClassName = function () {
          return "CustomParticleEmitter";
        }),
        (e.prototype.serialize = function () {
          var e = {};
          return (e.type = this.getClassName()), e;
        }),
        (e.prototype.parse = function (e) {}),
        e
      );
    })(),
    Rc = (function () {
      function e(e) {
        void 0 === e && (e = null),
          (this._indices = null),
          (this._positions = null),
          (this._normals = null),
          (this._storedNormal = f.Zero()),
          (this._mesh = null),
          (this.direction1 = new f(0, 1, 0)),
          (this.direction2 = new f(0, 1, 0)),
          (this.useMeshNormalsForDirection = !0),
          (this.mesh = e);
      }
      return (
        Object.defineProperty(e.prototype, "mesh", {
          get: function () {
            return this._mesh;
          },
          set: function (e) {
            this._mesh !== e &&
              ((this._mesh = e),
              e
                ? ((this._indices = e.getIndices()),
                  (this._positions = e.getVerticesData(wt.PositionKind)),
                  (this._normals = e.getVerticesData(wt.NormalKind)))
                : ((this._indices = null),
                  (this._positions = null),
                  (this._normals = null)));
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.startDirectionFunction = function (e, t, i, n) {
          if (this.useMeshNormalsForDirection && this._normals)
            f.TransformNormalToRef(this._storedNormal, e, t);
          else {
            var r = s.RandomRange(this.direction1.x, this.direction2.x),
              o = s.RandomRange(this.direction1.y, this.direction2.y),
              a = s.RandomRange(this.direction1.z, this.direction2.z);
            n
              ? t.copyFromFloats(r, o, a)
              : f.TransformNormalFromFloatsToRef(r, o, a, e, t);
          }
        }),
        (e.prototype.startPositionFunction = function (e, t, i, n) {
          if (this._indices && this._positions) {
            var r = (3 * Math.random() * (this._indices.length / 3)) | 0,
              o = Math.random(),
              s = Math.random() * (1 - o),
              a = 1 - o - s,
              l = this._indices[r],
              c = this._indices[r + 1],
              u = this._indices[r + 2],
              h = y.Vector3[0],
              d = y.Vector3[1],
              p = y.Vector3[2],
              _ = y.Vector3[3];
            f.FromArrayToRef(this._positions, 3 * l, h),
              f.FromArrayToRef(this._positions, 3 * c, d),
              f.FromArrayToRef(this._positions, 3 * u, p),
              (_.x = o * h.x + s * d.x + a * p.x),
              (_.y = o * h.y + s * d.y + a * p.y),
              (_.z = o * h.z + s * d.z + a * p.z),
              n
                ? t.copyFromFloats(_.x, _.y, _.z)
                : f.TransformCoordinatesFromFloatsToRef(_.x, _.y, _.z, e, t),
              this.useMeshNormalsForDirection &&
                this._normals &&
                (f.FromArrayToRef(this._normals, 3 * l, h),
                f.FromArrayToRef(this._normals, 3 * c, d),
                f.FromArrayToRef(this._normals, 3 * u, p),
                (this._storedNormal.x = o * h.x + s * d.x + a * p.x),
                (this._storedNormal.y = o * h.y + s * d.y + a * p.y),
                (this._storedNormal.z = o * h.z + s * d.z + a * p.z));
          }
        }),
        (e.prototype.clone = function () {
          var t = new e(this.mesh);
          return K.DeepCopy(this, t), t;
        }),
        (e.prototype.applyToShader = function (e) {
          e.setVector3("direction1", this.direction1),
            e.setVector3("direction2", this.direction2);
        }),
        (e.prototype.getEffectDefines = function () {
          return "";
        }),
        (e.prototype.getClassName = function () {
          return "MeshParticleEmitter";
        }),
        (e.prototype.serialize = function () {
          var e,
            t = {};
          return (
            (t.type = this.getClassName()),
            (t.direction1 = this.direction1.asArray()),
            (t.direction2 = this.direction2.asArray()),
            (t.meshId =
              null === (e = this.mesh) || void 0 === e ? void 0 : e.id),
            (t.useMeshNormalsForDirection = this.useMeshNormalsForDirection),
            t
          );
        }),
        (e.prototype.parse = function (e, t) {
          f.FromArrayToRef(e.direction1, 0, this.direction1),
            f.FromArrayToRef(e.direction2, 0, this.direction2),
            e.meshId && t && (this.mesh = t.getLastMeshByID(e.meshId)),
            (this.useMeshNormalsForDirection = e.useMeshNormalsForDirection);
        }),
        e
      );
    })(),
    Mc = (function () {
      function e(t) {
        (this.animations = []),
          (this.renderingGroupId = 0),
          (this.emitter = f.Zero()),
          (this.emitRate = 10),
          (this.manualEmitCount = -1),
          (this.updateSpeed = 0.01),
          (this.targetStopDuration = 0),
          (this.disposeOnStop = !1),
          (this.minEmitPower = 1),
          (this.maxEmitPower = 1),
          (this.minLifeTime = 1),
          (this.maxLifeTime = 1),
          (this.minSize = 1),
          (this.maxSize = 1),
          (this.minScaleX = 1),
          (this.maxScaleX = 1),
          (this.minScaleY = 1),
          (this.maxScaleY = 1),
          (this.minInitialRotation = 0),
          (this.maxInitialRotation = 0),
          (this.minAngularSpeed = 0),
          (this.maxAngularSpeed = 0),
          (this.layerMask = 268435455),
          (this.customShader = null),
          (this.preventAutoStart = !1),
          (this.noiseStrength = new f(10, 10, 10)),
          (this.onAnimationEnd = null),
          (this.blendMode = e.BLENDMODE_ONEONE),
          (this.forceDepthWrite = !1),
          (this.preWarmCycles = 0),
          (this.preWarmStepOffset = 1),
          (this.spriteCellChangeSpeed = 1),
          (this.startSpriteCellID = 0),
          (this.endSpriteCellID = 0),
          (this.spriteCellWidth = 0),
          (this.spriteCellHeight = 0),
          (this.spriteRandomStartCell = !1),
          (this.translationPivot = new p(0, 0)),
          (this.beginAnimationOnStart = !1),
          (this.beginAnimationFrom = 0),
          (this.beginAnimationTo = 60),
          (this.beginAnimationLoop = !1),
          (this.worldOffset = new f(0, 0, 0)),
          (this.gravity = f.Zero()),
          (this._colorGradients = null),
          (this._sizeGradients = null),
          (this._lifeTimeGradients = null),
          (this._angularSpeedGradients = null),
          (this._velocityGradients = null),
          (this._limitVelocityGradients = null),
          (this._dragGradients = null),
          (this._emitRateGradients = null),
          (this._startSizeGradients = null),
          (this._rampGradients = null),
          (this._colorRemapGradients = null),
          (this._alphaRemapGradients = null),
          (this.startDelay = 0),
          (this.limitVelocityDamping = 0.4),
          (this.color1 = new T(1, 1, 1, 1)),
          (this.color2 = new T(1, 1, 1, 1)),
          (this.colorDead = new T(0, 0, 0, 1)),
          (this.textureMask = new T(1, 1, 1, 1)),
          (this._isSubEmitter = !1),
          (this.billboardMode = 7),
          (this._isBillboardBased = !0),
          (this._imageProcessingConfigurationDefines = new ei()),
          (this.id = t),
          (this.name = t);
      }
      return (
        Object.defineProperty(e.prototype, "noiseTexture", {
          get: function () {
            return this._noiseTexture;
          },
          set: function (e) {
            this._noiseTexture !== e &&
              ((this._noiseTexture = e), this._reset());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isAnimationSheetEnabled", {
          get: function () {
            return this._isAnimationSheetEnabled;
          },
          set: function (e) {
            this._isAnimationSheetEnabled != e &&
              ((this._isAnimationSheetEnabled = e), this._reset());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.getScene = function () {
          return this._scene;
        }),
        (e.prototype._hasTargetStopDurationDependantGradient = function () {
          return (
            (this._startSizeGradients && this._startSizeGradients.length > 0) ||
            (this._emitRateGradients && this._emitRateGradients.length > 0) ||
            (this._lifeTimeGradients && this._lifeTimeGradients.length > 0)
          );
        }),
        (e.prototype.getDragGradients = function () {
          return this._dragGradients;
        }),
        (e.prototype.getLimitVelocityGradients = function () {
          return this._limitVelocityGradients;
        }),
        (e.prototype.getColorGradients = function () {
          return this._colorGradients;
        }),
        (e.prototype.getSizeGradients = function () {
          return this._sizeGradients;
        }),
        (e.prototype.getColorRemapGradients = function () {
          return this._colorRemapGradients;
        }),
        (e.prototype.getAlphaRemapGradients = function () {
          return this._alphaRemapGradients;
        }),
        (e.prototype.getLifeTimeGradients = function () {
          return this._lifeTimeGradients;
        }),
        (e.prototype.getAngularSpeedGradients = function () {
          return this._angularSpeedGradients;
        }),
        (e.prototype.getVelocityGradients = function () {
          return this._velocityGradients;
        }),
        (e.prototype.getStartSizeGradients = function () {
          return this._startSizeGradients;
        }),
        (e.prototype.getEmitRateGradients = function () {
          return this._emitRateGradients;
        }),
        Object.defineProperty(e.prototype, "direction1", {
          get: function () {
            return this.particleEmitterType.direction1
              ? this.particleEmitterType.direction1
              : f.Zero();
          },
          set: function (e) {
            this.particleEmitterType.direction1 &&
              (this.particleEmitterType.direction1 = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "direction2", {
          get: function () {
            return this.particleEmitterType.direction2
              ? this.particleEmitterType.direction2
              : f.Zero();
          },
          set: function (e) {
            this.particleEmitterType.direction2 &&
              (this.particleEmitterType.direction2 = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "minEmitBox", {
          get: function () {
            return this.particleEmitterType.minEmitBox
              ? this.particleEmitterType.minEmitBox
              : f.Zero();
          },
          set: function (e) {
            this.particleEmitterType.minEmitBox &&
              (this.particleEmitterType.minEmitBox = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "maxEmitBox", {
          get: function () {
            return this.particleEmitterType.maxEmitBox
              ? this.particleEmitterType.maxEmitBox
              : f.Zero();
          },
          set: function (e) {
            this.particleEmitterType.maxEmitBox &&
              (this.particleEmitterType.maxEmitBox = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isBillboardBased", {
          get: function () {
            return this._isBillboardBased;
          },
          set: function (e) {
            this._isBillboardBased !== e &&
              ((this._isBillboardBased = e), this._reset());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "imageProcessingConfiguration", {
          get: function () {
            return this._imageProcessingConfiguration;
          },
          set: function (e) {
            this._attachImageProcessingConfiguration(e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype._attachImageProcessingConfiguration = function (e) {
          e !== this._imageProcessingConfiguration &&
            (!e && this._scene
              ? (this._imageProcessingConfiguration =
                  this._scene.imageProcessingConfiguration)
              : (this._imageProcessingConfiguration = e));
        }),
        (e.prototype._reset = function () {}),
        (e.prototype._removeGradientAndTexture = function (e, t, i) {
          if (!t) return this;
          for (var n = 0, r = 0, o = t; r < o.length; r++) {
            if (o[r].gradient === e) {
              t.splice(n, 1);
              break;
            }
            n++;
          }
          return i && i.dispose(), this;
        }),
        (e.prototype.createPointEmitter = function (e, t) {
          var i = new xc();
          return (
            (i.direction1 = e),
            (i.direction2 = t),
            (this.particleEmitterType = i),
            i
          );
        }),
        (e.prototype.createHemisphericEmitter = function (e, t) {
          void 0 === e && (e = 1), void 0 === t && (t = 1);
          var i = new Cc(e, t);
          return (this.particleEmitterType = i), i;
        }),
        (e.prototype.createSphereEmitter = function (e, t) {
          void 0 === e && (e = 1), void 0 === t && (t = 1);
          var i = new Ec(e, t);
          return (this.particleEmitterType = i), i;
        }),
        (e.prototype.createDirectedSphereEmitter = function (e, t, i) {
          void 0 === e && (e = 1),
            void 0 === t && (t = new f(0, 1, 0)),
            void 0 === i && (i = new f(0, 1, 0));
          var n = new Pc(e, t, i);
          return (this.particleEmitterType = n), n;
        }),
        (e.prototype.createCylinderEmitter = function (e, t, i, n) {
          void 0 === e && (e = 1),
            void 0 === t && (t = 1),
            void 0 === i && (i = 1),
            void 0 === n && (n = 0);
          var r = new Tc(e, t, i, n);
          return (this.particleEmitterType = r), r;
        }),
        (e.prototype.createDirectedCylinderEmitter = function (e, t, i, n, r) {
          void 0 === e && (e = 1),
            void 0 === t && (t = 1),
            void 0 === i && (i = 1),
            void 0 === n && (n = new f(0, 1, 0)),
            void 0 === r && (r = new f(0, 1, 0));
          var o = new Sc(e, t, i, n, r);
          return (this.particleEmitterType = o), o;
        }),
        (e.prototype.createConeEmitter = function (e, t) {
          void 0 === e && (e = 1), void 0 === t && (t = Math.PI / 4);
          var i = new bc(e, t);
          return (this.particleEmitterType = i), i;
        }),
        (e.prototype.createBoxEmitter = function (e, t, i, n) {
          var r = new yc();
          return (
            (this.particleEmitterType = r),
            (this.direction1 = e),
            (this.direction2 = t),
            (this.minEmitBox = i),
            (this.maxEmitBox = n),
            r
          );
        }),
        (e.BLENDMODE_ONEONE = 0),
        (e.BLENDMODE_STANDARD = 1),
        (e.BLENDMODE_ADD = 2),
        (e.BLENDMODE_MULTIPLY = 3),
        (e.BLENDMODE_MULTIPLYADD = 4),
        e
      );
    })(),
    Oc = (function (e) {
      function t(t) {
        var i = e.call(this, t, Wl.Neutral) || this;
        return (
          i.registerInput("rgba", Hl.Color4, !0),
          i.registerInput("rgb ", Hl.Color3, !0),
          i.registerOutput("rgb", Hl.Color3),
          i.registerOutput("r", Hl.Float),
          i.registerOutput("g", Hl.Float),
          i.registerOutput("b", Hl.Float),
          i.registerOutput("a", Hl.Float),
          (i.inputsAreExclusive = !0),
          i
        );
      }
      return (
        P(t, e),
        (t.prototype.getClassName = function () {
          return "ColorSplitterBlock";
        }),
        Object.defineProperty(t.prototype, "rgba", {
          get: function () {
            return this._inputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "rgbIn", {
          get: function () {
            return this._inputs[1];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "rgbOut", {
          get: function () {
            return this._outputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "r", {
          get: function () {
            return this._outputs[1];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "g", {
          get: function () {
            return this._outputs[2];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "b", {
          get: function () {
            return this._outputs[3];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "a", {
          get: function () {
            return this._outputs[4];
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._inputRename = function (e) {
          return "rgb " === e ? "rgbIn" : e;
        }),
        (t.prototype._outputRename = function (e) {
          return "rgb" === e ? "rgbOut" : e;
        }),
        (t.prototype._buildBlock = function (t) {
          e.prototype._buildBlock.call(this, t);
          var i = this.rgba.isConnected ? this.rgba : this.rgbIn;
          if (i.isConnected) {
            var n = this._outputs[0],
              r = this._outputs[1],
              o = this._outputs[2],
              s = this._outputs[3],
              a = this._outputs[4];
            return (
              n.hasEndpoints &&
                (t.compilationString +=
                  this._declareOutput(n, t) +
                  " = " +
                  i.associatedVariableName +
                  ".rgb;\r\n"),
              r.hasEndpoints &&
                (t.compilationString +=
                  this._declareOutput(r, t) +
                  " = " +
                  i.associatedVariableName +
                  ".r;\r\n"),
              o.hasEndpoints &&
                (t.compilationString +=
                  this._declareOutput(o, t) +
                  " = " +
                  i.associatedVariableName +
                  ".g;\r\n"),
              s.hasEndpoints &&
                (t.compilationString +=
                  this._declareOutput(s, t) +
                  " = " +
                  i.associatedVariableName +
                  ".b;\r\n"),
              a.hasEndpoints &&
                (t.compilationString +=
                  this._declareOutput(a, t) +
                  " = " +
                  i.associatedVariableName +
                  ".a;\r\n"),
              this
            );
          }
        }),
        t
      );
    })(Jl);
  (h.RegisteredTypes["BABYLON.ColorSplitterBlock"] = Oc),
    (function (e) {
      (e[(e.Cos = 0)] = "Cos"),
        (e[(e.Sin = 1)] = "Sin"),
        (e[(e.Abs = 2)] = "Abs"),
        (e[(e.Exp = 3)] = "Exp"),
        (e[(e.Exp2 = 4)] = "Exp2"),
        (e[(e.Round = 5)] = "Round"),
        (e[(e.Floor = 6)] = "Floor"),
        (e[(e.Ceiling = 7)] = "Ceiling"),
        (e[(e.Sqrt = 8)] = "Sqrt"),
        (e[(e.Log = 9)] = "Log"),
        (e[(e.Tan = 10)] = "Tan"),
        (e[(e.ArcTan = 11)] = "ArcTan"),
        (e[(e.ArcCos = 12)] = "ArcCos"),
        (e[(e.ArcSin = 13)] = "ArcSin"),
        (e[(e.Fract = 14)] = "Fract"),
        (e[(e.Sign = 15)] = "Sign"),
        (e[(e.Radians = 16)] = "Radians"),
        (e[(e.Degrees = 17)] = "Degrees");
    })(vc || (vc = {}));
  var Ic = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        (i.operation = vc.Cos),
        i.registerInput("input", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "TrigonometryBlock";
      }),
      Object.defineProperty(t.prototype, "input", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0],
          n = "";
        switch (this.operation) {
          case vc.Cos:
            n = "cos";
            break;
          case vc.Sin:
            n = "sin";
            break;
          case vc.Abs:
            n = "abs";
            break;
          case vc.Exp:
            n = "exp";
            break;
          case vc.Exp2:
            n = "exp2";
            break;
          case vc.Round:
            n = "round";
            break;
          case vc.Floor:
            n = "floor";
            break;
          case vc.Ceiling:
            n = "ceil";
            break;
          case vc.Sqrt:
            n = "sqrt";
            break;
          case vc.Log:
            n = "log";
            break;
          case vc.Tan:
            n = "tan";
            break;
          case vc.ArcTan:
            n = "atan";
            break;
          case vc.ArcCos:
            n = "acos";
            break;
          case vc.ArcSin:
            n = "asin";
            break;
          case vc.Fract:
            n = "fract";
            break;
          case vc.Sign:
            n = "sign";
            break;
          case vc.Radians:
            n = "radians";
            break;
          case vc.Degrees:
            n = "degrees";
        }
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = " +
            n +
            "(" +
            this.input.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return (t.operation = this.operation), t;
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          (this.operation = t.operation);
      }),
      (t.prototype._dumpPropertiesCode = function () {
        return (
          this._codeVariableName +
          ".operation = BABYLON.TrigonometryBlockOperations." +
          vc[this.operation] +
          ";\r\n"
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.TrigonometryBlock"] = Ic;
  var Dc = {
      effect: null,
      subMesh: null,
    },
    wc = (function (e) {
      function t() {
        var t = e.call(this) || this;
        return (
          (t.NORMAL = !1),
          (t.TANGENT = !1),
          (t.UV1 = !1),
          (t.NUM_BONE_INFLUENCERS = 0),
          (t.BonesPerMesh = 0),
          (t.BONETEXTURE = !1),
          (t.MORPHTARGETS = !1),
          (t.MORPHTARGETS_NORMAL = !1),
          (t.MORPHTARGETS_TANGENT = !1),
          (t.MORPHTARGETS_UV = !1),
          (t.NUM_MORPH_INFLUENCERS = 0),
          (t.IMAGEPROCESSING = !1),
          (t.VIGNETTE = !1),
          (t.VIGNETTEBLENDMODEMULTIPLY = !1),
          (t.VIGNETTEBLENDMODEOPAQUE = !1),
          (t.TONEMAPPING = !1),
          (t.TONEMAPPING_ACES = !1),
          (t.CONTRAST = !1),
          (t.EXPOSURE = !1),
          (t.COLORCURVES = !1),
          (t.COLORGRADING = !1),
          (t.COLORGRADING3D = !1),
          (t.SAMPLER3DGREENDEPTH = !1),
          (t.SAMPLER3DBGRMAP = !1),
          (t.IMAGEPROCESSINGPOSTPROCESS = !1),
          (t.BUMPDIRECTUV = 0),
          t.rebuild(),
          t
        );
      }
      return (
        P(t, e),
        (t.prototype.setValue = function (e, t, i) {
          void 0 === i && (i = !1),
            void 0 === this[e] && this._keys.push(e),
            i && this[e] !== t && this.markAsUnprocessed(),
            (this[e] = t);
        }),
        t
      );
    })(Jt),
    Nc = (function (e) {
      function t(i, n, r) {
        void 0 === r && (r = {});
        var s = e.call(this, i, n || It.LastCreatedScene) || this;
        return (
          (s._buildId = t._BuildIdGenerator++),
          (s._buildWasSuccessful = !1),
          (s._cachedWorldViewMatrix = new g()),
          (s._cachedWorldViewProjectionMatrix = new g()),
          (s._optimizers = new Array()),
          (s._animationFrame = -1),
          (s.BJSNODEMATERIALEDITOR = s._getGlobalNodeMaterialEditor()),
          (s.editorData = null),
          (s.ignoreAlpha = !1),
          (s.maxSimultaneousLights = 4),
          (s.onBuildObservable = new o()),
          (s._vertexOutputNodes = new Array()),
          (s._fragmentOutputNodes = new Array()),
          (s.attachedBlocks = new Array()),
          (s._mode = Yl.Material),
          (s._options = A(
            {
              emitComments: !1,
            },
            r
          )),
          s._attachImageProcessingConfiguration(null),
          s
        );
      }
      return (
        P(t, e),
        (t.prototype._getGlobalNodeMaterialEditor = function () {
          return "undefined" != typeof NODEEDITOR
            ? NODEEDITOR
            : "undefined" != typeof BABYLON && void 0 !== BABYLON.NodeEditor
              ? BABYLON
              : void 0;
        }),
        Object.defineProperty(t.prototype, "options", {
          get: function () {
            return this._options;
          },
          set: function (e) {
            this._options = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "imageProcessingConfiguration", {
          get: function () {
            return this._imageProcessingConfiguration;
          },
          set: function (e) {
            this._attachImageProcessingConfiguration(e),
              this._markAllSubMeshesAsTexturesDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "mode", {
          get: function () {
            return this._mode;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getClassName = function () {
          return "NodeMaterial";
        }),
        (t.prototype._attachImageProcessingConfiguration = function (e) {
          var t = this;
          e !== this._imageProcessingConfiguration &&
            (this._imageProcessingConfiguration &&
              this._imageProcessingObserver &&
              this._imageProcessingConfiguration.onUpdateParameters.remove(
                this._imageProcessingObserver
              ),
            (this._imageProcessingConfiguration =
              e || this.getScene().imageProcessingConfiguration),
            this._imageProcessingConfiguration &&
              (this._imageProcessingObserver =
                this._imageProcessingConfiguration.onUpdateParameters.add(
                  function () {
                    t._markAllSubMeshesAsImageProcessingDirty();
                  }
                )));
        }),
        (t.prototype.getBlockByName = function (e) {
          for (
            var t = null, i = 0, n = this.attachedBlocks;
            i < n.length;
            i++
          ) {
            var r = n[i];
            if (r.name === e) {
              if (t)
                return (
                  yt.Warn(
                    "More than one block was found with the name `" + e + "`"
                  ),
                  t
                );
              t = r;
            }
          }
          return t;
        }),
        (t.prototype.getBlockByPredicate = function (e) {
          for (var t = 0, i = this.attachedBlocks; t < i.length; t++) {
            var n = i[t];
            if (e(n)) return n;
          }
          return null;
        }),
        (t.prototype.getInputBlockByPredicate = function (e) {
          for (var t = 0, i = this.attachedBlocks; t < i.length; t++) {
            var n = i[t];
            if (n.isInput && e(n)) return n;
          }
          return null;
        }),
        (t.prototype.getInputBlocks = function () {
          for (var e = [], t = 0, i = this.attachedBlocks; t < i.length; t++) {
            var n = i[t];
            n.isInput && e.push(n);
          }
          return e;
        }),
        (t.prototype.registerOptimizer = function (e) {
          if (!(this._optimizers.indexOf(e) > -1))
            return this._optimizers.push(e), this;
        }),
        (t.prototype.unregisterOptimizer = function (e) {
          var t = this._optimizers.indexOf(e);
          if (-1 !== t) return this._optimizers.splice(t, 1), this;
        }),
        (t.prototype.addOutputNode = function (e) {
          if (null === e.target)
            throw "This node is not meant to be an output node. You may want to explicitly set its target value.";
          return (
            0 != (e.target & Wl.Vertex) && this._addVertexOutputNode(e),
            0 != (e.target & Wl.Fragment) && this._addFragmentOutputNode(e),
            this
          );
        }),
        (t.prototype.removeOutputNode = function (e) {
          return (
            null === e.target ||
              (0 != (e.target & Wl.Vertex) && this._removeVertexOutputNode(e),
              0 != (e.target & Wl.Fragment) &&
                this._removeFragmentOutputNode(e)),
            this
          );
        }),
        (t.prototype._addVertexOutputNode = function (e) {
          if (-1 === this._vertexOutputNodes.indexOf(e))
            return (
              (e.target = Wl.Vertex), this._vertexOutputNodes.push(e), this
            );
        }),
        (t.prototype._removeVertexOutputNode = function (e) {
          var t = this._vertexOutputNodes.indexOf(e);
          if (-1 !== t) return this._vertexOutputNodes.splice(t, 1), this;
        }),
        (t.prototype._addFragmentOutputNode = function (e) {
          if (-1 === this._fragmentOutputNodes.indexOf(e))
            return (
              (e.target = Wl.Fragment), this._fragmentOutputNodes.push(e), this
            );
        }),
        (t.prototype._removeFragmentOutputNode = function (e) {
          var t = this._fragmentOutputNodes.indexOf(e);
          if (-1 !== t) return this._fragmentOutputNodes.splice(t, 1), this;
        }),
        (t.prototype.needAlphaBlending = function () {
          return (
            !this.ignoreAlpha &&
            (this.alpha < 1 ||
              (this._sharedData && this._sharedData.hints.needAlphaBlending))
          );
        }),
        (t.prototype.needAlphaTesting = function () {
          return this._sharedData && this._sharedData.hints.needAlphaTesting;
        }),
        (t.prototype._initializeBlock = function (e, t, i) {
          if (
            (e.initialize(t),
            e.autoConfigure(this),
            (e._preparationId = this._buildId),
            -1 === this.attachedBlocks.indexOf(e))
          ) {
            if (e.isUnique)
              for (
                var n = e.getClassName(), r = 0, o = this.attachedBlocks;
                r < o.length;
                r++
              )
                if (o[r].getClassName() === n)
                  throw (
                    "Cannot have multiple blocks of type " +
                    n +
                    " in the same NodeMaterial"
                  );
            this.attachedBlocks.push(e);
          }
          for (var s = 0, a = e.inputs; s < a.length; s++) {
            var l = a[s];
            l.associatedVariableName = "";
            var c = l.connectedPoint;
            if (c) {
              var u = c.ownerBlock;
              u !== e &&
                ((u.target === Wl.VertexAndFragment ||
                  (t.target === Wl.Fragment &&
                    u.target === Wl.Vertex &&
                    u._preparationId !== this._buildId)) &&
                  i.push(u),
                this._initializeBlock(u, t, i));
            }
          }
          for (var h = 0, d = e.outputs; h < d.length; h++)
            d[h].associatedVariableName = "";
        }),
        (t.prototype._resetDualBlocks = function (e, t) {
          e.target === Wl.VertexAndFragment && (e.buildId = t);
          for (var i = 0, n = e.inputs; i < n.length; i++) {
            var r = n[i].connectedPoint;
            if (r) {
              var o = r.ownerBlock;
              o !== e && this._resetDualBlocks(o, t);
            }
          }
        }),
        (t.prototype.removeBlock = function (e) {
          var t = this.attachedBlocks.indexOf(e);
          t > -1 && this.attachedBlocks.splice(t, 1),
            e.isFinalMerger && this.removeOutputNode(e);
        }),
        (t.prototype.build = function (e) {
          void 0 === e && (e = !1), (this._buildWasSuccessful = !1);
          var i = this.getScene().getEngine(),
            n = this._mode === Yl.Particle;
          if (0 === this._vertexOutputNodes.length && !n)
            throw "You must define at least one vertexOutputNode";
          if (0 === this._fragmentOutputNodes.length)
            throw "You must define at least one fragmentOutputNode";
          (this._vertexCompilationState = new $l()),
            (this._vertexCompilationState.supportUniformBuffers =
              i.supportsUniformBuffers),
            (this._vertexCompilationState.target = Wl.Vertex),
            (this._fragmentCompilationState = new $l()),
            (this._fragmentCompilationState.supportUniformBuffers =
              i.supportsUniformBuffers),
            (this._fragmentCompilationState.target = Wl.Fragment),
            (this._sharedData = new ec()),
            (this._vertexCompilationState.sharedData = this._sharedData),
            (this._fragmentCompilationState.sharedData = this._sharedData),
            (this._sharedData.buildId = this._buildId),
            (this._sharedData.emitComments = this._options.emitComments),
            (this._sharedData.verbose = e),
            (this._sharedData.scene = this.getScene()),
            (this._sharedData.allowEmptyVertexProgram = n);
          for (
            var r = [], o = [], s = 0, a = this._vertexOutputNodes;
            s < a.length;
            s++
          ) {
            var l = a[s];
            r.push(l),
              this._initializeBlock(l, this._vertexCompilationState, o);
          }
          for (var c = 0, u = this._fragmentOutputNodes; c < u.length; c++) {
            var h = u[c];
            o.push(h),
              this._initializeBlock(h, this._fragmentCompilationState, r);
          }
          this.optimize();
          for (var d = 0, p = r; d < p.length; d++)
            (l = p[d]).build(this._vertexCompilationState, r);
          (this._fragmentCompilationState.uniforms =
            this._vertexCompilationState.uniforms.slice(0)),
            (this._fragmentCompilationState._uniformDeclaration =
              this._vertexCompilationState._uniformDeclaration),
            (this._fragmentCompilationState._constantDeclaration =
              this._vertexCompilationState._constantDeclaration),
            (this._fragmentCompilationState._vertexState =
              this._vertexCompilationState);
          for (var f = 0, _ = o; f < _.length; f++)
            (h = _[f]), this._resetDualBlocks(h, this._buildId - 1);
          for (var m = 0, g = o; m < g.length; m++)
            (h = g[m]).build(this._fragmentCompilationState, o);
          this._vertexCompilationState.finalize(this._vertexCompilationState),
            this._fragmentCompilationState.finalize(
              this._fragmentCompilationState
            ),
            (this._buildId = t._BuildIdGenerator++),
            this._sharedData.emitErrors(),
            e &&
              (console.log("Vertex shader:"),
              console.log(this._vertexCompilationState.compilationString),
              console.log("Fragment shader:"),
              console.log(this._fragmentCompilationState.compilationString)),
            (this._buildWasSuccessful = !0),
            this.onBuildObservable.notifyObservers(this);
          for (var v = 0, y = this.getScene().meshes; v < y.length; v++) {
            var b = y[v];
            if (b.subMeshes)
              for (var T = 0, S = b.subMeshes; T < S.length; T++) {
                var C = S[T];
                if (C.getMaterial() === this && C._materialDefines) {
                  var x = C._materialDefines;
                  x.markAllAsDirty(), x.reset();
                }
              }
          }
        }),
        (t.prototype.optimize = function () {
          for (var e = 0, t = this._optimizers; e < t.length; e++)
            t[e].optimize(this._vertexOutputNodes, this._fragmentOutputNodes);
        }),
        (t.prototype._prepareDefinesForAttributes = function (e, t) {
          var i = t.NORMAL,
            n = t.TANGENT,
            r = t.UV1;
          (t.NORMAL = e.isVerticesDataPresent(wt.NormalKind)),
            (t.TANGENT = e.isVerticesDataPresent(wt.TangentKind)),
            (t.UV1 = e.isVerticesDataPresent(wt.UVKind)),
            (i === t.NORMAL && n === t.TANGENT && r === t.UV1) ||
              t.markAsAttributesDirty();
        }),
        (t.prototype.createPostProcess = function (e, t, i, n, r, o, s) {
          return (
            void 0 === t && (t = 1),
            void 0 === i && (i = 1),
            void 0 === o && (o = 0),
            void 0 === s && (s = 5),
            this.mode !== Yl.PostProcess
              ? (console.log("Incompatible material mode"), null)
              : this._createEffectForPostProcess(null, e, t, i, n, r, o, s)
          );
        }),
        (t.prototype.createEffectForPostProcess = function (e) {
          this._createEffectForPostProcess(e);
        }),
        (t.prototype._createEffectForPostProcess = function (
          e,
          t,
          i,
          n,
          r,
          o,
          s,
          a
        ) {
          var l = this;
          void 0 === i && (i = 1),
            void 0 === n && (n = 1),
            void 0 === s && (s = 0),
            void 0 === a && (a = 5);
          var c = this.name + this._buildId,
            u = new wc(),
            h = new Yt(c + "PostProcess", this.getScene()),
            d = this._buildId;
          return (
            this._processDefines(h, u),
            Ke.RegisterShader(
              c,
              this._fragmentCompilationState._builtCompilationString,
              this._vertexCompilationState._builtCompilationString
            ),
            e
              ? e.updateEffect(
                  u.toString(),
                  this._fragmentCompilationState.uniforms,
                  this._fragmentCompilationState.samplers,
                  {
                    maxSimultaneousLights: this.maxSimultaneousLights,
                  },
                  void 0,
                  void 0,
                  c,
                  c
                )
              : (e = new vr(
                  this.name + "PostProcess",
                  c,
                  this._fragmentCompilationState.uniforms,
                  this._fragmentCompilationState.samplers,
                  i,
                  t,
                  n,
                  r,
                  o,
                  u.toString(),
                  s,
                  c,
                  {
                    maxSimultaneousLights: this.maxSimultaneousLights,
                  },
                  !1,
                  a
                )),
            (e.nodeMaterialSource = this),
            e.onApplyObservable.add(function (t) {
              d !== l._buildId &&
                (delete Ke.ShadersStore[c + "VertexShader"],
                delete Ke.ShadersStore[c + "PixelShader"],
                (c = l.name + l._buildId),
                u.markAsUnprocessed(),
                (d = l._buildId)),
                l._processDefines(h, u) &&
                  (Ke.RegisterShader(
                    c,
                    l._fragmentCompilationState._builtCompilationString,
                    l._vertexCompilationState._builtCompilationString
                  ),
                  mt.SetImmediate(function () {
                    return e.updateEffect(
                      u.toString(),
                      l._fragmentCompilationState.uniforms,
                      l._fragmentCompilationState.samplers,
                      {
                        maxSimultaneousLights: l.maxSimultaneousLights,
                      },
                      void 0,
                      void 0,
                      c,
                      c
                    );
                  })),
                l._checkInternals(t);
            }),
            e
          );
        }),
        (t.prototype.createProceduralTexture = function (e, t) {
          var i = this;
          if (this.mode !== Yl.ProceduralTexture)
            return console.log("Incompatible material mode"), null;
          var n = this.name + this._buildId,
            r = new Gl(n, e, null, t),
            o = new Yt(n + "Procedural", this.getScene());
          o.reservedDataStore = {
            hidden: !0,
          };
          var s = new wc(),
            a = this._processDefines(o, s);
          Ke.RegisterShader(
            n,
            this._fragmentCompilationState._builtCompilationString,
            this._vertexCompilationState._builtCompilationString
          );
          var l = this.getScene()
            .getEngine()
            .createEffect(
              {
                vertexElement: n,
                fragmentElement: n,
              },
              [wt.PositionKind],
              this._fragmentCompilationState.uniforms,
              this._fragmentCompilationState.samplers,
              s.toString(),
              null == a ? void 0 : a.fallbacks,
              void 0
            );
          (r.nodeMaterialSource = this), (r._effect = l);
          var c = this._buildId;
          return (
            r.onBeforeGenerationObservable.add(function () {
              c !== i._buildId &&
                (delete Ke.ShadersStore[n + "VertexShader"],
                delete Ke.ShadersStore[n + "PixelShader"],
                (n = i.name + i._buildId),
                s.markAsUnprocessed(),
                (c = i._buildId));
              var e = i._processDefines(o, s);
              e &&
                (Ke.RegisterShader(
                  n,
                  i._fragmentCompilationState._builtCompilationString,
                  i._vertexCompilationState._builtCompilationString
                ),
                mt.SetImmediate(function () {
                  (l = i
                    .getScene()
                    .getEngine()
                    .createEffect(
                      {
                        vertexElement: n,
                        fragmentElement: n,
                      },
                      [wt.PositionKind],
                      i._fragmentCompilationState.uniforms,
                      i._fragmentCompilationState.samplers,
                      s.toString(),
                      null == e ? void 0 : e.fallbacks,
                      void 0
                    )),
                    (r._effect = l);
                })),
                i._checkInternals(l);
            }),
            r
          );
        }),
        (t.prototype._createEffectForParticles = function (
          e,
          t,
          i,
          n,
          r,
          o,
          s,
          a
        ) {
          var l = this;
          void 0 === a && (a = "");
          var c = this.name + this._buildId + "_" + t;
          o || (o = new wc()),
            s ||
              (s = this.getScene().getMeshByName(this.name + "Particle")) ||
              ((s = new Yt(
                this.name + "Particle",
                this.getScene()
              )).reservedDataStore = {
                hidden: !0,
              });
          var u = this._buildId,
            h = [],
            d = a;
          if (!r) {
            var p = this._processDefines(s, o);
            Ke.RegisterShader(
              c,
              this._fragmentCompilationState._builtCompilationString
            ),
              e.fillDefines(h, t),
              (d = h.join("\n")),
              (r = this.getScene()
                .getEngine()
                .createEffectForParticles(
                  c,
                  this._fragmentCompilationState.uniforms,
                  this._fragmentCompilationState.samplers,
                  o.toString() + "\n" + d,
                  null == p ? void 0 : p.fallbacks,
                  i,
                  n,
                  e
                )),
              e.setCustomEffect(r, t);
          }
          r.onBindObservable.add(function (r) {
            u !== l._buildId &&
              (delete Ke.ShadersStore[c + "PixelShader"],
              (c = l.name + l._buildId + "_" + t),
              o.markAsUnprocessed(),
              (u = l._buildId)),
              (h.length = 0),
              e.fillDefines(h, t);
            var a = h.join("\n");
            a !== d && (o.markAsUnprocessed(), (d = a));
            var p = l._processDefines(s, o);
            if (p)
              return (
                Ke.RegisterShader(
                  c,
                  l._fragmentCompilationState._builtCompilationString
                ),
                (r = l
                  .getScene()
                  .getEngine()
                  .createEffectForParticles(
                    c,
                    l._fragmentCompilationState.uniforms,
                    l._fragmentCompilationState.samplers,
                    o.toString() + "\n" + d,
                    null == p ? void 0 : p.fallbacks,
                    i,
                    n,
                    e
                  )),
                e.setCustomEffect(r, t),
                void l._createEffectForParticles(e, t, i, n, r, o, s, d)
              );
            l._checkInternals(r);
          });
        }),
        (t.prototype._checkInternals = function (e) {
          if (this._sharedData.animatedInputs) {
            var t = this.getScene(),
              i = t.getFrameId();
            if (this._animationFrame !== i) {
              for (
                var n = 0, r = this._sharedData.animatedInputs;
                n < r.length;
                n++
              )
                r[n].animate(t);
              this._animationFrame = i;
            }
          }
          for (
            var o = 0, s = this._sharedData.bindableBlocks;
            o < s.length;
            o++
          )
            s[o].bind(e, this);
          for (var a = 0, l = this._sharedData.inputBlocks; a < l.length; a++)
            l[a]._transmit(e, this.getScene());
        }),
        (t.prototype.createEffectForParticles = function (e, t, i) {
          this.mode === Yl.Particle
            ? (this._createEffectForParticles(e, Mc.BLENDMODE_ONEONE, t, i),
              this._createEffectForParticles(e, Mc.BLENDMODE_MULTIPLY, t, i))
            : console.log("Incompatible material mode");
        }),
        (t.prototype._processDefines = function (e, t, i, n) {
          var r = this;
          void 0 === i && (i = !1);
          var o = null;
          if (
            (this._sharedData.blocksWithDefines.forEach(function (n) {
              n.initializeDefines(e, r, t, i);
            }),
            this._sharedData.blocksWithDefines.forEach(function (o) {
              o.prepareDefines(e, r, t, i, n);
            }),
            t.isDirty)
          ) {
            var s = t._areLightsDisposed;
            t.markAsProcessed(),
              (this._vertexCompilationState.compilationString =
                this._vertexCompilationState._builtCompilationString),
              (this._fragmentCompilationState.compilationString =
                this._fragmentCompilationState._builtCompilationString),
              this._sharedData.repeatableContentBlocks.forEach(function (i) {
                i.replaceRepeatableContent(
                  r._vertexCompilationState,
                  r._fragmentCompilationState,
                  e,
                  t
                );
              });
            var a = [];
            this._sharedData.dynamicUniformBlocks.forEach(function (e) {
              e.updateUniformsAndSamples(r._vertexCompilationState, r, t, a);
            });
            var l = this._vertexCompilationState.uniforms;
            this._fragmentCompilationState.uniforms.forEach(function (e) {
              -1 === l.indexOf(e) && l.push(e);
            });
            var c = this._vertexCompilationState.samplers;
            this._fragmentCompilationState.samplers.forEach(function (e) {
              -1 === c.indexOf(e) && c.push(e);
            });
            var u = new Xr();
            this._sharedData.blocksWithFallbacks.forEach(function (t) {
              t.provideFallbacks(e, u);
            }),
              (o = {
                lightDisposed: s,
                uniformBuffers: a,
                mergedUniforms: l,
                mergedSamplers: c,
                fallbacks: u,
              });
          }
          return o;
        }),
        (t.prototype.isReadyForSubMesh = function (e, t, i) {
          var n = this;
          if ((void 0 === i && (i = !1), !this._buildWasSuccessful)) return !1;
          var r = this.getScene();
          if (this._sharedData.animatedInputs) {
            var o = r.getFrameId();
            if (this._animationFrame !== o) {
              for (
                var s = 0, a = this._sharedData.animatedInputs;
                s < a.length;
                s++
              )
                a[s].animate(r);
              this._animationFrame = o;
            }
          }
          if (t.effect && this.isFrozen && t.effect._wasPreviouslyReady)
            return !0;
          t._materialDefines || (t._materialDefines = new wc());
          var l = t._materialDefines;
          if (this._isReadyForSubMesh(t)) return !0;
          var c = r.getEngine();
          if (
            (this._prepareDefinesForAttributes(e, l),
            this._sharedData.blockingBlocks.some(function (t) {
              return !t.isReady(e, n, l, i);
            }))
          )
            return !1;
          var u = this._processDefines(e, l, i, t);
          if (u) {
            var h = t.effect,
              d = l.toString(),
              p = c.createEffect(
                {
                  vertex: "nodeMaterial" + this._buildId,
                  fragment: "nodeMaterial" + this._buildId,
                  vertexSource: this._vertexCompilationState.compilationString,
                  fragmentSource:
                    this._fragmentCompilationState.compilationString,
                },
                {
                  attributes: this._vertexCompilationState.attributes,
                  uniformsNames: u.mergedUniforms,
                  uniformBuffersNames: u.uniformBuffers,
                  samplers: u.mergedSamplers,
                  defines: d,
                  fallbacks: u.fallbacks,
                  onCompiled: this.onCompiled,
                  onError: this.onError,
                  indexParameters: {
                    maxSimultaneousLights: this.maxSimultaneousLights,
                    maxSimultaneousMorphTargets: l.NUM_MORPH_INFLUENCERS,
                  },
                },
                c
              );
            if (p)
              if (
                (this._onEffectCreatedObservable &&
                  ((Dc.effect = p),
                  (Dc.subMesh = t),
                  this._onEffectCreatedObservable.notifyObservers(Dc)),
                this.allowShaderHotSwapping && h && !p.isReady())
              ) {
                if (((p = h), l.markAsUnprocessed(), u.lightDisposed))
                  return (l._areLightsDisposed = !0), !1;
              } else r.resetCachedMaterial(), t.setEffect(p, l);
          }
          return !(
            !t.effect ||
            !t.effect.isReady() ||
            ((l._renderId = r.getRenderId()),
            (t.effect._wasPreviouslyReady = !0),
            0)
          );
        }),
        Object.defineProperty(t.prototype, "compiledShaders", {
          get: function () {
            return (
              "// Vertex shader\r\n" +
              this._vertexCompilationState.compilationString +
              "\r\n\r\n// Fragment shader\r\n" +
              this._fragmentCompilationState.compilationString
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.bindOnlyWorldMatrix = function (e) {
          var t = this.getScene();
          if (this._activeEffect) {
            var i = this._sharedData.hints;
            i.needWorldViewMatrix &&
              e.multiplyToRef(t.getViewMatrix(), this._cachedWorldViewMatrix),
              i.needWorldViewProjectionMatrix &&
                e.multiplyToRef(
                  t.getTransformMatrix(),
                  this._cachedWorldViewProjectionMatrix
                );
            for (var n = 0, r = this._sharedData.inputBlocks; n < r.length; n++)
              r[n]._transmitWorld(
                this._activeEffect,
                e,
                this._cachedWorldViewMatrix,
                this._cachedWorldViewProjectionMatrix
              );
          }
        }),
        (t.prototype.bindForSubMesh = function (e, t, i) {
          var n = this.getScene(),
            r = i.effect;
          if (r) {
            if (
              ((this._activeEffect = r),
              this.bindOnlyWorldMatrix(e),
              this._mustRebind(n, r, t.visibility))
            ) {
              var o = this._sharedData;
              if (r && n.getCachedEffect() !== r) {
                for (var s = 0, a = o.bindableBlocks; s < a.length; s++)
                  a[s].bind(r, this, t, i);
                for (var l = 0, c = o.inputBlocks; l < c.length; l++)
                  c[l]._transmit(r, n);
              }
            }
            this._afterBind(t, this._activeEffect);
          }
        }),
        (t.prototype.getActiveTextures = function () {
          var t = e.prototype.getActiveTextures.call(this);
          return (
            this._sharedData &&
              t.push.apply(
                t,
                this._sharedData.textureBlocks
                  .filter(function (e) {
                    return e.texture;
                  })
                  .map(function (e) {
                    return e.texture;
                  })
              ),
            t
          );
        }),
        (t.prototype.getTextureBlocks = function () {
          return this._sharedData ? this._sharedData.textureBlocks : [];
        }),
        (t.prototype.hasTexture = function (t) {
          if (e.prototype.hasTexture.call(this, t)) return !0;
          if (!this._sharedData) return !1;
          for (var i = 0, n = this._sharedData.textureBlocks; i < n.length; i++)
            if (n[i].texture === t) return !0;
          return !1;
        }),
        (t.prototype.dispose = function (t, i, n) {
          if (i)
            for (
              var r = 0,
                o = this._sharedData.textureBlocks
                  .filter(function (e) {
                    return e.texture;
                  })
                  .map(function (e) {
                    return e.texture;
                  });
              r < o.length;
              r++
            )
              o[r].dispose();
          for (var s = 0, a = this.attachedBlocks; s < a.length; s++)
            a[s].dispose();
          this.onBuildObservable.clear(),
            e.prototype.dispose.call(this, t, i, n);
        }),
        (t.prototype._createNodeEditor = function () {
          (this.BJSNODEMATERIALEDITOR =
            this.BJSNODEMATERIALEDITOR || this._getGlobalNodeMaterialEditor()),
            this.BJSNODEMATERIALEDITOR.NodeEditor.Show({
              nodeMaterial: this,
            });
        }),
        (t.prototype.edit = function (e) {
          var i = this;
          return new Promise(function (n, r) {
            if (void 0 === i.BJSNODEMATERIALEDITOR) {
              var o = e && e.editorURL ? e.editorURL : t.EditorURL;
              yt.LoadScript(o, function () {
                i._createNodeEditor(), n();
              });
            } else i._createNodeEditor(), n();
          });
        }),
        (t.prototype.clear = function () {
          (this._vertexOutputNodes = []),
            (this._fragmentOutputNodes = []),
            (this.attachedBlocks = []);
        }),
        (t.prototype.setToDefault = function () {
          this.clear(), (this.editorData = null);
          var e = new lc("Position");
          e.setAsAttribute("position");
          var t = new lc("World");
          t.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);
          var i = new tc("WorldPos");
          e.connectTo(i), t.connectTo(i);
          var n = new lc("ViewProjection");
          n.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);
          var r = new tc("WorldPos * ViewProjectionTransform");
          i.connectTo(r), n.connectTo(r);
          var o = new ic("VertexOutput");
          r.connectTo(o);
          var s = new lc("color");
          s.value = new T(0.8, 0.8, 0.8, 1);
          var a = new rc("FragmentOutput");
          s.connectTo(a),
            this.addOutputNode(o),
            this.addOutputNode(a),
            (this._mode = Yl.Material);
        }),
        (t.prototype.setToDefaultPostProcess = function () {
          this.clear(), (this.editorData = null);
          var e = new lc("Position");
          e.setAsAttribute("position2d");
          var t = new lc("Constant1");
          (t.isConstant = !0), (t.value = 1);
          var i = new fc("Position3D");
          e.connectTo(i),
            t.connectTo(i, {
              input: "w",
            });
          var n = new ic("VertexOutput");
          i.connectTo(n);
          var r = new lc("Scale");
          (r.visibleInInspector = !0), (r.value = new p(1, 1));
          var o = new mc("uv0");
          e.connectTo(o);
          var s = new gc("UV scale");
          o.connectTo(s), r.connectTo(s);
          var a = new cc("CurrentScreen");
          s.connectTo(a),
            (a.texture = new mn(
              "https://assets.babylonjs.com/nme/currentScreenPostProcess.png",
              this.getScene()
            ));
          var l = new rc("FragmentOutput");
          a.connectTo(l, {
            output: "rgba",
          }),
            this.addOutputNode(n),
            this.addOutputNode(l),
            (this._mode = Yl.PostProcess);
        }),
        (t.prototype.setToDefaultProceduralTexture = function () {
          this.clear(), (this.editorData = null);
          var e = new lc("Position");
          e.setAsAttribute("position2d");
          var t = new lc("Constant1");
          (t.isConstant = !0), (t.value = 1);
          var i = new fc("Position3D");
          e.connectTo(i),
            t.connectTo(i, {
              input: "w",
            });
          var n = new ic("VertexOutput");
          i.connectTo(n);
          var r = new lc("Time");
          (r.value = 0),
            (r.min = 0),
            (r.max = 0),
            (r.isBoolean = !1),
            (r.matrixMode = 0),
            (r.animationType = nc.Time),
            (r.isConstant = !1);
          var o = new lc("Color3");
          (o.value = new b(1, 1, 1)), (o.isConstant = !1);
          var s = new rc("FragmentOutput"),
            a = new fc("VectorMerger");
          a.visibleInInspector = !1;
          var l = new Ic("Cos");
          (l.operation = vc.Cos),
            e.connectTo(a),
            r.output.connectTo(l.input),
            l.output.connectTo(a.z),
            a.xyzOut.connectTo(s.rgb),
            this.addOutputNode(n),
            this.addOutputNode(s),
            (this._mode = Yl.ProceduralTexture);
        }),
        (t.prototype.setToDefaultParticle = function () {
          this.clear(), (this.editorData = null);
          var e = new lc("uv");
          e.setAsAttribute("particle_uv");
          var t = new uc("ParticleTexture");
          e.connectTo(t);
          var i = new lc("Color");
          i.setAsAttribute("particle_color");
          var n = new gc("Texture * Color");
          t.connectTo(n), i.connectTo(n);
          var r = new hc("ParticleRampGradient");
          n.connectTo(r);
          var o = new Oc("ColorSplitter");
          i.connectTo(o);
          var s = new dc("ParticleBlendMultiply");
          r.connectTo(s),
            t.connectTo(s, {
              output: "a",
            }),
            o.connectTo(s, {
              output: "a",
            });
          var a = new rc("FragmentOutput");
          s.connectTo(a), this.addOutputNode(a), (this._mode = Yl.Particle);
        }),
        (t.prototype.loadAsync = function (e) {
          var t = this;
          return this.getScene()
            ._loadFileAsync(e)
            .then(function (e) {
              var i = JSON.parse(e);
              t.loadFromSerialization(i, "");
            });
        }),
        (t.prototype._gatherBlocks = function (e, t) {
          if (-1 === t.indexOf(e)) {
            t.push(e);
            for (var i = 0, n = e.inputs; i < n.length; i++) {
              var r = n[i].connectedPoint;
              if (r) {
                var o = r.ownerBlock;
                o !== e && this._gatherBlocks(o, t);
              }
            }
          }
        }),
        (t.prototype.generateCode = function () {
          for (
            var e = [], t = [], i = [], n = 0, r = this._vertexOutputNodes;
            n < r.length;
            n++
          ) {
            var o = r[n];
            this._gatherBlocks(o, t);
          }
          for (
            var s = [], a = 0, l = this._fragmentOutputNodes;
            a < l.length;
            a++
          )
            (o = l[a]), this._gatherBlocks(o, s);
          for (
            var c =
                'var nodeMaterial = new BABYLON.NodeMaterial("' +
                (this.name || "node material") +
                '");\r\n',
              u = 0,
              h = t;
            u < h.length;
            u++
          )
            (S = h[u]).isInput &&
              -1 === e.indexOf(S) &&
              (c += S._dumpCode(i, e));
          for (var d = 0, p = s; d < p.length; d++)
            (S = p[d]).isInput &&
              -1 === e.indexOf(S) &&
              (c += S._dumpCode(i, e));
          (e = []), (c += "\r\n// Connections\r\n");
          for (var f = 0, _ = this._vertexOutputNodes; f < _.length; f++)
            c += (S = _[f])._dumpCodeForOutputConnections(e);
          for (var m = 0, g = this._fragmentOutputNodes; m < g.length; m++)
            c += (S = g[m])._dumpCodeForOutputConnections(e);
          c += "\r\n// Output nodes\r\n";
          for (var v = 0, y = this._vertexOutputNodes; v < y.length; v++)
            c +=
              "nodeMaterial.addOutputNode(" +
              (S = y[v])._codeVariableName +
              ");\r\n";
          for (var b = 0, T = this._fragmentOutputNodes; b < T.length; b++) {
            var S;
            c +=
              "nodeMaterial.addOutputNode(" +
              (S = T[b])._codeVariableName +
              ");\r\n";
          }
          return c + "nodeMaterial.build();\r\n";
        }),
        (t.prototype.serialize = function (e) {
          var t = e ? {} : ge.Serialize(this);
          t.editorData = JSON.parse(JSON.stringify(this.editorData));
          var i = [];
          if (e) i = e;
          else {
            (t.customType = "BABYLON.NodeMaterial"), (t.outputNodes = []);
            for (var n = 0, r = this._vertexOutputNodes; n < r.length; n++) {
              var o = r[n];
              this._gatherBlocks(o, i), t.outputNodes.push(o.uniqueId);
            }
            for (var s = 0, a = this._fragmentOutputNodes; s < a.length; s++)
              (o = a[s]),
                this._gatherBlocks(o, i),
                -1 === t.outputNodes.indexOf(o.uniqueId) &&
                  t.outputNodes.push(o.uniqueId);
          }
          t.blocks = [];
          for (var l = 0, c = i; l < c.length; l++) {
            var u = c[l];
            t.blocks.push(u.serialize());
          }
          if (!e)
            for (var h = 0, d = this.attachedBlocks; h < d.length; h++)
              (u = d[h]), -1 === i.indexOf(u) && t.blocks.push(u.serialize());
          return t;
        }),
        (t.prototype._restoreConnections = function (e, t, i) {
          for (var n = 0, r = e.outputs; n < r.length; n++)
            for (var o = r[n], s = 0, a = t.blocks; s < a.length; s++) {
              var l = a[s],
                c = i[l.id];
              if (c)
                for (var u = 0, h = l.inputs; u < h.length; u++) {
                  var d = h[u];
                  if (
                    i[d.targetBlockId] !== e ||
                    d.targetConnectionName !== o.name
                  );
                  else {
                    var p = c.getInputByName(d.inputName);
                    if (!p || p.isConnected) continue;
                    o.connectTo(p, !0), this._restoreConnections(c, t, i);
                  }
                }
            }
        }),
        (t.prototype.loadFromSerialization = function (e, t, i) {
          var n;
          void 0 === t && (t = ""), void 0 === i && (i = !1), i || this.clear();
          for (var r = {}, o = 0, s = e.blocks; o < s.length; o++) {
            var a = s[o],
              l = h.GetClass(a.customType);
            l &&
              ((u = new l())._deserialize(a, this.getScene(), t),
              (r[a.id] = u),
              this.attachedBlocks.push(u));
          }
          for (var c = 0; c < e.blocks.length; c++) {
            var u;
            (u = r[e.blocks[c].id]) &&
              ((u.inputs.length && !i) || this._restoreConnections(u, e, r));
          }
          if (e.outputNodes)
            for (var d = 0, p = e.outputNodes; d < p.length; d++) {
              var f = p[d];
              this.addOutputNode(r[f]);
            }
          if (e.locations || (e.editorData && e.editorData.locations)) {
            for (
              var _ = e.locations || e.editorData.locations, m = 0, g = _;
              m < g.length;
              m++
            ) {
              var v = g[m];
              r[v.blockId] && (v.blockId = r[v.blockId].uniqueId);
            }
            i &&
              this.editorData &&
              this.editorData.locations &&
              _.concat(this.editorData.locations),
              e.locations
                ? (this.editorData = {
                    locations: _,
                  })
                : ((this.editorData = e.editorData),
                  (this.editorData.locations = _));
            var y = [];
            for (var b in r) y[b] = r[b].uniqueId;
            this.editorData.map = y;
          }
          (this.comment = e.comment),
            i ||
              (this._mode =
                null !== (n = e.mode) && void 0 !== n ? n : Yl.Material);
        }),
        (t.prototype.clone = function (e) {
          var i = this,
            n = this.serialize(),
            r = ge.Clone(function () {
              return new t(e, i.getScene(), i.options);
            }, this);
          return (
            (r.id = e), (r.name = e), r.loadFromSerialization(n), r.build(), r
          );
        }),
        (t.Parse = function (e, i, n) {
          void 0 === n && (n = "");
          var r = ge.Parse(
            function () {
              return new t(e.name, i);
            },
            e,
            i,
            n
          );
          return r.loadFromSerialization(e, n), r.build(), r;
        }),
        (t.ParseFromFileAsync = function (e, i, n) {
          var r = new t(e, n);
          return new Promise(function (e, t) {
            return r
              .loadAsync(i)
              .then(function () {
                r.build(), e(r);
              })
              .catch(t);
          });
        }),
        (t.ParseFromSnippetAsync = function (e, i, n, r) {
          var o = this;
          return (
            void 0 === n && (n = ""),
            "_BLANK" === e
              ? Promise.resolve(this.CreateDefault("blank", i))
              : new Promise(function (s, a) {
                  var l = new Te();
                  l.addEventListener("readystatechange", function () {
                    if (4 == l.readyState)
                      if (200 == l.status) {
                        var o = JSON.parse(
                            JSON.parse(l.responseText).jsonPayload
                          ),
                          c = JSON.parse(o.nodeMaterial);
                        r ||
                          ((r = ge.Parse(
                            function () {
                              return new t(e, i);
                            },
                            c,
                            i,
                            n
                          )).uniqueId = i.getUniqueId()),
                          r.loadFromSerialization(c),
                          (r.snippetId = e);
                        try {
                          r.build(), s(r);
                        } catch (e) {
                          a(e);
                        }
                      } else a("Unable to load the snippet " + e);
                  }),
                    l.open("GET", o.SnippetUrl + "/" + e.replace(/#/g, "/")),
                    l.send();
                })
          );
        }),
        (t.CreateDefault = function (e, i) {
          var n = new t(e, i);
          return n.setToDefault(), n.build(), n;
        }),
        (t._BuildIdGenerator = 0),
        (t.EditorURL =
          "https://unpkg.com/babylonjs-node-editor@" +
          It.Version +
          "/babylon.nodeEditor.js"),
        (t.SnippetUrl = "https://snippet.babylonjs.com"),
        (t.IgnoreTexturesAtLoadTime = !1),
        R([se("mode")], t.prototype, "_mode", void 0),
        R([se("comment")], t.prototype, "comment", void 0),
        t
      );
    })(Gr);
  h.RegisteredTypes["BABYLON.NodeMaterial"] = Nc;
  var Lc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Vertex) || this;
      return (
        i.registerInput("matricesIndices", Hl.Vector4),
        i.registerInput("matricesWeights", Hl.Vector4),
        i.registerInput("matricesIndicesExtra", Hl.Vector4, !0),
        i.registerInput("matricesWeightsExtra", Hl.Vector4, !0),
        i.registerInput("world", Hl.Matrix),
        i.registerOutput("output", Hl.Matrix),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.initialize = function (e) {
        e._excludeVariableName("boneSampler"),
          e._excludeVariableName("boneTextureWidth"),
          e._excludeVariableName("mBones"),
          e._excludeVariableName("BonesPerMesh");
      }),
      (t.prototype.getClassName = function () {
        return "BonesBlock";
      }),
      Object.defineProperty(t.prototype, "matricesIndices", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "matricesWeights", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "matricesIndicesExtra", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "matricesWeightsExtra", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "world", {
        get: function () {
          return this._inputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.matricesIndices.isConnected) {
          var t = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "matricesIndices" === e.name;
          });
          t ||
            (t = new lc("matricesIndices")).setAsAttribute("matricesIndices"),
            t.output.connectTo(this.matricesIndices);
        }
        if (!this.matricesWeights.isConnected) {
          var i = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "matricesWeights" === e.name;
          });
          i ||
            (i = new lc("matricesWeights")).setAsAttribute("matricesWeights"),
            i.output.connectTo(this.matricesWeights);
        }
        if (!this.world.isConnected) {
          var n = e.getInputBlockByPredicate(function (e) {
            return e.systemValue === Xl.World;
          });
          n || (n = new lc("world")).setAsSystemValue(Xl.World),
            n.output.connectTo(this.world);
        }
      }),
      (t.prototype.provideFallbacks = function (e, t) {
        e &&
          e.useBones &&
          e.computeBonesUsingShaders &&
          e.skeleton &&
          t.addCPUSkinningFallback(0, e);
      }),
      (t.prototype.bind = function (e, t, i) {
        Hr.BindBonesParameters(i, e);
      }),
      (t.prototype.prepareDefines = function (e, t, i) {
        i._areAttributesDirty && Hr.PrepareDefinesForBones(e, i);
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t),
          t.sharedData.blocksWithFallbacks.push(this),
          t.sharedData.bindableBlocks.push(this),
          t.sharedData.blocksWithDefines.push(this),
          t.uniforms.push("boneTextureWidth"),
          t.uniforms.push("mBones"),
          t.samplers.push("boneSampler");
        var i = "//" + this.name;
        t._emitFunctionFromInclude("bonesDeclaration", i, {
          removeAttributes: !0,
          removeUniforms: !1,
          removeVaryings: !0,
          removeIfDef: !1,
        });
        var n = t._getFreeVariableName("influence");
        t.compilationString += t._emitCodeFromInclude("bonesVertex", i, {
          replaceStrings: [
            {
              search: /finalWorld=finalWorld\*influence;/,
              replace: "",
            },
            {
              search: /influence/gm,
              replace: n,
            },
          ],
        });
        var r = this._outputs[0],
          o = this.world;
        return (
          (t.compilationString += "#if NUM_BONE_INFLUENCERS>0\r\n"),
          (t.compilationString +=
            this._declareOutput(r, t) +
            " = " +
            o.associatedVariableName +
            " * " +
            n +
            ";\r\n"),
          (t.compilationString += "#else\r\n"),
          (t.compilationString +=
            this._declareOutput(r, t) +
            " = " +
            o.associatedVariableName +
            ";\r\n"),
          (t.compilationString += "#endif\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.BonesBlock"] = Lc;
  var Fc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Vertex) || this;
      return (
        i.registerInput("world0", Hl.Vector4),
        i.registerInput("world1", Hl.Vector4),
        i.registerInput("world2", Hl.Vector4),
        i.registerInput("world3", Hl.Vector4),
        i.registerInput("world", Hl.Matrix, !0),
        i.registerOutput("output", Hl.Matrix),
        i.registerOutput("instanceID", Hl.Float),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "InstancesBlock";
      }),
      Object.defineProperty(t.prototype, "world0", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "world1", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "world2", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "world3", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "world", {
        get: function () {
          return this._inputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "instanceID", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.world0.connectedPoint) {
          var t = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "world0" === e.name;
          });
          t || (t = new lc("world0")).setAsAttribute("world0"),
            t.output.connectTo(this.world0);
        }
        if (!this.world1.connectedPoint) {
          var i = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "world1" === e.name;
          });
          i || (i = new lc("world1")).setAsAttribute("world1"),
            i.output.connectTo(this.world1);
        }
        if (!this.world2.connectedPoint) {
          var n = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "world2" === e.name;
          });
          n || (n = new lc("world2")).setAsAttribute("world2"),
            n.output.connectTo(this.world2);
        }
        if (!this.world3.connectedPoint) {
          var r = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "world3" === e.name;
          });
          r || (r = new lc("world3")).setAsAttribute("world3"),
            r.output.connectTo(this.world3);
        }
        if (!this.world.connectedPoint) {
          var o = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "world" === e.name;
          });
          o || (o = new lc("world")).setAsSystemValue(Xl.World),
            o.output.connectTo(this.world);
        }
        this.world.define = "!INSTANCES || THIN_INSTANCES";
      }),
      (t.prototype.prepareDefines = function (e, t, i, n, r) {
        void 0 === n && (n = !1);
        var o = !1;
        i.INSTANCES !== n && (i.setValue("INSTANCES", n), (o = !0)),
          r &&
            i.THIN_INSTANCES !==
              !!(null == r ? void 0 : r.getRenderingMesh().hasThinInstances) &&
            (i.setValue(
              "THIN_INSTANCES",
              !!(null == r ? void 0 : r.getRenderingMesh().hasThinInstances)
            ),
            (o = !0)),
          o && i.markAsUnprocessed();
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t),
          t.sharedData.blocksWithDefines.push(this);
        var i = this._outputs[0],
          n = this._outputs[1],
          r = this.world0,
          o = this.world1,
          s = this.world2,
          a = this.world3;
        return (
          (t.compilationString += "#ifdef INSTANCES\r\n"),
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = mat4(" +
            r.associatedVariableName +
            ", " +
            o.associatedVariableName +
            ", " +
            s.associatedVariableName +
            ", " +
            a.associatedVariableName +
            ");\r\n"),
          (t.compilationString += "#ifdef THIN_INSTANCES\r\n"),
          (t.compilationString +=
            i.associatedVariableName +
            " = " +
            this.world.associatedVariableName +
            " * " +
            i.associatedVariableName +
            ";\r\n"),
          (t.compilationString += "#endif\r\n"),
          (t.compilationString +=
            this._declareOutput(n, t) + " = float(gl_InstanceID);\r\n"),
          (t.compilationString += "#else\r\n"),
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = " +
            this.world.associatedVariableName +
            ";\r\n"),
          (t.compilationString += this._declareOutput(n, t) + " = 0.0;\r\n"),
          (t.compilationString += "#endif\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.InstancesBlock"] = Fc;
  var Bc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Vertex) || this;
      return (
        i.registerInput("position", Hl.Vector3),
        i.registerInput("normal", Hl.Vector3),
        i.registerInput("tangent", Hl.Vector3),
        i.registerInput("uv", Hl.Vector2),
        i.registerOutput("positionOutput", Hl.Vector3),
        i.registerOutput("normalOutput", Hl.Vector3),
        i.registerOutput("tangentOutput", Hl.Vector3),
        i.registerOutput("uvOutput", Hl.Vector2),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "MorphTargetsBlock";
      }),
      Object.defineProperty(t.prototype, "position", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "normal", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "tangent", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "uv", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "positionOutput", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "normalOutput", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "tangentOutput", {
        get: function () {
          return this._outputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "uvOutput", {
        get: function () {
          return this._outputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.initialize = function (e) {
        e._excludeVariableName("morphTargetInfluences");
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.position.isConnected) {
          var t = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "position" === e.name;
          });
          t || (t = new lc("position")).setAsAttribute(),
            t.output.connectTo(this.position);
        }
        if (!this.normal.isConnected) {
          var i = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "normal" === e.name;
          });
          i || (i = new lc("normal")).setAsAttribute("normal"),
            i.output.connectTo(this.normal);
        }
        if (!this.tangent.isConnected) {
          var n = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "tangent" === e.name;
          });
          n || (n = new lc("tangent")).setAsAttribute("tangent"),
            n.output.connectTo(this.tangent);
        }
        if (!this.uv.isConnected) {
          var r = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "uv" === e.name;
          });
          r || (r = new lc("uv")).setAsAttribute("uv"),
            r.output.connectTo(this.uv);
        }
      }),
      (t.prototype.prepareDefines = function (e, t, i) {
        i._areAttributesDirty && Hr.PrepareDefinesForMorphTargets(e, i);
      }),
      (t.prototype.bind = function (e, t, i) {
        i &&
          i.morphTargetManager &&
          i.morphTargetManager.numInfluencers > 0 &&
          Hr.BindMorphTargetParameters(i, e);
      }),
      (t.prototype.replaceRepeatableContent = function (e, t, i, n) {
        for (
          var r = this.position,
            o = this.normal,
            s = this.tangent,
            a = this.uv,
            l = this.positionOutput,
            c = this.normalOutput,
            u = this.tangentOutput,
            h = this.uvOutput,
            d = e,
            p = n.NUM_MORPH_INFLUENCERS,
            f = i.morphTargetManager,
            _ = f && f.supportsNormals && n.NORMAL,
            m = f && f.supportsTangents && n.TANGENT,
            g = f && f.supportsUVs && n.UV1,
            v = "",
            y = 0;
          y < p;
          y++
        )
          (v += "#ifdef MORPHTARGETS\r\n"),
            (v +=
              l.associatedVariableName +
              " += (position" +
              y +
              " - " +
              r.associatedVariableName +
              ") * morphTargetInfluences[" +
              y +
              "];\r\n"),
            _ &&
              ((v += "#ifdef MORPHTARGETS_NORMAL\r\n"),
              (v +=
                c.associatedVariableName +
                " += (normal" +
                y +
                " - " +
                o.associatedVariableName +
                ") * morphTargetInfluences[" +
                y +
                "];\r\n"),
              (v += "#endif\r\n")),
            m &&
              ((v += "#ifdef MORPHTARGETS_TANGENT\r\n"),
              (v +=
                u.associatedVariableName +
                ".xyz += (tangent" +
                y +
                " - " +
                s.associatedVariableName +
                ".xyz) * morphTargetInfluences[" +
                y +
                "];\r\n"),
              (v += "#endif\r\n")),
            g &&
              ((v += "#ifdef MORPHTARGETS_UV\r\n"),
              (v +=
                h.associatedVariableName +
                ".xy += (uv_" +
                y +
                " - " +
                a.associatedVariableName +
                ".xy) * morphTargetInfluences[" +
                y +
                "];\r\n"),
              (v += "#endif\r\n")),
            (v += "#endif\r\n");
        if (
          ((d.compilationString = d.compilationString.replace(
            this._repeatableContentAnchor,
            v
          )),
          p > 0)
        )
          for (y = 0; y < p; y++)
            d.attributes.push(wt.PositionKind + y),
              _ && d.attributes.push(wt.NormalKind + y),
              m && d.attributes.push(wt.TangentKind + y),
              g && d.attributes.push(wt.UVKind + "_" + y);
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t),
          t.sharedData.blocksWithDefines.push(this),
          t.sharedData.bindableBlocks.push(this),
          t.sharedData.repeatableContentBlocks.push(this);
        var i = this.position,
          n = this.normal,
          r = this.tangent,
          o = this.uv,
          s = this.positionOutput,
          a = this.normalOutput,
          l = this.tangentOutput,
          c = this.uvOutput,
          u = "//" + this.name;
        return (
          t.uniforms.push("morphTargetInfluences"),
          t._emitFunctionFromInclude("morphTargetsVertexGlobalDeclaration", u),
          t._emitFunctionFromInclude("morphTargetsVertexDeclaration", u, {
            repeatKey: "maxSimultaneousMorphTargets",
          }),
          (t.compilationString +=
            this._declareOutput(s, t) +
            " = " +
            i.associatedVariableName +
            ";\r\n"),
          (t.compilationString += "#ifdef NORMAL\r\n"),
          (t.compilationString +=
            this._declareOutput(a, t) +
            " = " +
            n.associatedVariableName +
            ";\r\n"),
          (t.compilationString += "#else\r\n"),
          (t.compilationString +=
            this._declareOutput(a, t) + " = vec3(0., 0., 0.);\r\n"),
          (t.compilationString += "#endif\r\n"),
          (t.compilationString += "#ifdef TANGENT\r\n"),
          (t.compilationString +=
            this._declareOutput(l, t) +
            " = " +
            r.associatedVariableName +
            ";\r\n"),
          (t.compilationString += "#else\r\n"),
          (t.compilationString +=
            this._declareOutput(l, t) + " = vec3(0., 0., 0.);\r\n"),
          (t.compilationString += "#endif\r\n"),
          (t.compilationString += "#ifdef UV1\r\n"),
          (t.compilationString +=
            this._declareOutput(c, t) +
            " = " +
            o.associatedVariableName +
            ";\r\n"),
          (t.compilationString += "#else\r\n"),
          (t.compilationString +=
            this._declareOutput(c, t) + " = vec2(0., 0.);\r\n"),
          (t.compilationString += "#endif\r\n"),
          (this._repeatableContentAnchor = t._repeatableContentAnchor),
          (t.compilationString += this._repeatableContentAnchor),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.MorphTargetsBlock"] = Bc;
  var Vc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Vertex) || this;
      return (
        i.registerInput("worldPosition", Hl.Vector4, !1, Wl.Vertex),
        i.registerOutput("direction", Hl.Vector3),
        i.registerOutput("color", Hl.Color3),
        i.registerOutput("intensity", Hl.Float),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "LightInformationBlock";
      }),
      Object.defineProperty(t.prototype, "worldPosition", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "direction", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "color", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "intensity", {
        get: function () {
          return this._outputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.bind = function (e, t, i) {
        if (i) {
          this.light && this.light.isDisposed && (this.light = null);
          var n = this.light,
            r = t.getScene();
          if ((!n && r.lights.length && (n = r.lights[0]), !n || !n.isEnabled))
            return (
              e.setFloat3(this._lightDataUniformName, 0, 0, 0),
              void e.setFloat4(this._lightColorUniformName, 0, 0, 0, 0)
            );
          n.transferToNodeMaterialEffect(e, this._lightDataUniformName),
            e.setColor4(this._lightColorUniformName, n.diffuse, n.intensity);
        }
      }),
      (t.prototype.prepareDefines = function (e, t, i) {
        if (i._areLightsDirty) {
          var n = this.light;
          i.setValue(this._lightTypeDefineName, !!(n && n instanceof ol));
        }
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t),
          t.sharedData.bindableBlocks.push(this),
          t.sharedData.blocksWithDefines.push(this);
        var i = this.direction,
          n = this.color,
          r = this.intensity;
        return (
          (this._lightDataUniformName = t._getFreeVariableName("lightData")),
          (this._lightColorUniformName = t._getFreeVariableName("lightColor")),
          (this._lightTypeDefineName = t._getFreeDefineName("LIGHTPOINTTYPE")),
          t._emitUniformFromString(this._lightDataUniformName, "vec3"),
          t._emitUniformFromString(this._lightColorUniformName, "vec4"),
          (t.compilationString +=
            "#ifdef " + this._lightTypeDefineName + "\r\n"),
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = normalize(" +
            this.worldPosition.associatedVariableName +
            ".xyz - " +
            this._lightDataUniformName +
            ");\r\n"),
          (t.compilationString += "#else\r\n"),
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = " +
            this._lightDataUniformName +
            ";\r\n"),
          (t.compilationString += "#endif\r\n"),
          (t.compilationString +=
            this._declareOutput(n, t) +
            " = " +
            this._lightColorUniformName +
            ".rgb;\r\n"),
          (t.compilationString +=
            this._declareOutput(r, t) +
            " = " +
            this._lightColorUniformName +
            ".a;\r\n"),
          this
        );
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return this.light && (t.lightId = this.light.id), t;
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          t.lightId && (this.light = i.getLightByID(t.lightId));
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.LightInformationBlock"] = Vc;
  var kc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Fragment) || this;
      return (
        i.registerInput("color", Hl.Color4),
        i.registerOutput("output", Hl.Color4),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Color3),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ImageProcessingBlock";
      }),
      Object.defineProperty(t.prototype, "color", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.initialize = function (e) {
        e._excludeVariableName("exposureLinear"),
          e._excludeVariableName("contrast"),
          e._excludeVariableName("vInverseScreenSize"),
          e._excludeVariableName("vignetteSettings1"),
          e._excludeVariableName("vignetteSettings2"),
          e._excludeVariableName("vCameraColorCurveNegative"),
          e._excludeVariableName("vCameraColorCurveNeutral"),
          e._excludeVariableName("vCameraColorCurvePositive"),
          e._excludeVariableName("txColorTransform"),
          e._excludeVariableName("colorTransformSettings");
      }),
      (t.prototype.isReady = function (e, t, i) {
        return !(
          i._areImageProcessingDirty &&
          t.imageProcessingConfiguration &&
          !t.imageProcessingConfiguration.isReady()
        );
      }),
      (t.prototype.prepareDefines = function (e, t, i) {
        i._areImageProcessingDirty &&
          t.imageProcessingConfiguration &&
          t.imageProcessingConfiguration.prepareDefines(i);
      }),
      (t.prototype.bind = function (e, t, i) {
        i &&
          t.imageProcessingConfiguration &&
          t.imageProcessingConfiguration.bind(e);
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t),
          t.sharedData.blocksWithDefines.push(this),
          t.sharedData.blockingBlocks.push(this),
          t.sharedData.bindableBlocks.push(this),
          t.uniforms.push("exposureLinear"),
          t.uniforms.push("contrast"),
          t.uniforms.push("vInverseScreenSize"),
          t.uniforms.push("vignetteSettings1"),
          t.uniforms.push("vignetteSettings2"),
          t.uniforms.push("vCameraColorCurveNegative"),
          t.uniforms.push("vCameraColorCurveNeutral"),
          t.uniforms.push("vCameraColorCurvePositive"),
          t.uniforms.push("txColorTransform"),
          t.uniforms.push("colorTransformSettings");
        var i = this.color,
          n = this._outputs[0],
          r = "//" + this.name;
        return (
          t._emitFunctionFromInclude("helperFunctions", r),
          t._emitFunctionFromInclude("imageProcessingDeclaration", r),
          t._emitFunctionFromInclude("imageProcessingFunctions", r),
          i.connectedPoint.type === Hl.Color4 ||
          i.connectedPoint.type === Hl.Vector4
            ? (t.compilationString +=
                this._declareOutput(n, t) +
                " = " +
                i.associatedVariableName +
                ";\r\n")
            : (t.compilationString +=
                this._declareOutput(n, t) +
                " = vec4(" +
                i.associatedVariableName +
                ", 1.0);\r\n"),
          (t.compilationString += "#ifdef IMAGEPROCESSINGPOSTPROCESS\r\n"),
          (t.compilationString +=
            n.associatedVariableName +
            ".rgb = toLinearSpace(" +
            i.associatedVariableName +
            ".rgb);\r\n"),
          (t.compilationString += "#else\r\n"),
          (t.compilationString += "#ifdef IMAGEPROCESSING\r\n"),
          (t.compilationString +=
            n.associatedVariableName +
            ".rgb = toLinearSpace(" +
            i.associatedVariableName +
            ".rgb);\r\n"),
          (t.compilationString +=
            n.associatedVariableName +
            " = applyImageProcessing(" +
            n.associatedVariableName +
            ");\r\n"),
          (t.compilationString += "#endif\r\n"),
          (t.compilationString += "#endif\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ImageProcessingBlock"] = kc;
  var Uc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Fragment) || this;
      return (
        (i._tangentSpaceParameterName = ""),
        (i.invertX = !1),
        (i.invertY = !1),
        i.registerInput("worldPosition", Hl.Vector4, !1),
        i.registerInput("worldNormal", Hl.Vector4, !1),
        i.registerInput("worldTangent", Hl.Vector4, !0),
        i.registerInput("uv", Hl.Vector2, !1),
        i.registerInput("normalMapColor", Hl.Color3, !1),
        i.registerInput("strength", Hl.Float, !1),
        i.registerOutput("output", Hl.Vector4),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "PerturbNormalBlock";
      }),
      Object.defineProperty(t.prototype, "worldPosition", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "worldNormal", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "worldTangent", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "uv", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "normalMapColor", {
        get: function () {
          return this._inputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "strength", {
        get: function () {
          return this._inputs[5];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.prepareDefines = function (e, t, i) {
        i.setValue("BUMP", !0);
      }),
      (t.prototype.bind = function (e, t, i) {
        t.getScene()._mirroredCameraPosition
          ? e.setFloat2(
              this._tangentSpaceParameterName,
              this.invertX ? 1 : -1,
              this.invertY ? 1 : -1
            )
          : e.setFloat2(
              this._tangentSpaceParameterName,
              this.invertX ? -1 : 1,
              this.invertY ? -1 : 1
            );
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.uv.isConnected) {
          var t = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "uv" === e.name;
          });
          t || (t = new lc("uv")).setAsAttribute(), t.output.connectTo(this.uv);
        }
        if (!this.strength.isConnected) {
          var i = new lc("strength");
          (i.value = 1), i.output.connectTo(this.strength);
        }
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = "//" + this.name,
          n = this.uv,
          r = this.worldPosition,
          o = this.worldNormal,
          s = this.worldTangent;
        t.sharedData.blocksWithDefines.push(this),
          t.sharedData.bindableBlocks.push(this),
          (this._tangentSpaceParameterName = t._getFreeDefineName(
            "tangentSpaceParameter"
          )),
          t._emitUniformFromString(this._tangentSpaceParameterName, "vec2");
        var a =
          this.strength.isConnectedToInputBlock &&
          this.strength.connectInputBlock.isConstant
            ? "" + t._emitFloat(1 / this.strength.connectInputBlock.value)
            : "1.0 / " + this.strength.associatedVariableName;
        t._emitExtension(
          "derivatives",
          "#extension GL_OES_standard_derivatives : enable"
        );
        var l = {
          search: /defined\(TANGENT\)/g,
          replace: s.isConnected ? "defined(TANGENT)" : "defined(IGNORE)",
        };
        return (
          s.isConnected &&
            ((t.compilationString +=
              "vec3 tbnNormal = normalize(" +
              o.associatedVariableName +
              ".xyz);\r\n"),
            (t.compilationString +=
              "vec3 tbnTangent = normalize(" +
              s.associatedVariableName +
              ".xyz);\r\n"),
            (t.compilationString +=
              "vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r\n"),
            (t.compilationString +=
              "mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n")),
          t._emitFunctionFromInclude("bumpFragmentMainFunctions", i, {
            replaceStrings: [l],
          }),
          t._emitFunctionFromInclude("bumpFragmentFunctions", i, {
            replaceStrings: [
              {
                search: /vBumpInfos.y/g,
                replace: a,
              },
              {
                search: /vTangentSpaceParams/g,
                replace: this._tangentSpaceParameterName,
              },
              {
                search: /vPositionW/g,
                replace: r.associatedVariableName + ".xyz",
              },
            ],
          }),
          (t.compilationString +=
            this._declareOutput(this.output, t) + " = vec4(0.);\r\n"),
          (t.compilationString += t._emitCodeFromInclude("bumpFragment", i, {
            replaceStrings: [
              {
                search: /perturbNormal\(TBN,vBumpUV\+uvOffset\)/g,
                replace:
                  "perturbNormal(TBN, " +
                  this.normalMapColor.associatedVariableName +
                  ")",
              },
              {
                search: /vBumpInfos.y/g,
                replace: a,
              },
              {
                search: /vBumpUV/g,
                replace: n.associatedVariableName,
              },
              {
                search: /vPositionW/g,
                replace: r.associatedVariableName + ".xyz",
              },
              {
                search: /normalW=/g,
                replace: this.output.associatedVariableName + ".xyz = ",
              },
              {
                search: /mat3\(normalMatrix\)\*normalW/g,
                replace:
                  "mat3(normalMatrix) * " +
                  this.output.associatedVariableName +
                  ".xyz",
              },
              {
                search: /normalW/g,
                replace: o.associatedVariableName + ".xyz",
              },
              l,
            ],
          })),
          this
        );
      }),
      (t.prototype._dumpPropertiesCode = function () {
        return (
          this._codeVariableName +
          ".invertX = " +
          this.invertX +
          ";\r\n" +
          (this._codeVariableName + ".invertY = ") +
          this.invertY +
          ";\r\n"
        );
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return (t.invertX = this.invertX), (t.invertY = this.invertY), t;
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          (this.invertX = t.invertX),
          (this.invertY = t.invertY);
      }),
      R(
        [
          _c("Invert X axis", pc.Boolean, "PROPERTIES", {
            notifiers: {
              update: !1,
            },
          }),
        ],
        t.prototype,
        "invertX",
        void 0
      ),
      R(
        [
          _c("Invert Y axis", pc.Boolean, "PROPERTIES", {
            notifiers: {
              update: !1,
            },
          }),
        ],
        t.prototype,
        "invertY",
        void 0
      ),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.PerturbNormalBlock"] = Uc;
  var zc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Fragment, !0) || this;
      return (
        i.registerInput("value", Hl.Float, !0),
        i.registerInput("cutoff", Hl.Float, !0),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "DiscardBlock";
      }),
      Object.defineProperty(t.prototype, "value", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "cutoff", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        if (
          (e.prototype._buildBlock.call(this, t),
          (t.sharedData.hints.needAlphaTesting = !0),
          this.cutoff.isConnected && this.value.isConnected)
        )
          return (
            (t.compilationString +=
              "if (" +
              this.value.associatedVariableName +
              " < " +
              this.cutoff.associatedVariableName +
              ") discard;\r\n"),
            this
          );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.DiscardBlock"] = zc;
  var Gc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Fragment) || this;
      return i.registerOutput("output", Hl.Float, Wl.Fragment), i;
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "FrontFacingBlock";
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        if ((e.prototype._buildBlock.call(this, t), t.target === Wl.Vertex))
          throw "FrontFacingBlock must only be used in a fragment shader";
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) + " = gl_FrontFacing ? 1.0 : 0.0;\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.FrontFacingBlock"] = Gc;
  var Wc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Fragment) || this;
      return (
        i.registerInput("input", Hl.AutoDetect, !1),
        i.registerOutput("dx", Hl.BasedOnInput),
        i.registerOutput("dy", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        (i._outputs[1]._typeConnectionSource = i._inputs[0]),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "DerivativeBlock";
      }),
      Object.defineProperty(t.prototype, "input", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "dx", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "dy", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0],
          n = this._outputs[1];
        return (
          t._emitExtension(
            "derivatives",
            "#extension GL_OES_standard_derivatives : enable"
          ),
          i.hasEndpoints &&
            (t.compilationString +=
              this._declareOutput(i, t) +
              " = dFdx(" +
              this.input.associatedVariableName +
              ");\r\n"),
          n.hasEndpoints &&
            (t.compilationString +=
              this._declareOutput(n, t) +
              " = dFdy(" +
              this.input.associatedVariableName +
              ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.DerivativeBlock"] = Wc;
  var Hc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Fragment) || this;
      return (
        i.registerOutput("xy", Hl.Vector2, Wl.Fragment),
        i.registerOutput("xyz", Hl.Vector3, Wl.Fragment),
        i.registerOutput("xyzw", Hl.Vector4, Wl.Fragment),
        i.registerOutput("x", Hl.Float, Wl.Fragment),
        i.registerOutput("y", Hl.Float, Wl.Fragment),
        i.registerOutput("z", Hl.Float, Wl.Fragment),
        i.registerOutput("w", Hl.Float, Wl.Fragment),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "FragCoordBlock";
      }),
      Object.defineProperty(t.prototype, "xy", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "xyz", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "xyzw", {
        get: function () {
          return this._outputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "x", {
        get: function () {
          return this._outputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "y", {
        get: function () {
          return this._outputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "z", {
        get: function () {
          return this._outputs[5];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[6];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.writeOutputs = function (e) {
        for (var t = "", i = 0, n = this._outputs; i < n.length; i++) {
          var r = n[i];
          r.hasEndpoints &&
            (t +=
              this._declareOutput(r, e) +
              " = gl_FragCoord." +
              r.name +
              ";\r\n");
        }
        return t;
      }),
      (t.prototype._buildBlock = function (t) {
        if ((e.prototype._buildBlock.call(this, t), t.target === Wl.Vertex))
          throw "FragCoordBlock must only be used in a fragment shader";
        return (t.compilationString += this.writeOutputs(t)), this;
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.FragCoordBlock"] = Hc;
  var jc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Fragment) || this;
      return (
        i.registerOutput("xy", Hl.Vector2, Wl.Fragment),
        i.registerOutput("x", Hl.Float, Wl.Fragment),
        i.registerOutput("y", Hl.Float, Wl.Fragment),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ScreenSizeBlock";
      }),
      Object.defineProperty(t.prototype, "xy", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "x", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "y", {
        get: function () {
          return this._outputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.bind = function (e, t, i) {
        var n = this._scene.getEngine();
        e.setFloat2(this._varName, n.getRenderWidth(), n.getRenderWidth());
      }),
      (t.prototype.writeOutputs = function (e, t) {
        for (var i = "", n = 0, r = this._outputs; n < r.length; n++) {
          var o = r[n];
          o.hasEndpoints &&
            (i +=
              this._declareOutput(o, e) + " = " + t + "." + o.name + ";\r\n");
        }
        return i;
      }),
      (t.prototype._buildBlock = function (t) {
        if (
          (e.prototype._buildBlock.call(this, t),
          (this._scene = t.sharedData.scene),
          t.target === Wl.Vertex)
        )
          throw "ScreenSizeBlock must only be used in a fragment shader";
        return (
          t.sharedData.bindableBlocks.push(this),
          (this._varName = t._getFreeVariableName("screenSize")),
          t._emitUniformFromString(this._varName, "vec2"),
          (t.compilationString += this.writeOutputs(t, this._varName)),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ScreenSizeBlock"] = jc;
  var Xc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.VertexAndFragment, !0) || this;
      return (
        i.registerInput("worldPosition", Hl.Vector4, !1, Wl.Vertex),
        i.registerInput("view", Hl.Matrix, !1, Wl.Vertex),
        i.registerInput("input", Hl.Color3, !1, Wl.Fragment),
        i.registerInput("fogColor", Hl.Color3, !1, Wl.Fragment),
        i.registerOutput("output", Hl.Color3, Wl.Fragment),
        i.input.acceptedConnectionPointTypes.push(Hl.Color4),
        i.fogColor.acceptedConnectionPointTypes.push(Hl.Color4),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "FogBlock";
      }),
      Object.defineProperty(t.prototype, "worldPosition", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "view", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "input", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "fogColor", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.view.isConnected) {
          var t = e.getInputBlockByPredicate(function (e) {
            return e.systemValue === Xl.View;
          });
          t || (t = new lc("view")).setAsSystemValue(Xl.View),
            t.output.connectTo(this.view);
        }
        if (!this.fogColor.isConnected) {
          var i = e.getInputBlockByPredicate(function (e) {
            return e.systemValue === Xl.FogColor;
          });
          i ||
            (i = new lc("fogColor", void 0, Hl.Color3)).setAsSystemValue(
              Xl.FogColor
            ),
            i.output.connectTo(this.fogColor);
        }
      }),
      (t.prototype.prepareDefines = function (e, t, i) {
        var n = e.getScene();
        i.setValue("FOG", t.fogEnabled && Hr.GetFogState(e, n));
      }),
      (t.prototype.bind = function (e, t, i) {
        if (i) {
          var n = i.getScene();
          e.setFloat4(
            this._fogParameters,
            n.fogMode,
            n.fogStart,
            n.fogEnd,
            n.fogDensity
          );
        }
      }),
      (t.prototype._buildBlock = function (t) {
        if ((e.prototype._buildBlock.call(this, t), t.target === Wl.Fragment)) {
          t.sharedData.blocksWithDefines.push(this),
            t.sharedData.bindableBlocks.push(this),
            t._emitFunctionFromInclude(
              "fogFragmentDeclaration",
              "//" + this.name,
              {
                removeUniforms: !0,
                removeVaryings: !0,
                removeIfDef: !1,
                replaceStrings: [
                  {
                    search: /float CalcFogFactor\(\)/,
                    replace:
                      "float CalcFogFactor(vec3 vFogDistance, vec4 vFogInfos)",
                  },
                ],
              }
            );
          var i = t._getFreeVariableName("fog"),
            n = this.input,
            r = this.fogColor;
          this._fogParameters = t._getFreeVariableName("fogParameters");
          var o = this._outputs[0];
          t._emitUniformFromString(this._fogParameters, "vec4"),
            (t.compilationString += "#ifdef FOG\r\n"),
            (t.compilationString +=
              "float " +
              i +
              " = CalcFogFactor(" +
              this._fogDistanceName +
              ", " +
              this._fogParameters +
              ");\r\n"),
            (t.compilationString +=
              this._declareOutput(o, t) +
              " = " +
              i +
              " * " +
              n.associatedVariableName +
              ".rgb + (1.0 - " +
              i +
              ") * " +
              r.associatedVariableName +
              ".rgb;\r\n"),
            (t.compilationString +=
              "#else\r\n" +
              this._declareOutput(o, t) +
              " =  " +
              n.associatedVariableName +
              ".rgb;\r\n"),
            (t.compilationString += "#endif\r\n");
        } else {
          var s = this.worldPosition,
            a = this.view;
          (this._fogDistanceName = t._getFreeVariableName("vFogDistance")),
            t._emitVaryingFromString(this._fogDistanceName, "vec3"),
            (t.compilationString +=
              this._fogDistanceName +
              " = (" +
              a.associatedVariableName +
              " * " +
              s.associatedVariableName +
              ").xyz;\r\n");
        }
        return this;
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.FogBlock"] = Xc;
  var Yc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.VertexAndFragment) || this;
      return (
        (i._isUnique = !0),
        i.registerInput("worldPosition", Hl.Vector4, !1, Wl.Vertex),
        i.registerInput("worldNormal", Hl.Vector4, !1, Wl.Fragment),
        i.registerInput("cameraPosition", Hl.Vector3, !1, Wl.Fragment),
        i.registerInput("glossiness", Hl.Float, !0, Wl.Fragment),
        i.registerInput("glossPower", Hl.Float, !0, Wl.Fragment),
        i.registerInput("diffuseColor", Hl.Color3, !0, Wl.Fragment),
        i.registerInput("specularColor", Hl.Color3, !0, Wl.Fragment),
        i.registerInput("view", Hl.Matrix, !0),
        i.registerOutput("diffuseOutput", Hl.Color3, Wl.Fragment),
        i.registerOutput("specularOutput", Hl.Color3, Wl.Fragment),
        i.registerOutput("shadow", Hl.Float, Wl.Fragment),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "LightBlock";
      }),
      Object.defineProperty(t.prototype, "worldPosition", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "worldNormal", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "cameraPosition", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "glossiness", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "glossPower", {
        get: function () {
          return this._inputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "diffuseColor", {
        get: function () {
          return this._inputs[5];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "specularColor", {
        get: function () {
          return this._inputs[6];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "view", {
        get: function () {
          return this._inputs[7];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "diffuseOutput", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "specularOutput", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "shadow", {
        get: function () {
          return this._outputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.cameraPosition.isConnected) {
          var t = e.getInputBlockByPredicate(function (e) {
            return e.systemValue === Xl.CameraPosition;
          });
          t ||
            (t = new lc("cameraPosition")).setAsSystemValue(Xl.CameraPosition),
            t.output.connectTo(this.cameraPosition);
        }
      }),
      (t.prototype.prepareDefines = function (e, t, i) {
        if (i._areLightsDirty) {
          var n = e.getScene();
          if (this.light) {
            var r = {
              needNormals: !1,
              needRebuild: !1,
              lightmapMode: !1,
              shadowEnabled: !1,
              specularEnabled: !1,
            };
            Hr.PrepareDefinesForLight(
              n,
              e,
              this.light,
              this._lightId,
              i,
              !0,
              r
            ),
              r.needRebuild && i.rebuild();
          } else
            Hr.PrepareDefinesForLights(n, e, i, !0, t.maxSimultaneousLights);
        }
      }),
      (t.prototype.updateUniformsAndSamples = function (e, t, i, n) {
        for (var r = 0; r < t.maxSimultaneousLights && i["LIGHT" + r]; r++) {
          var o = e.uniforms.indexOf("vLightData" + r) >= 0;
          Hr.PrepareUniformsAndSamplersForLight(
            r,
            e.uniforms,
            e.samplers,
            i["PROJECTEDLIGHTTEXTURE" + r],
            n,
            o
          );
        }
      }),
      (t.prototype.bind = function (e, t, i) {
        if (i) {
          var n = i.getScene();
          this.light
            ? Hr.BindLight(this.light, this._lightId, n, e, !0)
            : Hr.BindLights(n, i, e, !0, t.maxSimultaneousLights);
        }
      }),
      (t.prototype._injectVertexCode = function (e) {
        var t = this.worldPosition,
          i = "//" + this.name;
        this.light
          ? ((this._lightId =
              (void 0 !== e.counters.lightCounter
                ? e.counters.lightCounter
                : -1) + 1),
            (e.counters.lightCounter = this._lightId),
            e._emitFunctionFromInclude(
              e.supportUniformBuffers
                ? "lightUboDeclaration"
                : "lightFragmentDeclaration",
              i,
              {
                replaceStrings: [
                  {
                    search: /{X}/g,
                    replace: this._lightId.toString(),
                  },
                ],
              },
              this._lightId.toString()
            ))
          : (e._emitFunctionFromInclude(
              e.supportUniformBuffers
                ? "lightUboDeclaration"
                : "lightFragmentDeclaration",
              i,
              {
                repeatKey: "maxSimultaneousLights",
              }
            ),
            (this._lightId = 0),
            e.sharedData.dynamicUniformBlocks.push(this));
        var n = "v_" + t.associatedVariableName;
        e._emitVaryingFromString(n, "vec4") &&
          (e.compilationString +=
            n + " = " + t.associatedVariableName + ";\r\n"),
          this.light
            ? (e.compilationString += e._emitCodeFromInclude(
                "shadowsVertex",
                i,
                {
                  replaceStrings: [
                    {
                      search: /{X}/g,
                      replace: this._lightId.toString(),
                    },
                    {
                      search: /worldPos/g,
                      replace: t.associatedVariableName,
                    },
                  ],
                }
              ))
            : ((e.compilationString +=
                "vec4 worldPos = " + t.associatedVariableName + ";\r\n"),
              this.view.isConnected &&
                (e.compilationString +=
                  "mat4 view = " + this.view.associatedVariableName + ";\r\n"),
              (e.compilationString += e._emitCodeFromInclude(
                "shadowsVertex",
                i,
                {
                  repeatKey: "maxSimultaneousLights",
                }
              )));
      }),
      (t.prototype._buildBlock = function (t) {
        if ((e.prototype._buildBlock.call(this, t), t.target === Wl.Fragment)) {
          t.sharedData.bindableBlocks.push(this),
            t.sharedData.blocksWithDefines.push(this);
          var i = "//" + this.name,
            n = this.worldPosition;
          t._emitFunctionFromInclude("helperFunctions", i),
            t._emitFunctionFromInclude("lightsFragmentFunctions", i, {
              replaceStrings: [
                {
                  search: /vPositionW/g,
                  replace: "v_" + n.associatedVariableName + ".xyz",
                },
              ],
            }),
            t._emitFunctionFromInclude("shadowsFragmentFunctions", i, {
              replaceStrings: [
                {
                  search: /vPositionW/g,
                  replace: "v_" + n.associatedVariableName + ".xyz",
                },
              ],
            }),
            this.light
              ? t._emitFunctionFromInclude(
                  t.supportUniformBuffers
                    ? "lightUboDeclaration"
                    : "lightFragmentDeclaration",
                  i,
                  {
                    replaceStrings: [
                      {
                        search: /{X}/g,
                        replace: this._lightId.toString(),
                      },
                    ],
                  },
                  this._lightId.toString()
                )
              : t._emitFunctionFromInclude(
                  t.supportUniformBuffers
                    ? "lightUboDeclaration"
                    : "lightFragmentDeclaration",
                  i,
                  {
                    repeatKey: "maxSimultaneousLights",
                  }
                ),
            0 === this._lightId &&
              (t._registerTempVariable("viewDirectionW") &&
                (t.compilationString +=
                  "vec3 viewDirectionW = normalize(" +
                  this.cameraPosition.associatedVariableName +
                  " - v_" +
                  n.associatedVariableName +
                  ".xyz);\r\n"),
              (t.compilationString += "lightingInfo info;\r\n"),
              (t.compilationString += "float shadow = 1.;\r\n"),
              (t.compilationString +=
                "float glossiness = " +
                (this.glossiness.isConnected
                  ? this.glossiness.associatedVariableName
                  : "1.0") +
                " * " +
                (this.glossPower.isConnected
                  ? this.glossPower.associatedVariableName
                  : "1024.0") +
                ";\r\n"),
              (t.compilationString +=
                "vec3 diffuseBase = vec3(0., 0., 0.);\r\n"),
              (t.compilationString +=
                "vec3 specularBase = vec3(0., 0., 0.);\r\n"),
              (t.compilationString +=
                "vec3 normalW = " +
                this.worldNormal.associatedVariableName +
                ".xyz;\r\n")),
            this.light
              ? (t.compilationString += t._emitCodeFromInclude(
                  "lightFragment",
                  i,
                  {
                    replaceStrings: [
                      {
                        search: /{X}/g,
                        replace: this._lightId.toString(),
                      },
                    ],
                  }
                ))
              : (t.compilationString += t._emitCodeFromInclude(
                  "lightFragment",
                  i,
                  {
                    repeatKey: "maxSimultaneousLights",
                  }
                ));
          var r = this.diffuseOutput,
            o = this.specularOutput;
          return (
            (t.compilationString +=
              this._declareOutput(r, t) +
              " = diffuseBase" +
              (this.diffuseColor.isConnected
                ? " * " + this.diffuseColor.associatedVariableName
                : "") +
              ";\r\n"),
            o.hasEndpoints &&
              (t.compilationString +=
                this._declareOutput(o, t) +
                " = specularBase" +
                (this.specularColor.isConnected
                  ? " * " + this.specularColor.associatedVariableName
                  : "") +
                ";\r\n"),
            this.shadow.hasEndpoints &&
              (t.compilationString +=
                this._declareOutput(this.shadow, t) + " = shadow;\r\n"),
            this
          );
        }
        this._injectVertexCode(t);
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return this.light && (t.lightId = this.light.id), t;
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          t.lightId && (this.light = i.getLightByID(t.lightId));
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.LightBlock"] = Yc;
  var Kc = (function (e) {
    function t(t, i) {
      void 0 === i && (i = !1);
      var n = e.call(this, t, i ? Wl.Fragment : Wl.VertexAndFragment) || this;
      return (
        (n.convertToGammaSpace = !1),
        (n.convertToLinearSpace = !1),
        (n._fragmentOnly = i),
        n.registerInput("uv", Hl.Vector2, !1, Wl.VertexAndFragment),
        n.registerOutput("rgba", Hl.Color4, Wl.Neutral),
        n.registerOutput("rgb", Hl.Color3, Wl.Neutral),
        n.registerOutput("r", Hl.Float, Wl.Neutral),
        n.registerOutput("g", Hl.Float, Wl.Neutral),
        n.registerOutput("b", Hl.Float, Wl.Neutral),
        n.registerOutput("a", Hl.Float, Wl.Neutral),
        n._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector3),
        n._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector4),
        (n._inputs[0]._prioritizeVertex = !i),
        n
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "TextureBlock";
      }),
      Object.defineProperty(t.prototype, "uv", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rgba", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rgb", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "r", {
        get: function () {
          return this._outputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "g", {
        get: function () {
          return this._outputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "b", {
        get: function () {
          return this._outputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "a", {
        get: function () {
          return this._outputs[5];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "target", {
        get: function () {
          if (this._fragmentOnly) return Wl.Fragment;
          if (!this.uv.isConnected) return Wl.VertexAndFragment;
          if (this.uv.sourceBlock.isInput) return Wl.VertexAndFragment;
          for (var e = this.uv.connectedPoint; e; ) {
            if (e.target === Wl.Fragment) return Wl.Fragment;
            if (e.target === Wl.Vertex) return Wl.VertexAndFragment;
            if (e.target === Wl.Neutral || e.target === Wl.VertexAndFragment) {
              var t = e.ownerBlock;
              e = null;
              for (var i = 0, n = t.inputs; i < n.length; i++) {
                var r = n[i];
                if (r.connectedPoint) {
                  e = r.connectedPoint;
                  break;
                }
              }
            }
          }
          return Wl.VertexAndFragment;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.uv.isConnected)
          if (e.mode === Yl.PostProcess)
            (t = e.getBlockByPredicate(function (e) {
              return "uv" === e.name;
            })) && t.connectTo(this);
          else {
            var t,
              i = e.mode === Yl.Particle ? "particle_uv" : "uv";
            (t = e.getInputBlockByPredicate(function (e) {
              return e.isAttribute && e.name === i;
            })) || (t = new lc("uv")).setAsAttribute(i),
              t.output.connectTo(this.uv);
          }
      }),
      (t.prototype.initializeDefines = function (e, t, i, n) {
        void 0 === n && (n = !1),
          i._areTexturesDirty && i.setValue(this._mainUVDefineName, !1);
      }),
      (t.prototype.prepareDefines = function (e, t, i) {
        if (i._areTexturesDirty) {
          if (!this.texture || !this.texture.getTextureMatrix)
            return (
              i.setValue(this._defineName, !1),
              void i.setValue(this._mainUVDefineName, !0)
            );
          i.setValue(this._linearDefineName, this.convertToGammaSpace),
            i.setValue(this._gammaDefineName, this.convertToLinearSpace),
            this._isMixed &&
              (this.texture.getTextureMatrix().isIdentityAs3x2()
                ? (i.setValue(this._defineName, !1),
                  i.setValue(this._mainUVDefineName, !0))
                : i.setValue(this._defineName, !0));
        }
      }),
      (t.prototype.isReady = function () {
        return !(this.texture && !this.texture.isReadyOrNotBlocking());
      }),
      (t.prototype.bind = function (e, t, i) {
        this.texture &&
          (this._isMixed &&
            (e.setFloat(this._textureInfoName, this.texture.level),
            e.setMatrix(
              this._textureTransformName,
              this.texture.getTextureMatrix()
            )),
          e.setTexture(this._samplerName, this.texture));
      }),
      Object.defineProperty(t.prototype, "_isMixed", {
        get: function () {
          return this.target !== Wl.Fragment;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._injectVertexCode = function (e) {
        var t = this.uv;
        if (
          ((this._defineName = e._getFreeDefineName("UVTRANSFORM")),
          (this._mainUVDefineName =
            "VMAIN" + t.associatedVariableName.toUpperCase()),
          t.connectedPoint.ownerBlock.isInput &&
            (t.connectedPoint.ownerBlock.isAttribute ||
              e._emitUniformFromString(t.associatedVariableName, "vec2")),
          (this._mainUVName = "vMain" + t.associatedVariableName),
          (this._transformedUVName = e._getFreeVariableName("transformedUV")),
          (this._textureTransformName =
            e._getFreeVariableName("textureTransform")),
          (this._textureInfoName = e._getFreeVariableName("textureInfoName")),
          e._emitVaryingFromString(
            this._transformedUVName,
            "vec2",
            this._defineName
          ),
          e._emitVaryingFromString(
            this._mainUVName,
            "vec2",
            this._mainUVDefineName
          ),
          e._emitUniformFromString(
            this._textureTransformName,
            "mat4",
            this._defineName
          ),
          (e.compilationString += "#ifdef " + this._defineName + "\r\n"),
          (e.compilationString +=
            this._transformedUVName +
            " = vec2(" +
            this._textureTransformName +
            " * vec4(" +
            t.associatedVariableName +
            ".xy, 1.0, 0.0));\r\n"),
          (e.compilationString +=
            "#elif defined(" + this._mainUVDefineName + ")\r\n"),
          (e.compilationString +=
            this._mainUVName + " = " + t.associatedVariableName + ".xy;\r\n"),
          (e.compilationString += "#endif\r\n"),
          this._outputs.some(function (e) {
            return e.isConnectedInVertexShader;
          }))
        ) {
          this._writeTextureRead(e, !0);
          for (var i = 0, n = this._outputs; i < n.length; i++) {
            var r = n[i];
            r.hasEndpoints && this._writeOutput(e, r, r.name, !0);
          }
        }
      }),
      (t.prototype._writeTextureRead = function (e, t) {
        void 0 === t && (t = !1);
        var i = this.uv;
        if (t) {
          if (e.target === Wl.Fragment) return;
          e.compilationString +=
            "vec4 " +
            this._tempTextureRead +
            " = texture2D(" +
            this._samplerName +
            ", " +
            i.associatedVariableName +
            ");\r\n";
        } else
          this.uv.ownerBlock.target !== Wl.Fragment
            ? ((e.compilationString += "#ifdef " + this._defineName + "\r\n"),
              (e.compilationString +=
                "vec4 " +
                this._tempTextureRead +
                " = texture2D(" +
                this._samplerName +
                ", " +
                this._transformedUVName +
                ");\r\n"),
              (e.compilationString +=
                "#elif defined(" + this._mainUVDefineName + ")\r\n"),
              (e.compilationString +=
                "vec4 " +
                this._tempTextureRead +
                " = texture2D(" +
                this._samplerName +
                ", " +
                this._mainUVName +
                ");\r\n"),
              (e.compilationString += "#endif\r\n"))
            : (e.compilationString +=
                "vec4 " +
                this._tempTextureRead +
                " = texture2D(" +
                this._samplerName +
                ", " +
                i.associatedVariableName +
                ");\r\n");
      }),
      (t.prototype._writeOutput = function (e, t, i, n) {
        if ((void 0 === n && (n = !1), n)) {
          if (e.target === Wl.Fragment) return;
          e.compilationString +=
            this._declareOutput(t, e) +
            " = " +
            this._tempTextureRead +
            "." +
            i +
            ";\r\n";
        } else if (this.uv.ownerBlock.target !== Wl.Fragment) {
          var r = " * " + this._textureInfoName;
          (e.compilationString +=
            this._declareOutput(t, e) +
            " = " +
            this._tempTextureRead +
            "." +
            i +
            r +
            ";\r\n"),
            "a" !== i &&
              ((e.compilationString +=
                "#ifdef " + this._linearDefineName + "\r\n"),
              (e.compilationString +=
                t.associatedVariableName +
                " = toGammaSpace(" +
                t.associatedVariableName +
                ");\r\n"),
              (e.compilationString += "#endif\r\n"),
              (e.compilationString +=
                "#ifdef " + this._gammaDefineName + "\r\n"),
              (e.compilationString +=
                t.associatedVariableName +
                " = toLinearSpace(" +
                t.associatedVariableName +
                ");\r\n"),
              (e.compilationString += "#endif\r\n"));
        } else
          e.compilationString +=
            this._declareOutput(t, e) +
            " = " +
            this._tempTextureRead +
            "." +
            i +
            ";\r\n";
      }),
      (t.prototype._buildBlock = function (t) {
        if (
          (e.prototype._buildBlock.call(this, t),
          (t.target === Wl.Vertex || this._fragmentOnly) &&
            (this._tempTextureRead = t._getFreeVariableName("tempTextureRead")),
          ((!this._isMixed && t.target === Wl.Fragment) ||
            (this._isMixed && t.target === Wl.Vertex)) &&
            ((this._samplerName = t._getFreeVariableName(
              this.name + "Sampler"
            )),
            t._emit2DSampler(this._samplerName),
            t.sharedData.blockingBlocks.push(this),
            t.sharedData.textureBlocks.push(this),
            t.sharedData.blocksWithDefines.push(this),
            t.sharedData.bindableBlocks.push(this)),
          t.target === Wl.Fragment)
        ) {
          if (
            this._outputs.some(function (e) {
              return e.isConnectedInFragmentShader;
            })
          ) {
            this._isMixed && t._emit2DSampler(this._samplerName),
              (this._linearDefineName = t._getFreeDefineName("ISLINEAR")),
              (this._gammaDefineName = t._getFreeDefineName("ISGAMMA"));
            var i = "//" + this.name;
            t._emitFunctionFromInclude("helperFunctions", i),
              this._isMixed &&
                t._emitUniformFromString(this._textureInfoName, "float"),
              this._writeTextureRead(t);
            for (var n = 0, r = this._outputs; n < r.length; n++) {
              var o = r[n];
              o.hasEndpoints && this._writeOutput(t, o, o.name);
            }
            return this;
          }
        } else this._injectVertexCode(t);
      }),
      (t.prototype._dumpPropertiesCode = function () {
        if (!this.texture) return "";
        var e =
          this._codeVariableName +
          '.texture = new BABYLON.Texture("' +
          this.texture.name +
          '", null);\r\n';
        return (
          (e +=
            this._codeVariableName +
            ".texture.wrapU = " +
            this.texture.wrapU +
            ";\r\n"),
          (e +=
            this._codeVariableName +
            ".texture.wrapV = " +
            this.texture.wrapV +
            ";\r\n"),
          (e +=
            this._codeVariableName +
            ".texture.uAng = " +
            this.texture.uAng +
            ";\r\n"),
          (e +=
            this._codeVariableName +
            ".texture.vAng = " +
            this.texture.vAng +
            ";\r\n"),
          (e +=
            this._codeVariableName +
            ".texture.wAng = " +
            this.texture.wAng +
            ";\r\n"),
          (e +=
            this._codeVariableName +
            ".texture.uOffset = " +
            this.texture.uOffset +
            ";\r\n"),
          (e +=
            this._codeVariableName +
            ".texture.vOffset = " +
            this.texture.vOffset +
            ";\r\n"),
          (e +=
            this._codeVariableName +
            ".texture.uScale = " +
            this.texture.uScale +
            ";\r\n"),
          (e +=
            this._codeVariableName +
            ".texture.vScale = " +
            this.texture.vScale +
            ";\r\n"),
          (e +=
            this._codeVariableName +
            ".convertToGammaSpace = " +
            this.convertToGammaSpace +
            ";\r\n") +
            (this._codeVariableName + ".convertToLinearSpace = ") +
            this.convertToLinearSpace +
            ";\r\n"
        );
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return (
          (t.convertToGammaSpace = this.convertToGammaSpace),
          (t.convertToLinearSpace = this.convertToLinearSpace),
          (t.fragmentOnly = this._fragmentOnly),
          this.texture &&
            !this.texture.isRenderTarget &&
            (t.texture = this.texture.serialize()),
          t
        );
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          (this.convertToGammaSpace = t.convertToGammaSpace),
          (this.convertToLinearSpace = !!t.convertToLinearSpace),
          (this._fragmentOnly = !!t.fragmentOnly),
          t.texture &&
            !Nc.IgnoreTexturesAtLoadTime &&
            ((n = 0 === t.texture.url.indexOf("data:") ? "" : n),
            (this.texture = mn.Parse(t.texture, i, n)));
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.TextureBlock"] = Kc;
  var Qc = (function (e) {
    function t(t) {
      return e.call(this, t, Wl.VertexAndFragment) || this;
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ReflectionTextureBaseBlock";
      }),
      (t.prototype._getTexture = function () {
        return this.texture;
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.position.isConnected) {
          var t = e.getInputBlockByPredicate(function (e) {
            return e.isAttribute && "position" === e.name;
          });
          t || (t = new lc("position")).setAsAttribute(),
            t.output.connectTo(this.position);
        }
        if (!this.world.isConnected) {
          var i = e.getInputBlockByPredicate(function (e) {
            return e.systemValue === Xl.World;
          });
          i || (i = new lc("world")).setAsSystemValue(Xl.World),
            i.output.connectTo(this.world);
        }
        if (this.view && !this.view.isConnected) {
          var n = e.getInputBlockByPredicate(function (e) {
            return e.systemValue === Xl.View;
          });
          n || (n = new lc("view")).setAsSystemValue(Xl.View),
            n.output.connectTo(this.view);
        }
      }),
      (t.prototype.prepareDefines = function (e, t, i) {
        if (i._areTexturesDirty) {
          var n = this._getTexture();
          n &&
            n.getTextureMatrix &&
            (i.setValue(this._define3DName, n.isCube, !0),
            i.setValue(this._defineLocalCubicName, !!n.boundingBoxSize, !0),
            i.setValue(this._defineExplicitName, 0 === n.coordinatesMode, !0),
            i.setValue(this._defineSkyboxName, 5 === n.coordinatesMode, !0),
            i.setValue(
              this._defineCubicName,
              3 === n.coordinatesMode || 6 === n.coordinatesMode,
              !0
            ),
            i.setValue("INVERTCUBICMAP", 6 === n.coordinatesMode, !0),
            i.setValue(this._defineSphericalName, 1 === n.coordinatesMode, !0),
            i.setValue(this._definePlanarName, 2 === n.coordinatesMode, !0),
            i.setValue(this._defineProjectionName, 4 === n.coordinatesMode, !0),
            i.setValue(
              this._defineEquirectangularName,
              7 === n.coordinatesMode,
              !0
            ),
            i.setValue(
              this._defineEquirectangularFixedName,
              8 === n.coordinatesMode,
              !0
            ),
            i.setValue(
              this._defineMirroredEquirectangularFixedName,
              9 === n.coordinatesMode,
              !0
            ));
        }
      }),
      (t.prototype.isReady = function () {
        var e = this._getTexture();
        return !(e && !e.isReadyOrNotBlocking());
      }),
      (t.prototype.bind = function (e, t, i) {
        var n = this._getTexture();
        i &&
          n &&
          (e.setMatrix(
            this._reflectionMatrixName,
            n.getReflectionTextureMatrix()
          ),
          n.isCube
            ? e.setTexture(this._cubeSamplerName, n)
            : e.setTexture(this._2DSamplerName, n));
      }),
      (t.prototype.handleVertexSide = function (e) {
        (this._define3DName = e._getFreeDefineName("REFLECTIONMAP_3D")),
          (this._defineCubicName = e._getFreeDefineName("REFLECTIONMAP_CUBIC")),
          (this._defineSphericalName = e._getFreeDefineName(
            "REFLECTIONMAP_SPHERICAL"
          )),
          (this._definePlanarName = e._getFreeDefineName(
            "REFLECTIONMAP_PLANAR"
          )),
          (this._defineProjectionName = e._getFreeDefineName(
            "REFLECTIONMAP_PROJECTION"
          )),
          (this._defineExplicitName = e._getFreeDefineName(
            "REFLECTIONMAP_EXPLICIT"
          )),
          (this._defineEquirectangularName = e._getFreeDefineName(
            "REFLECTIONMAP_EQUIRECTANGULAR"
          )),
          (this._defineLocalCubicName = e._getFreeDefineName(
            "USE_LOCAL_REFLECTIONMAP_CUBIC"
          )),
          (this._defineMirroredEquirectangularFixedName = e._getFreeDefineName(
            "REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"
          )),
          (this._defineEquirectangularFixedName = e._getFreeDefineName(
            "REFLECTIONMAP_EQUIRECTANGULAR_FIXED"
          )),
          (this._defineSkyboxName = e._getFreeDefineName(
            "REFLECTIONMAP_SKYBOX"
          )),
          (this._defineOppositeZ = e._getFreeDefineName(
            "REFLECTIONMAP_OPPOSITEZ"
          )),
          (this._reflectionMatrixName =
            e._getFreeVariableName("reflectionMatrix")),
          e._emitUniformFromString(this._reflectionMatrixName, "mat4");
        var t = "",
          i = "v_" + this.worldPosition.associatedVariableName;
        return (
          e._emitVaryingFromString(i, "vec4") &&
            (t +=
              i + " = " + this.worldPosition.associatedVariableName + ";\r\n"),
          (this._positionUVWName = e._getFreeVariableName("positionUVW")),
          (this._directionWName = e._getFreeVariableName("directionW")),
          e._emitVaryingFromString(
            this._positionUVWName,
            "vec3",
            this._defineSkyboxName
          ) &&
            ((t += "#ifdef " + this._defineSkyboxName + "\r\n"),
            (t +=
              this._positionUVWName +
              " = " +
              this.position.associatedVariableName +
              ".xyz;\r\n"),
            (t += "#endif\r\n")),
          e._emitVaryingFromString(
            this._directionWName,
            "vec3",
            "defined(" +
              this._defineEquirectangularFixedName +
              ") || defined(" +
              this._defineMirroredEquirectangularFixedName +
              ")"
          ) &&
            ((t +=
              "#if defined(" +
              this._defineEquirectangularFixedName +
              ") || defined(" +
              this._defineMirroredEquirectangularFixedName +
              ")\r\n"),
            (t +=
              this._directionWName +
              " = normalize(vec3(" +
              this.world.associatedVariableName +
              " * vec4(" +
              this.position.associatedVariableName +
              ".xyz, 0.0)));\r\n"),
            (t += "#endif\r\n")),
          t
        );
      }),
      (t.prototype.handleFragmentSideInits = function (e) {
        e.sharedData.blockingBlocks.push(this),
          e.sharedData.textureBlocks.push(this),
          (this._cubeSamplerName = e._getFreeVariableName(
            this.name + "CubeSampler"
          )),
          e.samplers.push(this._cubeSamplerName),
          (this._2DSamplerName = e._getFreeVariableName(
            this.name + "2DSampler"
          )),
          e.samplers.push(this._2DSamplerName),
          (e._samplerDeclaration += "#ifdef " + this._define3DName + "\r\n"),
          (e._samplerDeclaration +=
            "uniform samplerCube " + this._cubeSamplerName + ";\r\n"),
          (e._samplerDeclaration += "#else\r\n"),
          (e._samplerDeclaration +=
            "uniform sampler2D " + this._2DSamplerName + ";\r\n"),
          (e._samplerDeclaration += "#endif\r\n"),
          e.sharedData.blocksWithDefines.push(this),
          e.sharedData.bindableBlocks.push(this);
        var t = "//" + this.name;
        e._emitFunction(
          "ReciprocalPI",
          "#define RECIPROCAL_PI2 0.15915494",
          ""
        ),
          e._emitFunctionFromInclude("reflectionFunction", t, {
            replaceStrings: [
              {
                search: /vec3 computeReflectionCoords/g,
                replace: "void DUMMYFUNC",
              },
            ],
          }),
          (this._reflectionColorName =
            e._getFreeVariableName("reflectionColor")),
          (this._reflectionVectorName =
            e._getFreeVariableName("reflectionUVW")),
          (this._reflectionCoordsName =
            e._getFreeVariableName("reflectionCoords"));
      }),
      (t.prototype.handleFragmentSideCodeReflectionCoords = function (e, t, i) {
        void 0 === i && (i = !1),
          t || (t = "v_" + this.worldPosition.associatedVariableName);
        var n = this._reflectionMatrixName,
          r = "normalize(" + this._directionWName + ")",
          o = "" + this._positionUVWName,
          s = "" + this.cameraPosition.associatedVariableName,
          a = "" + this.view.associatedVariableName;
        e += ".xyz";
        var l =
          "\n            #ifdef " +
          this._defineMirroredEquirectangularFixedName +
          "\n                vec3 " +
          this._reflectionVectorName +
          " = computeMirroredFixedEquirectangularCoords(" +
          t +
          ", " +
          e +
          ", " +
          r +
          ");\n            #endif\n\n            #ifdef " +
          this._defineEquirectangularFixedName +
          "\n                vec3 " +
          this._reflectionVectorName +
          " = computeFixedEquirectangularCoords(" +
          t +
          ", " +
          e +
          ", " +
          r +
          ");\n            #endif\n\n            #ifdef " +
          this._defineEquirectangularName +
          "\n                vec3 " +
          this._reflectionVectorName +
          " = computeEquirectangularCoords(" +
          t +
          ", " +
          e +
          ", " +
          s +
          ".xyz, " +
          n +
          ");\n            #endif\n\n            #ifdef " +
          this._defineSphericalName +
          "\n                vec3 " +
          this._reflectionVectorName +
          " = computeSphericalCoords(" +
          t +
          ", " +
          e +
          ", " +
          a +
          ", " +
          n +
          ");\n            #endif\n\n            #ifdef " +
          this._definePlanarName +
          "\n                vec3 " +
          this._reflectionVectorName +
          " = computePlanarCoords(" +
          t +
          ", " +
          e +
          ", " +
          s +
          ".xyz, " +
          n +
          ");\n            #endif\n\n            #ifdef " +
          this._defineCubicName +
          "\n                #ifdef " +
          this._defineLocalCubicName +
          "\n                    vec3 " +
          this._reflectionVectorName +
          " = computeCubicLocalCoords(" +
          t +
          ", " +
          e +
          ", " +
          s +
          ".xyz, " +
          n +
          ", vReflectionSize, vReflectionPosition);\n                #else\n                vec3 " +
          this._reflectionVectorName +
          " = computeCubicCoords(" +
          t +
          ", " +
          e +
          ", " +
          s +
          ".xyz, " +
          n +
          ");\n                #endif\n            #endif\n\n            #ifdef " +
          this._defineProjectionName +
          "\n                vec3 " +
          this._reflectionVectorName +
          " = computeProjectionCoords(" +
          t +
          ", " +
          a +
          ", " +
          n +
          ");\n            #endif\n\n            #ifdef " +
          this._defineSkyboxName +
          "\n                vec3 " +
          this._reflectionVectorName +
          " = computeSkyBoxCoords(" +
          o +
          ", " +
          n +
          ");\n            #endif\n\n            #ifdef " +
          this._defineExplicitName +
          "\n                vec3 " +
          this._reflectionVectorName +
          " = vec3(0, 0, 0);\n            #endif\n\n            #ifdef " +
          this._defineOppositeZ +
          "\n                " +
          this._reflectionVectorName +
          ".z *= -1.0;\n            #endif\r\n";
        return (
          i ||
            (l +=
              "\n                #ifdef " +
              this._define3DName +
              "\n                    vec3 " +
              this._reflectionCoordsName +
              " = " +
              this._reflectionVectorName +
              ";\n                #else\n                    vec2 " +
              this._reflectionCoordsName +
              " = " +
              this._reflectionVectorName +
              ".xy;\n                    #ifdef " +
              this._defineProjectionName +
              "\n                        " +
              this._reflectionCoordsName +
              " /= " +
              this._reflectionVectorName +
              ".z;\n                    #endif\n                    " +
              this._reflectionCoordsName +
              ".y = 1.0 - " +
              this._reflectionCoordsName +
              ".y;\n                #endif\r\n"),
          l
        );
      }),
      (t.prototype.handleFragmentSideCodeReflectionColor = function (e, t) {
        void 0 === t && (t = ".rgb");
        var i =
          "vec" +
          (0 === t.length ? "4" : t.length - 1) +
          " " +
          this._reflectionColorName +
          ";\n            #ifdef " +
          this._define3DName +
          "\r\n";
        return (
          (i += e
            ? this._reflectionColorName +
              " = textureCubeLodEXT(" +
              this._cubeSamplerName +
              ", " +
              this._reflectionVectorName +
              ", " +
              e +
              ")" +
              t +
              ";\r\n"
            : this._reflectionColorName +
              " = textureCube(" +
              this._cubeSamplerName +
              ", " +
              this._reflectionVectorName +
              ")" +
              t +
              ";\r\n"),
          (i += "\n            #else\r\n"),
          (i += e
            ? this._reflectionColorName +
              " = texture2DLodEXT(" +
              this._2DSamplerName +
              ", " +
              this._reflectionCoordsName +
              ", " +
              e +
              ")" +
              t +
              ";\r\n"
            : this._reflectionColorName +
              " = texture2D(" +
              this._2DSamplerName +
              ", " +
              this._reflectionCoordsName +
              ")" +
              t +
              ";\r\n") + "#endif\r\n"
        );
      }),
      (t.prototype.writeOutputs = function (e, t) {
        var i = "";
        if (e.target === Wl.Fragment)
          for (var n = 0, r = this._outputs; n < r.length; n++) {
            var o = r[n];
            o.hasEndpoints &&
              (i +=
                this._declareOutput(o, e) + " = " + t + "." + o.name + ";\r\n");
          }
        return i;
      }),
      (t.prototype._buildBlock = function (t) {
        return e.prototype._buildBlock.call(this, t), this;
      }),
      (t.prototype._dumpPropertiesCode = function () {
        return this.texture
          ? ((e = this.texture.isCube
              ? this._codeVariableName +
                '.texture = new BABYLON.CubeTexture("' +
                this.texture.name +
                '");\r\n'
              : this._codeVariableName +
                '.texture = new BABYLON.Texture("' +
                this.texture.name +
                '");\r\n'),
            (e +=
              this._codeVariableName +
              ".texture.coordinatesMode = " +
              this.texture.coordinatesMode +
              ";\r\n"))
          : "";
        var e;
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return this.texture && (t.texture = this.texture.serialize()), t;
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          t.texture &&
            ((n = 0 === t.texture.url.indexOf("data:") ? "" : n),
            t.texture.isCube
              ? (this.texture = Fs.Parse(t.texture, i, n))
              : (this.texture = mn.Parse(t.texture, i, n)));
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ReflectionTextureBaseBlock"] = Qc;
  var qc = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      return (
        i.registerInput("position", Hl.Vector3, !1, Wl.Vertex),
        i.registerInput("worldPosition", Hl.Vector4, !1, Wl.Vertex),
        i.registerInput("worldNormal", Hl.Vector4, !1, Wl.Fragment),
        i.registerInput("world", Hl.Matrix, !1, Wl.Vertex),
        i.registerInput("cameraPosition", Hl.Vector3, !1, Wl.Fragment),
        i.registerInput("view", Hl.Matrix, !1, Wl.Fragment),
        i.registerOutput("rgb", Hl.Color3, Wl.Fragment),
        i.registerOutput("rgba", Hl.Color4, Wl.Fragment),
        i.registerOutput("r", Hl.Float, Wl.Fragment),
        i.registerOutput("g", Hl.Float, Wl.Fragment),
        i.registerOutput("b", Hl.Float, Wl.Fragment),
        i.registerOutput("a", Hl.Float, Wl.Fragment),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector4),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ReflectionTextureBlock";
      }),
      Object.defineProperty(t.prototype, "position", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "worldPosition", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "worldNormal", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "world", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "cameraPosition", {
        get: function () {
          return this._inputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "view", {
        get: function () {
          return this._inputs[5];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rgb", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rgba", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "r", {
        get: function () {
          return this._outputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "g", {
        get: function () {
          return this._outputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "b", {
        get: function () {
          return this._outputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "a", {
        get: function () {
          return this._outputs[5];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.autoConfigure = function (t) {
        if (
          (e.prototype.autoConfigure.call(this, t),
          !this.cameraPosition.isConnected)
        ) {
          var i = t.getInputBlockByPredicate(function (e) {
            return e.systemValue === Xl.CameraPosition;
          });
          i ||
            (i = new lc("cameraPosition")).setAsSystemValue(Xl.CameraPosition),
            i.output.connectTo(this.cameraPosition);
        }
      }),
      (t.prototype._buildBlock = function (t) {
        if ((e.prototype._buildBlock.call(this, t), !this.texture))
          return (
            (t.compilationString += this.writeOutputs(t, "vec3(0.)")), this
          );
        if (t.target !== Wl.Fragment)
          return (t.compilationString += this.handleVertexSide(t)), this;
        this.handleFragmentSideInits(t);
        var i = t._getFreeVariableName("normalWUnit");
        return (
          (t.compilationString +=
            "vec4 " +
            i +
            " = normalize(" +
            this.worldNormal.associatedVariableName +
            ");\r\n"),
          (t.compilationString +=
            this.handleFragmentSideCodeReflectionCoords(i)),
          (t.compilationString += this.handleFragmentSideCodeReflectionColor(
            void 0,
            ""
          )),
          (t.compilationString += this.writeOutputs(
            t,
            this._reflectionColorName
          )),
          this
        );
      }),
      t
    );
  })(Qc);
  h.RegisteredTypes["BABYLON.ReflectionTextureBlock"] = qc;
  var Zc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("left", Hl.AutoDetect),
        i.registerInput("right", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._linkConnectionTypes(0, 1),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "AddBlock";
      }),
      Object.defineProperty(t.prototype, "left", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "right", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = " +
            this.left.associatedVariableName +
            " + " +
            this.right.associatedVariableName +
            ";\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.AddBlock"] = Zc;
  var Jc = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("input", Hl.AutoDetect),
        i.registerInput("factor", Hl.Float),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ScaleBlock";
      }),
      Object.defineProperty(t.prototype, "input", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "factor", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = " +
            this.input.associatedVariableName +
            " * " +
            this.factor.associatedVariableName +
            ";\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ScaleBlock"] = Jc;
  var $c = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        (i.minimum = 0),
        (i.maximum = 1),
        i.registerInput("value", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ClampBlock";
      }),
      Object.defineProperty(t.prototype, "value", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = clamp(" +
            this.value.associatedVariableName +
            ", " +
            this._writeFloat(this.minimum) +
            ", " +
            this._writeFloat(this.maximum) +
            ");\r\n"),
          this
        );
      }),
      (t.prototype._dumpPropertiesCode = function () {
        return (
          this._codeVariableName +
          ".minimum = " +
          this.minimum +
          ";\r\n" +
          (this._codeVariableName + ".maximum = ") +
          this.maximum +
          ";\r\n"
        );
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return (t.minimum = this.minimum), (t.maximum = this.maximum), t;
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          (this.minimum = t.minimum),
          (this.maximum = t.maximum);
      }),
      R([_c("Minimum", pc.Float)], t.prototype, "minimum", void 0),
      R([_c("Maximum", pc.Float)], t.prototype, "maximum", void 0),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ClampBlock"] = $c;
  var eu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("left", Hl.AutoDetect),
        i.registerInput("right", Hl.AutoDetect),
        i.registerOutput("output", Hl.Vector3),
        i._linkConnectionTypes(0, 1),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Float),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Matrix),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Vector2),
        i._inputs[1].excludedConnectionPointTypes.push(Hl.Float),
        i._inputs[1].excludedConnectionPointTypes.push(Hl.Matrix),
        i._inputs[1].excludedConnectionPointTypes.push(Hl.Vector2),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "CrossBlock";
      }),
      Object.defineProperty(t.prototype, "left", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "right", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = cross(" +
            this.left.associatedVariableName +
            ".xyz, " +
            this.right.associatedVariableName +
            ".xyz);\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.CrossBlock"] = eu;
  var tu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("left", Hl.AutoDetect),
        i.registerInput("right", Hl.AutoDetect),
        i.registerOutput("output", Hl.Float),
        i._linkConnectionTypes(0, 1),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Float),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Matrix),
        i._inputs[1].excludedConnectionPointTypes.push(Hl.Float),
        i._inputs[1].excludedConnectionPointTypes.push(Hl.Matrix),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "DotBlock";
      }),
      Object.defineProperty(t.prototype, "left", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "right", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = dot(" +
            this.left.associatedVariableName +
            ", " +
            this.right.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.DotBlock"] = tu;
  var iu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("input", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Float),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Matrix),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "NormalizeBlock";
      }),
      Object.defineProperty(t.prototype, "input", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0],
          n = this._inputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = normalize(" +
            n.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.NormalizeBlock"] = iu;
  var nu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("rgb ", Hl.Color3, !0),
        i.registerInput("r", Hl.Float, !0),
        i.registerInput("g", Hl.Float, !0),
        i.registerInput("b", Hl.Float, !0),
        i.registerInput("a", Hl.Float, !0),
        i.registerOutput("rgba", Hl.Color4),
        i.registerOutput("rgb", Hl.Color3),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ColorMergerBlock";
      }),
      Object.defineProperty(t.prototype, "rgbIn", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "r", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "g", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "b", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "a", {
        get: function () {
          return this._inputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rgba", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rgbOut", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rgb", {
        get: function () {
          return this.rgbOut;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this.r,
          n = this.g,
          r = this.b,
          o = this.a,
          s = this.rgbIn,
          a = this._outputs[0],
          l = this._outputs[1];
        return (
          s.isConnected
            ? a.hasEndpoints
              ? (t.compilationString +=
                  this._declareOutput(a, t) +
                  " = vec4(" +
                  s.associatedVariableName +
                  ", " +
                  (o.isConnected ? this._writeVariable(o) : "0.0") +
                  ");\r\n")
              : l.hasEndpoints &&
                (t.compilationString +=
                  this._declareOutput(l, t) +
                  " = " +
                  s.associatedVariableName +
                  ";\r\n")
            : a.hasEndpoints
              ? (t.compilationString +=
                  this._declareOutput(a, t) +
                  " = vec4(" +
                  (i.isConnected ? this._writeVariable(i) : "0.0") +
                  ", " +
                  (n.isConnected ? this._writeVariable(n) : "0.0") +
                  ", " +
                  (r.isConnected ? this._writeVariable(r) : "0.0") +
                  ", " +
                  (o.isConnected ? this._writeVariable(o) : "0.0") +
                  ");\r\n")
              : l.hasEndpoints &&
                (t.compilationString +=
                  this._declareOutput(l, t) +
                  " = vec3(" +
                  (i.isConnected ? this._writeVariable(i) : "0.0") +
                  ", " +
                  (n.isConnected ? this._writeVariable(n) : "0.0") +
                  ", " +
                  (r.isConnected ? this._writeVariable(r) : "0.0") +
                  ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ColorMergerBlock"] = nu;
  var ru = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("xyzw", Hl.Vector4, !0),
        i.registerInput("xyz ", Hl.Vector3, !0),
        i.registerInput("xy ", Hl.Vector2, !0),
        i.registerOutput("xyz", Hl.Vector3),
        i.registerOutput("xy", Hl.Vector2),
        i.registerOutput("x", Hl.Float),
        i.registerOutput("y", Hl.Float),
        i.registerOutput("z", Hl.Float),
        i.registerOutput("w", Hl.Float),
        (i.inputsAreExclusive = !0),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "VectorSplitterBlock";
      }),
      Object.defineProperty(t.prototype, "xyzw", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "xyzIn", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "xyIn", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "xyzOut", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "xyOut", {
        get: function () {
          return this._outputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "x", {
        get: function () {
          return this._outputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "y", {
        get: function () {
          return this._outputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "z", {
        get: function () {
          return this._outputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "w", {
        get: function () {
          return this._outputs[5];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._inputRename = function (e) {
        switch (e) {
          case "xy ":
            return "xyIn";
          case "xyz ":
            return "xyzIn";
          default:
            return e;
        }
      }),
      (t.prototype._outputRename = function (e) {
        switch (e) {
          case "xy":
            return "xyOut";
          case "xyz":
            return "xyzOut";
          default:
            return e;
        }
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this.xyzw.isConnected
            ? this.xyzw
            : this.xyzIn.isConnected
              ? this.xyzIn
              : this.xyIn,
          n = this._outputs[0],
          r = this._outputs[1],
          o = this._outputs[2],
          s = this._outputs[3],
          a = this._outputs[4],
          l = this._outputs[5];
        return (
          n.hasEndpoints &&
            (i === this.xyIn
              ? (t.compilationString +=
                  this._declareOutput(n, t) +
                  " = vec3(" +
                  i.associatedVariableName +
                  ", 0.0);\r\n")
              : (t.compilationString +=
                  this._declareOutput(n, t) +
                  " = " +
                  i.associatedVariableName +
                  ".xyz;\r\n")),
          r.hasEndpoints &&
            (t.compilationString +=
              this._declareOutput(r, t) +
              " = " +
              i.associatedVariableName +
              ".xy;\r\n"),
          o.hasEndpoints &&
            (t.compilationString +=
              this._declareOutput(o, t) +
              " = " +
              i.associatedVariableName +
              ".x;\r\n"),
          s.hasEndpoints &&
            (t.compilationString +=
              this._declareOutput(s, t) +
              " = " +
              i.associatedVariableName +
              ".y;\r\n"),
          a.hasEndpoints &&
            (t.compilationString +=
              this._declareOutput(a, t) +
              " = " +
              i.associatedVariableName +
              ".z;\r\n"),
          l.hasEndpoints &&
            (t.compilationString +=
              this._declareOutput(l, t) +
              " = " +
              i.associatedVariableName +
              ".w;\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.VectorSplitterBlock"] = ru;
  var ou = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("left", Hl.AutoDetect),
        i.registerInput("right", Hl.AutoDetect),
        i.registerInput("gradient", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._linkConnectionTypes(0, 1),
        i._linkConnectionTypes(1, 2, !0),
        i._inputs[2].acceptedConnectionPointTypes.push(Hl.Float),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "LerpBlock";
      }),
      Object.defineProperty(t.prototype, "left", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "right", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "gradient", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = mix(" +
            this.left.associatedVariableName +
            " , " +
            this.right.associatedVariableName +
            ", " +
            this.gradient.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.LerpBlock"] = ou;
  var su = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("left", Hl.AutoDetect),
        i.registerInput("right", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._linkConnectionTypes(0, 1),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "DivideBlock";
      }),
      Object.defineProperty(t.prototype, "left", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "right", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = " +
            this.left.associatedVariableName +
            " / " +
            this.right.associatedVariableName +
            ";\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.DivideBlock"] = su;
  var au = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("left", Hl.AutoDetect),
        i.registerInput("right", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._linkConnectionTypes(0, 1),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "SubtractBlock";
      }),
      Object.defineProperty(t.prototype, "left", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "right", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = " +
            this.left.associatedVariableName +
            " - " +
            this.right.associatedVariableName +
            ";\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.SubtractBlock"] = au;
  var lu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("value", Hl.Float),
        i.registerInput("edge", Hl.Float),
        i.registerOutput("output", Hl.Float),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "StepBlock";
      }),
      Object.defineProperty(t.prototype, "value", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "edge", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = step(" +
            this.edge.associatedVariableName +
            ", " +
            this.value.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.StepBlock"] = lu;
  var cu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("input", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._outputs[0].excludedConnectionPointTypes.push(Hl.Matrix),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "OneMinusBlock";
      }),
      Object.defineProperty(t.prototype, "input", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = 1. - " +
            this.input.associatedVariableName +
            ";\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  (h.RegisteredTypes["BABYLON.OneMinusBlock"] = cu),
    (h.RegisteredTypes["BABYLON.OppositeBlock"] = cu);
  var uu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("worldPosition", Hl.Vector4),
        i.registerInput("cameraPosition", Hl.Vector3),
        i.registerOutput("output", Hl.Vector3),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ViewDirectionBlock";
      }),
      Object.defineProperty(t.prototype, "worldPosition", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "cameraPosition", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.cameraPosition.isConnected) {
          var t = e.getInputBlockByPredicate(function (e) {
            return e.systemValue === Xl.CameraPosition;
          });
          t ||
            (t = new lc("cameraPosition")).setAsSystemValue(Xl.CameraPosition),
            t.output.connectTo(this.cameraPosition);
        }
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = normalize(" +
            this.cameraPosition.associatedVariableName +
            " - " +
            this.worldPosition.associatedVariableName +
            ".xyz);\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ViewDirectionBlock"] = uu;
  var hu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("worldNormal", Hl.Vector4),
        i.registerInput("viewDirection", Hl.Vector3),
        i.registerInput("bias", Hl.Float),
        i.registerInput("power", Hl.Float),
        i.registerOutput("fresnel", Hl.Float),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "FresnelBlock";
      }),
      Object.defineProperty(t.prototype, "worldNormal", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "viewDirection", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "bias", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "power", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "fresnel", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.viewDirection.isConnected) {
          var t = new uu("View direction");
          t.output.connectTo(this.viewDirection), t.autoConfigure(e);
        }
        if (!this.bias.isConnected) {
          var i = new lc("bias");
          (i.value = 0), i.output.connectTo(this.bias);
        }
        if (!this.power.isConnected) {
          var n = new lc("power");
          (n.value = 1), n.output.connectTo(this.power);
        }
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = "//" + this.name;
        return (
          t._emitFunctionFromInclude("fresnelFunction", i, {
            removeIfDef: !0,
          }),
          (t.compilationString +=
            this._declareOutput(this.fresnel, t) +
            " = computeFresnelTerm(" +
            this.viewDirection.associatedVariableName +
            ".xyz, " +
            this.worldNormal.associatedVariableName +
            ".xyz, " +
            this.bias.associatedVariableName +
            ", " +
            this.power.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.FresnelBlock"] = hu;
  var du = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("left", Hl.AutoDetect),
        i.registerInput("right", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._linkConnectionTypes(0, 1),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "MaxBlock";
      }),
      Object.defineProperty(t.prototype, "left", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "right", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = max(" +
            this.left.associatedVariableName +
            ", " +
            this.right.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.MaxBlock"] = du;
  var pu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("left", Hl.AutoDetect),
        i.registerInput("right", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._linkConnectionTypes(0, 1),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "MinBlock";
      }),
      Object.defineProperty(t.prototype, "left", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "right", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = min(" +
            this.left.associatedVariableName +
            ", " +
            this.right.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.MinBlock"] = pu;
  var fu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("left", Hl.AutoDetect),
        i.registerInput("right", Hl.AutoDetect),
        i.registerOutput("output", Hl.Float),
        i._linkConnectionTypes(0, 1),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Float),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Matrix),
        i._inputs[1].excludedConnectionPointTypes.push(Hl.Float),
        i._inputs[1].excludedConnectionPointTypes.push(Hl.Matrix),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "DistanceBlock";
      }),
      Object.defineProperty(t.prototype, "left", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "right", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = length(" +
            this.left.associatedVariableName +
            " - " +
            this.right.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.DistanceBlock"] = fu;
  var _u = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("value", Hl.AutoDetect),
        i.registerOutput("output", Hl.Float),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Float),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Matrix),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "LengthBlock";
      }),
      Object.defineProperty(t.prototype, "value", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = length(" +
            this.value.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.LengthBlock"] = _u;
  var mu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("value", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "NegateBlock";
      }),
      Object.defineProperty(t.prototype, "value", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = -1.0 * " +
            this.value.associatedVariableName +
            ";\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.NegateBlock"] = mu;
  var gu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("value", Hl.AutoDetect),
        i.registerInput("power", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._linkConnectionTypes(0, 1),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "PowBlock";
      }),
      Object.defineProperty(t.prototype, "value", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "power", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = pow(" +
            this.value.associatedVariableName +
            ", " +
            this.power.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.PowBlock"] = gu;
  var vu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("seed", Hl.Vector2),
        i.registerOutput("output", Hl.Float),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector3),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector4),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Color3),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Color4),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "RandomNumberBlock";
      }),
      Object.defineProperty(t.prototype, "seed", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0],
          n = "//" + this.name;
        return (
          t._emitFunctionFromInclude("helperFunctions", n),
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = getRand(" +
            this.seed.associatedVariableName +
            ".xy);\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.RandomNumberBlock"] = vu;
  var yu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("x", Hl.Float),
        i.registerInput("y", Hl.Float),
        i.registerOutput("output", Hl.Float),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ArcTan2Block";
      }),
      Object.defineProperty(t.prototype, "x", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "y", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = atan(" +
            this.x.associatedVariableName +
            ", " +
            this.y.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ArcTan2Block"] = yu;
  var bu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("value", Hl.AutoDetect),
        i.registerInput("edge0", Hl.Float),
        i.registerInput("edge1", Hl.Float),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "SmoothStepBlock";
      }),
      Object.defineProperty(t.prototype, "value", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "edge0", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "edge1", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = smoothstep(" +
            this.edge0.associatedVariableName +
            ", " +
            this.edge1.associatedVariableName +
            ", " +
            this.value.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.SmoothStepBlock"] = bu;
  var Tu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("input", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._outputs[0].excludedConnectionPointTypes.push(Hl.Matrix),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ReciprocalBlock";
      }),
      Object.defineProperty(t.prototype, "input", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = 1. / " +
            this.input.associatedVariableName +
            ";\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ReciprocalBlock"] = Tu;
  var Su = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("value", Hl.AutoDetect),
        i.registerInput("reference", Hl.AutoDetect),
        i.registerInput("distance", Hl.Float),
        i.registerInput("replacement", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._linkConnectionTypes(0, 1),
        i._linkConnectionTypes(0, 3),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Float),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Matrix),
        i._inputs[1].excludedConnectionPointTypes.push(Hl.Float),
        i._inputs[1].excludedConnectionPointTypes.push(Hl.Matrix),
        i._inputs[3].excludedConnectionPointTypes.push(Hl.Float),
        i._inputs[3].excludedConnectionPointTypes.push(Hl.Matrix),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ReplaceColorBlock";
      }),
      Object.defineProperty(t.prototype, "value", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "reference", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "distance", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "replacement", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString += this._declareOutput(i, t) + ";\r\n"),
          (t.compilationString +=
            "if (length(" +
            this.value.associatedVariableName +
            " - " +
            this.reference.associatedVariableName +
            ") < " +
            this.distance.associatedVariableName +
            ") {\r\n"),
          (t.compilationString +=
            i.associatedVariableName +
            " = " +
            this.replacement.associatedVariableName +
            ";\r\n"),
          (t.compilationString += "} else {\r\n"),
          (t.compilationString +=
            i.associatedVariableName +
            " = " +
            this.value.associatedVariableName +
            ";\r\n"),
          (t.compilationString += "}\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ReplaceColorBlock"] = Su;
  var Cu,
    xu = (function (e) {
      function t(t) {
        var i = e.call(this, t, Wl.Neutral) || this;
        return (
          i.registerInput("value", Hl.AutoDetect),
          i.registerInput("steps", Hl.AutoDetect),
          i.registerOutput("output", Hl.BasedOnInput),
          (i._outputs[0]._typeConnectionSource = i._inputs[0]),
          i._linkConnectionTypes(0, 1),
          i._inputs[0].excludedConnectionPointTypes.push(Hl.Matrix),
          i._inputs[1].excludedConnectionPointTypes.push(Hl.Matrix),
          i
        );
      }
      return (
        P(t, e),
        (t.prototype.getClassName = function () {
          return "PosterizeBlock";
        }),
        Object.defineProperty(t.prototype, "value", {
          get: function () {
            return this._inputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "steps", {
          get: function () {
            return this._inputs[1];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "output", {
          get: function () {
            return this._outputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._buildBlock = function (t) {
          e.prototype._buildBlock.call(this, t);
          var i = this._outputs[0];
          return (
            (t.compilationString +=
              this._declareOutput(i, t) +
              " = floor(" +
              this.value.associatedVariableName +
              " / (1.0 / " +
              this.steps.associatedVariableName +
              ")) * (1.0 / " +
              this.steps.associatedVariableName +
              ");\r\n"),
            this
          );
        }),
        t
      );
    })(Jl);
  (h.RegisteredTypes["BABYLON.PosterizeBlock"] = xu),
    (function (e) {
      (e[(e.SawTooth = 0)] = "SawTooth"),
        (e[(e.Square = 1)] = "Square"),
        (e[(e.Triangle = 2)] = "Triangle");
    })(Cu || (Cu = {}));
  var Eu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        (i.kind = Cu.SawTooth),
        i.registerInput("input", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._inputs[0].excludedConnectionPointTypes.push(Hl.Matrix),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "WaveBlock";
      }),
      Object.defineProperty(t.prototype, "input", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        switch (this.kind) {
          case Cu.SawTooth:
            t.compilationString +=
              this._declareOutput(i, t) +
              " = " +
              this.input.associatedVariableName +
              " - floor(0.5 + " +
              this.input.associatedVariableName +
              ");\r\n";
            break;
          case Cu.Square:
            t.compilationString +=
              this._declareOutput(i, t) +
              " = 1.0 - 2.0 * round(fract(" +
              this.input.associatedVariableName +
              "));\r\n";
            break;
          case Cu.Triangle:
            t.compilationString +=
              this._declareOutput(i, t) +
              " = 2.0 * abs(2.0 * (" +
              this.input.associatedVariableName +
              " - floor(0.5 + " +
              this.input.associatedVariableName +
              "))) - 1.0;\r\n";
        }
        return this;
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return (t.kind = this.kind), t;
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n), (this.kind = t.kind);
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.WaveBlock"] = Eu;
  var Pu = (function () {
      function e(e, t) {
        (this.step = e), (this.color = t);
      }
      return (
        Object.defineProperty(e.prototype, "step", {
          get: function () {
            return this._step;
          },
          set: function (e) {
            this._step = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "color", {
          get: function () {
            return this._color;
          },
          set: function (e) {
            this._color = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        e
      );
    })(),
    Au = (function (e) {
      function t(t) {
        var i = e.call(this, t, Wl.Neutral) || this;
        return (
          (i.colorSteps = [new Pu(0, b.Black()), new Pu(1, b.White())]),
          (i.onValueChangedObservable = new o()),
          i.registerInput("gradient", Hl.Float),
          i.registerOutput("output", Hl.Color3),
          i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector2),
          i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector3),
          i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector4),
          i._inputs[0].acceptedConnectionPointTypes.push(Hl.Color3),
          i._inputs[0].acceptedConnectionPointTypes.push(Hl.Color4),
          i
        );
      }
      return (
        P(t, e),
        (t.prototype.colorStepsUpdated = function () {
          this.onValueChangedObservable.notifyObservers(this);
        }),
        (t.prototype.getClassName = function () {
          return "GradientBlock";
        }),
        Object.defineProperty(t.prototype, "gradient", {
          get: function () {
            return this._inputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "output", {
          get: function () {
            return this._outputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._writeColorConstant = function (e) {
          var t = this.colorSteps[e];
          return (
            "vec3(" + t.color.r + ", " + t.color.g + ", " + t.color.b + ")"
          );
        }),
        (t.prototype._buildBlock = function (t) {
          e.prototype._buildBlock.call(this, t);
          var i = this._outputs[0];
          if (this.colorSteps.length && this.gradient.connectedPoint) {
            var n = t._getFreeVariableName("gradientTempColor"),
              r = t._getFreeVariableName("gradientTempPosition");
            (t.compilationString +=
              "vec3 " + n + " = " + this._writeColorConstant(0) + ";\r\n"),
              (t.compilationString += "float " + r + ";\r\n");
            var o = this.gradient.associatedVariableName;
            this.gradient.connectedPoint.type !== Hl.Float && (o += ".x");
            for (var s = 1; s < this.colorSteps.length; s++) {
              var a = this.colorSteps[s],
                l = this.colorSteps[s - 1];
              (t.compilationString +=
                r +
                " = clamp((" +
                o +
                " - " +
                t._emitFloat(l.step) +
                ") / (" +
                t._emitFloat(a.step) +
                " -  " +
                t._emitFloat(l.step) +
                "), 0.0, 1.0) * step(" +
                t._emitFloat(s) +
                ", " +
                t._emitFloat(this.colorSteps.length - 1) +
                ");\r\n"),
                (t.compilationString +=
                  n +
                  " = mix(" +
                  n +
                  ", " +
                  this._writeColorConstant(s) +
                  ", " +
                  r +
                  ");\r\n");
            }
            return (
              (t.compilationString +=
                this._declareOutput(i, t) + " = " + n + ";\r\n"),
              this
            );
          }
          t.compilationString +=
            this._declareOutput(i, t) + " = vec3(0., 0., 0.);\r\n";
        }),
        (t.prototype.serialize = function () {
          var t = e.prototype.serialize.call(this);
          t.colorSteps = [];
          for (var i = 0, n = this.colorSteps; i < n.length; i++) {
            var r = n[i];
            t.colorSteps.push({
              step: r.step,
              color: {
                r: r.color.r,
                g: r.color.g,
                b: r.color.b,
              },
            });
          }
          return t;
        }),
        (t.prototype._deserialize = function (t, i, n) {
          e.prototype._deserialize.call(this, t, i, n), (this.colorSteps = []);
          for (var r = 0, o = t.colorSteps; r < o.length; r++) {
            var s = o[r];
            this.colorSteps.push(
              new Pu(s.step, new b(s.color.r, s.color.g, s.color.b))
            );
          }
        }),
        (t.prototype._dumpPropertiesCode = function () {
          for (var e = "", t = 0, i = this.colorSteps; t < i.length; t++) {
            var n = i[t];
            e +=
              this._codeVariableName +
              ".colorSteps.push(new BABYLON.GradientBlockColorStep(" +
              n.step +
              ", new BABYLON.Color3(" +
              n.color.r +
              ", " +
              n.color.g +
              ", " +
              n.color.b +
              ")));\r\n";
          }
          return e;
        }),
        t
      );
    })(Jl);
  h.RegisteredTypes["BABYLON.GradientBlock"] = Au;
  var Ru = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("left", Hl.AutoDetect),
        i.registerInput("right", Hl.AutoDetect),
        i.registerInput("gradient", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._linkConnectionTypes(0, 1),
        i._linkConnectionTypes(1, 2, !0),
        i._inputs[2].acceptedConnectionPointTypes.push(Hl.Float),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "NLerpBlock";
      }),
      Object.defineProperty(t.prototype, "left", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "right", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "gradient", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = normalize(mix(" +
            this.left.associatedVariableName +
            " , " +
            this.right.associatedVariableName +
            ", " +
            this.gradient.associatedVariableName +
            "));\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.NLerpBlock"] = Ru;
  var Mu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        (i.manhattanDistance = !1),
        i.registerInput("seed", Hl.Vector3),
        i.registerInput("jitter", Hl.Float),
        i.registerOutput("output", Hl.Vector2),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "WorleyNoise3DBlock";
      }),
      Object.defineProperty(t.prototype, "seed", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "jitter", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        if (
          (e.prototype._buildBlock.call(this, t),
          this.seed.isConnected && this._outputs[0].hasEndpoints)
        )
          return (
            t._emitFunction(
              "worley3D",
              "vec3 permute(vec3 x){\r\n    return mod((34.0 * x + 1.0) * x, 289.0);\r\n}\r\n\r\nvec3 dist(vec3 x, vec3 y, vec3 z,  bool manhattanDistance){\r\n    return manhattanDistance ?  abs(x) + abs(y) + abs(z) :  (x * x + y * y + z * z);\r\n}\r\n\r\nvec2 worley(vec3 P, float jitter, bool manhattanDistance){\r\n    float K = 0.142857142857; // 1/7\r\n    float Ko = 0.428571428571; // 1/2-K/2\r\n    float  K2 = 0.020408163265306; // 1/(7*7)\r\n    float Kz = 0.166666666667; // 1/6\r\n    float Kzo = 0.416666666667; // 1/2-1/6*2\r\n\r\n    vec3 Pi = mod(floor(P), 289.0);\r\n    vec3 Pf = fract(P) - 0.5;\r\n\r\n    vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);\r\n    vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);\r\n    vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);\r\n\r\n    vec3 p = permute(Pi.x + vec3(-1.0, 0.0, 1.0));\r\n    vec3 p1 = permute(p + Pi.y - 1.0);\r\n    vec3 p2 = permute(p + Pi.y);\r\n    vec3 p3 = permute(p + Pi.y + 1.0);\r\n\r\n    vec3 p11 = permute(p1 + Pi.z - 1.0);\r\n    vec3 p12 = permute(p1 + Pi.z);\r\n    vec3 p13 = permute(p1 + Pi.z + 1.0);\r\n\r\n    vec3 p21 = permute(p2 + Pi.z - 1.0);\r\n    vec3 p22 = permute(p2 + Pi.z);\r\n    vec3 p23 = permute(p2 + Pi.z + 1.0);\r\n\r\n    vec3 p31 = permute(p3 + Pi.z - 1.0);\r\n    vec3 p32 = permute(p3 + Pi.z);\r\n    vec3 p33 = permute(p3 + Pi.z + 1.0);\r\n\r\n    vec3 ox11 = fract(p11*K) - Ko;\r\n    vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;\r\n    vec3 oz11 = floor(p11*K2)*Kz - Kzo; // p11 < 289 guaranteed\r\n\r\n    vec3 ox12 = fract(p12*K) - Ko;\r\n    vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;\r\n    vec3 oz12 = floor(p12*K2)*Kz - Kzo;\r\n\r\n    vec3 ox13 = fract(p13*K) - Ko;\r\n    vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;\r\n    vec3 oz13 = floor(p13*K2)*Kz - Kzo;\r\n\r\n    vec3 ox21 = fract(p21*K) - Ko;\r\n    vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;\r\n    vec3 oz21 = floor(p21*K2)*Kz - Kzo;\r\n\r\n    vec3 ox22 = fract(p22*K) - Ko;\r\n    vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;\r\n    vec3 oz22 = floor(p22*K2)*Kz - Kzo;\r\n\r\n    vec3 ox23 = fract(p23*K) - Ko;\r\n    vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;\r\n    vec3 oz23 = floor(p23*K2)*Kz - Kzo;\r\n\r\n    vec3 ox31 = fract(p31*K) - Ko;\r\n    vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;\r\n    vec3 oz31 = floor(p31*K2)*Kz - Kzo;\r\n\r\n    vec3 ox32 = fract(p32*K) - Ko;\r\n    vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;\r\n    vec3 oz32 = floor(p32*K2)*Kz - Kzo;\r\n\r\n    vec3 ox33 = fract(p33*K) - Ko;\r\n    vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;\r\n    vec3 oz33 = floor(p33*K2)*Kz - Kzo;\r\n\r\n    vec3 dx11 = Pfx + jitter*ox11;\r\n    vec3 dy11 = Pfy.x + jitter*oy11;\r\n    vec3 dz11 = Pfz.x + jitter*oz11;\r\n\r\n    vec3 dx12 = Pfx + jitter*ox12;\r\n    vec3 dy12 = Pfy.x + jitter*oy12;\r\n    vec3 dz12 = Pfz.y + jitter*oz12;\r\n\r\n    vec3 dx13 = Pfx + jitter*ox13;\r\n    vec3 dy13 = Pfy.x + jitter*oy13;\r\n    vec3 dz13 = Pfz.z + jitter*oz13;\r\n\r\n    vec3 dx21 = Pfx + jitter*ox21;\r\n    vec3 dy21 = Pfy.y + jitter*oy21;\r\n    vec3 dz21 = Pfz.x + jitter*oz21;\r\n\r\n    vec3 dx22 = Pfx + jitter*ox22;\r\n    vec3 dy22 = Pfy.y + jitter*oy22;\r\n    vec3 dz22 = Pfz.y + jitter*oz22;\r\n\r\n    vec3 dx23 = Pfx + jitter*ox23;\r\n    vec3 dy23 = Pfy.y + jitter*oy23;\r\n    vec3 dz23 = Pfz.z + jitter*oz23;\r\n\r\n    vec3 dx31 = Pfx + jitter*ox31;\r\n    vec3 dy31 = Pfy.z + jitter*oy31;\r\n    vec3 dz31 = Pfz.x + jitter*oz31;\r\n\r\n    vec3 dx32 = Pfx + jitter*ox32;\r\n    vec3 dy32 = Pfy.z + jitter*oy32;\r\n    vec3 dz32 = Pfz.y + jitter*oz32;\r\n\r\n    vec3 dx33 = Pfx + jitter*ox33;\r\n    vec3 dy33 = Pfy.z + jitter*oy33;\r\n    vec3 dz33 = Pfz.z + jitter*oz33;\r\n\r\n    vec3 d11 = dist(dx11, dy11, dz11, manhattanDistance);\r\n    vec3 d12 =dist(dx12, dy12, dz12, manhattanDistance);\r\n    vec3 d13 = dist(dx13, dy13, dz13, manhattanDistance);\r\n    vec3 d21 = dist(dx21, dy21, dz21, manhattanDistance);\r\n    vec3 d22 = dist(dx22, dy22, dz22, manhattanDistance);\r\n    vec3 d23 = dist(dx23, dy23, dz23, manhattanDistance);\r\n    vec3 d31 = dist(dx31, dy31, dz31, manhattanDistance);\r\n    vec3 d32 = dist(dx32, dy32, dz32, manhattanDistance);\r\n    vec3 d33 = dist(dx33, dy33, dz33, manhattanDistance);\r\n\r\n    vec3 d1a = min(d11, d12);\r\n    d12 = max(d11, d12);\r\n    d11 = min(d1a, d13); // Smallest now not in d12 or d13\r\n    d13 = max(d1a, d13);\r\n    d12 = min(d12, d13); // 2nd smallest now not in d13\r\n    vec3 d2a = min(d21, d22);\r\n    d22 = max(d21, d22);\r\n    d21 = min(d2a, d23); // Smallest now not in d22 or d23\r\n    d23 = max(d2a, d23);\r\n    d22 = min(d22, d23); // 2nd smallest now not in d23\r\n    vec3 d3a = min(d31, d32);\r\n    d32 = max(d31, d32);\r\n    d31 = min(d3a, d33); // Smallest now not in d32 or d33\r\n    d33 = max(d3a, d33);\r\n    d32 = min(d32, d33); // 2nd smallest now not in d33\r\n    vec3 da = min(d11, d21);\r\n    d21 = max(d11, d21);\r\n    d11 = min(da, d31); // Smallest now in d11\r\n    d31 = max(da, d31); // 2nd smallest now not in d31\r\n    d11.xy = (d11.x < d11.y) ? d11.xy : d11.yx;\r\n    d11.xz = (d11.x < d11.z) ? d11.xz : d11.zx; // d11.x now smallest\r\n    d12 = min(d12, d21); // 2nd smallest now not in d21\r\n    d12 = min(d12, d22); // nor in d22\r\n    d12 = min(d12, d31); // nor in d31\r\n    d12 = min(d12, d32); // nor in d32\r\n    d11.yz = min(d11.yz,d12.xy); // nor in d12.yz\r\n    d11.y = min(d11.y,d12.z); // Only two more to go\r\n    d11.y = min(d11.y,d11.z); // Done! (Phew!)\r\n    return sqrt(d11.xy); // F1, F2\r\n}\r\n\r\n",
              "// Worley3D"
            ),
            (t.compilationString +=
              this._declareOutput(this._outputs[0], t) +
              " = worley(" +
              this.seed.associatedVariableName +
              ", " +
              this.jitter.associatedVariableName +
              ", " +
              this.manhattanDistance +
              ");\r\n"),
            this
          );
      }),
      (t.prototype._dumpPropertiesCode = function () {
        return (
          this._codeVariableName +
          ".manhattanDistance = " +
          this.manhattanDistance +
          ";\r\n"
        );
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return (t.manhattanDistance = this.manhattanDistance), t;
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          (this.manhattanDistance = t.manhattanDistance);
      }),
      R(
        [
          _c("Use Manhattan Distance", pc.Boolean, "PROPERTIES", {
            notifiers: {
              update: !1,
            },
          }),
        ],
        t.prototype,
        "manhattanDistance",
        void 0
      ),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.WorleyNoise3DBlock"] = Mu;
  var Ou = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("seed", Hl.Vector3),
        i.registerOutput("output", Hl.Float),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "SimplexPerlin3DBlock";
      }),
      Object.defineProperty(t.prototype, "seed", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        if (
          (e.prototype._buildBlock.call(this, t),
          this.seed.isConnected && this._outputs[0].hasEndpoints)
        )
          return (
            t._emitFunction(
              "SimplexPerlin3D",
              "const float SKEWFACTOR = 1.0/3.0;\r\nconst float UNSKEWFACTOR = 1.0/6.0;\r\nconst float SIMPLEX_CORNER_POS = 0.5;\r\nconst float SIMPLEX_TETRAHADRON_HEIGHT = 0.70710678118654752440084436210485;\r\nfloat SimplexPerlin3D( vec3 P ){\r\n    P *= SIMPLEX_TETRAHADRON_HEIGHT;\r\n    vec3 Pi = floor( P + dot( P, vec3( SKEWFACTOR) ) );    vec3 x0 = P - Pi + dot(Pi, vec3( UNSKEWFACTOR ) );\r\n    vec3 g = step(x0.yzx, x0.xyz);\r\n    vec3 l = 1.0 - g;\r\n    vec3 Pi_1 = min( g.xyz, l.zxy );\r\n    vec3 Pi_2 = max( g.xyz, l.zxy );\r\n    vec3 x1 = x0 - Pi_1 + UNSKEWFACTOR;\r\n    vec3 x2 = x0 - Pi_2 + SKEWFACTOR;\r\n    vec3 x3 = x0 - SIMPLEX_CORNER_POS;\r\n    vec4 v1234_x = vec4( x0.x, x1.x, x2.x, x3.x );\r\n    vec4 v1234_y = vec4( x0.y, x1.y, x2.y, x3.y );\r\n    vec4 v1234_z = vec4( x0.z, x1.z, x2.z, x3.z );\r\n    Pi.xyz = Pi.xyz - floor(Pi.xyz * ( 1.0 / 69.0 )) * 69.0;\r\n    vec3 Pi_inc1 = step( Pi, vec3( 69.0 - 1.5 ) ) * ( Pi + 1.0 );\r\n    vec4 Pt = vec4( Pi.xy, Pi_inc1.xy ) + vec2( 50.0, 161.0 ).xyxy;\r\n    Pt *= Pt;\r\n    vec4 V1xy_V2xy = mix( Pt.xyxy, Pt.zwzw, vec4( Pi_1.xy, Pi_2.xy ) );\r\n    Pt = vec4( Pt.x, V1xy_V2xy.xz, Pt.z ) * vec4( Pt.y, V1xy_V2xy.yw, Pt.w );\r\n    const vec3 SOMELARGEFLOATS = vec3( 635.298681, 682.357502, 668.926525 );\r\n    const vec3 ZINC = vec3( 48.500388, 65.294118, 63.934599 );\r\n    vec3 lowz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi.zzz * ZINC.xyz ) );\r\n    vec3 highz_mods = vec3( 1.0 / ( SOMELARGEFLOATS.xyz + Pi_inc1.zzz * ZINC.xyz ) );\r\n    Pi_1 = ( Pi_1.z < 0.5 ) ? lowz_mods : highz_mods;\r\n    Pi_2 = ( Pi_2.z < 0.5 ) ? lowz_mods : highz_mods;\r\n    vec4 hash_0 = fract( Pt * vec4( lowz_mods.x, Pi_1.x, Pi_2.x, highz_mods.x ) ) - 0.49999;\r\n    vec4 hash_1 = fract( Pt * vec4( lowz_mods.y, Pi_1.y, Pi_2.y, highz_mods.y ) ) - 0.49999;\r\n    vec4 hash_2 = fract( Pt * vec4( lowz_mods.z, Pi_1.z, Pi_2.z, highz_mods.z ) ) - 0.49999;\r\n    vec4 grad_results = inversesqrt( hash_0 * hash_0 + hash_1 * hash_1 + hash_2 * hash_2 ) * ( hash_0 * v1234_x + hash_1 * v1234_y + hash_2 * v1234_z );\r\n    const float FINAL_NORMALIZATION = 37.837227241611314102871574478976;\r\n    vec4 kernel_weights = v1234_x * v1234_x + v1234_y * v1234_y + v1234_z * v1234_z;\r\n    kernel_weights = max(0.5 - kernel_weights, 0.0);\r\n    kernel_weights = kernel_weights*kernel_weights*kernel_weights;\r\n    return dot( kernel_weights, grad_results ) * FINAL_NORMALIZATION;\r\n}\r\n",
              "// SimplexPerlin3D"
            ),
            (t.compilationString +=
              this._declareOutput(this._outputs[0], t) +
              " = SimplexPerlin3D(" +
              this.seed.associatedVariableName +
              ");\r\n"),
            this
          );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.SimplexPerlin3DBlock"] = Ou;
  var Iu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("normalMap0", Hl.Vector3),
        i.registerInput("normalMap1", Hl.Vector3),
        i.registerOutput("output", Hl.Vector3),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Color3),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Color4),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector4),
        i._inputs[1].acceptedConnectionPointTypes.push(Hl.Color3),
        i._inputs[1].acceptedConnectionPointTypes.push(Hl.Color4),
        i._inputs[1].acceptedConnectionPointTypes.push(Hl.Vector4),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "NormalBlendBlock";
      }),
      Object.defineProperty(t.prototype, "normalMap0", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "normalMap1", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0],
          n = this._inputs[0],
          r = this._inputs[1],
          o = t._getFreeVariableName("stepR"),
          s = t._getFreeVariableName("stepG");
        return (
          (t.compilationString +=
            "float " +
            o +
            " = step(0.5, " +
            n.associatedVariableName +
            ".r);\r\n"),
          (t.compilationString +=
            "float " +
            s +
            " = step(0.5, " +
            n.associatedVariableName +
            ".g);\r\n"),
          (t.compilationString += this._declareOutput(i, t) + ";\r\n"),
          (t.compilationString +=
            i.associatedVariableName +
            ".r = (1.0 - " +
            o +
            ") * " +
            n.associatedVariableName +
            ".r * " +
            r.associatedVariableName +
            ".r * 2.0 + " +
            o +
            " * (1.0 - " +
            n.associatedVariableName +
            ".r) * (1.0 - " +
            r.associatedVariableName +
            ".r) * 2.0;\r\n"),
          (t.compilationString +=
            i.associatedVariableName +
            ".g = (1.0 - " +
            s +
            ") * " +
            n.associatedVariableName +
            ".g * " +
            r.associatedVariableName +
            ".g * 2.0 + " +
            s +
            " * (1.0 - " +
            n.associatedVariableName +
            ".g) * (1.0 - " +
            r.associatedVariableName +
            ".g) * 2.0;\r\n"),
          (t.compilationString +=
            i.associatedVariableName +
            ".b = " +
            n.associatedVariableName +
            ".b * " +
            r.associatedVariableName +
            ".b;\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.NormalBlendBlock"] = Iu;
  var Du = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("input", Hl.Vector2),
        i.registerInput("angle", Hl.Float),
        i.registerOutput("output", Hl.Vector2),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "Rotate2dBlock";
      }),
      Object.defineProperty(t.prototype, "input", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "angle", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.angle.isConnected) {
          var t = new lc("angle");
          (t.value = 0), t.output.connectTo(this.angle);
        }
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0],
          n = this.angle,
          r = this.input;
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = vec2(cos(" +
            n.associatedVariableName +
            ") * " +
            r.associatedVariableName +
            ".x - sin(" +
            n.associatedVariableName +
            ") * " +
            r.associatedVariableName +
            ".y, sin(" +
            n.associatedVariableName +
            ") * " +
            r.associatedVariableName +
            ".x + cos(" +
            n.associatedVariableName +
            ") * " +
            r.associatedVariableName +
            ".y);\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.Rotate2dBlock"] = Du;
  var wu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("incident", Hl.Vector3),
        i.registerInput("normal", Hl.Vector3),
        i.registerOutput("output", Hl.Vector3),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector4),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Color3),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Color4),
        i._inputs[1].acceptedConnectionPointTypes.push(Hl.Vector4),
        i._inputs[1].acceptedConnectionPointTypes.push(Hl.Color3),
        i._inputs[1].acceptedConnectionPointTypes.push(Hl.Color4),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ReflectBlock";
      }),
      Object.defineProperty(t.prototype, "incident", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "normal", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = reflect(" +
            this.incident.associatedVariableName +
            ".xyz, " +
            this.normal.associatedVariableName +
            ".xyz);\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ReflectBlock"] = wu;
  var Nu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("incident", Hl.Vector3),
        i.registerInput("normal", Hl.Vector3),
        i.registerInput("ior", Hl.Float),
        i.registerOutput("output", Hl.Vector3),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Vector4),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Color3),
        i._inputs[0].acceptedConnectionPointTypes.push(Hl.Color4),
        i._inputs[1].acceptedConnectionPointTypes.push(Hl.Vector4),
        i._inputs[1].acceptedConnectionPointTypes.push(Hl.Color3),
        i._inputs[1].acceptedConnectionPointTypes.push(Hl.Color4),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "RefractBlock";
      }),
      Object.defineProperty(t.prototype, "incident", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "normal", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "ior", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = refract(" +
            this.incident.associatedVariableName +
            ".xyz, " +
            this.normal.associatedVariableName +
            ".xyz, " +
            this.ior.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.RefractBlock"] = Nu;
  var Lu = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("color", Hl.Color3),
        i.registerInput("level", Hl.Float),
        i.registerOutput("output", Hl.Color3),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "DesaturateBlock";
      }),
      Object.defineProperty(t.prototype, "color", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "level", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0],
          n = this.color.associatedVariableName,
          r = t._getFreeVariableName("colorMin"),
          o = t._getFreeVariableName("colorMax"),
          s = t._getFreeVariableName("colorMerge");
        return (
          (t.compilationString +=
            "float " +
            r +
            " = min(min(" +
            n +
            ".x, " +
            n +
            ".y), " +
            n +
            ".z);\r\n"),
          (t.compilationString +=
            "float " +
            o +
            " = max(max(" +
            n +
            ".x, " +
            n +
            ".y), " +
            n +
            ".z);\r\n"),
          (t.compilationString +=
            "float " + s + " = 0.5 * (" + r + " + " + o + ");\r\n"),
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = mix(" +
            n +
            ", vec3(" +
            s +
            ", " +
            s +
            ", " +
            s +
            "), " +
            this.level.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.DesaturateBlock"] = Lu;
  var Fu = (function (e) {
      function t(t, i, n, r, o, s) {
        var a = e.call(this, t, i, n) || this;
        return (
          (a._blockType = r),
          (a._blockName = o),
          (a._nameForCheking = s),
          a._nameForCheking || (a._nameForCheking = t),
          (a.needDualDirectionValidation = !0),
          a
        );
      }
      return (
        P(t, e),
        (t.prototype.checkCompatibilityState = function (e) {
          return e instanceof t && e.name === this._nameForCheking
            ? Kl.Compatible
            : Kl.TypeIncompatible;
        }),
        (t.prototype.createCustomInputBlock = function () {
          return [new this._blockType(this._blockName), this.name];
        }),
        t
      );
    })(Zl),
    Bu = (function (e) {
      function t(i) {
        var n = e.call(this, i, Wl.Fragment) || this;
        return (
          (n.albedoScaling = !1),
          (n.linkSheenWithAlbedo = !1),
          (n._isUnique = !0),
          n.registerInput("intensity", Hl.Float, !0, Wl.Fragment),
          n.registerInput("color", Hl.Color3, !0, Wl.Fragment),
          n.registerInput("roughness", Hl.Float, !0, Wl.Fragment),
          n.registerOutput(
            "sheen",
            Hl.Object,
            Wl.Fragment,
            new Fu("sheen", n, Ql.Output, t, "SheenBlock")
          ),
          n
        );
      }
      return (
        P(t, e),
        (t.prototype.initialize = function (e) {
          e._excludeVariableName("sheenOut"),
            e._excludeVariableName("sheenMapData"),
            e._excludeVariableName("vSheenColor"),
            e._excludeVariableName("vSheenRoughness");
        }),
        (t.prototype.getClassName = function () {
          return "SheenBlock";
        }),
        Object.defineProperty(t.prototype, "intensity", {
          get: function () {
            return this._inputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "color", {
          get: function () {
            return this._inputs[1];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "roughness", {
          get: function () {
            return this._inputs[2];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "sheen", {
          get: function () {
            return this._outputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.prepareDefines = function (t, i, n) {
          e.prototype.prepareDefines.call(this, t, i, n),
            n.setValue("SHEEN", !0),
            n.setValue("SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE", !0, !0),
            n.setValue("SHEEN_LINKWITHALBEDO", this.linkSheenWithAlbedo, !0),
            n.setValue("SHEEN_ROUGHNESS", this.roughness.isConnected, !0),
            n.setValue("SHEEN_ALBEDOSCALING", this.albedoScaling, !0);
        }),
        (t.prototype.getCode = function (e) {
          return (
            "#ifdef SHEEN\n            sheenOutParams sheenOut;\n\n            vec4 vSheenColor = vec4(" +
            (this.color.isConnected
              ? this.color.associatedVariableName
              : "vec3(1.)") +
            ", " +
            (this.intensity.isConnected
              ? this.intensity.associatedVariableName
              : "1.") +
            ");\n\n            sheenBlock(\n                vSheenColor,\n            #ifdef SHEEN_ROUGHNESS\n                " +
            (this.roughness.isConnected
              ? this.roughness.associatedVariableName
              : "0.") +
            ",\n            #endif\n                roughness,\n            #ifdef SHEEN_TEXTURE\n                vec4(0.),\n            #endif\n                reflectance,\n            #ifdef SHEEN_LINKWITHALBEDO\n                baseColor,\n                surfaceAlbedo,\n            #endif\n            #ifdef ENVIRONMENTBRDF\n                NdotV,\n                environmentBrdf,\n            #endif\n            #if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\n                AARoughnessFactors,\n                " +
            (null == e ? void 0 : e._vReflectionMicrosurfaceInfosName) +
            ",\n                " +
            (null == e ? void 0 : e._vReflectionInfosName) +
            ",\n                " +
            (null == e ? void 0 : e.reflectionColor) +
            ",\n                vLightingIntensity,\n                #ifdef " +
            (null == e ? void 0 : e._define3DName) +
            "\n                    " +
            (null == e ? void 0 : e._cubeSamplerName) +
            ",\n                #else\n                    " +
            (null == e ? void 0 : e._2DSamplerName) +
            ",\n                #endif\n                reflectionOut.reflectionCoords,\n                NdotVUnclamped,\n                #ifndef LODBASEDMICROSFURACE\n                    #ifdef " +
            (null == e ? void 0 : e._define3DName) +
            "\n                        " +
            (null == e ? void 0 : e._cubeSamplerName) +
            ",\n                        " +
            (null == e ? void 0 : e._cubeSamplerName) +
            ",\n                    #else\n                        " +
            (null == e ? void 0 : e._2DSamplerName) +
            ",\n                        " +
            (null == e ? void 0 : e._2DSamplerName) +
            ",\n                    #endif\n                #endif\n                #if !defined(" +
            (null == e ? void 0 : e._defineSkyboxName) +
            ") && defined(RADIANCEOCCLUSION)\n                    seo,\n                #endif\n                #if !defined(" +
            (null == e ? void 0 : e._defineSkyboxName) +
            ") && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(" +
            (null == e ? void 0 : e._define3DName) +
            ")\n                    eho,\n                #endif\n            #endif\n                sheenOut\n            );\n\n            #ifdef SHEEN_LINKWITHALBEDO\n                surfaceAlbedo = sheenOut.surfaceAlbedo;\n            #endif\n        #endif\r\n"
          );
        }),
        (t.prototype._buildBlock = function (e) {
          return (
            e.target === Wl.Fragment &&
              e.sharedData.blocksWithDefines.push(this),
            this
          );
        }),
        (t.prototype._dumpPropertiesCode = function () {
          var t = e.prototype._dumpPropertiesCode.call(this);
          return (
            (t +=
              this._codeVariableName +
              ".albedoScaling = " +
              this.albedoScaling +
              ";\r\n") +
            (this._codeVariableName + ".linkSheenWithAlbedo = ") +
            this.linkSheenWithAlbedo +
            ";\r\n"
          );
        }),
        (t.prototype.serialize = function () {
          var t = e.prototype.serialize.call(this);
          return (
            (t.albedoScaling = this.albedoScaling),
            (t.linkSheenWithAlbedo = this.linkSheenWithAlbedo),
            t
          );
        }),
        (t.prototype._deserialize = function (t, i, n) {
          e.prototype._deserialize.call(this, t, i, n),
            (this.albedoScaling = t.albedoScaling),
            (this.linkSheenWithAlbedo = t.linkSheenWithAlbedo);
        }),
        R(
          [
            _c("Albedo scaling", pc.Boolean, "PROPERTIES", {
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "albedoScaling",
          void 0
        ),
        R(
          [
            _c("Link sheen with albedo", pc.Boolean, "PROPERTIES", {
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "linkSheenWithAlbedo",
          void 0
        ),
        t
      );
    })(Jl);
  h.RegisteredTypes["BABYLON.SheenBlock"] = Bu;
  var Vu = (function (e) {
    function t(i) {
      var n = e.call(this, i, Wl.Fragment) || this;
      return (
        (n._isUnique = !0),
        n.registerInput("intensity", Hl.Float, !0, Wl.Fragment),
        n.registerInput("direction", Hl.Vector2, !0, Wl.Fragment),
        n.registerInput("uv", Hl.Vector2, !0),
        n.registerInput("worldTangent", Hl.Vector4, !0),
        n.registerOutput(
          "anisotropy",
          Hl.Object,
          Wl.Fragment,
          new Fu("anisotropy", n, Ql.Output, t, "AnisotropyBlock")
        ),
        n
      );
    }
    return (
      P(t, e),
      (t.prototype.initialize = function (e) {
        e._excludeVariableName("anisotropicOut"), e._excludeVariableName("TBN");
      }),
      (t.prototype.getClassName = function () {
        return "AnisotropyBlock";
      }),
      Object.defineProperty(t.prototype, "intensity", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "direction", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "uv", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "worldTangent", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "anisotropy", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._generateTBNSpace = function (e) {
        var t = "",
          i = "//" + this.name,
          n = this.uv,
          r = this.worldPositionConnectionPoint,
          o = this.worldNormalConnectionPoint,
          s = this.worldTangent;
        n.isConnected ||
          console.error(
            "You must connect the 'uv' input of the Anisotropy block!"
          ),
          e._emitExtension(
            "derivatives",
            "#extension GL_OES_standard_derivatives : enable"
          );
        var a = {
          search: /defined\(TANGENT\)/g,
          replace: s.isConnected ? "defined(TANGENT)" : "defined(IGNORE)",
        };
        return (
          s.isConnected &&
            ((t +=
              "vec3 tbnNormal = normalize(" +
              o.associatedVariableName +
              ".xyz);\r\n"),
            (t +=
              "vec3 tbnTangent = normalize(" +
              s.associatedVariableName +
              ".xyz);\r\n"),
            (t += "vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r\n"),
            (t +=
              "mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n")),
          (t +=
            "\n            #if defined(" +
            (s.isConnected ? "TANGENT" : "IGNORE") +
            ") && defined(NORMAL)\n                mat3 TBN = vTBN;\n            #else\n                mat3 TBN = cotangent_frame(" +
            o.associatedVariableName +
            ".xyz, v_" +
            r.associatedVariableName +
            ".xyz, " +
            (n.isConnected ? n.associatedVariableName : "vec2(0.)") +
            ", vec2(1., 1.));\n            #endif\r\n"),
          e._emitFunctionFromInclude("bumpFragmentMainFunctions", i, {
            replaceStrings: [a],
          }),
          t
        );
      }),
      (t.prototype.getCode = function (e, t) {
        void 0 === t && (t = !1);
        var i = "";
        t && (i += this._generateTBNSpace(e));
        var n = this.intensity.isConnected
          ? this.intensity.associatedVariableName
          : "1.0";
        return (
          i +
          "anisotropicOutParams anisotropicOut;\n            anisotropicBlock(\n                vec3(" +
          (this.direction.isConnected
            ? this.direction.associatedVariableName
            : "vec2(1., 0.)") +
          ", " +
          n +
          "),\n            #ifdef ANISOTROPIC_TEXTURE\n                vec3(0.),\n            #endif\n                TBN,\n                normalW,\n                viewDirectionW,\n                anisotropicOut\n            );\r\n"
        );
      }),
      (t.prototype.prepareDefines = function (t, i, n) {
        e.prototype.prepareDefines.call(this, t, i, n),
          n.setValue("ANISOTROPIC", !0),
          n.setValue("ANISOTROPIC_TEXTURE", !1, !0);
      }),
      (t.prototype._buildBlock = function (e) {
        return (
          e.target === Wl.Fragment && e.sharedData.blocksWithDefines.push(this),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.AnisotropyBlock"] = Vu;
  var ku = (function (e) {
    function t(i) {
      var n = e.call(this, i) || this;
      return (
        (n.useSphericalHarmonics = !0),
        (n.forceIrradianceInFragment = !1),
        (n._isUnique = !0),
        n.registerInput("position", Hl.Vector3, !1, Wl.Vertex),
        n.registerInput("world", Hl.Matrix, !1, Wl.Vertex),
        n.registerInput("color", Hl.Color3, !0, Wl.Fragment),
        n.registerOutput(
          "reflection",
          Hl.Object,
          Wl.Fragment,
          new Fu("reflection", n, Ql.Output, t, "ReflectionBlock")
        ),
        n
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ReflectionBlock";
      }),
      Object.defineProperty(t.prototype, "position", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "worldPosition", {
        get: function () {
          return this.worldPositionConnectionPoint;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "worldNormal", {
        get: function () {
          return this.worldNormalConnectionPoint;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "world", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "cameraPosition", {
        get: function () {
          return this.cameraPositionConnectionPoint;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "view", {
        get: function () {
          return this.viewConnectionPoint;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "color", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "reflection", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "hasTexture", {
        get: function () {
          return !!this._getTexture();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "reflectionColor", {
        get: function () {
          return this.color.isConnected
            ? this.color.associatedVariableName
            : "vec3(1., 1., 1.)";
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._getTexture = function () {
        return this.texture ? this.texture : this._scene.environmentTexture;
      }),
      (t.prototype.prepareDefines = function (t, i, n) {
        e.prototype.prepareDefines.call(this, t, i, n);
        var r = this._getTexture(),
          o = r && r.getTextureMatrix;
        n.setValue("REFLECTION", o, !0),
          o &&
            (n.setValue(this._defineLODReflectionAlpha, r.lodLevelInAlpha, !0),
            n.setValue(
              this._defineLinearSpecularReflection,
              r.linearSpecularLOD,
              !0
            ),
            n.setValue(
              this._defineOppositeZ,
              this._scene.useRightHandedSystem ? !r.invertZ : r.invertZ,
              !0
            ),
            n.setValue("SPHERICAL_HARMONICS", this.useSphericalHarmonics, !0),
            n.setValue("GAMMAREFLECTION", r.gammaSpace, !0),
            n.setValue("RGBDREFLECTION", r.isRGBD, !0),
            r &&
              r.coordinatesMode !== mn.SKYBOX_MODE &&
              r.isCube &&
              (n.setValue("USESPHERICALFROMREFLECTIONMAP", !0),
              n.setValue("USEIRRADIANCEMAP", !1),
              this.forceIrradianceInFragment ||
              this._scene.getEngine().getCaps().maxVaryingVectors <= 8
                ? n.setValue("USESPHERICALINVERTEX", !1)
                : n.setValue("USESPHERICALINVERTEX", !0)));
      }),
      (t.prototype.bind = function (t, i, n, r) {
        e.prototype.bind.call(this, t, i, n);
        var o = this._getTexture();
        if (o && r) {
          o.isCube
            ? t.setTexture(this._cubeSamplerName, o)
            : t.setTexture(this._2DSamplerName, o);
          var a = o.getSize().width;
          t.setFloat3(
            this._vReflectionMicrosurfaceInfosName,
            a,
            o.lodGenerationScale,
            o.lodGenerationOffset
          ),
            t.setFloat2(this._vReflectionFilteringInfoName, a, s.Log2(a));
          var l = r._materialDefines,
            c = o.sphericalPolynomial;
          if (l.USESPHERICALFROMREFLECTIONMAP && c)
            if (l.SPHERICAL_HARMONICS) {
              var u = c.preScaledHarmonics;
              t.setVector3("vSphericalL00", u.l00),
                t.setVector3("vSphericalL1_1", u.l1_1),
                t.setVector3("vSphericalL10", u.l10),
                t.setVector3("vSphericalL11", u.l11),
                t.setVector3("vSphericalL2_2", u.l2_2),
                t.setVector3("vSphericalL2_1", u.l2_1),
                t.setVector3("vSphericalL20", u.l20),
                t.setVector3("vSphericalL21", u.l21),
                t.setVector3("vSphericalL22", u.l22);
            } else
              t.setFloat3("vSphericalX", c.x.x, c.x.y, c.x.z),
                t.setFloat3("vSphericalY", c.y.x, c.y.y, c.y.z),
                t.setFloat3("vSphericalZ", c.z.x, c.z.y, c.z.z),
                t.setFloat3(
                  "vSphericalXX_ZZ",
                  c.xx.x - c.zz.x,
                  c.xx.y - c.zz.y,
                  c.xx.z - c.zz.z
                ),
                t.setFloat3(
                  "vSphericalYY_ZZ",
                  c.yy.x - c.zz.x,
                  c.yy.y - c.zz.y,
                  c.yy.z - c.zz.z
                ),
                t.setFloat3("vSphericalZZ", c.zz.x, c.zz.y, c.zz.z),
                t.setFloat3("vSphericalXY", c.xy.x, c.xy.y, c.xy.z),
                t.setFloat3("vSphericalYZ", c.yz.x, c.yz.y, c.yz.z),
                t.setFloat3("vSphericalZX", c.zx.x, c.zx.y, c.zx.z);
        }
      }),
      (t.prototype.handleVertexSide = function (t) {
        var i = e.prototype.handleVertexSide.call(this, t);
        t._emitFunctionFromInclude("harmonicsFunctions", "//" + this.name, {
          replaceStrings: [
            {
              search:
                /uniform vec3 vSphericalL00;[\s\S]*?uniform vec3 vSphericalL22;/g,
              replace: "",
            },
            {
              search:
                /uniform vec3 vSphericalX;[\s\S]*?uniform vec3 vSphericalZX;/g,
              replace: "",
            },
          ],
        });
        var n = t._getFreeVariableName("reflectionVector");
        return (
          (this._vEnvironmentIrradianceName = t._getFreeVariableName(
            "vEnvironmentIrradiance"
          )),
          t._emitVaryingFromString(
            this._vEnvironmentIrradianceName,
            "vec3",
            "defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)"
          ),
          t._emitUniformFromString(
            "vSphericalL00",
            "vec3",
            "SPHERICAL_HARMONICS"
          ),
          t._emitUniformFromString(
            "vSphericalL1_1",
            "vec3",
            "SPHERICAL_HARMONICS"
          ),
          t._emitUniformFromString(
            "vSphericalL10",
            "vec3",
            "SPHERICAL_HARMONICS"
          ),
          t._emitUniformFromString(
            "vSphericalL11",
            "vec3",
            "SPHERICAL_HARMONICS"
          ),
          t._emitUniformFromString(
            "vSphericalL2_2",
            "vec3",
            "SPHERICAL_HARMONICS"
          ),
          t._emitUniformFromString(
            "vSphericalL2_1",
            "vec3",
            "SPHERICAL_HARMONICS"
          ),
          t._emitUniformFromString(
            "vSphericalL20",
            "vec3",
            "SPHERICAL_HARMONICS"
          ),
          t._emitUniformFromString(
            "vSphericalL21",
            "vec3",
            "SPHERICAL_HARMONICS"
          ),
          t._emitUniformFromString(
            "vSphericalL22",
            "vec3",
            "SPHERICAL_HARMONICS"
          ),
          t._emitUniformFromString(
            "vSphericalX",
            "vec3",
            "SPHERICAL_HARMONICS",
            !0
          ),
          t._emitUniformFromString(
            "vSphericalY",
            "vec3",
            "SPHERICAL_HARMONICS",
            !0
          ),
          t._emitUniformFromString(
            "vSphericalZ",
            "vec3",
            "SPHERICAL_HARMONICS",
            !0
          ),
          t._emitUniformFromString(
            "vSphericalXX_ZZ",
            "vec3",
            "SPHERICAL_HARMONICS",
            !0
          ),
          t._emitUniformFromString(
            "vSphericalYY_ZZ",
            "vec3",
            "SPHERICAL_HARMONICS",
            !0
          ),
          t._emitUniformFromString(
            "vSphericalZZ",
            "vec3",
            "SPHERICAL_HARMONICS",
            !0
          ),
          t._emitUniformFromString(
            "vSphericalXY",
            "vec3",
            "SPHERICAL_HARMONICS",
            !0
          ),
          t._emitUniformFromString(
            "vSphericalYZ",
            "vec3",
            "SPHERICAL_HARMONICS",
            !0
          ),
          t._emitUniformFromString(
            "vSphericalZX",
            "vec3",
            "SPHERICAL_HARMONICS",
            !0
          ),
          i +
            "#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\n                vec3 " +
            n +
            " = vec3(" +
            this._reflectionMatrixName +
            " * vec4(normalize(" +
            this.worldNormal.associatedVariableName +
            ").xyz, 0)).xyz;\n                #ifdef " +
            this._defineOppositeZ +
            "\n                    " +
            n +
            ".z *= -1.0;\n                #endif\n                " +
            this._vEnvironmentIrradianceName +
            " = computeEnvironmentIrradiance(" +
            n +
            ");\n            #endif\r\n"
        );
      }),
      (t.prototype.getCode = function (e, t) {
        var i = "";
        this.handleFragmentSideInits(e),
          e._emitFunctionFromInclude("harmonicsFunctions", "//" + this.name, {
            replaceStrings: [
              {
                search:
                  /uniform vec3 vSphericalL00;[\s\S]*?uniform vec3 vSphericalL22;/g,
                replace: "",
              },
              {
                search:
                  /uniform vec3 vSphericalX;[\s\S]*?uniform vec3 vSphericalZX;/g,
                replace: "",
              },
            ],
          }),
          e._emitFunction(
            "sampleReflection",
            "\n            #ifdef " +
              this._define3DName +
              "\n                #define sampleReflection(s, c) textureCube(s, c)\n            #else\n                #define sampleReflection(s, c) texture2D(s, c)\n            #endif\r\n",
            "//" + this.name
          ),
          e._emitFunction(
            "sampleReflectionLod",
            "\n            #ifdef " +
              this._define3DName +
              "\n                #define sampleReflectionLod(s, c, l) textureCubeLodEXT(s, c, l)\n            #else\n                #define sampleReflectionLod(s, c, l) texture2DLodEXT(s, c, l)\n            #endif\r\n",
            "//" + this.name
          );
        var n =
          "\n            vec3 computeReflectionCoordsPBR(vec4 worldPos, vec3 worldNormal) {\n                " +
          this.handleFragmentSideCodeReflectionCoords(
            "worldNormal",
            "worldPos",
            !0
          ) +
          "\n                return " +
          this._reflectionVectorName +
          ";\n            }\r\n";
        return (
          e._emitFunction("computeReflectionCoordsPBR", n, "//" + this.name),
          (this._vReflectionMicrosurfaceInfosName = e._getFreeVariableName(
            "vReflectionMicrosurfaceInfos"
          )),
          e._emitUniformFromString(
            this._vReflectionMicrosurfaceInfosName,
            "vec3"
          ),
          (this._vReflectionInfosName =
            e._getFreeVariableName("vReflectionInfos")),
          (this._vReflectionFilteringInfoName = e._getFreeVariableName(
            "vReflectionFilteringInfo"
          )),
          e._emitUniformFromString(this._vReflectionFilteringInfoName, "vec2"),
          i +
            "#ifdef REFLECTION\n            vec2 " +
            this._vReflectionInfosName +
            " = vec2(1., 0.);\n\n            reflectionOutParams reflectionOut;\n\n            reflectionBlock(\n                v_" +
            this.worldPosition.associatedVariableName +
            ".xyz,\n                " +
            t +
            ",\n                alphaG,\n                " +
            this._vReflectionMicrosurfaceInfosName +
            ",\n                " +
            this._vReflectionInfosName +
            ",\n                " +
            this.reflectionColor +
            ",\n            #ifdef ANISOTROPIC\n                anisotropicOut,\n            #endif\n            #if defined(" +
            this._defineLODReflectionAlpha +
            ") && !defined(" +
            this._defineSkyboxName +
            ")\n                NdotVUnclamped,\n            #endif\n            #ifdef " +
            this._defineLinearSpecularReflection +
            "\n                roughness,\n            #endif\n            #ifdef " +
            this._define3DName +
            "\n                " +
            this._cubeSamplerName +
            ",\n            #else\n                " +
            this._2DSamplerName +
            ",\n            #endif\n            #if defined(NORMAL) && defined(USESPHERICALINVERTEX)\n                " +
            this._vEnvironmentIrradianceName +
            ",\n            #endif\n            #ifdef USESPHERICALFROMREFLECTIONMAP\n                #if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n                    " +
            this._reflectionMatrixName +
            ",\n                #endif\n            #endif\n            #ifdef USEIRRADIANCEMAP\n                irradianceSampler, // ** not handled **\n            #endif\n            #ifndef LODBASEDMICROSFURACE\n                #ifdef " +
            this._define3DName +
            "\n                    " +
            this._cubeSamplerName +
            ",\n                    " +
            this._cubeSamplerName +
            ",\n                #else\n                    " +
            this._2DSamplerName +
            ",\n                    " +
            this._2DSamplerName +
            ",\n                #endif\n            #endif\n            #ifdef REALTIME_FILTERING\n                " +
            this._vReflectionFilteringInfoName +
            ",\n            #endif\n                reflectionOut\n            );\n        #endif\r\n"
        );
      }),
      (t.prototype._buildBlock = function (e) {
        return (
          (this._scene = e.sharedData.scene),
          e.target !== Wl.Fragment &&
            ((this._defineLODReflectionAlpha = e._getFreeDefineName(
              "LODINREFLECTIONALPHA"
            )),
            (this._defineLinearSpecularReflection = e._getFreeDefineName(
              "LINEARSPECULARREFLECTION"
            ))),
          this
        );
      }),
      (t.prototype._dumpPropertiesCode = function () {
        var t = e.prototype._dumpPropertiesCode.call(this);
        return (
          this.texture &&
            (t +=
              this._codeVariableName +
              ".texture.gammaSpace = " +
              this.texture.gammaSpace +
              ");\r\n"),
          (t +=
            this._codeVariableName +
            ".useSphericalHarmonics = " +
            this.useSphericalHarmonics +
            ";\r\n") +
            (this._codeVariableName + ".forceIrradianceInFragment = ") +
            this.forceIrradianceInFragment +
            ";\r\n"
        );
      }),
      (t.prototype.serialize = function () {
        var t,
          i,
          n = e.prototype.serialize.call(this);
        return (
          (n.useSphericalHarmonics = this.useSphericalHarmonics),
          (n.forceIrradianceInFragment = this.forceIrradianceInFragment),
          (n.gammaSpace =
            null ===
              (i =
                null === (t = this.texture) || void 0 === t
                  ? void 0
                  : t.gammaSpace) ||
            void 0 === i ||
            i),
          n
        );
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          (this.useSphericalHarmonics = t.useSphericalHarmonics),
          (this.forceIrradianceInFragment = t.forceIrradianceInFragment),
          this.texture && (this.texture.gammaSpace = t.gammaSpace);
      }),
      R(
        [
          _c("Spherical Harmonics", pc.Boolean, "ADVANCED", {
            notifiers: {
              update: !0,
            },
          }),
        ],
        t.prototype,
        "useSphericalHarmonics",
        void 0
      ),
      R(
        [
          _c("Force irradiance in fragment", pc.Boolean, "ADVANCED", {
            notifiers: {
              update: !0,
            },
          }),
        ],
        t.prototype,
        "forceIrradianceInFragment",
        void 0
      ),
      t
    );
  })(Qc);
  h.RegisteredTypes["BABYLON.ReflectionBlock"] = ku;
  var Uu = (function (e) {
    function t(i) {
      var n = e.call(this, i, Wl.Fragment) || this;
      return (
        (n.remapF0OnInterfaceChange = !0),
        (n._isUnique = !0),
        n.registerInput("intensity", Hl.Float, !1, Wl.Fragment),
        n.registerInput("roughness", Hl.Float, !0, Wl.Fragment),
        n.registerInput("indexOfRefraction", Hl.Float, !0, Wl.Fragment),
        n.registerInput("normalMapColor", Hl.Color3, !0, Wl.Fragment),
        n.registerInput("uv", Hl.Vector2, !0, Wl.Fragment),
        n.registerInput("tintColor", Hl.Color3, !0, Wl.Fragment),
        n.registerInput("tintAtDistance", Hl.Float, !0, Wl.Fragment),
        n.registerInput("tintThickness", Hl.Float, !0, Wl.Fragment),
        n.registerInput("worldTangent", Hl.Vector4, !0),
        n.registerOutput(
          "clearcoat",
          Hl.Object,
          Wl.Fragment,
          new Fu("clearcoat", n, Ql.Output, t, "ClearCoatBlock")
        ),
        n
      );
    }
    return (
      P(t, e),
      (t.prototype.initialize = function (e) {
        e._excludeVariableName("clearcoatOut"),
          e._excludeVariableName("vClearCoatParams"),
          e._excludeVariableName("vClearCoatTintParams"),
          e._excludeVariableName("vClearCoatRefractionParams"),
          e._excludeVariableName("vClearCoatTangentSpaceParams");
      }),
      (t.prototype.getClassName = function () {
        return "ClearCoatBlock";
      }),
      Object.defineProperty(t.prototype, "intensity", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "roughness", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "indexOfRefraction", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "normalMapColor", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "uv", {
        get: function () {
          return this._inputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "tintColor", {
        get: function () {
          return this._inputs[5];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "tintAtDistance", {
        get: function () {
          return this._inputs[6];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "tintThickness", {
        get: function () {
          return this._inputs[7];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "worldTangent", {
        get: function () {
          return this._inputs[8];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "clearcoat", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.intensity.isConnected) {
          var t = new lc("ClearCoat intensity", Wl.Fragment, Hl.Float);
          (t.value = 1), t.output.connectTo(this.intensity);
        }
      }),
      (t.prototype.prepareDefines = function (t, i, n) {
        e.prototype.prepareDefines.call(this, t, i, n),
          n.setValue("CLEARCOAT", !0),
          n.setValue("CLEARCOAT_TEXTURE", !1, !0),
          n.setValue("CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE", !0, !0),
          n.setValue(
            "CLEARCOAT_TINT",
            this.tintColor.isConnected ||
              this.tintThickness.isConnected ||
              this.tintAtDistance.isConnected,
            !0
          ),
          n.setValue("CLEARCOAT_BUMP", this.normalMapColor.isConnected, !0),
          n.setValue(
            "CLEARCOAT_DEFAULTIOR",
            !this.indexOfRefraction.isConnected ||
              this.indexOfRefraction.connectInputBlock.value ===
                Ws._DefaultIndexOfRefraction,
            !0
          ),
          n.setValue("CLEARCOAT_REMAP_F0", this.remapF0OnInterfaceChange, !0);
      }),
      (t.prototype.bind = function (t, i, n, r) {
        var o, s;
        e.prototype.bind.call(this, t, i, n);
        var a =
            null !==
              (s =
                null === (o = this.indexOfRefraction.connectInputBlock) ||
                void 0 === o
                  ? void 0
                  : o.value) && void 0 !== s
              ? s
              : Ws._DefaultIndexOfRefraction,
          l = 1 - a,
          c = 1 + a,
          u = Math.pow(-l / c, 2),
          h = 1 / a;
        t.setFloat4("vClearCoatRefractionParams", u, h, l, c);
        var d = this.clearcoat.hasEndpoints
            ? this.clearcoat.endpoints[0].ownerBlock
            : null,
          p = (null == d ? void 0 : d.perturbedNormal.isConnected)
            ? d.perturbedNormal.connectedPoint.ownerBlock
            : null;
        this._scene._mirroredCameraPosition
          ? t.setFloat2(
              "vClearCoatTangentSpaceParams",
              (null == p ? void 0 : p.invertX) ? 1 : -1,
              (null == p ? void 0 : p.invertY) ? 1 : -1
            )
          : t.setFloat2(
              "vClearCoatTangentSpaceParams",
              (null == p ? void 0 : p.invertX) ? -1 : 1,
              (null == p ? void 0 : p.invertY) ? -1 : 1
            );
      }),
      (t.prototype._generateTBNSpace = function (e, t, i) {
        var n = "",
          r = "//" + this.name,
          o = this.worldTangent;
        e._emitExtension(
          "derivatives",
          "#extension GL_OES_standard_derivatives : enable"
        );
        var s = {
          search: /defined\(TANGENT\)/g,
          replace: o.isConnected ? "defined(TANGENT)" : "defined(IGNORE)",
        };
        return (
          o.isConnected &&
            ((n += "vec3 tbnNormal = normalize(" + i + ".xyz);\r\n"),
            (n +=
              "vec3 tbnTangent = normalize(" +
              o.associatedVariableName +
              ".xyz);\r\n"),
            (n += "vec3 tbnBitangent = cross(tbnNormal, tbnTangent);\r\n"),
            (n +=
              "mat3 vTBN = mat3(tbnTangent, tbnBitangent, tbnNormal);\r\n")),
          e._emitFunctionFromInclude("bumpFragmentMainFunctions", r, {
            replaceStrings: [s],
          }),
          n
        );
      }),
      (t.GetCode = function (e, t, i, n, r, o, s) {
        var a = "",
          l = (null == t ? void 0 : t.intensity.isConnected)
            ? t.intensity.associatedVariableName
            : "1.",
          c = (null == t ? void 0 : t.roughness.isConnected)
            ? t.roughness.associatedVariableName
            : "0.",
          u = (null == t ? void 0 : t.normalMapColor.isConnected)
            ? t.normalMapColor.associatedVariableName
            : "vec3(0.)",
          h = (null == t ? void 0 : t.uv.isConnected)
            ? t.uv.associatedVariableName
            : "vec2(0.)",
          d = (null == t ? void 0 : t.tintColor.isConnected)
            ? t.tintColor.associatedVariableName
            : "vec3(1.)",
          p = (null == t ? void 0 : t.tintThickness.isConnected)
            ? t.tintThickness.associatedVariableName
            : "1.",
          f = (null == t ? void 0 : t.tintAtDistance.isConnected)
            ? t.tintAtDistance.associatedVariableName
            : "1.";
        return (
          t &&
            (e._emitUniformFromString("vClearCoatRefractionParams", "vec4"),
            e._emitUniformFromString("vClearCoatTangentSpaceParams", "vec2")),
          r &&
            t &&
            ((a += t._generateTBNSpace(e, n, s)),
            (o = t.worldTangent.isConnected)),
          a +
            "clearcoatOutParams clearcoatOut;\n\n        #ifdef CLEARCOAT\n            vec2 vClearCoatParams = vec2(" +
            l +
            ", " +
            c +
            ");\n            vec4 vClearCoatTintParams = vec4(" +
            d +
            ", " +
            p +
            ");\n\n            clearcoatBlock(\n                " +
            n +
            ".xyz,\n                geometricNormalW,\n                viewDirectionW,\n                vClearCoatParams,\n                specularEnvironmentR0,\n            #ifdef CLEARCOAT_TEXTURE\n                vec2(0.),\n            #endif\n            #ifdef CLEARCOAT_TINT\n                vClearCoatTintParams,\n                " +
            f +
            ",\n                vClearCoatRefractionParams,\n                #ifdef CLEARCOAT_TINT_TEXTURE\n                    vec4(0.),\n                #endif\n            #endif\n            #ifdef CLEARCOAT_BUMP\n                vec2(0., 1.),\n                vec4(" +
            u +
            ", 0.),\n                " +
            h +
            ",\n                #if defined(" +
            (o ? "TANGENT" : "IGNORE") +
            ") && defined(NORMAL)\n                    vTBN,\n                #else\n                    vClearCoatTangentSpaceParams,\n                #endif\n                #ifdef OBJECTSPACE_NORMALMAP\n                    normalMatrix,\n                #endif\n            #endif\n            #if defined(FORCENORMALFORWARD) && defined(NORMAL)\n                faceNormal,\n            #endif\n            #ifdef REFLECTION\n                " +
            (null == i ? void 0 : i._vReflectionMicrosurfaceInfosName) +
            ",\n                " +
            (null == i ? void 0 : i._vReflectionInfosName) +
            ",\n                " +
            (null == i ? void 0 : i.reflectionColor) +
            ",\n                vLightingIntensity,\n                #ifdef " +
            (null == i ? void 0 : i._define3DName) +
            "\n                    " +
            (null == i ? void 0 : i._cubeSamplerName) +
            ",\n                #else\n                    " +
            (null == i ? void 0 : i._2DSamplerName) +
            ",\n                #endif\n                #ifndef LODBASEDMICROSFURACE\n                    #ifdef " +
            (null == i ? void 0 : i._define3DName) +
            "\n                        " +
            (null == i ? void 0 : i._cubeSamplerName) +
            ",\n                        " +
            (null == i ? void 0 : i._cubeSamplerName) +
            ",\n                    #else\n                        " +
            (null == i ? void 0 : i._2DSamplerName) +
            ",\n                        " +
            (null == i ? void 0 : i._2DSamplerName) +
            ",\n                    #endif\n                #endif\n            #endif\n            #if defined(ENVIRONMENTBRDF) && !defined(" +
            (null == i ? void 0 : i._defineSkyboxName) +
            ")\n                #ifdef RADIANCEOCCLUSION\n                    ambientMonochrome,\n                #endif\n            #endif\n                clearcoatOut\n            );\n        #else\n            clearcoatOut.specularEnvironmentR0 = specularEnvironmentR0;\n        #endif\r\n"
        );
      }),
      (t.prototype._buildBlock = function (e) {
        return (
          (this._scene = e.sharedData.scene),
          e.target === Wl.Fragment &&
            (e.sharedData.bindableBlocks.push(this),
            e.sharedData.blocksWithDefines.push(this)),
          this
        );
      }),
      (t.prototype._dumpPropertiesCode = function () {
        return (
          "" +
          (this._codeVariableName + ".remapF0OnInterfaceChange = ") +
          this.remapF0OnInterfaceChange +
          ";\r\n"
        );
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return (t.remapF0OnInterfaceChange = this.remapF0OnInterfaceChange), t;
      }),
      (t.prototype._deserialize = function (t, i, n) {
        var r;
        e.prototype._deserialize.call(this, t, i, n),
          (this.remapF0OnInterfaceChange =
            null === (r = t.remapF0OnInterfaceChange) || void 0 === r || r);
      }),
      R(
        [_c("Remap F0 on interface change", pc.Boolean, "ADVANCED")],
        t.prototype,
        "remapF0OnInterfaceChange",
        void 0
      ),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ClearCoatBlock"] = Uu;
  var zu = (function (e) {
    function t(i) {
      var n = e.call(this, i, Wl.Fragment) || this;
      return (
        (n.linkRefractionWithTransparency = !1),
        (n.invertRefractionY = !1),
        (n._isUnique = !0),
        n.registerInput("intensity", Hl.Float, !1, Wl.Fragment),
        n.registerInput("tintAtDistance", Hl.Float, !0, Wl.Fragment),
        n.registerOutput(
          "refraction",
          Hl.Object,
          Wl.Fragment,
          new Fu("refraction", n, Ql.Output, t, "RefractionBlock")
        ),
        n
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "RefractionBlock";
      }),
      Object.defineProperty(t.prototype, "intensity", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "tintAtDistance", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "view", {
        get: function () {
          return this.viewConnectionPoint;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "refraction", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "hasTexture", {
        get: function () {
          return !!this._getTexture();
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._getTexture = function () {
        return this.texture ? this.texture : this._scene.environmentTexture;
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.intensity.isConnected) {
          var t = new lc("Refraction intensity", Wl.Fragment, Hl.Float);
          (t.value = 1), t.output.connectTo(this.intensity);
        }
        if (this.view && !this.view.isConnected) {
          var i = e.getInputBlockByPredicate(function (e) {
            return e.systemValue === Xl.View;
          });
          i || (i = new lc("view")).setAsSystemValue(Xl.View),
            i.output.connectTo(this.view);
        }
      }),
      (t.prototype.prepareDefines = function (t, i, n) {
        e.prototype.prepareDefines.call(this, t, i, n);
        var r = this._getTexture(),
          o = r && r.getTextureMatrix;
        n.setValue("SS_REFRACTION", o, !0),
          o &&
            (n.setValue(this._define3DName, r.isCube, !0),
            n.setValue(this._defineLODRefractionAlpha, r.lodLevelInAlpha, !0),
            n.setValue(
              this._defineLinearSpecularRefraction,
              r.linearSpecularLOD,
              !0
            ),
            n.setValue(
              this._defineOppositeZ,
              this._scene.useRightHandedSystem ? !r.invertZ : r.invertZ,
              !0
            ),
            n.setValue(
              "SS_LINKREFRACTIONTOTRANSPARENCY",
              this.linkRefractionWithTransparency,
              !0
            ),
            n.setValue("SS_GAMMAREFRACTION", r.gammaSpace, !0),
            n.setValue("SS_RGBDREFRACTION", r.isRGBD, !0));
      }),
      (t.prototype.isReady = function () {
        var e = this._getTexture();
        return !(e && !e.isReadyOrNotBlocking());
      }),
      (t.prototype.bind = function (t, i, n, r) {
        var o, a;
        e.prototype.bind.call(this, t, i, n);
        var l = this._getTexture();
        if (l) {
          l.isCube
            ? t.setTexture(this._cubeSamplerName, l)
            : t.setTexture(this._2DSamplerName, l),
            t.setMatrix(
              this._refractionMatrixName,
              l.getReflectionTextureMatrix()
            );
          var c = 1;
          l.isCube || (l.depth && (c = l.depth));
          var u =
            null !==
              (a =
                null ===
                  (o =
                    this.indexOfRefractionConnectionPoint.connectInputBlock) ||
                void 0 === o
                  ? void 0
                  : o.value) && void 0 !== a
              ? a
              : 1.5;
          t.setFloat4(
            this._vRefractionInfosName,
            l.level,
            1 / u,
            c,
            this.invertRefractionY ? -1 : 1
          ),
            t.setFloat3(
              this._vRefractionMicrosurfaceInfosName,
              l.getSize().width,
              l.lodGenerationScale,
              l.lodGenerationOffset
            );
          var h = l.getSize().width;
          t.setFloat2(this._vRefractionFilteringInfoName, h, s.Log2(h));
        }
      }),
      (t.prototype.getCode = function (e) {
        return (
          e.sharedData.blockingBlocks.push(this),
          e.sharedData.textureBlocks.push(this),
          (this._cubeSamplerName = e._getFreeVariableName(
            this.name + "CubeSampler"
          )),
          e.samplers.push(this._cubeSamplerName),
          (this._2DSamplerName = e._getFreeVariableName(
            this.name + "2DSampler"
          )),
          e.samplers.push(this._2DSamplerName),
          (this._define3DName = e._getFreeDefineName("SS_REFRACTIONMAP_3D")),
          (e._samplerDeclaration += "#ifdef " + this._define3DName + "\r\n"),
          (e._samplerDeclaration +=
            "uniform samplerCube " + this._cubeSamplerName + ";\r\n"),
          (e._samplerDeclaration += "#else\r\n"),
          (e._samplerDeclaration +=
            "uniform sampler2D " + this._2DSamplerName + ";\r\n"),
          (e._samplerDeclaration += "#endif\r\n"),
          e.sharedData.blocksWithDefines.push(this),
          e.sharedData.bindableBlocks.push(this),
          (this._defineLODRefractionAlpha = e._getFreeDefineName(
            "SS_LODINREFRACTIONALPHA"
          )),
          (this._defineLinearSpecularRefraction = e._getFreeDefineName(
            "SS_LINEARSPECULARREFRACTION"
          )),
          (this._defineOppositeZ = e._getFreeDefineName(
            "SS_REFRACTIONMAP_OPPOSITEZ"
          )),
          (this._refractionMatrixName =
            e._getFreeVariableName("refractionMatrix")),
          e._emitUniformFromString(this._refractionMatrixName, "mat4"),
          e._emitFunction(
            "sampleRefraction",
            "\n            #ifdef " +
              this._define3DName +
              "\n                #define sampleRefraction(s, c) textureCube(s, c)\n            #else\n                #define sampleRefraction(s, c) texture2D(s, c)\n            #endif\r\n",
            "//" + this.name
          ),
          e._emitFunction(
            "sampleRefractionLod",
            "\n            #ifdef " +
              this._define3DName +
              "\n                #define sampleRefractionLod(s, c, l) textureCubeLodEXT(s, c, l)\n            #else\n                #define sampleRefractionLod(s, c, l) texture2DLodEXT(s, c, l)\n            #endif\r\n",
            "//" + this.name
          ),
          (this._vRefractionMicrosurfaceInfosName = e._getFreeVariableName(
            "vRefractionMicrosurfaceInfos"
          )),
          e._emitUniformFromString(
            this._vRefractionMicrosurfaceInfosName,
            "vec3"
          ),
          (this._vRefractionInfosName =
            e._getFreeVariableName("vRefractionInfos")),
          e._emitUniformFromString(this._vRefractionInfosName, "vec4"),
          (this._vRefractionFilteringInfoName = e._getFreeVariableName(
            "vRefractionFilteringInfo"
          )),
          e._emitUniformFromString(this._vRefractionFilteringInfoName, "vec2"),
          ""
        );
      }),
      (t.prototype._buildBlock = function (e) {
        return (this._scene = e.sharedData.scene), this;
      }),
      (t.prototype._dumpPropertiesCode = function () {
        var t = e.prototype._dumpPropertiesCode.call(this);
        return (
          this.texture &&
            ((t = this.texture.isCube
              ? this._codeVariableName +
                '.texture = new BABYLON.CubeTexture("' +
                this.texture.name +
                '");\r\n'
              : this._codeVariableName +
                '.texture = new BABYLON.Texture("' +
                this.texture.name +
                '");\r\n'),
            (t +=
              this._codeVariableName +
              ".texture.coordinatesMode = " +
              this.texture.coordinatesMode +
              ";\r\n")),
          (t +=
            this._codeVariableName +
            ".linkRefractionWithTransparency = " +
            this.linkRefractionWithTransparency +
            ";\r\n") +
            (this._codeVariableName + ".invertRefractionY = ") +
            this.invertRefractionY +
            ";\r\n"
        );
      }),
      (t.prototype.serialize = function () {
        var t = e.prototype.serialize.call(this);
        return (
          this.texture && (t.texture = this.texture.serialize()),
          (t.linkRefractionWithTransparency =
            this.linkRefractionWithTransparency),
          (t.invertRefractionY = this.invertRefractionY),
          t
        );
      }),
      (t.prototype._deserialize = function (t, i, n) {
        e.prototype._deserialize.call(this, t, i, n),
          t.texture &&
            ((n = 0 === t.texture.url.indexOf("data:") ? "" : n),
            t.texture.isCube
              ? (this.texture = Fs.Parse(t.texture, i, n))
              : (this.texture = mn.Parse(t.texture, i, n))),
          (this.linkRefractionWithTransparency =
            t.linkRefractionWithTransparency),
          (this.invertRefractionY = t.invertRefractionY);
      }),
      R(
        [
          _c("Link refraction to transparency", pc.Boolean, "ADVANCED", {
            notifiers: {
              update: !0,
            },
          }),
        ],
        t.prototype,
        "linkRefractionWithTransparency",
        void 0
      ),
      R(
        [
          _c("Invert refraction Y", pc.Boolean, "ADVANCED", {
            notifiers: {
              update: !0,
            },
          }),
        ],
        t.prototype,
        "invertRefractionY",
        void 0
      ),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.RefractionBlock"] = zu;
  var Gu = (function (e) {
    function t(i) {
      var n = e.call(this, i, Wl.Fragment) || this;
      return (
        (n._isUnique = !0),
        n.registerInput("thickness", Hl.Float, !1, Wl.Fragment),
        n.registerInput("tintColor", Hl.Color3, !0, Wl.Fragment),
        n.registerInput("translucencyIntensity", Hl.Float, !0, Wl.Fragment),
        n.registerInput(
          "translucencyDiffusionDist",
          Hl.Color3,
          !0,
          Wl.Fragment
        ),
        n.registerInput(
          "refraction",
          Hl.Object,
          !0,
          Wl.Fragment,
          new Fu("refraction", n, Ql.Input, zu, "RefractionBlock")
        ),
        n.registerOutput(
          "subsurface",
          Hl.Object,
          Wl.Fragment,
          new Fu("subsurface", n, Ql.Output, t, "SubSurfaceBlock")
        ),
        n
      );
    }
    return (
      P(t, e),
      (t.prototype.initialize = function (e) {
        e._excludeVariableName("subSurfaceOut"),
          e._excludeVariableName("vThicknessParam"),
          e._excludeVariableName("vTintColor"),
          e._excludeVariableName("vSubSurfaceIntensity");
      }),
      (t.prototype.getClassName = function () {
        return "SubSurfaceBlock";
      }),
      Object.defineProperty(t.prototype, "thickness", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "tintColor", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "translucencyIntensity", {
        get: function () {
          return this._inputs[2];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "translucencyDiffusionDist", {
        get: function () {
          return this._inputs[3];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "refraction", {
        get: function () {
          return this._inputs[4];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "subsurface", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.autoConfigure = function (e) {
        if (!this.thickness.isConnected) {
          var t = new lc("SubSurface thickness", Wl.Fragment, Hl.Float);
          (t.value = 0), t.output.connectTo(this.thickness);
        }
      }),
      (t.prototype.prepareDefines = function (t, i, n) {
        e.prototype.prepareDefines.call(this, t, i, n);
        var r =
          this.translucencyDiffusionDist.isConnected ||
          this.translucencyIntensity.isConnected;
        n.setValue("SUBSURFACE", r || this.refraction.isConnected, !0),
          n.setValue("SS_TRANSLUCENCY", r, !0),
          n.setValue("SS_THICKNESSANDMASK_TEXTURE", !1, !0),
          n.setValue("SS_MASK_FROM_THICKNESS_TEXTURE", !1, !0),
          n.setValue("SS_MASK_FROM_THICKNESS_TEXTURE_GLTF", !1, !0);
      }),
      (t.GetCode = function (e, t, i, n) {
        var r,
          o,
          s,
          a,
          l,
          c,
          u,
          h,
          d,
          p,
          f,
          _,
          m,
          g,
          v,
          y,
          b = "",
          T = (null == t ? void 0 : t.thickness.isConnected)
            ? t.thickness.associatedVariableName
            : "0.",
          S = (null == t ? void 0 : t.tintColor.isConnected)
            ? t.tintColor.associatedVariableName
            : "vec3(1.)",
          C = (null == t ? void 0 : t.translucencyIntensity.isConnected)
            ? null == t
              ? void 0
              : t.translucencyIntensity.associatedVariableName
            : "1.",
          x = (null == t ? void 0 : t.translucencyDiffusionDist.isConnected)
            ? null == t
              ? void 0
              : t.translucencyDiffusionDist.associatedVariableName
            : "vec3(1.)",
          E = (null == t ? void 0 : t.refraction.isConnected)
            ? null === (r = null == t ? void 0 : t.refraction.connectedPoint) ||
              void 0 === r
              ? void 0
              : r.ownerBlock
            : null,
          P = (null == E ? void 0 : E.tintAtDistance.isConnected)
            ? E.tintAtDistance.associatedVariableName
            : "1.",
          A = (null == E ? void 0 : E.intensity.isConnected)
            ? E.intensity.associatedVariableName
            : "1.",
          R = (null == E ? void 0 : E.view.isConnected)
            ? E.view.associatedVariableName
            : "";
        return (
          (b +=
            null !== (o = null == E ? void 0 : E.getCode(e)) && void 0 !== o
              ? o
              : "") +
          "subSurfaceOutParams subSurfaceOut;\n\n        #ifdef SUBSURFACE\n            vec2 vThicknessParam = vec2(0., " +
          T +
          ");\n            vec4 vTintColor = vec4(" +
          S +
          ", " +
          P +
          ");\n            vec3 vSubSurfaceIntensity = vec3(" +
          A +
          ", " +
          C +
          ", 0.);\n\n            subSurfaceBlock(\n                vSubSurfaceIntensity,\n                vThicknessParam,\n                vTintColor,\n                normalW,\n                specularEnvironmentReflectance,\n            #ifdef SS_THICKNESSANDMASK_TEXTURE\n                vec4(0.),\n            #endif\n            #ifdef REFLECTION\n                #ifdef SS_TRANSLUCENCY\n                    " +
          (null == i ? void 0 : i._reflectionMatrixName) +
          ",\n                    #ifdef USESPHERICALFROMREFLECTIONMAP\n                        #if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\n                            reflectionOut.irradianceVector,\n                        #endif\n                        #if defined(REALTIME_FILTERING)\n                            " +
          (null == i ? void 0 : i._cubeSamplerName) +
          ",\n                            " +
          (null == i ? void 0 : i._vReflectionFilteringInfoName) +
          ",\n                        #endif\n                        #endif\n                    #ifdef USEIRRADIANCEMAP\n                        irradianceSampler,\n                    #endif\n                #endif\n            #endif\n            #ifdef SS_REFRACTION\n                " +
          n +
          ".xyz,\n                viewDirectionW,\n                " +
          R +
          ",\n                surfaceAlbedo,\n                " +
          (null !== (s = null == E ? void 0 : E._vRefractionInfosName) &&
          void 0 !== s
            ? s
            : "") +
          ",\n                " +
          (null !== (a = null == E ? void 0 : E._refractionMatrixName) &&
          void 0 !== a
            ? a
            : "") +
          ",\n                " +
          (null !==
            (l = null == E ? void 0 : E._vRefractionMicrosurfaceInfosName) &&
          void 0 !== l
            ? l
            : "") +
          ",\n                vLightingIntensity,\n                #ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n                    alpha,\n                #endif\n                #ifdef " +
          (null !== (c = null == E ? void 0 : E._defineLODRefractionAlpha) &&
          void 0 !== c
            ? c
            : "IGNORE") +
          "\n                    NdotVUnclamped,\n                #endif\n                #ifdef " +
          (null !==
            (u = null == E ? void 0 : E._defineLinearSpecularRefraction) &&
          void 0 !== u
            ? u
            : "IGNORE") +
          "\n                    roughness,\n                #else\n                    alphaG,\n                #endif\n                #ifdef " +
          (null !== (h = null == E ? void 0 : E._define3DName) && void 0 !== h
            ? h
            : "IGNORE") +
          "\n                    " +
          (null !== (d = null == E ? void 0 : E._cubeSamplerName) &&
          void 0 !== d
            ? d
            : "") +
          ",\n                #else\n                    " +
          (null !== (p = null == E ? void 0 : E._2DSamplerName) && void 0 !== p
            ? p
            : "") +
          ",\n                #endif\n                #ifndef LODBASEDMICROSFURACE\n                    #ifdef " +
          (null !== (f = null == E ? void 0 : E._define3DName) && void 0 !== f
            ? f
            : "IGNORE") +
          "\n                        " +
          (null !== (_ = null == E ? void 0 : E._cubeSamplerName) &&
          void 0 !== _
            ? _
            : "") +
          ",\n                        " +
          (null !== (m = null == E ? void 0 : E._cubeSamplerName) &&
          void 0 !== m
            ? m
            : "") +
          ",\n                    #else\n                        " +
          (null !== (g = null == E ? void 0 : E._2DSamplerName) && void 0 !== g
            ? g
            : "") +
          ",\n                        " +
          (null !== (v = null == E ? void 0 : E._2DSamplerName) && void 0 !== v
            ? v
            : "") +
          ",\n                    #endif\n                #endif\n                #ifdef ANISOTROPIC\n                    anisotropicOut,\n                #endif\n                #ifdef REALTIME_FILTERING\n                    " +
          (null !==
            (y = null == E ? void 0 : E._vRefractionFilteringInfoName) &&
          void 0 !== y
            ? y
            : "") +
          ",\n                #endif\n            #endif\n            #ifdef SS_TRANSLUCENCY\n                " +
          x +
          ",\n            #endif\n                subSurfaceOut\n            );\n\n            #ifdef SS_REFRACTION\n                surfaceAlbedo = subSurfaceOut.surfaceAlbedo;\n                #ifdef SS_LINKREFRACTIONTOTRANSPARENCY\n                    alpha = subSurfaceOut.alpha;\n                #endif\n            #endif\n        #else\n            subSurfaceOut.specularEnvironmentReflectance = specularEnvironmentReflectance;\n        #endif\r\n"
        );
      }),
      (t.prototype._buildBlock = function (e) {
        return (
          e.target === Wl.Fragment && e.sharedData.blocksWithDefines.push(this),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.SubSurfaceBlock"] = Gu;
  var Wu = {
      ambientClr: ["finalAmbient", ""],
      diffuseDir: ["finalDiffuse", ""],
      specularDir: [
        "finalSpecularScaled",
        "!defined(UNLIT) && defined(SPECULARTERM)",
      ],
      clearcoatDir: [
        "finalClearCoatScaled",
        "!defined(UNLIT) && defined(CLEARCOAT)",
      ],
      sheenDir: ["finalSheenScaled", "!defined(UNLIT) && defined(SHEEN)"],
      diffuseInd: ["finalIrradiance", "!defined(UNLIT) && defined(REFLECTION)"],
      specularInd: [
        "finalRadianceScaled",
        "!defined(UNLIT) && defined(REFLECTION)",
      ],
      clearcoatInd: [
        "clearcoatOut.finalClearCoatRadianceScaled",
        "!defined(UNLIT) && defined(REFLECTION) && defined(CLEARCOAT)",
      ],
      sheenInd: [
        "sheenOut.finalSheenRadianceScaled",
        "!defined(UNLIT) && defined(REFLECTION) && defined(SHEEN) && defined(ENVIRONMENTBRDF)",
      ],
      refraction: [
        "subSurfaceOut.finalRefraction",
        "!defined(UNLIT) && defined(SS_REFRACTION)",
      ],
      lighting: ["finalColor.rgb", ""],
      shadow: ["shadow", ""],
      alpha: ["alpha", ""],
    },
    Hu = (function (e) {
      function t(t) {
        var i = e.call(this, t, Wl.VertexAndFragment) || this;
        return (
          (i._environmentBRDFTexture = null),
          (i._metallicReflectanceColor = b.White()),
          (i._metallicF0Factor = 1),
          (i.directIntensity = 1),
          (i.environmentIntensity = 1),
          (i.specularIntensity = 1),
          (i.lightFalloff = 0),
          (i.useAlphaTest = !1),
          (i.alphaTestCutoff = 0.5),
          (i.useAlphaBlending = !1),
          (i.useRadianceOverAlpha = !0),
          (i.useSpecularOverAlpha = !0),
          (i.enableSpecularAntiAliasing = !1),
          (i.realTimeFiltering = !1),
          (i.realTimeFilteringQuality = 8),
          (i.useEnergyConservation = !0),
          (i.useRadianceOcclusion = !0),
          (i.useHorizonOcclusion = !0),
          (i.unlit = !1),
          (i.forceNormalForward = !1),
          (i.debugMode = 0),
          (i.debugLimit = 0),
          (i.debugFactor = 1),
          (i._isUnique = !0),
          i.registerInput("worldPosition", Hl.Vector4, !1, Wl.Vertex),
          i.registerInput("worldNormal", Hl.Vector4, !1, Wl.Fragment),
          i.registerInput("view", Hl.Matrix, !1),
          i.registerInput("cameraPosition", Hl.Vector3, !1, Wl.Fragment),
          i.registerInput("perturbedNormal", Hl.Vector4, !0, Wl.Fragment),
          i.registerInput("baseColor", Hl.Color3, !0, Wl.Fragment),
          i.registerInput("metallic", Hl.Float, !1, Wl.Fragment),
          i.registerInput("roughness", Hl.Float, !1, Wl.Fragment),
          i.registerInput("ambientOcc", Hl.Float, !0, Wl.Fragment),
          i.registerInput("opacity", Hl.Float, !0, Wl.Fragment),
          i.registerInput("indexOfRefraction", Hl.Float, !0, Wl.Fragment),
          i.registerInput("ambientColor", Hl.Color3, !0, Wl.Fragment),
          i.registerInput(
            "reflection",
            Hl.Object,
            !0,
            Wl.Fragment,
            new Fu("reflection", i, Ql.Input, ku, "ReflectionBlock")
          ),
          i.registerInput(
            "clearcoat",
            Hl.Object,
            !0,
            Wl.Fragment,
            new Fu("clearcoat", i, Ql.Input, Uu, "ClearCoatBlock")
          ),
          i.registerInput(
            "sheen",
            Hl.Object,
            !0,
            Wl.Fragment,
            new Fu("sheen", i, Ql.Input, Bu, "SheenBlock")
          ),
          i.registerInput(
            "subsurface",
            Hl.Object,
            !0,
            Wl.Fragment,
            new Fu("subsurface", i, Ql.Input, Gu, "SubSurfaceBlock")
          ),
          i.registerInput(
            "anisotropy",
            Hl.Object,
            !0,
            Wl.Fragment,
            new Fu("anisotropy", i, Ql.Input, Vu, "AnisotropyBlock")
          ),
          i.registerOutput("ambientClr", Hl.Color3, Wl.Fragment),
          i.registerOutput("diffuseDir", Hl.Color3, Wl.Fragment),
          i.registerOutput("specularDir", Hl.Color3, Wl.Fragment),
          i.registerOutput("clearcoatDir", Hl.Color3, Wl.Fragment),
          i.registerOutput("sheenDir", Hl.Color3, Wl.Fragment),
          i.registerOutput("diffuseInd", Hl.Color3, Wl.Fragment),
          i.registerOutput("specularInd", Hl.Color3, Wl.Fragment),
          i.registerOutput("clearcoatInd", Hl.Color3, Wl.Fragment),
          i.registerOutput("sheenInd", Hl.Color3, Wl.Fragment),
          i.registerOutput("refraction", Hl.Color3, Wl.Fragment),
          i.registerOutput("lighting", Hl.Color3, Wl.Fragment),
          i.registerOutput("shadow", Hl.Float, Wl.Fragment),
          i.registerOutput("alpha", Hl.Float, Wl.Fragment),
          i
        );
      }
      return (
        P(t, e),
        (t.prototype.initialize = function (e) {
          e._excludeVariableName("vLightingIntensity"),
            e._excludeVariableName("geometricNormalW"),
            e._excludeVariableName("normalW"),
            e._excludeVariableName("faceNormal"),
            e._excludeVariableName("albedoOpacityOut"),
            e._excludeVariableName("surfaceAlbedo"),
            e._excludeVariableName("alpha"),
            e._excludeVariableName("aoOut"),
            e._excludeVariableName("baseColor"),
            e._excludeVariableName("reflectivityOut"),
            e._excludeVariableName("microSurface"),
            e._excludeVariableName("roughness"),
            e._excludeVariableName("NdotVUnclamped"),
            e._excludeVariableName("NdotV"),
            e._excludeVariableName("alphaG"),
            e._excludeVariableName("AARoughnessFactors"),
            e._excludeVariableName("environmentBrdf"),
            e._excludeVariableName("ambientMonochrome"),
            e._excludeVariableName("seo"),
            e._excludeVariableName("eho"),
            e._excludeVariableName("environmentRadiance"),
            e._excludeVariableName("irradianceVector"),
            e._excludeVariableName("environmentIrradiance"),
            e._excludeVariableName("diffuseBase"),
            e._excludeVariableName("specularBase"),
            e._excludeVariableName("preInfo"),
            e._excludeVariableName("info"),
            e._excludeVariableName("shadow"),
            e._excludeVariableName("finalDiffuse"),
            e._excludeVariableName("finalAmbient"),
            e._excludeVariableName("ambientOcclusionForDirectDiffuse"),
            e._excludeVariableName("finalColor"),
            e._excludeVariableName("vClipSpacePosition"),
            e._excludeVariableName("vDebugMode");
        }),
        (t.prototype.getClassName = function () {
          return "PBRMetallicRoughnessBlock";
        }),
        Object.defineProperty(t.prototype, "worldPosition", {
          get: function () {
            return this._inputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "worldNormal", {
          get: function () {
            return this._inputs[1];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "view", {
          get: function () {
            return this._inputs[2];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "cameraPosition", {
          get: function () {
            return this._inputs[3];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "perturbedNormal", {
          get: function () {
            return this._inputs[4];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "baseColor", {
          get: function () {
            return this._inputs[5];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "metallic", {
          get: function () {
            return this._inputs[6];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "roughness", {
          get: function () {
            return this._inputs[7];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "ambientOcc", {
          get: function () {
            return this._inputs[8];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "opacity", {
          get: function () {
            return this._inputs[9];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "indexOfRefraction", {
          get: function () {
            return this._inputs[10];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "ambientColor", {
          get: function () {
            return this._inputs[11];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "reflection", {
          get: function () {
            return this._inputs[12];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "clearcoat", {
          get: function () {
            return this._inputs[13];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "sheen", {
          get: function () {
            return this._inputs[14];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "subsurface", {
          get: function () {
            return this._inputs[15];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "anisotropy", {
          get: function () {
            return this._inputs[16];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "ambientClr", {
          get: function () {
            return this._outputs[0];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "diffuseDir", {
          get: function () {
            return this._outputs[1];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "specularDir", {
          get: function () {
            return this._outputs[2];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "clearcoatDir", {
          get: function () {
            return this._outputs[3];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "sheenDir", {
          get: function () {
            return this._outputs[4];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "diffuseIndirect", {
          get: function () {
            return this._outputs[5];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "specularIndirect", {
          get: function () {
            return this._outputs[6];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "clearcoatIndirect", {
          get: function () {
            return this._outputs[7];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "sheenIndirect", {
          get: function () {
            return this._outputs[8];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "refraction", {
          get: function () {
            return this._outputs[9];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "lighting", {
          get: function () {
            return this._outputs[10];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "shadow", {
          get: function () {
            return this._outputs[11];
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "alpha", {
          get: function () {
            return this._outputs[12];
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.autoConfigure = function (e) {
          if (!this.cameraPosition.isConnected) {
            var t = e.getInputBlockByPredicate(function (e) {
              return e.systemValue === Xl.CameraPosition;
            });
            t ||
              (t = new lc("cameraPosition")).setAsSystemValue(
                Xl.CameraPosition
              ),
              t.output.connectTo(this.cameraPosition);
          }
          if (!this.view.isConnected) {
            var i = e.getInputBlockByPredicate(function (e) {
              return e.systemValue === Xl.View;
            });
            i || (i = new lc("view")).setAsSystemValue(Xl.View),
              i.output.connectTo(this.view);
          }
        }),
        (t.prototype.prepareDefines = function (e, t, i) {
          i.setValue("PBR", !0),
            i.setValue("METALLICWORKFLOW", !0),
            i.setValue("DEBUGMODE", this.debugMode, !0),
            i.setValue("NORMALXYSCALE", !0),
            i.setValue("BUMP", this.perturbedNormal.isConnected, !0),
            i.setValue(
              "LODBASEDMICROSFURACE",
              this._scene.getEngine().getCaps().textureLOD
            ),
            i.setValue("ALBEDO", !1, !0),
            i.setValue("OPACITY", this.opacity.isConnected, !0),
            i.setValue("AMBIENT", !0, !0),
            i.setValue("AMBIENTINGRAYSCALE", !1, !0),
            i.setValue("REFLECTIVITY", !1, !0),
            i.setValue("AOSTOREINMETALMAPRED", !1, !0),
            i.setValue("METALLNESSSTOREINMETALMAPBLUE", !1, !0),
            i.setValue("ROUGHNESSSTOREINMETALMAPALPHA", !1, !0),
            i.setValue("ROUGHNESSSTOREINMETALMAPGREEN", !1, !0),
            this.lightFalloff === qs.LIGHTFALLOFF_STANDARD
              ? (i.setValue("USEPHYSICALLIGHTFALLOFF", !1),
                i.setValue("USEGLTFLIGHTFALLOFF", !1))
              : this.lightFalloff === qs.LIGHTFALLOFF_GLTF
                ? (i.setValue("USEPHYSICALLIGHTFALLOFF", !1),
                  i.setValue("USEGLTFLIGHTFALLOFF", !0))
                : (i.setValue("USEPHYSICALLIGHTFALLOFF", !0),
                  i.setValue("USEGLTFLIGHTFALLOFF", !1));
          var n = this.alphaTestCutoff.toString();
          if (
            (i.setValue("ALPHABLEND", this.useAlphaBlending, !0),
            i.setValue("ALPHAFROMALBEDO", !1, !0),
            i.setValue("ALPHATEST", this.useAlphaTest, !0),
            i.setValue("ALPHATESTVALUE", n.indexOf(".") < 0 ? n + "." : n, !0),
            i.setValue("OPACITYRGB", !1, !0),
            i.setValue("RADIANCEOVERALPHA", this.useRadianceOverAlpha, !0),
            i.setValue("SPECULAROVERALPHA", this.useSpecularOverAlpha, !0),
            i.setValue(
              "SPECULARAA",
              this._scene.getEngine().getCaps().standardDerivatives &&
                this.enableSpecularAntiAliasing,
              !0
            ),
            i.setValue("REALTIME_FILTERING", this.realTimeFiltering, !0),
            this._scene.getEngine().webGLVersion > 1
              ? i.setValue(
                  "NUM_SAMPLES",
                  this.realTimeFilteringQuality + "u",
                  !0
                )
              : i.setValue(
                  "NUM_SAMPLES",
                  "" + this.realTimeFilteringQuality,
                  !0
                ),
            i.setValue("BRDF_V_HEIGHT_CORRELATED", !0),
            i.setValue(
              "MS_BRDF_ENERGY_CONSERVATION",
              this.useEnergyConservation,
              !0
            ),
            i.setValue("RADIANCEOCCLUSION", this.useRadianceOcclusion, !0),
            i.setValue("HORIZONOCCLUSION", this.useHorizonOcclusion, !0),
            i.setValue("UNLIT", this.unlit, !0),
            i.setValue("FORCENORMALFORWARD", this.forceNormalForward, !0),
            this._environmentBRDFTexture && jr.ReflectionTextureEnabled
              ? (i.setValue("ENVIRONMENTBRDF", !0),
                i.setValue(
                  "ENVIRONMENTBRDF_RGBD",
                  this._environmentBRDFTexture.isRGBD,
                  !0
                ))
              : (i.setValue("ENVIRONMENTBRDF", !1),
                i.setValue("ENVIRONMENTBRDF_RGBD", !1)),
            i._areLightsDirty)
          ) {
            var r = e.getScene();
            if (this.light) {
              var o = {
                needNormals: !1,
                needRebuild: !1,
                lightmapMode: !1,
                shadowEnabled: !1,
                specularEnabled: !1,
              };
              Hr.PrepareDefinesForLight(
                r,
                e,
                this.light,
                this._lightId,
                i,
                !0,
                o
              ),
                o.needRebuild && i.rebuild();
            } else
              Hr.PrepareDefinesForLights(r, e, i, !0, t.maxSimultaneousLights),
                (i._needNormals = !0),
                Hr.PrepareDefinesForMultiview(r, i);
          }
        }),
        (t.prototype.updateUniformsAndSamples = function (e, t, i, n) {
          for (var r = 0; r < t.maxSimultaneousLights && i["LIGHT" + r]; r++) {
            var o = e.uniforms.indexOf("vLightData" + r) >= 0;
            Hr.PrepareUniformsAndSamplersForLight(
              r,
              e.uniforms,
              e.samplers,
              i["PROJECTEDLIGHTTEXTURE" + r],
              n,
              o
            );
          }
        }),
        (t.prototype.bind = function (e, t, i) {
          var n, r;
          if (i) {
            var o = i.getScene();
            this.light
              ? Hr.BindLight(this.light, this._lightId, o, e, !0)
              : Hr.BindLights(o, i, e, !0, t.maxSimultaneousLights),
              e.setTexture(
                this._environmentBrdfSamplerName,
                this._environmentBRDFTexture
              ),
              e.setFloat2("vDebugMode", this.debugLimit, this.debugFactor);
            var s = this._scene.ambientColor;
            s && e.setColor3("ambientFromScene", s);
            var a =
              o.useRightHandedSystem === (null != o._mirroredCameraPosition);
            e.setFloat(this._invertNormalName, a ? -1 : 1),
              e.setFloat4(
                "vLightingIntensity",
                this.directIntensity,
                1,
                this.environmentIntensity * this._scene.environmentIntensity,
                this.specularIntensity
              );
            var l =
                null !==
                  (r =
                    null === (n = this.indexOfRefraction.connectInputBlock) ||
                    void 0 === n
                      ? void 0
                      : n.value) && void 0 !== r
                  ? r
                  : 1.5,
              c = Math.pow((l - 1) / (l + 1), 2);
            this._metallicReflectanceColor.scaleToRef(
              c * this._metallicF0Factor,
              S.Color3[0]
            );
            var u = this._metallicF0Factor;
            e.setColor4(this._vMetallicReflectanceFactorsName, S.Color3[0], u);
          }
        }),
        (t.prototype._injectVertexCode = function (e) {
          var t,
            i,
            n = this.worldPosition,
            r = "//" + this.name;
          this.light
            ? ((this._lightId =
                (void 0 !== e.counters.lightCounter
                  ? e.counters.lightCounter
                  : -1) + 1),
              (e.counters.lightCounter = this._lightId),
              e._emitFunctionFromInclude(
                e.supportUniformBuffers
                  ? "lightUboDeclaration"
                  : "lightFragmentDeclaration",
                r,
                {
                  replaceStrings: [
                    {
                      search: /{X}/g,
                      replace: this._lightId.toString(),
                    },
                  ],
                },
                this._lightId.toString()
              ))
            : (e._emitFunctionFromInclude(
                e.supportUniformBuffers
                  ? "lightUboDeclaration"
                  : "lightFragmentDeclaration",
                r,
                {
                  repeatKey: "maxSimultaneousLights",
                }
              ),
              (this._lightId = 0),
              e.sharedData.dynamicUniformBlocks.push(this));
          var o = "v_" + n.associatedVariableName;
          e._emitVaryingFromString(o, "vec4") &&
            (e.compilationString +=
              o + " = " + n.associatedVariableName + ";\r\n");
          var s = this.reflection.isConnected
            ? null === (t = this.reflection.connectedPoint) || void 0 === t
              ? void 0
              : t.ownerBlock
            : null;
          s && (s.viewConnectionPoint = this.view),
            (e.compilationString +=
              null !== (i = null == s ? void 0 : s.handleVertexSide(e)) &&
              void 0 !== i
                ? i
                : ""),
            e._emitUniformFromString(
              "vDebugMode",
              "vec2",
              "defined(IGNORE) || DEBUGMODE > 0"
            ),
            e._emitUniformFromString("ambientFromScene", "vec3"),
            e._emitVaryingFromString(
              "vClipSpacePosition",
              "vec4",
              "defined(IGNORE) || DEBUGMODE > 0"
            ) &&
              ((e._injectAtEnd += "#if DEBUGMODE > 0\r\n"),
              (e._injectAtEnd += "vClipSpacePosition = gl_Position;\r\n"),
              (e._injectAtEnd += "#endif\r\n")),
            this.light
              ? (e.compilationString += e._emitCodeFromInclude(
                  "shadowsVertex",
                  r,
                  {
                    replaceStrings: [
                      {
                        search: /{X}/g,
                        replace: this._lightId.toString(),
                      },
                      {
                        search: /worldPos/g,
                        replace: n.associatedVariableName,
                      },
                    ],
                  }
                ))
              : ((e.compilationString +=
                  "vec4 worldPos = " + n.associatedVariableName + ";\r\n"),
                this.view.isConnected &&
                  (e.compilationString +=
                    "mat4 view = " +
                    this.view.associatedVariableName +
                    ";\r\n"),
                (e.compilationString += e._emitCodeFromInclude(
                  "shadowsVertex",
                  r,
                  {
                    repeatKey: "maxSimultaneousLights",
                  }
                )));
        }),
        (t.prototype._getAlbedoOpacityCode = function () {
          return (
            "albedoOpacityOutParams albedoOpacityOut;\r\n" +
            "albedoOpacityBlock(\n                vec4(" +
            (this.baseColor.isConnected
              ? this.baseColor.associatedVariableName
              : "vec3(1.)") +
            ", 1.),\n            #ifdef ALBEDO\n                vec4(1.),\n                vec2(1., 1.),\n            #endif\n            #ifdef OPACITY\n                vec4(" +
            (this.opacity.isConnected
              ? this.opacity.associatedVariableName
              : "1.") +
            "),\n                vec2(1., 1.),\n            #endif\n                albedoOpacityOut\n            );\n\n            vec3 surfaceAlbedo = albedoOpacityOut.surfaceAlbedo;\n            float alpha = albedoOpacityOut.alpha;\r\n"
          );
        }),
        (t.prototype._getAmbientOcclusionCode = function () {
          return (
            "ambientOcclusionOutParams aoOut;\r\n" +
            "ambientOcclusionBlock(\n            #ifdef AMBIENT\n                vec3(" +
            (this.ambientOcc.isConnected
              ? this.ambientOcc.associatedVariableName
              : "1.") +
            "),\n                vec4(0., 1.0, 1.0, 0.),\n            #endif\n                aoOut\n            );\r\n"
          );
        }),
        (t.prototype._getReflectivityCode = function (e) {
          var t = "reflectivityOutParams reflectivityOut;\r\n";
          return (
            (this._vMetallicReflectanceFactorsName = e._getFreeVariableName(
              "vMetallicReflectanceFactors"
            )),
            e._emitUniformFromString(
              this._vMetallicReflectanceFactorsName,
              "vec4"
            ),
            t +
              "vec3 baseColor = surfaceAlbedo;\n\n            reflectivityBlock(\n                vec4(" +
              this.metallic.associatedVariableName +
              ", " +
              this.roughness.associatedVariableName +
              ", 0., 0.),\n            #ifdef METALLICWORKFLOW\n                surfaceAlbedo,\n                " +
              this._vMetallicReflectanceFactorsName +
              ",\n            #endif\n            #ifdef REFLECTIVITY\n                vec3(0., 0., 1.),\n                vec4(1.),\n            #endif\n            #if defined(METALLICWORKFLOW) && defined(REFLECTIVITY)  && defined(AOSTOREINMETALMAPRED)\n                aoOut.ambientOcclusionColor,\n            #endif\n            #ifdef MICROSURFACEMAP\n                microSurfaceTexel, <== not handled!\n            #endif\n                reflectivityOut\n            );\n\n            float microSurface = reflectivityOut.microSurface;\n            float roughness = reflectivityOut.roughness;\n\n            #ifdef METALLICWORKFLOW\n                surfaceAlbedo = reflectivityOut.surfaceAlbedo;\n            #endif\n            #if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\n                aoOut.ambientOcclusionColor = reflectivityOut.ambientOcclusionColor;\n            #endif\r\n"
          );
        }),
        (t.prototype._buildBlock = function (t) {
          var i,
            n,
            r,
            o,
            s,
            a,
            l,
            c,
            u,
            h,
            d,
            p,
            f,
            _,
            m,
            g,
            v,
            y,
            b,
            T,
            S,
            C,
            x,
            E,
            P,
            A,
            R,
            M,
            O,
            I,
            D,
            w,
            N,
            L,
            F,
            B,
            V,
            k,
            U;
          e.prototype._buildBlock.call(this, t),
            (this._scene = t.sharedData.scene),
            this._environmentBRDFTexture ||
              (this._environmentBRDFTexture = Gs.GetEnvironmentBRDFTexture(
                this._scene
              ));
          var z = this.reflection.isConnected
            ? null === (i = this.reflection.connectedPoint) || void 0 === i
              ? void 0
              : i.ownerBlock
            : null;
          if (
            (z &&
              ((z.worldPositionConnectionPoint = this.worldPosition),
              (z.cameraPositionConnectionPoint = this.cameraPosition),
              (z.worldNormalConnectionPoint = this.worldNormal)),
            t.target !== Wl.Fragment)
          )
            return this._injectVertexCode(t), this;
          t.sharedData.bindableBlocks.push(this),
            t.sharedData.blocksWithDefines.push(this);
          var G = "//" + this.name,
            W = "v_" + this.worldPosition.associatedVariableName,
            H = this.perturbedNormal;
          (this._environmentBrdfSamplerName = t._getFreeVariableName(
            "environmentBrdfSampler"
          )),
            t._emit2DSampler(this._environmentBrdfSamplerName),
            (t.sharedData.hints.needAlphaBlending =
              t.sharedData.hints.needAlphaBlending || this.useAlphaBlending),
            (t.sharedData.hints.needAlphaTesting =
              t.sharedData.hints.needAlphaTesting || this.useAlphaTest),
            t._emitExtension(
              "lod",
              "#extension GL_EXT_shader_texture_lod : enable",
              "defined(LODBASEDMICROSFURACE)"
            ),
            t._emitExtension(
              "derivatives",
              "#extension GL_OES_standard_derivatives : enable"
            ),
            this.light
              ? t._emitFunctionFromInclude(
                  t.supportUniformBuffers
                    ? "lightUboDeclaration"
                    : "lightFragmentDeclaration",
                  G,
                  {
                    replaceStrings: [
                      {
                        search: /{X}/g,
                        replace: this._lightId.toString(),
                      },
                    ],
                  },
                  this._lightId.toString()
                )
              : t._emitFunctionFromInclude(
                  t.supportUniformBuffers
                    ? "lightUboDeclaration"
                    : "lightFragmentDeclaration",
                  G,
                  {
                    repeatKey: "maxSimultaneousLights",
                  }
                ),
            t._emitFunctionFromInclude("helperFunctions", G),
            t._emitFunctionFromInclude("importanceSampling", G),
            t._emitFunctionFromInclude("pbrHelperFunctions", G),
            t._emitFunctionFromInclude("imageProcessingFunctions", G),
            t._emitFunctionFromInclude("shadowsFragmentFunctions", G, {
              replaceStrings: [
                {
                  search: /vPositionW/g,
                  replace: W + ".xyz",
                },
              ],
            }),
            t._emitFunctionFromInclude("pbrDirectLightingSetupFunctions", G, {
              replaceStrings: [
                {
                  search: /vPositionW/g,
                  replace: W + ".xyz",
                },
              ],
            }),
            t._emitFunctionFromInclude("pbrDirectLightingFalloffFunctions", G),
            t._emitFunctionFromInclude("pbrBRDFFunctions", G, {
              replaceStrings: [
                {
                  search: /REFLECTIONMAP_SKYBOX/g,
                  replace:
                    null !== (n = null == z ? void 0 : z._defineSkyboxName) &&
                    void 0 !== n
                      ? n
                      : "REFLECTIONMAP_SKYBOX",
                },
              ],
            }),
            t._emitFunctionFromInclude("hdrFilteringFunctions", G),
            t._emitFunctionFromInclude("pbrDirectLightingFunctions", G, {
              replaceStrings: [
                {
                  search: /vPositionW/g,
                  replace: W + ".xyz",
                },
              ],
            }),
            t._emitFunctionFromInclude("pbrIBLFunctions", G),
            t._emitFunctionFromInclude("pbrBlockAlbedoOpacity", G),
            t._emitFunctionFromInclude("pbrBlockReflectivity", G),
            t._emitFunctionFromInclude("pbrBlockAmbientOcclusion", G),
            t._emitFunctionFromInclude("pbrBlockAlphaFresnel", G),
            t._emitFunctionFromInclude("pbrBlockAnisotropic", G),
            t._emitUniformFromString("vLightingIntensity", "vec4"),
            (this._vNormalWName = t._getFreeVariableName("vNormalW")),
            (t.compilationString +=
              "vec4 " +
              this._vNormalWName +
              " = normalize(" +
              this.worldNormal.associatedVariableName +
              ");\r\n"),
            t._registerTempVariable("viewDirectionW") &&
              (t.compilationString +=
                "vec3 viewDirectionW = normalize(" +
                this.cameraPosition.associatedVariableName +
                " - " +
                W +
                ".xyz);\r\n"),
            (t.compilationString +=
              "vec3 geometricNormalW = " + this._vNormalWName + ".xyz;\r\n"),
            (t.compilationString +=
              "vec3 normalW = " +
              (H.isConnected
                ? "normalize(" + H.associatedVariableName + ".xyz)"
                : "geometricNormalW") +
              ";\r\n"),
            (this._invertNormalName = t._getFreeVariableName("invertNormal")),
            t._emitUniformFromString(this._invertNormalName, "float"),
            (t.compilationString += t._emitCodeFromInclude(
              "pbrBlockNormalFinal",
              G,
              {
                replaceStrings: [
                  {
                    search: /vPositionW/g,
                    replace: W + ".xyz",
                  },
                  {
                    search: /vEyePosition.w/g,
                    replace: this._invertNormalName,
                  },
                ],
              }
            )),
            (t.compilationString += this._getAlbedoOpacityCode()),
            (t.compilationString += t._emitCodeFromInclude("depthPrePass", G)),
            (t.compilationString += this._getAmbientOcclusionCode()),
            (t.compilationString += t._emitCodeFromInclude(
              "pbrBlockLightmapInit",
              G
            )),
            (t.compilationString +=
              "#ifdef UNLIT\n                vec3 diffuseBase = vec3(1., 1., 1.);\n            #else\r\n"),
            (t.compilationString += this._getReflectivityCode(t)),
            (t.compilationString += t._emitCodeFromInclude(
              "pbrBlockGeometryInfo",
              G,
              {
                replaceStrings: [
                  {
                    search: /REFLECTIONMAP_SKYBOX/g,
                    replace:
                      null !== (r = null == z ? void 0 : z._defineSkyboxName) &&
                      void 0 !== r
                        ? r
                        : "REFLECTIONMAP_SKYBOX",
                  },
                  {
                    search: /REFLECTIONMAP_3D/g,
                    replace:
                      null !== (o = null == z ? void 0 : z._define3DName) &&
                      void 0 !== o
                        ? o
                        : "REFLECTIONMAP_3D",
                  },
                ],
              }
            ));
          var j = this.anisotropy.isConnected
            ? null === (s = this.anisotropy.connectedPoint) || void 0 === s
              ? void 0
              : s.ownerBlock
            : null;
          j &&
            ((j.worldPositionConnectionPoint = this.worldPosition),
            (j.worldNormalConnectionPoint = this.worldNormal),
            (t.compilationString += j.getCode(
              t,
              !this.perturbedNormal.isConnected
            ))),
            z &&
              z.hasTexture &&
              (t.compilationString += z.getCode(
                t,
                j ? "anisotropicOut.anisotropicNormal" : "normalW"
              )),
            t._emitFunctionFromInclude("pbrBlockReflection", G, {
              replaceStrings: [
                {
                  search: /computeReflectionCoords/g,
                  replace: "computeReflectionCoordsPBR",
                },
                {
                  search: /REFLECTIONMAP_3D/g,
                  replace:
                    null !== (a = null == z ? void 0 : z._define3DName) &&
                    void 0 !== a
                      ? a
                      : "REFLECTIONMAP_3D",
                },
                {
                  search: /REFLECTIONMAP_OPPOSITEZ/g,
                  replace:
                    null !== (l = null == z ? void 0 : z._defineOppositeZ) &&
                    void 0 !== l
                      ? l
                      : "REFLECTIONMAP_OPPOSITEZ",
                },
                {
                  search: /REFLECTIONMAP_PROJECTION/g,
                  replace:
                    null !==
                      (c = null == z ? void 0 : z._defineProjectionName) &&
                    void 0 !== c
                      ? c
                      : "REFLECTIONMAP_PROJECTION",
                },
                {
                  search: /REFLECTIONMAP_SKYBOX/g,
                  replace:
                    null !== (u = null == z ? void 0 : z._defineSkyboxName) &&
                    void 0 !== u
                      ? u
                      : "REFLECTIONMAP_SKYBOX",
                },
                {
                  search: /LODINREFLECTIONALPHA/g,
                  replace:
                    null !==
                      (h = null == z ? void 0 : z._defineLODReflectionAlpha) &&
                    void 0 !== h
                      ? h
                      : "LODINREFLECTIONALPHA",
                },
                {
                  search: /LINEARSPECULARREFLECTION/g,
                  replace:
                    null !==
                      (d =
                        null == z
                          ? void 0
                          : z._defineLinearSpecularReflection) && void 0 !== d
                      ? d
                      : "LINEARSPECULARREFLECTION",
                },
                {
                  search: /vReflectionFilteringInfo/g,
                  replace:
                    null !==
                      (p =
                        null == z ? void 0 : z._vReflectionFilteringInfoName) &&
                    void 0 !== p
                      ? p
                      : "vReflectionFilteringInfo",
                },
              ],
            }),
            (t.compilationString += t._emitCodeFromInclude(
              "pbrBlockReflectance0",
              G,
              {
                replaceStrings: [
                  {
                    search: /metallicReflectanceFactors/g,
                    replace: this._vMetallicReflectanceFactorsName,
                  },
                ],
              }
            ));
          var X = this.sheen.isConnected
            ? null === (f = this.sheen.connectedPoint) || void 0 === f
              ? void 0
              : f.ownerBlock
            : null;
          X && (t.compilationString += X.getCode(z)),
            t._emitFunctionFromInclude("pbrBlockSheen", G, {
              replaceStrings: [
                {
                  search: /REFLECTIONMAP_3D/g,
                  replace:
                    null !== (_ = null == z ? void 0 : z._define3DName) &&
                    void 0 !== _
                      ? _
                      : "REFLECTIONMAP_3D",
                },
                {
                  search: /REFLECTIONMAP_SKYBOX/g,
                  replace:
                    null !== (m = null == z ? void 0 : z._defineSkyboxName) &&
                    void 0 !== m
                      ? m
                      : "REFLECTIONMAP_SKYBOX",
                },
                {
                  search: /LODINREFLECTIONALPHA/g,
                  replace:
                    null !==
                      (g = null == z ? void 0 : z._defineLODReflectionAlpha) &&
                    void 0 !== g
                      ? g
                      : "LODINREFLECTIONALPHA",
                },
                {
                  search: /LINEARSPECULARREFLECTION/g,
                  replace:
                    null !==
                      (v =
                        null == z
                          ? void 0
                          : z._defineLinearSpecularReflection) && void 0 !== v
                      ? v
                      : "LINEARSPECULARREFLECTION",
                },
              ],
            });
          var Y = this.clearcoat.isConnected
              ? null === (y = this.clearcoat.connectedPoint) || void 0 === y
                ? void 0
                : y.ownerBlock
              : null,
            K =
              !this.perturbedNormal.isConnected && !this.anisotropy.isConnected,
            Q =
              this.perturbedNormal.isConnected &&
              (null === (b = this.perturbedNormal.connectedPoint) ||
              void 0 === b
                ? void 0
                : b.ownerBlock
              ).worldTangent.isConnected,
            q =
              this.anisotropy.isConnected &&
              (null === (T = this.anisotropy.connectedPoint) || void 0 === T
                ? void 0
                : T.ownerBlock
              ).worldTangent.isConnected,
            Z = Q || (!this.perturbedNormal.isConnected && q);
          (t.compilationString += Uu.GetCode(
            t,
            Y,
            z,
            W,
            K,
            Z,
            this.worldNormal.associatedVariableName
          )),
            K &&
              (Z =
                null !==
                  (S = null == Y ? void 0 : Y.worldTangent.isConnected) &&
                void 0 !== S &&
                S),
            t._emitFunctionFromInclude("pbrBlockClearcoat", G, {
              replaceStrings: [
                {
                  search: /computeReflectionCoords/g,
                  replace: "computeReflectionCoordsPBR",
                },
                {
                  search: /REFLECTIONMAP_3D/g,
                  replace:
                    null !== (C = null == z ? void 0 : z._define3DName) &&
                    void 0 !== C
                      ? C
                      : "REFLECTIONMAP_3D",
                },
                {
                  search: /REFLECTIONMAP_OPPOSITEZ/g,
                  replace:
                    null !== (x = null == z ? void 0 : z._defineOppositeZ) &&
                    void 0 !== x
                      ? x
                      : "REFLECTIONMAP_OPPOSITEZ",
                },
                {
                  search: /REFLECTIONMAP_PROJECTION/g,
                  replace:
                    null !==
                      (E = null == z ? void 0 : z._defineProjectionName) &&
                    void 0 !== E
                      ? E
                      : "REFLECTIONMAP_PROJECTION",
                },
                {
                  search: /REFLECTIONMAP_SKYBOX/g,
                  replace:
                    null !== (P = null == z ? void 0 : z._defineSkyboxName) &&
                    void 0 !== P
                      ? P
                      : "REFLECTIONMAP_SKYBOX",
                },
                {
                  search: /LODINREFLECTIONALPHA/g,
                  replace:
                    null !==
                      (A = null == z ? void 0 : z._defineLODReflectionAlpha) &&
                    void 0 !== A
                      ? A
                      : "LODINREFLECTIONALPHA",
                },
                {
                  search: /LINEARSPECULARREFLECTION/g,
                  replace:
                    null !==
                      (R =
                        null == z
                          ? void 0
                          : z._defineLinearSpecularReflection) && void 0 !== R
                      ? R
                      : "LINEARSPECULARREFLECTION",
                },
                {
                  search: /defined\(TANGENT\)/g,
                  replace: Z ? "defined(TANGENT)" : "defined(IGNORE)",
                },
              ],
            }),
            (t.compilationString += t._emitCodeFromInclude(
              "pbrBlockReflectance",
              G,
              {
                replaceStrings: [
                  {
                    search: /REFLECTIONMAP_SKYBOX/g,
                    replace:
                      null !== (M = null == z ? void 0 : z._defineSkyboxName) &&
                      void 0 !== M
                        ? M
                        : "REFLECTIONMAP_SKYBOX",
                  },
                  {
                    search: /REFLECTIONMAP_3D/g,
                    replace:
                      null !== (O = null == z ? void 0 : z._define3DName) &&
                      void 0 !== O
                        ? O
                        : "REFLECTIONMAP_3D",
                  },
                ],
              }
            ));
          var J = this.subsurface.isConnected
              ? null === (I = this.subsurface.connectedPoint) || void 0 === I
                ? void 0
                : I.ownerBlock
              : null,
            $ = this.subsurface.isConnected
              ? null ===
                  (w = (
                    null === (D = this.subsurface.connectedPoint) ||
                    void 0 === D
                      ? void 0
                      : D.ownerBlock
                  ).refraction.connectedPoint) || void 0 === w
                ? void 0
                : w.ownerBlock
              : null;
          $ &&
            (($.viewConnectionPoint = this.view),
            ($.indexOfRefractionConnectionPoint = this.indexOfRefraction)),
            (t.compilationString += Gu.GetCode(t, J, z, W)),
            t._emitFunctionFromInclude("pbrBlockSubSurface", G, {
              replaceStrings: [
                {
                  search: /REFLECTIONMAP_3D/g,
                  replace:
                    null !== (N = null == z ? void 0 : z._define3DName) &&
                    void 0 !== N
                      ? N
                      : "REFLECTIONMAP_3D",
                },
                {
                  search: /REFLECTIONMAP_OPPOSITEZ/g,
                  replace:
                    null !== (L = null == z ? void 0 : z._defineOppositeZ) &&
                    void 0 !== L
                      ? L
                      : "REFLECTIONMAP_OPPOSITEZ",
                },
                {
                  search: /REFLECTIONMAP_PROJECTION/g,
                  replace:
                    null !==
                      (F = null == z ? void 0 : z._defineProjectionName) &&
                    void 0 !== F
                      ? F
                      : "REFLECTIONMAP_PROJECTION",
                },
                {
                  search: /SS_REFRACTIONMAP_3D/g,
                  replace:
                    null !== (B = null == $ ? void 0 : $._define3DName) &&
                    void 0 !== B
                      ? B
                      : "SS_REFRACTIONMAP_3D",
                },
                {
                  search: /SS_LODINREFRACTIONALPHA/g,
                  replace:
                    null !==
                      (V = null == $ ? void 0 : $._defineLODRefractionAlpha) &&
                    void 0 !== V
                      ? V
                      : "SS_LODINREFRACTIONALPHA",
                },
                {
                  search: /SS_LINEARSPECULARREFRACTION/g,
                  replace:
                    null !==
                      (k =
                        null == $
                          ? void 0
                          : $._defineLinearSpecularRefraction) && void 0 !== k
                      ? k
                      : "SS_LINEARSPECULARREFRACTION",
                },
                {
                  search: /SS_REFRACTIONMAP_OPPOSITEZ/g,
                  replace:
                    null !== (U = null == $ ? void 0 : $._defineOppositeZ) &&
                    void 0 !== U
                      ? U
                      : "SS_REFRACTIONMAP_OPPOSITEZ",
                },
              ],
            }),
            (t.compilationString += t._emitCodeFromInclude(
              "pbrBlockDirectLighting",
              G
            )),
            this.light
              ? (t.compilationString += t._emitCodeFromInclude(
                  "lightFragment",
                  G,
                  {
                    replaceStrings: [
                      {
                        search: /{X}/g,
                        replace: this._lightId.toString(),
                      },
                    ],
                  }
                ))
              : (t.compilationString += t._emitCodeFromInclude(
                  "lightFragment",
                  G,
                  {
                    repeatKey: "maxSimultaneousLights",
                  }
                )),
            (t.compilationString += t._emitCodeFromInclude(
              "pbrBlockFinalLitComponents",
              G
            )),
            (t.compilationString += "#endif\r\n");
          var ee = this.ambientColor.isConnected
              ? this.ambientColor.associatedVariableName
              : "vec3(0., 0., 0.)",
            te = qs.DEFAULT_AO_ON_ANALYTICAL_LIGHTS.toString();
          -1 === te.indexOf(".") && (te += "."),
            (t.compilationString += t._emitCodeFromInclude(
              "pbrBlockFinalUnlitComponents",
              G,
              {
                replaceStrings: [
                  {
                    search:
                      /vec3 finalEmissive[\s\S]*?finalEmissive\*=vLightingIntensity\.y;/g,
                    replace: "",
                  },
                  {
                    search: /vAmbientColor/g,
                    replace: ee + " * ambientFromScene",
                  },
                  {
                    search: /vAmbientInfos\.w/g,
                    replace: te,
                  },
                ],
              }
            )),
            (t.compilationString += t._emitCodeFromInclude(
              "pbrBlockFinalColorComposition",
              G,
              {
                replaceStrings: [
                  {
                    search: /finalEmissive/g,
                    replace: "vec3(0.)",
                  },
                ],
              }
            )),
            (t.compilationString += t._emitCodeFromInclude(
              "pbrBlockImageProcessing",
              G,
              {
                replaceStrings: [
                  {
                    search: /visibility/g,
                    replace: "1.",
                  },
                ],
              }
            )),
            (t.compilationString += t._emitCodeFromInclude("pbrDebug", G, {
              replaceStrings: [
                {
                  search: /vNormalW/g,
                  replace: this._vNormalWName,
                },
                {
                  search: /vPositionW/g,
                  replace: W,
                },
                {
                  search: /albedoTexture\.rgb;/g,
                  replace:
                    "vec3(1.);\r\ngl_FragColor.rgb = toGammaSpace(gl_FragColor.rgb);\r\n",
                },
              ],
            }));
          for (var ie = 0, ne = this._outputs; ie < ne.length; ie++) {
            var re = ne[ie];
            if (re.hasEndpoints) {
              var oe = Wu[re.name];
              if (oe) {
                var se = oe[0],
                  ae = oe[1];
                ae && (t.compilationString += "#if " + ae + "\r\n"),
                  (t.compilationString +=
                    this._declareOutput(re, t) + " = " + se + ";\r\n"),
                  ae &&
                    ((t.compilationString += "#else\r\n"),
                    (t.compilationString +=
                      this._declareOutput(re, t) + " = vec3(0.);\r\n"),
                    (t.compilationString += "#endif\r\n"));
              } else
                console.error(
                  "There's no remapping for the " +
                    re.name +
                    " end point! No code generated"
                );
            }
          }
          return this;
        }),
        (t.prototype._dumpPropertiesCode = function () {
          var e = "";
          return (
            (e +=
              this._codeVariableName +
              ".lightFalloff = " +
              this.lightFalloff +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".useAlphaTest = " +
              this.useAlphaTest +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".alphaTestCutoff = " +
              this.alphaTestCutoff +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".useAlphaBlending = " +
              this.useAlphaBlending +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".useRadianceOverAlpha = " +
              this.useRadianceOverAlpha +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".useSpecularOverAlpha = " +
              this.useSpecularOverAlpha +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".enableSpecularAntiAliasing = " +
              this.enableSpecularAntiAliasing +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".realTimeFiltering = " +
              this.realTimeFiltering +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".realTimeFilteringQuality = " +
              this.realTimeFilteringQuality +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".useEnergyConservation = " +
              this.useEnergyConservation +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".useRadianceOcclusion = " +
              this.useRadianceOcclusion +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".useHorizonOcclusion = " +
              this.useHorizonOcclusion +
              ";\r\n"),
            (e += this._codeVariableName + ".unlit = " + this.unlit + ";\r\n"),
            (e +=
              this._codeVariableName +
              ".forceNormalForward = " +
              this.forceNormalForward +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".debugMode = " +
              this.debugMode +
              ";\r\n"),
            (e +=
              this._codeVariableName +
              ".debugLimit = " +
              this.debugLimit +
              ";\r\n") +
              (this._codeVariableName + ".debugFactor = ") +
              this.debugFactor +
              ";\r\n"
          );
        }),
        (t.prototype.serialize = function () {
          var t = e.prototype.serialize.call(this);
          return (
            this.light && (t.lightId = this.light.id),
            (t.lightFalloff = this.lightFalloff),
            (t.useAlphaTest = this.useAlphaTest),
            (t.alphaTestCutoff = this.alphaTestCutoff),
            (t.useAlphaBlending = this.useAlphaBlending),
            (t.useRadianceOverAlpha = this.useRadianceOverAlpha),
            (t.useSpecularOverAlpha = this.useSpecularOverAlpha),
            (t.enableSpecularAntiAliasing = this.enableSpecularAntiAliasing),
            (t.realTimeFiltering = this.realTimeFiltering),
            (t.realTimeFilteringQuality = this.realTimeFilteringQuality),
            (t.useEnergyConservation = this.useEnergyConservation),
            (t.useRadianceOcclusion = this.useRadianceOcclusion),
            (t.useHorizonOcclusion = this.useHorizonOcclusion),
            (t.unlit = this.unlit),
            (t.forceNormalForward = this.forceNormalForward),
            (t.debugMode = this.debugMode),
            (t.debugLimit = this.debugLimit),
            (t.debugFactor = this.debugFactor),
            t
          );
        }),
        (t.prototype._deserialize = function (t, i, n) {
          var r, o;
          e.prototype._deserialize.call(this, t, i, n),
            t.lightId && (this.light = i.getLightByID(t.lightId)),
            (this.lightFalloff =
              null !== (r = t.lightFalloff) && void 0 !== r ? r : 0),
            (this.useAlphaTest = t.useAlphaTest),
            (this.alphaTestCutoff = t.alphaTestCutoff),
            (this.useAlphaBlending = t.useAlphaBlending),
            (this.useRadianceOverAlpha = t.useRadianceOverAlpha),
            (this.useSpecularOverAlpha = t.useSpecularOverAlpha),
            (this.enableSpecularAntiAliasing = t.enableSpecularAntiAliasing),
            (this.realTimeFiltering = !!t.realTimeFiltering),
            (this.realTimeFilteringQuality =
              null !== (o = t.realTimeFilteringQuality) && void 0 !== o
                ? o
                : 8),
            (this.useEnergyConservation = t.useEnergyConservation),
            (this.useRadianceOcclusion = t.useRadianceOcclusion),
            (this.useHorizonOcclusion = t.useHorizonOcclusion),
            (this.unlit = t.unlit),
            (this.forceNormalForward = !!t.forceNormalForward),
            (this.debugMode = t.debugMode),
            (this.debugLimit = t.debugLimit),
            (this.debugFactor = t.debugFactor);
        }),
        R(
          [
            _c("Direct lights", pc.Float, "INTENSITY", {
              min: 0,
              max: 1,
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "directIntensity",
          void 0
        ),
        R(
          [
            _c("Environment lights", pc.Float, "INTENSITY", {
              min: 0,
              max: 1,
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "environmentIntensity",
          void 0
        ),
        R(
          [
            _c("Specular highlights", pc.Float, "INTENSITY", {
              min: 0,
              max: 1,
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "specularIntensity",
          void 0
        ),
        R(
          [
            _c("Light falloff", pc.List, "LIGHTING & COLORS", {
              notifiers: {
                update: !0,
              },
              options: [
                {
                  label: "Physical",
                  value: qs.LIGHTFALLOFF_PHYSICAL,
                },
                {
                  label: "GLTF",
                  value: qs.LIGHTFALLOFF_GLTF,
                },
                {
                  label: "Standard",
                  value: qs.LIGHTFALLOFF_STANDARD,
                },
              ],
            }),
          ],
          t.prototype,
          "lightFalloff",
          void 0
        ),
        R(
          [_c("Alpha Testing", pc.Boolean, "OPACITY")],
          t.prototype,
          "useAlphaTest",
          void 0
        ),
        R(
          [
            _c("Alpha CutOff", pc.Float, "OPACITY", {
              min: 0,
              max: 1,
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "alphaTestCutoff",
          void 0
        ),
        R(
          [_c("Alpha blending", pc.Boolean, "OPACITY")],
          t.prototype,
          "useAlphaBlending",
          void 0
        ),
        R(
          [
            _c("Radiance over alpha", pc.Boolean, "RENDERING", {
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "useRadianceOverAlpha",
          void 0
        ),
        R(
          [
            _c("Specular over alpha", pc.Boolean, "RENDERING", {
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "useSpecularOverAlpha",
          void 0
        ),
        R(
          [
            _c("Specular anti-aliasing", pc.Boolean, "RENDERING", {
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "enableSpecularAntiAliasing",
          void 0
        ),
        R(
          [
            _c("Realtime filtering", pc.Boolean, "RENDERING", {
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "realTimeFiltering",
          void 0
        ),
        R(
          [
            _c("Realtime filtering quality", pc.List, "RENDERING", {
              notifiers: {
                update: !0,
              },
              options: [
                {
                  label: "Low",
                  value: 8,
                },
                {
                  label: "Medium",
                  value: 16,
                },
                {
                  label: "High",
                  value: 64,
                },
              ],
            }),
          ],
          t.prototype,
          "realTimeFilteringQuality",
          void 0
        ),
        R(
          [
            _c("Energy Conservation", pc.Boolean, "ADVANCED", {
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "useEnergyConservation",
          void 0
        ),
        R(
          [
            _c("Radiance occlusion", pc.Boolean, "ADVANCED", {
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "useRadianceOcclusion",
          void 0
        ),
        R(
          [
            _c("Horizon occlusion", pc.Boolean, "ADVANCED", {
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "useHorizonOcclusion",
          void 0
        ),
        R(
          [
            _c("Unlit", pc.Boolean, "ADVANCED", {
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "unlit",
          void 0
        ),
        R(
          [
            _c("Force normal forward", pc.Boolean, "ADVANCED", {
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "forceNormalForward",
          void 0
        ),
        R(
          [
            _c("Debug mode", pc.List, "DEBUG", {
              notifiers: {
                update: !0,
              },
              options: [
                {
                  label: "None",
                  value: 0,
                },
                {
                  label: "Normalized position",
                  value: 1,
                },
                {
                  label: "Normals",
                  value: 2,
                },
                {
                  label: "Tangents",
                  value: 3,
                },
                {
                  label: "Bitangents",
                  value: 4,
                },
                {
                  label: "Bump Normals",
                  value: 5,
                },
                {
                  label: "ClearCoat Normals",
                  value: 8,
                },
                {
                  label: "ClearCoat Tangents",
                  value: 9,
                },
                {
                  label: "ClearCoat Bitangents",
                  value: 10,
                },
                {
                  label: "Anisotropic Normals",
                  value: 11,
                },
                {
                  label: "Anisotropic Tangents",
                  value: 12,
                },
                {
                  label: "Anisotropic Bitangents",
                  value: 13,
                },
                {
                  label: "Env Refraction",
                  value: 40,
                },
                {
                  label: "Env Reflection",
                  value: 41,
                },
                {
                  label: "Env Clear Coat",
                  value: 42,
                },
                {
                  label: "Direct Diffuse",
                  value: 50,
                },
                {
                  label: "Direct Specular",
                  value: 51,
                },
                {
                  label: "Direct Clear Coat",
                  value: 52,
                },
                {
                  label: "Direct Sheen",
                  value: 53,
                },
                {
                  label: "Env Irradiance",
                  value: 54,
                },
                {
                  label: "Surface Albedo",
                  value: 60,
                },
                {
                  label: "Reflectance 0",
                  value: 61,
                },
                {
                  label: "Metallic",
                  value: 62,
                },
                {
                  label: "Metallic F0",
                  value: 71,
                },
                {
                  label: "Roughness",
                  value: 63,
                },
                {
                  label: "AlphaG",
                  value: 64,
                },
                {
                  label: "NdotV",
                  value: 65,
                },
                {
                  label: "ClearCoat Color",
                  value: 66,
                },
                {
                  label: "ClearCoat Roughness",
                  value: 67,
                },
                {
                  label: "ClearCoat NdotV",
                  value: 68,
                },
                {
                  label: "Transmittance",
                  value: 69,
                },
                {
                  label: "Refraction Transmittance",
                  value: 70,
                },
                {
                  label: "SEO",
                  value: 80,
                },
                {
                  label: "EHO",
                  value: 81,
                },
                {
                  label: "Energy Factor",
                  value: 82,
                },
                {
                  label: "Specular Reflectance",
                  value: 83,
                },
                {
                  label: "Clear Coat Reflectance",
                  value: 84,
                },
                {
                  label: "Sheen Reflectance",
                  value: 85,
                },
                {
                  label: "Luminance Over Alpha",
                  value: 86,
                },
                {
                  label: "Alpha",
                  value: 87,
                },
              ],
            }),
          ],
          t.prototype,
          "debugMode",
          void 0
        ),
        R(
          [
            _c("Split position", pc.Float, "DEBUG", {
              min: -1,
              max: 1,
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "debugLimit",
          void 0
        ),
        R(
          [
            _c("Output factor", pc.Float, "DEBUG", {
              min: 0,
              max: 5,
              notifiers: {
                update: !0,
              },
            }),
          ],
          t.prototype,
          "debugFactor",
          void 0
        ),
        t
      );
    })(Jl);
  h.RegisteredTypes["BABYLON.PBRMetallicRoughnessBlock"] = Hu;
  var ju = (function (e) {
    function t(t) {
      var i = e.call(this, t, Wl.Neutral) || this;
      return (
        i.registerInput("left", Hl.AutoDetect),
        i.registerInput("right", Hl.AutoDetect),
        i.registerOutput("output", Hl.BasedOnInput),
        (i._outputs[0]._typeConnectionSource = i._inputs[0]),
        i._linkConnectionTypes(0, 1),
        i
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ModBlock";
      }),
      Object.defineProperty(t.prototype, "left", {
        get: function () {
          return this._inputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "right", {
        get: function () {
          return this._inputs[1];
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "output", {
        get: function () {
          return this._outputs[0];
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildBlock = function (t) {
        e.prototype._buildBlock.call(this, t);
        var i = this._outputs[0];
        return (
          (t.compilationString +=
            this._declareOutput(i, t) +
            " = mod(" +
            this.left.associatedVariableName +
            ", " +
            this.right.associatedVariableName +
            ");\r\n"),
          this
        );
      }),
      t
    );
  })(Jl);
  h.RegisteredTypes["BABYLON.ModBlock"] = ju;
  var Xu = (function () {
    function e() {
      this.mm = new Map();
    }
    return (
      (e.prototype.get = function (e, t) {
        var i = this.mm.get(e);
        if (void 0 !== i) return i.get(t);
      }),
      (e.prototype.set = function (e, t, i) {
        var n = this.mm.get(e);
        void 0 === n && this.mm.set(e, (n = new Map())), n.set(t, i);
      }),
      e
    );
  })();
  function Yu(e, t, i, n, r) {
    var o = new e.DecoderBuffer();
    o.Init(t, t.byteLength);
    var s,
      a,
      l = new e.Decoder();
    try {
      var c = l.GetEncodedGeometryType(o);
      switch (c) {
        case e.TRIANGULAR_MESH:
          (s = new e.Mesh()), (a = l.DecodeBufferToMesh(o, s));
          break;
        case e.POINT_CLOUD:
          (s = new e.PointCloud()), (a = l.DecodeBufferToPointCloud(o, s));
          break;
        default:
          throw new Error("Invalid geometry type " + c);
      }
      if (!a.ok() || !s.ptr) throw new Error(a.error_msg());
      if (c === e.TRIANGULAR_MESH) {
        var u = 3 * s.num_faces(),
          h = 4 * u,
          d = e._malloc(h);
        try {
          l.GetTrianglesUInt32Array(s, h, d);
          var p = new Uint32Array(u);
          p.set(new Uint32Array(e.HEAPF32.buffer, d, u)), n(p);
        } finally {
          e._free(d);
        }
      }
      var f = function (t, i) {
        var n = i.num_components(),
          o = s.num_points(),
          a = o * n,
          c = a * Float32Array.BYTES_PER_ELEMENT,
          u = e._malloc(c);
        try {
          l.GetAttributeDataArrayForAllPoints(s, i, e.DT_FLOAT32, c, u);
          var h = new Float32Array(e.HEAPF32.buffer, u, a);
          if ("color" === t && 3 === n) {
            for (
              var d = new Float32Array(4 * o), p = 0, f = 0;
              p < d.length;
              p += 4, f += n
            )
              (d[p + 0] = h[f + 0]),
                (d[p + 1] = h[f + 1]),
                (d[p + 2] = h[f + 2]),
                (d[p + 3] = 1);
            r(t, d);
          } else
            (d = new Float32Array(a)).set(
              new Float32Array(e.HEAPF32.buffer, u, a)
            ),
              r(t, d);
        } finally {
          e._free(u);
        }
      };
      if (i)
        for (var _ in i) {
          var m = i[_];
          f(_, l.GetAttributeByUniqueId(s, m));
        }
      else {
        var g = {
          position: "POSITION",
          normal: "NORMAL",
          color: "COLOR",
          uv: "TEX_COORD",
        };
        for (var _ in g)
          -1 !== (m = l.GetAttributeId(s, e[g[_]])) &&
            f(_, l.GetAttribute(s, m));
      }
    } finally {
      s && e.destroy(s), e.destroy(l), e.destroy(o);
    }
  }
  function Ku() {
    var e;
    onmessage = function (t) {
      var i = t.data;
      switch (i.id) {
        case "init":
          var n = i.decoder;
          n.url &&
            (importScripts(n.url),
            (e = DracoDecoderModule({
              wasmBinary: n.wasmBinary,
            }))),
            postMessage("done");
          break;
        case "decodeMesh":
          if (!e) throw new Error("Draco decoder module is not available");
          e.then(function (e) {
            Yu(
              e,
              i.dataView,
              i.attributes,
              function (e) {
                postMessage(
                  {
                    id: "indices",
                    value: e,
                  },
                  [e.buffer]
                );
              },
              function (e, t) {
                postMessage(
                  {
                    id: e,
                    value: t,
                  },
                  [t.buffer]
                );
              }
            ),
              postMessage("done");
          });
      }
    };
  }
  function Qu(e) {
    return "object" != typeof document || "string" != typeof e
      ? e
      : yt.GetAbsoluteUrl(e);
  }
  !(function () {
    function e(e, t, i) {
      var n = this;
      (this._baseMaterial = e),
        (this._scene = t),
        (this._options = i),
        (this._subMeshToEffect = new Map()),
        (this._subMeshToDepthEffect = new Xu()),
        (this._meshes = new Map());
      var r = "NodeMaterial" === e.getClassName() ? "u_" : "";
      if (r) {
        this._matriceNames = {
          world: r + "World",
          view: r + "View",
          projection: r + "Projection",
          viewProjection: r + "ViewProjection",
          worldView: r + "WorldxView",
          worldViewProjection: r + "WorldxViewxProjection",
        };
        for (var o = e.getInputBlocks(), s = 0; s < o.length; ++s)
          switch (o[s]._systemValue) {
            case Xl.World:
              this._matriceNames.world = o[s].associatedVariableName;
              break;
            case Xl.View:
              this._matriceNames.view = o[s].associatedVariableName;
              break;
            case Xl.Projection:
              this._matriceNames.projection = o[s].associatedVariableName;
              break;
            case Xl.ViewProjection:
              this._matriceNames.viewProjection = o[s].associatedVariableName;
              break;
            case Xl.WorldView:
              this._matriceNames.worldView = o[s].associatedVariableName;
              break;
            case Xl.WorldViewProjection:
              this._matriceNames.worldViewProjection =
                o[s].associatedVariableName;
          }
      } else
        this._matriceNames = {
          world: r + "world",
          view: r + "view",
          projection: r + "projection",
          viewProjection: r + "viewProjection",
          worldView: r + "worldView",
          worldViewProjection: r + "worldViewProjection",
        };
      this._onEffectCreatedObserver =
        this._baseMaterial.onEffectCreatedObservable.add(function (e) {
          var t,
            i = null === (t = e.subMesh) || void 0 === t ? void 0 : t.getMesh();
          i &&
            !n._meshes.has(i) &&
            n._meshes.set(
              i,
              i.onDisposeObservable.add(function (e) {
                for (
                  var t = n._subMeshToEffect.keys(), i = t.next();
                  !0 !== i.done;
                  i = t.next()
                ) {
                  var r = i.value;
                  (null == r ? void 0 : r.getMesh()) === e &&
                    (n._subMeshToEffect.delete(r),
                    n._subMeshToDepthEffect.mm.delete(r));
                }
              })
            ),
            n._subMeshToEffect.set(e.subMesh, e.effect),
            n._subMeshToDepthEffect.mm.delete(e.subMesh);
        });
    }
    Object.defineProperty(e.prototype, "standalone", {
      get: function () {
        var e, t;
        return (
          null !==
            (t =
              null === (e = this._options) || void 0 === e
                ? void 0
                : e.standalone) &&
          void 0 !== t &&
          t
        );
      },
      enumerable: !1,
      configurable: !0,
    }),
      Object.defineProperty(e.prototype, "baseMaterial", {
        get: function () {
          return this._baseMaterial;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (e.prototype.getEffect = function (e, t) {
        var i, n, r, o, s, a;
        return null !==
          (a =
            null !==
              (r =
                null ===
                  (n =
                    null === (i = this._subMeshToDepthEffect.mm.get(e)) ||
                    void 0 === i
                      ? void 0
                      : i.get(t)) || void 0 === n
                  ? void 0
                  : n.depthEffect) && void 0 !== r
              ? r
              : null ===
                    (s =
                      null === (o = this._subMeshToDepthEffect.mm.get(null)) ||
                      void 0 === o
                        ? void 0
                        : o.get(t)) || void 0 === s
                ? void 0
                : s.depthEffect) && void 0 !== a
          ? a
          : null;
      }),
      (e.prototype.isReadyForSubMesh = function (e, t, i, n) {
        var r, o;
        return (
          this.standalone &&
            this._baseMaterial.isReadyForSubMesh(e.getMesh(), e, n),
          null !==
            (o =
              null === (r = this._makeEffect(e, t, i)) || void 0 === r
                ? void 0
                : r.isReady()) &&
            void 0 !== o &&
            o
        );
      }),
      (e.prototype.dispose = function () {
        this._baseMaterial.onEffectCreatedObservable.remove(
          this._onEffectCreatedObserver
        ),
          (this._onEffectCreatedObserver = null);
        for (
          var e = this._meshes.entries(), t = e.next();
          !0 !== t.done;
          t = e.next()
        ) {
          var i = t.value,
            n = i[0],
            r = i[1];
          n.onDisposeObservable.remove(r);
        }
      }),
      (e.prototype._makeEffect = function (e, t, i) {
        var n,
          r =
            null !== (n = this._subMeshToEffect.get(e)) && void 0 !== n
              ? n
              : this._subMeshToEffect.get(null);
        if (!r) return null;
        var o = this._subMeshToDepthEffect.get(e, i);
        o ||
          ((o = {
            depthEffect: null,
            depthDefines: "",
            token: vt.RandomId(),
          }),
          this._subMeshToDepthEffect.set(e, i, o));
        var s = t.join("\n");
        if (o.depthEffect && s === o.depthDefines) return o.depthEffect;
        o.depthDefines = s;
        var a = r.rawVertexSourceCode,
          l = r.rawFragmentSourceCode,
          c =
            this._options && this._options.remappedVariables
              ? "#include<shadowMapVertexNormalBias>(" +
                this._options.remappedVariables.join(",") +
                ")"
              : Ke.IncludesShadersStore.shadowMapVertexNormalBias,
          u =
            this._options && this._options.remappedVariables
              ? "#include<shadowMapVertexMetric>(" +
                this._options.remappedVariables.join(",") +
                ")"
              : Ke.IncludesShadersStore.shadowMapVertexMetric,
          h =
            this._options && this._options.remappedVariables
              ? "#include<shadowMapFragmentSoftTransparentShadow>(" +
                this._options.remappedVariables.join(",") +
                ")"
              : Ke.IncludesShadersStore.shadowMapFragmentSoftTransparentShadow,
          d = Ke.IncludesShadersStore.shadowMapFragment;
        a = (a =
          -1 !==
          (a = (a = a.replace(
            /void\s+?main/g,
            Ke.IncludesShadersStore.shadowMapVertexDeclaration + "\r\nvoid main"
          )).replace(
            /#define SHADOWDEPTH_NORMALBIAS|#define CUSTOM_VERTEX_UPDATE_WORLDPOS/g,
            c
          )).indexOf("#define SHADOWDEPTH_METRIC")
            ? a.replace(/#define SHADOWDEPTH_METRIC/g, u)
            : a.replace(/}\s*$/g, u + "\r\n}")).replace(
          /#define SHADER_NAME.*?\n|out vec4 glFragColor;\n/g,
          ""
        );
        var p =
            l.indexOf("#define SHADOWDEPTH_SOFTTRANSPARENTSHADOW") >= 0 ||
            l.indexOf("#define CUSTOM_FRAGMENT_BEFORE_FOG") >= 0,
          f = -1 !== l.indexOf("#define SHADOWDEPTH_FRAGMENT"),
          _ = "";
        p
          ? (l = l.replace(
              /#define SHADOWDEPTH_SOFTTRANSPARENTSHADOW|#define CUSTOM_FRAGMENT_BEFORE_FOG/g,
              h
            ))
          : (_ = h + "\r\n"),
          (l = l.replace(
            /void\s+?main/g,
            Ke.IncludesShadersStore.shadowMapFragmentDeclaration +
              "\r\nvoid main"
          )),
          f
            ? (l = l.replace(/#define SHADOWDEPTH_FRAGMENT/g, d))
            : (_ += d + "\r\n"),
          _ && (l = l.replace(/}\s*$/g, _ + "}")),
          (l = l.replace(
            /#define SHADER_NAME.*?\n|out vec4 glFragColor;\n/g,
            ""
          ));
        var m = r.getUniformNames().slice();
        return (
          m.push(
            "biasAndScaleSM",
            "depthValuesSM",
            "lightDataSM",
            "softTransparentShadowSM"
          ),
          (o.depthEffect = this._scene.getEngine().createEffect(
            {
              vertexSource: a,
              fragmentSource: l,
              vertexToken: o.token,
              fragmentToken: o.token,
            },
            {
              attributes: r.getAttributesNames(),
              uniformsNames: m,
              uniformBuffersNames: r.getUniformBuffersNames(),
              samplers: r.getSamplers(),
              defines:
                s +
                "\n" +
                r.defines
                  .replace("#define SHADOWS", "")
                  .replace(/#define SHADOW\d/g, ""),
              indexParameters: r.getIndexParameters(),
            },
            this._scene.getEngine()
          )),
          o.depthEffect
        );
      });
  })(),
    (function () {
      function e(t) {
        void 0 === t && (t = e.DefaultNumWorkers);
        var i = e.Configuration.decoder,
          n =
            i.wasmUrl && i.wasmBinaryUrl && "object" == typeof WebAssembly
              ? {
                  url: i.wasmUrl,
                  wasmBinaryPromise: yt.LoadFileAsync(Qu(i.wasmBinaryUrl)),
                }
              : {
                  url: i.fallbackUrl,
                  wasmBinaryPromise: Promise.resolve(void 0),
                };
        t && "function" == typeof Worker
          ? (this._workerPoolPromise = n.wasmBinaryPromise.then(function (e) {
              for (
                var i = Yu + "(" + Ku + ")()",
                  r = URL.createObjectURL(
                    new Blob([i], {
                      type: "application/javascript",
                    })
                  ),
                  o = new Array(t),
                  s = 0;
                s < o.length;
                s++
              )
                o[s] = new Promise(function (t, i) {
                  var o = new Worker(r),
                    s = function (e) {
                      o.removeEventListener("error", s),
                        o.removeEventListener("message", a),
                        i(e);
                    },
                    a = function (e) {
                      "done" === e.data &&
                        (o.removeEventListener("error", s),
                        o.removeEventListener("message", a),
                        t(o));
                    };
                  o.addEventListener("error", s),
                    o.addEventListener("message", a),
                    o.postMessage({
                      id: "init",
                      decoder: {
                        url: Qu(n.url),
                        wasmBinary: e,
                      },
                    });
                });
              return Promise.all(o).then(function (e) {
                return new ca(e);
              });
            }))
          : (this._decoderModulePromise = n.wasmBinaryPromise.then(
              function (e) {
                if (!n.url)
                  throw new Error("Draco decoder module is not available");
                return yt.LoadScriptAsync(n.url).then(function () {
                  return (
                    (t = e),
                    new Promise(function (e) {
                      DracoDecoderModule({
                        wasmBinary: t,
                      }).then(function (t) {
                        e({
                          module: t,
                        });
                      });
                    })
                  );
                  var t;
                });
              }
            ));
      }
      Object.defineProperty(e, "DecoderAvailable", {
        get: function () {
          var t = e.Configuration.decoder;
          return !!(
            (t.wasmUrl && t.wasmBinaryUrl && "object" == typeof WebAssembly) ||
            t.fallbackUrl
          );
        },
        enumerable: !1,
        configurable: !0,
      }),
        (e.GetDefaultNumWorkers = function () {
          return "object" == typeof navigator && navigator.hardwareConcurrency
            ? Math.min(Math.floor(0.5 * navigator.hardwareConcurrency), 4)
            : 1;
        }),
        Object.defineProperty(e, "Default", {
          get: function () {
            return e._Default || (e._Default = new e()), e._Default;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.dispose = function () {
          this._workerPoolPromise &&
            this._workerPoolPromise.then(function (e) {
              e.dispose();
            }),
            delete this._workerPoolPromise,
            delete this._decoderModulePromise;
        }),
        (e.prototype.whenReadyAsync = function () {
          return this._workerPoolPromise
            ? this._workerPoolPromise.then(function () {})
            : this._decoderModulePromise
              ? this._decoderModulePromise.then(function () {})
              : Promise.resolve();
        }),
        (e.prototype.decodeMeshAsync = function (e, t) {
          var i = e instanceof ArrayBuffer ? new Uint8Array(e) : e;
          if (this._workerPoolPromise)
            return this._workerPoolPromise.then(function (e) {
              return new Promise(function (n, r) {
                e.push(function (e, o) {
                  var s = new Nt(),
                    a = function (t) {
                      e.removeEventListener("error", a),
                        e.removeEventListener("message", l),
                        r(t),
                        o();
                    },
                    l = function (t) {
                      "done" === t.data
                        ? (e.removeEventListener("error", a),
                          e.removeEventListener("message", l),
                          n(s),
                          o())
                        : "indices" === t.data.id
                          ? (s.indices = t.data.value)
                          : s.set(t.data.value, t.data.id);
                    };
                  e.addEventListener("error", a),
                    e.addEventListener("message", l);
                  var c = new Uint8Array(i.byteLength);
                  c.set(new Uint8Array(i.buffer, i.byteOffset, i.byteLength)),
                    e.postMessage(
                      {
                        id: "decodeMesh",
                        dataView: c,
                        attributes: t,
                      },
                      [c.buffer]
                    );
                });
              });
            });
          if (this._decoderModulePromise)
            return this._decoderModulePromise.then(function (e) {
              var n = new Nt();
              return (
                Yu(
                  e.module,
                  i,
                  t,
                  function (e) {
                    n.indices = e;
                  },
                  function (e, t) {
                    n.set(t, e);
                  }
                ),
                n
              );
            });
          throw new Error("Draco decoder module is not available");
        }),
        (e.Configuration = {
          decoder: {
            wasmUrl: "https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",
            wasmBinaryUrl:
              "https://preview.babylonjs.com/draco_decoder_gltf.wasm",
            fallbackUrl: "https://preview.babylonjs.com/draco_decoder_gltf.js",
          },
        }),
        (e.DefaultNumWorkers = e.GetDefaultNumWorkers()),
        (e._Default = null);
    })();
  var qu = 0,
    Zu = (function () {
      function e(e, t, i, n) {
        (this.pos = e), (this.normal = t), (this.uv = i), (this.vertColor = n);
      }
      return (
        (e.prototype.clone = function () {
          var t, i;
          return new e(
            this.pos.clone(),
            this.normal.clone(),
            null === (t = this.uv) || void 0 === t ? void 0 : t.clone(),
            null === (i = this.vertColor) || void 0 === i ? void 0 : i.clone()
          );
        }),
        (e.prototype.flip = function () {
          this.normal = this.normal.scale(-1);
        }),
        (e.prototype.interpolate = function (t, i) {
          return new e(
            f.Lerp(this.pos, t.pos, i),
            f.Lerp(this.normal, t.normal, i),
            this.uv && t.uv ? p.Lerp(this.uv, t.uv, i) : void 0,
            this.vertColor && t.vertColor
              ? T.Lerp(this.vertColor, t.vertColor, i)
              : void 0
          );
        }),
        e
      );
    })(),
    Ju = (function () {
      function e(e, t) {
        (this.normal = e), (this.w = t);
      }
      return (
        (e.FromPoints = function (t, i, n) {
          var r = n.subtract(t),
            o = i.subtract(t);
          if (0 === r.lengthSquared() || 0 === o.lengthSquared()) return null;
          var s = f.Normalize(f.Cross(r, o));
          return new e(s, f.Dot(s, t));
        }),
        (e.prototype.clone = function () {
          return new e(this.normal.clone(), this.w);
        }),
        (e.prototype.flip = function () {
          this.normal.scaleInPlace(-1), (this.w = -this.w);
        }),
        (e.prototype.splitPolygon = function (t, i, n, r, o) {
          var s,
            a,
            l = 0,
            c = [];
          for (s = 0; s < t.vertices.length; s++) {
            var u =
              (a = f.Dot(this.normal, t.vertices[s].pos) - this.w) < -e.EPSILON
                ? 2
                : a > e.EPSILON
                  ? 1
                  : 0;
            (l |= u), c.push(u);
          }
          switch (l) {
            case 0:
              (f.Dot(this.normal, t.plane.normal) > 0 ? i : n).push(t);
              break;
            case 1:
              r.push(t);
              break;
            case 2:
              o.push(t);
              break;
            case 3:
              var h,
                d = [],
                p = [];
              for (s = 0; s < t.vertices.length; s++) {
                var _ = (s + 1) % t.vertices.length,
                  m = c[s],
                  g = c[_],
                  v = t.vertices[s],
                  y = t.vertices[_];
                if (
                  (2 !== m && d.push(v),
                  1 !== m && p.push(2 !== m ? v.clone() : v),
                  3 == (m | g))
                ) {
                  a =
                    (this.w - f.Dot(this.normal, v.pos)) /
                    f.Dot(this.normal, y.pos.subtract(v.pos));
                  var b = v.interpolate(y, a);
                  d.push(b), p.push(b.clone());
                }
              }
              d.length >= 3 && (h = new $u(d, t.shared)).plane && r.push(h),
                p.length >= 3 && (h = new $u(p, t.shared)).plane && o.push(h);
          }
        }),
        (e.EPSILON = 1e-5),
        e
      );
    })(),
    $u = (function () {
      function e(e, t) {
        (this.vertices = e),
          (this.shared = t),
          (this.plane = Ju.FromPoints(e[0].pos, e[1].pos, e[2].pos));
      }
      return (
        (e.prototype.clone = function () {
          return new e(
            this.vertices.map(function (e) {
              return e.clone();
            }),
            this.shared
          );
        }),
        (e.prototype.flip = function () {
          this.vertices.reverse().map(function (e) {
            e.flip();
          }),
            this.plane.flip();
        }),
        e
      );
    })(),
    eh = (function () {
      function e(e) {
        (this.plane = null),
          (this.front = null),
          (this.back = null),
          (this.polygons = new Array()),
          e && this.build(e);
      }
      return (
        (e.prototype.clone = function () {
          var t = new e();
          return (
            (t.plane = this.plane && this.plane.clone()),
            (t.front = this.front && this.front.clone()),
            (t.back = this.back && this.back.clone()),
            (t.polygons = this.polygons.map(function (e) {
              return e.clone();
            })),
            t
          );
        }),
        (e.prototype.invert = function () {
          for (var e = 0; e < this.polygons.length; e++)
            this.polygons[e].flip();
          this.plane && this.plane.flip(),
            this.front && this.front.invert(),
            this.back && this.back.invert();
          var t = this.front;
          (this.front = this.back), (this.back = t);
        }),
        (e.prototype.clipPolygons = function (e) {
          if (!this.plane) return e.slice();
          for (var t = new Array(), i = new Array(), n = 0; n < e.length; n++)
            this.plane.splitPolygon(e[n], t, i, t, i);
          return (
            this.front && (t = this.front.clipPolygons(t)),
            (i = this.back ? this.back.clipPolygons(i) : []),
            t.concat(i)
          );
        }),
        (e.prototype.clipTo = function (e) {
          (this.polygons = e.clipPolygons(this.polygons)),
            this.front && this.front.clipTo(e),
            this.back && this.back.clipTo(e);
        }),
        (e.prototype.allPolygons = function () {
          var e = this.polygons.slice();
          return (
            this.front && (e = e.concat(this.front.allPolygons())),
            this.back && (e = e.concat(this.back.allPolygons())),
            e
          );
        }),
        (e.prototype.build = function (t) {
          if (t.length) {
            this.plane || (this.plane = t[0].plane.clone());
            for (var i = new Array(), n = new Array(), r = 0; r < t.length; r++)
              this.plane.splitPolygon(t[r], this.polygons, this.polygons, i, n);
            i.length &&
              (this.front || (this.front = new e()), this.front.build(i)),
              n.length &&
                (this.back || (this.back = new e()), this.back.build(n));
          }
        }),
        e
      );
    })();
  (function () {
    function e() {
      this.polygons = new Array();
    }
    (e.FromMesh = function (t) {
      var i,
        n,
        r,
        o,
        s,
        a,
        l,
        c,
        u,
        h = void 0,
        d = void 0,
        _ = new Array(),
        m = null;
      if (!(t instanceof Qi))
        throw "BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";
      t.computeWorldMatrix(!0),
        (a = t.getWorldMatrix()),
        (l = t.position.clone()),
        (c = t.rotation.clone()),
        t.rotationQuaternion && (m = t.rotationQuaternion.clone()),
        (u = t.scaling.clone());
      for (
        var g = t.getIndices(),
          v = t.getVerticesData(wt.PositionKind),
          y = t.getVerticesData(wt.NormalKind),
          b = t.getVerticesData(wt.UVKind),
          S = t.getVerticesData(wt.ColorKind),
          C = t.subMeshes,
          x = 0,
          E = C.length;
        x < E;
        x++
      )
        for (
          var P = C[x].indexStart, A = C[x].indexCount + C[x].indexStart;
          P < A;
          P += 3
        ) {
          s = [];
          for (var R = 0; R < 3; R++) {
            var M = new f(
              y[3 * g[P + R]],
              y[3 * g[P + R] + 1],
              y[3 * g[P + R] + 2]
            );
            b && (h = new p(b[2 * g[P + R]], b[2 * g[P + R] + 1])),
              S &&
                (d = new T(
                  S[4 * g[P + R]],
                  S[4 * g[P + R] + 1],
                  S[4 * g[P + R] + 2],
                  S[4 * g[P + R] + 3]
                ));
            var O = new f(
              v[3 * g[P + R]],
              v[3 * g[P + R] + 1],
              v[3 * g[P + R] + 2]
            );
            (r = f.TransformCoordinates(O, a)),
              (n = f.TransformNormal(M, a)),
              (i = new Zu(r, n, h, d)),
              s.push(i);
          }
          (o = new $u(s, {
            subMeshId: x,
            meshId: qu,
            materialIndex: C[x].materialIndex,
          })).plane && _.push(o);
        }
      var I = e.FromPolygons(_);
      return (
        (I.matrix = a),
        (I.position = l),
        (I.rotation = c),
        (I.scaling = u),
        (I.rotationQuaternion = m),
        qu++,
        I
      );
    }),
      (e.FromPolygons = function (t) {
        var i = new e();
        return (i.polygons = t), i;
      }),
      (e.prototype.clone = function () {
        var t = new e();
        return (
          (t.polygons = this.polygons.map(function (e) {
            return e.clone();
          })),
          t.copyTransformAttributes(this),
          t
        );
      }),
      (e.prototype.union = function (t) {
        var i = new eh(this.clone().polygons),
          n = new eh(t.clone().polygons);
        return (
          i.clipTo(n),
          n.clipTo(i),
          n.invert(),
          n.clipTo(i),
          n.invert(),
          i.build(n.allPolygons()),
          e.FromPolygons(i.allPolygons()).copyTransformAttributes(this)
        );
      }),
      (e.prototype.unionInPlace = function (e) {
        var t = new eh(this.polygons),
          i = new eh(e.polygons);
        t.clipTo(i),
          i.clipTo(t),
          i.invert(),
          i.clipTo(t),
          i.invert(),
          t.build(i.allPolygons()),
          (this.polygons = t.allPolygons());
      }),
      (e.prototype.subtract = function (t) {
        var i = new eh(this.clone().polygons),
          n = new eh(t.clone().polygons);
        return (
          i.invert(),
          i.clipTo(n),
          n.clipTo(i),
          n.invert(),
          n.clipTo(i),
          n.invert(),
          i.build(n.allPolygons()),
          i.invert(),
          e.FromPolygons(i.allPolygons()).copyTransformAttributes(this)
        );
      }),
      (e.prototype.subtractInPlace = function (e) {
        var t = new eh(this.polygons),
          i = new eh(e.polygons);
        t.invert(),
          t.clipTo(i),
          i.clipTo(t),
          i.invert(),
          i.clipTo(t),
          i.invert(),
          t.build(i.allPolygons()),
          t.invert(),
          (this.polygons = t.allPolygons());
      }),
      (e.prototype.intersect = function (t) {
        var i = new eh(this.clone().polygons),
          n = new eh(t.clone().polygons);
        return (
          i.invert(),
          n.clipTo(i),
          n.invert(),
          i.clipTo(n),
          n.clipTo(i),
          i.build(n.allPolygons()),
          i.invert(),
          e.FromPolygons(i.allPolygons()).copyTransformAttributes(this)
        );
      }),
      (e.prototype.intersectInPlace = function (e) {
        var t = new eh(this.polygons),
          i = new eh(e.polygons);
        t.invert(),
          i.clipTo(t),
          i.invert(),
          t.clipTo(i),
          i.clipTo(t),
          t.build(i.allPolygons()),
          t.invert(),
          (this.polygons = t.allPolygons());
      }),
      (e.prototype.inverse = function () {
        var e = this.clone();
        return e.inverseInPlace(), e;
      }),
      (e.prototype.inverseInPlace = function () {
        this.polygons.map(function (e) {
          e.flip();
        });
      }),
      (e.prototype.copyTransformAttributes = function (e) {
        return (
          (this.matrix = e.matrix),
          (this.position = e.position),
          (this.rotation = e.rotation),
          (this.scaling = e.scaling),
          (this.rotationQuaternion = e.rotationQuaternion),
          this
        );
      }),
      (e.prototype.buildMeshGeometry = function (e, t, i) {
        var n = this.matrix.clone();
        n.invert();
        var r,
          o,
          s,
          a = new Qi(e, t),
          l = [],
          c = [],
          u = [],
          h = null,
          d = null,
          _ = f.Zero(),
          m = f.Zero(),
          g = p.Zero(),
          v = new T(0, 0, 0, 0),
          y = this.polygons,
          b = [0, 0, 0],
          S = {},
          C = 0,
          x = {};
        i &&
          y.sort(function (e, t) {
            return e.shared.meshId === t.shared.meshId
              ? e.shared.subMeshId - t.shared.subMeshId
              : e.shared.meshId - t.shared.meshId;
          });
        for (var E = 0, P = y.length; E < P; E++) {
          x[(r = y[E]).shared.meshId] || (x[r.shared.meshId] = {}),
            x[r.shared.meshId][r.shared.subMeshId] ||
              (x[r.shared.meshId][r.shared.subMeshId] = {
                indexStart: 1 / 0,
                indexEnd: -1 / 0,
                materialIndex: r.shared.materialIndex,
              }),
            (s = x[r.shared.meshId][r.shared.subMeshId]);
          for (var A = 2, R = r.vertices.length; A < R; A++) {
            (b[0] = 0), (b[1] = A - 1), (b[2] = A);
            for (var M = 0; M < 3; M++) {
              _.copyFrom(r.vertices[b[M]].pos),
                m.copyFrom(r.vertices[b[M]].normal),
                r.vertices[b[M]].uv &&
                  (h || (h = []), g.copyFrom(r.vertices[b[M]].uv)),
                r.vertices[b[M]].vertColor &&
                  (d || (d = []), v.copyFrom(r.vertices[b[M]].vertColor));
              var O = f.TransformCoordinates(_, n),
                I = f.TransformNormal(m, n);
              o = S[O.x + "," + O.y + "," + O.z];
              var D = !1;
              h && h[2 * o] !== g.x && h[2 * o + 1] !== g.y && (D = !0);
              var w = !1;
              d &&
                d[4 * o] !== v.r &&
                d[4 * o + 1] !== v.g &&
                d[4 * o + 2] !== v.b &&
                d[4 * o + 3] !== v.a &&
                (w = !0),
                (void 0 === o ||
                  u[3 * o] !== I.x ||
                  u[3 * o + 1] !== I.y ||
                  u[3 * o + 2] !== I.z ||
                  D ||
                  w) &&
                  (l.push(O.x, O.y, O.z),
                  h && h.push(g.x, g.y),
                  u.push(m.x, m.y, m.z),
                  d && d.push(v.r, v.g, v.b, v.a),
                  (o = S[O.x + "," + O.y + "," + O.z] = l.length / 3 - 1)),
                c.push(o),
                (s.indexStart = Math.min(C, s.indexStart)),
                (s.indexEnd = Math.max(C, s.indexEnd)),
                C++;
            }
          }
        }
        if (
          (a.setVerticesData(wt.PositionKind, l),
          a.setVerticesData(wt.NormalKind, u),
          h && a.setVerticesData(wt.UVKind, h),
          d && a.setVerticesData(wt.ColorKind, d),
          a.setIndices(c, null),
          i)
        ) {
          var N,
            L = 0;
          for (var F in ((a.subMeshes = new Array()), x)) {
            for (var B in ((N = -1), x[F]))
              (s = x[F][B]),
                oi.CreateFromIndices(
                  s.materialIndex + L,
                  s.indexStart,
                  s.indexEnd - s.indexStart + 1,
                  a
                ),
                (N = Math.max(s.materialIndex, N));
            L += ++N;
          }
        }
        return a;
      }),
      (e.prototype.toMesh = function (e, t, i, n) {
        void 0 === t && (t = null);
        var r = this.buildMeshGeometry(e, i, n);
        return (
          (r.material = t),
          r.position.copyFrom(this.position),
          r.rotation.copyFrom(this.rotation),
          this.rotationQuaternion &&
            (r.rotationQuaternion = this.rotationQuaternion.clone()),
          r.scaling.copyFrom(this.scaling),
          r.computeWorldMatrix(!0),
          r
        );
      });
  })(),
    (function (e) {
      function t(t, i, n, r, o, s) {
        void 0 === r && (r = 1),
          void 0 === o && (o = 60),
          void 0 === s && (s = !0);
        var a = e.call(this, t, n) || this;
        (a._sectionPolygonPointsCount = 4),
          (a._running = !1),
          (a._autoStart = s),
          (a._generator = i),
          (a._diameter = r),
          (a._length = o),
          (a._sectionVectors = []),
          (a._sectionNormalVectors = []);
        for (var l = 0; l < a._sectionPolygonPointsCount; l++)
          (a._sectionVectors[l] = f.Zero()),
            (a._sectionNormalVectors[l] = f.Zero());
        return a._createMesh(), a;
      }
      P(t, e),
        (t.prototype.getClassName = function () {
          return "TrailMesh";
        }),
        (t.prototype._createMesh = function () {
          var e = new Nt(),
            t = [],
            i = [],
            n = [],
            r = f.Zero();
          r =
            this._generator instanceof Yt && this._generator._boundingInfo
              ? this._generator._boundingInfo.boundingBox.centerWorld
              : this._generator.position;
          for (
            var o = (2 * Math.PI) / this._sectionPolygonPointsCount, s = 0;
            s < this._sectionPolygonPointsCount;
            s++
          )
            t.push(
              r.x + Math.cos(s * o) * this._diameter,
              r.y + Math.sin(s * o) * this._diameter,
              r.z
            );
          for (s = 1; s <= this._length; s++) {
            for (var a = 0; a < this._sectionPolygonPointsCount; a++)
              t.push(
                r.x + Math.cos(a * o) * this._diameter,
                r.y + Math.sin(a * o) * this._diameter,
                r.z
              );
            var l = t.length / 3 - 2 * this._sectionPolygonPointsCount;
            for (a = 0; a < this._sectionPolygonPointsCount - 1; a++)
              n.push(
                l + a,
                l + a + this._sectionPolygonPointsCount,
                l + a + this._sectionPolygonPointsCount + 1
              ),
                n.push(
                  l + a,
                  l + a + this._sectionPolygonPointsCount + 1,
                  l + a + 1
                );
            n.push(
              l + this._sectionPolygonPointsCount - 1,
              l +
                this._sectionPolygonPointsCount -
                1 +
                this._sectionPolygonPointsCount,
              l + this._sectionPolygonPointsCount
            ),
              n.push(
                l + this._sectionPolygonPointsCount - 1,
                l + this._sectionPolygonPointsCount,
                l
              );
          }
          Nt.ComputeNormals(t, n, i),
            (e.positions = t),
            (e.normals = i),
            (e.indices = n),
            e.applyToMesh(this, !0),
            this._autoStart && this.start();
        }),
        (t.prototype.start = function () {
          var e = this;
          this._running ||
            ((this._running = !0),
            (this._beforeRenderObserver =
              this.getScene().onBeforeRenderObservable.add(function () {
                e.update();
              })));
        }),
        (t.prototype.stop = function () {
          this._beforeRenderObserver &&
            this._running &&
            ((this._running = !1),
            this.getScene().onBeforeRenderObservable.remove(
              this._beforeRenderObserver
            ));
        }),
        (t.prototype.update = function () {
          var e = this.getVerticesData(wt.PositionKind),
            t = this.getVerticesData(wt.NormalKind),
            i = this._generator.getWorldMatrix();
          if (e && t) {
            for (var n = 3 * this._sectionPolygonPointsCount; n < e.length; n++)
              e[n - 3 * this._sectionPolygonPointsCount] =
                e[n] - (t[n] / this._length) * this._diameter;
            for (n = 3 * this._sectionPolygonPointsCount; n < t.length; n++)
              t[n - 3 * this._sectionPolygonPointsCount] = t[n];
            var r = e.length - 3 * this._sectionPolygonPointsCount,
              o = (2 * Math.PI) / this._sectionPolygonPointsCount;
            for (n = 0; n < this._sectionPolygonPointsCount; n++)
              this._sectionVectors[n].copyFromFloats(
                Math.cos(n * o) * this._diameter,
                Math.sin(n * o) * this._diameter,
                0
              ),
                this._sectionNormalVectors[n].copyFromFloats(
                  Math.cos(n * o),
                  Math.sin(n * o),
                  0
                ),
                f.TransformCoordinatesToRef(
                  this._sectionVectors[n],
                  i,
                  this._sectionVectors[n]
                ),
                f.TransformNormalToRef(
                  this._sectionNormalVectors[n],
                  i,
                  this._sectionNormalVectors[n]
                );
            for (n = 0; n < this._sectionPolygonPointsCount; n++)
              (e[r + 3 * n] = this._sectionVectors[n].x),
                (e[r + 3 * n + 1] = this._sectionVectors[n].y),
                (e[r + 3 * n + 2] = this._sectionVectors[n].z),
                (t[r + 3 * n] = this._sectionNormalVectors[n].x),
                (t[r + 3 * n + 1] = this._sectionNormalVectors[n].y),
                (t[r + 3 * n + 2] = this._sectionNormalVectors[n].z);
            this.updateVerticesData(wt.PositionKind, e, !0, !1),
              this.updateVerticesData(wt.NormalKind, t, !0, !1);
          }
        }),
        (t.prototype.clone = function (e, i) {
          return (
            void 0 === e && (e = ""),
            new t(
              e,
              void 0 === i ? this._generator : i,
              this.getScene(),
              this._diameter,
              this._length,
              this._autoStart
            )
          );
        }),
        (t.prototype.serialize = function (t) {
          e.prototype.serialize.call(this, t);
        }),
        (t.Parse = function (e, i) {
          return new t(
            e.name,
            e._generator,
            i,
            e._diameter,
            e._length,
            e._autoStart
          );
        });
    })(Qi),
    (Nt.CreateDisc = function (e) {
      var t = new Array(),
        i = new Array(),
        n = new Array(),
        r = new Array(),
        o = e.radius || 0.5,
        s = e.tessellation || 64,
        a = e.arc && (e.arc <= 0 || e.arc > 1) ? 1 : e.arc || 1,
        l = 0 === e.sideOrientation ? 0 : e.sideOrientation || Nt.DEFAULTSIDE;
      t.push(0, 0, 0), r.push(0.5, 0.5);
      for (
        var c = 2 * Math.PI * a,
          u = 1 === a ? c / s : c / (s - 1),
          h = 0,
          d = 0;
        d < s;
        d++
      ) {
        var p = Math.cos(h),
          f = Math.sin(h),
          _ = (p + 1) / 2,
          m = (1 - f) / 2;
        t.push(o * p, o * f, 0), r.push(_, m), (h += u);
      }
      1 === a && (t.push(t[3], t[4], t[5]), r.push(r[2], r[3]));
      for (var g = t.length / 3, v = 1; v < g - 1; v++) i.push(v + 1, 0, v);
      Nt.ComputeNormals(t, i, n),
        Nt._ComputeSides(l, t, i, n, r, e.frontUVs, e.backUVs);
      var y = new Nt();
      return (
        (y.indices = i), (y.positions = t), (y.normals = n), (y.uvs = r), y
      );
    }),
    (Qi.CreateDisc = function (e, t, i, n, r, o) {
      void 0 === n && (n = null);
      var s = {
        radius: t,
        tessellation: i,
        sideOrientation: o,
        updatable: r,
      };
      return th.CreateDisc(e, s, n);
    });
  var th = (function () {
    function e() {}
    return (
      (e.CreateDisc = function (e, t, i) {
        void 0 === i && (i = null);
        var n = new Qi(e, i);
        return (
          (t.sideOrientation = Qi._GetDefaultSideOrientation(
            t.sideOrientation
          )),
          (n._originalBuilderSideOrientation = t.sideOrientation),
          Nt.CreateDisc(t).applyToMesh(n, t.updatable),
          n
        );
      }),
      e
    );
  })();
  Nt.CreateTiledBox = function (e) {
    for (
      var t = e.faceUV || new Array(6),
        i = e.faceColors,
        n = e.pattern || Qi.NO_FLIP,
        r = e.width || e.size || 1,
        o = e.height || e.size || 1,
        s = e.depth || e.size || 1,
        a = e.tileWidth || e.tileSize || 1,
        l = e.tileHeight || e.tileSize || 1,
        c = e.alignHorizontal || 0,
        u = e.alignVertical || 0,
        h = 0 === e.sideOrientation ? 0 : e.sideOrientation || Nt.DEFAULTSIDE,
        d = 0;
      d < 6;
      d++
    )
      void 0 === t[d] && (t[d] = new _(0, 0, 1, 1)),
        i && void 0 === i[d] && (i[d] = new T(1, 1, 1, 1));
    var p = r / 2,
      m = o / 2,
      v = s / 2,
      y = [];
    for (d = 0; d < 2; d++)
      y[d] = Nt.CreateTiledPlane({
        pattern: n,
        tileWidth: a,
        tileHeight: l,
        width: r,
        height: o,
        alignVertical: u,
        alignHorizontal: c,
        sideOrientation: h,
      });
    for (d = 2; d < 4; d++)
      y[d] = Nt.CreateTiledPlane({
        pattern: n,
        tileWidth: a,
        tileHeight: l,
        width: s,
        height: o,
        alignVertical: u,
        alignHorizontal: c,
        sideOrientation: h,
      });
    var b = u;
    for (
      u === Qi.BOTTOM ? (b = Qi.TOP) : u === Qi.TOP && (b = Qi.BOTTOM), d = 4;
      d < 6;
      d++
    )
      y[d] = Nt.CreateTiledPlane({
        pattern: n,
        tileWidth: a,
        tileHeight: l,
        width: r,
        height: s,
        alignVertical: b,
        alignHorizontal: c,
        sideOrientation: h,
      });
    var S = [],
      C = [],
      x = [],
      E = [],
      P = [],
      A = [],
      R = [],
      M = [],
      O = 0,
      I = 0,
      D = 0;
    for (d = 0; d < 6; d++) {
      (O = y[d].positions.length), (A[d] = []), (R[d] = []);
      for (var w = 0; w < O / 3; w++)
        A[d].push(
          new f(
            y[d].positions[3 * w],
            y[d].positions[3 * w + 1],
            y[d].positions[3 * w + 2]
          )
        ),
          R[d].push(
            new f(
              y[d].normals[3 * w],
              y[d].normals[3 * w + 1],
              y[d].normals[3 * w + 2]
            )
          );
      (I = y[d].uvs.length), (M[d] = []);
      for (var N = 0; N < I; N += 2)
        (M[d][N] = t[d].x + (t[d].z - t[d].x) * y[d].uvs[N]),
          (M[d][N + 1] = t[d].y + (t[d].w - t[d].y) * y[d].uvs[N + 1]);
      if (
        ((x = x.concat(M[d])),
        (E = E.concat(
          y[d].indices.map(function (e) {
            return e + D;
          })
        )),
        (D += A[d].length),
        i)
      )
        for (var L = 0; L < 4; L++) P.push(i[d].r, i[d].g, i[d].b, i[d].a);
    }
    var F = new f(0, 0, v),
      B = g.RotationY(Math.PI);
    (S = A[0]
      .map(function (e) {
        return f.TransformNormal(e, B).add(F);
      })
      .map(function (e) {
        return [e.x, e.y, e.z];
      })
      .reduce(function (e, t) {
        return e.concat(t);
      }, [])),
      (C = R[0]
        .map(function (e) {
          return f.TransformNormal(e, B);
        })
        .map(function (e) {
          return [e.x, e.y, e.z];
        })
        .reduce(function (e, t) {
          return e.concat(t);
        }, [])),
      (S = S.concat(
        A[1]
          .map(function (e) {
            return e.subtract(F);
          })
          .map(function (e) {
            return [e.x, e.y, e.z];
          })
          .reduce(function (e, t) {
            return e.concat(t);
          }, [])
      )),
      (C = C.concat(
        R[1]
          .map(function (e) {
            return [e.x, e.y, e.z];
          })
          .reduce(function (e, t) {
            return e.concat(t);
          }, [])
      ));
    var V = new f(p, 0, 0),
      k = g.RotationY(-Math.PI / 2);
    (S = S.concat(
      A[2]
        .map(function (e) {
          return f.TransformNormal(e, k).add(V);
        })
        .map(function (e) {
          return [e.x, e.y, e.z];
        })
        .reduce(function (e, t) {
          return e.concat(t);
        }, [])
    )),
      (C = C.concat(
        R[2]
          .map(function (e) {
            return f.TransformNormal(e, k);
          })
          .map(function (e) {
            return [e.x, e.y, e.z];
          })
          .reduce(function (e, t) {
            return e.concat(t);
          }, [])
      ));
    var U = g.RotationY(Math.PI / 2);
    (S = S.concat(
      A[3]
        .map(function (e) {
          return f.TransformNormal(e, U).subtract(V);
        })
        .map(function (e) {
          return [e.x, e.y, e.z];
        })
        .reduce(function (e, t) {
          return e.concat(t);
        }, [])
    )),
      (C = C.concat(
        R[3]
          .map(function (e) {
            return f.TransformNormal(e, U);
          })
          .map(function (e) {
            return [e.x, e.y, e.z];
          })
          .reduce(function (e, t) {
            return e.concat(t);
          }, [])
      ));
    var z = new f(0, m, 0),
      G = g.RotationX(Math.PI / 2);
    (S = S.concat(
      A[4]
        .map(function (e) {
          return f.TransformNormal(e, G).add(z);
        })
        .map(function (e) {
          return [e.x, e.y, e.z];
        })
        .reduce(function (e, t) {
          return e.concat(t);
        }, [])
    )),
      (C = C.concat(
        R[4]
          .map(function (e) {
            return f.TransformNormal(e, G);
          })
          .map(function (e) {
            return [e.x, e.y, e.z];
          })
          .reduce(function (e, t) {
            return e.concat(t);
          }, [])
      ));
    var W = g.RotationX(-Math.PI / 2);
    (S = S.concat(
      A[5]
        .map(function (e) {
          return f.TransformNormal(e, W).subtract(z);
        })
        .map(function (e) {
          return [e.x, e.y, e.z];
        })
        .reduce(function (e, t) {
          return e.concat(t);
        }, [])
    )),
      (C = C.concat(
        R[5]
          .map(function (e) {
            return f.TransformNormal(e, W);
          })
          .map(function (e) {
            return [e.x, e.y, e.z];
          })
          .reduce(function (e, t) {
            return e.concat(t);
          }, [])
      )),
      Nt._ComputeSides(h, S, E, C, x);
    var H = new Nt();
    if (((H.indices = E), (H.positions = S), (H.normals = C), (H.uvs = x), i)) {
      var j = h === Nt.DOUBLESIDE ? P.concat(P) : P;
      H.colors = j;
    }
    return H;
  };
  var ih = (function () {
    function e() {}
    return (
      (e.CreateTiledBox = function (e, t, i) {
        void 0 === i && (i = null);
        var n = new Qi(e, i);
        return (
          (t.sideOrientation = Qi._GetDefaultSideOrientation(
            t.sideOrientation
          )),
          (n._originalBuilderSideOrientation = t.sideOrientation),
          Nt.CreateTiledBox(t).applyToMesh(n, t.updatable),
          n
        );
      }),
      e
    );
  })();
  (Nt.CreateTorusKnot = function (e) {
    var t,
      i,
      n = new Array(),
      r = new Array(),
      o = new Array(),
      s = new Array(),
      a = e.radius || 2,
      l = e.tube || 0.5,
      c = e.radialSegments || 32,
      u = e.tubularSegments || 32,
      h = e.p || 2,
      d = e.q || 3,
      p = 0 === e.sideOrientation ? 0 : e.sideOrientation || Nt.DEFAULTSIDE,
      _ = function (e) {
        var t = Math.cos(e),
          i = Math.sin(e),
          n = (d / h) * e,
          r = Math.cos(n),
          o = a * (2 + r) * 0.5 * t,
          s = a * (2 + r) * i * 0.5,
          l = a * Math.sin(n) * 0.5;
        return new f(o, s, l);
      };
    for (t = 0; t <= c; t++) {
      var m = ((t % c) / c) * 2 * h * Math.PI,
        g = _(m),
        v = _(m + 0.01),
        y = v.subtract(g),
        b = v.add(g),
        T = f.Cross(y, b);
      for (b = f.Cross(T, y), T.normalize(), b.normalize(), i = 0; i < u; i++) {
        var S = ((i % u) / u) * 2 * Math.PI,
          C = -l * Math.cos(S),
          x = l * Math.sin(S);
        r.push(g.x + C * b.x + x * T.x),
          r.push(g.y + C * b.y + x * T.y),
          r.push(g.z + C * b.z + x * T.z),
          s.push(t / c),
          s.push(i / u);
      }
    }
    for (t = 0; t < c; t++)
      for (i = 0; i < u; i++) {
        var E = (i + 1) % u,
          P = t * u + i,
          A = (t + 1) * u + i,
          R = (t + 1) * u + E,
          M = t * u + E;
        n.push(M), n.push(A), n.push(P), n.push(M), n.push(R), n.push(A);
      }
    Nt.ComputeNormals(r, n, o),
      Nt._ComputeSides(p, r, n, o, s, e.frontUVs, e.backUVs);
    var O = new Nt();
    return (O.indices = n), (O.positions = r), (O.normals = o), (O.uvs = s), O;
  }),
    (Qi.CreateTorusKnot = function (e, t, i, n, r, o, s, a, l, c) {
      var u = {
        radius: t,
        tube: i,
        radialSegments: n,
        tubularSegments: r,
        p: o,
        q: s,
        sideOrientation: c,
        updatable: l,
      };
      return nh.CreateTorusKnot(e, u, a);
    });
  var nh = (function () {
      function e() {}
      return (
        (e.CreateTorusKnot = function (e, t, i) {
          var n = new Qi(e, i);
          return (
            (t.sideOrientation = Qi._GetDefaultSideOrientation(
              t.sideOrientation
            )),
            (n._originalBuilderSideOrientation = t.sideOrientation),
            Nt.CreateTorusKnot(t).applyToMesh(n, t.updatable),
            n
          );
        }),
        e
      );
    })(),
    rh = (function (e) {
      function t(t, i) {
        var n = e.call(this, t.x, t.y) || this;
        return (n.index = i), n;
      }
      return P(t, e), t;
    })(p),
    oh = (function () {
      function e() {
        this.elements = new Array();
      }
      return (
        (e.prototype.add = function (e) {
          var t = this,
            i = new Array();
          return (
            e.forEach(function (e) {
              var n = new rh(e, t.elements.length);
              i.push(n), t.elements.push(n);
            }),
            i
          );
        }),
        (e.prototype.computeBounds = function () {
          var e = new p(this.elements[0].x, this.elements[0].y),
            t = new p(this.elements[0].x, this.elements[0].y);
          return (
            this.elements.forEach(function (i) {
              i.x < e.x ? (e.x = i.x) : i.x > t.x && (t.x = i.x),
                i.y < e.y ? (e.y = i.y) : i.y > t.y && (t.y = i.y);
            }),
            {
              min: e,
              max: t,
              width: t.x - e.x,
              height: t.y - e.y,
            }
          );
        }),
        e
      );
    })(),
    sh =
      ((function () {
        function e() {}
        (e.Rectangle = function (e, t, i, n) {
          return [new p(e, t), new p(i, t), new p(i, n), new p(e, n)];
        }),
          (e.Circle = function (e, t, i, n) {
            void 0 === t && (t = 0),
              void 0 === i && (i = 0),
              void 0 === n && (n = 32);
            for (
              var r = new Array(), o = 0, s = (2 * Math.PI) / n, a = 0;
              a < n;
              a++
            )
              r.push(new p(t + Math.cos(o) * e, i + Math.sin(o) * e)), (o -= s);
            return r;
          }),
          (e.Parse = function (e) {
            var t,
              i = e
                .split(/[^-+eE\.\d]+/)
                .map(parseFloat)
                .filter(function (e) {
                  return !isNaN(e);
                }),
              n = [];
            for (t = 0; t < (2147483646 & i.length); t += 2)
              n.push(new p(i[t], i[t + 1]));
            return n;
          }),
          (e.StartingAt = function (e, t) {
            return Di.StartingAt(e, t);
          });
      })(),
      (function () {
        function e(e, t, i, n) {
          var r;
          void 0 === n && (n = earcut),
            (this._points = new oh()),
            (this._outlinepoints = new oh()),
            (this._holes = new Array()),
            (this._epoints = new Array()),
            (this._eholes = new Array()),
            (this.bjsEarcut = n),
            (this._name = e),
            (this._scene = i || It.LastCreatedScene),
            (r = t instanceof Di ? t.getPoints() : t),
            this._addToepoint(r),
            this._points.add(r),
            this._outlinepoints.add(r),
            void 0 === this.bjsEarcut &&
              F.Warn("Earcut was not found, the polygon will not be built.");
        }
        return (
          (e.prototype._addToepoint = function (e) {
            for (var t = 0, i = e; t < i.length; t++) {
              var n = i[t];
              this._epoints.push(n.x, n.y);
            }
          }),
          (e.prototype.addHole = function (e) {
            this._points.add(e);
            var t = new oh();
            return (
              t.add(e),
              this._holes.push(t),
              this._eholes.push(this._epoints.length / 2),
              this._addToepoint(e),
              this
            );
          }),
          (e.prototype.build = function (e, t) {
            void 0 === e && (e = !1), void 0 === t && (t = 0);
            var i = new Qi(this._name, this._scene),
              n = this.buildVertexData(t);
            return (
              i.setVerticesData(wt.PositionKind, n.positions, e),
              i.setVerticesData(wt.NormalKind, n.normals, e),
              i.setVerticesData(wt.UVKind, n.uvs, e),
              i.setIndices(n.indices),
              i
            );
          }),
          (e.prototype.buildVertexData = function (e) {
            var t = this;
            void 0 === e && (e = 0);
            var i = new Nt(),
              n = new Array(),
              r = new Array(),
              o = new Array(),
              s = this._points.computeBounds();
            this._points.elements.forEach(function (e) {
              n.push(0, 1, 0),
                r.push(e.x, 0, e.y),
                o.push((e.x - s.min.x) / s.width, (e.y - s.min.y) / s.height);
            });
            for (
              var a = new Array(),
                l = this.bjsEarcut(this._epoints, this._eholes, 2),
                c = 0;
              c < l.length;
              c++
            )
              a.push(l[c]);
            if (e > 0) {
              var u = r.length / 3;
              this._points.elements.forEach(function (t) {
                n.push(0, -1, 0),
                  r.push(t.x, -e, t.y),
                  o.push(
                    1 - (t.x - s.min.x) / s.width,
                    1 - (t.y - s.min.y) / s.height
                  );
              });
              var h = a.length;
              for (c = 0; c < h; c += 3) {
                var d = a[c + 0],
                  p = a[c + 1],
                  f = a[c + 2];
                a.push(f + u), a.push(p + u), a.push(d + u);
              }
              this.addSide(r, n, o, a, s, this._outlinepoints, e, !1),
                this._holes.forEach(function (i) {
                  t.addSide(r, n, o, a, s, i, e, !0);
                });
            }
            return (
              (i.indices = a),
              (i.positions = r),
              (i.normals = n),
              (i.uvs = o),
              i
            );
          }),
          (e.prototype.addSide = function (e, t, i, n, r, o, s, a) {
            for (
              var l = e.length / 3, c = 0, u = 0;
              u < o.elements.length;
              u++
            ) {
              var h,
                d = o.elements[u];
              (h =
                u + 1 > o.elements.length - 1
                  ? o.elements[0]
                  : o.elements[u + 1]),
                e.push(d.x, 0, d.y),
                e.push(d.x, -s, d.y),
                e.push(h.x, 0, h.y),
                e.push(h.x, -s, h.y);
              var p = new f(d.x, 0, d.y),
                _ = new f(h.x, 0, h.y).subtract(p),
                m = new f(0, 1, 0),
                g = f.Cross(_, m);
              (g = g.normalize()),
                i.push(c / r.width, 0),
                i.push(c / r.width, 1),
                (c += _.length()),
                i.push(c / r.width, 0),
                i.push(c / r.width, 1),
                a
                  ? (t.push(g.x, g.y, g.z),
                    t.push(g.x, g.y, g.z),
                    t.push(g.x, g.y, g.z),
                    t.push(g.x, g.y, g.z),
                    n.push(l),
                    n.push(l + 2),
                    n.push(l + 1),
                    n.push(l + 1),
                    n.push(l + 2),
                    n.push(l + 3))
                  : (t.push(-g.x, -g.y, -g.z),
                    t.push(-g.x, -g.y, -g.z),
                    t.push(-g.x, -g.y, -g.z),
                    t.push(-g.x, -g.y, -g.z),
                    n.push(l),
                    n.push(l + 1),
                    n.push(l + 2),
                    n.push(l + 1),
                    n.push(l + 3),
                    n.push(l + 2)),
                (l += 4);
            }
          }),
          e
        );
      })());
  (Nt.CreatePolygon = function (e, t, i, n, r, o, s) {
    for (
      var a = i || new Array(3), l = n, c = [], u = s || !1, h = 0;
      h < 3;
      h++
    )
      void 0 === a[h] && (a[h] = new _(0, 0, 1, 1)),
        l && void 0 === l[h] && (l[h] = new T(1, 1, 1, 1));
    var d = e.getVerticesData(wt.PositionKind),
      p = e.getVerticesData(wt.NormalKind),
      f = e.getVerticesData(wt.UVKind),
      m = e.getIndices(),
      g = d.length / 9,
      v = 0,
      y = 0,
      b = 0,
      S = 0,
      C = [0];
    if (u)
      for (var x = g; x < d.length / 3; x += 4)
        (y = d[3 * (x + 2)] - d[3 * x]),
          (b = d[3 * (x + 2) + 2] - d[3 * x + 2]),
          (S += Math.sqrt(y * y + b * b)),
          C.push(S);
    x = 0;
    for (var E = 0, P = 0; P < p.length; P += 3)
      Math.abs(p[P + 1]) < 0.001 && (E = 1),
        Math.abs(p[P + 1] - 1) < 0.001 && (E = 0),
        Math.abs(p[P + 1] + 1) < 0.001 && (E = 2),
        (x = P / 3),
        1 === E
          ? ((v = x - g),
            (f[2 * x] =
              v % 4 < 1.5
                ? u
                  ? a[E].x + ((a[E].z - a[E].x) * C[Math.floor(v / 4)]) / S
                  : a[E].x
                : u
                  ? a[E].x + ((a[E].z - a[E].x) * C[Math.floor(v / 4) + 1]) / S
                  : a[E].z),
            (f[2 * x + 1] = v % 2 == 0 ? a[E].w : a[E].y))
          : ((f[2 * x] = (1 - f[2 * x]) * a[E].x + f[2 * x] * a[E].z),
            (f[2 * x + 1] =
              (1 - f[2 * x + 1]) * a[E].y + f[2 * x + 1] * a[E].w)),
        l && c.push(l[E].r, l[E].g, l[E].b, l[E].a);
    Nt._ComputeSides(t, d, m, p, f, r, o);
    var A = new Nt();
    if (((A.indices = m), (A.positions = d), (A.normals = p), (A.uvs = f), l)) {
      var R = t === Nt.DOUBLESIDE ? c.concat(c) : c;
      A.colors = R;
    }
    return A;
  }),
    (Qi.CreatePolygon = function (e, t, i, n, r, o, s) {
      void 0 === s && (s = earcut);
      var a = {
        shape: t,
        holes: n,
        updatable: r,
        sideOrientation: o,
      };
      return ah.CreatePolygon(e, a, i, s);
    }),
    (Qi.ExtrudePolygon = function (e, t, i, n, r, o, s, a) {
      void 0 === a && (a = earcut);
      var l = {
        shape: t,
        holes: r,
        depth: i,
        updatable: o,
        sideOrientation: s,
      };
      return ah.ExtrudePolygon(e, l, n, a);
    });
  var ah = (function () {
    function e() {}
    return (
      (e.CreatePolygon = function (e, t, i, n) {
        void 0 === i && (i = null),
          void 0 === n && (n = earcut),
          (t.sideOrientation = Qi._GetDefaultSideOrientation(
            t.sideOrientation
          ));
        for (
          var r = t.shape,
            o = t.holes || [],
            s = t.depth || 0,
            a = [],
            l = [],
            c = 0;
          c < r.length;
          c++
        )
          a[c] = new p(r[c].x, r[c].z);
        a[0].equalsWithEpsilon(a[a.length - 1], 1e-8) && a.pop();
        for (
          var u = new sh(e, a, i || j.LastCreatedScene, n), h = 0;
          h < o.length;
          h++
        ) {
          l = [];
          for (var d = 0; d < o[h].length; d++)
            l.push(new p(o[h][d].x, o[h][d].z));
          u.addHole(l);
        }
        var f = u.build(t.updatable, s);
        return (
          (f._originalBuilderSideOrientation = t.sideOrientation),
          Nt.CreatePolygon(
            f,
            t.sideOrientation,
            t.faceUV,
            t.faceColors,
            t.frontUVs,
            t.backUVs,
            t.wrap
          ).applyToMesh(f, t.updatable),
          f
        );
      }),
      (e.ExtrudePolygon = function (t, i, n, r) {
        return (
          void 0 === n && (n = null),
          void 0 === r && (r = earcut),
          e.CreatePolygon(t, i, n, r)
        );
      }),
      e
    );
  })();
  Qi.CreateLathe = function (e, t, i, n, r, o, s) {
    var a = {
      shape: t,
      radius: i,
      tessellation: n,
      sideOrientation: s,
      updatable: o,
    };
    return lh.CreateLathe(e, a, r);
  };
  var lh = (function () {
    function e() {}
    return (
      (e.CreateLathe = function (e, t, i) {
        void 0 === i && (i = null);
        var n,
          r = t.arc ? (t.arc <= 0 || t.arc > 1 ? 1 : t.arc) : 1,
          o = void 0 === t.closed || t.closed,
          s = t.shape,
          a = t.radius || 1,
          l = t.tessellation || 64,
          c = t.clip || 0,
          u = t.updatable,
          h = Qi._GetDefaultSideOrientation(t.sideOrientation),
          d = t.cap || Qi.NO_CAP,
          p = 2 * Math.PI,
          _ = new Array(),
          m = t.invertUV || !1,
          g = 0,
          v = 0,
          y = (p / l) * r,
          b = new Array();
        for (g = 0; g <= l - c; g++) {
          for (
            b = [],
              (d != Qi.CAP_START && d != Qi.CAP_ALL) ||
                (b.push(new f(0, s[0].y, 0)),
                b.push(
                  new f(
                    Math.cos(g * y) * s[0].x * a,
                    s[0].y,
                    Math.sin(g * y) * s[0].x * a
                  )
                )),
              v = 0;
            v < s.length;
            v++
          )
            (n = new f(
              Math.cos(g * y) * s[v].x * a,
              s[v].y,
              Math.sin(g * y) * s[v].x * a
            )),
              b.push(n);
          (d != Qi.CAP_END && d != Qi.CAP_ALL) ||
            (b.push(
              new f(
                Math.cos(g * y) * s[s.length - 1].x * a,
                s[s.length - 1].y,
                Math.sin(g * y) * s[s.length - 1].x * a
              )
            ),
            b.push(new f(0, s[s.length - 1].y, 0))),
            _.push(b);
        }
        return Fo.CreateRibbon(
          e,
          {
            pathArray: _,
            closeArray: o,
            sideOrientation: h,
            updatable: u,
            invertUV: m,
            frontUVs: t.frontUVs,
            backUVs: t.backUVs,
          },
          i
        );
      }),
      e
    );
  })();
  Nt.CreateTiledPlane = function (e) {
    var t = e.pattern || Qi.NO_FLIP,
      i = e.tileWidth || e.tileSize || 1,
      n = e.tileHeight || e.tileSize || 1,
      r = e.alignHorizontal || 0,
      o = e.alignVertical || 0,
      s = e.width || e.size || 1,
      a = Math.floor(s / i),
      l = s - a * i,
      c = e.height || e.size || 1,
      u = Math.floor(c / n),
      h = c - u * n,
      d = (i * a) / 2,
      p = (n * u) / 2,
      f = 0,
      _ = 0,
      m = 0,
      g = 0,
      v = 0,
      y = 0;
    if (l > 0 || h > 0) {
      switch (((m = -d), (g = -p), (v = d), (y = p), r)) {
        case Qi.CENTER:
          (m -= l /= 2), (v += l);
          break;
        case Qi.LEFT:
          (v += l), (f = -l / 2);
          break;
        case Qi.RIGHT:
          (m -= l), (f = l / 2);
      }
      switch (o) {
        case Qi.CENTER:
          (g -= h /= 2), (y += h);
          break;
        case Qi.BOTTOM:
          (y += h), (_ = -h / 2);
          break;
        case Qi.TOP:
          (g -= h), (_ = h / 2);
      }
    }
    var b = [],
      T = [],
      S = [];
    (S[0] = [0, 0, 1, 0, 1, 1, 0, 1]),
      (S[1] = [0, 0, 1, 0, 1, 1, 0, 1]),
      (t !== Qi.ROTATE_TILE && t !== Qi.ROTATE_ROW) ||
        (S[1] = [1, 1, 0, 1, 0, 0, 1, 0]),
      (t !== Qi.FLIP_TILE && t !== Qi.FLIP_ROW) ||
        (S[1] = [1, 0, 0, 0, 0, 1, 1, 1]),
      (t !== Qi.FLIP_N_ROTATE_TILE && t !== Qi.FLIP_N_ROTATE_ROW) ||
        (S[1] = [0, 1, 1, 1, 1, 0, 0, 0]);
    for (var C = [], x = [], E = [], P = 0, A = 0; A < u; A++)
      for (var R = 0; R < a; R++)
        b.push(R * i - d + f, A * n - p + _, 0),
          b.push((R + 1) * i - d + f, A * n - p + _, 0),
          b.push((R + 1) * i - d + f, (A + 1) * n - p + _, 0),
          b.push(R * i - d + f, (A + 1) * n - p + _, 0),
          E.push(P, P + 1, P + 3, P + 1, P + 2, P + 3),
          (C =
            t === Qi.FLIP_TILE ||
            t === Qi.ROTATE_TILE ||
            t === Qi.FLIP_N_ROTATE_TILE
              ? C.concat(S[((R % 2) + (A % 2)) % 2])
              : t === Qi.FLIP_ROW ||
                  t === Qi.ROTATE_ROW ||
                  t === Qi.FLIP_N_ROTATE_ROW
                ? C.concat(S[A % 2])
                : C.concat(S[0])),
          x.push(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
          T.push(0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1),
          (P += 4);
    if (l > 0 || h > 0) {
      var M,
        O,
        I,
        D,
        w = h > 0 && (o === Qi.CENTER || o === Qi.TOP),
        N = h > 0 && (o === Qi.CENTER || o === Qi.BOTTOM),
        L = l > 0 && (r === Qi.CENTER || r === Qi.RIGHT),
        F = l > 0 && (r === Qi.CENTER || r === Qi.LEFT),
        B = [];
      if (
        (w &&
          L &&
          (b.push(m + f, g + _, 0),
          b.push(-d + f, g + _, 0),
          b.push(-d + f, g + h + _, 0),
          b.push(m + f, g + h + _, 0),
          E.push(P, P + 1, P + 3, P + 1, P + 2, P + 3),
          (P += 4),
          (B = [
            (M = 1 - l / i),
            (O = 1 - h / n),
            (I = 1),
            O,
            I,
            (D = 1),
            M,
            D,
          ]),
          t === Qi.ROTATE_ROW &&
            (B = [1 - M, 1 - O, 1 - I, 1 - O, 1 - I, 1 - D, 1 - M, 1 - D]),
          t === Qi.FLIP_ROW && (B = [1 - M, O, 1 - I, O, 1 - I, D, 1 - M, D]),
          t === Qi.FLIP_N_ROTATE_ROW &&
            (B = [M, 1 - O, I, 1 - O, I, 1 - D, M, 1 - D]),
          (C = C.concat(B)),
          x.push(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
          T.push(0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1)),
        w &&
          F &&
          (b.push(d + f, g + _, 0),
          b.push(v + f, g + _, 0),
          b.push(v + f, g + h + _, 0),
          b.push(d + f, g + h + _, 0),
          E.push(P, P + 1, P + 3, P + 1, P + 2, P + 3),
          (P += 4),
          (B = [(M = 0), (O = 1 - h / n), (I = l / i), O, I, (D = 1), M, D]),
          (t === Qi.ROTATE_ROW || (t === Qi.ROTATE_TILE && a % 2 == 0)) &&
            (B = [1 - M, 1 - O, 1 - I, 1 - O, 1 - I, 1 - D, 1 - M, 1 - D]),
          (t === Qi.FLIP_ROW || (t === Qi.FLIP_TILE && a % 2 == 0)) &&
            (B = [1 - M, O, 1 - I, O, 1 - I, D, 1 - M, D]),
          (t === Qi.FLIP_N_ROTATE_ROW ||
            (t === Qi.FLIP_N_ROTATE_TILE && a % 2 == 0)) &&
            (B = [M, 1 - O, I, 1 - O, I, 1 - D, M, 1 - D]),
          (C = C.concat(B)),
          x.push(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
          T.push(0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1)),
        N &&
          L &&
          (b.push(m + f, p + _, 0),
          b.push(-d + f, p + _, 0),
          b.push(-d + f, y + _, 0),
          b.push(m + f, y + _, 0),
          E.push(P, P + 1, P + 3, P + 1, P + 2, P + 3),
          (P += 4),
          (B = [(M = 1 - l / i), (O = 0), (I = 1), O, I, (D = h / n), M, D]),
          ((t === Qi.ROTATE_ROW && u % 2 == 1) ||
            (t === Qi.ROTATE_TILE && u % 1 == 0)) &&
            (B = [1 - M, 1 - O, 1 - I, 1 - O, 1 - I, 1 - D, 1 - M, 1 - D]),
          ((t === Qi.FLIP_ROW && u % 2 == 1) ||
            (t === Qi.FLIP_TILE && u % 2 == 0)) &&
            (B = [1 - M, O, 1 - I, O, 1 - I, D, 1 - M, D]),
          ((t === Qi.FLIP_N_ROTATE_ROW && u % 2 == 1) ||
            (t === Qi.FLIP_N_ROTATE_TILE && u % 2 == 0)) &&
            (B = [M, 1 - O, I, 1 - O, I, 1 - D, M, 1 - D]),
          (C = C.concat(B)),
          x.push(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
          T.push(0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1)),
        N &&
          F &&
          (b.push(d + f, p + _, 0),
          b.push(v + f, p + _, 0),
          b.push(v + f, y + _, 0),
          b.push(d + f, y + _, 0),
          E.push(P, P + 1, P + 3, P + 1, P + 2, P + 3),
          (P += 4),
          (B = [(M = 0), (O = 0), (I = l / i), O, I, (D = h / n), M, D]),
          ((t === Qi.ROTATE_ROW && u % 2 == 1) ||
            (t === Qi.ROTATE_TILE && (u + a) % 2 == 1)) &&
            (B = [1 - M, 1 - O, 1 - I, 1 - O, 1 - I, 1 - D, 1 - M, 1 - D]),
          ((t === Qi.FLIP_ROW && u % 2 == 1) ||
            (t === Qi.FLIP_TILE && (u + a) % 2 == 1)) &&
            (B = [1 - M, O, 1 - I, O, 1 - I, D, 1 - M, D]),
          ((t === Qi.FLIP_N_ROTATE_ROW && u % 2 == 1) ||
            (t === Qi.FLIP_N_ROTATE_TILE && (u + a) % 2 == 1)) &&
            (B = [M, 1 - O, I, 1 - O, I, 1 - D, M, 1 - D]),
          (C = C.concat(B)),
          x.push(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
          T.push(0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1)),
        w)
      ) {
        var V = [];
        for (
          M = 0,
            O = 1 - h / n,
            I = 1,
            D = 1,
            V[0] = [M, O, I, O, I, D, M, D],
            V[1] = [M, O, I, O, I, D, M, D],
            (t !== Qi.ROTATE_TILE && t !== Qi.ROTATE_ROW) ||
              (V[1] = [1 - M, 1 - O, 1 - I, 1 - O, 1 - I, 1 - D, 1 - M, 1 - D]),
            (t !== Qi.FLIP_TILE && t !== Qi.FLIP_ROW) ||
              (V[1] = [1 - M, O, 1 - I, O, 1 - I, D, 1 - M, D]),
            (t !== Qi.FLIP_N_ROTATE_TILE && t !== Qi.FLIP_N_ROTATE_ROW) ||
              (V[1] = [M, 1 - O, I, 1 - O, I, 1 - D, M, 1 - D]),
            R = 0;
          R < a;
          R++
        )
          b.push(R * i - d + f, g + _, 0),
            b.push((R + 1) * i - d + f, g + _, 0),
            b.push((R + 1) * i - d + f, g + h + _, 0),
            b.push(R * i - d + f, g + h + _, 0),
            E.push(P, P + 1, P + 3, P + 1, P + 2, P + 3),
            (P += 4),
            (C =
              t === Qi.FLIP_TILE ||
              t === Qi.ROTATE_TILE ||
              t === Qi.FLIP_N_ROTATE_TILE
                ? C.concat(V[(R + 1) % 2])
                : t === Qi.FLIP_ROW ||
                    t === Qi.ROTATE_ROW ||
                    t === Qi.FLIP_N_ROTATE_ROW
                  ? C.concat(V[1])
                  : C.concat(V[0])),
            x.push(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
            T.push(0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1);
      }
      if (N) {
        var k = [];
        for (
          M = 0,
            O = 0,
            I = 1,
            D = h / n,
            k[0] = [M, O, I, O, I, D, M, D],
            k[1] = [M, O, I, O, I, D, M, D],
            (t !== Qi.ROTATE_TILE && t !== Qi.ROTATE_ROW) ||
              (k[1] = [1 - M, 1 - O, 1 - I, 1 - O, 1 - I, 1 - D, 1 - M, 1 - D]),
            (t !== Qi.FLIP_TILE && t !== Qi.FLIP_ROW) ||
              (k[1] = [1 - M, O, 1 - I, O, 1 - I, D, 1 - M, D]),
            (t !== Qi.FLIP_N_ROTATE_TILE && t !== Qi.FLIP_N_ROTATE_ROW) ||
              (k[1] = [M, 1 - O, I, 1 - O, I, 1 - D, M, 1 - D]),
            R = 0;
          R < a;
          R++
        )
          b.push(R * i - d + f, y - h + _, 0),
            b.push((R + 1) * i - d + f, y - h + _, 0),
            b.push((R + 1) * i - d + f, y + _, 0),
            b.push(R * i - d + f, y + _, 0),
            E.push(P, P + 1, P + 3, P + 1, P + 2, P + 3),
            (P += 4),
            (C =
              t === Qi.FLIP_TILE ||
              t === Qi.ROTATE_TILE ||
              t === Qi.FLIP_N_ROTATE_TILE
                ? C.concat(k[(R + u) % 2])
                : t === Qi.FLIP_ROW ||
                    t === Qi.ROTATE_ROW ||
                    t === Qi.FLIP_N_ROTATE_ROW
                  ? C.concat(k[u % 2])
                  : C.concat(k[0])),
            x.push(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
            T.push(0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1);
      }
      if (L) {
        var U = [];
        for (
          M = 1 - l / i,
            O = 0,
            I = 1,
            D = 1,
            U[0] = [M, O, I, O, I, D, M, D],
            U[1] = [M, O, I, O, I, D, M, D],
            (t !== Qi.ROTATE_TILE && t !== Qi.ROTATE_ROW) ||
              (U[1] = [1 - M, 1 - O, 1 - I, 1 - O, 1 - I, 1 - D, 1 - M, 1 - D]),
            (t !== Qi.FLIP_TILE && t !== Qi.FLIP_ROW) ||
              (U[1] = [1 - M, O, 1 - I, O, 1 - I, D, 1 - M, D]),
            (t !== Qi.FLIP_N_ROTATE_TILE && t !== Qi.FLIP_N_ROTATE_ROW) ||
              (U[1] = [M, 1 - O, I, 1 - O, I, 1 - D, M, 1 - D]),
            A = 0;
          A < u;
          A++
        )
          b.push(m + f, A * n - p + _, 0),
            b.push(m + l + f, A * n - p + _, 0),
            b.push(m + l + f, (A + 1) * n - p + _, 0),
            b.push(m + f, (A + 1) * n - p + _, 0),
            E.push(P, P + 1, P + 3, P + 1, P + 2, P + 3),
            (P += 4),
            (C =
              t === Qi.FLIP_TILE ||
              t === Qi.ROTATE_TILE ||
              t === Qi.FLIP_N_ROTATE_TILE
                ? C.concat(U[(A + 1) % 2])
                : t === Qi.FLIP_ROW ||
                    t === Qi.ROTATE_ROW ||
                    t === Qi.FLIP_N_ROTATE_ROW
                  ? C.concat(U[A % 2])
                  : C.concat(U[0])),
            x.push(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
            T.push(0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1);
      }
      if (F) {
        var z = [];
        for (
          M = 0,
            O = 0,
            I = l / n,
            D = 1,
            z[0] = [M, O, I, O, I, D, M, D],
            z[1] = [M, O, I, O, I, D, M, D],
            (t !== Qi.ROTATE_TILE && t !== Qi.ROTATE_ROW) ||
              (z[1] = [1 - M, 1 - O, 1 - I, 1 - O, 1 - I, 1 - D, 1 - M, 1 - D]),
            (t !== Qi.FLIP_TILE && t !== Qi.FLIP_ROW) ||
              (z[1] = [1 - M, O, 1 - I, O, 1 - I, D, 1 - M, D]),
            (t !== Qi.FLIP_N_ROTATE_TILE && t !== Qi.FLIP_N_ROTATE_ROW) ||
              (z[1] = [M, 1 - O, I, 1 - O, I, 1 - D, M, 1 - D]),
            A = 0;
          A < u;
          A++
        )
          b.push(v - l + f, A * n - p + _, 0),
            b.push(v + f, A * n - p + _, 0),
            b.push(v + f, (A + 1) * n - p + _, 0),
            b.push(v - l + f, (A + 1) * n - p + _, 0),
            E.push(P, P + 1, P + 3, P + 1, P + 2, P + 3),
            (P += 4),
            (C =
              t === Qi.FLIP_TILE ||
              t === Qi.ROTATE_TILE ||
              t === Qi.FLIP_N_ROTATE_TILE
                ? C.concat(z[(A + a) % 2])
                : t === Qi.FLIP_ROW ||
                    t === Qi.ROTATE_ROW ||
                    t === Qi.FLIP_N_ROTATE_ROW
                  ? C.concat(z[A % 2])
                  : C.concat(z[0])),
            x.push(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
            T.push(0, 0, -1, 0, 0, -1, 0, 0, -1, 0, 0, -1);
      }
    }
    var G = 0 === e.sideOrientation ? 0 : e.sideOrientation || Nt.DEFAULTSIDE;
    Nt._ComputeSides(G, b, E, T, C, e.frontUVs, e.backUVs);
    var W = new Nt();
    (W.indices = E), (W.positions = b), (W.normals = T), (W.uvs = C);
    var H = G === Nt.DOUBLESIDE ? x.concat(x) : x;
    return (W.colors = H), W;
  };
  var ch = (function () {
    function e() {}
    return (
      (e.CreateTiledPlane = function (e, t, i) {
        void 0 === i && (i = null);
        var n = new Qi(e, i);
        return (
          (t.sideOrientation = Qi._GetDefaultSideOrientation(
            t.sideOrientation
          )),
          (n._originalBuilderSideOrientation = t.sideOrientation),
          Nt.CreateTiledPlane(t).applyToMesh(n, t.updatable),
          n
        );
      }),
      e
    );
  })();
  Qi.CreateTube = function (e, t, i, n, r, o, s, a, l, c) {
    var u = {
      path: t,
      radius: i,
      tessellation: n,
      radiusFunction: r,
      arc: 1,
      cap: o,
      updatable: a,
      sideOrientation: l,
      instance: c,
    };
    return uh.CreateTube(e, u, s);
  };
  var uh = (function () {
    function e() {}
    return (
      (e.CreateTube = function (e, t, i) {
        void 0 === i && (i = null);
        var n = t.path,
          r = t.instance,
          o = 1;
        void 0 !== t.radius
          ? (o = t.radius)
          : r && (o = r._creationDataStorage.radius);
        var s = t.tessellation || 64,
          a = t.radiusFunction || null,
          l = t.cap || Qi.NO_CAP,
          c = t.invertUV || !1,
          u = t.updatable,
          h = Qi._GetDefaultSideOrientation(t.sideOrientation);
        t.arc = t.arc && (t.arc <= 0 || t.arc > 1) ? 1 : t.arc || 1;
        var d,
          p,
          _ = function (e, t, i, n, r, o, s, a) {
            for (
              var l,
                c,
                u,
                h,
                d = t.getTangents(),
                p = t.getNormals(),
                _ = t.getDistances(),
                m = ((2 * Math.PI) / r) * a,
                v =
                  o ||
                  function () {
                    return n;
                  },
                b = y.Matrix[0],
                T = s === Qi.NO_CAP || s === Qi.CAP_END ? 0 : 2,
                S = 0;
              S < e.length;
              S++
            ) {
              (c = v(S, _[S])), (l = Array()), (u = p[S]);
              for (var C = 0; C < r; C++)
                g.RotationAxisToRef(d[S], m * C, b),
                  (h = l[C] ? l[C] : f.Zero()),
                  f.TransformCoordinatesToRef(u, b, h),
                  h.scaleInPlace(c).addInPlace(e[S]),
                  (l[C] = h);
              (i[T] = l), T++;
            }
            var x = function (t, i) {
              for (var n = Array(), r = 0; r < t; r++) n.push(e[i]);
              return n;
            };
            switch (s) {
              case Qi.NO_CAP:
                break;
              case Qi.CAP_START:
                (i[0] = x(r, 0)), (i[1] = i[2].slice(0));
                break;
              case Qi.CAP_END:
                (i[T] = i[T - 1].slice(0)), (i[T + 1] = x(r, e.length - 1));
                break;
              case Qi.CAP_ALL:
                (i[0] = x(r, 0)),
                  (i[1] = i[2].slice(0)),
                  (i[T] = i[T - 1].slice(0)),
                  (i[T + 1] = x(r, e.length - 1));
            }
            return i;
          };
        if (r) {
          var m = r._creationDataStorage,
            v = t.arc || m.arc;
          return (
            (p = _(
              n,
              (d = m.path3D.update(n)),
              m.pathArray,
              o,
              m.tessellation,
              a,
              m.cap,
              v
            )),
            (r = Fo.CreateRibbon("", {
              pathArray: p,
              instance: r,
            })),
            (m.path3D = d),
            (m.pathArray = p),
            (m.arc = v),
            (m.radius = o),
            r
          );
        }
        p = _(
          n,
          (d = new wi(n)),
          new Array(),
          o,
          s,
          a,
          (l = l < 0 || l > 3 ? 0 : l),
          t.arc
        );
        var b = Fo.CreateRibbon(
          e,
          {
            pathArray: p,
            closePath: !0,
            closeArray: !1,
            updatable: u,
            sideOrientation: h,
            invertUV: c,
            frontUVs: t.frontUVs,
            backUVs: t.backUVs,
          },
          i
        );
        return (
          (b._creationDataStorage.pathArray = p),
          (b._creationDataStorage.path3D = d),
          (b._creationDataStorage.tessellation = s),
          (b._creationDataStorage.cap = l),
          (b._creationDataStorage.arc = t.arc),
          (b._creationDataStorage.radius = o),
          b
        );
      }),
      e
    );
  })();
  (Nt.CreateIcoSphere = function (e) {
    var t,
      i = e.sideOrientation || Nt.DEFAULTSIDE,
      n = e.radius || 1,
      r = void 0 === e.flat || e.flat,
      o = e.subdivisions || 4,
      s = e.radiusX || n,
      a = e.radiusY || n,
      l = e.radiusZ || n,
      c = (1 + Math.sqrt(5)) / 2,
      u = [
        -1,
        c,
        -0,
        1,
        c,
        0,
        -1,
        -c,
        0,
        1,
        -c,
        0,
        0,
        -1,
        -c,
        0,
        1,
        -c,
        0,
        -1,
        c,
        0,
        1,
        c,
        c,
        0,
        1,
        c,
        0,
        -1,
        -c,
        0,
        1,
        -c,
        0,
        -1,
      ],
      h = [
        0, 11, 5, 0, 5, 1, 0, 1, 7, 0, 7, 10, 12, 22, 23, 1, 5, 20, 5, 11, 4,
        23, 22, 13, 22, 18, 6, 7, 1, 8, 14, 21, 4, 14, 4, 2, 16, 13, 6, 15, 6,
        19, 3, 8, 9, 4, 21, 5, 13, 17, 23, 6, 13, 22, 19, 6, 18, 9, 8, 1,
      ],
      d = [
        0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 2, 3, 3, 3, 4, 7, 8, 9, 9, 10,
        11,
      ],
      _ = [
        5, 1, 3, 1, 6, 4, 0, 0, 5, 3, 4, 2, 2, 2, 4, 0, 2, 0, 1, 1, 6, 0, 6, 2,
        0, 4, 3, 3, 4, 4, 3, 1, 4, 2, 4, 4, 0, 2, 1, 1, 2, 2, 3, 3, 1, 3, 2, 4,
      ],
      m = [0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0],
      g = new Array(),
      v = new Array(),
      y = new Array(),
      b = new Array(),
      T = 0,
      S = new Array(3),
      C = new Array(3);
    for (t = 0; t < 3; t++) (S[t] = f.Zero()), (C[t] = p.Zero());
    for (var x = 0; x < 20; x++) {
      for (t = 0; t < 3; t++) {
        var E = h[3 * x + t];
        S[t].copyFromFloats(u[3 * d[E]], u[3 * d[E] + 1], u[3 * d[E] + 2]),
          S[t].normalize().scaleInPlace(n),
          C[t].copyFromFloats(
            0.134765625 * _[2 * E] + 0.05859375 + -0.0390625 * m[x],
            0.2333984375 * _[2 * E + 1] + 0.025390625 + 0.01953125 * m[x]
          );
      }
      for (
        var P = function (e, t, i, n) {
            var c,
              u = f.Lerp(S[0], S[2], t / o),
              h = f.Lerp(S[1], S[2], t / o),
              d = o === t ? S[2] : f.Lerp(u, h, e / (o - t));
            if ((d.normalize(), r)) {
              var _ = f.Lerp(S[0], S[2], n / o),
                m = f.Lerp(S[1], S[2], n / o);
              c = f.Lerp(_, m, i / (o - n));
            } else c = new f(d.x, d.y, d.z);
            (c.x /= s), (c.y /= a), (c.z /= l), c.normalize();
            var x = p.Lerp(C[0], C[2], t / o),
              E = p.Lerp(C[1], C[2], t / o),
              P = o === t ? C[2] : p.Lerp(x, E, e / (o - t));
            v.push(d.x * s, d.y * a, d.z * l),
              y.push(c.x, c.y, c.z),
              b.push(P.x, P.y),
              g.push(T),
              T++;
          },
          A = 0;
        A < o;
        A++
      )
        for (var R = 0; R + A < o; R++)
          P(R, A, R + 1 / 3, A + 1 / 3),
            P(R + 1, A, R + 1 / 3, A + 1 / 3),
            P(R, A + 1, R + 1 / 3, A + 1 / 3),
            R + A + 1 < o &&
              (P(R + 1, A, R + 2 / 3, A + 2 / 3),
              P(R + 1, A + 1, R + 2 / 3, A + 2 / 3),
              P(R, A + 1, R + 2 / 3, A + 2 / 3));
    }
    Nt._ComputeSides(i, v, g, y, b, e.frontUVs, e.backUVs);
    var M = new Nt();
    return (M.indices = g), (M.positions = v), (M.normals = y), (M.uvs = b), M;
  }),
    (Qi.CreateIcoSphere = function (e, t, i) {
      return hh.CreateIcoSphere(e, t, i);
    });
  var hh = (function () {
    function e() {}
    return (
      (e.CreateIcoSphere = function (e, t, i) {
        void 0 === i && (i = null);
        var n = new Qi(e, i);
        return (
          (t.sideOrientation = Qi._GetDefaultSideOrientation(
            t.sideOrientation
          )),
          (n._originalBuilderSideOrientation = t.sideOrientation),
          Nt.CreateIcoSphere(t).applyToMesh(n, t.updatable),
          n
        );
      }),
      e
    );
  })();
  Qi.CreateDecal = function (e, t, i, n, r, o) {
    var s = {
      position: i,
      normal: n,
      size: r,
      angle: o,
    };
    return dh.CreateDecal(e, t, s);
  };
  var dh = (function () {
    function e() {}
    return (
      (e.CreateDecal = function (e, t, i) {
        var n = t.getIndices(),
          r = t.getVerticesData(wt.PositionKind),
          o = t.getVerticesData(wt.NormalKind),
          s = i.position || f.Zero(),
          a = i.normal || f.Up(),
          l = i.size || f.One(),
          c = i.angle || 0;
        if (!a) {
          var u = new f(0, 0, 1),
            h = t.getScene().activeCamera,
            d = f.TransformCoordinates(u, h.getWorldMatrix());
          a = h.globalPosition.subtract(d);
        }
        var p = -Math.atan2(a.z, a.x) - Math.PI / 2,
          _ = Math.sqrt(a.x * a.x + a.z * a.z),
          m = Math.atan2(a.y, _),
          v = g
            .RotationYawPitchRoll(p, m, c)
            .multiply(g.Translation(s.x, s.y, s.z)),
          y = g.Invert(v),
          b = t.getWorldMatrix().multiply(y),
          T = new Nt();
        (T.indices = []), (T.positions = []), (T.normals = []), (T.uvs = []);
        for (
          var S = 0,
            C = function (e) {
              var t = new Ds();
              if (!n || !r || !o) return t;
              var i = n[e];
              return (
                (t.position = new f(r[3 * i], r[3 * i + 1], r[3 * i + 2])),
                (t.position = f.TransformCoordinates(t.position, b)),
                (t.normal = new f(o[3 * i], o[3 * i + 1], o[3 * i + 2])),
                (t.normal = f.TransformNormal(t.normal, b)),
                t
              );
            },
            x = function (e, t) {
              if (0 === e.length) return e;
              for (
                var i = 0.5 * Math.abs(f.Dot(l, t)),
                  n = function (e, n) {
                    var r = f.GetClipFactor(e.position, n.position, t, i);
                    return new Ds(
                      f.Lerp(e.position, n.position, r),
                      f.Lerp(e.normal, n.normal, r)
                    );
                  },
                  r = new Array(),
                  o = 0;
                o < e.length;
                o += 3
              ) {
                var s,
                  a,
                  c,
                  u = null,
                  h = null,
                  d = null,
                  p = null;
                switch (
                  ((s = f.Dot(e[o].position, t) - i > 0) ? 1 : 0) +
                  ((a = f.Dot(e[o + 1].position, t) - i > 0) ? 1 : 0) +
                  ((c = f.Dot(e[o + 2].position, t) - i > 0) ? 1 : 0)
                ) {
                  case 0:
                    r.push(e[o]), r.push(e[o + 1]), r.push(e[o + 2]);
                    break;
                  case 1:
                    if (
                      (s &&
                        ((u = e[o + 1]),
                        (h = e[o + 2]),
                        (d = n(e[o], u)),
                        (p = n(e[o], h))),
                      a)
                    ) {
                      (u = e[o]),
                        (h = e[o + 2]),
                        (d = n(e[o + 1], u)),
                        (p = n(e[o + 1], h)),
                        r.push(d),
                        r.push(h.clone()),
                        r.push(u.clone()),
                        r.push(h.clone()),
                        r.push(d.clone()),
                        r.push(p);
                      break;
                    }
                    c &&
                      ((u = e[o]),
                      (h = e[o + 1]),
                      (d = n(e[o + 2], u)),
                      (p = n(e[o + 2], h))),
                      u &&
                        h &&
                        d &&
                        p &&
                        (r.push(u.clone()),
                        r.push(h.clone()),
                        r.push(d),
                        r.push(p),
                        r.push(d.clone()),
                        r.push(h.clone()));
                    break;
                  case 2:
                    s ||
                      ((h = n((u = e[o].clone()), e[o + 1])),
                      (d = n(u, e[o + 2])),
                      r.push(u),
                      r.push(h),
                      r.push(d)),
                      a ||
                        ((h = n((u = e[o + 1].clone()), e[o + 2])),
                        (d = n(u, e[o])),
                        r.push(u),
                        r.push(h),
                        r.push(d)),
                      c ||
                        ((h = n((u = e[o + 2].clone()), e[o])),
                        (d = n(u, e[o + 1])),
                        r.push(u),
                        r.push(h),
                        r.push(d));
                }
              }
              return r;
            },
            E = 0;
          E < n.length;
          E += 3
        ) {
          var P = new Array();
          if (
            (P.push(C(E)),
            P.push(C(E + 1)),
            P.push(C(E + 2)),
            (P = x(P, new f(1, 0, 0))),
            (P = x(P, new f(-1, 0, 0))),
            (P = x(P, new f(0, 1, 0))),
            (P = x(P, new f(0, -1, 0))),
            (P = x(P, new f(0, 0, 1))),
            0 !== (P = x(P, new f(0, 0, -1))).length)
          )
            for (var A = 0; A < P.length; A++) {
              var R = P[A];
              T.indices.push(S),
                R.position.toArray(T.positions, 3 * S),
                R.normal.toArray(T.normals, 3 * S),
                T.uvs.push(0.5 + R.position.x / l.x),
                T.uvs.push(0.5 + R.position.y / l.y),
                S++;
            }
        }
        var M = new Qi(e, t.getScene());
        return (
          T.applyToMesh(M),
          (M.position = s.clone()),
          (M.rotation = new f(m, p, c)),
          M
        );
      }),
      e
    );
  })();
  (Nt.CreateCapsule = function (e) {
    void 0 === e &&
      (e = {
        subdivisions: 2,
        tessellation: 16,
        height: 1,
        radius: 0.25,
        capSubdivisions: 6,
      });
    var t,
      i,
      n = Math.max(e.subdivisions ? e.subdivisions : 2, 1),
      r = Math.max(e.tessellation ? e.tessellation : 16, 3),
      o = Math.max(e.height ? e.height : 1, 0),
      s = Math.max(e.radius ? e.radius : 0.25, 0),
      a = Math.max(e.capSubdivisions ? e.capSubdivisions : 6, 1),
      l = r,
      c = n,
      u = Math.max(e.radiusTop ? e.radiusTop : s, 0),
      h = Math.max(e.radiusBottom ? e.radiusBottom : s, 0),
      d = o - (u + h),
      _ = 2 * Math.PI,
      m = Math.max(e.topCapSubdivisions ? e.topCapSubdivisions : a, 1),
      v = Math.max(e.bottomCapSubdivisions ? e.bottomCapSubdivisions : a, 1),
      y = Math.acos((h - u) / o),
      b = [],
      T = [],
      S = [],
      C = [],
      x = 0,
      E = [],
      P = 0.5 * d,
      A = 0.5 * Math.PI,
      R = f.Zero(),
      M = f.Zero(),
      O = Math.cos(y),
      I = Math.sin(y),
      D = new p(u * I, P + u * O).subtract(new p(h * I, h * O - P)).length(),
      w = u * y + D + h * (A - y),
      N = 0;
    for (i = 0; i <= m; i++) {
      var L = [],
        F = A - y * (i / m);
      N += (u * y) / m;
      var B = Math.cos(F),
        V = Math.sin(F),
        k = B * u;
      for (t = 0; t <= l; t++) {
        var U = (j = t / l) * _ + 0,
          z = Math.sin(U),
          G = Math.cos(U);
        (M.x = k * z),
          (M.y = P + V * u),
          (M.z = k * G),
          T.push(M.x, M.y, M.z),
          R.set(B * z, V, B * G),
          S.push(R.x, R.y, R.z),
          C.push(j, 1 - N / w),
          L.push(x),
          x++;
      }
      E.push(L);
    }
    var W = o - u - h + O * u - O * h,
      H = (I * (h - u)) / W;
    for (i = 1; i <= c; i++) {
      for (
        L = [], N += D / c, k = I * ((i * (h - u)) / c + u), t = 0;
        t <= l;
        t++
      )
        (U = (j = t / l) * _ + 0),
          (z = Math.sin(U)),
          (G = Math.cos(U)),
          (M.x = k * z),
          (M.y = P + O * u - (i * W) / c),
          (M.z = k * G),
          T.push(M.x, M.y, M.z),
          R.set(z, H, G).normalize(),
          S.push(R.x, R.y, R.z),
          C.push(j, 1 - N / w),
          L.push(x),
          x++;
      E.push(L);
    }
    for (i = 1; i <= v; i++) {
      for (
        L = [],
          F = A - y - (Math.PI - y) * (i / v),
          N += (h * y) / v,
          B = Math.cos(F),
          V = Math.sin(F),
          k = B * h,
          t = 0;
        t <= l;
        t++
      ) {
        var j;
        (U = (j = t / l) * _ + 0),
          (z = Math.sin(U)),
          (G = Math.cos(U)),
          (M.x = k * z),
          (M.y = V * h - P),
          (M.z = k * G),
          T.push(M.x, M.y, M.z),
          R.set(B * z, V, B * G),
          S.push(R.x, R.y, R.z),
          C.push(j, 1 - N / w),
          L.push(x),
          x++;
      }
      E.push(L);
    }
    for (t = 0; t < l; t++)
      for (i = 0; i < m + c + v; i++) {
        var X = E[i][t],
          Y = E[i + 1][t],
          K = E[i + 1][t + 1],
          Q = E[i][t + 1];
        b.push(X), b.push(Y), b.push(Q), b.push(Y), b.push(K), b.push(Q);
      }
    if (((b = b.reverse()), e.orientation && !e.orientation.equals(f.Up()))) {
      var q = new g();
      e.orientation
        .clone()
        .scale(0.5 * Math.PI)
        .cross(f.Up())
        .toQuaternion()
        .toRotationMatrix(q);
      for (var Z = f.Zero(), J = 0; J < T.length; J += 3)
        Z.set(T[J], T[J + 1], T[J + 2]),
          f.TransformCoordinatesToRef(Z.clone(), q, Z),
          (T[J] = Z.x),
          (T[J + 1] = Z.y),
          (T[J + 2] = Z.z);
    }
    var $ = new Nt();
    return ($.positions = T), ($.normals = S), ($.uvs = C), ($.indices = b), $;
  }),
    (Qi.CreateCapsule = function (e, t, i) {
      return fh.CreateCapsule(e, t, i);
    });
  var ph,
    fh = (function () {
      function e() {}
      return (
        (e.CreateCapsule = function (e, t, i) {
          void 0 === t &&
            (t = {
              orientation: f.Up(),
              subdivisions: 2,
              tessellation: 16,
              height: 1,
              radius: 0.25,
              capSubdivisions: 6,
            });
          var n = new Qi(e, i);
          return Nt.CreateCapsule(t).applyToMesh(n), n;
        }),
        e
      );
    })(),
    _h = (function () {
      function e() {}
      return (
        (e.CreateBox = function (e, t, i) {
          return void 0 === i && (i = null), Eo.CreateBox(e, t, i);
        }),
        (e.CreateTiledBox = function (e, t, i) {
          return void 0 === i && (i = null), ih.CreateTiledBox(e, t, i);
        }),
        (e.CreateSphere = function (e, t, i) {
          return void 0 === i && (i = null), Po.CreateSphere(e, t, i);
        }),
        (e.CreateDisc = function (e, t, i) {
          return void 0 === i && (i = null), th.CreateDisc(e, t, i);
        }),
        (e.CreateIcoSphere = function (e, t, i) {
          return void 0 === i && (i = null), hh.CreateIcoSphere(e, t, i);
        }),
        (e.CreateRibbon = function (e, t, i) {
          return void 0 === i && (i = null), Fo.CreateRibbon(e, t, i);
        }),
        (e.CreateCylinder = function (e, t, i) {
          return void 0 === i && (i = null), ro.CreateCylinder(e, t, i);
        }),
        (e.CreateTorus = function (e, t, i) {
          return void 0 === i && (i = null), to.CreateTorus(e, t, i);
        }),
        (e.CreateTorusKnot = function (e, t, i) {
          return void 0 === i && (i = null), nh.CreateTorusKnot(e, t, i);
        }),
        (e.CreateLineSystem = function (e, t, i) {
          return Lo.CreateLineSystem(e, t, i);
        }),
        (e.CreateLines = function (e, t, i) {
          return void 0 === i && (i = null), Lo.CreateLines(e, t, i);
        }),
        (e.CreateDashedLines = function (e, t, i) {
          return void 0 === i && (i = null), Lo.CreateDashedLines(e, t, i);
        }),
        (e.ExtrudeShape = function (e, t, i) {
          return void 0 === i && (i = null), Go.ExtrudeShape(e, t, i);
        }),
        (e.ExtrudeShapeCustom = function (e, t, i) {
          return void 0 === i && (i = null), Go.ExtrudeShapeCustom(e, t, i);
        }),
        (e.CreateLathe = function (e, t, i) {
          return void 0 === i && (i = null), lh.CreateLathe(e, t, i);
        }),
        (e.CreateTiledPlane = function (e, t, i) {
          return void 0 === i && (i = null), ch.CreateTiledPlane(e, t, i);
        }),
        (e.CreatePlane = function (e, t, i) {
          return void 0 === i && (i = null), hn.CreatePlane(e, t, i);
        }),
        (e.CreateGround = function (e, t, i) {
          return void 0 === i && (i = null), eo.CreateGround(e, t, i);
        }),
        (e.CreateTiledGround = function (e, t, i) {
          return void 0 === i && (i = null), eo.CreateTiledGround(e, t, i);
        }),
        (e.CreateGroundFromHeightMap = function (e, t, i, n) {
          return (
            void 0 === n && (n = null), eo.CreateGroundFromHeightMap(e, t, i, n)
          );
        }),
        (e.CreatePolygon = function (e, t, i, n) {
          return (
            void 0 === i && (i = null),
            void 0 === n && (n = earcut),
            ah.CreatePolygon(e, t, i, n)
          );
        }),
        (e.ExtrudePolygon = function (e, t, i, n) {
          return (
            void 0 === i && (i = null),
            void 0 === n && (n = earcut),
            ah.ExtrudePolygon(e, t, i, n)
          );
        }),
        (e.CreateTube = function (e, t, i) {
          return void 0 === i && (i = null), uh.CreateTube(e, t, i);
        }),
        (e.CreatePolyhedron = function (e, t, i) {
          return void 0 === i && (i = null), Ps.CreatePolyhedron(e, t, i);
        }),
        (e.CreateDecal = function (e, t, i) {
          return dh.CreateDecal(e, t, i);
        }),
        (e.CreateCapsule = function (e, t, i) {
          return (
            void 0 === t &&
              (t = {
                orientation: f.Up(),
                subdivisions: 2,
                tessellation: 16,
                height: 1,
                radius: 0.25,
                capSubdivisions: 6,
              }),
            void 0 === i && (i = null),
            fh.CreateCapsule(e, t, i)
          );
        }),
        e
      );
    })(),
    mh = (function () {
      function e() {
        (this.running = !1), (this._simplificationArray = []);
      }
      return (
        (e.prototype.addTask = function (e) {
          this._simplificationArray.push(e);
        }),
        (e.prototype.executeNext = function () {
          var e = this._simplificationArray.pop();
          e
            ? ((this.running = !0), this.runSimplification(e))
            : (this.running = !1);
        }),
        (e.prototype.runSimplification = function (e) {
          var t = this;
          if (e.parallelProcessing)
            e.settings.forEach(function (i) {
              t.getSimplifier(e).simplify(i, function (n) {
                void 0 !== i.distance && e.mesh.addLODLevel(i.distance, n),
                  (n.isVisible = !0),
                  i.quality === e.settings[e.settings.length - 1].quality &&
                    e.successCallback &&
                    e.successCallback(),
                  t.executeNext();
              });
            });
          else {
            var i = this.getSimplifier(e);
            bt.Run(
              e.settings.length,
              function (t) {
                var n, r;
                (n = e.settings[t.index]),
                  (r = function () {
                    t.executeNext();
                  }),
                  i.simplify(n, function (t) {
                    void 0 !== n.distance && e.mesh.addLODLevel(n.distance, t),
                      (t.isVisible = !0),
                      r();
                  });
              },
              function () {
                e.successCallback && e.successCallback(), t.executeNext();
              }
            );
          }
        }),
        (e.prototype.getSimplifier = function (e) {
          switch (e.simplificationType) {
            case ph.QUADRATIC:
            default:
              return new Th(e.mesh);
          }
        }),
        e
      );
    })();
  !(function (e) {
    e[(e.QUADRATIC = 0)] = "QUADRATIC";
  })(ph || (ph = {}));
  var gh = function (e) {
      (this.vertices = e),
        (this.error = new Array(4)),
        (this.deleted = !1),
        (this.isDirty = !1),
        (this.deletePending = !1),
        (this.borderFactor = 0);
    },
    vh = (function () {
      function e(e, t) {
        (this.position = e),
          (this.id = t),
          (this.isBorder = !0),
          (this.q = new yh()),
          (this.triangleCount = 0),
          (this.triangleStart = 0),
          (this.originalOffsets = []);
      }
      return (
        (e.prototype.updatePosition = function (e) {
          this.position.copyFrom(e);
        }),
        e
      );
    })(),
    yh = (function () {
      function e(e) {
        this.data = new Array(10);
        for (var t = 0; t < 10; ++t)
          e && e[t] ? (this.data[t] = e[t]) : (this.data[t] = 0);
      }
      return (
        (e.prototype.det = function (e, t, i, n, r, o, s, a, l) {
          return (
            this.data[e] * this.data[r] * this.data[l] +
            this.data[i] * this.data[n] * this.data[a] +
            this.data[t] * this.data[o] * this.data[s] -
            this.data[i] * this.data[r] * this.data[s] -
            this.data[e] * this.data[o] * this.data[a] -
            this.data[t] * this.data[n] * this.data[l]
          );
        }),
        (e.prototype.addInPlace = function (e) {
          for (var t = 0; t < 10; ++t) this.data[t] += e.data[t];
        }),
        (e.prototype.addArrayInPlace = function (e) {
          for (var t = 0; t < 10; ++t) this.data[t] += e[t];
        }),
        (e.prototype.add = function (t) {
          for (var i = new e(), n = 0; n < 10; ++n)
            i.data[n] = this.data[n] + t.data[n];
          return i;
        }),
        (e.FromData = function (t, i, n, r) {
          return new e(e.DataFromNumbers(t, i, n, r));
        }),
        (e.DataFromNumbers = function (e, t, i, n) {
          return [
            e * e,
            e * t,
            e * i,
            e * n,
            t * t,
            t * i,
            t * n,
            i * i,
            i * n,
            n * n,
          ];
        }),
        e
      );
    })(),
    bh = function (e, t) {
      (this.vertexId = e), (this.triangleId = t);
    },
    Th = (function () {
      function e(e) {
        (this._mesh = e),
          (this.syncIterations = 5e3),
          (this.aggressiveness = 7),
          (this.decimationIterations = 100),
          (this.boundingBoxEpsilon = c);
      }
      return (
        (e.prototype.simplify = function (e, t) {
          var i = this;
          this.initDecimatedMesh(),
            bt.Run(
              this._mesh.subMeshes.length,
              function (t) {
                i.initWithMesh(
                  t.index,
                  function () {
                    i.runDecimation(e, t.index, function () {
                      t.executeNext();
                    });
                  },
                  e.optimizeMesh
                );
              },
              function () {
                setTimeout(function () {
                  t(i._reconstructedMesh);
                }, 0);
              }
            );
        }),
        (e.prototype.runDecimation = function (e, t, i) {
          var n = this,
            r = ~~(this.triangles.length * e.quality),
            o = 0,
            s = this.triangles.length;
          bt.Run(
            this.decimationIterations,
            function (e) {
              var t, i;
              s - o <= r
                ? e.breakLoop()
                : ((t = e.index),
                  (i = function () {
                    e.executeNext();
                  }),
                  setTimeout(function () {
                    t % 5 == 0 && n.updateMesh(0 === t);
                    for (var e = 0; e < n.triangles.length; ++e)
                      n.triangles[e].isDirty = !1;
                    var a = 1e-9 * Math.pow(t + 3, n.aggressiveness);
                    bt.SyncAsyncForLoop(
                      n.triangles.length,
                      n.syncIterations,
                      function (e) {
                        var t = ~~(
                            (n.triangles.length / 2 + e) %
                            n.triangles.length
                          ),
                          i = n.triangles[t];
                        if (i && !(i.error[3] > a || i.deleted || i.isDirty))
                          for (var r = 0; r < 3; ++r)
                            if (i.error[r] < a) {
                              var s = [],
                                l = [],
                                c = i.vertices[r],
                                u = i.vertices[(r + 1) % 3];
                              if (c.isBorder || u.isBorder) continue;
                              var h = f.Zero();
                              n.calculateError(c, u, h);
                              var d = new Array();
                              if (n.isFlipped(c, u, h, s, d)) continue;
                              if (n.isFlipped(u, c, h, l, d)) continue;
                              if (s.indexOf(!0) < 0 || l.indexOf(!0) < 0)
                                continue;
                              var p = new Array();
                              if (
                                (d.forEach(function (e) {
                                  -1 === p.indexOf(e) &&
                                    ((e.deletePending = !0), p.push(e));
                                }),
                                p.length % 2 != 0)
                              )
                                continue;
                              (c.q = u.q.add(c.q)), c.updatePosition(h);
                              var _ = n.references.length;
                              (o = n.updateTriangles(c, c, s, o)),
                                (o = n.updateTriangles(c, u, l, o));
                              var m = n.references.length - _;
                              if (m <= c.triangleCount) {
                                if (m)
                                  for (var g = 0; g < m; g++)
                                    n.references[c.triangleStart + g] =
                                      n.references[_ + g];
                              } else c.triangleStart = _;
                              c.triangleCount = m;
                              break;
                            }
                      },
                      i,
                      function () {
                        return s - o <= r;
                      }
                    );
                  }, 0));
            },
            function () {
              setTimeout(function () {
                n.reconstructMesh(t), i();
              }, 0);
            }
          );
        }),
        (e.prototype.initWithMesh = function (e, t, i) {
          var n = this;
          (this.vertices = []), (this.triangles = []);
          var r = this._mesh.getVerticesData(wt.PositionKind),
            o = this._mesh.getIndices(),
            s = this._mesh.subMeshes[e],
            a = [],
            l = s.verticesCount;
          bt.SyncAsyncForLoop(
            l,
            (this.syncIterations / 4) >> 0,
            function (e) {
              if (r) {
                var t = e + s.verticesStart,
                  o = f.FromArray(r, 3 * t),
                  l =
                    (function (e) {
                      if (i)
                        for (var t = 0; t < n.vertices.length; ++t)
                          if (n.vertices[t].position.equalsWithEpsilon(e, 1e-4))
                            return n.vertices[t];
                      return null;
                    })(o) || new vh(o, n.vertices.length);
                l.originalOffsets.push(t),
                  l.id === n.vertices.length && n.vertices.push(l),
                  a.push(l.id);
              }
            },
            function () {
              bt.SyncAsyncForLoop(
                s.indexCount / 3,
                n.syncIterations,
                function (e) {
                  if (o) {
                    var t = 3 * (s.indexStart / 3 + e),
                      i = o[t + 0],
                      r = o[t + 1],
                      l = o[t + 2],
                      c = n.vertices[a[i - s.verticesStart]],
                      u = n.vertices[a[r - s.verticesStart]],
                      h = n.vertices[a[l - s.verticesStart]],
                      d = new gh([c, u, h]);
                    (d.originalOffset = t), n.triangles.push(d);
                  }
                },
                function () {
                  n.init(t);
                }
              );
            }
          );
        }),
        (e.prototype.init = function (e) {
          var t = this;
          bt.SyncAsyncForLoop(
            this.triangles.length,
            this.syncIterations,
            function (e) {
              var i = t.triangles[e];
              i.normal = f
                .Cross(
                  i.vertices[1].position.subtract(i.vertices[0].position),
                  i.vertices[2].position.subtract(i.vertices[0].position)
                )
                .normalize();
              for (var n = 0; n < 3; n++)
                i.vertices[n].q.addArrayInPlace(
                  yh.DataFromNumbers(
                    i.normal.x,
                    i.normal.y,
                    i.normal.z,
                    -f.Dot(i.normal, i.vertices[0].position)
                  )
                );
            },
            function () {
              bt.SyncAsyncForLoop(
                t.triangles.length,
                t.syncIterations,
                function (e) {
                  for (var i = t.triangles[e], n = 0; n < 3; ++n)
                    i.error[n] = t.calculateError(
                      i.vertices[n],
                      i.vertices[(n + 1) % 3]
                    );
                  i.error[3] = Math.min(i.error[0], i.error[1], i.error[2]);
                },
                function () {
                  e();
                }
              );
            }
          );
        }),
        (e.prototype.reconstructMesh = function (e) {
          var t,
            i,
            n,
            r = [];
          for (t = 0; t < this.vertices.length; ++t)
            this.vertices[t].triangleCount = 0;
          for (t = 0; t < this.triangles.length; ++t)
            if (!this.triangles[t].deleted) {
              for (i = this.triangles[t], n = 0; n < 3; ++n)
                i.vertices[n].triangleCount = 1;
              r.push(i);
            }
          var o =
              this._reconstructedMesh.getVerticesData(wt.PositionKind) || [],
            s = this._reconstructedMesh.getVerticesData(wt.NormalKind) || [],
            a = this._reconstructedMesh.getVerticesData(wt.UVKind) || [],
            l = this._reconstructedMesh.getVerticesData(wt.ColorKind) || [],
            c = this._mesh.getVerticesData(wt.NormalKind),
            u = this._mesh.getVerticesData(wt.UVKind),
            h = this._mesh.getVerticesData(wt.ColorKind),
            d = 0;
          for (t = 0; t < this.vertices.length; ++t) {
            var p = this.vertices[t];
            (p.id = d),
              p.triangleCount &&
                p.originalOffsets.forEach(function (e) {
                  o.push(p.position.x),
                    o.push(p.position.y),
                    o.push(p.position.z),
                    c &&
                      c.length &&
                      (s.push(c[3 * e]),
                      s.push(c[3 * e + 1]),
                      s.push(c[3 * e + 2])),
                    u && u.length && (a.push(u[2 * e]), a.push(u[2 * e + 1])),
                    h &&
                      h.length &&
                      (l.push(h[4 * e]),
                      l.push(h[4 * e + 1]),
                      l.push(h[4 * e + 2]),
                      l.push(h[4 * e + 3])),
                    ++d;
                });
          }
          var f = this._reconstructedMesh.getTotalIndices(),
            _ = this._reconstructedMesh.getTotalVertices(),
            m = this._reconstructedMesh.subMeshes;
          this._reconstructedMesh.subMeshes = [];
          var g = this._reconstructedMesh.getIndices(),
            v = this._mesh.getIndices();
          for (t = 0; t < r.length; ++t)
            (i = r[t]),
              [0, 1, 2].forEach(function (e) {
                var t = v[i.originalOffset + e],
                  n = i.vertices[e].originalOffsets.indexOf(t);
                n < 0 && (n = 0), g.push(i.vertices[e].id + n + _);
              });
          this._reconstructedMesh.setIndices(g),
            this._reconstructedMesh.setVerticesData(wt.PositionKind, o),
            s.length > 0 &&
              this._reconstructedMesh.setVerticesData(wt.NormalKind, s),
            a.length > 0 &&
              this._reconstructedMesh.setVerticesData(wt.UVKind, a),
            l.length > 0 &&
              this._reconstructedMesh.setVerticesData(wt.ColorKind, l);
          var y = this._mesh.subMeshes[e];
          e > 0 &&
            ((this._reconstructedMesh.subMeshes = []),
            m.forEach(function (e) {
              oi.AddToMesh(
                e.materialIndex,
                e.verticesStart,
                e.verticesCount,
                e.indexStart,
                e.indexCount,
                e.getMesh()
              );
            }),
            oi.AddToMesh(
              y.materialIndex,
              _,
              d,
              f,
              3 * r.length,
              this._reconstructedMesh
            ));
        }),
        (e.prototype.initDecimatedMesh = function () {
          (this._reconstructedMesh = new Qi(
            this._mesh.name + "Decimated",
            this._mesh.getScene()
          )),
            (this._reconstructedMesh.material = this._mesh.material),
            (this._reconstructedMesh.parent = this._mesh.parent),
            (this._reconstructedMesh.isVisible = !1),
            (this._reconstructedMesh.renderingGroupId =
              this._mesh.renderingGroupId);
        }),
        (e.prototype.isFlipped = function (e, t, i, n, r) {
          for (var o = 0; o < e.triangleCount; ++o) {
            var s =
              this.triangles[this.references[e.triangleStart + o].triangleId];
            if (!s.deleted) {
              var a = this.references[e.triangleStart + o].vertexId,
                l = s.vertices[(a + 1) % 3],
                c = s.vertices[(a + 2) % 3];
              if (l !== t && c !== t) {
                var u = l.position.subtract(i);
                u = u.normalize();
                var h = c.position.subtract(i);
                if (((h = h.normalize()), Math.abs(f.Dot(u, h)) > 0.999))
                  return !0;
                var d = f.Cross(u, h).normalize();
                if (((n[o] = !1), f.Dot(d, s.normal) < 0.2)) return !0;
              } else (n[o] = !0), r.push(s);
            }
          }
          return !1;
        }),
        (e.prototype.updateTriangles = function (e, t, i, n) {
          for (var r = n, o = 0; o < t.triangleCount; ++o) {
            var s = this.references[t.triangleStart + o],
              a = this.triangles[s.triangleId];
            a.deleted ||
              (i[o] && a.deletePending
                ? ((a.deleted = !0), r++)
                : ((a.vertices[s.vertexId] = e),
                  (a.isDirty = !0),
                  (a.error[0] =
                    this.calculateError(a.vertices[0], a.vertices[1]) +
                    a.borderFactor / 2),
                  (a.error[1] =
                    this.calculateError(a.vertices[1], a.vertices[2]) +
                    a.borderFactor / 2),
                  (a.error[2] =
                    this.calculateError(a.vertices[2], a.vertices[0]) +
                    a.borderFactor / 2),
                  (a.error[3] = Math.min(a.error[0], a.error[1], a.error[2])),
                  this.references.push(s)));
          }
          return r;
        }),
        (e.prototype.identifyBorder = function () {
          for (var e = 0; e < this.vertices.length; ++e) {
            var t,
              i = [],
              n = [],
              r = this.vertices[e];
            for (t = 0; t < r.triangleCount; ++t)
              for (
                var o =
                    this.triangles[
                      this.references[r.triangleStart + t].triangleId
                    ],
                  s = 0;
                s < 3;
                s++
              ) {
                for (
                  var a = 0, l = o.vertices[s];
                  a < i.length && n[a] !== l.id;

                )
                  ++a;
                a === i.length ? (i.push(1), n.push(l.id)) : i[a]++;
              }
            for (t = 0; t < i.length; ++t)
              1 === i[t]
                ? (this.vertices[n[t]].isBorder = !0)
                : (this.vertices[n[t]].isBorder = !1);
          }
        }),
        (e.prototype.updateMesh = function (e) {
          var t, i, n, r;
          if ((void 0 === e && (e = !1), !e)) {
            var o = [];
            for (t = 0; t < this.triangles.length; ++t)
              this.triangles[t].deleted || o.push(this.triangles[t]);
            this.triangles = o;
          }
          for (t = 0; t < this.vertices.length; ++t)
            (this.vertices[t].triangleCount = 0),
              (this.vertices[t].triangleStart = 0);
          for (t = 0; t < this.triangles.length; ++t)
            for (i = this.triangles[t], n = 0; n < 3; ++n)
              (r = i.vertices[n]).triangleCount++;
          var s = 0;
          for (t = 0; t < this.vertices.length; ++t)
            (this.vertices[t].triangleStart = s),
              (s += this.vertices[t].triangleCount),
              (this.vertices[t].triangleCount = 0);
          var a = new Array(3 * this.triangles.length);
          for (t = 0; t < this.triangles.length; ++t)
            for (i = this.triangles[t], n = 0; n < 3; ++n)
              (a[(r = i.vertices[n]).triangleStart + r.triangleCount] = new bh(
                n,
                t
              )),
                r.triangleCount++;
          (this.references = a), e && this.identifyBorder();
        }),
        (e.prototype.vertexError = function (e, t) {
          var i = t.x,
            n = t.y,
            r = t.z;
          return (
            e.data[0] * i * i +
            2 * e.data[1] * i * n +
            2 * e.data[2] * i * r +
            2 * e.data[3] * i +
            e.data[4] * n * n +
            2 * e.data[5] * n * r +
            2 * e.data[6] * n +
            e.data[7] * r * r +
            2 * e.data[8] * r +
            e.data[9]
          );
        }),
        (e.prototype.calculateError = function (e, t, i) {
          var n = e.q.add(t.q),
            r = e.isBorder && t.isBorder,
            o = 0,
            s = n.det(0, 1, 2, 1, 4, 5, 2, 5, 7);
          if (0 === s || r) {
            var a = e.position.add(t.position).divide(new f(2, 2, 2)),
              l = this.vertexError(n, e.position),
              c = this.vertexError(n, t.position),
              u = this.vertexError(n, a);
            (o = Math.min(l, c, u)) === l
              ? i && i.copyFrom(e.position)
              : o === c
                ? i && i.copyFrom(t.position)
                : i && i.copyFrom(a);
          } else
            i || (i = f.Zero()),
              (i.x = (-1 / s) * n.det(1, 2, 3, 4, 5, 6, 5, 7, 8)),
              (i.y = (1 / s) * n.det(0, 2, 3, 1, 5, 6, 2, 7, 8)),
              (i.z = (-1 / s) * n.det(0, 1, 3, 1, 4, 6, 2, 5, 8)),
              (o = this.vertexError(n, i));
          return o;
        }),
        e
      );
    })();
  Object.defineProperty(Ci.prototype, "simplificationQueue", {
    get: function () {
      if (!this._simplificationQueue) {
        this._simplificationQueue = new mh();
        var e = this._getComponent(hi.NAME_SIMPLIFICATIONQUEUE);
        e || ((e = new Sh(this)), this._addComponent(e));
      }
      return this._simplificationQueue;
    },
    set: function (e) {
      this._simplificationQueue = e;
    },
    enumerable: !0,
    configurable: !0,
  }),
    (Qi.prototype.simplify = function (e, t, i, n) {
      return (
        void 0 === t && (t = !0),
        void 0 === i && (i = ph.QUADRATIC),
        this.getScene().simplificationQueue.addTask({
          settings: e,
          parallelProcessing: t,
          mesh: this,
          simplificationType: i,
          successCallback: n,
        }),
        this
      );
    });
  var Sh = (function () {
    function e(e) {
      (this.name = hi.NAME_SIMPLIFICATIONQUEUE), (this.scene = e);
    }
    return (
      (e.prototype.register = function () {
        this.scene._beforeCameraUpdateStage.registerStep(
          hi.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE,
          this,
          this._beforeCameraUpdate
        );
      }),
      (e.prototype.rebuild = function () {}),
      (e.prototype.dispose = function () {}),
      (e.prototype._beforeCameraUpdate = function () {
        this.scene._simplificationQueue &&
          !this.scene._simplificationQueue.running &&
          this.scene._simplificationQueue.executeNext();
      }),
      e
    );
  })();
  (Qi.prototype.thinInstanceAdd = function (e, t) {
    void 0 === t && (t = !0),
      this._thinInstanceUpdateBufferSize(
        "matrix",
        Array.isArray(e) ? e.length : 1
      );
    var i = this._thinInstanceDataStorage.instancesCount;
    if (Array.isArray(e))
      for (var n = 0; n < e.length; ++n)
        this.thinInstanceSetMatrixAt(
          this._thinInstanceDataStorage.instancesCount++,
          e[n],
          n === e.length - 1 && t
        );
    else
      this.thinInstanceSetMatrixAt(
        this._thinInstanceDataStorage.instancesCount++,
        e,
        t
      );
    return i;
  }),
    (Qi.prototype.thinInstanceAddSelf = function (e) {
      return (
        void 0 === e && (e = !0), this.thinInstanceAdd(g.IdentityReadOnly, e)
      );
    }),
    (Qi.prototype.thinInstanceRegisterAttribute = function (e, t) {
      this.removeVerticesData(e),
        this._thinInstanceInitializeUserStorage(),
        (this._userThinInstanceBuffersStorage.strides[e] = t),
        (this._userThinInstanceBuffersStorage.sizes[e] =
          t * Math.max(32, this._thinInstanceDataStorage.instancesCount)),
        (this._userThinInstanceBuffersStorage.data[e] = new Float32Array(
          this._userThinInstanceBuffersStorage.sizes[e]
        )),
        (this._userThinInstanceBuffersStorage.vertexBuffers[e] = new wt(
          this.getEngine(),
          this._userThinInstanceBuffersStorage.data[e],
          e,
          !0,
          !1,
          t,
          !0
        )),
        this.setVerticesBuffer(
          this._userThinInstanceBuffersStorage.vertexBuffers[e]
        );
    }),
    (Qi.prototype.thinInstanceSetMatrixAt = function (e, t, i) {
      if (
        (void 0 === i && (i = !0),
        !this._thinInstanceDataStorage.matrixData ||
          e >= this._thinInstanceDataStorage.instancesCount)
      )
        return !1;
      var n = this._thinInstanceDataStorage.matrixData;
      return (
        t.copyToArray(n, 16 * e),
        this._thinInstanceDataStorage.worldMatrices &&
          (this._thinInstanceDataStorage.worldMatrices[e] = t),
        i &&
          (this.thinInstanceBufferUpdated("matrix"),
          this.doNotSyncBoundingInfo ||
            this.thinInstanceRefreshBoundingInfo(!1)),
        !0
      );
    }),
    (Qi.prototype.thinInstanceSetAttributeAt = function (e, t, i, n) {
      return (
        void 0 === n && (n = !0),
        !(
          !this._userThinInstanceBuffersStorage ||
          !this._userThinInstanceBuffersStorage.data[e] ||
          t >= this._thinInstanceDataStorage.instancesCount ||
          (this._thinInstanceUpdateBufferSize(e, 0),
          this._userThinInstanceBuffersStorage.data[e].set(
            i,
            t * this._userThinInstanceBuffersStorage.strides[e]
          ),
          n && this.thinInstanceBufferUpdated(e),
          0)
        )
      );
    }),
    Object.defineProperty(Qi.prototype, "thinInstanceCount", {
      get: function () {
        return this._thinInstanceDataStorage.instancesCount;
      },
      set: function (e) {
        var t, i;
        e <=
          (null !==
            (i =
              null === (t = this._thinInstanceDataStorage.matrixData) ||
              void 0 === t
                ? void 0
                : t.length) && void 0 !== i
            ? i
            : 0) /
            16 && (this._thinInstanceDataStorage.instancesCount = e);
      },
      enumerable: !0,
      configurable: !0,
    }),
    (Qi.prototype.thinInstanceSetBuffer = function (e, t, i, n) {
      var r, o;
      if (
        (void 0 === i && (i = 0),
        void 0 === n && (n = !1),
        (i = i || 16),
        "matrix" === e)
      )
        if (
          (null === (r = this._thinInstanceDataStorage.matrixBuffer) ||
            void 0 === r ||
            r.dispose(),
          (this._thinInstanceDataStorage.matrixBuffer = null),
          (this._thinInstanceDataStorage.matrixBufferSize = t
            ? t.length
            : 32 * i),
          (this._thinInstanceDataStorage.matrixData = t),
          (this._thinInstanceDataStorage.worldMatrices = null),
          null !== t)
        ) {
          this._thinInstanceDataStorage.instancesCount = t.length / i;
          var s = new Dt(this.getEngine(), t, !n, i, !1, !0);
          (this._thinInstanceDataStorage.matrixBuffer = s),
            this.setVerticesBuffer(s.createVertexBuffer("world0", 0, 4)),
            this.setVerticesBuffer(s.createVertexBuffer("world1", 4, 4)),
            this.setVerticesBuffer(s.createVertexBuffer("world2", 8, 4)),
            this.setVerticesBuffer(s.createVertexBuffer("world3", 12, 4)),
            this.doNotSyncBoundingInfo ||
              this.thinInstanceRefreshBoundingInfo(!1);
        } else
          (this._thinInstanceDataStorage.instancesCount = 0),
            this.doNotSyncBoundingInfo || this.refreshBoundingInfo(!0);
      else
        null === t
          ? (null === (o = this._userThinInstanceBuffersStorage) || void 0 === o
              ? void 0
              : o.data[e]) &&
            (this.removeVerticesData(e),
            delete this._userThinInstanceBuffersStorage.data[e],
            delete this._userThinInstanceBuffersStorage.strides[e],
            delete this._userThinInstanceBuffersStorage.sizes[e],
            delete this._userThinInstanceBuffersStorage.vertexBuffers[e])
          : (this._thinInstanceInitializeUserStorage(),
            (this._userThinInstanceBuffersStorage.data[e] = t),
            (this._userThinInstanceBuffersStorage.strides[e] = i),
            (this._userThinInstanceBuffersStorage.sizes[e] = t.length),
            (this._userThinInstanceBuffersStorage.vertexBuffers[e] = new wt(
              this.getEngine(),
              t,
              e,
              !n,
              !1,
              i,
              !0
            )),
            this.setVerticesBuffer(
              this._userThinInstanceBuffersStorage.vertexBuffers[e]
            ));
    }),
    (Qi.prototype.thinInstanceBufferUpdated = function (e) {
      var t;
      "matrix" === e
        ? this._thinInstanceDataStorage.matrixBuffer &&
          this._thinInstanceDataStorage.matrixBuffer.updateDirectly(
            this._thinInstanceDataStorage.matrixData,
            0,
            this._thinInstanceDataStorage.instancesCount
          )
        : (null === (t = this._userThinInstanceBuffersStorage) || void 0 === t
            ? void 0
            : t.vertexBuffers[e]) &&
          this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(
            this._userThinInstanceBuffersStorage.data[e],
            0
          );
    }),
    (Qi.prototype.thinInstancePartialBufferUpdate = function (e, t, i) {
      var n;
      "matrix" === e
        ? this._thinInstanceDataStorage.matrixBuffer &&
          this._thinInstanceDataStorage.matrixBuffer.updateDirectly(t, i)
        : (null === (n = this._userThinInstanceBuffersStorage) || void 0 === n
            ? void 0
            : n.vertexBuffers[e]) &&
          this._userThinInstanceBuffersStorage.vertexBuffers[e].updateDirectly(
            t,
            i
          );
    }),
    (Qi.prototype.thinInstanceGetWorldMatrices = function () {
      if (
        !this._thinInstanceDataStorage.matrixData ||
        !this._thinInstanceDataStorage.matrixBuffer
      )
        return [];
      var e = this._thinInstanceDataStorage.matrixData;
      if (!this._thinInstanceDataStorage.worldMatrices) {
        this._thinInstanceDataStorage.worldMatrices = new Array();
        for (var t = 0; t < this._thinInstanceDataStorage.instancesCount; ++t)
          this._thinInstanceDataStorage.worldMatrices[t] = g.FromArray(
            e,
            16 * t
          );
      }
      return this._thinInstanceDataStorage.worldMatrices;
    }),
    (Qi.prototype.thinInstanceRefreshBoundingInfo = function (e) {
      if (
        (void 0 === e && (e = !1),
        this._thinInstanceDataStorage.matrixData &&
          this._thinInstanceDataStorage.matrixBuffer)
      ) {
        var t = this._thinInstanceDataStorage.boundingVectors;
        e && ((t.length = 0), this.refreshBoundingInfo(!0));
        var i = this.getBoundingInfo(),
          n = this._thinInstanceDataStorage.matrixData;
        if (0 === t.length)
          for (var r = 0; r < i.boundingBox.vectors.length; ++r)
            t.push(i.boundingBox.vectors[r].clone());
        y.Vector3[0].setAll(Number.POSITIVE_INFINITY),
          y.Vector3[1].setAll(Number.NEGATIVE_INFINITY);
        for (var o = 0; o < this._thinInstanceDataStorage.instancesCount; ++o)
          for (
            g.FromArrayToRef(n, 16 * o, y.Matrix[0]), r = 0;
            r < t.length;
            ++r
          )
            f.TransformCoordinatesToRef(t[r], y.Matrix[0], y.Vector3[2]),
              y.Vector3[0].minimizeInPlace(y.Vector3[2]),
              y.Vector3[1].maximizeInPlace(y.Vector3[2]);
        i.reConstruct(y.Vector3[0], y.Vector3[1]), this._updateBoundingInfo();
      }
    }),
    (Qi.prototype._thinInstanceUpdateBufferSize = function (e, t) {
      var i, n;
      void 0 === t && (t = 1);
      var r = "matrix" === e;
      if (
        r ||
        (this._userThinInstanceBuffersStorage &&
          this._userThinInstanceBuffersStorage.strides[e])
      ) {
        for (
          var o = r ? 16 : this._userThinInstanceBuffersStorage.strides[e],
            s = r
              ? this._thinInstanceDataStorage.matrixBufferSize
              : this._userThinInstanceBuffersStorage.sizes[e],
            a = r
              ? this._thinInstanceDataStorage.matrixData
              : this._userThinInstanceBuffersStorage.data[e],
            l = (this._thinInstanceDataStorage.instancesCount + t) * o,
            c = s;
          c < l;

        )
          c *= 2;
        if (!a || s != c) {
          if (a) {
            var u = new Float32Array(c);
            u.set(a, 0), (a = u);
          } else a = new Float32Array(c);
          if (r) {
            null === (i = this._thinInstanceDataStorage.matrixBuffer) ||
              void 0 === i ||
              i.dispose();
            var h = new Dt(this.getEngine(), a, !0, o, !1, !0);
            (this._thinInstanceDataStorage.matrixBuffer = h),
              (this._thinInstanceDataStorage.matrixData = a),
              (this._thinInstanceDataStorage.matrixBufferSize = c),
              this.setVerticesBuffer(h.createVertexBuffer("world0", 0, 4)),
              this.setVerticesBuffer(h.createVertexBuffer("world1", 4, 4)),
              this.setVerticesBuffer(h.createVertexBuffer("world2", 8, 4)),
              this.setVerticesBuffer(h.createVertexBuffer("world3", 12, 4));
          } else
            null ===
              (n = this._userThinInstanceBuffersStorage.vertexBuffers[e]) ||
              void 0 === n ||
              n.dispose(),
              (this._userThinInstanceBuffersStorage.data[e] = a),
              (this._userThinInstanceBuffersStorage.sizes[e] = c),
              (this._userThinInstanceBuffersStorage.vertexBuffers[e] = new wt(
                this.getEngine(),
                a,
                e,
                !0,
                !1,
                o,
                !0
              )),
              this.setVerticesBuffer(
                this._userThinInstanceBuffersStorage.vertexBuffers[e]
              );
        }
      }
    }),
    (Qi.prototype._thinInstanceInitializeUserStorage = function () {
      this._userThinInstanceBuffersStorage ||
        (this._userThinInstanceBuffersStorage = {
          data: {},
          sizes: {},
          vertexBuffers: {},
          strides: {},
        });
    }),
    (Qi.prototype._disposeThinInstanceSpecificData = function () {
      var e;
      (null === (e = this._thinInstanceDataStorage) || void 0 === e
        ? void 0
        : e.matrixBuffer) &&
        (this._thinInstanceDataStorage.matrixBuffer.dispose(),
        (this._thinInstanceDataStorage.matrixBuffer = null));
    }),
    (function () {
      function e(e) {
        void 0 === e && (e = Recast),
          (this.bjsRECAST = {}),
          (this.name = "RecastJSPlugin"),
          (this._maximumSubStepCount = 10),
          (this._timeStep = 1 / 60),
          "function" == typeof e ? e(this.bjsRECAST) : (this.bjsRECAST = e),
          this.isSupported()
            ? this.setTimeStep()
            : F.Error(
                "RecastJS is not available. Please make sure you included the js file."
              );
      }
      (e.prototype.setTimeStep = function (e) {
        void 0 === e && (e = 1 / 60), (this._timeStep = e);
      }),
        (e.prototype.getTimeStep = function () {
          return this._timeStep;
        }),
        (e.prototype.setMaximumSubStepCount = function (e) {
          void 0 === e && (e = 10), (this._maximumSubStepCount = e);
        }),
        (e.prototype.getMaximumSubStepCount = function () {
          return this._maximumSubStepCount;
        }),
        (e.prototype.createNavMesh = function (e, t) {
          var i,
            n,
            r,
            o = new this.bjsRECAST.rcConfig();
          (o.cs = t.cs),
            (o.ch = t.ch),
            (o.borderSize = 0),
            (o.tileSize = 0),
            (o.walkableSlopeAngle = t.walkableSlopeAngle),
            (o.walkableHeight = t.walkableHeight),
            (o.walkableClimb = t.walkableClimb),
            (o.walkableRadius = t.walkableRadius),
            (o.maxEdgeLen = t.maxEdgeLen),
            (o.maxSimplificationError = t.maxSimplificationError),
            (o.minRegionArea = t.minRegionArea),
            (o.mergeRegionArea = t.mergeRegionArea),
            (o.maxVertsPerPoly = t.maxVertsPerPoly),
            (o.detailSampleDist = t.detailSampleDist),
            (o.detailSampleMaxError = t.detailSampleMaxError),
            (this.navMesh = new this.bjsRECAST.NavMesh());
          var s = [],
            a = [],
            l = 0;
          for (i = 0; i < e.length; i++)
            if (e[i]) {
              var c = e[i],
                u = c.getIndices();
              if (!u) continue;
              var h = c.getVerticesData(wt.PositionKind, !1, !1);
              if (!h) continue;
              var d = c.computeWorldMatrix(!0);
              for (n = 0; n < u.length; n++) s.push(u[n] + l);
              var p = f.Zero(),
                _ = f.Zero();
              for (r = 0; r < h.length; r += 3)
                f.FromArrayToRef(h, r, _),
                  f.TransformCoordinatesToRef(_, d, p),
                  a.push(p.x, p.y, p.z);
              l += h.length / 3;
            }
          this.navMesh.build(a, l, s, s.length, o);
        }),
        (e.prototype.createDebugNavMesh = function (e) {
          var t,
            i,
            n = this.navMesh.getDebugNavMesh(),
            r = n.getTriangleCount(),
            o = [],
            s = [];
          for (t = 0; t < 3 * r; t++) o.push(t);
          for (t = 0; t < r; t++)
            for (i = 0; i < 3; i++) {
              var a = n.getTriangle(t).getPoint(i);
              s.push(a.x, a.y, a.z);
            }
          var l = new Qi("NavMeshDebug", e),
            c = new Nt();
          return (c.indices = o), (c.positions = s), c.applyToMesh(l, !1), l;
        }),
        (e.prototype.getClosestPoint = function (e) {
          var t = new this.bjsRECAST.Vec3(e.x, e.y, e.z),
            i = this.navMesh.getClosestPoint(t);
          return new f(i.x, i.y, i.z);
        }),
        (e.prototype.getClosestPointToRef = function (e, t) {
          var i = new this.bjsRECAST.Vec3(e.x, e.y, e.z),
            n = this.navMesh.getClosestPoint(i);
          t.set(n.x, n.y, n.z);
        }),
        (e.prototype.getRandomPointAround = function (e, t) {
          var i = new this.bjsRECAST.Vec3(e.x, e.y, e.z),
            n = this.navMesh.getRandomPointAround(i, t);
          return new f(n.x, n.y, n.z);
        }),
        (e.prototype.getRandomPointAroundToRef = function (e, t, i) {
          var n = new this.bjsRECAST.Vec3(e.x, e.y, e.z),
            r = this.navMesh.getRandomPointAround(n, t);
          i.set(r.x, r.y, r.z);
        }),
        (e.prototype.moveAlong = function (e, t) {
          var i = new this.bjsRECAST.Vec3(e.x, e.y, e.z),
            n = new this.bjsRECAST.Vec3(t.x, t.y, t.z),
            r = this.navMesh.moveAlong(i, n);
          return new f(r.x, r.y, r.z);
        }),
        (e.prototype.moveAlongToRef = function (e, t, i) {
          var n = new this.bjsRECAST.Vec3(e.x, e.y, e.z),
            r = new this.bjsRECAST.Vec3(t.x, t.y, t.z),
            o = this.navMesh.moveAlong(n, r);
          i.set(o.x, o.y, o.z);
        }),
        (e.prototype.computePath = function (e, t) {
          var i,
            n = new this.bjsRECAST.Vec3(e.x, e.y, e.z),
            r = new this.bjsRECAST.Vec3(t.x, t.y, t.z),
            o = this.navMesh.computePath(n, r),
            s = o.getPointCount(),
            a = [];
          for (i = 0; i < s; i++) {
            var l = o.getPoint(i);
            a.push(new f(l.x, l.y, l.z));
          }
          return a;
        }),
        (e.prototype.createCrowd = function (e, t, i) {
          return new Ch(this, e, t, i);
        }),
        (e.prototype.setDefaultQueryExtent = function (e) {
          var t = new this.bjsRECAST.Vec3(e.x, e.y, e.z);
          this.navMesh.setDefaultQueryExtent(t);
        }),
        (e.prototype.getDefaultQueryExtent = function () {
          var e = this.navMesh.getDefaultQueryExtent();
          return new f(e.x, e.y, e.z);
        }),
        (e.prototype.buildFromNavmeshData = function (e) {
          var t = e.length * e.BYTES_PER_ELEMENT,
            i = this.bjsRECAST._malloc(t),
            n = new Uint8Array(this.bjsRECAST.HEAPU8.buffer, i, t);
          n.set(e);
          var r = new this.bjsRECAST.NavmeshData();
          (r.dataPointer = n.byteOffset),
            (r.size = e.length),
            (this.navMesh = new this.bjsRECAST.NavMesh()),
            this.navMesh.buildFromNavmeshData(r),
            this.bjsRECAST._free(n.byteOffset);
        }),
        (e.prototype.getNavmeshData = function () {
          var e = this.navMesh.getNavmeshData(),
            t = new Uint8Array(
              this.bjsRECAST.HEAPU8.buffer,
              e.dataPointer,
              e.size
            ),
            i = new Uint8Array(e.size);
          return i.set(t), this.navMesh.freeNavmeshData(e), i;
        }),
        (e.prototype.getDefaultQueryExtentToRef = function (e) {
          var t = this.navMesh.getDefaultQueryExtent();
          e.set(t.x, t.y, t.z);
        }),
        (e.prototype.dispose = function () {}),
        (e.prototype.isSupported = function () {
          return void 0 !== this.bjsRECAST;
        });
    })();
  var Ch = (function () {
    function e(e, t, i, n) {
      var r = this;
      (this.recastCrowd = {}),
        (this.transforms = new Array()),
        (this.agents = new Array()),
        (this._onBeforeAnimationsObserver = null),
        (this.bjsRECASTPlugin = e),
        (this.recastCrowd = new this.bjsRECASTPlugin.bjsRECAST.Crowd(
          t,
          i,
          this.bjsRECASTPlugin.navMesh.getNavMesh()
        )),
        (this._scene = n),
        (this._onBeforeAnimationsObserver = n.onBeforeAnimationsObservable.add(
          function () {
            r.update(0.001 * n.getEngine().getDeltaTime());
          }
        ));
    }
    return (
      (e.prototype.addAgent = function (e, t, i) {
        var n = new this.bjsRECASTPlugin.bjsRECAST.dtCrowdAgentParams();
        (n.radius = t.radius),
          (n.height = t.height),
          (n.maxAcceleration = t.maxAcceleration),
          (n.maxSpeed = t.maxSpeed),
          (n.collisionQueryRange = t.collisionQueryRange),
          (n.pathOptimizationRange = t.pathOptimizationRange),
          (n.separationWeight = t.separationWeight),
          (n.updateFlags = 7),
          (n.obstacleAvoidanceType = 0),
          (n.queryFilterType = 0),
          (n.userData = 0);
        var r = this.recastCrowd.addAgent(
          new this.bjsRECASTPlugin.bjsRECAST.Vec3(e.x, e.y, e.z),
          n
        );
        return this.transforms.push(i), this.agents.push(r), r;
      }),
      (e.prototype.getAgentPosition = function (e) {
        var t = this.recastCrowd.getAgentPosition(e);
        return new f(t.x, t.y, t.z);
      }),
      (e.prototype.getAgentPositionToRef = function (e, t) {
        var i = this.recastCrowd.getAgentPosition(e);
        t.set(i.x, i.y, i.z);
      }),
      (e.prototype.getAgentVelocity = function (e) {
        var t = this.recastCrowd.getAgentVelocity(e);
        return new f(t.x, t.y, t.z);
      }),
      (e.prototype.getAgentVelocityToRef = function (e, t) {
        var i = this.recastCrowd.getAgentVelocity(e);
        t.set(i.x, i.y, i.z);
      }),
      (e.prototype.getAgentNextTargetPath = function (e) {
        var t = this.recastCrowd.getAgentNextTargetPath(e);
        return new f(t.x, t.y, t.z);
      }),
      (e.prototype.getAgentNextTargetPathToRef = function (e, t) {
        var i = this.recastCrowd.getAgentNextTargetPath(e);
        t.set(i.x, i.y, i.z);
      }),
      (e.prototype.getAgentState = function (e) {
        return this.recastCrowd.getAgentState(e);
      }),
      (e.prototype.overOffmeshConnection = function (e) {
        return this.recastCrowd.overOffmeshConnection(e);
      }),
      (e.prototype.agentGoto = function (e, t) {
        this.recastCrowd.agentGoto(
          e,
          new this.bjsRECASTPlugin.bjsRECAST.Vec3(t.x, t.y, t.z)
        );
      }),
      (e.prototype.agentTeleport = function (e, t) {
        this.recastCrowd.agentTeleport(
          e,
          new this.bjsRECASTPlugin.bjsRECAST.Vec3(t.x, t.y, t.z)
        );
      }),
      (e.prototype.updateAgentParameters = function (e, t) {
        var i = this.recastCrowd.getAgentParameters(e);
        void 0 !== t.radius && (i.radius = t.radius),
          void 0 !== t.height && (i.height = t.height),
          void 0 !== t.maxAcceleration &&
            (i.maxAcceleration = t.maxAcceleration),
          void 0 !== t.maxSpeed && (i.maxSpeed = t.maxSpeed),
          void 0 !== t.collisionQueryRange &&
            (i.collisionQueryRange = t.collisionQueryRange),
          void 0 !== t.pathOptimizationRange &&
            (i.pathOptimizationRange = t.pathOptimizationRange),
          void 0 !== t.separationWeight &&
            (i.separationWeight = t.separationWeight),
          this.recastCrowd.setAgentParameters(e, i);
      }),
      (e.prototype.removeAgent = function (e) {
        this.recastCrowd.removeAgent(e);
        var t = this.agents.indexOf(e);
        t > -1 && (this.agents.splice(t, 1), this.transforms.splice(t, 1));
      }),
      (e.prototype.getAgents = function () {
        return this.agents;
      }),
      (e.prototype.update = function (e) {
        var t = this.bjsRECASTPlugin.getTimeStep(),
          i = this.bjsRECASTPlugin.getMaximumSubStepCount();
        if (t <= c) this.recastCrowd.update(e);
        else {
          var n = e / t;
          i && n > i && (n = i), n < 1 && (n = 1);
          for (var r = 0; r < n; r++) this.recastCrowd.update(t);
        }
        for (var o = 0; o < this.agents.length; o++)
          this.transforms[o].position = this.getAgentPosition(this.agents[o]);
      }),
      (e.prototype.setDefaultQueryExtent = function (e) {
        var t = new this.bjsRECASTPlugin.bjsRECAST.Vec3(e.x, e.y, e.z);
        this.recastCrowd.setDefaultQueryExtent(t);
      }),
      (e.prototype.getDefaultQueryExtent = function () {
        var e = this.recastCrowd.getDefaultQueryExtent();
        return new f(e.x, e.y, e.z);
      }),
      (e.prototype.getDefaultQueryExtentToRef = function (e) {
        var t = this.recastCrowd.getDefaultQueryExtent();
        e.set(t.x, t.y, t.z);
      }),
      (e.prototype.dispose = function () {
        this.recastCrowd.destroy(),
          this._scene.onBeforeAnimationsObservable.remove(
            this._onBeforeAnimationsObserver
          ),
          (this._onBeforeAnimationsObserver = null);
      }),
      e
    );
  })();
  It.OfflineProviderFactory = function (e, t, i) {
    return void 0 === i && (i = !1), new Eh(e, t, i);
  };
  var xh,
    Eh = (function () {
      function e(t, i, n) {
        var r = this;
        void 0 === n && (n = !1),
          (this._idbFactory =
            "undefined" != typeof window
              ? window.indexedDB ||
                window.mozIndexedDB ||
                window.webkitIndexedDB ||
                window.msIndexedDB
              : indexedDB),
          (this._callbackManifestChecked = i),
          (this._currentSceneUrl = e._ReturnFullUrlLocation(t)),
          (this._db = null),
          (this._enableSceneOffline = !1),
          (this._enableTexturesOffline = !1),
          (this._manifestVersionFound = 0),
          (this._mustUpdateRessources = !1),
          (this._hasReachedQuota = !1),
          e.IDBStorageEnabled
            ? n
              ? ((this._enableSceneOffline = !0),
                (this._enableTexturesOffline = !0),
                (this._manifestVersionFound = 1),
                yt.SetImmediate(function () {
                  r._callbackManifestChecked(!0);
                }))
              : this._checkManifestFile()
            : this._callbackManifestChecked(!0);
      }
      return (
        Object.defineProperty(e.prototype, "enableSceneOffline", {
          get: function () {
            return this._enableSceneOffline;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "enableTexturesOffline", {
          get: function () {
            return this._enableTexturesOffline;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype._checkManifestFile = function () {
          var t = this,
            i = function () {
              (t._enableSceneOffline = !1),
                (t._enableTexturesOffline = !1),
                t._callbackManifestChecked(!1);
            },
            n = !1,
            r = this._currentSceneUrl + ".manifest",
            o = new Te();
          navigator.onLine &&
            ((n = !0),
            (r = r + (null == r.match(/\?/) ? "?" : "&") + Date.now())),
            o.open("GET", r),
            o.addEventListener(
              "load",
              function () {
                if (200 === o.status || e._ValidateXHRData(o, 1))
                  try {
                    var n = JSON.parse(o.response);
                    (t._enableSceneOffline = n.enableSceneOffline),
                      (t._enableTexturesOffline =
                        n.enableTexturesOffline && e.IsUASupportingBlobStorage),
                      n.version &&
                        !isNaN(parseInt(n.version)) &&
                        (t._manifestVersionFound = n.version),
                      t._callbackManifestChecked &&
                        t._callbackManifestChecked(!0);
                  } catch (e) {
                    i();
                  }
                else i();
              },
              !1
            ),
            o.addEventListener(
              "error",
              function () {
                if (n) {
                  n = !1;
                  var e = t._currentSceneUrl + ".manifest";
                  o.open("GET", e), o.send();
                } else i();
              },
              !1
            );
          try {
            o.send();
          } catch (e) {
            F.Error("Error on XHR send request."),
              this._callbackManifestChecked(!1);
          }
        }),
        (e.prototype.open = function (e, t) {
          var i = this,
            n = function () {
              (i._isSupported = !1), t && t();
            };
          if (
            this._idbFactory &&
            (this._enableSceneOffline || this._enableTexturesOffline)
          )
            if (this._db) e && e();
            else {
              (this._hasReachedQuota = !1), (this._isSupported = !0);
              var r = this._idbFactory.open("babylonjs", 1);
              (r.onerror = function () {
                n();
              }),
                (r.onblocked = function () {
                  F.Error("IDB request blocked. Please reload the page."), n();
                }),
                (r.onsuccess = function () {
                  (i._db = r.result), e();
                }),
                (r.onupgradeneeded = function (e) {
                  if (((i._db = e.target.result), i._db))
                    try {
                      i._db.createObjectStore("scenes", {
                        keyPath: "sceneUrl",
                      }),
                        i._db.createObjectStore("versions", {
                          keyPath: "sceneUrl",
                        }),
                        i._db.createObjectStore("textures", {
                          keyPath: "textureUrl",
                        });
                    } catch (e) {
                      F.Error(
                        "Error while creating object stores. Exception: " +
                          e.message
                      ),
                        n();
                    }
                });
            }
          else (this._isSupported = !1), t && t();
        }),
        (e.prototype.loadImage = function (t, i) {
          var n = this,
            r = e._ReturnFullUrlLocation(t),
            o = function () {
              n._hasReachedQuota || null === n._db
                ? (i.src = t)
                : n._saveImageIntoDBAsync(r, i);
            };
          this._mustUpdateRessources
            ? o()
            : this._loadImageFromDBAsync(r, i, o);
        }),
        (e.prototype._loadImageFromDBAsync = function (e, t, i) {
          if (this._isSupported && null !== this._db) {
            var n,
              r = this._db.transaction(["textures"]);
            (r.onabort = function () {
              t.src = e;
            }),
              (r.oncomplete = function () {
                var r;
                if (n) {
                  var o = window.URL || window.webkitURL;
                  (r = o.createObjectURL(n.data)),
                    (t.onerror = function () {
                      F.Error(
                        "Error loading image from blob URL: " +
                          r +
                          " switching back to web url: " +
                          e
                      ),
                        (t.src = e);
                    }),
                    (t.src = r);
                } else i();
              });
            var o = r.objectStore("textures").get(e);
            (o.onsuccess = function (e) {
              n = e.target.result;
            }),
              (o.onerror = function () {
                F.Error("Error loading texture " + e + " from DB."),
                  (t.src = e);
              });
          } else
            F.Error(
              "Error: IndexedDB not supported by your browser or BabylonJS Database is not open."
            ),
              (t.src = e);
        }),
        (e.prototype._saveImageIntoDBAsync = function (t, i) {
          var n = this;
          if (this._isSupported) {
            var r = function () {
              var e;
              if (o) {
                var t = window.URL || window.webkitURL;
                try {
                  e = t.createObjectURL(o);
                } catch (i) {
                  e = t.createObjectURL(o);
                }
              }
              e && (i.src = e);
            };
            if (e.IsUASupportingBlobStorage) {
              var o,
                s = new Te();
              s.open("GET", t),
                (s.responseType = "blob"),
                s.addEventListener(
                  "load",
                  function () {
                    if (200 === s.status && n._db) {
                      o = s.response;
                      var a = n._db.transaction(["textures"], "readwrite");
                      (a.onabort = function (e) {
                        try {
                          var t = (e.srcElement || e.target).error;
                          t &&
                            "QuotaExceededError" === t.name &&
                            (n._hasReachedQuota = !0);
                        } catch (e) {}
                        r();
                      }),
                        (a.oncomplete = function () {
                          r();
                        });
                      var l = {
                        textureUrl: t,
                        data: o,
                      };
                      try {
                        var c = a.objectStore("textures").put(l);
                        (c.onsuccess = function () {}),
                          (c.onerror = function () {
                            r();
                          });
                      } catch (r) {
                        25 === r.code &&
                          ((e.IsUASupportingBlobStorage = !1),
                          (n._enableTexturesOffline = !1)),
                          (i.src = t);
                      }
                    } else i.src = t;
                  },
                  !1
                ),
                s.addEventListener(
                  "error",
                  function () {
                    F.Error("Error in XHR request in BABYLON.Database."),
                      (i.src = t);
                  },
                  !1
                ),
                s.send();
            } else i.src = t;
          } else
            F.Error(
              "Error: IndexedDB not supported by your browser or Babylon.js database is not open."
            ),
              (i.src = t);
        }),
        (e.prototype._checkVersionFromDB = function (e, t) {
          var i = this;
          this._loadVersionFromDBAsync(e, t, function () {
            i._saveVersionIntoDBAsync(e, t);
          });
        }),
        (e.prototype._loadVersionFromDBAsync = function (e, t, i) {
          var n,
            r = this;
          if (this._isSupported && this._db)
            try {
              var o = this._db.transaction(["versions"]);
              (o.oncomplete = function () {
                n
                  ? r._manifestVersionFound !== n.data
                    ? ((r._mustUpdateRessources = !0), i())
                    : t(n.data)
                  : ((r._mustUpdateRessources = !0), i());
              }),
                (o.onabort = function () {
                  t(-1);
                });
              var s = o.objectStore("versions").get(e);
              (s.onsuccess = function (e) {
                n = e.target.result;
              }),
                (s.onerror = function () {
                  F.Error("Error loading version for scene " + e + " from DB."),
                    t(-1);
                });
            } catch (e) {
              F.Error(
                "Error while accessing 'versions' object store (READ OP). Exception: " +
                  e.message
              ),
                t(-1);
            }
          else
            F.Error(
              "Error: IndexedDB not supported by your browser or Babylon.js database is not open."
            ),
              t(-1);
        }),
        (e.prototype._saveVersionIntoDBAsync = function (e, t) {
          var i = this;
          if (this._isSupported && !this._hasReachedQuota && this._db)
            try {
              var n = this._db.transaction(["versions"], "readwrite");
              (n.onabort = function (e) {
                try {
                  var n = e.srcElement.error;
                  n &&
                    "QuotaExceededError" === n.name &&
                    (i._hasReachedQuota = !0);
                } catch (e) {}
                t(-1);
              }),
                (n.oncomplete = function () {
                  t(i._manifestVersionFound);
                });
              var r = {
                  sceneUrl: e,
                  data: this._manifestVersionFound,
                },
                o = n.objectStore("versions").put(r);
              (o.onsuccess = function () {}),
                (o.onerror = function () {
                  F.Error(
                    "Error in DB add version request in BABYLON.Database."
                  );
                });
            } catch (e) {
              F.Error(
                "Error while accessing 'versions' object store (WRITE OP). Exception: " +
                  e.message
              ),
                t(-1);
            }
          else t(-1);
        }),
        (e.prototype.loadFile = function (t, i, n, r, o) {
          var s = this,
            a = e._ReturnFullUrlLocation(t),
            l = function () {
              s._saveFileAsync(a, i, n, o, r);
            };
          this._checkVersionFromDB(a, function (e) {
            -1 !== e
              ? s._mustUpdateRessources
                ? s._saveFileAsync(a, i, n, o, r)
                : s._loadFileAsync(a, i, l)
              : r && r();
          });
        }),
        (e.prototype._loadFileAsync = function (e, t, i) {
          if (this._isSupported && this._db) {
            var n, r;
            n = -1 !== e.indexOf(".babylon") ? "scenes" : "textures";
            var o = this._db.transaction([n]);
            (o.oncomplete = function () {
              r ? t(r.data) : i();
            }),
              (o.onabort = function () {
                i();
              });
            var s = o.objectStore(n).get(e);
            (s.onsuccess = function (e) {
              r = e.target.result;
            }),
              (s.onerror = function () {
                F.Error("Error loading file " + e + " from DB."), i();
              });
          } else
            F.Error(
              "Error: IndexedDB not supported by your browser or BabylonJS Database is not open."
            ),
              t();
        }),
        (e.prototype._saveFileAsync = function (t, i, n, r, o) {
          var s = this;
          if (this._isSupported) {
            var a;
            a = -1 !== t.indexOf(".babylon") ? "scenes" : "textures";
            var l,
              c = new Te();
            c.open("GET", t + "?" + Date.now()),
              r && (c.responseType = "arraybuffer"),
              n && (c.onprogress = n),
              c.addEventListener(
                "load",
                function () {
                  if (
                    200 === c.status ||
                    (c.status < 400 && e._ValidateXHRData(c, r ? 6 : 1))
                  )
                    if (
                      ((l = r ? c.response : c.responseText),
                      !s._hasReachedQuota && s._db)
                    ) {
                      var n,
                        u = s._db.transaction([a], "readwrite");
                      (u.onabort = function (e) {
                        try {
                          var t = e.srcElement.error;
                          t &&
                            "QuotaExceededError" === t.name &&
                            (s._hasReachedQuota = !0);
                        } catch (e) {}
                        i(l);
                      }),
                        (u.oncomplete = function () {
                          i(l);
                        }),
                        (n =
                          "scenes" === a
                            ? {
                                sceneUrl: t,
                                data: l,
                                version: s._manifestVersionFound,
                              }
                            : {
                                textureUrl: t,
                                data: l,
                              });
                      try {
                        var h = u.objectStore(a).put(n);
                        (h.onsuccess = function () {}),
                          (h.onerror = function () {
                            F.Error(
                              "Error in DB add file request in BABYLON.Database."
                            );
                          });
                      } catch (e) {
                        i(l);
                      }
                    } else i(l);
                  else c.status >= 400 && o ? o(c) : i();
                },
                !1
              ),
              c.addEventListener(
                "error",
                function () {
                  F.Error("error on XHR request."), i();
                },
                !1
              ),
              c.send();
          } else
            F.Error(
              "Error: IndexedDB not supported by your browser or Babylon.js database is not open."
            ),
              i();
        }),
        (e._ValidateXHRData = function (e, t) {
          void 0 === t && (t = 7);
          try {
            if (1 & t) {
              if (e.responseText && e.responseText.length > 0) return !0;
              if (1 === t) return !1;
            }
            if (2 & t) {
              var i = Nl.GetTGAHeader(e.response);
              if (i.width && i.height && i.width > 0 && i.height > 0) return !0;
              if (2 === t) return !1;
            }
            if (4 & t) {
              var n = new Uint8Array(e.response, 0, 3);
              return 68 === n[0] && 68 === n[1] && 83 === n[2];
            }
          } catch (e) {}
          return !1;
        }),
        (e.IsUASupportingBlobStorage = !0),
        (e.IDBStorageEnabled = !1),
        (e._ParseURL = function (e) {
          document.createElement("a").href = e;
          var t = e.substring(0, e.lastIndexOf("#")),
            i = e.substring(t.lastIndexOf("/") + 1, e.length);
          return e.substring(0, e.indexOf(i, 0));
        }),
        (e._ReturnFullUrlLocation = function (t) {
          return -1 === t.indexOf("http:/") &&
            -1 === t.indexOf("https:/") &&
            "undefined" != typeof window
            ? e._ParseURL(window.location.href) + t
            : t;
        }),
        e
      );
    })(),
    Ph = (function () {
      function e(e, t, i) {
        (this.gradient = e), (this.color1 = t), (this.color2 = i);
      }
      return (
        (e.prototype.getColorToRef = function (e) {
          this.color2
            ? T.LerpToRef(this.color1, this.color2, Math.random(), e)
            : e.copyFrom(this.color1);
        }),
        e
      );
    })(),
    Ah = function (e, t) {
      (this.gradient = e), (this.color = t);
    },
    Rh = (function () {
      function e(e, t, i) {
        (this.gradient = e), (this.factor1 = t), (this.factor2 = i);
      }
      return (
        (e.prototype.getFactor = function () {
          return void 0 === this.factor2 || this.factor2 === this.factor1
            ? this.factor1
            : this.factor1 + (this.factor2 - this.factor1) * Math.random();
        }),
        e
      );
    })(),
    Mh = (function () {
      function e() {}
      return (
        (e.GetCurrentGradient = function (e, t, i) {
          if (t[0].gradient > e) i(t[0], t[0], 1);
          else {
            for (var n = 0; n < t.length - 1; n++) {
              var r = t[n],
                o = t[n + 1];
              if (e >= r.gradient && e <= o.gradient)
                return void i(
                  r,
                  o,
                  (e - r.gradient) / (o.gradient - r.gradient)
                );
            }
            var s = t.length - 1;
            i(t[s], t[s], 1);
          }
        }),
        e
      );
    })(),
    Oh = (function () {
      function e(t) {
        (this.particleSystem = t),
          (this.position = f.Zero()),
          (this.direction = f.Zero()),
          (this.color = new T(0, 0, 0, 0)),
          (this.colorStep = new T(0, 0, 0, 0)),
          (this.lifeTime = 1),
          (this.age = 0),
          (this.size = 0),
          (this.scale = new p(1, 1)),
          (this.angle = 0),
          (this.angularSpeed = 0),
          (this.cellIndex = 0),
          (this._attachedSubEmitters = null),
          (this._currentColor1 = new T(0, 0, 0, 0)),
          (this._currentColor2 = new T(0, 0, 0, 0)),
          (this._currentSize1 = 0),
          (this._currentSize2 = 0),
          (this._currentAngularSpeed1 = 0),
          (this._currentAngularSpeed2 = 0),
          (this._currentVelocity1 = 0),
          (this._currentVelocity2 = 0),
          (this._currentLimitVelocity1 = 0),
          (this._currentLimitVelocity2 = 0),
          (this._currentDrag1 = 0),
          (this._currentDrag2 = 0),
          (this.id = e._Count++),
          this.particleSystem.isAnimationSheetEnabled &&
            this.updateCellInfoFromSystem();
      }
      return (
        (e.prototype.updateCellInfoFromSystem = function () {
          this.cellIndex = this.particleSystem.startSpriteCellID;
        }),
        (e.prototype.updateCellIndex = function () {
          var e = this.age,
            t = this.particleSystem.spriteCellChangeSpeed;
          this.particleSystem.spriteRandomStartCell &&
            (void 0 === this._randomCellOffset &&
              (this._randomCellOffset = Math.random() * this.lifeTime),
            0 === t
              ? ((t = 1), (e = this._randomCellOffset))
              : (e += this._randomCellOffset));
          var i = this._initialEndSpriteCellID - this._initialStartSpriteCellID,
            n = s.Clamp(((e * t) % this.lifeTime) / this.lifeTime);
          this.cellIndex = (this._initialStartSpriteCellID + n * i) | 0;
        }),
        (e.prototype._inheritParticleInfoToSubEmitter = function (e) {
          if (e.particleSystem.emitter.position) {
            var t = e.particleSystem.emitter;
            if ((t.position.copyFrom(this.position), e.inheritDirection)) {
              var i = y.Vector3[0];
              this.direction.normalizeToRef(i),
                t.setDirection(i, 0, Math.PI / 2);
            }
          } else e.particleSystem.emitter.copyFrom(this.position);
          this.direction.scaleToRef(
            e.inheritedVelocityAmount / 2,
            y.Vector3[0]
          ),
            e.particleSystem._inheritedVelocityOffset.copyFrom(y.Vector3[0]);
        }),
        (e.prototype._inheritParticleInfoToSubEmitters = function () {
          var e = this;
          this._attachedSubEmitters &&
            this._attachedSubEmitters.length > 0 &&
            this._attachedSubEmitters.forEach(function (t) {
              e._inheritParticleInfoToSubEmitter(t);
            });
        }),
        (e.prototype._reset = function () {
          (this.age = 0),
            (this.id = e._Count++),
            (this._currentColorGradient = null),
            (this._currentSizeGradient = null),
            (this._currentAngularSpeedGradient = null),
            (this._currentVelocityGradient = null),
            (this._currentLimitVelocityGradient = null),
            (this._currentDragGradient = null),
            (this.cellIndex = this.particleSystem.startSpriteCellID),
            (this._randomCellOffset = void 0);
        }),
        (e.prototype.copyTo = function (e) {
          e.position.copyFrom(this.position),
            this._initialDirection
              ? e._initialDirection
                ? e._initialDirection.copyFrom(this._initialDirection)
                : (e._initialDirection = this._initialDirection.clone())
              : (e._initialDirection = null),
            e.direction.copyFrom(this.direction),
            this._localPosition &&
              (e._localPosition
                ? e._localPosition.copyFrom(this._localPosition)
                : (e._localPosition = this._localPosition.clone())),
            e.color.copyFrom(this.color),
            e.colorStep.copyFrom(this.colorStep),
            (e.lifeTime = this.lifeTime),
            (e.age = this.age),
            (e._randomCellOffset = this._randomCellOffset),
            (e.size = this.size),
            e.scale.copyFrom(this.scale),
            (e.angle = this.angle),
            (e.angularSpeed = this.angularSpeed),
            (e.particleSystem = this.particleSystem),
            (e.cellIndex = this.cellIndex),
            (e.id = this.id),
            (e._attachedSubEmitters = this._attachedSubEmitters),
            this._currentColorGradient &&
              ((e._currentColorGradient = this._currentColorGradient),
              e._currentColor1.copyFrom(this._currentColor1),
              e._currentColor2.copyFrom(this._currentColor2)),
            this._currentSizeGradient &&
              ((e._currentSizeGradient = this._currentSizeGradient),
              (e._currentSize1 = this._currentSize1),
              (e._currentSize2 = this._currentSize2)),
            this._currentAngularSpeedGradient &&
              ((e._currentAngularSpeedGradient =
                this._currentAngularSpeedGradient),
              (e._currentAngularSpeed1 = this._currentAngularSpeed1),
              (e._currentAngularSpeed2 = this._currentAngularSpeed2)),
            this._currentVelocityGradient &&
              ((e._currentVelocityGradient = this._currentVelocityGradient),
              (e._currentVelocity1 = this._currentVelocity1),
              (e._currentVelocity2 = this._currentVelocity2)),
            this._currentLimitVelocityGradient &&
              ((e._currentLimitVelocityGradient =
                this._currentLimitVelocityGradient),
              (e._currentLimitVelocity1 = this._currentLimitVelocity1),
              (e._currentLimitVelocity2 = this._currentLimitVelocity2)),
            this._currentDragGradient &&
              ((e._currentDragGradient = this._currentDragGradient),
              (e._currentDrag1 = this._currentDrag1),
              (e._currentDrag2 = this._currentDrag2)),
            this.particleSystem.isAnimationSheetEnabled &&
              ((e._initialStartSpriteCellID = this._initialStartSpriteCellID),
              (e._initialEndSpriteCellID = this._initialEndSpriteCellID)),
            this.particleSystem.useRampGradients &&
              (e.remapData && this.remapData
                ? e.remapData.copyFrom(this.remapData)
                : (e.remapData = new _(0, 0, 0, 0))),
            this._randomNoiseCoordinates1 &&
              (e._randomNoiseCoordinates1
                ? (e._randomNoiseCoordinates1.copyFrom(
                    this._randomNoiseCoordinates1
                  ),
                  e._randomNoiseCoordinates2.copyFrom(
                    this._randomNoiseCoordinates2
                  ))
                : ((e._randomNoiseCoordinates1 =
                    this._randomNoiseCoordinates1.clone()),
                  (e._randomNoiseCoordinates2 =
                    this._randomNoiseCoordinates2.clone())));
        }),
        (e._Count = 0),
        e
      );
    })();
  !(function (e) {
    (e[(e.ATTACHED = 0)] = "ATTACHED"), (e[(e.END = 1)] = "END");
  })(xh || (xh = {}));
  var Ih = (function () {
    function e(e) {
      if (
        ((this.particleSystem = e),
        (this.type = xh.END),
        (this.inheritDirection = !1),
        (this.inheritedVelocityAmount = 0),
        !e.emitter || !e.emitter.dispose)
      ) {
        var t = h.GetClass("BABYLON.AbstractMesh");
        e.emitter = new t("SubemitterSystemEmitter", e.getScene());
      }
      e.onDisposeObservable.add(function () {
        e.emitter && e.emitter.dispose && e.emitter.dispose();
      });
    }
    return (
      (e.prototype.clone = function () {
        var t = this.particleSystem.emitter;
        t
          ? t instanceof f
            ? (t = t.clone())
            : -1 !== t.getClassName().indexOf("Mesh") &&
              ((t = new (h.GetClass("BABYLON.Mesh"))(
                "",
                t.getScene()
              )).isVisible = !1)
          : (t = new f());
        var i = new e(this.particleSystem.clone("", t));
        return (
          (i.particleSystem.name += "Clone"),
          (i.type = this.type),
          (i.inheritDirection = this.inheritDirection),
          (i.inheritedVelocityAmount = this.inheritedVelocityAmount),
          (i.particleSystem._disposeEmitterOnDispose = !0),
          (i.particleSystem.disposeOnStop = !0),
          i
        );
      }),
      (e.prototype.serialize = function () {
        var e = {};
        return (
          (e.type = this.type),
          (e.inheritDirection = this.inheritDirection),
          (e.inheritedVelocityAmount = this.inheritedVelocityAmount),
          (e.particleSystem = this.particleSystem.serialize()),
          e
        );
      }),
      (e._ParseParticleSystem = function (e, t, i) {
        throw $.WarnImport("ParseParticle");
      }),
      (e.Parse = function (t, i, n) {
        var r = t.particleSystem,
          o = new e(e._ParseParticleSystem(r, i, n));
        return (
          (o.type = t.type),
          (o.inheritDirection = t.inheritDirection),
          (o.inheritedVelocityAmount = t.inheritedVelocityAmount),
          (o.particleSystem._isSubEmitter = !0),
          o
        );
      }),
      (e.prototype.dispose = function () {
        this.particleSystem.dispose();
      }),
      e
    );
  })();
  Ke.ShadersStore.particlesPixelShader =
    "\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\nuniform sampler2D rampSampler;\n#endif\nvoid main(void) {\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);\nvec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;\nfloat remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);\nvec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));\nbaseColor.rgb*=rampColor.rgb;\n\nfloat finalAlpha=baseColor.a;\nbaseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;\nbaseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\nbaseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n}";
  Ke.ShadersStore.particlesVertexShader =
    "\nattribute vec3 position;\nattribute vec4 color;\nattribute float angle;\nattribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;\n\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos;\n#endif\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\nreturn position+alignedCorner;\n}\n#endif\nvoid main(void) {\nvec2 cornerPos;\ncornerPos=(vec2(offset.x-0.5,offset.y-0.5)-translationPivot)*size+translationPivot;\n#ifdef BILLBOARD\n\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=position-eyePosition;\nyaxis.y=0.;\nvPositionW=rotate(normalize(yaxis),rotatedCorner);\nvec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=position-eyePosition;\nvPositionW=rotateAlign(toCamera,rotatedCorner);\nvec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;\nvPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\n\ngl_Position=projection*vec4(viewPos,1.0);\n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=normalize(direction);\nvPositionW=rotate(yaxis,rotatedCorner);\ngl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);\nfloat columnOffset=cellIndex-rowOffset/particlesInfos.z;\nvec2 uvScale=particlesInfos.xy;\nvec2 uvOffset=vec2(offset.x ,1.0-offset.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n}";
  var Dh = (function (e) {
    function t(t, i, n, r, a, l) {
      void 0 === r && (r = null),
        void 0 === a && (a = !1),
        void 0 === l && (l = 0.01);
      var c = e.call(this, t) || this;
      return (
        (c._inheritedVelocityOffset = new f()),
        (c.onDisposeObservable = new o()),
        (c.onStoppedObservable = new o()),
        (c._particles = new Array()),
        (c._stockParticles = new Array()),
        (c._newPartsExcess = 0),
        (c._vertexBuffers = {}),
        (c._scaledColorStep = new T(0, 0, 0, 0)),
        (c._colorDiff = new T(0, 0, 0, 0)),
        (c._scaledDirection = f.Zero()),
        (c._scaledGravity = f.Zero()),
        (c._currentRenderId = -1),
        (c._useInstancing = !1),
        (c._started = !1),
        (c._stopped = !1),
        (c._actualFrame = 0),
        (c._currentEmitRate1 = 0),
        (c._currentEmitRate2 = 0),
        (c._currentStartSize1 = 0),
        (c._currentStartSize2 = 0),
        (c._rawTextureWidth = 256),
        (c._useRampGradients = !1),
        (c._disposeEmitterOnDispose = !1),
        (c.isLocal = !1),
        (c._onBeforeDrawParticlesObservable = null),
        (c.recycleParticle = function (e) {
          var t = c._particles.pop();
          t !== e && t.copyTo(e), c._stockParticles.push(t);
        }),
        (c._createParticle = function () {
          var e;
          if (
            (0 !== c._stockParticles.length
              ? (e = c._stockParticles.pop())._reset()
              : (e = new Oh(c)),
            c._subEmitters && c._subEmitters.length > 0)
          ) {
            var t =
              c._subEmitters[Math.floor(Math.random() * c._subEmitters.length)];
            (e._attachedSubEmitters = []),
              t.forEach(function (t) {
                if (t.type === xh.ATTACHED) {
                  var i = t.clone();
                  e._attachedSubEmitters.push(i), i.particleSystem.start();
                }
              });
          }
          return e;
        }),
        (c._emitFromParticle = function (e) {
          if (c._subEmitters && 0 !== c._subEmitters.length) {
            var t = Math.floor(Math.random() * c._subEmitters.length);
            c._subEmitters[t].forEach(function (t) {
              if (t.type === xh.END) {
                var i = t.clone();
                e._inheritParticleInfoToSubEmitter(i),
                  (i.particleSystem._rootParticleSystem = c),
                  c.activeSubSystems.push(i.particleSystem),
                  i.particleSystem.start();
              }
            });
          }
        }),
        (c._capacity = i),
        (c._epsilon = l),
        (c._isAnimationSheetEnabled = a),
        n && "Scene" !== n.getClassName()
          ? ((c._engine = n),
            (c.defaultProjectionMatrix = g.PerspectiveFovLH(0.8, 1, 0.1, 100)))
          : ((c._scene = n || j.LastCreatedScene),
            (c._engine = c._scene.getEngine()),
            (c.uniqueId = c._scene.getUniqueId()),
            c._scene.particleSystems.push(c)),
        c._engine.getCaps().vertexArrayObject && (c._vertexArrayObject = null),
        c._attachImageProcessingConfiguration(null),
        (c._customEffect = {
          0: r,
        }),
        (c._useInstancing = c._engine.getCaps().instancedArrays),
        c._createIndexBuffer(),
        c._createVertexBuffers(),
        (c.particleEmitterType = new yc()),
        (c.updateFunction = function (e) {
          var t = null,
            i = null;
          c.noiseTexture &&
            ((t = c.noiseTexture.getSize()), (i = c.noiseTexture.getContent()));
          for (
            var n,
              r = function () {
                n = e[o];
                var r = c._scaledUpdateSpeed,
                  a = n.age;
                if (((n.age += r), n.age > n.lifeTime)) {
                  var l = n.age - a;
                  (r = ((n.lifeTime - a) * r) / l), (n.age = n.lifeTime);
                }
                var u = n.age / n.lifeTime;
                c._colorGradients && c._colorGradients.length > 0
                  ? Mh.GetCurrentGradient(
                      u,
                      c._colorGradients,
                      function (e, t, i) {
                        e !== n._currentColorGradient &&
                          (n._currentColor1.copyFrom(n._currentColor2),
                          t.getColorToRef(n._currentColor2),
                          (n._currentColorGradient = e)),
                          T.LerpToRef(
                            n._currentColor1,
                            n._currentColor2,
                            i,
                            n.color
                          );
                      }
                    )
                  : (n.colorStep.scaleToRef(r, c._scaledColorStep),
                    n.color.addInPlace(c._scaledColorStep),
                    n.color.a < 0 && (n.color.a = 0)),
                  c._angularSpeedGradients &&
                    c._angularSpeedGradients.length > 0 &&
                    Mh.GetCurrentGradient(
                      u,
                      c._angularSpeedGradients,
                      function (e, t, i) {
                        e !== n._currentAngularSpeedGradient &&
                          ((n._currentAngularSpeed1 = n._currentAngularSpeed2),
                          (n._currentAngularSpeed2 = t.getFactor()),
                          (n._currentAngularSpeedGradient = e)),
                          (n.angularSpeed = s.Lerp(
                            n._currentAngularSpeed1,
                            n._currentAngularSpeed2,
                            i
                          ));
                      }
                    ),
                  (n.angle += n.angularSpeed * r);
                var h = r;
                if (
                  (c._velocityGradients &&
                    c._velocityGradients.length > 0 &&
                    Mh.GetCurrentGradient(
                      u,
                      c._velocityGradients,
                      function (e, t, i) {
                        e !== n._currentVelocityGradient &&
                          ((n._currentVelocity1 = n._currentVelocity2),
                          (n._currentVelocity2 = t.getFactor()),
                          (n._currentVelocityGradient = e)),
                          (h *= s.Lerp(
                            n._currentVelocity1,
                            n._currentVelocity2,
                            i
                          ));
                      }
                    ),
                  n.direction.scaleToRef(h, c._scaledDirection),
                  c._limitVelocityGradients &&
                    c._limitVelocityGradients.length > 0 &&
                    Mh.GetCurrentGradient(
                      u,
                      c._limitVelocityGradients,
                      function (e, t, i) {
                        e !== n._currentLimitVelocityGradient &&
                          ((n._currentLimitVelocity1 =
                            n._currentLimitVelocity2),
                          (n._currentLimitVelocity2 = t.getFactor()),
                          (n._currentLimitVelocityGradient = e));
                        var r = s.Lerp(
                          n._currentLimitVelocity1,
                          n._currentLimitVelocity2,
                          i
                        );
                        n.direction.length() > r &&
                          n.direction.scaleInPlace(c.limitVelocityDamping);
                      }
                    ),
                  c._dragGradients &&
                    c._dragGradients.length > 0 &&
                    Mh.GetCurrentGradient(
                      u,
                      c._dragGradients,
                      function (e, t, i) {
                        e !== n._currentDragGradient &&
                          ((n._currentDrag1 = n._currentDrag2),
                          (n._currentDrag2 = t.getFactor()),
                          (n._currentDragGradient = e));
                        var r = s.Lerp(n._currentDrag1, n._currentDrag2, i);
                        c._scaledDirection.scaleInPlace(1 - r);
                      }
                    ),
                  c.isLocal && n._localPosition
                    ? (n._localPosition.addInPlace(c._scaledDirection),
                      f.TransformCoordinatesToRef(
                        n._localPosition,
                        c._emitterWorldMatrix,
                        n.position
                      ))
                    : n.position.addInPlace(c._scaledDirection),
                  i && t && n._randomNoiseCoordinates1)
                ) {
                  var d = c._fetchR(
                      n._randomNoiseCoordinates1.x,
                      n._randomNoiseCoordinates1.y,
                      t.width,
                      t.height,
                      i
                    ),
                    p = c._fetchR(
                      n._randomNoiseCoordinates1.z,
                      n._randomNoiseCoordinates2.x,
                      t.width,
                      t.height,
                      i
                    ),
                    _ = c._fetchR(
                      n._randomNoiseCoordinates2.y,
                      n._randomNoiseCoordinates2.z,
                      t.width,
                      t.height,
                      i
                    ),
                    m = y.Vector3[0],
                    g = y.Vector3[1];
                  m.copyFromFloats(
                    (2 * d - 1) * c.noiseStrength.x,
                    (2 * p - 1) * c.noiseStrength.y,
                    (2 * _ - 1) * c.noiseStrength.z
                  ),
                    m.scaleToRef(r, g),
                    n.direction.addInPlace(g);
                }
                if (
                  (c.gravity.scaleToRef(r, c._scaledGravity),
                  n.direction.addInPlace(c._scaledGravity),
                  c._sizeGradients &&
                    c._sizeGradients.length > 0 &&
                    Mh.GetCurrentGradient(
                      u,
                      c._sizeGradients,
                      function (e, t, i) {
                        e !== n._currentSizeGradient &&
                          ((n._currentSize1 = n._currentSize2),
                          (n._currentSize2 = t.getFactor()),
                          (n._currentSizeGradient = e)),
                          (n.size = s.Lerp(
                            n._currentSize1,
                            n._currentSize2,
                            i
                          ));
                      }
                    ),
                  c._useRampGradients &&
                    (c._colorRemapGradients &&
                      c._colorRemapGradients.length > 0 &&
                      Mh.GetCurrentGradient(
                        u,
                        c._colorRemapGradients,
                        function (e, t, i) {
                          var r = s.Lerp(e.factor1, t.factor1, i),
                            o = s.Lerp(e.factor2, t.factor2, i);
                          (n.remapData.x = r), (n.remapData.y = o - r);
                        }
                      ),
                    c._alphaRemapGradients &&
                      c._alphaRemapGradients.length > 0 &&
                      Mh.GetCurrentGradient(
                        u,
                        c._alphaRemapGradients,
                        function (e, t, i) {
                          var r = s.Lerp(e.factor1, t.factor1, i),
                            o = s.Lerp(e.factor2, t.factor2, i);
                          (n.remapData.z = r), (n.remapData.w = o - r);
                        }
                      )),
                  c._isAnimationSheetEnabled && n.updateCellIndex(),
                  n._inheritParticleInfoToSubEmitters(),
                  n.age >= n.lifeTime)
                )
                  return (
                    c._emitFromParticle(n),
                    n._attachedSubEmitters &&
                      (n._attachedSubEmitters.forEach(function (e) {
                        (e.particleSystem.disposeOnStop = !0),
                          e.particleSystem.stop();
                      }),
                      (n._attachedSubEmitters = null)),
                    c.recycleParticle(n),
                    o--,
                    "continue"
                  );
              },
              o = 0;
            o < e.length;
            o++
          )
            r();
        }),
        c
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "onDispose", {
        set: function (e) {
          this._onDisposeObserver &&
            this.onDisposeObservable.remove(this._onDisposeObserver),
            (this._onDisposeObserver = this.onDisposeObservable.add(e));
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "useRampGradients", {
        get: function () {
          return this._useRampGradients;
        },
        set: function (e) {
          this._useRampGradients !== e &&
            ((this._useRampGradients = e), this._resetEffect());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "particles", {
        get: function () {
          return this._particles;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.getActiveCount = function () {
        return this._particles.length;
      }),
      (t.prototype.getClassName = function () {
        return "ParticleSystem";
      }),
      (t.prototype.isStopping = function () {
        return this._stopped && this.isAlive();
      }),
      (t.prototype.getCustomEffect = function (e) {
        var t;
        return (
          void 0 === e && (e = 0),
          null !== (t = this._customEffect[e]) && void 0 !== t
            ? t
            : this._customEffect[0]
        );
      }),
      (t.prototype.setCustomEffect = function (e, t) {
        void 0 === t && (t = 0), (this._customEffect[t] = e);
      }),
      Object.defineProperty(t.prototype, "onBeforeDrawParticlesObservable", {
        get: function () {
          return (
            this._onBeforeDrawParticlesObservable ||
              (this._onBeforeDrawParticlesObservable = new o()),
            this._onBeforeDrawParticlesObservable
          );
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "vertexShaderName", {
        get: function () {
          return "particles";
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._addFactorGradient = function (e, t, i, n) {
        var r = new Rh(t, i, n);
        e.push(r),
          e.sort(function (e, t) {
            return e.gradient < t.gradient
              ? -1
              : e.gradient > t.gradient
                ? 1
                : 0;
          });
      }),
      (t.prototype._removeFactorGradient = function (e, t) {
        if (e)
          for (var i = 0, n = 0, r = e; n < r.length; n++) {
            if (r[n].gradient === t) {
              e.splice(i, 1);
              break;
            }
            i++;
          }
      }),
      (t.prototype.addLifeTimeGradient = function (e, t, i) {
        return (
          this._lifeTimeGradients || (this._lifeTimeGradients = []),
          this._addFactorGradient(this._lifeTimeGradients, e, t, i),
          this
        );
      }),
      (t.prototype.removeLifeTimeGradient = function (e) {
        return this._removeFactorGradient(this._lifeTimeGradients, e), this;
      }),
      (t.prototype.addSizeGradient = function (e, t, i) {
        return (
          this._sizeGradients || (this._sizeGradients = []),
          this._addFactorGradient(this._sizeGradients, e, t, i),
          this
        );
      }),
      (t.prototype.removeSizeGradient = function (e) {
        return this._removeFactorGradient(this._sizeGradients, e), this;
      }),
      (t.prototype.addColorRemapGradient = function (e, t, i) {
        return (
          this._colorRemapGradients || (this._colorRemapGradients = []),
          this._addFactorGradient(this._colorRemapGradients, e, t, i),
          this
        );
      }),
      (t.prototype.removeColorRemapGradient = function (e) {
        return this._removeFactorGradient(this._colorRemapGradients, e), this;
      }),
      (t.prototype.addAlphaRemapGradient = function (e, t, i) {
        return (
          this._alphaRemapGradients || (this._alphaRemapGradients = []),
          this._addFactorGradient(this._alphaRemapGradients, e, t, i),
          this
        );
      }),
      (t.prototype.removeAlphaRemapGradient = function (e) {
        return this._removeFactorGradient(this._alphaRemapGradients, e), this;
      }),
      (t.prototype.addAngularSpeedGradient = function (e, t, i) {
        return (
          this._angularSpeedGradients || (this._angularSpeedGradients = []),
          this._addFactorGradient(this._angularSpeedGradients, e, t, i),
          this
        );
      }),
      (t.prototype.removeAngularSpeedGradient = function (e) {
        return this._removeFactorGradient(this._angularSpeedGradients, e), this;
      }),
      (t.prototype.addVelocityGradient = function (e, t, i) {
        return (
          this._velocityGradients || (this._velocityGradients = []),
          this._addFactorGradient(this._velocityGradients, e, t, i),
          this
        );
      }),
      (t.prototype.removeVelocityGradient = function (e) {
        return this._removeFactorGradient(this._velocityGradients, e), this;
      }),
      (t.prototype.addLimitVelocityGradient = function (e, t, i) {
        return (
          this._limitVelocityGradients || (this._limitVelocityGradients = []),
          this._addFactorGradient(this._limitVelocityGradients, e, t, i),
          this
        );
      }),
      (t.prototype.removeLimitVelocityGradient = function (e) {
        return (
          this._removeFactorGradient(this._limitVelocityGradients, e), this
        );
      }),
      (t.prototype.addDragGradient = function (e, t, i) {
        return (
          this._dragGradients || (this._dragGradients = []),
          this._addFactorGradient(this._dragGradients, e, t, i),
          this
        );
      }),
      (t.prototype.removeDragGradient = function (e) {
        return this._removeFactorGradient(this._dragGradients, e), this;
      }),
      (t.prototype.addEmitRateGradient = function (e, t, i) {
        return (
          this._emitRateGradients || (this._emitRateGradients = []),
          this._addFactorGradient(this._emitRateGradients, e, t, i),
          this
        );
      }),
      (t.prototype.removeEmitRateGradient = function (e) {
        return this._removeFactorGradient(this._emitRateGradients, e), this;
      }),
      (t.prototype.addStartSizeGradient = function (e, t, i) {
        return (
          this._startSizeGradients || (this._startSizeGradients = []),
          this._addFactorGradient(this._startSizeGradients, e, t, i),
          this
        );
      }),
      (t.prototype.removeStartSizeGradient = function (e) {
        return this._removeFactorGradient(this._startSizeGradients, e), this;
      }),
      (t.prototype._createRampGradientTexture = function () {
        if (
          this._rampGradients &&
          this._rampGradients.length &&
          !this._rampGradientsTexture &&
          this._scene
        ) {
          for (
            var e = new Uint8Array(4 * this._rawTextureWidth),
              t = S.Color3[0],
              i = 0;
            i < this._rawTextureWidth;
            i++
          ) {
            var n = i / this._rawTextureWidth;
            Mh.GetCurrentGradient(n, this._rampGradients, function (n, r, o) {
              b.LerpToRef(n.color, r.color, o, t),
                (e[4 * i] = 255 * t.r),
                (e[4 * i + 1] = 255 * t.g),
                (e[4 * i + 2] = 255 * t.b),
                (e[4 * i + 3] = 255);
            });
          }
          this._rampGradientsTexture = bn.CreateRGBATexture(
            e,
            this._rawTextureWidth,
            1,
            this._scene,
            !1,
            !1,
            1
          );
        }
      }),
      (t.prototype.getRampGradients = function () {
        return this._rampGradients;
      }),
      (t.prototype.forceRefreshGradients = function () {
        this._syncRampGradientTexture();
      }),
      (t.prototype._syncRampGradientTexture = function () {
        this._rampGradients &&
          (this._rampGradients.sort(function (e, t) {
            return e.gradient < t.gradient
              ? -1
              : e.gradient > t.gradient
                ? 1
                : 0;
          }),
          this._rampGradientsTexture &&
            (this._rampGradientsTexture.dispose(),
            (this._rampGradientsTexture = null)),
          this._createRampGradientTexture());
      }),
      (t.prototype.addRampGradient = function (e, t) {
        this._rampGradients || (this._rampGradients = []);
        var i = new Ah(e, t);
        return (
          this._rampGradients.push(i), this._syncRampGradientTexture(), this
        );
      }),
      (t.prototype.removeRampGradient = function (e) {
        return (
          this._removeGradientAndTexture(
            e,
            this._rampGradients,
            this._rampGradientsTexture
          ),
          (this._rampGradientsTexture = null),
          this._rampGradients &&
            this._rampGradients.length > 0 &&
            this._createRampGradientTexture(),
          this
        );
      }),
      (t.prototype.addColorGradient = function (e, t, i) {
        this._colorGradients || (this._colorGradients = []);
        var n = new Ph(e, t, i);
        return (
          this._colorGradients.push(n),
          this._colorGradients.sort(function (e, t) {
            return e.gradient < t.gradient
              ? -1
              : e.gradient > t.gradient
                ? 1
                : 0;
          }),
          this
        );
      }),
      (t.prototype.removeColorGradient = function (e) {
        if (!this._colorGradients) return this;
        for (var t = 0, i = 0, n = this._colorGradients; i < n.length; i++) {
          if (n[i].gradient === e) {
            this._colorGradients.splice(t, 1);
            break;
          }
          t++;
        }
        return this;
      }),
      (t.prototype._fetchR = function (e, t, i, n, r) {
        return (
          r[
            4 *
              ((((e = 0.5 * Math.abs(e) + 0.5) * i) % i | 0) +
                (((t = 0.5 * Math.abs(t) + 0.5) * n) % n | 0) * i)
          ] / 255
        );
      }),
      (t.prototype._reset = function () {
        this._resetEffect();
      }),
      (t.prototype._resetEffect = function () {
        this._vertexBuffer &&
          (this._vertexBuffer.dispose(), (this._vertexBuffer = null)),
          this._spriteBuffer &&
            (this._spriteBuffer.dispose(), (this._spriteBuffer = null)),
          this._vertexArrayObject &&
            (this._engine.releaseVertexArrayObject(this._vertexArrayObject),
            (this._vertexArrayObject = null)),
          this._createVertexBuffers();
      }),
      (t.prototype._createVertexBuffers = function () {
        (this._vertexBufferSize = this._useInstancing ? 10 : 12),
          this._isAnimationSheetEnabled && (this._vertexBufferSize += 1),
          (this._isBillboardBased &&
            this.billboardMode !== t.BILLBOARDMODE_STRETCHED) ||
            (this._vertexBufferSize += 3),
          this._useRampGradients && (this._vertexBufferSize += 4);
        var e = this._engine;
        (this._vertexData = new Float32Array(
          this._capacity *
            this._vertexBufferSize *
            (this._useInstancing ? 1 : 4)
        )),
          (this._vertexBuffer = new Dt(
            e,
            this._vertexData,
            !0,
            this._vertexBufferSize
          ));
        var i = 0,
          n = this._vertexBuffer.createVertexBuffer(
            wt.PositionKind,
            i,
            3,
            this._vertexBufferSize,
            this._useInstancing
          );
        (this._vertexBuffers[wt.PositionKind] = n), (i += 3);
        var r = this._vertexBuffer.createVertexBuffer(
          wt.ColorKind,
          i,
          4,
          this._vertexBufferSize,
          this._useInstancing
        );
        (this._vertexBuffers[wt.ColorKind] = r), (i += 4);
        var o = this._vertexBuffer.createVertexBuffer(
          "angle",
          i,
          1,
          this._vertexBufferSize,
          this._useInstancing
        );
        (this._vertexBuffers.angle = o), (i += 1);
        var s,
          a = this._vertexBuffer.createVertexBuffer(
            "size",
            i,
            2,
            this._vertexBufferSize,
            this._useInstancing
          );
        if (
          ((this._vertexBuffers.size = a),
          (i += 2),
          this._isAnimationSheetEnabled)
        ) {
          var l = this._vertexBuffer.createVertexBuffer(
            "cellIndex",
            i,
            1,
            this._vertexBufferSize,
            this._useInstancing
          );
          (this._vertexBuffers.cellIndex = l), (i += 1);
        }
        if (
          !this._isBillboardBased ||
          this.billboardMode === t.BILLBOARDMODE_STRETCHED
        ) {
          var c = this._vertexBuffer.createVertexBuffer(
            "direction",
            i,
            3,
            this._vertexBufferSize,
            this._useInstancing
          );
          (this._vertexBuffers.direction = c), (i += 3);
        }
        if (this._useRampGradients) {
          var u = this._vertexBuffer.createVertexBuffer(
            "remapData",
            i,
            4,
            this._vertexBufferSize,
            this._useInstancing
          );
          (this._vertexBuffers.remapData = u), (i += 4);
        }
        if (this._useInstancing) {
          var h = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]);
          (this._spriteBuffer = new Dt(e, h, !1, 2)),
            (s = this._spriteBuffer.createVertexBuffer("offset", 0, 2));
        } else
          (s = this._vertexBuffer.createVertexBuffer(
            "offset",
            i,
            2,
            this._vertexBufferSize,
            this._useInstancing
          )),
            (i += 2);
        this._vertexBuffers.offset = s;
      }),
      (t.prototype._createIndexBuffer = function () {
        if (!this._useInstancing) {
          for (var e = [], t = 0, i = 0; i < this._capacity; i++)
            e.push(t),
              e.push(t + 1),
              e.push(t + 2),
              e.push(t),
              e.push(t + 2),
              e.push(t + 3),
              (t += 4);
          this._indexBuffer = this._engine.createIndexBuffer(e);
        }
      }),
      (t.prototype.getCapacity = function () {
        return this._capacity;
      }),
      (t.prototype.isAlive = function () {
        return this._alive;
      }),
      (t.prototype.isStarted = function () {
        return this._started;
      }),
      (t.prototype._prepareSubEmitterInternalArray = function () {
        var e = this;
        (this._subEmitters = new Array()),
          this.subEmitters &&
            this.subEmitters.forEach(function (i) {
              i instanceof t
                ? e._subEmitters.push([new Ih(i)])
                : i instanceof Ih
                  ? e._subEmitters.push([i])
                  : i instanceof Array && e._subEmitters.push(i);
            });
      }),
      (t.prototype.start = function (e) {
        var t,
          i = this;
        if (
          (void 0 === e && (e = this.startDelay),
          !this.targetStopDuration &&
            this._hasTargetStopDurationDependantGradient())
        )
          throw "Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";
        if (e)
          setTimeout(function () {
            i.start(0);
          }, e);
        else {
          if (
            (this._prepareSubEmitterInternalArray(),
            (this._started = !0),
            (this._stopped = !1),
            (this._actualFrame = 0),
            this._subEmitters &&
              0 != this._subEmitters.length &&
              (this.activeSubSystems = new Array()),
            this._emitRateGradients &&
              (this._emitRateGradients.length > 0 &&
                ((this._currentEmitRateGradient = this._emitRateGradients[0]),
                (this._currentEmitRate1 =
                  this._currentEmitRateGradient.getFactor()),
                (this._currentEmitRate2 = this._currentEmitRate1)),
              this._emitRateGradients.length > 1 &&
                (this._currentEmitRate2 =
                  this._emitRateGradients[1].getFactor())),
            this._startSizeGradients &&
              (this._startSizeGradients.length > 0 &&
                ((this._currentStartSizeGradient = this._startSizeGradients[0]),
                (this._currentStartSize1 =
                  this._currentStartSizeGradient.getFactor()),
                (this._currentStartSize2 = this._currentStartSize1)),
              this._startSizeGradients.length > 1 &&
                (this._currentStartSize2 =
                  this._startSizeGradients[1].getFactor())),
            this.preWarmCycles)
          ) {
            -1 !==
              (null === (t = this.emitter) || void 0 === t
                ? void 0
                : t.getClassName().indexOf("Mesh")) &&
              this.emitter.computeWorldMatrix(!0);
            var n = this.noiseTexture;
            if (n && n.onGeneratedObservable)
              n.onGeneratedObservable.addOnce(function () {
                setTimeout(function () {
                  for (var e = 0; e < i.preWarmCycles; e++)
                    i.animate(!0), n.render();
                });
              });
            else for (var r = 0; r < this.preWarmCycles; r++) this.animate(!0);
          }
          this.beginAnimationOnStart &&
            this.animations &&
            this.animations.length > 0 &&
            this._scene &&
            this._scene.beginAnimation(
              this,
              this.beginAnimationFrom,
              this.beginAnimationTo,
              this.beginAnimationLoop
            );
        }
      }),
      (t.prototype.stop = function (e) {
        void 0 === e && (e = !0),
          this._stopped ||
            (this.onStoppedObservable.notifyObservers(this),
            (this._stopped = !0),
            e && this._stopSubEmitters());
      }),
      (t.prototype.reset = function () {
        (this._stockParticles = []), (this._particles = []);
      }),
      (t.prototype._appendParticleVertex = function (e, i, n, r) {
        var o = e * this._vertexBufferSize;
        if (
          ((this._vertexData[o++] = i.position.x + this.worldOffset.x),
          (this._vertexData[o++] = i.position.y + this.worldOffset.y),
          (this._vertexData[o++] = i.position.z + this.worldOffset.z),
          (this._vertexData[o++] = i.color.r),
          (this._vertexData[o++] = i.color.g),
          (this._vertexData[o++] = i.color.b),
          (this._vertexData[o++] = i.color.a),
          (this._vertexData[o++] = i.angle),
          (this._vertexData[o++] = i.scale.x * i.size),
          (this._vertexData[o++] = i.scale.y * i.size),
          this._isAnimationSheetEnabled &&
            (this._vertexData[o++] = i.cellIndex),
          this._isBillboardBased)
        )
          this.billboardMode === t.BILLBOARDMODE_STRETCHED &&
            ((this._vertexData[o++] = i.direction.x),
            (this._vertexData[o++] = i.direction.y),
            (this._vertexData[o++] = i.direction.z));
        else if (i._initialDirection) {
          var s = i._initialDirection;
          this.isLocal &&
            (f.TransformNormalToRef(s, this._emitterWorldMatrix, y.Vector3[0]),
            (s = y.Vector3[0])),
            0 === s.x && 0 === s.z && (s.x = 0.001),
            (this._vertexData[o++] = s.x),
            (this._vertexData[o++] = s.y),
            (this._vertexData[o++] = s.z);
        } else {
          var a = i.direction;
          this.isLocal &&
            (f.TransformNormalToRef(a, this._emitterWorldMatrix, y.Vector3[0]),
            (a = y.Vector3[0])),
            0 === a.x && 0 === a.z && (a.x = 0.001),
            (this._vertexData[o++] = a.x),
            (this._vertexData[o++] = a.y),
            (this._vertexData[o++] = a.z);
        }
        this._useRampGradients &&
          i.remapData &&
          ((this._vertexData[o++] = i.remapData.x),
          (this._vertexData[o++] = i.remapData.y),
          (this._vertexData[o++] = i.remapData.z),
          (this._vertexData[o++] = i.remapData.w)),
          this._useInstancing ||
            (this._isAnimationSheetEnabled &&
              (0 === n
                ? (n = this._epsilon)
                : 1 === n && (n = 1 - this._epsilon),
              0 === r
                ? (r = this._epsilon)
                : 1 === r && (r = 1 - this._epsilon)),
            (this._vertexData[o++] = n),
            (this._vertexData[o++] = r));
      }),
      (t.prototype._stopSubEmitters = function () {
        this.activeSubSystems &&
          (this.activeSubSystems.forEach(function (e) {
            e.stop(!0);
          }),
          (this.activeSubSystems = new Array()));
      }),
      (t.prototype._removeFromRoot = function () {
        if (this._rootParticleSystem) {
          var e = this._rootParticleSystem.activeSubSystems.indexOf(this);
          -1 !== e && this._rootParticleSystem.activeSubSystems.splice(e, 1),
            (this._rootParticleSystem = null);
        }
      }),
      (t.prototype._update = function (e) {
        var t,
          i = this;
        if (
          ((this._alive = this._particles.length > 0), this.emitter.position)
        ) {
          var n = this.emitter;
          this._emitterWorldMatrix = n.getWorldMatrix();
        } else {
          var r = this.emitter;
          this._emitterWorldMatrix = g.Translation(r.x, r.y, r.z);
        }
        this.updateFunction(this._particles);
        for (
          var o,
            a = function () {
              if (l._particles.length === l._capacity) return "break";
              if (
                ((t = l._createParticle()),
                l._particles.push(t),
                l.targetStopDuration &&
                  l._lifeTimeGradients &&
                  l._lifeTimeGradients.length > 0)
              ) {
                var e = s.Clamp(l._actualFrame / l.targetStopDuration);
                Mh.GetCurrentGradient(e, l._lifeTimeGradients, function (i, n) {
                  var r = i,
                    o = n,
                    a = r.getFactor(),
                    l = o.getFactor(),
                    c = (e - r.gradient) / (o.gradient - r.gradient);
                  t.lifeTime = s.Lerp(a, l, c);
                });
              } else t.lifeTime = s.RandomRange(l.minLifeTime, l.maxLifeTime);
              var n = s.RandomRange(l.minEmitPower, l.maxEmitPower);
              if (
                (l.startPositionFunction
                  ? l.startPositionFunction(
                      l._emitterWorldMatrix,
                      t.position,
                      t,
                      l.isLocal
                    )
                  : l.particleEmitterType.startPositionFunction(
                      l._emitterWorldMatrix,
                      t.position,
                      t,
                      l.isLocal
                    ),
                l.isLocal &&
                  (t._localPosition
                    ? t._localPosition.copyFrom(t.position)
                    : (t._localPosition = t.position.clone()),
                  f.TransformCoordinatesToRef(
                    t._localPosition,
                    l._emitterWorldMatrix,
                    t.position
                  )),
                l.startDirectionFunction
                  ? l.startDirectionFunction(
                      l._emitterWorldMatrix,
                      t.direction,
                      t,
                      l.isLocal
                    )
                  : l.particleEmitterType.startDirectionFunction(
                      l._emitterWorldMatrix,
                      t.direction,
                      t,
                      l.isLocal
                    ),
                0 === n
                  ? t._initialDirection
                    ? t._initialDirection.copyFrom(t.direction)
                    : (t._initialDirection = t.direction.clone())
                  : (t._initialDirection = null),
                t.direction.scaleInPlace(n),
                l._sizeGradients && 0 !== l._sizeGradients.length
                  ? ((t._currentSizeGradient = l._sizeGradients[0]),
                    (t._currentSize1 = t._currentSizeGradient.getFactor()),
                    (t.size = t._currentSize1),
                    l._sizeGradients.length > 1
                      ? (t._currentSize2 = l._sizeGradients[1].getFactor())
                      : (t._currentSize2 = t._currentSize1))
                  : (t.size = s.RandomRange(l.minSize, l.maxSize)),
                t.scale.copyFromFloats(
                  s.RandomRange(l.minScaleX, l.maxScaleX),
                  s.RandomRange(l.minScaleY, l.maxScaleY)
                ),
                l._startSizeGradients &&
                  l._startSizeGradients[0] &&
                  l.targetStopDuration)
              ) {
                var r = l._actualFrame / l.targetStopDuration;
                Mh.GetCurrentGradient(
                  r,
                  l._startSizeGradients,
                  function (e, n, r) {
                    e !== i._currentStartSizeGradient &&
                      ((i._currentStartSize1 = i._currentStartSize2),
                      (i._currentStartSize2 = n.getFactor()),
                      (i._currentStartSizeGradient = e));
                    var o = s.Lerp(
                      i._currentStartSize1,
                      i._currentStartSize2,
                      r
                    );
                    t.scale.scaleInPlace(o);
                  }
                );
              }
              l._angularSpeedGradients && 0 !== l._angularSpeedGradients.length
                ? ((t._currentAngularSpeedGradient =
                    l._angularSpeedGradients[0]),
                  (t.angularSpeed = t._currentAngularSpeedGradient.getFactor()),
                  (t._currentAngularSpeed1 = t.angularSpeed),
                  l._angularSpeedGradients.length > 1
                    ? (t._currentAngularSpeed2 =
                        l._angularSpeedGradients[1].getFactor())
                    : (t._currentAngularSpeed2 = t._currentAngularSpeed1))
                : (t.angularSpeed = s.RandomRange(
                    l.minAngularSpeed,
                    l.maxAngularSpeed
                  )),
                (t.angle = s.RandomRange(
                  l.minInitialRotation,
                  l.maxInitialRotation
                )),
                l._velocityGradients &&
                  l._velocityGradients.length > 0 &&
                  ((t._currentVelocityGradient = l._velocityGradients[0]),
                  (t._currentVelocity1 =
                    t._currentVelocityGradient.getFactor()),
                  l._velocityGradients.length > 1
                    ? (t._currentVelocity2 =
                        l._velocityGradients[1].getFactor())
                    : (t._currentVelocity2 = t._currentVelocity1)),
                l._limitVelocityGradients &&
                  l._limitVelocityGradients.length > 0 &&
                  ((t._currentLimitVelocityGradient =
                    l._limitVelocityGradients[0]),
                  (t._currentLimitVelocity1 =
                    t._currentLimitVelocityGradient.getFactor()),
                  l._limitVelocityGradients.length > 1
                    ? (t._currentLimitVelocity2 =
                        l._limitVelocityGradients[1].getFactor())
                    : (t._currentLimitVelocity2 = t._currentLimitVelocity1)),
                l._dragGradients &&
                  l._dragGradients.length > 0 &&
                  ((t._currentDragGradient = l._dragGradients[0]),
                  (t._currentDrag1 = t._currentDragGradient.getFactor()),
                  l._dragGradients.length > 1
                    ? (t._currentDrag2 = l._dragGradients[1].getFactor())
                    : (t._currentDrag2 = t._currentDrag1)),
                l._colorGradients && 0 !== l._colorGradients.length
                  ? ((t._currentColorGradient = l._colorGradients[0]),
                    t._currentColorGradient.getColorToRef(t.color),
                    t._currentColor1.copyFrom(t.color),
                    l._colorGradients.length > 1
                      ? l._colorGradients[1].getColorToRef(t._currentColor2)
                      : t._currentColor2.copyFrom(t.color))
                  : ((o = s.RandomRange(0, 1)),
                    T.LerpToRef(l.color1, l.color2, o, t.color),
                    l.colorDead.subtractToRef(t.color, l._colorDiff),
                    l._colorDiff.scaleToRef(1 / t.lifeTime, t.colorStep)),
                l._isAnimationSheetEnabled &&
                  ((t._initialStartSpriteCellID = l.startSpriteCellID),
                  (t._initialEndSpriteCellID = l.endSpriteCellID)),
                t.direction.addInPlace(l._inheritedVelocityOffset),
                l._useRampGradients && (t.remapData = new _(0, 1, 0, 1)),
                l.noiseTexture &&
                  (t._randomNoiseCoordinates1
                    ? (t._randomNoiseCoordinates1.copyFromFloats(
                        Math.random(),
                        Math.random(),
                        Math.random()
                      ),
                      t._randomNoiseCoordinates2.copyFromFloats(
                        Math.random(),
                        Math.random(),
                        Math.random()
                      ))
                    : ((t._randomNoiseCoordinates1 = new f(
                        Math.random(),
                        Math.random(),
                        Math.random()
                      )),
                      (t._randomNoiseCoordinates2 = new f(
                        Math.random(),
                        Math.random(),
                        Math.random()
                      )))),
                t._inheritParticleInfoToSubEmitters();
            },
            l = this,
            c = 0;
          c < e && "break" !== a();
          c++
        );
      }),
      (t._GetAttributeNamesOrOptions = function (e, t, i) {
        void 0 === e && (e = !1),
          void 0 === t && (t = !1),
          void 0 === i && (i = !1);
        var n = [wt.PositionKind, wt.ColorKind, "angle", "offset", "size"];
        return (
          e && n.push("cellIndex"),
          t || n.push("direction"),
          i && n.push("remapData"),
          n
        );
      }),
      (t._GetEffectCreationOptions = function (e) {
        void 0 === e && (e = !1);
        var t = [
          "invView",
          "view",
          "projection",
          "vClipPlane",
          "vClipPlane2",
          "vClipPlane3",
          "vClipPlane4",
          "vClipPlane5",
          "vClipPlane6",
          "textureMask",
          "translationPivot",
          "eyePosition",
        ];
        return e && t.push("particlesInfos"), t;
      }),
      (t.prototype.fillDefines = function (e, i) {
        if (
          (this._scene &&
            (this._scene.clipPlane && e.push("#define CLIPPLANE"),
            this._scene.clipPlane2 && e.push("#define CLIPPLANE2"),
            this._scene.clipPlane3 && e.push("#define CLIPPLANE3"),
            this._scene.clipPlane4 && e.push("#define CLIPPLANE4"),
            this._scene.clipPlane5 && e.push("#define CLIPPLANE5"),
            this._scene.clipPlane6 && e.push("#define CLIPPLANE6")),
          this._isAnimationSheetEnabled && e.push("#define ANIMATESHEET"),
          i === t.BLENDMODE_MULTIPLY && e.push("#define BLENDMULTIPLYMODE"),
          this._useRampGradients && e.push("#define RAMPGRADIENT"),
          this._isBillboardBased)
        )
          switch ((e.push("#define BILLBOARD"), this.billboardMode)) {
            case t.BILLBOARDMODE_Y:
              e.push("#define BILLBOARDY");
              break;
            case t.BILLBOARDMODE_STRETCHED:
              e.push("#define BILLBOARDSTRETCHED");
              break;
            case t.BILLBOARDMODE_ALL:
              e.push("#define BILLBOARDMODE_ALL");
          }
        this._imageProcessingConfiguration &&
          (this._imageProcessingConfiguration.prepareDefines(
            this._imageProcessingConfigurationDefines
          ),
          e.push(this._imageProcessingConfigurationDefines.toString()));
      }),
      (t.prototype.fillUniformsAttributesAndSamplerNames = function (e, i, n) {
        i.push.apply(
          i,
          t._GetAttributeNamesOrOptions(
            this._isAnimationSheetEnabled,
            this._isBillboardBased &&
              this.billboardMode !== t.BILLBOARDMODE_STRETCHED,
            this._useRampGradients
          )
        ),
          e.push.apply(
            e,
            t._GetEffectCreationOptions(this._isAnimationSheetEnabled)
          ),
          n.push("diffuseSampler", "rampSampler"),
          this._imageProcessingConfiguration &&
            (ti.PrepareUniforms(e, this._imageProcessingConfigurationDefines),
            ti.PrepareSamplers(n, this._imageProcessingConfigurationDefines));
      }),
      (t.prototype._getEffect = function (e) {
        var t = this.getCustomEffect(e);
        if (t) return t;
        var i = [];
        this.fillDefines(i, e);
        var n = i.join("\n");
        if (this._cachedDefines !== n) {
          this._cachedDefines = n;
          var r = [],
            o = [],
            s = [];
          this.fillUniformsAttributesAndSamplerNames(o, r, s),
            (this._effect = this._engine.createEffect("particles", r, o, s, n));
        }
        return this._effect;
      }),
      (t.prototype.animate = function (e) {
        var t,
          i = this;
        if ((void 0 === e && (e = !1), this._started)) {
          if (!e && this._scene) {
            if (!this.isReady()) return;
            if (this._currentRenderId === this._scene.getFrameId()) return;
            this._currentRenderId = this._scene.getFrameId();
          }
          var n;
          if (
            ((this._scaledUpdateSpeed =
              this.updateSpeed *
              (e
                ? this.preWarmStepOffset
                : (null === (t = this._scene) || void 0 === t
                    ? void 0
                    : t.getAnimationRatio()) || 1)),
            this.manualEmitCount > -1)
          )
            (n = this.manualEmitCount),
              (this._newPartsExcess = 0),
              (this.manualEmitCount = 0);
          else {
            var r = this.emitRate;
            if (
              this._emitRateGradients &&
              this._emitRateGradients.length > 0 &&
              this.targetStopDuration
            ) {
              var o = this._actualFrame / this.targetStopDuration;
              Mh.GetCurrentGradient(
                o,
                this._emitRateGradients,
                function (e, t, n) {
                  e !== i._currentEmitRateGradient &&
                    ((i._currentEmitRate1 = i._currentEmitRate2),
                    (i._currentEmitRate2 = t.getFactor()),
                    (i._currentEmitRateGradient = e)),
                    (r = s.Lerp(i._currentEmitRate1, i._currentEmitRate2, n));
                }
              );
            }
            (n = (r * this._scaledUpdateSpeed) >> 0),
              (this._newPartsExcess += r * this._scaledUpdateSpeed - n);
          }
          if (
            (this._newPartsExcess > 1 &&
              ((n += this._newPartsExcess >> 0),
              (this._newPartsExcess -= this._newPartsExcess >> 0)),
            (this._alive = !1),
            this._stopped
              ? (n = 0)
              : ((this._actualFrame += this._scaledUpdateSpeed),
                this.targetStopDuration &&
                  this._actualFrame >= this.targetStopDuration &&
                  this.stop()),
            this._update(n),
            this._stopped &&
              (this._alive ||
                ((this._started = !1),
                this.onAnimationEnd && this.onAnimationEnd(),
                this.disposeOnStop &&
                  this._scene &&
                  this._scene._toBeDisposed.push(this))),
            !e)
          ) {
            for (var a = 0, l = 0; l < this._particles.length; l++) {
              var c = this._particles[l];
              this._appendParticleVertices(a, c),
                (a += this._useInstancing ? 1 : 4);
            }
            this._vertexBuffer && this._vertexBuffer.update(this._vertexData);
          }
          0 === this.manualEmitCount && this.disposeOnStop && this.stop();
        }
      }),
      (t.prototype._appendParticleVertices = function (e, t) {
        this._appendParticleVertex(e++, t, 0, 0),
          this._useInstancing ||
            (this._appendParticleVertex(e++, t, 1, 0),
            this._appendParticleVertex(e++, t, 1, 1),
            this._appendParticleVertex(e++, t, 0, 1));
      }),
      (t.prototype.rebuild = function () {
        for (var e in (this._createIndexBuffer(),
        this._vertexBuffer && this._vertexBuffer._rebuild(),
        this._vertexBuffers))
          this._vertexBuffers[e]._rebuild();
      }),
      (t.prototype.isReady = function () {
        if (
          !this.emitter ||
          (this._imageProcessingConfiguration &&
            !this._imageProcessingConfiguration.isReady()) ||
          !this.particleTexture ||
          !this.particleTexture.isReady()
        )
          return !1;
        if (this.blendMode !== t.BLENDMODE_MULTIPLYADD) {
          if (!this._getEffect(this.blendMode).isReady()) return !1;
        } else {
          if (!this._getEffect(t.BLENDMODE_MULTIPLY).isReady()) return !1;
          if (!this._getEffect(t.BLENDMODE_ADD).isReady()) return !1;
        }
        return !0;
      }),
      (t.prototype._render = function (e) {
        var i,
          n,
          r = this._getEffect(e),
          o = this._engine;
        o.enableEffect(r);
        var s =
          null !== (i = this.defaultViewMatrix) && void 0 !== i
            ? i
            : this._scene.getViewMatrix();
        if (
          (r.setTexture("diffuseSampler", this.particleTexture),
          r.setMatrix("view", s),
          r.setMatrix(
            "projection",
            null !== (n = this.defaultProjectionMatrix) && void 0 !== n
              ? n
              : this._scene.getProjectionMatrix()
          ),
          this._isAnimationSheetEnabled && this.particleTexture)
        ) {
          var a = this.particleTexture.getBaseSize();
          r.setFloat3(
            "particlesInfos",
            this.spriteCellWidth / a.width,
            this.spriteCellHeight / a.height,
            this.spriteCellWidth / a.width
          );
        }
        if (
          (r.setVector2("translationPivot", this.translationPivot),
          r.setFloat4(
            "textureMask",
            this.textureMask.r,
            this.textureMask.g,
            this.textureMask.b,
            this.textureMask.a
          ),
          this._isBillboardBased && this._scene)
        ) {
          var l = this._scene.activeCamera;
          r.setVector3("eyePosition", l.globalPosition);
        }
        this._rampGradientsTexture &&
          ((this._rampGradients && this._rampGradients.length) ||
            (this._rampGradientsTexture.dispose(),
            (this._rampGradientsTexture = null)),
          r.setTexture("rampSampler", this._rampGradientsTexture));
        var c = r.defines;
        switch (
          (this._scene &&
            (this._scene.clipPlane ||
              this._scene.clipPlane2 ||
              this._scene.clipPlane3 ||
              this._scene.clipPlane4 ||
              this._scene.clipPlane5 ||
              this._scene.clipPlane6) &&
            Wr.BindClipPlane(r, this._scene),
          c.indexOf("#define BILLBOARDMODE_ALL") >= 0 &&
            (s.invertToRef(y.Matrix[0]), r.setMatrix("invView", y.Matrix[0])),
          void 0 !== this._vertexArrayObject
            ? (this._vertexArrayObject ||
                (this._vertexArrayObject = this._engine.recordVertexArrayObject(
                  this._vertexBuffers,
                  this._indexBuffer,
                  r
                )),
              this._engine.bindVertexArrayObject(
                this._vertexArrayObject,
                this._indexBuffer
              ))
            : o.bindBuffers(this._vertexBuffers, this._indexBuffer, r),
          this._imageProcessingConfiguration &&
            !this._imageProcessingConfiguration.applyByPostProcess &&
            this._imageProcessingConfiguration.bind(r),
          e)
        ) {
          case t.BLENDMODE_ADD:
            o.setAlphaMode(1);
            break;
          case t.BLENDMODE_ONEONE:
            o.setAlphaMode(6);
            break;
          case t.BLENDMODE_STANDARD:
            o.setAlphaMode(2);
            break;
          case t.BLENDMODE_MULTIPLY:
            o.setAlphaMode(4);
        }
        return (
          this._onBeforeDrawParticlesObservable &&
            this._onBeforeDrawParticlesObservable.notifyObservers(r),
          this._useInstancing
            ? o.drawArraysType(8, 0, 4, this._particles.length)
            : o.drawElementsType(0, 0, 6 * this._particles.length),
          this._particles.length
        );
      }),
      (t.prototype.render = function () {
        if (!this.isReady() || !this._particles.length) return 0;
        var e = this._engine;
        e.setState &&
          (e.setState(!1), this.forceDepthWrite && e.setDepthWrite(!0));
        var i;
        return (
          (i =
            this.blendMode === t.BLENDMODE_MULTIPLYADD
              ? this._render(t.BLENDMODE_MULTIPLY) +
                this._render(t.BLENDMODE_ADD)
              : this._render(this.blendMode)),
          this._engine.unbindInstanceAttributes(),
          this._engine.setAlphaMode(0),
          i
        );
      }),
      (t.prototype.dispose = function (e) {
        if (
          (void 0 === e && (e = !0),
          this._vertexBuffer &&
            (this._vertexBuffer.dispose(), (this._vertexBuffer = null)),
          this._spriteBuffer &&
            (this._spriteBuffer.dispose(), (this._spriteBuffer = null)),
          this._indexBuffer &&
            (this._engine._releaseBuffer(this._indexBuffer),
            (this._indexBuffer = null)),
          this._vertexArrayObject &&
            (this._engine.releaseVertexArrayObject(this._vertexArrayObject),
            (this._vertexArrayObject = null)),
          e &&
            this.particleTexture &&
            (this.particleTexture.dispose(), (this.particleTexture = null)),
          e &&
            this.noiseTexture &&
            (this.noiseTexture.dispose(), (this.noiseTexture = null)),
          this._rampGradientsTexture &&
            (this._rampGradientsTexture.dispose(),
            (this._rampGradientsTexture = null)),
          this._removeFromRoot(),
          this._subEmitters && this._subEmitters.length)
        ) {
          for (var t = 0; t < this._subEmitters.length; t++)
            for (var i = 0, n = this._subEmitters[t]; i < n.length; i++)
              n[i].dispose();
          (this._subEmitters = []), (this.subEmitters = []);
        }
        this._disposeEmitterOnDispose &&
          this.emitter &&
          this.emitter.dispose &&
          this.emitter.dispose(!0),
          this._onBeforeDrawParticlesObservable &&
            this._onBeforeDrawParticlesObservable.clear(),
          this._scene &&
            ((t = this._scene.particleSystems.indexOf(this)) > -1 &&
              this._scene.particleSystems.splice(t, 1),
            this._scene._activeParticleSystems.dispose()),
          this.onDisposeObservable.notifyObservers(this),
          this.onDisposeObservable.clear(),
          this.onStoppedObservable.clear(),
          this.reset();
      }),
      (t.prototype.clone = function (e, i) {
        var n = A({}, this._customEffect),
          r = null,
          o = this._engine;
        if (o.createEffectForParticles && null != this.customShader) {
          var s =
            (r = this.customShader).shaderOptions.defines.length > 0
              ? r.shaderOptions.defines.join("\n")
              : "";
          n[0] = o.createEffectForParticles(
            r.shaderPath.fragmentElement,
            r.shaderOptions.uniforms,
            r.shaderOptions.samplers,
            s
          );
        }
        var a = this.serialize(),
          l = t.Parse(a, this._scene || this._engine, "");
        return (
          (l.name = e),
          (l.customShader = r),
          (l._customEffect = n),
          void 0 === i && (i = this.emitter),
          this.noiseTexture && (l.noiseTexture = this.noiseTexture.clone()),
          (l.emitter = i),
          this.preventAutoStart || l.start(),
          l
        );
      }),
      (t.prototype.serialize = function (e) {
        void 0 === e && (e = !1);
        var i = {};
        if (
          (t._Serialize(i, this, e),
          (i.textureMask = this.textureMask.asArray()),
          (i.customShader = this.customShader),
          (i.preventAutoStart = this.preventAutoStart),
          this.subEmitters)
        ) {
          (i.subEmitters = []),
            this._subEmitters || this._prepareSubEmitterInternalArray();
          for (var n = 0, r = this._subEmitters; n < r.length; n++) {
            for (var o = [], s = 0, a = r[n]; s < a.length; s++) {
              var l = a[s];
              o.push(l.serialize());
            }
            i.subEmitters.push(o);
          }
        }
        return i;
      }),
      (t._Serialize = function (e, t, i) {
        if (
          ((e.name = t.name),
          (e.id = t.id),
          (e.capacity = t.getCapacity()),
          t.emitter.position)
        ) {
          var n = t.emitter;
          e.emitterId = n.id;
        } else {
          var r = t.emitter;
          e.emitter = r.asArray();
        }
        t.particleEmitterType &&
          (e.particleEmitterType = t.particleEmitterType.serialize()),
          t.particleTexture &&
            (i
              ? (e.texture = t.particleTexture.serialize())
              : ((e.textureName = t.particleTexture.name),
                (e.invertY = !!t.particleTexture._invertY))),
          (e.isLocal = t.isLocal),
          ge.AppendSerializedAnimations(t, e),
          (e.beginAnimationOnStart = t.beginAnimationOnStart),
          (e.beginAnimationFrom = t.beginAnimationFrom),
          (e.beginAnimationTo = t.beginAnimationTo),
          (e.beginAnimationLoop = t.beginAnimationLoop),
          (e.startDelay = t.startDelay),
          (e.renderingGroupId = t.renderingGroupId),
          (e.isBillboardBased = t.isBillboardBased),
          (e.billboardMode = t.billboardMode),
          (e.minAngularSpeed = t.minAngularSpeed),
          (e.maxAngularSpeed = t.maxAngularSpeed),
          (e.minSize = t.minSize),
          (e.maxSize = t.maxSize),
          (e.minScaleX = t.minScaleX),
          (e.maxScaleX = t.maxScaleX),
          (e.minScaleY = t.minScaleY),
          (e.maxScaleY = t.maxScaleY),
          (e.minEmitPower = t.minEmitPower),
          (e.maxEmitPower = t.maxEmitPower),
          (e.minLifeTime = t.minLifeTime),
          (e.maxLifeTime = t.maxLifeTime),
          (e.emitRate = t.emitRate),
          (e.gravity = t.gravity.asArray()),
          (e.noiseStrength = t.noiseStrength.asArray()),
          (e.color1 = t.color1.asArray()),
          (e.color2 = t.color2.asArray()),
          (e.colorDead = t.colorDead.asArray()),
          (e.updateSpeed = t.updateSpeed),
          (e.targetStopDuration = t.targetStopDuration),
          (e.blendMode = t.blendMode),
          (e.preWarmCycles = t.preWarmCycles),
          (e.preWarmStepOffset = t.preWarmStepOffset),
          (e.minInitialRotation = t.minInitialRotation),
          (e.maxInitialRotation = t.maxInitialRotation),
          (e.startSpriteCellID = t.startSpriteCellID),
          (e.endSpriteCellID = t.endSpriteCellID),
          (e.spriteCellChangeSpeed = t.spriteCellChangeSpeed),
          (e.spriteCellWidth = t.spriteCellWidth),
          (e.spriteCellHeight = t.spriteCellHeight),
          (e.spriteRandomStartCell = t.spriteRandomStartCell),
          (e.isAnimationSheetEnabled = t.isAnimationSheetEnabled);
        var o = t.getColorGradients();
        if (o) {
          e.colorGradients = [];
          for (var s = 0, a = o; s < a.length; s++) {
            var l = a[s],
              c = {
                gradient: l.gradient,
                color1: l.color1.asArray(),
              };
            l.color2
              ? (c.color2 = l.color2.asArray())
              : (c.color2 = l.color1.asArray()),
              e.colorGradients.push(c);
          }
        }
        var u = t.getRampGradients();
        if (u) {
          e.rampGradients = [];
          for (var h = 0, d = u; h < d.length; h++) {
            var p = d[h];
            (c = {
              gradient: p.gradient,
              color: p.color.asArray(),
            }),
              e.rampGradients.push(c);
          }
          e.useRampGradients = t.useRampGradients;
        }
        var f = t.getColorRemapGradients();
        if (f) {
          e.colorRemapGradients = [];
          for (var _ = 0, m = f; _ < m.length; _++) {
            var g = m[_];
            (c = {
              gradient: g.gradient,
              factor1: g.factor1,
            }),
              void 0 !== g.factor2
                ? (c.factor2 = g.factor2)
                : (c.factor2 = g.factor1),
              e.colorRemapGradients.push(c);
          }
        }
        var v = t.getAlphaRemapGradients();
        if (v) {
          e.alphaRemapGradients = [];
          for (var y = 0, b = v; y < b.length; y++) {
            var T = b[y];
            (c = {
              gradient: T.gradient,
              factor1: T.factor1,
            }),
              void 0 !== T.factor2
                ? (c.factor2 = T.factor2)
                : (c.factor2 = T.factor1),
              e.alphaRemapGradients.push(c);
          }
        }
        var S = t.getSizeGradients();
        if (S) {
          e.sizeGradients = [];
          for (var C = 0, x = S; C < x.length; C++) {
            var E = x[C];
            (c = {
              gradient: E.gradient,
              factor1: E.factor1,
            }),
              void 0 !== E.factor2
                ? (c.factor2 = E.factor2)
                : (c.factor2 = E.factor1),
              e.sizeGradients.push(c);
          }
        }
        var P = t.getAngularSpeedGradients();
        if (P) {
          e.angularSpeedGradients = [];
          for (var A = 0, R = P; A < R.length; A++) {
            var M = R[A];
            (c = {
              gradient: M.gradient,
              factor1: M.factor1,
            }),
              void 0 !== M.factor2
                ? (c.factor2 = M.factor2)
                : (c.factor2 = M.factor1),
              e.angularSpeedGradients.push(c);
          }
        }
        var O = t.getVelocityGradients();
        if (O) {
          e.velocityGradients = [];
          for (var I = 0, D = O; I < D.length; I++) {
            var w = D[I];
            (c = {
              gradient: w.gradient,
              factor1: w.factor1,
            }),
              void 0 !== w.factor2
                ? (c.factor2 = w.factor2)
                : (c.factor2 = w.factor1),
              e.velocityGradients.push(c);
          }
        }
        var N = t.getDragGradients();
        if (N) {
          e.dragGradients = [];
          for (var L = 0, F = N; L < F.length; L++) {
            var B = F[L];
            (c = {
              gradient: B.gradient,
              factor1: B.factor1,
            }),
              void 0 !== B.factor2
                ? (c.factor2 = B.factor2)
                : (c.factor2 = B.factor1),
              e.dragGradients.push(c);
          }
        }
        var V = t.getEmitRateGradients();
        if (V) {
          e.emitRateGradients = [];
          for (var k = 0, U = V; k < U.length; k++) {
            var z = U[k];
            (c = {
              gradient: z.gradient,
              factor1: z.factor1,
            }),
              void 0 !== z.factor2
                ? (c.factor2 = z.factor2)
                : (c.factor2 = z.factor1),
              e.emitRateGradients.push(c);
          }
        }
        var G = t.getStartSizeGradients();
        if (G) {
          e.startSizeGradients = [];
          for (var W = 0, H = G; W < H.length; W++) {
            var j = H[W];
            (c = {
              gradient: j.gradient,
              factor1: j.factor1,
            }),
              void 0 !== j.factor2
                ? (c.factor2 = j.factor2)
                : (c.factor2 = j.factor1),
              e.startSizeGradients.push(c);
          }
        }
        var X = t.getLifeTimeGradients();
        if (X) {
          e.lifeTimeGradients = [];
          for (var Y = 0, K = X; Y < K.length; Y++) {
            var Q = K[Y];
            (c = {
              gradient: Q.gradient,
              factor1: Q.factor1,
            }),
              void 0 !== Q.factor2
                ? (c.factor2 = Q.factor2)
                : (c.factor2 = Q.factor1),
              e.lifeTimeGradients.push(c);
          }
        }
        var q = t.getLimitVelocityGradients();
        if (q) {
          e.limitVelocityGradients = [];
          for (var Z = 0, J = q; Z < J.length; Z++) {
            var $ = J[Z];
            (c = {
              gradient: $.gradient,
              factor1: $.factor1,
            }),
              void 0 !== $.factor2
                ? (c.factor2 = $.factor2)
                : (c.factor2 = $.factor1),
              e.limitVelocityGradients.push(c);
          }
          e.limitVelocityDamping = t.limitVelocityDamping;
        }
        t.noiseTexture && (e.noiseTexture = t.noiseTexture.serialize());
      }),
      (t._Parse = function (e, t, i, n) {
        var r;
        r = i instanceof lt ? null : i;
        var o,
          s = h.GetClass("BABYLON.Texture");
        if (
          (s &&
            r &&
            (e.texture
              ? (t.particleTexture = s.Parse(e.texture, r, n))
              : e.textureName &&
                ((t.particleTexture = new s(
                  n + e.textureName,
                  r,
                  !1,
                  void 0 === e.invertY || e.invertY
                )),
                (t.particleTexture.name = e.textureName))),
          e.emitterId || 0 === e.emitterId || void 0 !== e.emitter
            ? e.emitterId && r
              ? (t.emitter = r.getLastMeshByID(e.emitterId))
              : (t.emitter = f.FromArray(e.emitter))
            : (t.emitter = f.Zero()),
          (t.isLocal = !!e.isLocal),
          void 0 !== e.renderingGroupId &&
            (t.renderingGroupId = e.renderingGroupId),
          void 0 !== e.isBillboardBased &&
            (t.isBillboardBased = e.isBillboardBased),
          void 0 !== e.billboardMode && (t.billboardMode = e.billboardMode),
          e.animations)
        ) {
          for (var a = 0; a < e.animations.length; a++) {
            var l = e.animations[a],
              c = h.GetClass("BABYLON.Animation");
            c && t.animations.push(c.Parse(l));
          }
          (t.beginAnimationOnStart = e.beginAnimationOnStart),
            (t.beginAnimationFrom = e.beginAnimationFrom),
            (t.beginAnimationTo = e.beginAnimationTo),
            (t.beginAnimationLoop = e.beginAnimationLoop);
        }
        if (
          (e.autoAnimate &&
            r &&
            r.beginAnimation(
              t,
              e.autoAnimateFrom,
              e.autoAnimateTo,
              e.autoAnimateLoop,
              e.autoAnimateSpeed || 1
            ),
          (t.startDelay = 0 | e.startDelay),
          (t.minAngularSpeed = e.minAngularSpeed),
          (t.maxAngularSpeed = e.maxAngularSpeed),
          (t.minSize = e.minSize),
          (t.maxSize = e.maxSize),
          e.minScaleX &&
            ((t.minScaleX = e.minScaleX),
            (t.maxScaleX = e.maxScaleX),
            (t.minScaleY = e.minScaleY),
            (t.maxScaleY = e.maxScaleY)),
          void 0 !== e.preWarmCycles &&
            ((t.preWarmCycles = e.preWarmCycles),
            (t.preWarmStepOffset = e.preWarmStepOffset)),
          void 0 !== e.minInitialRotation &&
            ((t.minInitialRotation = e.minInitialRotation),
            (t.maxInitialRotation = e.maxInitialRotation)),
          (t.minLifeTime = e.minLifeTime),
          (t.maxLifeTime = e.maxLifeTime),
          (t.minEmitPower = e.minEmitPower),
          (t.maxEmitPower = e.maxEmitPower),
          (t.emitRate = e.emitRate),
          (t.gravity = f.FromArray(e.gravity)),
          e.noiseStrength && (t.noiseStrength = f.FromArray(e.noiseStrength)),
          (t.color1 = T.FromArray(e.color1)),
          (t.color2 = T.FromArray(e.color2)),
          (t.colorDead = T.FromArray(e.colorDead)),
          (t.updateSpeed = e.updateSpeed),
          (t.targetStopDuration = e.targetStopDuration),
          (t.blendMode = e.blendMode),
          e.colorGradients)
        )
          for (var u = 0, d = e.colorGradients; u < d.length; u++) {
            var p = d[u];
            t.addColorGradient(
              p.gradient,
              T.FromArray(p.color1),
              p.color2 ? T.FromArray(p.color2) : void 0
            );
          }
        if (e.rampGradients) {
          for (var _ = 0, m = e.rampGradients; _ < m.length; _++) {
            var g = m[_];
            t.addRampGradient(g.gradient, b.FromArray(g.color));
          }
          t.useRampGradients = e.useRampGradients;
        }
        if (e.colorRemapGradients)
          for (var v = 0, y = e.colorRemapGradients; v < y.length; v++) {
            var S = y[v];
            t.addColorRemapGradient(
              S.gradient,
              void 0 !== S.factor1 ? S.factor1 : S.factor,
              S.factor2
            );
          }
        if (e.alphaRemapGradients)
          for (var C = 0, x = e.alphaRemapGradients; C < x.length; C++) {
            var E = x[C];
            t.addAlphaRemapGradient(
              E.gradient,
              void 0 !== E.factor1 ? E.factor1 : E.factor,
              E.factor2
            );
          }
        if (e.sizeGradients)
          for (var P = 0, A = e.sizeGradients; P < A.length; P++) {
            var R = A[P];
            t.addSizeGradient(
              R.gradient,
              void 0 !== R.factor1 ? R.factor1 : R.factor,
              R.factor2
            );
          }
        if (e.angularSpeedGradients)
          for (var M = 0, O = e.angularSpeedGradients; M < O.length; M++) {
            var I = O[M];
            t.addAngularSpeedGradient(
              I.gradient,
              void 0 !== I.factor1 ? I.factor1 : I.factor,
              I.factor2
            );
          }
        if (e.velocityGradients)
          for (var D = 0, w = e.velocityGradients; D < w.length; D++) {
            var N = w[D];
            t.addVelocityGradient(
              N.gradient,
              void 0 !== N.factor1 ? N.factor1 : N.factor,
              N.factor2
            );
          }
        if (e.dragGradients)
          for (var L = 0, F = e.dragGradients; L < F.length; L++) {
            var B = F[L];
            t.addDragGradient(
              B.gradient,
              void 0 !== B.factor1 ? B.factor1 : B.factor,
              B.factor2
            );
          }
        if (e.emitRateGradients)
          for (var V = 0, k = e.emitRateGradients; V < k.length; V++) {
            var U = k[V];
            t.addEmitRateGradient(
              U.gradient,
              void 0 !== U.factor1 ? U.factor1 : U.factor,
              U.factor2
            );
          }
        if (e.startSizeGradients)
          for (var z = 0, G = e.startSizeGradients; z < G.length; z++) {
            var W = G[z];
            t.addStartSizeGradient(
              W.gradient,
              void 0 !== W.factor1 ? W.factor1 : W.factor,
              W.factor2
            );
          }
        if (e.lifeTimeGradients)
          for (var H = 0, j = e.lifeTimeGradients; H < j.length; H++) {
            var X = j[H];
            t.addLifeTimeGradient(
              X.gradient,
              void 0 !== X.factor1 ? X.factor1 : X.factor,
              X.factor2
            );
          }
        if (e.limitVelocityGradients) {
          for (var Y = 0, K = e.limitVelocityGradients; Y < K.length; Y++) {
            var Q = K[Y];
            t.addLimitVelocityGradient(
              Q.gradient,
              void 0 !== Q.factor1 ? Q.factor1 : Q.factor,
              Q.factor2
            );
          }
          t.limitVelocityDamping = e.limitVelocityDamping;
        }
        if (e.noiseTexture && r) {
          var q = h.GetClass("BABYLON.ProceduralTexture");
          t.noiseTexture = q.Parse(e.noiseTexture, r, n);
        }
        if (e.particleEmitterType) {
          switch (e.particleEmitterType.type) {
            case "SphereParticleEmitter":
              o = new Ec();
              break;
            case "SphereDirectedParticleEmitter":
              o = new Pc();
              break;
            case "ConeEmitter":
            case "ConeParticleEmitter":
              o = new bc();
              break;
            case "CylinderParticleEmitter":
              o = new Tc();
              break;
            case "CylinderDirectedParticleEmitter":
              o = new Sc();
              break;
            case "HemisphericParticleEmitter":
              o = new Cc();
              break;
            case "PointParticleEmitter":
              o = new xc();
              break;
            case "MeshParticleEmitter":
              o = new Rc();
              break;
            case "BoxEmitter":
            case "BoxParticleEmitter":
            default:
              o = new yc();
          }
          o.parse(e.particleEmitterType, r);
        } else (o = new yc()).parse(e, r);
        (t.particleEmitterType = o),
          (t.startSpriteCellID = e.startSpriteCellID),
          (t.endSpriteCellID = e.endSpriteCellID),
          (t.spriteCellWidth = e.spriteCellWidth),
          (t.spriteCellHeight = e.spriteCellHeight),
          (t.spriteCellChangeSpeed = e.spriteCellChangeSpeed),
          (t.spriteRandomStartCell = e.spriteRandomStartCell);
      }),
      (t.Parse = function (e, i, n, r) {
        void 0 === r && (r = !1);
        var o,
          s = e.name,
          a = null,
          l = null;
        if (
          ((o = i instanceof lt ? i : i.getEngine()),
          e.customShader && o.createEffectForParticles)
        ) {
          var c =
            (l = e.customShader).shaderOptions.defines.length > 0
              ? l.shaderOptions.defines.join("\n")
              : "";
          a = o.createEffectForParticles(
            l.shaderPath.fragmentElement,
            l.shaderOptions.uniforms,
            l.shaderOptions.samplers,
            c
          );
        }
        var u = new t(s, e.capacity, i, a, e.isAnimationSheetEnabled);
        if (((u.customShader = l), e.id && (u.id = e.id), e.subEmitters)) {
          u.subEmitters = [];
          for (var h = 0, d = e.subEmitters; h < d.length; h++) {
            for (var p = [], f = 0, _ = d[h]; f < _.length; f++) {
              var m = _[f];
              p.push(Ih.Parse(m, i, n));
            }
            u.subEmitters.push(p);
          }
        }
        return (
          t._Parse(e, u, i, n),
          e.textureMask && (u.textureMask = T.FromArray(e.textureMask)),
          e.preventAutoStart && (u.preventAutoStart = e.preventAutoStart),
          r || u.preventAutoStart || u.start(),
          u
        );
      }),
      (t.BILLBOARDMODE_Y = 2),
      (t.BILLBOARDMODE_ALL = 7),
      (t.BILLBOARDMODE_STRETCHED = 8),
      t
    );
  })(Mc);
  Ih._ParseParticleSystem = Dh.Parse;
  Ke.ShadersStore.gpuUpdateParticlesPixelShader =
    "#version 300 es\nvoid main() {\ndiscard;\n}\n";
  Ke.ShadersStore.gpuUpdateParticlesVertexShader =
    "#version 300 es\n#define PI 3.14159\nuniform float currentCount;\nuniform float timeDelta;\nuniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;\nuniform vec2 emitPower;\nuniform vec2 sizeRange;\nuniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;\nuniform vec4 color2;\n#endif\nuniform vec3 gravity;\nuniform sampler2D randomSampler;\nuniform sampler2D randomSampler2;\nuniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\nuniform vec3 minEmitBox;\nuniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;\nuniform float radiusRange;\nuniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;\nuniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;\nuniform float height;\nuniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;\nuniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;\nuniform float coneAngle;\nuniform vec2 height;\nuniform float directionRandomizer;\n#endif\n\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;\nin float life;\nin vec4 seed;\nin vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;\nin vec3 noiseCoordinates2;\n#endif\n\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;\nout float outLife;\nout vec4 outSeed;\nout vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;\nout vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif\n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;\nuniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;\nuniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {\nreturn texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;\n}\nvec4 getRandomVec4(float offset) {\nreturn texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));\n}\nvoid main() {\nfloat newAge=age+timeDelta;\n\nif (newAge>=life && stopFactor != 0.) {\nvec3 newPosition;\nvec3 newDirection;\n\nvec4 randoms=getRandomVec4(seed.x);\n\noutLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;\noutAge=newAge-life;\n\noutSeed=seed;\n\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;\noutSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a;\n#ifndef COLORGRADIENTS\n\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n\n#ifndef ANGULARSPEEDGRADIENTS\noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;\noutAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif\n\n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nnewPosition=vec3(0,0,0);\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\nnewPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nnewPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);\nnewDirection=newPosition+directionRandomizer*randoms3;\n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat phi=2.0*PI*randoms2.x;\nfloat theta=acos(2.0*randoms2.y-1.0);\nfloat randX=cos(phi)*sin(theta);\nfloat randY=cos(theta);\nfloat randZ=sin(phi)*sin(theta);\nnewPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\n\nnewDirection=newPosition+directionRandomizer*randoms3;\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nvec3 randoms3=getRandomVec3(seed.z);\n\nfloat yPos=(randoms2.x-0.5)*height;\nfloat angle=randoms2.y*PI*2.;\nfloat inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));\nfloat positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));\nfloat xPos=positionRadius*cos(angle);\nfloat zPos=positionRadius*sin(angle);\nnewPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\n\nangle=angle+((randoms3.x-0.5)*PI);\nnewDirection=vec3(cos(angle),randoms3.y-0.5,sin(angle));\nnewDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);\nfloat s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;\n\nh=1.-h*h;\n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;\nlRadius=lRadius*h;\nfloat randX=lRadius*sin(s);\nfloat randZ=lRadius*cos(s);\nfloat randY=h*height.x;\nnewPosition=vec3(randX,randY,randZ);\n\nif (abs(cos(coneAngle)) == 1.0) {\nnewDirection=vec3(0.,1.0,0.);\n} else {\nvec3 randoms3=getRandomVec3(seed.z);\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n}\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;\noutInitialPosition=initialPosition;\n#else\n\nnewPosition=vec3(0.,0.,0.);\n\nnewDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD\noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else\nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD\noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET\noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif\n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {\nfloat directionScale=timeDelta;\noutAge=newAge;\nfloat ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient;\noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;\noutSeed=seed;\n#ifndef COLORGRADIENTS\noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;\noutSize.yz=size.yz;\n#else\noutSize=size;\n#endif\n#ifndef BILLBOARD\noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;\nfloat currentVelocity=length(updatedDirection);\nif (currentVelocity>limitVelocity) {\nupdatedDirection=updatedDirection*limitVelocityDamping;\n}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;\nfloat fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;\nvec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;\noutDirection=outDirection+force*timeDelta;\noutNoiseCoordinates1=noiseCoordinates1;\noutNoiseCoordinates2=noiseCoordinates2;\n#endif\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;\noutAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET\nfloat offsetAge=outAge;\nfloat dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;\noffsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif\nfloat ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}\n}";
  Ke.IncludesShadersStore.clipPlaneFragmentDeclaration2 =
    "#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif";
  Ke.ShadersStore.gpuRenderParticlesPixelShader =
    "#version 300 es\nuniform sampler2D diffuseSampler;\nin vec2 vUV;\nin vec4 vColor;\nout vec4 outFragColor;\n#include<clipPlaneFragmentDeclaration2>\n#include<imageProcessingDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\nvoid main() {\n#include<clipPlaneFragment>\nvec4 textureColor=texture(diffuseSampler,vUV);\noutFragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;\noutFragColor.rgb=outFragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\noutFragColor.rgb=toLinearSpace(outFragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\noutFragColor.rgb=toLinearSpace(outFragColor.rgb);\noutFragColor=applyImageProcessing(outFragColor);\n#endif\n#endif\n}\n";
  Ke.IncludesShadersStore.clipPlaneVertexDeclaration2 =
    "#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nout float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nout float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nout float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nout float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nout float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nout float fClipDistance6;\n#endif";
  Ke.ShadersStore.gpuRenderParticlesVertexShader =
    "#version 300 es\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec2 translationPivot;\nuniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\n\nin vec3 position;\nin float age;\nin float life;\nin vec3 size;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nin vec3 direction;\n#endif\nin float angle;\n#ifdef ANIMATESHEET\nin float cellIndex;\n#endif\nin vec2 offset;\nin vec2 uv;\nout vec2 vUV;\nout vec4 vColor;\nout vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;\nin vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {\nvec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));\nvec3 zaxis=normalize(cross(yaxis,xaxis));\nvec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);\nvec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);\nvec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {\nvec3 normalizedToCamera=normalize(toCamera);\nvec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));\nvec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);\nvec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\nvec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\nmat3 rotMatrix=mat3(row0,row1,row2);\nvec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);\nfloat columnOffset=cellIndex-rowOffset*sheetInfos.z;\nvec2 uvScale=sheetInfos.xy;\nvec2 uvOffset=vec2(uv.x ,1.0-uv.y);\nvUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=age/life;\n#ifdef COLORGRADIENTS\nvColor=texture(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x+translationPivot;\n#ifdef BILLBOARD\nvec4 rotatedCorner;\nrotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.y=0.;\nvec3 yaxis=(position+worldOffset)-eyePosition;\nyaxis.y=0.;\nvPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\nvec3 toCamera=(position+worldOffset)-eyePosition;\nvPositionW=rotateAlign(toCamera,rotatedCorner.xyz);\nvec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\n\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=0.;\nrotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nvec3 yaxis=normalize(initialDirection);\nvPositionW=rotate(yaxis,rotatedCorner);\n\nvec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n}";
  var wh = (function (e) {
      function t(t, i, n, r, s) {
        void 0 === r && (r = !1), void 0 === s && (s = null);
        var a = e.call(this, t) || this;
        (a.layerMask = 268435455),
          (a._accumulatedCount = 0),
          (a._targetIndex = 0),
          (a._currentRenderId = -1),
          (a._started = !1),
          (a._stopped = !1),
          (a._timeDelta = 0),
          (a._actualFrame = 0),
          (a._rawTextureWidth = 256),
          (a.onDisposeObservable = new o()),
          (a.onStoppedObservable = new o()),
          (a.forceDepthWrite = !1),
          (a._preWarmDone = !1),
          (a.isLocal = !1),
          (a._onBeforeDrawParticlesObservable = null),
          n && "Scene" !== n.getClassName()
            ? ((a._engine = n),
              (a.defaultProjectionMatrix = g.PerspectiveFovLH(
                0.8,
                1,
                0.1,
                100
              )))
            : ((a._scene = n || j.LastCreatedScene),
              (a._engine = a._scene.getEngine()),
              (a.uniqueId = a._scene.getUniqueId()),
              a._scene.particleSystems.push(a)),
          (a._customEffect = {
            0: s,
          }),
          a._attachImageProcessingConfiguration(null),
          i.randomTextureSize || delete i.randomTextureSize;
        var l = A(
            {
              capacity: 5e4,
              randomTextureSize: a._engine.getCaps().maxTextureSize,
            },
            i
          ),
          c = i;
        isFinite(c) && (l.capacity = c),
          (a._capacity = l.capacity),
          (a._activeCount = l.capacity),
          (a._currentActiveCount = 0),
          (a._isAnimationSheetEnabled = r),
          (a._updateEffectOptions = {
            attributes: [
              "position",
              "initialPosition",
              "age",
              "life",
              "seed",
              "size",
              "color",
              "direction",
              "initialDirection",
              "angle",
              "cellIndex",
              "cellStartOffset",
              "noiseCoordinates1",
              "noiseCoordinates2",
            ],
            uniformsNames: [
              "currentCount",
              "timeDelta",
              "emitterWM",
              "lifeTime",
              "color1",
              "color2",
              "sizeRange",
              "scaleRange",
              "gravity",
              "emitPower",
              "direction1",
              "direction2",
              "minEmitBox",
              "maxEmitBox",
              "radius",
              "directionRandomizer",
              "height",
              "coneAngle",
              "stopFactor",
              "angleRange",
              "radiusRange",
              "cellInfos",
              "noiseStrength",
              "limitVelocityDamping",
            ],
            uniformBuffersNames: [],
            samplers: [
              "randomSampler",
              "randomSampler2",
              "sizeGradientSampler",
              "angularSpeedGradientSampler",
              "velocityGradientSampler",
              "limitVelocityGradientSampler",
              "noiseSampler",
              "dragGradientSampler",
            ],
            defines: "",
            fallbacks: null,
            onCompiled: null,
            onError: null,
            indexParameters: null,
            maxSimultaneousLights: 0,
            transformFeedbackVaryings: [],
          }),
          (a.particleEmitterType = new yc());
        for (
          var u = Math.min(
              a._engine.getCaps().maxTextureSize,
              l.randomTextureSize
            ),
            h = [],
            d = 0;
          d < u;
          ++d
        )
          h.push(Math.random()),
            h.push(Math.random()),
            h.push(Math.random()),
            h.push(Math.random());
        for (
          a._randomTexture = new bn(
            new Float32Array(h),
            u,
            1,
            5,
            n,
            !1,
            !1,
            1,
            1
          ),
            a._randomTexture.wrapU = 1,
            a._randomTexture.wrapV = 1,
            h = [],
            d = 0;
          d < u;
          ++d
        )
          h.push(Math.random()),
            h.push(Math.random()),
            h.push(Math.random()),
            h.push(Math.random());
        return (
          (a._randomTexture2 = new bn(
            new Float32Array(h),
            u,
            1,
            5,
            n,
            !1,
            !1,
            1,
            1
          )),
          (a._randomTexture2.wrapU = 1),
          (a._randomTexture2.wrapV = 1),
          (a._randomTextureSize = u),
          a
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t, "IsSupported", {
          get: function () {
            return (
              !!j.LastCreatedEngine && j.LastCreatedEngine.webGLVersion > 1
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getCapacity = function () {
          return this._capacity;
        }),
        Object.defineProperty(t.prototype, "activeParticleCount", {
          get: function () {
            return this._activeCount;
          },
          set: function (e) {
            this._activeCount = Math.min(e, this._capacity);
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.isReady = function () {
          return this._updateEffect
            ? !!(
                this.emitter &&
                this._updateEffect.isReady() &&
                (!this._imageProcessingConfiguration ||
                  this._imageProcessingConfiguration.isReady()) &&
                this._getEffect().isReady() &&
                this.particleTexture &&
                this.particleTexture.isReady()
              )
            : (this._recreateUpdateEffect(), this._recreateRenderEffect(), !1);
        }),
        (t.prototype.isStarted = function () {
          return this._started;
        }),
        (t.prototype.isStopped = function () {
          return this._stopped;
        }),
        (t.prototype.isStopping = function () {
          return !1;
        }),
        (t.prototype.getActiveCount = function () {
          return this._currentActiveCount;
        }),
        (t.prototype.start = function (e) {
          var t = this;
          if (
            (void 0 === e && (e = this.startDelay),
            !this.targetStopDuration &&
              this._hasTargetStopDurationDependantGradient())
          )
            throw "Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";
          e
            ? setTimeout(function () {
                t.start(0);
              }, e)
            : ((this._started = !0),
              (this._stopped = !1),
              (this._preWarmDone = !1),
              this.beginAnimationOnStart &&
                this.animations &&
                this.animations.length > 0 &&
                this._scene &&
                this._scene.beginAnimation(
                  this,
                  this.beginAnimationFrom,
                  this.beginAnimationTo,
                  this.beginAnimationLoop
                ));
        }),
        (t.prototype.stop = function () {
          this._stopped || (this._stopped = !0);
        }),
        (t.prototype.reset = function () {
          this._releaseBuffers(),
            this._releaseVAOs(),
            (this._currentActiveCount = 0),
            (this._targetIndex = 0);
        }),
        (t.prototype.getClassName = function () {
          return "GPUParticleSystem";
        }),
        (t.prototype.getCustomEffect = function (e) {
          var t;
          return (
            void 0 === e && (e = 0),
            null !== (t = this._customEffect[e]) && void 0 !== t
              ? t
              : this._customEffect[0]
          );
        }),
        (t.prototype.setCustomEffect = function (e, t) {
          void 0 === t && (t = 0), (this._customEffect[t] = e);
        }),
        Object.defineProperty(t.prototype, "onBeforeDrawParticlesObservable", {
          get: function () {
            return (
              this._onBeforeDrawParticlesObservable ||
                (this._onBeforeDrawParticlesObservable = new o()),
              this._onBeforeDrawParticlesObservable
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "vertexShaderName", {
          get: function () {
            return "gpuRenderParticles";
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._removeGradientAndTexture = function (t, i, n) {
          return (
            e.prototype._removeGradientAndTexture.call(this, t, i, n),
            this._releaseBuffers(),
            this
          );
        }),
        (t.prototype.addColorGradient = function (e, t, i) {
          this._colorGradients || (this._colorGradients = []);
          var n = new Ph(e, t);
          return (
            this._colorGradients.push(n),
            this._refreshColorGradient(!0),
            this._releaseBuffers(),
            this
          );
        }),
        (t.prototype._refreshColorGradient = function (e) {
          void 0 === e && (e = !1),
            this._colorGradients &&
              (e &&
                this._colorGradients.sort(function (e, t) {
                  return e.gradient < t.gradient
                    ? -1
                    : e.gradient > t.gradient
                      ? 1
                      : 0;
                }),
              this._colorGradientsTexture &&
                (this._colorGradientsTexture.dispose(),
                (this._colorGradientsTexture = null)));
        }),
        (t.prototype.forceRefreshGradients = function () {
          this._refreshColorGradient(),
            this._refreshFactorGradient(
              this._sizeGradients,
              "_sizeGradientsTexture"
            ),
            this._refreshFactorGradient(
              this._angularSpeedGradients,
              "_angularSpeedGradientsTexture"
            ),
            this._refreshFactorGradient(
              this._velocityGradients,
              "_velocityGradientsTexture"
            ),
            this._refreshFactorGradient(
              this._limitVelocityGradients,
              "_limitVelocityGradientsTexture"
            ),
            this._refreshFactorGradient(
              this._dragGradients,
              "_dragGradientsTexture"
            ),
            this.reset();
        }),
        (t.prototype.removeColorGradient = function (e) {
          return (
            this._removeGradientAndTexture(
              e,
              this._colorGradients,
              this._colorGradientsTexture
            ),
            (this._colorGradientsTexture = null),
            this
          );
        }),
        (t.prototype._addFactorGradient = function (e, t, i) {
          var n = new Rh(t, i);
          e.push(n), this._releaseBuffers();
        }),
        (t.prototype.addSizeGradient = function (e, t) {
          return (
            this._sizeGradients || (this._sizeGradients = []),
            this._addFactorGradient(this._sizeGradients, e, t),
            this._refreshFactorGradient(
              this._sizeGradients,
              "_sizeGradientsTexture",
              !0
            ),
            this._releaseBuffers(),
            this
          );
        }),
        (t.prototype.removeSizeGradient = function (e) {
          return (
            this._removeGradientAndTexture(
              e,
              this._sizeGradients,
              this._sizeGradientsTexture
            ),
            (this._sizeGradientsTexture = null),
            this
          );
        }),
        (t.prototype._refreshFactorGradient = function (e, t, i) {
          if ((void 0 === i && (i = !1), e)) {
            i &&
              e.sort(function (e, t) {
                return e.gradient < t.gradient
                  ? -1
                  : e.gradient > t.gradient
                    ? 1
                    : 0;
              });
            var n = this;
            n[t] && (n[t].dispose(), (n[t] = null));
          }
        }),
        (t.prototype.addAngularSpeedGradient = function (e, t) {
          return (
            this._angularSpeedGradients || (this._angularSpeedGradients = []),
            this._addFactorGradient(this._angularSpeedGradients, e, t),
            this._refreshFactorGradient(
              this._angularSpeedGradients,
              "_angularSpeedGradientsTexture",
              !0
            ),
            this._releaseBuffers(),
            this
          );
        }),
        (t.prototype.removeAngularSpeedGradient = function (e) {
          return (
            this._removeGradientAndTexture(
              e,
              this._angularSpeedGradients,
              this._angularSpeedGradientsTexture
            ),
            (this._angularSpeedGradientsTexture = null),
            this
          );
        }),
        (t.prototype.addVelocityGradient = function (e, t) {
          return (
            this._velocityGradients || (this._velocityGradients = []),
            this._addFactorGradient(this._velocityGradients, e, t),
            this._refreshFactorGradient(
              this._velocityGradients,
              "_velocityGradientsTexture",
              !0
            ),
            this._releaseBuffers(),
            this
          );
        }),
        (t.prototype.removeVelocityGradient = function (e) {
          return (
            this._removeGradientAndTexture(
              e,
              this._velocityGradients,
              this._velocityGradientsTexture
            ),
            (this._velocityGradientsTexture = null),
            this
          );
        }),
        (t.prototype.addLimitVelocityGradient = function (e, t) {
          return (
            this._limitVelocityGradients || (this._limitVelocityGradients = []),
            this._addFactorGradient(this._limitVelocityGradients, e, t),
            this._refreshFactorGradient(
              this._limitVelocityGradients,
              "_limitVelocityGradientsTexture",
              !0
            ),
            this._releaseBuffers(),
            this
          );
        }),
        (t.prototype.removeLimitVelocityGradient = function (e) {
          return (
            this._removeGradientAndTexture(
              e,
              this._limitVelocityGradients,
              this._limitVelocityGradientsTexture
            ),
            (this._limitVelocityGradientsTexture = null),
            this
          );
        }),
        (t.prototype.addDragGradient = function (e, t) {
          return (
            this._dragGradients || (this._dragGradients = []),
            this._addFactorGradient(this._dragGradients, e, t),
            this._refreshFactorGradient(
              this._dragGradients,
              "_dragGradientsTexture",
              !0
            ),
            this._releaseBuffers(),
            this
          );
        }),
        (t.prototype.removeDragGradient = function (e) {
          return (
            this._removeGradientAndTexture(
              e,
              this._dragGradients,
              this._dragGradientsTexture
            ),
            (this._dragGradientsTexture = null),
            this
          );
        }),
        (t.prototype.addEmitRateGradient = function (e, t, i) {
          return this;
        }),
        (t.prototype.removeEmitRateGradient = function (e) {
          return this;
        }),
        (t.prototype.addStartSizeGradient = function (e, t, i) {
          return this;
        }),
        (t.prototype.removeStartSizeGradient = function (e) {
          return this;
        }),
        (t.prototype.addColorRemapGradient = function (e, t, i) {
          return this;
        }),
        (t.prototype.removeColorRemapGradient = function () {
          return this;
        }),
        (t.prototype.addAlphaRemapGradient = function (e, t, i) {
          return this;
        }),
        (t.prototype.removeAlphaRemapGradient = function () {
          return this;
        }),
        (t.prototype.addRampGradient = function (e, t) {
          return this;
        }),
        (t.prototype.removeRampGradient = function () {
          return this;
        }),
        (t.prototype.getRampGradients = function () {
          return null;
        }),
        Object.defineProperty(t.prototype, "useRampGradients", {
          get: function () {
            return !1;
          },
          set: function (e) {},
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.addLifeTimeGradient = function (e, t, i) {
          return this;
        }),
        (t.prototype.removeLifeTimeGradient = function (e) {
          return this;
        }),
        (t.prototype._reset = function () {
          this._releaseBuffers();
        }),
        (t.prototype._createUpdateVAO = function (e) {
          var t = {};
          t.position = e.createVertexBuffer("position", 0, 3);
          var i = 3;
          this.particleEmitterType instanceof Ac &&
            ((t.initialPosition = e.createVertexBuffer(
              "initialPosition",
              i,
              3
            )),
            (i += 3)),
            (t.age = e.createVertexBuffer("age", i, 1)),
            (i += 1),
            (t.life = e.createVertexBuffer("life", i, 1)),
            (i += 1),
            (t.seed = e.createVertexBuffer("seed", i, 4)),
            (i += 4),
            (t.size = e.createVertexBuffer("size", i, 3)),
            (i += 3),
            this._colorGradientsTexture ||
              ((t.color = e.createVertexBuffer("color", i, 4)), (i += 4)),
            (t.direction = e.createVertexBuffer("direction", i, 3)),
            (i += 3),
            this._isBillboardBased ||
              ((t.initialDirection = e.createVertexBuffer(
                "initialDirection",
                i,
                3
              )),
              (i += 3)),
            this._angularSpeedGradientsTexture
              ? ((t.angle = e.createVertexBuffer("angle", i, 1)), (i += 1))
              : ((t.angle = e.createVertexBuffer("angle", i, 2)), (i += 2)),
            this._isAnimationSheetEnabled &&
              ((t.cellIndex = e.createVertexBuffer("cellIndex", i, 1)),
              (i += 1),
              this.spriteRandomStartCell &&
                ((t.cellStartOffset = e.createVertexBuffer(
                  "cellStartOffset",
                  i,
                  1
                )),
                (i += 1))),
            this.noiseTexture &&
              ((t.noiseCoordinates1 = e.createVertexBuffer(
                "noiseCoordinates1",
                i,
                3
              )),
              (i += 3),
              (t.noiseCoordinates2 = e.createVertexBuffer(
                "noiseCoordinates2",
                i,
                3
              )),
              (i += 3));
          var n = this._engine.recordVertexArrayObject(
            t,
            null,
            this._updateEffect
          );
          return this._engine.bindArrayBuffer(null), n;
        }),
        (t.prototype._createRenderVAO = function (e, t) {
          var i = {};
          i.position = e.createVertexBuffer(
            "position",
            0,
            3,
            this._attributesStrideSize,
            !0
          );
          var n = 3;
          this.particleEmitterType instanceof Ac && (n += 3),
            (i.age = e.createVertexBuffer(
              "age",
              n,
              1,
              this._attributesStrideSize,
              !0
            )),
            (n += 1),
            (i.life = e.createVertexBuffer(
              "life",
              n,
              1,
              this._attributesStrideSize,
              !0
            )),
            (n += 5),
            (i.size = e.createVertexBuffer(
              "size",
              n,
              3,
              this._attributesStrideSize,
              !0
            )),
            (n += 3),
            this._colorGradientsTexture ||
              ((i.color = e.createVertexBuffer(
                "color",
                n,
                4,
                this._attributesStrideSize,
                !0
              )),
              (n += 4)),
            this.billboardMode === Dh.BILLBOARDMODE_STRETCHED &&
              (i.direction = e.createVertexBuffer(
                "direction",
                n,
                3,
                this._attributesStrideSize,
                !0
              )),
            (n += 3),
            this._isBillboardBased ||
              ((i.initialDirection = e.createVertexBuffer(
                "initialDirection",
                n,
                3,
                this._attributesStrideSize,
                !0
              )),
              (n += 3)),
            (i.angle = e.createVertexBuffer(
              "angle",
              n,
              1,
              this._attributesStrideSize,
              !0
            )),
            this._angularSpeedGradientsTexture ? n++ : (n += 2),
            this._isAnimationSheetEnabled &&
              ((i.cellIndex = e.createVertexBuffer(
                "cellIndex",
                n,
                1,
                this._attributesStrideSize,
                !0
              )),
              (n += 1),
              this.spriteRandomStartCell &&
                ((i.cellStartOffset = e.createVertexBuffer(
                  "cellStartOffset",
                  n,
                  1,
                  this._attributesStrideSize,
                  !0
                )),
                (n += 1))),
            this.noiseTexture &&
              ((i.noiseCoordinates1 = e.createVertexBuffer(
                "noiseCoordinates1",
                n,
                3,
                this._attributesStrideSize,
                !0
              )),
              (n += 3),
              (i.noiseCoordinates2 = e.createVertexBuffer(
                "noiseCoordinates2",
                n,
                3,
                this._attributesStrideSize,
                !0
              )),
              (n += 3)),
            (i.offset = t.createVertexBuffer("offset", 0, 2)),
            (i.uv = t.createVertexBuffer("uv", 2, 2));
          var r = this._engine.recordVertexArrayObject(
            i,
            null,
            this._getEffect()
          );
          return this._engine.bindArrayBuffer(null), r;
        }),
        (t.prototype._initialize = function (e) {
          if ((void 0 === e && (e = !1), !this._buffer0 || e)) {
            var t = this._engine,
              i = new Array();
            (this._attributesStrideSize = 21),
              (this._targetIndex = 0),
              this.particleEmitterType instanceof Ac &&
                (this._attributesStrideSize += 3),
              this.isBillboardBased || (this._attributesStrideSize += 3),
              this._colorGradientsTexture && (this._attributesStrideSize -= 4),
              this._angularSpeedGradientsTexture &&
                (this._attributesStrideSize -= 1),
              this._isAnimationSheetEnabled &&
                ((this._attributesStrideSize += 1),
                this.spriteRandomStartCell &&
                  (this._attributesStrideSize += 1)),
              this.noiseTexture && (this._attributesStrideSize += 6);
            for (
              var n = this.particleEmitterType instanceof Ac,
                r = y.Vector3[0],
                o = 0;
              o < this._capacity;
              o++
            )
              i.push(0),
                i.push(0),
                i.push(0),
                n &&
                  (this.particleEmitterType.particlePositionGenerator(
                    o,
                    null,
                    r
                  ),
                  i.push(r.x),
                  i.push(r.y),
                  i.push(r.z)),
                i.push(0),
                i.push(0),
                i.push(Math.random()),
                i.push(Math.random()),
                i.push(Math.random()),
                i.push(Math.random()),
                i.push(0),
                i.push(0),
                i.push(0),
                this._colorGradientsTexture ||
                  (i.push(0), i.push(0), i.push(0), i.push(0)),
                n
                  ? (this.particleEmitterType.particleDestinationGenerator(
                      o,
                      null,
                      r
                    ),
                    i.push(r.x),
                    i.push(r.y),
                    i.push(r.z))
                  : (i.push(0), i.push(0), i.push(0)),
                this.isBillboardBased || (i.push(0), i.push(0), i.push(0)),
                i.push(0),
                this._angularSpeedGradientsTexture || i.push(0),
                this._isAnimationSheetEnabled &&
                  (i.push(0), this.spriteRandomStartCell && i.push(0)),
                this.noiseTexture &&
                  (i.push(Math.random()),
                  i.push(Math.random()),
                  i.push(Math.random()),
                  i.push(Math.random()),
                  i.push(Math.random()),
                  i.push(Math.random()));
            var s = new Float32Array([
              0.5, 0.5, 1, 1, -0.5, 0.5, 0, 1, -0.5, -0.5, 0, 0, 0.5, -0.5, 1,
              0,
            ]);
            (this._buffer0 = new Dt(t, i, !1, this._attributesStrideSize)),
              (this._buffer1 = new Dt(t, i, !1, this._attributesStrideSize)),
              (this._spriteBuffer = new Dt(t, s, !1, 4)),
              (this._updateVAO = []),
              this._updateVAO.push(this._createUpdateVAO(this._buffer0)),
              this._updateVAO.push(this._createUpdateVAO(this._buffer1)),
              (this._renderVAO = []),
              this._renderVAO.push(
                this._createRenderVAO(this._buffer1, this._spriteBuffer)
              ),
              this._renderVAO.push(
                this._createRenderVAO(this._buffer0, this._spriteBuffer)
              ),
              (this._sourceBuffer = this._buffer0),
              (this._targetBuffer = this._buffer1);
          }
        }),
        (t.prototype._recreateUpdateEffect = function () {
          var e = this.particleEmitterType
            ? this.particleEmitterType.getEffectDefines()
            : "";
          this._isBillboardBased && (e += "\n#define BILLBOARD"),
            this._colorGradientsTexture && (e += "\n#define COLORGRADIENTS"),
            this._sizeGradientsTexture && (e += "\n#define SIZEGRADIENTS"),
            this._angularSpeedGradientsTexture &&
              (e += "\n#define ANGULARSPEEDGRADIENTS"),
            this._velocityGradientsTexture &&
              (e += "\n#define VELOCITYGRADIENTS"),
            this._limitVelocityGradientsTexture &&
              (e += "\n#define LIMITVELOCITYGRADIENTS"),
            this._dragGradientsTexture && (e += "\n#define DRAGGRADIENTS"),
            this.isAnimationSheetEnabled &&
              ((e += "\n#define ANIMATESHEET"),
              this.spriteRandomStartCell &&
                (e += "\n#define ANIMATESHEETRANDOMSTART")),
            this.noiseTexture && (e += "\n#define NOISE"),
            this.isLocal && (e += "\n#define LOCAL"),
            (this._updateEffect && this._updateEffectOptions.defines === e) ||
              ((this._updateEffectOptions.transformFeedbackVaryings = [
                "outPosition",
              ]),
              this.particleEmitterType instanceof Ac &&
                this._updateEffectOptions.transformFeedbackVaryings.push(
                  "outInitialPosition"
                ),
              this._updateEffectOptions.transformFeedbackVaryings.push(
                "outAge"
              ),
              this._updateEffectOptions.transformFeedbackVaryings.push(
                "outLife"
              ),
              this._updateEffectOptions.transformFeedbackVaryings.push(
                "outSeed"
              ),
              this._updateEffectOptions.transformFeedbackVaryings.push(
                "outSize"
              ),
              this._colorGradientsTexture ||
                this._updateEffectOptions.transformFeedbackVaryings.push(
                  "outColor"
                ),
              this._updateEffectOptions.transformFeedbackVaryings.push(
                "outDirection"
              ),
              this._isBillboardBased ||
                this._updateEffectOptions.transformFeedbackVaryings.push(
                  "outInitialDirection"
                ),
              this._updateEffectOptions.transformFeedbackVaryings.push(
                "outAngle"
              ),
              this.isAnimationSheetEnabled &&
                (this._updateEffectOptions.transformFeedbackVaryings.push(
                  "outCellIndex"
                ),
                this.spriteRandomStartCell &&
                  this._updateEffectOptions.transformFeedbackVaryings.push(
                    "outCellStartOffset"
                  )),
              this.noiseTexture &&
                (this._updateEffectOptions.transformFeedbackVaryings.push(
                  "outNoiseCoordinates1"
                ),
                this._updateEffectOptions.transformFeedbackVaryings.push(
                  "outNoiseCoordinates2"
                )),
              (this._updateEffectOptions.defines = e),
              (this._updateEffect = new Ke(
                "gpuUpdateParticles",
                this._updateEffectOptions,
                this._engine
              )));
        }),
        (t.prototype._getEffect = function () {
          var e;
          return null !== (e = this.getCustomEffect()) && void 0 !== e
            ? e
            : this._renderEffect;
        }),
        (t.prototype.fillDefines = function (e, t) {
          if (
            (void 0 === t && (t = 0),
            this._scene &&
              (this._scene.clipPlane && e.push("#define CLIPPLANE"),
              this._scene.clipPlane2 && e.push("#define CLIPPLANE2"),
              this._scene.clipPlane3 && e.push("#define CLIPPLANE3"),
              this._scene.clipPlane4 && e.push("#define CLIPPLANE4"),
              this._scene.clipPlane5 && e.push("#define CLIPPLANE5"),
              this._scene.clipPlane6 && e.push("#define CLIPPLANE6")),
            this.blendMode === Dh.BLENDMODE_MULTIPLY &&
              e.push("#define BLENDMULTIPLYMODE"),
            this.isLocal && e.push("#define LOCAL"),
            this._isBillboardBased)
          )
            switch ((e.push("#define BILLBOARD"), this.billboardMode)) {
              case Dh.BILLBOARDMODE_Y:
                e.push("#define BILLBOARDY");
                break;
              case Dh.BILLBOARDMODE_STRETCHED:
                e.push("#define BILLBOARDSTRETCHED");
                break;
              case Dh.BILLBOARDMODE_ALL:
                e.push("#define BILLBOARDMODE_ALL");
            }
          this._colorGradientsTexture && e.push("#define COLORGRADIENTS"),
            this.isAnimationSheetEnabled && e.push("#define ANIMATESHEET"),
            this._imageProcessingConfiguration &&
              (this._imageProcessingConfiguration.prepareDefines(
                this._imageProcessingConfigurationDefines
              ),
              e.push(
                "" + this._imageProcessingConfigurationDefines.toString()
              ));
        }),
        (t.prototype.fillUniformsAttributesAndSamplerNames = function (
          e,
          t,
          i
        ) {
          t.push(
            "position",
            "age",
            "life",
            "size",
            "color",
            "offset",
            "uv",
            "direction",
            "initialDirection",
            "angle",
            "cellIndex"
          ),
            e.push(
              "emitterWM",
              "worldOffset",
              "view",
              "projection",
              "colorDead",
              "invView",
              "vClipPlane",
              "vClipPlane2",
              "vClipPlane3",
              "vClipPlane4",
              "vClipPlane5",
              "vClipPlane6",
              "sheetInfos",
              "translationPivot",
              "eyePosition"
            ),
            i.push("diffuseSampler", "colorGradientSampler"),
            this._imageProcessingConfiguration &&
              (ti.PrepareUniforms(e, this._imageProcessingConfigurationDefines),
              ti.PrepareSamplers(i, this._imageProcessingConfigurationDefines));
        }),
        (t.prototype._recreateRenderEffect = function () {
          var e = this.getCustomEffect();
          if (e) return e;
          var t = [];
          this.fillDefines(t);
          var i = t.join("\n");
          if (this._renderEffect && this._renderEffect.defines === i)
            return this._renderEffect;
          var n = [],
            r = [],
            o = [];
          return (
            this.fillUniformsAttributesAndSamplerNames(r, n, o),
            (this._renderEffect = new Ke(
              "gpuRenderParticles",
              n,
              r,
              o,
              this._engine,
              i
            )),
            this._renderEffect
          );
        }),
        (t.prototype.animate = function (e) {
          var t;
          void 0 === e && (e = !1),
            (this._timeDelta =
              this.updateSpeed *
              (e
                ? this.preWarmStepOffset
                : (null === (t = this._scene) || void 0 === t
                    ? void 0
                    : t.getAnimationRatio()) || 1)),
            (this._actualFrame += this._timeDelta),
            this._stopped ||
              (this.targetStopDuration &&
                this._actualFrame >= this.targetStopDuration &&
                this.stop());
        }),
        (t.prototype._createFactorGradientTexture = function (e, t) {
          var i = this[t];
          if (e && e.length && !i) {
            for (
              var n = new Float32Array(this._rawTextureWidth), r = 0;
              r < this._rawTextureWidth;
              r++
            ) {
              var o = r / this._rawTextureWidth;
              Mh.GetCurrentGradient(o, e, function (e, t, i) {
                n[r] = s.Lerp(e.factor1, t.factor1, i);
              });
            }
            this[t] = bn.CreateRTexture(
              n,
              this._rawTextureWidth,
              1,
              this._scene || this._engine,
              !1,
              !1,
              1
            );
          }
        }),
        (t.prototype._createSizeGradientTexture = function () {
          this._createFactorGradientTexture(
            this._sizeGradients,
            "_sizeGradientsTexture"
          );
        }),
        (t.prototype._createAngularSpeedGradientTexture = function () {
          this._createFactorGradientTexture(
            this._angularSpeedGradients,
            "_angularSpeedGradientsTexture"
          );
        }),
        (t.prototype._createVelocityGradientTexture = function () {
          this._createFactorGradientTexture(
            this._velocityGradients,
            "_velocityGradientsTexture"
          );
        }),
        (t.prototype._createLimitVelocityGradientTexture = function () {
          this._createFactorGradientTexture(
            this._limitVelocityGradients,
            "_limitVelocityGradientsTexture"
          );
        }),
        (t.prototype._createDragGradientTexture = function () {
          this._createFactorGradientTexture(
            this._dragGradients,
            "_dragGradientsTexture"
          );
        }),
        (t.prototype._createColorGradientTexture = function () {
          if (
            this._colorGradients &&
            this._colorGradients.length &&
            !this._colorGradientsTexture
          ) {
            for (
              var e = new Uint8Array(4 * this._rawTextureWidth),
                t = S.Color4[0],
                i = 0;
              i < this._rawTextureWidth;
              i++
            ) {
              var n = i / this._rawTextureWidth;
              Mh.GetCurrentGradient(
                n,
                this._colorGradients,
                function (n, r, o) {
                  T.LerpToRef(n.color1, r.color1, o, t),
                    (e[4 * i] = 255 * t.r),
                    (e[4 * i + 1] = 255 * t.g),
                    (e[4 * i + 2] = 255 * t.b),
                    (e[4 * i + 3] = 255 * t.a);
                }
              );
            }
            this._colorGradientsTexture = bn.CreateRGBATexture(
              e,
              this._rawTextureWidth,
              1,
              this._scene,
              !1,
              !1,
              1
            );
          }
        }),
        (t.prototype.render = function (e) {
          var t, i;
          if ((void 0 === e && (e = !1), !this._started)) return 0;
          if (
            (this._createColorGradientTexture(),
            this._createSizeGradientTexture(),
            this._createAngularSpeedGradientTexture(),
            this._createVelocityGradientTexture(),
            this._createLimitVelocityGradientTexture(),
            this._createDragGradientTexture(),
            this._recreateUpdateEffect(),
            this._recreateRenderEffect(),
            !this.isReady())
          )
            return 0;
          if (!e && this._scene) {
            if (!this._preWarmDone && this.preWarmCycles) {
              for (var n = 0; n < this.preWarmCycles; n++)
                this.animate(!0), this.render(!0);
              this._preWarmDone = !0;
            }
            if (this._currentRenderId === this._scene.getFrameId()) return 0;
            this._currentRenderId = this._scene.getFrameId();
          }
          if (
            (this._initialize(),
            (this._accumulatedCount += this.emitRate * this._timeDelta),
            this._accumulatedCount > 1)
          ) {
            var r = 0 | this._accumulatedCount;
            (this._accumulatedCount -= r),
              (this._currentActiveCount = Math.min(
                this._activeCount,
                this._currentActiveCount + r
              ));
          }
          if (!this._currentActiveCount) return 0;
          this._engine.enableEffect(this._updateEffect);
          var o,
            s = this._engine;
          if (!s.setState)
            throw new Error(
              "GPU particles cannot work with a full Engine. ThinEngine is not supported"
            );
          if (
            (this._updateEffect.setFloat(
              "currentCount",
              this._currentActiveCount
            ),
            this._updateEffect.setFloat("timeDelta", this._timeDelta),
            this._updateEffect.setFloat("stopFactor", this._stopped ? 0 : 1),
            this._updateEffect.setTexture("randomSampler", this._randomTexture),
            this._updateEffect.setTexture(
              "randomSampler2",
              this._randomTexture2
            ),
            this._updateEffect.setFloat2(
              "lifeTime",
              this.minLifeTime,
              this.maxLifeTime
            ),
            this._updateEffect.setFloat2(
              "emitPower",
              this.minEmitPower,
              this.maxEmitPower
            ),
            this._colorGradientsTexture ||
              (this._updateEffect.setDirectColor4("color1", this.color1),
              this._updateEffect.setDirectColor4("color2", this.color2)),
            this._updateEffect.setFloat2(
              "sizeRange",
              this.minSize,
              this.maxSize
            ),
            this._updateEffect.setFloat4(
              "scaleRange",
              this.minScaleX,
              this.maxScaleX,
              this.minScaleY,
              this.maxScaleY
            ),
            this._updateEffect.setFloat4(
              "angleRange",
              this.minAngularSpeed,
              this.maxAngularSpeed,
              this.minInitialRotation,
              this.maxInitialRotation
            ),
            this._updateEffect.setVector3("gravity", this.gravity),
            this._sizeGradientsTexture &&
              this._updateEffect.setTexture(
                "sizeGradientSampler",
                this._sizeGradientsTexture
              ),
            this._angularSpeedGradientsTexture &&
              this._updateEffect.setTexture(
                "angularSpeedGradientSampler",
                this._angularSpeedGradientsTexture
              ),
            this._velocityGradientsTexture &&
              this._updateEffect.setTexture(
                "velocityGradientSampler",
                this._velocityGradientsTexture
              ),
            this._limitVelocityGradientsTexture &&
              (this._updateEffect.setTexture(
                "limitVelocityGradientSampler",
                this._limitVelocityGradientsTexture
              ),
              this._updateEffect.setFloat(
                "limitVelocityDamping",
                this.limitVelocityDamping
              )),
            this._dragGradientsTexture &&
              this._updateEffect.setTexture(
                "dragGradientSampler",
                this._dragGradientsTexture
              ),
            this.particleEmitterType &&
              this.particleEmitterType.applyToShader(this._updateEffect),
            this._isAnimationSheetEnabled &&
              this._updateEffect.setFloat3(
                "cellInfos",
                this.startSpriteCellID,
                this.endSpriteCellID,
                this.spriteCellChangeSpeed
              ),
            this.noiseTexture &&
              (this._updateEffect.setTexture("noiseSampler", this.noiseTexture),
              this._updateEffect.setVector3(
                "noiseStrength",
                this.noiseStrength
              )),
            this.emitter.position)
          )
            o = this.emitter.getWorldMatrix();
          else {
            var a = this.emitter;
            o = g.Translation(a.x, a.y, a.z);
          }
          if (
            (this.isLocal || this._updateEffect.setMatrix("emitterWM", o),
            this._engine.bindVertexArrayObject(
              this._updateVAO[this._targetIndex],
              null
            ),
            s.bindTransformFeedbackBuffer(this._targetBuffer.getBuffer()),
            s.setRasterizerState(!1),
            s.beginTransformFeedback(!0),
            s.drawArraysType(3, 0, this._currentActiveCount),
            s.endTransformFeedback(),
            s.setRasterizerState(!0),
            s.bindTransformFeedbackBuffer(null),
            !e)
          ) {
            var l = this._getEffect();
            this._engine.enableEffect(l);
            var c =
              (null === (t = this._scene) || void 0 === t
                ? void 0
                : t.getViewMatrix()) || g.IdentityReadOnly;
            if (
              (l.setMatrix("view", c),
              l.setMatrix(
                "projection",
                null !== (i = this.defaultProjectionMatrix) && void 0 !== i
                  ? i
                  : this._scene.getProjectionMatrix()
              ),
              l.setTexture("diffuseSampler", this.particleTexture),
              l.setVector2("translationPivot", this.translationPivot),
              l.setVector3("worldOffset", this.worldOffset),
              this.isLocal && l.setMatrix("emitterWM", o),
              this._colorGradientsTexture
                ? l.setTexture(
                    "colorGradientSampler",
                    this._colorGradientsTexture
                  )
                : l.setDirectColor4("colorDead", this.colorDead),
              this._isAnimationSheetEnabled && this.particleTexture)
            ) {
              var u = this.particleTexture.getBaseSize();
              l.setFloat3(
                "sheetInfos",
                this.spriteCellWidth / u.width,
                this.spriteCellHeight / u.height,
                u.width / this.spriteCellWidth
              );
            }
            if (this._isBillboardBased && this._scene) {
              var h = this._scene.activeCamera;
              l.setVector3("eyePosition", h.globalPosition);
            }
            var d = l.defines;
            if (
              (this._scene &&
                (this._scene.clipPlane ||
                  this._scene.clipPlane2 ||
                  this._scene.clipPlane3 ||
                  this._scene.clipPlane4 ||
                  this._scene.clipPlane5 ||
                  this._scene.clipPlane6) &&
                Hr.BindClipPlane(l, this._scene),
              d.indexOf("#define BILLBOARDMODE_ALL") >= 0)
            ) {
              var p = c.clone();
              p.invert(), l.setMatrix("invView", p);
            }
            switch (
              (this._imageProcessingConfiguration &&
                !this._imageProcessingConfiguration.applyByPostProcess &&
                this._imageProcessingConfiguration.bind(l),
              this.blendMode)
            ) {
              case Dh.BLENDMODE_ADD:
                this._engine.setAlphaMode(1);
                break;
              case Dh.BLENDMODE_ONEONE:
                this._engine.setAlphaMode(6);
                break;
              case Dh.BLENDMODE_STANDARD:
                this._engine.setAlphaMode(2);
                break;
              case Dh.BLENDMODE_MULTIPLY:
                this._engine.setAlphaMode(4);
            }
            this.forceDepthWrite && s.setDepthWrite(!0),
              this._engine.bindVertexArrayObject(
                this._renderVAO[this._targetIndex],
                null
              ),
              this._onBeforeDrawParticlesObservable &&
                this._onBeforeDrawParticlesObservable.notifyObservers(l),
              this._engine.drawArraysType(8, 0, 4, this._currentActiveCount),
              this._engine.setAlphaMode(0);
          }
          this._targetIndex++,
            2 === this._targetIndex && (this._targetIndex = 0);
          var f = this._sourceBuffer;
          return (
            (this._sourceBuffer = this._targetBuffer),
            (this._targetBuffer = f),
            this._currentActiveCount
          );
        }),
        (t.prototype.rebuild = function () {
          this._initialize(!0);
        }),
        (t.prototype._releaseBuffers = function () {
          this._buffer0 && (this._buffer0.dispose(), (this._buffer0 = null)),
            this._buffer1 && (this._buffer1.dispose(), (this._buffer1 = null)),
            this._spriteBuffer &&
              (this._spriteBuffer.dispose(), (this._spriteBuffer = null));
        }),
        (t.prototype._releaseVAOs = function () {
          if (this._updateVAO) {
            for (var e = 0; e < this._updateVAO.length; e++)
              this._engine.releaseVertexArrayObject(this._updateVAO[e]);
            for (this._updateVAO = [], e = 0; e < this._renderVAO.length; e++)
              this._engine.releaseVertexArrayObject(this._renderVAO[e]);
            this._renderVAO = [];
          }
        }),
        (t.prototype.dispose = function (e) {
          if ((void 0 === e && (e = !0), this._scene)) {
            var t = this._scene.particleSystems.indexOf(this);
            t > -1 && this._scene.particleSystems.splice(t, 1);
          }
          this._releaseBuffers(),
            this._releaseVAOs(),
            this._colorGradientsTexture &&
              (this._colorGradientsTexture.dispose(),
              (this._colorGradientsTexture = null)),
            this._sizeGradientsTexture &&
              (this._sizeGradientsTexture.dispose(),
              (this._sizeGradientsTexture = null)),
            this._angularSpeedGradientsTexture &&
              (this._angularSpeedGradientsTexture.dispose(),
              (this._angularSpeedGradientsTexture = null)),
            this._velocityGradientsTexture &&
              (this._velocityGradientsTexture.dispose(),
              (this._velocityGradientsTexture = null)),
            this._limitVelocityGradientsTexture &&
              (this._limitVelocityGradientsTexture.dispose(),
              (this._limitVelocityGradientsTexture = null)),
            this._dragGradientsTexture &&
              (this._dragGradientsTexture.dispose(),
              (this._dragGradientsTexture = null)),
            this._randomTexture &&
              (this._randomTexture.dispose(), (this._randomTexture = null)),
            this._randomTexture2 &&
              (this._randomTexture2.dispose(), (this._randomTexture2 = null)),
            e &&
              this.particleTexture &&
              (this.particleTexture.dispose(), (this.particleTexture = null)),
            e &&
              this.noiseTexture &&
              (this.noiseTexture.dispose(), (this.noiseTexture = null)),
            this.onStoppedObservable.clear(),
            this.onDisposeObservable.notifyObservers(this),
            this.onDisposeObservable.clear();
        }),
        (t.prototype.clone = function (e, i) {
          var n = this.serialize(),
            r = t.Parse(n, this._scene || this._engine, ""),
            o = A({}, this._customEffect);
          return (
            (r.name = e),
            (r._customEffect = o),
            void 0 === i && (i = this.emitter),
            (r.emitter = i),
            (r.noiseTexture = this.noiseTexture),
            r
          );
        }),
        (t.prototype.serialize = function (e) {
          void 0 === e && (e = !1);
          var t = {};
          return (
            Dh._Serialize(t, this, e),
            (t.activeParticleCount = this.activeParticleCount),
            (t.randomTextureSize = this._randomTextureSize),
            t
          );
        }),
        (t.Parse = function (e, i, n, r) {
          void 0 === r && (r = !1);
          var o = new t(
            e.name,
            {
              capacity: e.capacity,
              randomTextureSize: e.randomTextureSize,
            },
            i
          );
          return (
            e.activeParticleCount &&
              (o.activeParticleCount = e.activeParticleCount),
            Dh._Parse(e, o, i, n),
            e.preventAutoStart && (o.preventAutoStart = e.preventAutoStart),
            r || o.preventAutoStart || o.start(),
            o
          );
        }),
        t
      );
    })(Mc),
    Nh = (function () {
      function e() {
        this.systems = new Array();
      }
      return (
        Object.defineProperty(e.prototype, "emitterNode", {
          get: function () {
            return this._emitterNode;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.setEmitterAsSphere = function (e, t, i) {
          this._emitterNode && this._emitterNode.dispose(),
            (this._emitterCreationOptions = {
              kind: "Sphere",
              options: e,
              renderingGroupId: t,
            });
          var n = Po.CreateSphere(
            "emitterSphere",
            {
              diameter: e.diameter,
              segments: e.segments,
            },
            i
          );
          n.renderingGroupId = t;
          var r = new qr("emitterSphereMaterial", i);
          (r.emissiveColor = e.color), (n.material = r);
          for (var o = 0, s = this.systems; o < s.length; o++) s[o].emitter = n;
          this._emitterNode = n;
        }),
        (e.prototype.start = function (e) {
          for (var t = 0, i = this.systems; t < i.length; t++) {
            var n = i[t];
            e && (n.emitter = e), n.start();
          }
        }),
        (e.prototype.dispose = function () {
          for (var e = 0, t = this.systems; e < t.length; e++) t[e].dispose();
          (this.systems = []),
            this._emitterNode &&
              (this._emitterNode.dispose(), (this._emitterNode = null));
        }),
        (e.prototype.serialize = function (e) {
          void 0 === e && (e = !1);
          for (
            var t = {
                systems: [],
              },
              i = 0,
              n = this.systems;
            i < n.length;
            i++
          ) {
            var r = n[i];
            t.systems.push(r.serialize(e));
          }
          return (
            this._emitterNode && (t.emitter = this._emitterCreationOptions), t
          );
        }),
        (e.Parse = function (t, i, n) {
          void 0 === n && (n = !1);
          var r = new e(),
            o = this.BaseAssetsUrl + "/textures/";
          i = i || j.LastCreatedScene;
          for (var s = 0, a = t.systems; s < a.length; s++) {
            var l = a[s];
            r.systems.push(n ? wh.Parse(l, i, o, !0) : Dh.Parse(l, i, o, !0));
          }
          if (t.emitter) {
            var c = t.emitter.options;
            switch (t.emitter.kind) {
              case "Sphere":
                r.setEmitterAsSphere(
                  {
                    diameter: c.diameter,
                    segments: c.segments,
                    color: b.FromArray(c.color),
                  },
                  t.emitter.renderingGroupId,
                  i
                );
            }
          }
          return r;
        }),
        (e.BaseAssetsUrl = "https://assets.babylonjs.com/particles"),
        e
      );
    })();
  !(function () {
    function e() {}
    (e.CreateDefault = function (e, t, i, n) {
      var r;
      return (
        void 0 === t && (t = 500),
        void 0 === n && (n = !1),
        ((r = n
          ? new wh(
              "default system",
              {
                capacity: t,
              },
              i
            )
          : new Dh("default system", t, i)).emitter = e),
        (r.particleTexture = new mn(
          "https://www.babylonjs.com/accel/static/assets/Flare.png",
          r.getScene()
        )),
        r.createConeEmitter(0.1, Math.PI / 4),
        (r.color1 = new T(1, 1, 1, 1)),
        (r.color2 = new T(1, 1, 1, 1)),
        (r.colorDead = new T(1, 1, 1, 0)),
        (r.minSize = 0.1),
        (r.maxSize = 0.1),
        (r.minEmitPower = 2),
        (r.maxEmitPower = 2),
        (r.updateSpeed = 1 / 60),
        (r.emitRate = 30),
        r
      );
    }),
      (e.CreateAsync = function (t, i, n) {
        void 0 === n && (n = !1), i || (i = j.LastCreatedScene);
        var r = {};
        return (
          i._addPendingData(r),
          new Promise(function (o, s) {
            if (n && !wh.IsSupported)
              return (
                i._removePendingData(r),
                s("Particle system with GPU is not supported.")
              );
            yt.LoadFile(
              e.BaseAssetsUrl + "/systems/" + t + ".json",
              function (e) {
                i._removePendingData(r);
                var t = JSON.parse(e.toString());
                return o(Nh.Parse(t, i, n));
              },
              void 0,
              void 0,
              void 0,
              function () {
                return (
                  i._removePendingData(r),
                  s(
                    "An error occured while the creation of your particle system. Check if your type '" +
                      t +
                      "' exists."
                  )
                );
              }
            );
          })
        );
      }),
      (e.ExportSet = function (e) {
        for (var t = new Nh(), i = 0, n = e; i < n.length; i++) {
          var r = n[i];
          t.systems.push(r);
        }
        return t;
      }),
      (e.ParseFromFileAsync = function (e, t, i, n, r) {
        return (
          void 0 === n && (n = !1),
          void 0 === r && (r = ""),
          new Promise(function (o, s) {
            var a = new Te();
            a.addEventListener("readystatechange", function () {
              if (4 == a.readyState)
                if (200 == a.status) {
                  var t = JSON.parse(a.responseText),
                    l = void 0;
                  (l = n ? wh.Parse(t, i, r) : Dh.Parse(t, i, r)),
                    e && (l.name = e),
                    o(l);
                } else s("Unable to load the particle system");
            }),
              a.open("GET", t),
              a.send();
          })
        );
      }),
      (e.CreateFromSnippetAsync = function (e, t, i, n) {
        var r = this;
        if (
          (void 0 === i && (i = !1), void 0 === n && (n = ""), "_BLANK" === e)
        ) {
          var o = this.CreateDefault(null);
          return o.start(), Promise.resolve(o);
        }
        return new Promise(function (o, s) {
          var a = new Te();
          a.addEventListener("readystatechange", function () {
            if (4 == a.readyState)
              if (200 == a.status) {
                var r = JSON.parse(JSON.parse(a.responseText).jsonPayload),
                  l = JSON.parse(r.particleSystem),
                  c = void 0;
                ((c = i ? wh.Parse(l, t, n) : Dh.Parse(l, t, n)).snippetId = e),
                  o(c);
              } else s("Unable to load the snippet " + e);
          }),
            a.open("GET", r.SnippetUrl + "/" + e.replace(/#/g, "/")),
            a.send();
        });
      }),
      (e.BaseAssetsUrl = Nh.BaseAssetsUrl),
      (e.SnippetUrl = "https://snippet.babylonjs.com");
  })(),
    t.AddParser(hi.NAME_PARTICLESYSTEM, function (e, i, n, r) {
      var o = t.GetIndividualParser(hi.NAME_PARTICLESYSTEM);
      if (o && void 0 !== e.particleSystems && null !== e.particleSystems)
        for (var s = 0, a = e.particleSystems.length; s < a; s++) {
          var l = e.particleSystems[s];
          n.particleSystems.push(o(l, i, r));
        }
    }),
    t.AddIndividualParser(hi.NAME_PARTICLESYSTEM, function (e, t, i) {
      return e.activeParticleCount ? wh.Parse(e, t, i) : Dh.Parse(e, t, i);
    }),
    (It.prototype.createEffectForParticles = function (e, t, i, n, r, o, s, a) {
      var l;
      void 0 === t && (t = []),
        void 0 === i && (i = []),
        void 0 === n && (n = "");
      var c = [],
        u = [],
        h = [];
      return (
        a
          ? a.fillUniformsAttributesAndSamplerNames(u, c, h)
          : ((c = Dh._GetAttributeNamesOrOptions()),
            (u = Dh._GetEffectCreationOptions())),
        -1 === n.indexOf(" BILLBOARD") && (n += "\n#define BILLBOARD\n"),
        -1 === i.indexOf("diffuseSampler") && i.push("diffuseSampler"),
        this.createEffect(
          {
            vertex:
              null !== (l = null == a ? void 0 : a.vertexShaderName) &&
              void 0 !== l
                ? l
                : "particles",
            fragmentElement: e,
          },
          c,
          u.concat(t),
          h.concat(i),
          n,
          r,
          o,
          s
        )
      );
    }),
    (Qi.prototype.getEmittedParticleSystems = function () {
      for (
        var e = new Array(), t = 0;
        t < this.getScene().particleSystems.length;
        t++
      ) {
        var i = this.getScene().particleSystems[t];
        i.emitter === this && e.push(i);
      }
      return e;
    }),
    (Qi.prototype.getHierarchyEmittedParticleSystems = function () {
      var e = new Array(),
        t = this.getDescendants();
      t.push(this);
      for (var i = 0; i < this.getScene().particleSystems.length; i++) {
        var n = this.getScene().particleSystems[i],
          r = n.emitter;
        r.position && -1 !== t.indexOf(r) && e.push(n);
      }
      return e;
    });
  var Lh,
    Fh = (function () {
      function e(e, t, i, n, r, o, s, a, l, c) {
        void 0 === l && (l = null),
          void 0 === c && (c = null),
          (this.idx = 0),
          (this.id = 0),
          (this.color = new T(1, 1, 1, 1)),
          (this.position = f.Zero()),
          (this.rotation = f.Zero()),
          (this.scaling = f.One()),
          (this.uvs = new _(0, 0, 1, 1)),
          (this.velocity = f.Zero()),
          (this.pivot = f.Zero()),
          (this.translateFromPivot = !1),
          (this.alive = !0),
          (this.isVisible = !0),
          (this._pos = 0),
          (this._ind = 0),
          (this.shapeId = 0),
          (this.idxInShape = 0),
          (this._stillInvisible = !1),
          (this._rotationMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1]),
          (this.parentId = null),
          (this.materialIndex = null),
          (this.props = null),
          (this.cullingStrategy = Yt.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY),
          (this._globalPosition = f.Zero()),
          (this.idx = e),
          (this.id = t),
          (this._pos = i),
          (this._ind = n),
          (this._model = r),
          (this.shapeId = o),
          (this.idxInShape = s),
          (this._sps = a),
          l &&
            ((this._modelBoundingInfo = l),
            (this._boundingInfo = new Gt(l.minimum, l.maximum))),
          null !== c && (this.materialIndex = c);
      }
      return (
        (e.prototype.copyToRef = function (e) {
          return (
            e.position.copyFrom(this.position),
            e.rotation.copyFrom(this.rotation),
            this.rotationQuaternion &&
              (e.rotationQuaternion
                ? e.rotationQuaternion.copyFrom(this.rotationQuaternion)
                : (e.rotationQuaternion = this.rotationQuaternion.clone())),
            e.scaling.copyFrom(this.scaling),
            this.color &&
              (e.color
                ? e.color.copyFrom(this.color)
                : (e.color = this.color.clone())),
            e.uvs.copyFrom(this.uvs),
            e.velocity.copyFrom(this.velocity),
            e.pivot.copyFrom(this.pivot),
            (e.translateFromPivot = this.translateFromPivot),
            (e.alive = this.alive),
            (e.isVisible = this.isVisible),
            (e.parentId = this.parentId),
            (e.cullingStrategy = this.cullingStrategy),
            null !== this.materialIndex &&
              (e.materialIndex = this.materialIndex),
            this
          );
        }),
        Object.defineProperty(e.prototype, "scale", {
          get: function () {
            return this.scaling;
          },
          set: function (e) {
            this.scaling = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "quaternion", {
          get: function () {
            return this.rotationQuaternion;
          },
          set: function (e) {
            this.rotationQuaternion = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.intersectsMesh = function (e) {
          return (
            !(!this._boundingInfo || !e._boundingInfo) &&
            (this._sps._bSphereOnly
              ? Bt.Intersects(
                  this._boundingInfo.boundingSphere,
                  e._boundingInfo.boundingSphere
                )
              : this._boundingInfo.intersects(e._boundingInfo, !1))
          );
        }),
        (e.prototype.isInFrustum = function (e) {
          return (
            null !== this._boundingInfo &&
            this._boundingInfo.isInFrustum(e, this.cullingStrategy)
          );
        }),
        (e.prototype.getRotationMatrix = function (e) {
          var t;
          if (this.rotationQuaternion) t = this.rotationQuaternion;
          else {
            t = y.Quaternion[0];
            var i = this.rotation;
            m.RotationYawPitchRollToRef(i.y, i.x, i.z, t);
          }
          t.toRotationMatrix(e);
        }),
        e
      );
    })(),
    Bh = function (e, t, i, n, r, o, s, a, l) {
      (this._indicesLength = 0),
        (this.shapeID = e),
        (this._shape = t),
        (this._indices = i),
        (this._indicesLength = i.length),
        (this._shapeUV = o),
        (this._shapeColors = r),
        (this._normals = n),
        (this._positionFunction = s),
        (this._vertexFunction = a),
        (this._material = l);
    },
    Vh = function (e, t, i, n) {
      (this.idx = 0),
        (this.ind = 0),
        (this.indicesLength = 0),
        (this.sqDistance = 0),
        (this.materialIndex = 0),
        (this.idx = e),
        (this.ind = t),
        (this.indicesLength = i),
        (this.materialIndex = n);
    },
    kh = (function () {
      function e() {
        (this.position = f.Zero()),
          (this.color = new T(1, 1, 1, 1)),
          (this.uv = p.Zero());
      }
      return (
        Object.defineProperty(e.prototype, "x", {
          get: function () {
            return this.position.x;
          },
          set: function (e) {
            this.position.x = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "y", {
          get: function () {
            return this.position.y;
          },
          set: function (e) {
            this.position.y = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "z", {
          get: function () {
            return this.position.z;
          },
          set: function (e) {
            this.position.z = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        e
      );
    })(),
    Uh =
      ((function () {
        function e(e, t, i) {
          (this.particles = new Array()),
            (this.nbParticles = 0),
            (this.billboard = !1),
            (this.recomputeNormals = !1),
            (this.counter = 0),
            (this.vars = {}),
            (this._bSphereOnly = !1),
            (this._bSphereRadiusFactor = 1),
            (this._positions = new Array()),
            (this._indices = new Array()),
            (this._normals = new Array()),
            (this._colors = new Array()),
            (this._uvs = new Array()),
            (this._index = 0),
            (this._updatable = !0),
            (this._pickable = !1),
            (this._isVisibilityBoxLocked = !1),
            (this._alwaysVisible = !1),
            (this._depthSort = !1),
            (this._expandable = !1),
            (this._shapeCounter = 0),
            (this._copy = new Fh(0, 0, 0, 0, null, 0, 0, this)),
            (this._color = new T(0, 0, 0, 0)),
            (this._computeParticleColor = !0),
            (this._computeParticleTexture = !0),
            (this._computeParticleRotation = !0),
            (this._computeParticleVertex = !1),
            (this._computeBoundingBox = !1),
            (this._depthSortParticles = !0),
            (this._mustUnrotateFixedNormals = !1),
            (this._particlesIntersect = !1),
            (this._needs32Bits = !1),
            (this._isNotBuilt = !0),
            (this._lastParticleId = 0),
            (this._idxOfId = []),
            (this._multimaterialEnabled = !1),
            (this._useModelMaterial = !1),
            (this._depthSortFunction = function (e, t) {
              return t.sqDistance - e.sqDistance;
            }),
            (this._materialSortFunction = function (e, t) {
              return e.materialIndex - t.materialIndex;
            }),
            (this._autoUpdateSubMeshes = !1),
            (this.name = e),
            (this._scene = t || j.LastCreatedScene),
            (this._camera = t.activeCamera),
            (this._pickable = !!i && i.isPickable),
            (this._depthSort = !!i && i.enableDepthSort),
            (this._multimaterialEnabled = !!i && i.enableMultiMaterial),
            (this._useModelMaterial = !!i && i.useModelMaterial),
            (this._multimaterialEnabled =
              !!this._useModelMaterial || this._multimaterialEnabled),
            (this._expandable = !!i && i.expandable),
            (this._particlesIntersect = !!i && i.particleIntersection),
            (this._bSphereOnly = !!i && i.boundingSphereOnly),
            (this._bSphereRadiusFactor =
              i && i.bSphereRadiusFactor ? i.bSphereRadiusFactor : 1),
            i && void 0 !== i.updatable
              ? (this._updatable = i.updatable)
              : (this._updatable = !0),
            this._pickable &&
              ((this.pickedBySubMesh = [[]]),
              (this.pickedParticles = this.pickedBySubMesh[0])),
            (this._depthSort || this._multimaterialEnabled) &&
              (this.depthSortedParticles = []),
            this._multimaterialEnabled &&
              ((this._multimaterial = new Gi(
                this.name + "MultiMaterial",
                this._scene
              )),
              (this._materials = []),
              (this._materialIndexesById = {})),
            (this._tmpVertex = new kh());
        }
        (e.prototype.buildMesh = function () {
          if (!this._isNotBuilt && this.mesh) return this.mesh;
          if (0 === this.nbParticles && !this.mesh) {
            var e = th.CreateDisc(
              "",
              {
                radius: 1,
                tessellation: 3,
              },
              this._scene
            );
            this.addShape(e, 1), e.dispose();
          }
          if (
            ((this._indices32 = this._needs32Bits
              ? new Uint32Array(this._indices)
              : new Uint16Array(this._indices)),
            (this._positions32 = new Float32Array(this._positions)),
            (this._uvs32 = new Float32Array(this._uvs)),
            (this._colors32 = new Float32Array(this._colors)),
            !this.mesh)
          ) {
            var t = new Qi(this.name, this._scene);
            this.mesh = t;
          }
          !this._updatable &&
            this._multimaterialEnabled &&
            this._sortParticlesByMaterial(),
            this.recomputeNormals &&
              Nt.ComputeNormals(
                this._positions32,
                this._indices32,
                this._normals
              ),
            (this._normals32 = new Float32Array(this._normals)),
            (this._fixedNormal32 = new Float32Array(this._normals)),
            this._mustUnrotateFixedNormals && this._unrotateFixedNormals();
          var i = new Nt();
          if (
            ((i.indices = this._depthSort ? this._indices : this._indices32),
            i.set(this._positions32, wt.PositionKind),
            i.set(this._normals32, wt.NormalKind),
            this._uvs32.length > 0 && i.set(this._uvs32, wt.UVKind),
            this._colors32.length > 0 && i.set(this._colors32, wt.ColorKind),
            i.applyToMesh(this.mesh, this._updatable),
            (this.mesh.isPickable = this._pickable),
            this._pickable)
          )
            for (var n = 0, r = 0; r < this.nbParticles; r++)
              for (
                var o = this.particles[r], s = o._model._indicesLength, a = 0;
                a < s;
                a++
              )
                if (0 == a % 3) {
                  var l = {
                    idx: o.idx,
                    faceId: n,
                  };
                  (this.pickedParticles[n] = l), n++;
                }
          return (
            this._multimaterialEnabled &&
              this.setMultiMaterial(this._materials),
            this._expandable ||
              (this._depthSort ||
                this._multimaterialEnabled ||
                (this._indices = null),
              (this._positions = null),
              (this._normals = null),
              (this._uvs = null),
              (this._colors = null),
              this._updatable || (this.particles.length = 0)),
            (this._isNotBuilt = !1),
            (this.recomputeNormals = !1),
            this.mesh
          );
        }),
          (e.prototype.digest = function (e, t) {
            var i = (t && t.facetNb) || 1,
              n = (t && t.number) || 0,
              r = (t && t.delta) || 0,
              o = e.getVerticesData(wt.PositionKind),
              s = e.getIndices(),
              a = e.getVerticesData(wt.UVKind),
              l = e.getVerticesData(wt.ColorKind),
              c = e.getVerticesData(wt.NormalKind),
              u = t && t.storage ? t.storage : null,
              h = 0,
              d = s.length / 3;
            n
              ? ((n = n > d ? d : n), (i = Math.round(d / n)), (r = 0))
              : (i = i > d ? d : i);
            for (
              var p = [], _ = [], m = [], g = [], v = [], y = f.Zero(), b = i;
              h < d;

            ) {
              h > d - (i = b + Math.floor((1 + r) * Math.random())) &&
                (i = d - h),
                (p.length = 0),
                (_.length = 0),
                (m.length = 0),
                (g.length = 0),
                (v.length = 0);
              for (var T = 0, S = 3 * h; S < 3 * (h + i); S++) {
                m.push(T);
                var C = s[S],
                  x = 3 * C;
                if (
                  (p.push(o[x], o[x + 1], o[x + 2]),
                  _.push(c[x], c[x + 1], c[x + 2]),
                  a)
                ) {
                  var E = 2 * C;
                  g.push(a[E], a[E + 1]);
                }
                if (l) {
                  var P = 4 * C;
                  v.push(l[P], l[P + 1], l[P + 2], l[P + 3]);
                }
                T++;
              }
              var A,
                R = this.nbParticles,
                M = this._posToShape(p),
                O = this._uvsToShapeUV(g),
                I = yt.Slice(m),
                D = yt.Slice(v),
                w = yt.Slice(_);
              for (y.copyFromFloats(0, 0, 0), A = 0; A < M.length; A++)
                y.addInPlace(M[A]);
              y.scaleInPlace(1 / M.length);
              var N,
                L = new f(1 / 0, 1 / 0, 1 / 0),
                F = new f(-1 / 0, -1 / 0, -1 / 0);
              for (A = 0; A < M.length; A++)
                M[A].subtractInPlace(y),
                  L.minimizeInPlaceFromFloats(M[A].x, M[A].y, M[A].z),
                  F.maximizeInPlaceFromFloats(M[A].x, M[A].y, M[A].z);
              this._particlesIntersect && (N = new Gt(L, F));
              var B = null;
              this._useModelMaterial &&
                (B = e.material ? e.material : this._setDefaultMaterial());
              var V = new Bh(this._shapeCounter, M, I, w, D, O, null, null, B),
                k = this._positions.length,
                U = this._indices.length;
              this._meshBuilder(
                this._index,
                U,
                M,
                this._positions,
                I,
                this._indices,
                g,
                this._uvs,
                D,
                this._colors,
                w,
                this._normals,
                R,
                0,
                null,
                V
              ),
                this._addParticle(
                  R,
                  this._lastParticleId,
                  k,
                  U,
                  V,
                  this._shapeCounter,
                  0,
                  N,
                  u
                ),
                this.particles[this.nbParticles].position.addInPlace(y),
                u ||
                  ((this._index += M.length),
                  R++,
                  this.nbParticles++,
                  this._lastParticleId++),
                this._shapeCounter++,
                (h += i);
            }
            return (this._isNotBuilt = !0), this;
          }),
          (e.prototype._unrotateFixedNormals = function () {
            for (
              var e = 0,
                t = 0,
                i = y.Vector3[0],
                n = y.Quaternion[0],
                r = y.Matrix[0],
                o = 0;
              o < this.particles.length;
              o++
            ) {
              var s = this.particles[o],
                a = s._model._shape;
              if (s.rotationQuaternion) s.rotationQuaternion.conjugateToRef(n);
              else {
                var l = s.rotation;
                m.RotationYawPitchRollToRef(l.y, l.x, l.z, n),
                  n.conjugateInPlace();
              }
              n.toRotationMatrix(r);
              for (var c = 0; c < a.length; c++)
                (t = e + 3 * c),
                  f.TransformNormalFromFloatsToRef(
                    this._normals32[t],
                    this._normals32[t + 1],
                    this._normals32[t + 2],
                    r,
                    i
                  ),
                  i.toArray(this._fixedNormal32, t);
              e = t + 3;
            }
          }),
          (e.prototype._resetCopy = function () {
            var e = this._copy;
            e.position.setAll(0),
              e.rotation.setAll(0),
              (e.rotationQuaternion = null),
              e.scaling.setAll(1),
              e.uvs.copyFromFloats(0, 0, 1, 1),
              (e.color = null),
              (e.translateFromPivot = !1),
              (e.shapeId = 0),
              (e.materialIndex = null);
          }),
          (e.prototype._meshBuilder = function (
            e,
            t,
            i,
            n,
            r,
            o,
            s,
            a,
            l,
            c,
            u,
            h,
            d,
            p,
            _,
            m
          ) {
            var v,
              b = 0,
              T = 0,
              S = 0;
            this._resetCopy();
            var C = this._copy,
              x = !(!_ || !_.storage);
            if (
              ((C.idx = d),
              (C.idxInShape = p),
              (C.shapeId = m.shapeID),
              this._useModelMaterial)
            ) {
              var E = m._material.uniqueId,
                P = this._materialIndexesById;
              P.hasOwnProperty(E) ||
                ((P[E] = this._materials.length),
                this._materials.push(m._material));
              var A = P[E];
              C.materialIndex = A;
            }
            if (
              (_ &&
                _.positionFunction &&
                (_.positionFunction(C, d, p),
                (this._mustUnrotateFixedNormals = !0)),
              x)
            )
              return C;
            var R = y.Matrix[0],
              M = this._tmpVertex,
              O = M.position,
              I = M.color,
              D = M.uv,
              w = y.Vector3[1],
              N = y.Vector3[2],
              L = y.Vector3[3];
            g.IdentityToRef(R),
              C.getRotationMatrix(R),
              C.pivot.multiplyToRef(C.scaling, L),
              C.translateFromPivot ? N.setAll(0) : N.copyFrom(L);
            var F = _ && _.vertexFunction;
            for (v = 0; v < i.length; v++) {
              if (
                (O.copyFrom(i[v]),
                C.color && I.copyFrom(C.color),
                s && D.copyFromFloats(s[b], s[b + 1]),
                F && _.vertexFunction(C, M, v),
                O.multiplyInPlace(C.scaling).subtractInPlace(L),
                f.TransformCoordinatesToRef(O, R, w),
                w.addInPlace(N).addInPlace(C.position),
                n.push(w.x, w.y, w.z),
                s)
              ) {
                var B = C.uvs;
                a.push((B.z - B.x) * D.x + B.x, (B.w - B.y) * D.y + B.y),
                  (b += 2);
              }
              if (C.color) this._color.copyFrom(I);
              else {
                var V = this._color;
                l && void 0 !== l[T]
                  ? ((V.r = l[T]),
                    (V.g = l[T + 1]),
                    (V.b = l[T + 2]),
                    (V.a = l[T + 3]))
                  : ((V.r = 1), (V.g = 1), (V.b = 1), (V.a = 1));
              }
              c.push(
                this._color.r,
                this._color.g,
                this._color.b,
                this._color.a
              ),
                (T += 4),
                !this.recomputeNormals &&
                  u &&
                  (f.TransformNormalFromFloatsToRef(
                    u[S],
                    u[S + 1],
                    u[S + 2],
                    R,
                    O
                  ),
                  h.push(O.x, O.y, O.z),
                  (S += 3));
            }
            for (v = 0; v < r.length; v++) {
              var k = e + r[v];
              o.push(k), k > 65535 && (this._needs32Bits = !0);
            }
            if (this._depthSort || this._multimaterialEnabled) {
              var U = null !== C.materialIndex ? C.materialIndex : 0;
              this.depthSortedParticles.push(new Vh(d, t, r.length, U));
            }
            return C;
          }),
          (e.prototype._posToShape = function (e) {
            for (var t = [], i = 0; i < e.length; i += 3)
              t.push(f.FromArray(e, i));
            return t;
          }),
          (e.prototype._uvsToShapeUV = function (e) {
            var t = [];
            if (e) for (var i = 0; i < e.length; i++) t.push(e[i]);
            return t;
          }),
          (e.prototype._addParticle = function (e, t, i, n, r, o, s, a, l) {
            void 0 === a && (a = null), void 0 === l && (l = null);
            var c = new Fh(e, t, i, n, r, o, s, this, a);
            return (l || this.particles).push(c), c;
          }),
          (e.prototype.addShape = function (e, t, i) {
            var n = e.getVerticesData(wt.PositionKind),
              r = e.getIndices(),
              o = e.getVerticesData(wt.UVKind),
              s = e.getVerticesData(wt.ColorKind),
              a = e.getVerticesData(wt.NormalKind);
            this.recomputeNormals = !a;
            var l = yt.SliceToArray(r),
              c = yt.SliceToArray(a),
              u = s ? yt.SliceToArray(s) : [],
              h = i && i.storage ? i.storage : null,
              d = null;
            this._particlesIntersect && (d = e.getBoundingInfo());
            var p = this._posToShape(n),
              f = this._uvsToShapeUV(o),
              _ = i ? i.positionFunction : null,
              m = i ? i.vertexFunction : null,
              g = null;
            this._useModelMaterial &&
              (g = e.material ? e.material : this._setDefaultMaterial());
            for (
              var v = new Bh(this._shapeCounter, p, l, c, u, f, _, m, g), y = 0;
              y < t;
              y++
            )
              this._insertNewParticle(
                this.nbParticles,
                y,
                v,
                p,
                r,
                o,
                s,
                a,
                d,
                h,
                i
              );
            return (
              this._shapeCounter++,
              (this._isNotBuilt = !0),
              this._shapeCounter - 1
            );
          }),
          (e.prototype._rebuildParticle = function (e, t) {
            void 0 === t && (t = !1), this._resetCopy();
            var i = this._copy;
            e._model._positionFunction &&
              e._model._positionFunction(i, e.idx, e.idxInShape);
            var n = y.Matrix[0],
              r = y.Vector3[0],
              o = y.Vector3[1],
              s = y.Vector3[2],
              a = y.Vector3[3];
            i.getRotationMatrix(n),
              e.pivot.multiplyToRef(e.scaling, a),
              i.translateFromPivot ? s.copyFromFloats(0, 0, 0) : s.copyFrom(a);
            for (var l = e._model._shape, c = 0; c < l.length; c++)
              r.copyFrom(l[c]),
                e._model._vertexFunction && e._model._vertexFunction(i, r, c),
                r.multiplyInPlace(i.scaling).subtractInPlace(a),
                f.TransformCoordinatesToRef(r, n, o),
                o
                  .addInPlace(s)
                  .addInPlace(i.position)
                  .toArray(this._positions32, e._pos + 3 * c);
            t &&
              (e.position.setAll(0),
              e.rotation.setAll(0),
              (e.rotationQuaternion = null),
              e.scaling.setAll(1),
              e.uvs.setAll(0),
              e.pivot.setAll(0),
              (e.translateFromPivot = !1),
              (e.parentId = null));
          }),
          (e.prototype.rebuildMesh = function (e) {
            void 0 === e && (e = !1);
            for (var t = 0; t < this.particles.length; t++)
              this._rebuildParticle(this.particles[t], e);
            return (
              this.mesh.updateVerticesData(
                wt.PositionKind,
                this._positions32,
                !1,
                !1
              ),
              this
            );
          }),
          (e.prototype.removeParticles = function (e, t) {
            var i = t - e + 1;
            if (
              !this._expandable ||
              i <= 0 ||
              i >= this.nbParticles ||
              !this._updatable
            )
              return [];
            var n = this.particles,
              r = this.nbParticles;
            if (t < r - 1)
              for (
                var o = t + 1,
                  s = n[o]._pos - n[e]._pos,
                  a = n[o]._ind - n[e]._ind,
                  l = o;
                l < r;
                l++
              ) {
                var c = n[l];
                (c._pos -= s), (c._ind -= a);
              }
            var u = n.splice(e, i);
            (this._positions.length = 0),
              (this._indices.length = 0),
              (this._colors.length = 0),
              (this._uvs.length = 0),
              (this._normals.length = 0),
              (this._index = 0),
              (this._idxOfId.length = 0),
              (this._depthSort || this._multimaterialEnabled) &&
                (this.depthSortedParticles = []);
            for (var h = 0, d = n.length, p = 0; p < d; p++) {
              var f = n[p],
                _ = f._model,
                m = _._shape,
                g = _._indices,
                v = _._normals,
                y = _._shapeColors,
                b = _._shapeUV;
              (f.idx = p),
                (this._idxOfId[f.id] = p),
                this._meshBuilder(
                  this._index,
                  h,
                  m,
                  this._positions,
                  g,
                  this._indices,
                  b,
                  this._uvs,
                  y,
                  this._colors,
                  v,
                  this._normals,
                  f.idx,
                  f.idxInShape,
                  null,
                  _
                ),
                (this._index += m.length),
                (h += g.length);
            }
            return (this.nbParticles -= i), (this._isNotBuilt = !0), u;
          }),
          (e.prototype.insertParticlesFromArray = function (e) {
            if (!this._expandable) return this;
            for (var t = 0, i = e[0].shapeId, n = e.length, r = 0; r < n; r++) {
              var o = e[r],
                s = o._model,
                a = s._shape,
                l = s._indices,
                c = s._shapeUV,
                u = s._shapeColors,
                h = s._normals,
                d = !h;
              this.recomputeNormals = d || this.recomputeNormals;
              var p = o._boundingInfo,
                f = this._insertNewParticle(
                  this.nbParticles,
                  t,
                  s,
                  a,
                  l,
                  c,
                  u,
                  h,
                  p,
                  null,
                  null
                );
              o.copyToRef(f), t++, i != o.shapeId && ((i = o.shapeId), (t = 0));
            }
            return (this._isNotBuilt = !0), this;
          }),
          (e.prototype._insertNewParticle = function (
            e,
            t,
            i,
            n,
            r,
            o,
            s,
            a,
            l,
            c,
            u
          ) {
            var h = this._positions.length,
              d = this._indices.length,
              p = this._meshBuilder(
                this._index,
                d,
                n,
                this._positions,
                r,
                this._indices,
                o,
                this._uvs,
                s,
                this._colors,
                a,
                this._normals,
                e,
                t,
                u,
                i
              ),
              f = null;
            return (
              this._updatable &&
                ((f = this._addParticle(
                  this.nbParticles,
                  this._lastParticleId,
                  h,
                  d,
                  i,
                  this._shapeCounter,
                  t,
                  l,
                  c
                )).position.copyFrom(p.position),
                f.rotation.copyFrom(p.rotation),
                p.rotationQuaternion &&
                  (f.rotationQuaternion
                    ? f.rotationQuaternion.copyFrom(p.rotationQuaternion)
                    : (f.rotationQuaternion = p.rotationQuaternion.clone())),
                p.color &&
                  (f.color
                    ? f.color.copyFrom(p.color)
                    : (f.color = p.color.clone())),
                f.scaling.copyFrom(p.scaling),
                f.uvs.copyFrom(p.uvs),
                null !== p.materialIndex && (f.materialIndex = p.materialIndex),
                this.expandable && (this._idxOfId[f.id] = f.idx)),
              c ||
                ((this._index += n.length),
                this.nbParticles++,
                this._lastParticleId++),
              f
            );
          }),
          (e.prototype.setParticles = function (e, t, i) {
            if (
              (void 0 === e && (e = 0),
              void 0 === t && (t = this.nbParticles - 1),
              void 0 === i && (i = !0),
              !this._updatable || this._isNotBuilt)
            )
              return this;
            this.beforeUpdateParticles(e, t, i);
            var n = y.Matrix[0],
              r = y.Matrix[1],
              o = this.mesh,
              s = this._colors32,
              a = this._positions32,
              l = this._normals32,
              c = this._uvs32,
              u = this._indices32,
              h = this._indices,
              d = this._fixedNormal32,
              p = y.Vector3,
              _ = p[5].copyFromFloats(1, 0, 0),
              m = p[6].copyFromFloats(0, 1, 0),
              v = p[7].copyFromFloats(0, 0, 1),
              b = p[8].setAll(Number.MAX_VALUE),
              T = p[9].setAll(-Number.MAX_VALUE),
              S = p[10].setAll(0),
              C = this._tmpVertex,
              x = C.position,
              E = C.color,
              P = C.uv;
            if (
              ((this.billboard || this._depthSort) &&
                (this.mesh.computeWorldMatrix(!0),
                this.mesh._worldMatrix.invertToRef(r)),
              this.billboard)
            ) {
              var A = p[0];
              this._camera.getDirectionToRef(Pt.Z, A),
                f.TransformNormalToRef(A, r, v),
                v.normalize();
              var R = this._camera.getViewMatrix(!0);
              f.TransformNormalFromFloatsToRef(R.m[1], R.m[5], R.m[9], r, m),
                f.CrossToRef(m, v, _),
                m.normalize(),
                _.normalize();
            }
            this._depthSort &&
              f.TransformCoordinatesToRef(this._camera.globalPosition, r, S),
              g.IdentityToRef(n);
            var M = 0,
              O = 0,
              I = 0,
              D = 0,
              w = 0,
              N = 0,
              L = 0;
            if (
              (this.mesh.isFacetDataEnabled && (this._computeBoundingBox = !0),
              (t = t >= this.nbParticles ? this.nbParticles - 1 : t),
              this._computeBoundingBox && (0 != e || t != this.nbParticles - 1))
            ) {
              var F = this.mesh._boundingInfo;
              F && (b.copyFrom(F.minimum), T.copyFrom(F.maximum));
            }
            var B = ((O = this.particles[e]._pos) / 3) | 0;
            (D = 4 * B), (N = 2 * B);
            for (var V = e; V <= t; V++) {
              var k = this.particles[V];
              this.updateParticle(k);
              var U = k._model._shape,
                z = k._model._shapeUV,
                G = k._rotationMatrix,
                W = k.position,
                H = k.rotation,
                j = k.scaling,
                X = k._globalPosition;
              if (this._depthSort && this._depthSortParticles) {
                var Y = this.depthSortedParticles[V];
                (Y.idx = k.idx),
                  (Y.ind = k._ind),
                  (Y.indicesLength = k._model._indicesLength),
                  (Y.sqDistance = f.DistanceSquared(k.position, S));
              }
              if (!k.alive || (k._stillInvisible && !k.isVisible))
                (O += 3 * (L = U.length)), (D += 4 * L), (N += 2 * L);
              else {
                if (k.isVisible) {
                  k._stillInvisible = !1;
                  var K = p[12];
                  if (
                    (k.pivot.multiplyToRef(j, K),
                    this.billboard && ((H.x = 0), (H.y = 0)),
                    (this._computeParticleRotation || this.billboard) &&
                      k.getRotationMatrix(n),
                    null !== k.parentId)
                  ) {
                    var Q = this.getParticleById(k.parentId);
                    if (Q) {
                      var q = Q._rotationMatrix,
                        Z = Q._globalPosition,
                        J = W.x * q[1] + W.y * q[4] + W.z * q[7],
                        $ = W.x * q[0] + W.y * q[3] + W.z * q[6],
                        ee = W.x * q[2] + W.y * q[5] + W.z * q[8];
                      if (
                        ((X.x = Z.x + $),
                        (X.y = Z.y + J),
                        (X.z = Z.z + ee),
                        this._computeParticleRotation || this.billboard)
                      ) {
                        var te = n.m;
                        (G[0] = te[0] * q[0] + te[1] * q[3] + te[2] * q[6]),
                          (G[1] = te[0] * q[1] + te[1] * q[4] + te[2] * q[7]),
                          (G[2] = te[0] * q[2] + te[1] * q[5] + te[2] * q[8]),
                          (G[3] = te[4] * q[0] + te[5] * q[3] + te[6] * q[6]),
                          (G[4] = te[4] * q[1] + te[5] * q[4] + te[6] * q[7]),
                          (G[5] = te[4] * q[2] + te[5] * q[5] + te[6] * q[8]),
                          (G[6] = te[8] * q[0] + te[9] * q[3] + te[10] * q[6]),
                          (G[7] = te[8] * q[1] + te[9] * q[4] + te[10] * q[7]),
                          (G[8] = te[8] * q[2] + te[9] * q[5] + te[10] * q[8]);
                      }
                    } else k.parentId = null;
                  } else
                    (X.x = W.x),
                      (X.y = W.y),
                      (X.z = W.z),
                      (this._computeParticleRotation || this.billboard) &&
                        ((te = n.m),
                        (G[0] = te[0]),
                        (G[1] = te[1]),
                        (G[2] = te[2]),
                        (G[3] = te[4]),
                        (G[4] = te[5]),
                        (G[5] = te[6]),
                        (G[6] = te[8]),
                        (G[7] = te[9]),
                        (G[8] = te[10]));
                  var ie = p[11];
                  for (
                    k.translateFromPivot ? ie.setAll(0) : ie.copyFrom(K), L = 0;
                    L < U.length;
                    L++
                  ) {
                    (M = O + 3 * L), (I = D + 4 * L), (w = N + 2 * L);
                    var ne = 2 * L,
                      re = ne + 1;
                    x.copyFrom(U[L]),
                      this._computeParticleColor &&
                        k.color &&
                        E.copyFrom(k.color),
                      this._computeParticleTexture &&
                        P.copyFromFloats(z[ne], z[re]),
                      this._computeParticleVertex &&
                        this.updateParticleVertex(k, C, L);
                    var oe = x.x * j.x - K.x,
                      se = x.y * j.y - K.y,
                      ae = x.z * j.z - K.z;
                    ($ = oe * G[0] + se * G[3] + ae * G[6]),
                      (J = oe * G[1] + se * G[4] + ae * G[7]),
                      (ee = oe * G[2] + se * G[5] + ae * G[8]),
                      ($ += ie.x),
                      (J += ie.y),
                      (ee += ie.z);
                    var le = (a[M] = X.x + _.x * $ + m.x * J + v.x * ee),
                      ce = (a[M + 1] = X.y + _.y * $ + m.y * J + v.y * ee),
                      ue = (a[M + 2] = X.z + _.z * $ + m.z * J + v.z * ee);
                    if (
                      (this._computeBoundingBox &&
                        (b.minimizeInPlaceFromFloats(le, ce, ue),
                        T.maximizeInPlaceFromFloats(le, ce, ue)),
                      !this._computeParticleVertex)
                    ) {
                      var he = d[M],
                        de = d[M + 1],
                        pe = d[M + 2],
                        fe = he * G[0] + de * G[3] + pe * G[6],
                        _e = he * G[1] + de * G[4] + pe * G[7],
                        me = he * G[2] + de * G[5] + pe * G[8];
                      (l[M] = _.x * fe + m.x * _e + v.x * me),
                        (l[M + 1] = _.y * fe + m.y * _e + v.y * me),
                        (l[M + 2] = _.z * fe + m.z * _e + v.z * me);
                    }
                    if (this._computeParticleColor && k.color) {
                      var ge = this._colors32;
                      (ge[I] = E.r),
                        (ge[I + 1] = E.g),
                        (ge[I + 2] = E.b),
                        (ge[I + 3] = E.a);
                    }
                    if (this._computeParticleTexture) {
                      var ve = k.uvs;
                      (c[w] = P.x * (ve.z - ve.x) + ve.x),
                        (c[w + 1] = P.y * (ve.w - ve.y) + ve.y);
                    }
                  }
                } else
                  for (k._stillInvisible = !0, L = 0; L < U.length; L++) {
                    if (
                      ((I = D + 4 * L),
                      (w = N + 2 * L),
                      (a[(M = O + 3 * L)] = a[M + 1] = a[M + 2] = 0),
                      (l[M] = l[M + 1] = l[M + 2] = 0),
                      this._computeParticleColor && k.color)
                    ) {
                      var ye = k.color;
                      (s[I] = ye.r),
                        (s[I + 1] = ye.g),
                        (s[I + 2] = ye.b),
                        (s[I + 3] = ye.a);
                    }
                    this._computeParticleTexture &&
                      ((ve = k.uvs),
                      (c[w] = z[2 * L] * (ve.z - ve.x) + ve.x),
                      (c[w + 1] = z[2 * L + 1] * (ve.w - ve.y) + ve.y));
                  }
                if (this._particlesIntersect) {
                  var be = k._boundingInfo,
                    Te = be.boundingBox,
                    Se = be.boundingSphere,
                    Ce = k._modelBoundingInfo;
                  if (!this._bSphereOnly) {
                    var xe = Ce.boundingBox.vectors,
                      Ee = p[1],
                      Pe = p[2];
                    Ee.setAll(Number.MAX_VALUE), Pe.setAll(-Number.MAX_VALUE);
                    for (var Ae = 0; Ae < 8; Ae++) {
                      var Re = xe[Ae].x * j.x,
                        Me = xe[Ae].y * j.y,
                        Oe = xe[Ae].z * j.z,
                        Ie =
                          (($ = Re * G[0] + Me * G[3] + Oe * G[6]),
                          (J = Re * G[1] + Me * G[4] + Oe * G[7]),
                          (ee = Re * G[2] + Me * G[5] + Oe * G[8]),
                          W.x + _.x * $ + m.x * J + v.x * ee),
                        De = W.y + _.y * $ + m.y * J + v.y * ee,
                        we = W.z + _.z * $ + m.z * J + v.z * ee;
                      Ee.minimizeInPlaceFromFloats(Ie, De, we),
                        Pe.maximizeInPlaceFromFloats(Ie, De, we);
                    }
                    Te.reConstruct(Ee, Pe, o._worldMatrix);
                  }
                  var Ne = Ce.minimum.multiplyToRef(j, p[1]),
                    Le = Ce.maximum.multiplyToRef(j, p[2]),
                    Fe = Le.addToRef(Ne, p[3]).scaleInPlace(0.5).addInPlace(X),
                    Be = Le.subtractToRef(Ne, p[4]).scaleInPlace(
                      0.5 * this._bSphereRadiusFactor
                    ),
                    Ve = Fe.subtractToRef(Be, p[1]),
                    ke = Fe.addToRef(Be, p[2]);
                  Se.reConstruct(Ve, ke, o._worldMatrix);
                }
                (O = M + 3), (D = I + 4), (N = w + 2);
              }
            }
            if (i) {
              if (
                (this._computeParticleColor &&
                  o.updateVerticesData(wt.ColorKind, s, !1, !1),
                this._computeParticleTexture &&
                  o.updateVerticesData(wt.UVKind, c, !1, !1),
                o.updateVerticesData(wt.PositionKind, a, !1, !1),
                !o.areNormalsFrozen || o.isFacetDataEnabled)
              ) {
                if (this._computeParticleVertex || o.isFacetDataEnabled) {
                  var Ue = o.isFacetDataEnabled
                    ? o.getFacetDataParameters()
                    : null;
                  Nt.ComputeNormals(a, u, l, Ue);
                  for (var ze = 0; ze < l.length; ze++) d[ze] = l[ze];
                }
                o.areNormalsFrozen ||
                  o.updateVerticesData(wt.NormalKind, l, !1, !1);
              }
              if (this._depthSort && this._depthSortParticles) {
                var Ge = this.depthSortedParticles;
                Ge.sort(this._depthSortFunction);
                for (
                  var We = Ge.length, He = 0, je = 0, Xe = 0;
                  Xe < We;
                  Xe++
                ) {
                  var Ye = Ge[Xe],
                    Ke = Ye.indicesLength,
                    Qe = Ye.ind;
                  for (ze = 0; ze < Ke; ze++)
                    if (
                      ((u[He] = h[Qe + ze]),
                      He++,
                      this._pickable && 0 == ze % 3)
                    ) {
                      var qe = this.pickedParticles[je];
                      (qe.idx = Ye.idx), (qe.faceId = je), je++;
                    }
                }
                o.updateIndices(u);
              }
            }
            return (
              this._computeBoundingBox &&
                (o._boundingInfo
                  ? o._boundingInfo.reConstruct(b, T, o._worldMatrix)
                  : (o._boundingInfo = new Gt(b, T, o._worldMatrix))),
              this._autoUpdateSubMeshes && this.computeSubMeshes(),
              this.afterUpdateParticles(e, t, i),
              this
            );
          }),
          (e.prototype.dispose = function () {
            this.mesh.dispose(),
              (this.vars = null),
              (this._positions = null),
              (this._indices = null),
              (this._normals = null),
              (this._uvs = null),
              (this._colors = null),
              (this._indices32 = null),
              (this._positions32 = null),
              (this._normals32 = null),
              (this._fixedNormal32 = null),
              (this._uvs32 = null),
              (this._colors32 = null),
              (this.pickedParticles = null),
              (this.pickedBySubMesh = null),
              (this._materials = null),
              (this._materialIndexes = null),
              (this._indicesByMaterial = null),
              (this._idxOfId = null);
          }),
          (e.prototype.pickedParticle = function (e) {
            if (e.hit) {
              var t = e.subMeshId,
                i = e.faceId,
                n = this.pickedBySubMesh;
              if (n[t] && n[t][i]) return n[t][i];
            }
            return null;
          }),
          (e.prototype.getParticleById = function (e) {
            var t = this.particles[e];
            if (t && t.id == e) return t;
            var i = this.particles,
              n = this._idxOfId[e];
            if (void 0 !== n) return i[n];
            for (var r = 0, o = this.nbParticles; r < o; ) {
              var s = i[r];
              if (s.id == e) return s;
              r++;
            }
            return null;
          }),
          (e.prototype.getParticlesByShapeId = function (e) {
            var t = [];
            return this.getParticlesByShapeIdToRef(e, t), t;
          }),
          (e.prototype.getParticlesByShapeIdToRef = function (e, t) {
            t.length = 0;
            for (var i = 0; i < this.nbParticles; i++) {
              var n = this.particles[i];
              n.shapeId == e && t.push(n);
            }
            return this;
          }),
          (e.prototype.computeSubMeshes = function () {
            if (!this.mesh || !this._multimaterialEnabled) return this;
            var e = this.depthSortedParticles;
            if (this.particles.length > 0)
              for (var t = 0; t < this.particles.length; t++) {
                var i = this.particles[t];
                i.materialIndex || (i.materialIndex = 0);
                var n = e[t];
                (n.materialIndex = i.materialIndex),
                  (n.ind = i._ind),
                  (n.indicesLength = i._model._indicesLength),
                  (n.idx = i.idx);
              }
            this._sortParticlesByMaterial();
            var r = this._indicesByMaterial,
              o = this._materialIndexes,
              s = this.mesh;
            s.subMeshes = [];
            for (var a = s.getTotalVertices(), l = 0; l < o.length; l++) {
              var c = r[l],
                u = r[l + 1] - c,
                h = o[l];
              new oi(h, 0, a, c, u, s);
            }
            return this;
          }),
          (e.prototype._sortParticlesByMaterial = function () {
            var e = [0];
            this._indicesByMaterial = e;
            var t = [];
            this._materialIndexes = t;
            var i = this.depthSortedParticles;
            i.sort(this._materialSortFunction);
            var n = i.length,
              r = this._indices32,
              o = this._indices,
              s = 0,
              a = 0,
              l = 0,
              c = i[0].materialIndex;
            t.push(c),
              this._pickable &&
                ((this.pickedBySubMesh = [[]]),
                (this.pickedParticles = this.pickedBySubMesh[0]));
            for (var u = 0; u < n; u++) {
              var h = i[u],
                d = h.indicesLength,
                p = h.ind;
              h.materialIndex !== c &&
                ((c = h.materialIndex),
                e.push(l),
                t.push(c),
                this._pickable &&
                  (s++, (this.pickedBySubMesh[s] = []), (a = 0)));
              for (var f = 0, _ = 0; _ < d; _++) {
                if (((r[l] = o[p + _]), this._pickable && 0 == _ % 3)) {
                  var m = this.pickedBySubMesh[s][a];
                  m
                    ? ((m.idx = h.idx), (m.faceId = f))
                    : (this.pickedBySubMesh[s][a] = {
                        idx: h.idx,
                        faceId: f,
                      }),
                    a++,
                    f++;
                }
                l++;
              }
            }
            return (
              e.push(r.length),
              this._updatable && this.mesh.updateIndices(r),
              this
            );
          }),
          (e.prototype._setMaterialIndexesById = function () {
            this._materialIndexesById = {};
            for (var e = 0; e < this._materials.length; e++) {
              var t = this._materials[e].uniqueId;
              this._materialIndexesById[t] = e;
            }
          }),
          (e.prototype._filterUniqueMaterialId = function (e) {
            return e.filter(function (e, t, i) {
              return i.indexOf(e) === t;
            });
          }),
          (e.prototype._setDefaultMaterial = function () {
            return (
              this._defaultMaterial ||
                (this._defaultMaterial = new qr(
                  this.name + "DefaultMaterial",
                  this._scene
                )),
              this._defaultMaterial
            );
          }),
          (e.prototype.refreshVisibleSize = function () {
            return (
              this._isVisibilityBoxLocked || this.mesh.refreshBoundingInfo(),
              this
            );
          }),
          (e.prototype.setVisibilityBox = function (e) {
            var t = e / 2;
            this.mesh._boundingInfo = new Gt(new f(-t, -t, -t), new f(t, t, t));
          }),
          Object.defineProperty(e.prototype, "isAlwaysVisible", {
            get: function () {
              return this._alwaysVisible;
            },
            set: function (e) {
              (this._alwaysVisible = e),
                (this.mesh.alwaysSelectAsActiveMesh = e);
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "isVisibilityBoxLocked", {
            get: function () {
              return this._isVisibilityBoxLocked;
            },
            set: function (e) {
              (this._isVisibilityBoxLocked = e),
                (this.mesh.getBoundingInfo().isLocked = e);
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "computeParticleRotation", {
            get: function () {
              return this._computeParticleRotation;
            },
            set: function (e) {
              this._computeParticleRotation = e;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "computeParticleColor", {
            get: function () {
              return this._computeParticleColor;
            },
            set: function (e) {
              this._computeParticleColor = e;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "computeParticleTexture", {
            get: function () {
              return this._computeParticleTexture;
            },
            set: function (e) {
              this._computeParticleTexture = e;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "computeParticleVertex", {
            get: function () {
              return this._computeParticleVertex;
            },
            set: function (e) {
              this._computeParticleVertex = e;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "computeBoundingBox", {
            get: function () {
              return this._computeBoundingBox;
            },
            set: function (e) {
              this._computeBoundingBox = e;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "depthSortParticles", {
            get: function () {
              return this._depthSortParticles;
            },
            set: function (e) {
              this._depthSortParticles = e;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "expandable", {
            get: function () {
              return this._expandable;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "multimaterialEnabled", {
            get: function () {
              return this._multimaterialEnabled;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "useModelMaterial", {
            get: function () {
              return this._useModelMaterial;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "materials", {
            get: function () {
              return this._materials;
            },
            enumerable: !1,
            configurable: !0,
          }),
          (e.prototype.setMultiMaterial = function (e) {
            (this._materials = this._filterUniqueMaterialId(e)),
              this._setMaterialIndexesById(),
              this._multimaterial && this._multimaterial.dispose(),
              (this._multimaterial = new Gi(
                this.name + "MultiMaterial",
                this._scene
              ));
            for (var t = 0; t < this._materials.length; t++)
              this._multimaterial.subMaterials.push(this._materials[t]);
            this.computeSubMeshes(), (this.mesh.material = this._multimaterial);
          }),
          Object.defineProperty(e.prototype, "multimaterial", {
            get: function () {
              return this._multimaterial;
            },
            set: function (e) {
              this._multimaterial = e;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "autoUpdateSubMeshes", {
            get: function () {
              return this._autoUpdateSubMeshes;
            },
            set: function (e) {
              this._autoUpdateSubMeshes = e;
            },
            enumerable: !1,
            configurable: !0,
          }),
          (e.prototype.initParticles = function () {}),
          (e.prototype.recycleParticle = function (e) {
            return e;
          }),
          (e.prototype.updateParticle = function (e) {
            return e;
          }),
          (e.prototype.updateParticleVertex = function (e, t, i) {
            return this;
          }),
          (e.prototype.beforeUpdateParticles = function (e, t, i) {}),
          (e.prototype.afterUpdateParticles = function (e, t, i) {});
      })(),
      (function () {
        function e(e, t, i, n, r) {
          (this.idx = 0),
            (this.color = new T(1, 1, 1, 1)),
            (this.position = f.Zero()),
            (this.rotation = f.Zero()),
            (this.uv = new p(0, 0)),
            (this.velocity = f.Zero()),
            (this.pivot = f.Zero()),
            (this.translateFromPivot = !1),
            (this._pos = 0),
            (this._ind = 0),
            (this.groupId = 0),
            (this.idxInGroup = 0),
            (this._stillInvisible = !1),
            (this._rotationMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1]),
            (this.parentId = null),
            (this._globalPosition = f.Zero()),
            (this.idx = e),
            (this._group = t),
            (this.groupId = i),
            (this.idxInGroup = n),
            (this._pcs = r);
        }
        return (
          Object.defineProperty(e.prototype, "size", {
            get: function () {
              return this.size;
            },
            set: function (e) {
              this.size = e;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "quaternion", {
            get: function () {
              return this.rotationQuaternion;
            },
            set: function (e) {
              this.rotationQuaternion = e;
            },
            enumerable: !1,
            configurable: !0,
          }),
          (e.prototype.intersectsMesh = function (e, t) {
            if (!e._boundingInfo) return !1;
            if ((t = t || !1))
              return e
                .getBoundingInfo()
                .boundingSphere.intersectsPoint(
                  this.position.add(this._pcs.mesh.position)
                );
            var i, n, r, o, s, a;
            (i = e.getBoundingInfo().boundingBox.maximumWorld.x),
              (n = e.getBoundingInfo().boundingBox.minimumWorld.x),
              (r = e.getBoundingInfo().boundingBox.maximumWorld.y),
              (o = e.getBoundingInfo().boundingBox.minimumWorld.y),
              (s = e.getBoundingInfo().boundingBox.maximumWorld.z),
              (a = e.getBoundingInfo().boundingBox.minimumWorld.z);
            var l = this.position.x + this._pcs.mesh.position.x,
              c = this.position.y + this._pcs.mesh.position.y,
              u = this.position.z + this._pcs.mesh.position.z;
            return n <= l && l <= i && o <= c && c <= r && a <= u && u <= s;
          }),
          (e.prototype.getRotationMatrix = function (e) {
            var t;
            if (this.rotationQuaternion) t = this.rotationQuaternion;
            else {
              t = y.Quaternion[0];
              var i = this.rotation;
              m.RotationYawPitchRollToRef(i.y, i.x, i.z, t);
            }
            t.toRotationMatrix(e);
          }),
          e
        );
      })()),
    zh = function (e, t) {
      (this.groupID = e), (this._positionFunction = t);
    };
  !(function (e) {
    (e[(e.Color = 2)] = "Color"),
      (e[(e.UV = 1)] = "UV"),
      (e[(e.Random = 0)] = "Random"),
      (e[(e.Stated = 3)] = "Stated");
  })(Lh || (Lh = {})),
    (function () {
      function e(e, t, i, n) {
        (this.particles = new Array()),
          (this.nbParticles = 0),
          (this.counter = 0),
          (this.vars = {}),
          (this._promises = []),
          (this._positions = new Array()),
          (this._indices = new Array()),
          (this._normals = new Array()),
          (this._colors = new Array()),
          (this._uvs = new Array()),
          (this._updatable = !0),
          (this._isVisibilityBoxLocked = !1),
          (this._alwaysVisible = !1),
          (this._groups = new Array()),
          (this._groupCounter = 0),
          (this._computeParticleColor = !0),
          (this._computeParticleTexture = !0),
          (this._computeParticleRotation = !0),
          (this._computeBoundingBox = !1),
          (this._isReady = !1),
          (this.name = e),
          (this._size = t),
          (this._scene = i || j.LastCreatedScene),
          n && void 0 !== n.updatable
            ? (this._updatable = n.updatable)
            : (this._updatable = !0);
      }
      (e.prototype.buildMeshAsync = function () {
        var e = this;
        return Promise.all(this._promises).then(function () {
          return (e._isReady = !0), e._buildMesh();
        });
      }),
        (e.prototype._buildMesh = function () {
          0 === this.nbParticles && this.addPoints(1),
            (this._positions32 = new Float32Array(this._positions)),
            (this._uvs32 = new Float32Array(this._uvs)),
            (this._colors32 = new Float32Array(this._colors));
          var e = new Nt();
          e.set(this._positions32, wt.PositionKind),
            this._uvs32.length > 0 && e.set(this._uvs32, wt.UVKind);
          var t = 0;
          this._colors32.length > 0 &&
            ((t = 1), e.set(this._colors32, wt.ColorKind));
          var i = new Qi(this.name, this._scene);
          e.applyToMesh(i, this._updatable),
            (this.mesh = i),
            (this._positions = null),
            (this._uvs = null),
            (this._colors = null),
            this._updatable || (this.particles.length = 0);
          var n = new qr("point cloud material", this._scene);
          return (
            (n.emissiveColor = new b(t, t, t)),
            (n.disableLighting = !0),
            (n.pointsCloud = !0),
            (n.pointSize = this._size),
            (i.material = n),
            new Promise(function (e) {
              return e(i);
            })
          );
        }),
        (e.prototype._addParticle = function (e, t, i, n) {
          var r = new Uh(e, t, i, n, this);
          return this.particles.push(r), r;
        }),
        (e.prototype._randomUnitVector = function (e) {
          (e.position = new f(Math.random(), Math.random(), Math.random())),
            (e.color = new T(1, 1, 1, 1));
        }),
        (e.prototype._getColorIndicesForCoord = function (e, t, i, n) {
          var r = e._groupImageData,
            o = i * (4 * n) + 4 * t,
            s = [o, o + 1, o + 2, o + 3],
            a = s[1],
            l = s[2],
            c = s[3],
            u = r[s[0]],
            h = r[a],
            d = r[l],
            p = r[c];
          return new T(u / 255, h / 255, d / 255, p);
        }),
        (e.prototype._setPointsColorOrUV = function (e, t, i, n, r, o, a) {
          i && e.updateFacetData();
          var l = 2 * e.getBoundingInfo().boundingSphere.radius,
            c = e.getVerticesData(wt.PositionKind),
            u = e.getIndices(),
            h = e.getVerticesData(wt.UVKind),
            d = e.getVerticesData(wt.ColorKind),
            m = f.Zero();
          e.computeWorldMatrix();
          var g = e.getWorldMatrix();
          if (!g.isIdentity())
            for (var v = 0; v < c.length / 3; v++)
              f.TransformCoordinatesFromFloatsToRef(
                c[3 * v],
                c[3 * v + 1],
                c[3 * v + 2],
                g,
                m
              ),
                (c[3 * v] = m.x),
                (c[3 * v + 1] = m.y),
                (c[3 * v + 2] = m.z);
          var y,
            S,
            C = 0,
            x = 0,
            E = 0,
            P = 0,
            A = 0,
            R = 0,
            M = 0,
            O = 0,
            I = 0,
            D = 0,
            w = 0,
            N = 0,
            L = 0,
            F = 0,
            B = f.Zero(),
            V = f.Zero(),
            k = f.Zero(),
            U = f.Zero(),
            z = f.Zero(),
            G = 0,
            W = 0,
            H = 0,
            j = 0,
            X = 0,
            Y = 0,
            K = p.Zero(),
            Q = p.Zero(),
            q = p.Zero(),
            Z = p.Zero(),
            J = p.Zero(),
            $ = 0,
            ee = 0,
            te = 0,
            ie = 0,
            ne = 0,
            re = 0,
            oe = 0,
            se = 0,
            ae = 0,
            le = 0,
            ce = 0,
            ue = 0,
            he = _.Zero(),
            de = _.Zero(),
            pe = _.Zero(),
            fe = _.Zero(),
            _e = _.Zero(),
            me = 0,
            ge = 0;
          a = a || 0;
          var ve,
            ye = new _(0, 0, 0, 0),
            be = f.Zero(),
            Te = f.Zero(),
            Se = f.Zero(),
            Ce = 0,
            xe = f.Zero(),
            Ee = 0,
            Pe = 0,
            Ae = new cn(f.Zero(), new f(1, 0, 0)),
            Re = f.Zero();
          for (x = 0; x < u.length / 3; x++) {
            var Me, Oe, Ie, De, we, Ne, Le, Fe;
            (E = u[3 * x]),
              (P = u[3 * x + 1]),
              (A = u[3 * x + 2]),
              (R = c[3 * E]),
              (M = c[3 * E + 1]),
              (O = c[3 * E + 2]),
              (I = c[3 * P]),
              (D = c[3 * P + 1]),
              (w = c[3 * P + 2]),
              (N = c[3 * A]),
              (L = c[3 * A + 1]),
              (F = c[3 * A + 2]),
              B.set(R, M, O),
              V.set(I, D, w),
              k.set(N, L, F),
              V.subtractToRef(B, U),
              k.subtractToRef(V, z),
              h &&
                ((G = h[2 * E]),
                (W = h[2 * E + 1]),
                (H = h[2 * P]),
                (j = h[2 * P + 1]),
                (X = h[2 * A]),
                (Y = h[2 * A + 1]),
                K.set(G, W),
                Q.set(H, j),
                q.set(X, Y),
                Q.subtractToRef(K, Z),
                q.subtractToRef(Q, J)),
              d &&
                n &&
                (($ = d[4 * E]),
                (ee = d[4 * E + 1]),
                (te = d[4 * E + 2]),
                (ie = d[4 * E + 3]),
                (ne = d[4 * P]),
                (re = d[4 * P + 1]),
                (oe = d[4 * P + 2]),
                (se = d[4 * P + 3]),
                (ae = d[4 * A]),
                (le = d[4 * A + 1]),
                (ce = d[4 * A + 2]),
                (ue = d[4 * A + 3]),
                he.set($, ee, te, ie),
                de.set(ne, re, oe, se),
                pe.set(ae, le, ce, ue),
                de.subtractToRef(he, fe),
                pe.subtractToRef(de, _e));
            for (
              var Be, Ve, ke = new b(0, 0, 0), Ue = new b(0, 0, 0), ze = 0;
              ze < t._groupDensity[x];
              ze++
            )
              (C = this.particles.length),
                this._addParticle(C, t, this._groupCounter, x + ze),
                (Ve = this.particles[C]),
                (me = s.RandomRange(0, 1)),
                (ge = s.RandomRange(0, 1)),
                (y = B.add(U.scale(me)).add(z.scale(me * ge))),
                i &&
                  ((be = e.getFacetNormal(x).normalize().scale(-1)),
                  (Te = U.clone().normalize()),
                  (Se = f.Cross(be, Te)),
                  (Ce = s.RandomRange(0, 2 * Math.PI)),
                  (xe = Te.scale(Math.cos(Ce)).add(Se.scale(Math.sin(Ce)))),
                  (Ce = s.RandomRange(0.1, Math.PI / 2)),
                  (Re = xe.scale(Math.cos(Ce)).add(be.scale(Math.sin(Ce)))),
                  (Ae.origin = y.add(Re.scale(1e-5))),
                  (Ae.direction = Re),
                  (Ae.length = l),
                  (ve = Ae.intersectsMesh(e)).hit &&
                    ((Pe = ve.pickedPoint.subtract(y).length()),
                    (Ee = s.RandomRange(0, 1) * Pe),
                    y.addInPlace(Re.scale(Ee)))),
                (Ve.position = y.clone()),
                this._positions.push(
                  Ve.position.x,
                  Ve.position.y,
                  Ve.position.z
                ),
                void 0 !== n
                  ? h &&
                    ((S = K.add(Z.scale(me)).add(J.scale(me * ge))),
                    n
                      ? r && null !== t._groupImageData
                        ? ((Me = t._groupImgWidth),
                          (Oe = t._groupImgHeight),
                          (Be = this._getColorIndicesForCoord(
                            t,
                            Math.round(S.x * Me),
                            Math.round(S.y * Oe),
                            Me
                          )),
                          (Ve.color = Be),
                          this._colors.push(Be.r, Be.g, Be.b, Be.a))
                        : d
                          ? ((ye = he.add(fe.scale(me)).add(_e.scale(me * ge))),
                            (Ve.color = new T(ye.x, ye.y, ye.z, ye.w)),
                            this._colors.push(ye.x, ye.y, ye.z, ye.w))
                          : ((ye = he.set(
                              Math.random(),
                              Math.random(),
                              Math.random(),
                              1
                            )),
                            (Ve.color = new T(ye.x, ye.y, ye.z, ye.w)),
                            this._colors.push(ye.x, ye.y, ye.z, ye.w))
                      : ((Ve.uv = S.clone()), this._uvs.push(Ve.uv.x, Ve.uv.y)))
                  : (o
                      ? (ke.set(o.r, o.g, o.b),
                        (Ie = s.RandomRange(-a, a)),
                        (De = s.RandomRange(-a, a)),
                        (we = (Fe = ke.toHSV()).r),
                        (Ne = Fe.g + Ie) < 0 && (Ne = 0),
                        Ne > 1 && (Ne = 1),
                        (Le = Fe.b + De) < 0 && (Le = 0),
                        Le > 1 && (Le = 1),
                        b.HSVtoRGBToRef(we, Ne, Le, Ue),
                        ye.set(Ue.r, Ue.g, Ue.b, 1))
                      : (ye = he.set(
                          Math.random(),
                          Math.random(),
                          Math.random(),
                          1
                        )),
                    (Ve.color = new T(ye.x, ye.y, ye.z, ye.w)),
                    this._colors.push(ye.x, ye.y, ye.z, ye.w));
          }
        }),
        (e.prototype._colorFromTexture = function (e, t, i) {
          var n = this;
          if (null === e.material)
            return (
              F.Warn(e.name + "has no material."),
              (t._groupImageData = null),
              void this._setPointsColorOrUV(e, t, i, !0, !1)
            );
          var r = e.material.getActiveTextures();
          if (0 === r.length)
            return (
              F.Warn(e.name + "has no useable texture."),
              (t._groupImageData = null),
              void this._setPointsColorOrUV(e, t, i, !0, !1)
            );
          var o = e.clone();
          o.setEnabled(!1),
            this._promises.push(
              new Promise(function (e) {
                fn.WhenAllReady(r, function () {
                  var s = t._textureNb;
                  return (
                    s < 0 && (s = 0),
                    s > r.length - 1 && (s = r.length - 1),
                    (t._groupImageData = r[s].readPixels()),
                    (t._groupImgWidth = r[s].getSize().width),
                    (t._groupImgHeight = r[s].getSize().height),
                    n._setPointsColorOrUV(o, t, i, !0, !0),
                    o.dispose(),
                    e()
                  );
                });
              })
            );
        }),
        (e.prototype._calculateDensity = function (e, t, i) {
          for (
            var n,
              r,
              o,
              s,
              a,
              l,
              c,
              u,
              h,
              d,
              p,
              _,
              m,
              g,
              v,
              y,
              b,
              T = new Array(),
              S = f.Zero(),
              C = f.Zero(),
              x = f.Zero(),
              E = f.Zero(),
              P = f.Zero(),
              A = f.Zero(),
              R = new Array(),
              M = 0,
              O = i.length / 3,
              I = 0;
            I < O;
            I++
          )
            (n = i[3 * I]),
              (r = i[3 * I + 1]),
              (o = i[3 * I + 2]),
              (s = t[3 * n]),
              (a = t[3 * n + 1]),
              (l = t[3 * n + 2]),
              (c = t[3 * r]),
              (u = t[3 * r + 1]),
              (h = t[3 * r + 2]),
              (d = t[3 * o]),
              (p = t[3 * o + 1]),
              (_ = t[3 * o + 2]),
              S.set(s, a, l),
              C.set(c, u, h),
              x.set(d, p, _),
              C.subtractToRef(S, E),
              x.subtractToRef(C, P),
              x.subtractToRef(S, A),
              (y =
                ((m = E.length()) + (g = P.length()) + (v = A.length())) / 2),
              (M += b = Math.sqrt(y * (y - m) * (y - g) * (y - v))),
              (R[I] = b);
          var D = 0;
          for (I = 0; I < O; I++)
            (T[I] = Math.floor((e * R[I]) / M)), (D += T[I]);
          var w = e - D,
            N = Math.floor(w / O),
            L = w % O;
          for (
            N > 0 &&
              (T = T.map(function (e) {
                return e + N;
              })),
              I = 0;
            I < L;
            I++
          )
            T[I] += 1;
          return T;
        }),
        (e.prototype.addPoints = function (e, t) {
          void 0 === t && (t = this._randomUnitVector);
          for (
            var i,
              n = new zh(this._groupCounter, t),
              r = this.nbParticles,
              o = 0;
            o < e;
            o++
          )
            (i = this._addParticle(r, n, this._groupCounter, o)),
              n && n._positionFunction && n._positionFunction(i, r, o),
              this._positions.push(i.position.x, i.position.y, i.position.z),
              i.color &&
                this._colors.push(i.color.r, i.color.g, i.color.b, i.color.a),
              i.uv && this._uvs.push(i.uv.x, i.uv.y),
              r++;
          return (
            (this.nbParticles += e), this._groupCounter++, this._groupCounter
          );
        }),
        (e.prototype.addSurfacePoints = function (e, t, i, n, r) {
          var o = i || Lh.Random;
          (isNaN(o) || o < 0 || o > 3) && (o = Lh.Random);
          var s = e.getVerticesData(wt.PositionKind),
            a = e.getIndices();
          this._groups.push(this._groupCounter);
          var l = new zh(this._groupCounter, null);
          switch (
            ((l._groupDensity = this._calculateDensity(t, s, a)),
            o === Lh.Color
              ? (l._textureNb = n || 0)
              : (n = n || new T(1, 1, 1, 1)),
            o)
          ) {
            case Lh.Color:
              this._colorFromTexture(e, l, !1);
              break;
            case Lh.UV:
              this._setPointsColorOrUV(e, l, !1, !1, !1);
              break;
            case Lh.Random:
              this._setPointsColorOrUV(e, l, !1);
              break;
            case Lh.Stated:
              this._setPointsColorOrUV(e, l, !1, void 0, void 0, n, r);
          }
          return (
            (this.nbParticles += t),
            this._groupCounter++,
            this._groupCounter - 1
          );
        }),
        (e.prototype.addVolumePoints = function (e, t, i, n, r) {
          var o = i || Lh.Random;
          (isNaN(o) || o < 0 || o > 3) && (o = Lh.Random);
          var s = e.getVerticesData(wt.PositionKind),
            a = e.getIndices();
          this._groups.push(this._groupCounter);
          var l = new zh(this._groupCounter, null);
          switch (
            ((l._groupDensity = this._calculateDensity(t, s, a)),
            o === Lh.Color
              ? (l._textureNb = n || 0)
              : (n = n || new T(1, 1, 1, 1)),
            o)
          ) {
            case Lh.Color:
              this._colorFromTexture(e, l, !0);
              break;
            case Lh.UV:
              this._setPointsColorOrUV(e, l, !0, !1, !1);
              break;
            case Lh.Random:
              this._setPointsColorOrUV(e, l, !0);
              break;
            case Lh.Stated:
              this._setPointsColorOrUV(e, l, !0, void 0, void 0, n, r);
          }
          return (
            (this.nbParticles += t),
            this._groupCounter++,
            this._groupCounter - 1
          );
        }),
        (e.prototype.setParticles = function (e, t, i) {
          if (
            (void 0 === e && (e = 0),
            void 0 === t && (t = this.nbParticles - 1),
            void 0 === i && (i = !0),
            !this._updatable || !this._isReady)
          )
            return this;
          this.beforeUpdateParticles(e, t, i);
          var n = y.Matrix[0],
            r = this.mesh,
            o = this._colors32,
            s = this._positions32,
            a = this._uvs32,
            l = y.Vector3,
            c = l[5].copyFromFloats(1, 0, 0),
            u = l[6].copyFromFloats(0, 1, 0),
            h = l[7].copyFromFloats(0, 0, 1),
            d = l[8].setAll(Number.MAX_VALUE),
            p = l[9].setAll(-Number.MAX_VALUE);
          g.IdentityToRef(n);
          var f = 0;
          if (
            (this.mesh.isFacetDataEnabled && (this._computeBoundingBox = !0),
            (t = t >= this.nbParticles ? this.nbParticles - 1 : t),
            this._computeBoundingBox && (0 != e || t != this.nbParticles - 1))
          ) {
            var _ = this.mesh._boundingInfo;
            _ && (d.copyFrom(_.minimum), p.copyFrom(_.maximum));
          }
          f = 0;
          for (var m = 0, v = 0, b = 0, T = e; T <= t; T++) {
            var S = this.particles[T];
            (m = 3 * (f = S.idx)),
              (v = 4 * f),
              (b = 2 * f),
              this.updateParticle(S);
            var C = S._rotationMatrix,
              x = S.position,
              E = S._globalPosition;
            if (
              (this._computeParticleRotation && S.getRotationMatrix(n),
              null !== S.parentId)
            ) {
              var P = this.particles[S.parentId],
                A = P._rotationMatrix,
                R = P._globalPosition,
                M = x.x * A[1] + x.y * A[4] + x.z * A[7],
                O = x.x * A[0] + x.y * A[3] + x.z * A[6],
                I = x.x * A[2] + x.y * A[5] + x.z * A[8];
              if (
                ((E.x = R.x + O),
                (E.y = R.y + M),
                (E.z = R.z + I),
                this._computeParticleRotation)
              ) {
                var D = n.m;
                (C[0] = D[0] * A[0] + D[1] * A[3] + D[2] * A[6]),
                  (C[1] = D[0] * A[1] + D[1] * A[4] + D[2] * A[7]),
                  (C[2] = D[0] * A[2] + D[1] * A[5] + D[2] * A[8]),
                  (C[3] = D[4] * A[0] + D[5] * A[3] + D[6] * A[6]),
                  (C[4] = D[4] * A[1] + D[5] * A[4] + D[6] * A[7]),
                  (C[5] = D[4] * A[2] + D[5] * A[5] + D[6] * A[8]),
                  (C[6] = D[8] * A[0] + D[9] * A[3] + D[10] * A[6]),
                  (C[7] = D[8] * A[1] + D[9] * A[4] + D[10] * A[7]),
                  (C[8] = D[8] * A[2] + D[9] * A[5] + D[10] * A[8]);
              }
            } else
              (E.x = 0),
                (E.y = 0),
                (E.z = 0),
                this._computeParticleRotation &&
                  ((D = n.m),
                  (C[0] = D[0]),
                  (C[1] = D[1]),
                  (C[2] = D[2]),
                  (C[3] = D[4]),
                  (C[4] = D[5]),
                  (C[5] = D[6]),
                  (C[6] = D[8]),
                  (C[7] = D[9]),
                  (C[8] = D[10]));
            var w = l[11];
            S.translateFromPivot ? w.setAll(0) : w.copyFrom(S.pivot);
            var N = l[0];
            N.copyFrom(S.position);
            var L = N.x - S.pivot.x,
              F = N.y - S.pivot.y,
              B = N.z - S.pivot.z,
              V = L * C[0] + F * C[3] + B * C[6],
              k = L * C[1] + F * C[4] + B * C[7],
              U = L * C[2] + F * C[5] + B * C[8];
            (V += w.x), (k += w.y), (U += w.z);
            var z = (s[m] = E.x + c.x * V + u.x * k + h.x * U),
              G = (s[m + 1] = E.y + c.y * V + u.y * k + h.y * U),
              W = (s[m + 2] = E.z + c.z * V + u.z * k + h.z * U);
            if (
              (this._computeBoundingBox &&
                (d.minimizeInPlaceFromFloats(z, G, W),
                p.maximizeInPlaceFromFloats(z, G, W)),
              this._computeParticleColor && S.color)
            ) {
              var H = S.color,
                j = this._colors32;
              (j[v] = H.r),
                (j[v + 1] = H.g),
                (j[v + 2] = H.b),
                (j[v + 3] = H.a);
            }
            if (this._computeParticleTexture && S.uv) {
              var X = S.uv,
                Y = this._uvs32;
              (Y[b] = X.x), (Y[b + 1] = X.y);
            }
          }
          return (
            i &&
              (this._computeParticleColor &&
                r.updateVerticesData(wt.ColorKind, o, !1, !1),
              this._computeParticleTexture &&
                r.updateVerticesData(wt.UVKind, a, !1, !1),
              r.updateVerticesData(wt.PositionKind, s, !1, !1)),
            this._computeBoundingBox &&
              (r._boundingInfo
                ? r._boundingInfo.reConstruct(d, p, r._worldMatrix)
                : (r._boundingInfo = new Gt(d, p, r._worldMatrix))),
            this.afterUpdateParticles(e, t, i),
            this
          );
        }),
        (e.prototype.dispose = function () {
          this.mesh.dispose(),
            (this.vars = null),
            (this._positions = null),
            (this._indices = null),
            (this._normals = null),
            (this._uvs = null),
            (this._colors = null),
            (this._indices32 = null),
            (this._positions32 = null),
            (this._uvs32 = null),
            (this._colors32 = null);
        }),
        (e.prototype.refreshVisibleSize = function () {
          return (
            this._isVisibilityBoxLocked || this.mesh.refreshBoundingInfo(), this
          );
        }),
        (e.prototype.setVisibilityBox = function (e) {
          var t = e / 2;
          this.mesh._boundingInfo = new Gt(new f(-t, -t, -t), new f(t, t, t));
        }),
        Object.defineProperty(e.prototype, "isAlwaysVisible", {
          get: function () {
            return this._alwaysVisible;
          },
          set: function (e) {
            (this._alwaysVisible = e), (this.mesh.alwaysSelectAsActiveMesh = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "computeParticleRotation", {
          set: function (e) {
            this._computeParticleRotation = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "computeParticleColor", {
          get: function () {
            return this._computeParticleColor;
          },
          set: function (e) {
            this._computeParticleColor = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "computeParticleTexture", {
          get: function () {
            return this._computeParticleTexture;
          },
          set: function (e) {
            this._computeParticleTexture = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "computeBoundingBox", {
          get: function () {
            return this._computeBoundingBox;
          },
          set: function (e) {
            this._computeBoundingBox = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.initParticles = function () {}),
        (e.prototype.recycleParticle = function (e) {
          return e;
        }),
        (e.prototype.updateParticle = function (e) {
          return e;
        }),
        (e.prototype.beforeUpdateParticles = function (e, t, i) {}),
        (e.prototype.afterUpdateParticles = function (e, t, i) {});
    })(),
    (Ci.prototype.getPhysicsEngine = function () {
      return this._physicsEngine;
    }),
    (Ci.prototype.enablePhysics = function (e, t) {
      if ((void 0 === e && (e = null), this._physicsEngine)) return !0;
      var i = this._getComponent(hi.NAME_PHYSICSENGINE);
      i || ((i = new Hh(this)), this._addComponent(i));
      try {
        return (
          (this._physicsEngine = new _l(e, t)),
          (this._physicsTimeAccumulator = 0),
          !0
        );
      } catch (e) {
        return F.Error(e.message), !1;
      }
    }),
    (Ci.prototype.disablePhysicsEngine = function () {
      this._physicsEngine &&
        (this._physicsEngine.dispose(), (this._physicsEngine = null));
    }),
    (Ci.prototype.isPhysicsEnabled = function () {
      return void 0 !== this._physicsEngine;
    }),
    (Ci.prototype.deleteCompoundImpostor = function (e) {
      var t = e.parts[0].mesh;
      t.physicsImpostor &&
        (t.physicsImpostor.dispose(), (t.physicsImpostor = null));
    }),
    (Ci.prototype._advancePhysicsEngineStep = function (e) {
      if (this._physicsEngine) {
        var t = this._physicsEngine.getSubTimeStep();
        if (t > 0)
          for (
            this._physicsTimeAccumulator += e;
            this._physicsTimeAccumulator > t;

          )
            this.onBeforePhysicsObservable.notifyObservers(this),
              this._physicsEngine._step(t / 1e3),
              this.onAfterPhysicsObservable.notifyObservers(this),
              (this._physicsTimeAccumulator -= t);
        else
          this.onBeforePhysicsObservable.notifyObservers(this),
            this._physicsEngine._step(e / 1e3),
            this.onAfterPhysicsObservable.notifyObservers(this);
      }
    }),
    Object.defineProperty(Yt.prototype, "physicsImpostor", {
      get: function () {
        return this._physicsImpostor;
      },
      set: function (e) {
        var t = this;
        this._physicsImpostor !== e &&
          (this._disposePhysicsObserver &&
            this.onDisposeObservable.remove(this._disposePhysicsObserver),
          (this._physicsImpostor = e),
          e &&
            (this._disposePhysicsObserver = this.onDisposeObservable.add(
              function () {
                t.physicsImpostor &&
                  (t.physicsImpostor.dispose(), (t.physicsImpostor = null));
              }
            )));
      },
      enumerable: !0,
      configurable: !0,
    }),
    (Yt.prototype.getPhysicsImpostor = function () {
      return this.physicsImpostor;
    }),
    (Yt.prototype.applyImpulse = function (e, t) {
      return this.physicsImpostor
        ? (this.physicsImpostor.applyImpulse(e, t), this)
        : this;
    }),
    (Yt.prototype.setPhysicsLinkWith = function (e, t, i, n) {
      return this.physicsImpostor && e.physicsImpostor
        ? (this.physicsImpostor.createJoint(e.physicsImpostor, Ao.HingeJoint, {
            mainPivot: t,
            connectedPivot: i,
            nativeParams: n,
          }),
          this)
        : this;
    });
  var Gh,
    Wh,
    Hh = (function () {
      function e(e) {
        var t = this;
        (this.name = hi.NAME_PHYSICSENGINE),
          (this.scene = e),
          (this.scene.onBeforePhysicsObservable = new o()),
          (this.scene.onAfterPhysicsObservable = new o()),
          (this.scene.getDeterministicFrameTime = function () {
            return t.scene._physicsEngine
              ? 1e3 * t.scene._physicsEngine.getTimeStep()
              : 1e3 / 60;
          });
      }
      return (
        (e.prototype.register = function () {}),
        (e.prototype.rebuild = function () {}),
        (e.prototype.dispose = function () {
          this.scene.onBeforePhysicsObservable.clear(),
            this.scene.onAfterPhysicsObservable.clear(),
            this.scene._physicsEngine && this.scene.disablePhysicsEngine();
        }),
        e
      );
    })(),
    jh =
      ((function () {
        function e(e) {
          (this._scene = e),
            (this._physicsEngine = this._scene.getPhysicsEngine()),
            this._physicsEngine ||
              F.Warn(
                "Physics engine not enabled. Please enable the physics before you can use the methods."
              );
        }
        (e.prototype.applyRadialExplosionImpulse = function (e, t, i, n) {
          if (!this._physicsEngine)
            return (
              F.Warn(
                "Physics engine not enabled. Please enable the physics before you call this method."
              ),
              null
            );
          var r = this._physicsEngine.getImpostors();
          if (0 === r.length) return null;
          "number" == typeof t &&
            (((t = new Qh()).radius = t),
            (t.strength = i || t.strength),
            (t.falloff = n || t.falloff));
          var o = new jh(this._scene, t),
            s = Array();
          return (
            r.forEach(function (t) {
              var i = o.getImpostorHitData(t, e);
              i &&
                (t.applyImpulse(i.force, i.contactPoint),
                s.push({
                  impostor: t,
                  hitData: i,
                }));
            }),
            o.triggerAffectedImpostorsCallback(s),
            o.dispose(!1),
            o
          );
        }),
          (e.prototype.applyRadialExplosionForce = function (e, t, i, n) {
            if (!this._physicsEngine)
              return (
                F.Warn(
                  "Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."
                ),
                null
              );
            var r = this._physicsEngine.getImpostors();
            if (0 === r.length) return null;
            "number" == typeof t &&
              (((t = new Qh()).radius = t),
              (t.strength = i || t.strength),
              (t.falloff = n || t.falloff));
            var o = new jh(this._scene, t),
              s = Array();
            return (
              r.forEach(function (t) {
                var i = o.getImpostorHitData(t, e);
                i &&
                  (t.applyForce(i.force, i.contactPoint),
                  s.push({
                    impostor: t,
                    hitData: i,
                  }));
              }),
              o.triggerAffectedImpostorsCallback(s),
              o.dispose(!1),
              o
            );
          }),
          (e.prototype.gravitationalField = function (e, t, i, n) {
            if (!this._physicsEngine)
              return (
                F.Warn(
                  "Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."
                ),
                null
              );
            if (0 === this._physicsEngine.getImpostors().length) return null;
            "number" == typeof t &&
              (((t = new Qh()).radius = t),
              (t.strength = i || t.strength),
              (t.falloff = n || t.falloff));
            var r = new Xh(this, this._scene, e, t);
            return r.dispose(!1), r;
          }),
          (e.prototype.updraft = function (e, t, i, n, r) {
            if (!this._physicsEngine)
              return (
                F.Warn(
                  "Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."
                ),
                null
              );
            if (0 === this._physicsEngine.getImpostors().length) return null;
            "number" == typeof t &&
              (((t = new qh()).radius = t),
              (t.strength = i || t.strength),
              (t.height = n || t.height),
              (t.updraftMode = r || t.updraftMode));
            var o = new Yh(this._scene, e, t);
            return o.dispose(!1), o;
          }),
          (e.prototype.vortex = function (e, t, i, n) {
            if (!this._physicsEngine)
              return (
                F.Warn(
                  "Physics engine not enabled. Please enable the physics before you call the PhysicsHelper."
                ),
                null
              );
            if (0 === this._physicsEngine.getImpostors().length) return null;
            "number" == typeof t &&
              (((t = new Zh()).radius = t),
              (t.strength = i || t.strength),
              (t.height = n || t.height));
            var r = new Kh(this._scene, e, t);
            return r.dispose(!1), r;
          });
      })(),
      (function () {
        function e(e, t) {
          (this._scene = e),
            (this._options = t),
            (this._dataFetched = !1),
            (this._options = A(A({}, new Qh()), this._options));
        }
        return (
          (e.prototype.getData = function () {
            return (
              (this._dataFetched = !0),
              {
                sphere: this._sphere,
              }
            );
          }),
          (e.prototype.getImpostorHitData = function (e, t) {
            if (0 === e.mass) return null;
            if (!this._intersectsWithSphere(e, t, this._options.radius))
              return null;
            if (
              "Mesh" !== e.object.getClassName() &&
              "InstancedMesh" !== e.object.getClassName()
            )
              return null;
            var i = e.getObjectCenter().subtract(t),
              n = new cn(t, i, this._options.radius).intersectsMesh(
                e.object
              ).pickedPoint;
            if (!n) return null;
            var r = f.Distance(t, n);
            if (r > this._options.radius) return null;
            var o =
              this._options.falloff === Gh.Constant
                ? this._options.strength
                : this._options.strength * (1 - r / this._options.radius);
            return {
              force: i.multiplyByFloats(o, o, o),
              contactPoint: n,
              distanceFromOrigin: r,
            };
          }),
          (e.prototype.triggerAffectedImpostorsCallback = function (e) {
            this._options.affectedImpostorsCallback &&
              this._options.affectedImpostorsCallback(e);
          }),
          (e.prototype.dispose = function (e) {
            var t = this;
            void 0 === e && (e = !0),
              e
                ? this._sphere.dispose()
                : setTimeout(function () {
                    t._dataFetched || t._sphere.dispose();
                  }, 0);
          }),
          (e.prototype._prepareSphere = function () {
            this._sphere ||
              ((this._sphere = Po.CreateSphere(
                "radialExplosionEventSphere",
                this._options.sphere,
                this._scene
              )),
              (this._sphere.isVisible = !1));
          }),
          (e.prototype._intersectsWithSphere = function (e, t, i) {
            var n = e.object;
            return (
              this._prepareSphere(),
              (this._sphere.position = t),
              (this._sphere.scaling = new f(2 * i, 2 * i, 2 * i)),
              this._sphere._updateBoundingInfo(),
              this._sphere.computeWorldMatrix(!0),
              this._sphere.intersectsMesh(n, !0)
            );
          }),
          e
        );
      })()),
    Xh = (function () {
      function e(e, t, i, n) {
        (this._physicsHelper = e),
          (this._scene = t),
          (this._origin = i),
          (this._options = n),
          (this._dataFetched = !1),
          (this._options = A(A({}, new Qh()), this._options)),
          (this._tickCallback = this._tick.bind(this)),
          (this._options.strength = -1 * this._options.strength);
      }
      return (
        (e.prototype.getData = function () {
          return (
            (this._dataFetched = !0),
            {
              sphere: this._sphere,
            }
          );
        }),
        (e.prototype.enable = function () {
          this._tickCallback.call(this),
            this._scene.registerBeforeRender(this._tickCallback);
        }),
        (e.prototype.disable = function () {
          this._scene.unregisterBeforeRender(this._tickCallback);
        }),
        (e.prototype.dispose = function (e) {
          var t = this;
          void 0 === e && (e = !0),
            e
              ? this._sphere.dispose()
              : setTimeout(function () {
                  t._dataFetched || t._sphere.dispose();
                }, 0);
        }),
        (e.prototype._tick = function () {
          if (this._sphere)
            this._physicsHelper.applyRadialExplosionForce(
              this._origin,
              this._options
            );
          else {
            var e = this._physicsHelper.applyRadialExplosionForce(
              this._origin,
              this._options
            );
            e &&
              (this._sphere = e
                .getData()
                .sphere.clone("radialExplosionEventSphereClone"));
          }
        }),
        e
      );
    })(),
    Yh = (function () {
      function e(e, t, i) {
        (this._scene = e),
          (this._origin = t),
          (this._options = i),
          (this._originTop = f.Zero()),
          (this._originDirection = f.Zero()),
          (this._cylinderPosition = f.Zero()),
          (this._dataFetched = !1),
          (this._physicsEngine = this._scene.getPhysicsEngine()),
          (this._options = A(A({}, new qh()), this._options)),
          this._origin.addToRef(
            new f(0, this._options.height / 2, 0),
            this._cylinderPosition
          ),
          this._origin.addToRef(
            new f(0, this._options.height, 0),
            this._originTop
          ),
          this._options.updraftMode === Wh.Perpendicular &&
            (this._originDirection = this._origin
              .subtract(this._originTop)
              .normalize()),
          (this._tickCallback = this._tick.bind(this)),
          this._prepareCylinder();
      }
      return (
        (e.prototype.getData = function () {
          return (
            (this._dataFetched = !0),
            {
              cylinder: this._cylinder,
            }
          );
        }),
        (e.prototype.enable = function () {
          this._tickCallback.call(this),
            this._scene.registerBeforeRender(this._tickCallback);
        }),
        (e.prototype.disable = function () {
          this._scene.unregisterBeforeRender(this._tickCallback);
        }),
        (e.prototype.dispose = function (e) {
          var t = this;
          void 0 === e && (e = !0),
            this._cylinder &&
              (e
                ? this._cylinder.dispose()
                : setTimeout(function () {
                    t._dataFetched || t._cylinder.dispose();
                  }, 0));
        }),
        (e.prototype.getImpostorHitData = function (e) {
          if (0 === e.mass) return null;
          if (!this._intersectsWithCylinder(e)) return null;
          var t = e.getObjectCenter();
          if (this._options.updraftMode === Wh.Perpendicular)
            var i = this._originDirection;
          else i = t.subtract(this._originTop);
          var n = f.Distance(this._origin, t),
            r = -1 * this._options.strength;
          return {
            force: i.multiplyByFloats(r, r, r),
            contactPoint: t,
            distanceFromOrigin: n,
          };
        }),
        (e.prototype._tick = function () {
          var e = this;
          this._physicsEngine.getImpostors().forEach(function (t) {
            var i = e.getImpostorHitData(t);
            i && t.applyForce(i.force, i.contactPoint);
          });
        }),
        (e.prototype._prepareCylinder = function () {
          this._cylinder ||
            ((this._cylinder = ro.CreateCylinder(
              "updraftEventCylinder",
              {
                height: this._options.height,
                diameter: 2 * this._options.radius,
              },
              this._scene
            )),
            (this._cylinder.isVisible = !1));
        }),
        (e.prototype._intersectsWithCylinder = function (e) {
          var t = e.object;
          return (
            (this._cylinder.position = this._cylinderPosition),
            this._cylinder.intersectsMesh(t, !0)
          );
        }),
        e
      );
    })(),
    Kh = (function () {
      function e(e, t, i) {
        (this._scene = e),
          (this._origin = t),
          (this._options = i),
          (this._originTop = f.Zero()),
          (this._cylinderPosition = f.Zero()),
          (this._dataFetched = !1),
          (this._physicsEngine = this._scene.getPhysicsEngine()),
          (this._options = A(A({}, new Zh()), this._options)),
          this._origin.addToRef(
            new f(0, this._options.height / 2, 0),
            this._cylinderPosition
          ),
          this._origin.addToRef(
            new f(0, this._options.height, 0),
            this._originTop
          ),
          (this._tickCallback = this._tick.bind(this)),
          this._prepareCylinder();
      }
      return (
        (e.prototype.getData = function () {
          return (
            (this._dataFetched = !0),
            {
              cylinder: this._cylinder,
            }
          );
        }),
        (e.prototype.enable = function () {
          this._tickCallback.call(this),
            this._scene.registerBeforeRender(this._tickCallback);
        }),
        (e.prototype.disable = function () {
          this._scene.unregisterBeforeRender(this._tickCallback);
        }),
        (e.prototype.dispose = function (e) {
          var t = this;
          void 0 === e && (e = !0),
            e
              ? this._cylinder.dispose()
              : setTimeout(function () {
                  t._dataFetched || t._cylinder.dispose();
                }, 0);
        }),
        (e.prototype.getImpostorHitData = function (e) {
          if (0 === e.mass) return null;
          if (!this._intersectsWithCylinder(e)) return null;
          if (
            "Mesh" !== e.object.getClassName() &&
            "InstancedMesh" !== e.object.getClassName()
          )
            return null;
          var t = e.getObjectCenter(),
            i = new f(this._origin.x, t.y, this._origin.z),
            n = t.subtract(i),
            r = new cn(i, n, this._options.radius).intersectsMesh(e.object),
            o = r.pickedPoint;
          if (!o) return null;
          var s = r.distance / this._options.radius,
            a = o.normalize();
          if (
            (s > this._options.centripetalForceThreshold && (a = a.negate()),
            s > this._options.centripetalForceThreshold)
          )
            var l = a.x * this._options.centripetalForceMultiplier,
              c = a.y * this._options.updraftForceMultiplier,
              u = a.z * this._options.centripetalForceMultiplier;
          else {
            var h = f.Cross(i, t).normalize();
            (l = (h.x + a.x) * this._options.centrifugalForceMultiplier),
              (c = this._originTop.y * this._options.updraftForceMultiplier),
              (u = (h.z + a.z) * this._options.centrifugalForceMultiplier);
          }
          var d = new f(l, c, u);
          return {
            force: (d = d.multiplyByFloats(
              this._options.strength,
              this._options.strength,
              this._options.strength
            )),
            contactPoint: t,
            distanceFromOrigin: s,
          };
        }),
        (e.prototype._tick = function () {
          var e = this;
          this._physicsEngine.getImpostors().forEach(function (t) {
            var i = e.getImpostorHitData(t);
            i && t.applyForce(i.force, i.contactPoint);
          });
        }),
        (e.prototype._prepareCylinder = function () {
          this._cylinder ||
            ((this._cylinder = ro.CreateCylinder(
              "vortexEventCylinder",
              {
                height: this._options.height,
                diameter: 2 * this._options.radius,
              },
              this._scene
            )),
            (this._cylinder.isVisible = !1));
        }),
        (e.prototype._intersectsWithCylinder = function (e) {
          var t = e.object;
          return (
            (this._cylinder.position = this._cylinderPosition),
            this._cylinder.intersectsMesh(t, !0)
          );
        }),
        e
      );
    })(),
    Qh = function () {
      (this.radius = 5),
        (this.strength = 10),
        (this.falloff = Gh.Constant),
        (this.sphere = {
          segments: 32,
          diameter: 1,
        });
    },
    qh = function () {
      (this.radius = 5),
        (this.strength = 10),
        (this.height = 10),
        (this.updraftMode = Wh.Center);
    },
    Zh = function () {
      (this.radius = 5),
        (this.strength = 10),
        (this.height = 10),
        (this.centripetalForceThreshold = 0.7),
        (this.centripetalForceMultiplier = 5),
        (this.centrifugalForceMultiplier = 0.5),
        (this.updraftForceMultiplier = 0.02);
    };
  !(function (e) {
    (e[(e.Constant = 0)] = "Constant"), (e[(e.Linear = 1)] = "Linear");
  })(Gh || (Gh = {})),
    (function (e) {
      (e[(e.Center = 0)] = "Center"),
        (e[(e.Perpendicular = 1)] = "Perpendicular");
    })(Wh || (Wh = {}));
  Ke.ShadersStore.blackAndWhitePixelShader =
    "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float degree;\nvoid main(void)\n{\nvec3 color=texture2D(textureSampler,vUV).rgb;\nfloat luminance=dot(color,vec3(0.3,0.59,0.11));\nvec3 blackAndWhite=vec3(luminance,luminance,luminance);\ngl_FragColor=vec4(color-((color-blackAndWhite)*degree),1.0);\n}";
  var Jh = (function (e) {
    function t(t, i, n, r, o, s) {
      var a =
        e.call(this, t, "blackAndWhite", ["degree"], null, i, n, r, o, s) ||
        this;
      return (
        (a.degree = 1),
        a.onApplyObservable.add(function (e) {
          e.setFloat("degree", a.degree);
        }),
        a
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "BlackAndWhitePostProcess";
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.reusable
            );
          },
          e,
          n,
          r
        );
      }),
      R([se()], t.prototype, "degree", void 0),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.BlackAndWhitePostProcess"] = Jh;
  var $h = (function () {
    function e(e, t, i, n) {
      (this._name = t),
        (this._singleInstance = n || !0),
        (this._getPostProcesses = i),
        (this._cameras = {}),
        (this._indicesForCamera = {}),
        (this._postProcesses = {});
    }
    return (
      Object.defineProperty(e.prototype, "isSupported", {
        get: function () {
          for (var e in this._postProcesses)
            if (this._postProcesses.hasOwnProperty(e))
              for (var t = this._postProcesses[e], i = 0; i < t.length; i++)
                if (!t[i].isSupported) return !1;
          return !0;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (e.prototype._update = function () {}),
      (e.prototype._attachCameras = function (e) {
        var t,
          i = this,
          n = yt.MakeArray(e || this._cameras);
        if (n)
          for (var r = 0; r < n.length; r++) {
            var o = n[r];
            if (o) {
              var s = o.name;
              if (
                ((t = this._singleInstance ? 0 : s), !this._postProcesses[t])
              ) {
                var a = this._getPostProcesses();
                a && (this._postProcesses[t] = Array.isArray(a) ? a : [a]);
              }
              this._indicesForCamera[s] || (this._indicesForCamera[s] = []),
                this._postProcesses[t].forEach(function (e) {
                  var t = o.attachPostProcess(e);
                  i._indicesForCamera[s].push(t);
                }),
                this._cameras[s] || (this._cameras[s] = o);
            }
          }
      }),
      (e.prototype._detachCameras = function (e) {
        var t = yt.MakeArray(e || this._cameras);
        if (t)
          for (var i = 0; i < t.length; i++) {
            var n = t[i],
              r = n.name,
              o = this._postProcesses[this._singleInstance ? 0 : r];
            o &&
              o.forEach(function (e) {
                n.detachPostProcess(e);
              }),
              this._cameras[r] && (this._cameras[r] = null);
          }
      }),
      (e.prototype._enable = function (e) {
        var t = this,
          i = yt.MakeArray(e || this._cameras);
        if (i)
          for (var n = 0; n < i.length; n++)
            for (
              var r = i[n], o = r.name, s = 0;
              s < this._indicesForCamera[o].length;
              s++
            )
              (void 0 !== r._postProcesses[this._indicesForCamera[o][s]] &&
                null !== r._postProcesses[this._indicesForCamera[o][s]]) ||
                this._postProcesses[this._singleInstance ? 0 : o].forEach(
                  function (e) {
                    i[n].attachPostProcess(e, t._indicesForCamera[o][s]);
                  }
                );
      }),
      (e.prototype._disable = function (e) {
        var t = yt.MakeArray(e || this._cameras);
        if (t)
          for (var i = 0; i < t.length; i++) {
            var n = t[i],
              r = n.name;
            this._postProcesses[this._singleInstance ? 0 : r].forEach(
              function (e) {
                n.detachPostProcess(e);
              }
            );
          }
      }),
      (e.prototype.getPostProcesses = function (e) {
        return this._singleInstance
          ? this._postProcesses[0]
          : e
            ? this._postProcesses[e.name]
            : null;
      }),
      e
    );
  })();
  Ke.ShadersStore.extractHighlightsPixelShader =
    "#include<helperFunctions>\n\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float threshold;\nuniform float exposure;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nfloat luma=getLuminance(gl_FragColor.rgb*exposure);\ngl_FragColor.rgb=step(threshold,luma)*gl_FragColor.rgb;\n}";
  var ed = (function (e) {
    function t(t, i, n, r, o, s, l, c) {
      void 0 === l && (l = 0), void 0 === c && (c = !1);
      var u =
        e.call(
          this,
          t,
          "extractHighlights",
          ["threshold", "exposure"],
          null,
          i,
          n,
          r,
          o,
          s,
          null,
          l,
          void 0,
          null,
          c
        ) || this;
      return (
        (u.threshold = 0.9),
        (u._exposure = 1),
        (u._inputPostProcess = null),
        u.onApplyObservable.add(function (e) {
          u._inputPostProcess &&
            e.setTextureFromPostProcess("textureSampler", u._inputPostProcess),
            e.setFloat("threshold", Math.pow(u.threshold, a)),
            e.setFloat("exposure", u._exposure);
        }),
        u
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ExtractHighlightsPostProcess";
      }),
      R([se()], t.prototype, "threshold", void 0),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.ExtractHighlightsPostProcess"] = ed;
  Ke.ShadersStore.bloomMergePixelShader =
    "uniform sampler2D textureSampler;\nuniform sampler2D bloomBlur;\nvarying vec2 vUV;\nuniform float bloomWeight;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nvec3 blurred=texture2D(bloomBlur,vUV).rgb;\ngl_FragColor.rgb=gl_FragColor.rgb+(blurred.rgb*bloomWeight);\n}\n";
  var td = (function (e) {
    function t(t, i, n, r, o, s, a, l, c, u, h) {
      void 0 === u && (u = 0), void 0 === h && (h = !1);
      var d =
        e.call(
          this,
          t,
          "bloomMerge",
          ["bloomWeight"],
          [
            "circleOfConfusionSampler",
            "blurStep0",
            "blurStep1",
            "blurStep2",
            "bloomBlur",
          ],
          o,
          s,
          a,
          l,
          c,
          null,
          u,
          void 0,
          null,
          !0
        ) || this;
      return (
        (d.weight = 1),
        (d.weight = r),
        d.onApplyObservable.add(function (e) {
          e.setTextureFromPostProcess("textureSampler", i),
            e.setTextureFromPostProcessOutput("bloomBlur", n),
            e.setFloat("bloomWeight", d.weight);
        }),
        h || d.updateEffect(),
        d
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "BloomMergePostProcess";
      }),
      R([se()], t.prototype, "weight", void 0),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.BloomMergePostProcess"] = td;
  var id = (function (e) {
    function t(t, i, n, r, o, s) {
      void 0 === o && (o = 0), void 0 === s && (s = !1);
      var a =
        e.call(
          this,
          t.getEngine(),
          "bloom",
          function () {
            return a._effects;
          },
          !0
        ) || this;
      return (
        (a.bloomScale = i),
        (a._effects = []),
        (a._downscale = new ed(
          "highlights",
          1,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          t.getEngine(),
          !1,
          o,
          s
        )),
        (a._blurX = new Ns(
          "horizontal blur",
          new p(1, 0),
          10,
          i,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          t.getEngine(),
          !1,
          o,
          void 0,
          s
        )),
        (a._blurX.alwaysForcePOT = !0),
        (a._blurX.autoClear = !1),
        (a._blurY = new Ns(
          "vertical blur",
          new p(0, 1),
          10,
          i,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          t.getEngine(),
          !1,
          o,
          void 0,
          s
        )),
        (a._blurY.alwaysForcePOT = !0),
        (a._blurY.autoClear = !1),
        (a.kernel = r),
        (a._effects = [a._downscale, a._blurX, a._blurY]),
        (a._merge = new td(
          "bloomMerge",
          a._downscale,
          a._blurY,
          n,
          i,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          t.getEngine(),
          !1,
          o,
          s
        )),
        (a._merge.autoClear = !1),
        a._effects.push(a._merge),
        a
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "threshold", {
        get: function () {
          return this._downscale.threshold;
        },
        set: function (e) {
          this._downscale.threshold = e;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "weight", {
        get: function () {
          return this._merge.weight;
        },
        set: function (e) {
          this._merge.weight = e;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "kernel", {
        get: function () {
          return this._blurX.kernel / this.bloomScale;
        },
        set: function (e) {
          (this._blurX.kernel = e * this.bloomScale),
            (this._blurY.kernel = e * this.bloomScale);
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.disposeEffects = function (e) {
        for (var t = 0; t < this._effects.length; t++)
          this._effects[t].dispose(e);
      }),
      (t.prototype._updateEffects = function () {
        for (var e = 0; e < this._effects.length; e++)
          this._effects[e].updateEffect();
      }),
      (t.prototype._isReady = function () {
        for (var e = 0; e < this._effects.length; e++)
          if (!this._effects[e].isReady()) return !1;
        return !0;
      }),
      t
    );
  })($h);
  Ke.ShadersStore.chromaticAberrationPixelShader =
    "\nuniform sampler2D textureSampler;\n\nuniform float chromatic_aberration;\nuniform float radialIntensity;\nuniform vec2 direction;\nuniform vec2 centerPosition;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-centerPosition.x,vUV.y-centerPosition.y);\nvec2 directionOfEffect=direction;\nif(directionOfEffect.x == 0. && directionOfEffect.y == 0.){\ndirectionOfEffect=normalize(centered_screen_pos);\n}\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.x/screen_width;\nfloat ref_shiftY=chromatic_aberration*pow(radius,radialIntensity)*directionOfEffect.y/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\noriginal.a=clamp(texture2D(textureSampler,ref_coords_r).a+texture2D(textureSampler,ref_coords_g).a+texture2D(textureSampler,ref_coords_b).a,0.,1.);\ngl_FragColor=original;\n}";
  var nd = (function (e) {
    function t(t, i, n, r, o, s, a, l, c, u) {
      void 0 === c && (c = 0), void 0 === u && (u = !1);
      var h =
        e.call(
          this,
          t,
          "chromaticAberration",
          [
            "chromatic_aberration",
            "screen_width",
            "screen_height",
            "direction",
            "radialIntensity",
            "centerPosition",
          ],
          [],
          r,
          o,
          s,
          a,
          l,
          null,
          c,
          void 0,
          null,
          u
        ) || this;
      return (
        (h.aberrationAmount = 30),
        (h.radialIntensity = 0),
        (h.direction = new p(0.707, 0.707)),
        (h.centerPosition = new p(0.5, 0.5)),
        (h.screenWidth = i),
        (h.screenHeight = n),
        h.onApplyObservable.add(function (e) {
          e.setFloat("chromatic_aberration", h.aberrationAmount),
            e.setFloat("screen_width", i),
            e.setFloat("screen_height", n),
            e.setFloat("radialIntensity", h.radialIntensity),
            e.setFloat2("direction", h.direction.x, h.direction.y),
            e.setFloat2(
              "centerPosition",
              h.centerPosition.x,
              h.centerPosition.y
            );
        }),
        h
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ChromaticAberrationPostProcess";
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              e.screenWidth,
              e.screenHeight,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.reusable,
              e.textureType,
              !1
            );
          },
          e,
          n,
          r
        );
      }),
      R([se()], t.prototype, "aberrationAmount", void 0),
      R([se()], t.prototype, "radialIntensity", void 0),
      R([se()], t.prototype, "direction", void 0),
      R([se()], t.prototype, "centerPosition", void 0),
      R([se()], t.prototype, "screenWidth", void 0),
      R([se()], t.prototype, "screenHeight", void 0),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.ChromaticAberrationPostProcess"] = nd;
  Ke.ShadersStore.circleOfConfusionPixelShader =
    "\nuniform sampler2D depthSampler;\n\nvarying vec2 vUV;\n\nuniform vec2 cameraMinMaxZ;\n\nuniform float focusDistance;\nuniform float cocPrecalculation;\nvoid main(void)\n{\nfloat depth=texture2D(depthSampler,vUV).r;\nfloat pixelDistance=(cameraMinMaxZ.x+(cameraMinMaxZ.y-cameraMinMaxZ.x)*depth)*1000.0;\nfloat coc=abs(cocPrecalculation* ((focusDistance-pixelDistance)/pixelDistance));\ncoc=clamp(coc,0.0,1.0);\ngl_FragColor=vec4(coc,depth,coc,1.0);\n}\n";
  var rd = (function (e) {
    function t(t, i, n, r, o, s, a, l, c) {
      void 0 === l && (l = 0), void 0 === c && (c = !1);
      var u =
        e.call(
          this,
          t,
          "circleOfConfusion",
          ["cameraMinMaxZ", "focusDistance", "cocPrecalculation"],
          ["depthSampler"],
          n,
          r,
          o,
          s,
          a,
          null,
          l,
          void 0,
          null,
          c
        ) || this;
      return (
        (u.lensSize = 50),
        (u.fStop = 1.4),
        (u.focusDistance = 2e3),
        (u.focalLength = 50),
        (u._depthTexture = null),
        (u._depthTexture = i),
        u.onApplyObservable.add(function (e) {
          if (u._depthTexture) {
            e.setTexture("depthSampler", u._depthTexture);
            var t =
              ((u.lensSize / u.fStop) * u.focalLength) /
              (u.focusDistance - u.focalLength);
            e.setFloat("focusDistance", u.focusDistance),
              e.setFloat("cocPrecalculation", t),
              e.setFloat2(
                "cameraMinMaxZ",
                u._depthTexture.activeCamera.minZ,
                u._depthTexture.activeCamera.maxZ
              );
          } else F.Warn("No depth texture set on CircleOfConfusionPostProcess");
        }),
        u
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "CircleOfConfusionPostProcess";
      }),
      Object.defineProperty(t.prototype, "depthTexture", {
        set: function (e) {
          this._depthTexture = e;
        },
        enumerable: !1,
        configurable: !0,
      }),
      R([se()], t.prototype, "lensSize", void 0),
      R([se()], t.prototype, "fStop", void 0),
      R([se()], t.prototype, "focusDistance", void 0),
      R([se()], t.prototype, "focalLength", void 0),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.CircleOfConfusionPostProcess"] = rd;
  Ke.ShadersStore.colorCorrectionPixelShader =
    "\nuniform sampler2D textureSampler;\nuniform sampler2D colorTable;\n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0;\n\nvec4 sampleAs3DTexture(sampler2D textureSampler,vec3 uv,float width) {\nfloat sliceSize=1.0/width;\nfloat slicePixelSize=sliceSize/width;\nfloat sliceInnerSize=slicePixelSize*(width-1.0);\nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(textureSampler,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(textureSampler,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}";
  var od = (function (e) {
    function t(t, i, n, r, o, s, a) {
      var l =
        e.call(
          this,
          t,
          "colorCorrection",
          null,
          ["colorTable"],
          n,
          r,
          o,
          s,
          a
        ) || this;
      return (
        (l._colorTableTexture = new mn(
          i,
          r.getScene(),
          !0,
          !1,
          mn.TRILINEAR_SAMPLINGMODE
        )),
        (l._colorTableTexture.anisotropicFilteringLevel = 1),
        (l._colorTableTexture.wrapU = mn.CLAMP_ADDRESSMODE),
        (l._colorTableTexture.wrapV = mn.CLAMP_ADDRESSMODE),
        (l.colorTableUrl = i),
        (l.onApply = function (e) {
          e.setTexture("colorTable", l._colorTableTexture);
        }),
        l
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ColorCorrectionPostProcess";
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              e.colorTableUrl,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.reusable
            );
          },
          e,
          n,
          r
        );
      }),
      R([se()], t.prototype, "colorTableUrl", void 0),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.ColorCorrectionPostProcess"] = od;
  Ke.ShadersStore.convolutionPixelShader =
    "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}";
  var sd = (function (e) {
    function t(t, i, n, r, o, s, a, l) {
      void 0 === l && (l = 0);
      var c =
        e.call(
          this,
          t,
          "convolution",
          ["kernel", "screenSize"],
          null,
          n,
          r,
          o,
          s,
          a,
          null,
          l
        ) || this;
      return (
        (c.kernel = i),
        (c.onApply = function (e) {
          e.setFloat2("screenSize", c.width, c.height),
            e.setArray("kernel", c.kernel);
        }),
        c
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ConvolutionPostProcess";
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              e.kernel,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.reusable,
              e.textureType
            );
          },
          e,
          n,
          r
        );
      }),
      (t.EdgeDetect0Kernel = [1, 0, -1, 0, 0, 0, -1, 0, 1]),
      (t.EdgeDetect1Kernel = [0, 1, 0, 1, -4, 1, 0, 1, 0]),
      (t.EdgeDetect2Kernel = [-1, -1, -1, -1, 8, -1, -1, -1, -1]),
      (t.SharpenKernel = [0, -1, 0, -1, 5, -1, 0, -1, 0]),
      (t.EmbossKernel = [-2, -1, 0, -1, 1, 1, 0, 1, 2]),
      (t.GaussianKernel = [0, 1, 0, 1, 1, 1, 0, 1, 0]),
      R([se()], t.prototype, "kernel", void 0),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.ConvolutionPostProcess"] = sd;
  var ad = (function (e) {
    function t(t, i, n, r, o, s, a, l, c, u, h, d, p) {
      void 0 === l && (l = null),
        void 0 === c && (c = mn.BILINEAR_SAMPLINGMODE),
        void 0 === d && (d = 0),
        void 0 === p && (p = !1);
      var f =
        e.call(
          this,
          t,
          n,
          r,
          o,
          s,
          (c = 2),
          u,
          h,
          (d = 0),
          "#define DOF 1\r\n",
          p
        ) || this;
      return (
        (f.direction = n),
        f.onApplyObservable.add(function (e) {
          null != l && e.setTextureFromPostProcess("textureSampler", l),
            e.setTextureFromPostProcessOutput("circleOfConfusionSampler", a),
            i.activeCamera &&
              e.setFloat2(
                "cameraMinMaxZ",
                i.activeCamera.minZ,
                i.activeCamera.maxZ
              );
        }),
        f
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "DepthOfFieldBlurPostProcess";
      }),
      R([se()], t.prototype, "direction", void 0),
      t
    );
  })(Ns);
  h.RegisteredTypes["BABYLON.DepthOfFieldBlurPostProcess"] = ad;
  Ke.ShadersStore.depthOfFieldMergePixelShader =
    "uniform sampler2D textureSampler;\nvarying vec2 vUV;\nuniform sampler2D circleOfConfusionSampler;\nuniform sampler2D blurStep0;\n#if BLUR_LEVEL>0\nuniform sampler2D blurStep1;\n#endif\n#if BLUR_LEVEL>1\nuniform sampler2D blurStep2;\n#endif\nvoid main(void)\n{\nfloat coc=texture2D(circleOfConfusionSampler,vUV).r;\n#if BLUR_LEVEL == 0\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred0=texture2D(blurStep0,vUV);\ngl_FragColor=mix(original,blurred0,coc);\n#endif\n#if BLUR_LEVEL == 1\nif(coc<0.5){\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(original,blurred1,coc/0.5);\n}else{\nvec4 blurred0=texture2D(blurStep0,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(blurred1,blurred0,(coc-0.5)/0.5);\n}\n#endif\n#if BLUR_LEVEL == 2\nif(coc<0.33){\nvec4 original=texture2D(textureSampler,vUV);\nvec4 blurred2=texture2D(blurStep2,vUV);\ngl_FragColor=mix(original,blurred2,coc/0.33);\n}else if(coc<0.66){\nvec4 blurred1=texture2D(blurStep1,vUV);\nvec4 blurred2=texture2D(blurStep2,vUV);\ngl_FragColor=mix(blurred2,blurred1,(coc-0.33)/0.33);\n}else{\nvec4 blurred0=texture2D(blurStep0,vUV);\nvec4 blurred1=texture2D(blurStep1,vUV);\ngl_FragColor=mix(blurred1,blurred0,(coc-0.66)/0.34);\n}\n#endif\n}\n";
  var ld,
    cd = (function (e) {
      function t(t, i, n, r, o, s, a, l, c, u, h) {
        void 0 === u && (u = 0), void 0 === h && (h = !1);
        var d =
          e.call(
            this,
            t,
            "depthOfFieldMerge",
            [],
            ["circleOfConfusionSampler", "blurStep0", "blurStep1", "blurStep2"],
            o,
            s,
            a,
            l,
            c,
            null,
            u,
            void 0,
            null,
            !0
          ) || this;
        return (
          (d.blurSteps = r),
          d.onApplyObservable.add(function (e) {
            e.setTextureFromPostProcess("textureSampler", i),
              e.setTextureFromPostProcessOutput("circleOfConfusionSampler", n),
              r.forEach(function (t, i) {
                e.setTextureFromPostProcessOutput(
                  "blurStep" + (r.length - i - 1),
                  t
                );
              });
          }),
          h || d.updateEffect(),
          d
        );
      }
      return (
        P(t, e),
        (t.prototype.getClassName = function () {
          return "DepthOfFieldMergePostProcess";
        }),
        (t.prototype.updateEffect = function (t, i, n, r, o, s) {
          void 0 === t && (t = null),
            void 0 === i && (i = null),
            void 0 === n && (n = null),
            t ||
              ((t = ""),
              (t +=
                "#define BLUR_LEVEL " + (this.blurSteps.length - 1) + "\n")),
            e.prototype.updateEffect.call(this, t, i, n, r, o, s);
        }),
        t
      );
    })(vr);
  !(function (e) {
    (e[(e.Low = 0)] = "Low"),
      (e[(e.Medium = 1)] = "Medium"),
      (e[(e.High = 2)] = "High");
  })(ld || (ld = {}));
  var ud = (function (e) {
    function t(t, i, n, r, o) {
      void 0 === n && (n = ld.Low),
        void 0 === r && (r = 0),
        void 0 === o && (o = !1);
      var s =
        e.call(
          this,
          t.getEngine(),
          "depth of field",
          function () {
            return s._effects;
          },
          !0
        ) || this;
      (s._effects = []),
        (s._circleOfConfusion = new rd(
          "circleOfConfusion",
          i,
          1,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          t.getEngine(),
          !1,
          r,
          o
        )),
        (s._depthOfFieldBlurY = []),
        (s._depthOfFieldBlurX = []);
      var a = 1,
        l = 15;
      switch (n) {
        case ld.High:
          (a = 3), (l = 51);
          break;
        case ld.Medium:
          (a = 2), (l = 31);
          break;
        default:
          (l = 15), (a = 1);
      }
      for (var c = l / Math.pow(2, a - 1), u = 1, h = 0; h < a; h++) {
        var d = new ad(
          "verticle blur",
          t,
          new p(0, 1),
          c,
          u,
          null,
          s._circleOfConfusion,
          0 == h ? s._circleOfConfusion : null,
          mn.BILINEAR_SAMPLINGMODE,
          t.getEngine(),
          !1,
          r,
          o
        );
        (d.autoClear = !1), (u = 0.75 / Math.pow(2, h));
        var f = new ad(
          "horizontal blur",
          t,
          new p(1, 0),
          c,
          u,
          null,
          s._circleOfConfusion,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          t.getEngine(),
          !1,
          r,
          o
        );
        (f.autoClear = !1),
          s._depthOfFieldBlurY.push(d),
          s._depthOfFieldBlurX.push(f);
      }
      for (
        s._effects = [s._circleOfConfusion], h = 0;
        h < s._depthOfFieldBlurX.length;
        h++
      )
        s._effects.push(s._depthOfFieldBlurY[h]),
          s._effects.push(s._depthOfFieldBlurX[h]);
      return (
        (s._dofMerge = new cd(
          "dofMerge",
          s._circleOfConfusion,
          s._circleOfConfusion,
          s._depthOfFieldBlurX,
          u,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          t.getEngine(),
          !1,
          r,
          o
        )),
        (s._dofMerge.autoClear = !1),
        s._effects.push(s._dofMerge),
        s
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "focalLength", {
        get: function () {
          return this._circleOfConfusion.focalLength;
        },
        set: function (e) {
          this._circleOfConfusion.focalLength = e;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "fStop", {
        get: function () {
          return this._circleOfConfusion.fStop;
        },
        set: function (e) {
          this._circleOfConfusion.fStop = e;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "focusDistance", {
        get: function () {
          return this._circleOfConfusion.focusDistance;
        },
        set: function (e) {
          this._circleOfConfusion.focusDistance = e;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "lensSize", {
        get: function () {
          return this._circleOfConfusion.lensSize;
        },
        set: function (e) {
          this._circleOfConfusion.lensSize = e;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.getClassName = function () {
        return "DepthOfFieldEffect";
      }),
      Object.defineProperty(t.prototype, "depthTexture", {
        set: function (e) {
          this._circleOfConfusion.depthTexture = e;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.disposeEffects = function (e) {
        for (var t = 0; t < this._effects.length; t++)
          this._effects[t].dispose(e);
      }),
      (t.prototype._updateEffects = function () {
        for (var e = 0; e < this._effects.length; e++)
          this._effects[e].updateEffect();
      }),
      (t.prototype._isReady = function () {
        for (var e = 0; e < this._effects.length; e++)
          if (!this._effects[e].isReady()) return !1;
        return !0;
      }),
      t
    );
  })($h);
  Ke.ShadersStore.displayPassPixelShader =
    "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}";
  var hd = (function (e) {
    function t(t, i, n, r, o, s) {
      return (
        e.call(
          this,
          t,
          "displayPass",
          ["passSampler"],
          ["passSampler"],
          i,
          n,
          r,
          o,
          s
        ) || this
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "DisplayPassPostProcess";
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.reusable
            );
          },
          e,
          n,
          r
        );
      }),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.DisplayPassPostProcess"] = hd;
  Ke.ShadersStore.filterPixelShader =
    "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}";
  var dd = (function (e) {
    function t(t, i, n, r, o, s, a) {
      var l =
        e.call(this, t, "filter", ["kernelMatrix"], null, n, r, o, s, a) ||
        this;
      return (
        (l.kernelMatrix = i),
        (l.onApply = function (e) {
          e.setMatrix("kernelMatrix", l.kernelMatrix);
        }),
        l
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "FilterPostProcess";
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              e.kernelMatrix,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.reusable
            );
          },
          e,
          n,
          r
        );
      }),
      R([_e()], t.prototype, "kernelMatrix", void 0),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.FilterPostProcess"] = dd;
  Ke.ShadersStore.fxaaPixelShader =
    "uniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst float fxaaQualitySubpix=1.0;\nconst float fxaaQualityEdgeThreshold=0.166;\nconst float fxaaQualityEdgeThresholdMin=0.0833;\nconst vec3 kLumaCoefficients=vec3(0.2126,0.7152,0.0722);\n#define FxaaLuma(rgba) dot(rgba.rgb,kLumaCoefficients)\nvoid main(){\nvec2 posM;\nposM.x=vUV.x;\nposM.y=vUV.y;\nvec4 rgbyM=texture2D(textureSampler,vUV,0.0);\nfloat lumaM=FxaaLuma(rgbyM);\nfloat lumaS=FxaaLuma(texture2D(textureSampler,sampleCoordS,0.0));\nfloat lumaE=FxaaLuma(texture2D(textureSampler,sampleCoordE,0.0));\nfloat lumaN=FxaaLuma(texture2D(textureSampler,sampleCoordN,0.0));\nfloat lumaW=FxaaLuma(texture2D(textureSampler,sampleCoordW,0.0));\nfloat maxSM=max(lumaS,lumaM);\nfloat minSM=min(lumaS,lumaM);\nfloat maxESM=max(lumaE,maxSM);\nfloat minESM=min(lumaE,minSM);\nfloat maxWN=max(lumaN,lumaW);\nfloat minWN=min(lumaN,lumaW);\nfloat rangeMax=max(maxWN,maxESM);\nfloat rangeMin=min(minWN,minESM);\nfloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;\nfloat range=rangeMax-rangeMin;\nfloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);\n#ifndef MALI\nif(range<rangeMaxClamped)\n{\ngl_FragColor=rgbyM;\nreturn;\n}\n#endif\nfloat lumaNW=FxaaLuma(texture2D(textureSampler,sampleCoordNW,0.0));\nfloat lumaSE=FxaaLuma(texture2D(textureSampler,sampleCoordSE,0.0));\nfloat lumaNE=FxaaLuma(texture2D(textureSampler,sampleCoordNE,0.0));\nfloat lumaSW=FxaaLuma(texture2D(textureSampler,sampleCoordSW,0.0));\nfloat lumaNS=lumaN+lumaS;\nfloat lumaWE=lumaW+lumaE;\nfloat subpixRcpRange=1.0/range;\nfloat subpixNSWE=lumaNS+lumaWE;\nfloat edgeHorz1=(-2.0*lumaM)+lumaNS;\nfloat edgeVert1=(-2.0*lumaM)+lumaWE;\nfloat lumaNESE=lumaNE+lumaSE;\nfloat lumaNWNE=lumaNW+lumaNE;\nfloat edgeHorz2=(-2.0*lumaE)+lumaNESE;\nfloat edgeVert2=(-2.0*lumaN)+lumaNWNE;\nfloat lumaNWSW=lumaNW+lumaSW;\nfloat lumaSWSE=lumaSW+lumaSE;\nfloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);\nfloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);\nfloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;\nfloat edgeVert3=(-2.0*lumaS)+lumaSWSE;\nfloat edgeHorz=abs(edgeHorz3)+edgeHorz4;\nfloat edgeVert=abs(edgeVert3)+edgeVert4;\nfloat subpixNWSWNESE=lumaNWSW+lumaNESE;\nfloat lengthSign=texelSize.x;\nbool horzSpan=edgeHorz>=edgeVert;\nfloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;\nif (!horzSpan)\n{\nlumaN=lumaW;\n}\nif (!horzSpan)\n{\nlumaS=lumaE;\n}\nif (horzSpan)\n{\nlengthSign=texelSize.y;\n}\nfloat subpixB=(subpixA*(1.0/12.0))-lumaM;\nfloat gradientN=lumaN-lumaM;\nfloat gradientS=lumaS-lumaM;\nfloat lumaNN=lumaN+lumaM;\nfloat lumaSS=lumaS+lumaM;\nbool pairN=abs(gradientN)>=abs(gradientS);\nfloat gradient=max(abs(gradientN),abs(gradientS));\nif (pairN)\n{\nlengthSign=-lengthSign;\n}\nfloat subpixC=clamp(abs(subpixB)*subpixRcpRange,0.0,1.0);\nvec2 posB;\nposB.x=posM.x;\nposB.y=posM.y;\nvec2 offNP;\noffNP.x=(!horzSpan) ? 0.0 : texelSize.x;\noffNP.y=(horzSpan) ? 0.0 : texelSize.y;\nif (!horzSpan)\n{\nposB.x+=lengthSign*0.5;\n}\nif (horzSpan)\n{\nposB.y+=lengthSign*0.5;\n}\nvec2 posN;\nposN.x=posB.x-offNP.x*1.5;\nposN.y=posB.y-offNP.y*1.5;\nvec2 posP;\nposP.x=posB.x+offNP.x*1.5;\nposP.y=posB.y+offNP.y*1.5;\nfloat subpixD=((-2.0)*subpixC)+3.0;\nfloat lumaEndN=FxaaLuma(texture2D(textureSampler,posN,0.0));\nfloat subpixE=subpixC*subpixC;\nfloat lumaEndP=FxaaLuma(texture2D(textureSampler,posP,0.0));\nif (!pairN)\n{\nlumaNN=lumaSS;\n}\nfloat gradientScaled=gradient*1.0/4.0;\nfloat lumaMM=lumaM-lumaNN*0.5;\nfloat subpixF=subpixD*subpixE;\nbool lumaMLTZero=lumaMM<0.0;\nlumaEndN-=lumaNN*0.5;\nlumaEndP-=lumaNN*0.5;\nbool doneN=abs(lumaEndN)>=gradientScaled;\nbool doneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN)\n{\nposN.x-=offNP.x*3.0;\n}\nif (!doneN)\n{\nposN.y-=offNP.y*3.0;\n}\nbool doneNP=(!doneN) || (!doneP);\nif (!doneP)\n{\nposP.x+=offNP.x*3.0;\n}\nif (!doneP)\n{\nposP.y+=offNP.y*3.0;\n}\nif (doneNP)\n{\nif (!doneN) lumaEndN=FxaaLuma(texture2D(textureSampler,posN.xy,0.0));\nif (!doneP) lumaEndP=FxaaLuma(texture2D(textureSampler,posP.xy,0.0));\nif (!doneN) lumaEndN=lumaEndN-lumaNN*0.5;\nif (!doneP) lumaEndP=lumaEndP-lumaNN*0.5;\ndoneN=abs(lumaEndN)>=gradientScaled;\ndoneP=abs(lumaEndP)>=gradientScaled;\nif (!doneN) posN.x-=offNP.x*12.0;\nif (!doneN) posN.y-=offNP.y*12.0;\ndoneNP=(!doneN) || (!doneP);\nif (!doneP) posP.x+=offNP.x*12.0;\nif (!doneP) posP.y+=offNP.y*12.0;\n}\nfloat dstN=posM.x-posN.x;\nfloat dstP=posP.x-posM.x;\nif (!horzSpan)\n{\ndstN=posM.y-posN.y;\n}\nif (!horzSpan)\n{\ndstP=posP.y-posM.y;\n}\nbool goodSpanN=(lumaEndN<0.0) != lumaMLTZero;\nfloat spanLength=(dstP+dstN);\nbool goodSpanP=(lumaEndP<0.0) != lumaMLTZero;\nfloat spanLengthRcp=1.0/spanLength;\nbool directionN=dstN<dstP;\nfloat dst=min(dstN,dstP);\nbool goodSpan=directionN ? goodSpanN : goodSpanP;\nfloat subpixG=subpixF*subpixF;\nfloat pixelOffset=(dst*(-spanLengthRcp))+0.5;\nfloat subpixH=subpixG*fxaaQualitySubpix;\nfloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;\nfloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);\nif (!horzSpan)\n{\nposM.x+=pixelOffsetSubpix*lengthSign;\n}\nif (horzSpan)\n{\nposM.y+=pixelOffsetSubpix*lengthSign;\n}\n#ifdef MALI\nif(range<rangeMaxClamped)\n{\ngl_FragColor=rgbyM;\n}\nelse\n{\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n}\n#else\ngl_FragColor=texture2D(textureSampler,posM,0.0);\n#endif\n}";
  Ke.ShadersStore.fxaaVertexShader =
    "\nattribute vec2 position;\nuniform vec2 texelSize;\n\nvarying vec2 vUV;\nvarying vec2 sampleCoordS;\nvarying vec2 sampleCoordE;\nvarying vec2 sampleCoordN;\nvarying vec2 sampleCoordW;\nvarying vec2 sampleCoordNW;\nvarying vec2 sampleCoordSE;\nvarying vec2 sampleCoordNE;\nvarying vec2 sampleCoordSW;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=(position*madd+madd);\nsampleCoordS=vUV+vec2( 0.0,1.0)*texelSize;\nsampleCoordE=vUV+vec2( 1.0,0.0)*texelSize;\nsampleCoordN=vUV+vec2( 0.0,-1.0)*texelSize;\nsampleCoordW=vUV+vec2(-1.0,0.0)*texelSize;\nsampleCoordNW=vUV+vec2(-1.0,-1.0)*texelSize;\nsampleCoordSE=vUV+vec2( 1.0,1.0)*texelSize;\nsampleCoordNE=vUV+vec2( 1.0,-1.0)*texelSize;\nsampleCoordSW=vUV+vec2(-1.0,1.0)*texelSize;\ngl_Position=vec4(position,0.0,1.0);\n}";
  var pd = (function (e) {
    function t(t, i, n, r, o, s, a) {
      void 0 === n && (n = null), void 0 === a && (a = 0);
      var l =
          e.call(
            this,
            t,
            "fxaa",
            ["texelSize"],
            null,
            i,
            n,
            r || mn.BILINEAR_SAMPLINGMODE,
            o,
            s,
            null,
            a,
            "fxaa",
            void 0,
            !0
          ) || this,
        c = l._getDefines();
      return (
        l.updateEffect(c),
        l.onApplyObservable.add(function (e) {
          var t = l.texelSize;
          e.setFloat2("texelSize", t.x, t.y);
        }),
        l
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "FxaaPostProcess";
      }),
      (t.prototype._getDefines = function () {
        var e = this.getEngine();
        if (!e) return null;
        var t = e.getGlInfo();
        return t && t.renderer && t.renderer.toLowerCase().indexOf("mali") > -1
          ? "#define MALI 1\n"
          : null;
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.reusable
            );
          },
          e,
          n,
          r
        );
      }),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.FxaaPostProcess"] = pd;
  Ke.ShadersStore.grainPixelShader =
    "#include<helperFunctions>\n\nuniform sampler2D textureSampler;\n\nuniform float intensity;\nuniform float animatedSeed;\n\nvarying vec2 vUV;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\nvec2 seed=vUV*(animatedSeed);\nfloat grain=dither(seed,intensity);\n\nfloat lum=getLuminance(gl_FragColor.rgb);\nfloat grainAmount=(cos(-PI+(lum*PI*2.))+1.)/2.;\ngl_FragColor.rgb+=grain*grainAmount;\ngl_FragColor.rgb=max(gl_FragColor.rgb,0.0);\n}";
  var fd = (function (e) {
    function t(t, i, n, r, o, s, a, l) {
      void 0 === a && (a = 0), void 0 === l && (l = !1);
      var c =
        e.call(
          this,
          t,
          "grain",
          ["intensity", "animatedSeed"],
          [],
          i,
          n,
          r,
          o,
          s,
          null,
          a,
          void 0,
          null,
          l
        ) || this;
      return (
        (c.intensity = 30),
        (c.animated = !1),
        c.onApplyObservable.add(function (e) {
          e.setFloat("intensity", c.intensity),
            e.setFloat("animatedSeed", c.animated ? Math.random() + 1 : 1);
        }),
        c
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "GrainPostProcess";
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.reusable
            );
          },
          e,
          n,
          r
        );
      }),
      R([se()], t.prototype, "intensity", void 0),
      R([se()], t.prototype, "animated", void 0),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.GrainPostProcess"] = fd;
  (Ke.ShadersStore.highlightsPixelShader =
    "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nconst vec3 RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvoid main(void)\n{\nvec4 tex=texture2D(textureSampler,vUV);\nvec3 c=tex.rgb;\nfloat luma=dot(c.rgb,RGBLuminanceCoefficients);\n\n\ngl_FragColor=vec4(pow(c,vec3(25.0-luma*15.0)),tex.a);\n}"),
    (function (e) {
      function t(t, i, n, r, o, s, a) {
        return (
          void 0 === a && (a = 0),
          e.call(this, t, "highlights", null, null, i, n, r, o, s, null, a) ||
            this
        );
      }
      P(t, e),
        (t.prototype.getClassName = function () {
          return "HighlightsPostProcess";
        });
    })(vr);
  Ke.IncludesShadersStore.mrtFragmentDeclaration =
    "#if __VERSION__>=200\nlayout(location=0) out vec4 glFragData[{X}];\n#endif\n";
  Ke.ShadersStore.geometryPixelShader =
    "#extension GL_EXT_draw_buffers : require\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;\nprecision highp int;\n#ifdef BUMP\nvarying mat4 vWorldView;\nvarying vec3 vNormalW;\n#else\nvarying vec3 vNormalV;\n#endif\nvarying vec4 vViewPos;\n#if defined(POSITION) || defined(BUMP)\nvarying vec3 vPositionW;\n#endif\n#ifdef VELOCITY\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\n#ifdef NEED_UV\nvarying vec2 vUV;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef REFLECTIVITY\nvarying vec2 vReflectivityUV;\nuniform sampler2D reflectivitySampler;\n#endif\n#ifdef ALPHATEST\nuniform sampler2D diffuseSampler;\n#endif\n#include<mrtFragmentDeclaration>[RENDER_TARGET_COUNT]\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\nvoid main() {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nvec3 normalOutput;\n#ifdef BUMP\nvec3 normalW=normalize(vNormalW);\n#include<bumpFragment>\nnormalOutput=normalize(vec3(vWorldView*vec4(normalW,0.0)));\n#else\nnormalOutput=normalize(vNormalV);\n#endif\n#ifdef PREPASS\n#ifdef PREPASS_DEPTHNORMAL\ngl_FragData[DEPTHNORMAL_INDEX]=vec4(vViewPos.z/vViewPos.w,normalOutput);\n#endif\n#else\ngl_FragData[0]=vec4(vViewPos.z/vViewPos.w,0.0,0.0,1.0);\ngl_FragData[1]=vec4(normalOutput,1.0);\n#endif\n#ifdef POSITION\ngl_FragData[POSITION_INDEX]=vec4(vPositionW,1.0);\n#endif\n#ifdef VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[VELOCITY_INDEX]=vec4(velocity,0.0,1.0);\n#endif\n#ifdef REFLECTIVITY\n#ifdef HAS_SPECULAR\n\nvec4 reflectivity=texture2D(reflectivitySampler,vReflectivityUV);\n#elif HAS_REFLECTIVITY\n\nvec4 reflectivity=vec4(texture2D(reflectivitySampler,vReflectivityUV).rgb,1.0);\n#else\nvec4 reflectivity=vec4(0.0,0.0,0.0,1.0);\n#endif\ngl_FragData[REFLECTIVITY_INDEX]=reflectivity;\n#endif\n}";
  Ke.ShadersStore.geometryVertexShader =
    "precision highp float;\nprecision highp int;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#include<instancesDeclaration>\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef NEED_UV\nvarying vec2 vUV;\n#ifdef ALPHATEST\nuniform mat4 diffuseMatrix;\n#endif\n#ifdef BUMP\nuniform mat4 bumpMatrix;\nvarying vec2 vBumpUV;\n#endif\n#ifdef REFLECTIVITY\nuniform mat4 reflectivityMatrix;\nvarying vec2 vReflectivityUV;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n\nuniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef BUMP\nvarying mat4 vWorldView;\n#endif\n#ifdef BUMP\nvarying vec3 vNormalW;\n#else\nvarying vec3 vNormalV;\n#endif\nvarying vec4 vViewPos;\n#if defined(POSITION) || defined(BUMP)\nvarying vec3 vPositionW;\n#endif\n#ifdef VELOCITY\nuniform mat4 previousWorld;\nuniform mat4 previousViewProjection;\n#ifdef BONES_VELOCITY_ENABLED\n#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#endif\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\nvec3 normalUpdated=normal;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#if defined(VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\n\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\nvec4 pos=vec4(finalWorld*vec4(positionUpdated,1.0));\n#ifdef BUMP\nvWorldView=view*finalWorld;\nvNormalW=normalUpdated;\n#else\nvNormalV=normalize(vec3((view*finalWorld)*vec4(normalUpdated,0.0)));\n#endif\nvViewPos=view*pos;\n#if defined(VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n#if NUM_BONE_INFLUENCERS>0\nmat4 previousInfluence;\npreviousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(positionUpdated,1.0);\n#else\nvPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);\n#endif\n#endif\n#if defined(POSITION) || defined(BUMP)\nvPositionW=pos.xyz/pos.w;\n#endif\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n#ifdef NEED_UV\n#ifdef UV1\n#ifdef ALPHATEST\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#else\nvUV=uv;\n#endif\n#ifdef BUMP\nvBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef REFLECTIVITY\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#endif\n#ifdef UV2\n#ifdef ALPHATEST\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#else\nvUV=uv2;\n#endif\n#ifdef BUMP\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n#endif\n#ifdef REFLECTIVITY\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#endif\n#include<bumpVertex>\n}\n";
  var _d = (function () {
      function e(t, i) {
        void 0 === i && (i = 1),
          (this._previousTransformationMatrices = {}),
          (this._previousBonesTransformationMatrices = {}),
          (this.excludedSkinnedMeshesFromVelocity = []),
          (this.renderTransparentMeshes = !0),
          (this._resizeObserver = null),
          (this._enablePosition = !1),
          (this._enableVelocity = !1),
          (this._enableReflectivity = !1),
          (this._positionIndex = -1),
          (this._velocityIndex = -1),
          (this._reflectivityIndex = -1),
          (this._depthNormalIndex = -1),
          (this._linkedWithPrePass = !1),
          (this._scene = t),
          (this._ratio = i),
          e._SceneComponentInitialization(this._scene),
          this._createRenderTargets();
      }
      return (
        (e.prototype._linkPrePassRenderer = function (e) {
          (this._linkedWithPrePass = !0),
            (this._prePassRenderer = e),
            this._multiRenderTarget &&
              (this._multiRenderTarget.onClearObservable.clear(),
              this._multiRenderTarget.onClearObservable.add(function (e) {}));
        }),
        (e.prototype._unlinkPrePassRenderer = function () {
          (this._linkedWithPrePass = !1), this._createRenderTargets();
        }),
        (e.prototype._resetLayout = function () {
          (this._enablePosition = !1),
            (this._enableReflectivity = !1),
            (this._enableVelocity = !1),
            (this._attachments = []);
        }),
        (e.prototype._forceTextureType = function (t, i) {
          t === e.POSITION_TEXTURE_TYPE
            ? ((this._positionIndex = i), (this._enablePosition = !0))
            : t === e.VELOCITY_TEXTURE_TYPE
              ? ((this._velocityIndex = i), (this._enableVelocity = !0))
              : t === e.REFLECTIVITY_TEXTURE_TYPE
                ? ((this._reflectivityIndex = i),
                  (this._enableReflectivity = !0))
                : t === e.DEPTHNORMAL_TEXTURE_TYPE &&
                  (this._depthNormalIndex = i);
        }),
        (e.prototype._setAttachments = function (e) {
          this._attachments = e;
        }),
        (e.prototype._linkInternalTexture = function (e) {
          this._multiRenderTarget._texture = e;
        }),
        Object.defineProperty(e.prototype, "renderList", {
          get: function () {
            return this._multiRenderTarget.renderList;
          },
          set: function (e) {
            this._multiRenderTarget.renderList = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isSupported", {
          get: function () {
            return this._multiRenderTarget.isSupported;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.getTextureIndex = function (t) {
          switch (t) {
            case e.POSITION_TEXTURE_TYPE:
              return this._positionIndex;
            case e.VELOCITY_TEXTURE_TYPE:
              return this._velocityIndex;
            case e.REFLECTIVITY_TEXTURE_TYPE:
              return this._reflectivityIndex;
            default:
              return -1;
          }
        }),
        Object.defineProperty(e.prototype, "enablePosition", {
          get: function () {
            return this._enablePosition;
          },
          set: function (e) {
            (this._enablePosition = e),
              this._linkedWithPrePass ||
                (this.dispose(), this._createRenderTargets());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "enableVelocity", {
          get: function () {
            return this._enableVelocity;
          },
          set: function (e) {
            (this._enableVelocity = e),
              e || (this._previousTransformationMatrices = {}),
              this._linkedWithPrePass ||
                (this.dispose(), this._createRenderTargets());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "enableReflectivity", {
          get: function () {
            return this._enableReflectivity;
          },
          set: function (e) {
            (this._enableReflectivity = e),
              this._linkedWithPrePass ||
                (this.dispose(), this._createRenderTargets());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "scene", {
          get: function () {
            return this._scene;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "ratio", {
          get: function () {
            return this._ratio;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.isReady = function (e, t) {
          var i = e.getMaterial();
          if (i && i.disableDepthWrite) return !1;
          var n = [],
            r = [wt.PositionKind, wt.NormalKind],
            o = e.getMesh();
          if (i) {
            var s = !1;
            i.needAlphaTesting() && (n.push("#define ALPHATEST"), (s = !0)),
              i.bumpTexture &&
                qr.BumpTextureEnabled &&
                (n.push("#define BUMP"),
                n.push("#define BUMPDIRECTUV 0"),
                (s = !0)),
              this._enableReflectivity &&
                (i instanceof qr && i.specularTexture
                  ? (n.push("#define HAS_SPECULAR"), (s = !0))
                  : i instanceof Zs &&
                    i.reflectivityTexture &&
                    (n.push("#define HAS_REFLECTIVITY"), (s = !0))),
              s &&
                (n.push("#define NEED_UV"),
                o.isVerticesDataPresent(wt.UVKind) &&
                  (r.push(wt.UVKind), n.push("#define UV1")),
                o.isVerticesDataPresent(wt.UV2Kind) &&
                  (r.push(wt.UV2Kind), n.push("#define UV2")));
          }
          this._linkedWithPrePass &&
            (n.push("#define PREPASS"),
            -1 !== this._depthNormalIndex &&
              (n.push("#define DEPTHNORMAL_INDEX " + this._depthNormalIndex),
              n.push("#define PREPASS_DEPTHNORMAL"))),
            this._enablePosition &&
              (n.push("#define POSITION"),
              n.push("#define POSITION_INDEX " + this._positionIndex)),
            this._enableVelocity &&
              (n.push("#define VELOCITY"),
              n.push("#define VELOCITY_INDEX " + this._velocityIndex),
              -1 === this.excludedSkinnedMeshesFromVelocity.indexOf(o) &&
                n.push("#define BONES_VELOCITY_ENABLED")),
            this._enableReflectivity &&
              (n.push("#define REFLECTIVITY"),
              n.push("#define REFLECTIVITY_INDEX " + this._reflectivityIndex)),
            o.useBones && o.computeBonesUsingShaders
              ? (r.push(wt.MatricesIndicesKind),
                r.push(wt.MatricesWeightsKind),
                o.numBoneInfluencers > 4 &&
                  (r.push(wt.MatricesIndicesExtraKind),
                  r.push(wt.MatricesWeightsExtraKind)),
                n.push("#define NUM_BONE_INFLUENCERS " + o.numBoneInfluencers),
                n.push(
                  "#define BonesPerMesh " +
                    (o.skeleton ? o.skeleton.bones.length + 1 : 0)
                ))
              : n.push("#define NUM_BONE_INFLUENCERS 0");
          var a = o.morphTargetManager,
            l = 0;
          a &&
            a.numInfluencers > 0 &&
            ((l = a.numInfluencers),
            n.push("#define MORPHTARGETS"),
            n.push("#define NUM_MORPH_INFLUENCERS " + l),
            Hr.PrepareAttributesForMorphTargetsInfluencers(r, o, l)),
            t &&
              (n.push("#define INSTANCES"),
              Hr.PushAttributesForInstances(r),
              e.getRenderingMesh().hasThinInstances &&
                n.push("#define THIN_INSTANCES")),
            this._linkedWithPrePass
              ? n.push(
                  "#define RENDER_TARGET_COUNT " + this._attachments.length
                )
              : n.push(
                  "#define RENDER_TARGET_COUNT " +
                    this._multiRenderTarget.textures.length
                );
          var c = n.join("\n");
          return (
            this._cachedDefines !== c &&
              ((this._cachedDefines = c),
              (this._effect = this._scene
                .getEngine()
                .createEffect(
                  "geometry",
                  r,
                  [
                    "world",
                    "mBones",
                    "viewProjection",
                    "diffuseMatrix",
                    "view",
                    "previousWorld",
                    "previousViewProjection",
                    "mPreviousBones",
                    "morphTargetInfluences",
                    "bumpMatrix",
                    "reflectivityMatrix",
                    "vTangentSpaceParams",
                    "vBumpInfos",
                  ],
                  ["diffuseSampler", "bumpSampler", "reflectivitySampler"],
                  c,
                  void 0,
                  void 0,
                  void 0,
                  {
                    buffersCount: this._multiRenderTarget.textures.length - 1,
                    maxSimultaneousMorphTargets: l,
                  }
                ))),
            this._effect.isReady()
          );
        }),
        (e.prototype.getGBuffer = function () {
          return this._multiRenderTarget;
        }),
        Object.defineProperty(e.prototype, "samples", {
          get: function () {
            return this._multiRenderTarget.samples;
          },
          set: function (e) {
            this._multiRenderTarget.samples = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.dispose = function () {
          this._resizeObserver &&
            (this._scene
              .getEngine()
              .onResizeObservable.remove(this._resizeObserver),
            (this._resizeObserver = null)),
            this.getGBuffer().dispose();
        }),
        (e.prototype._assignRenderTargetIndices = function () {
          var e = 2;
          return (
            this._enablePosition && ((this._positionIndex = e), e++),
            this._enableVelocity && ((this._velocityIndex = e), e++),
            this._enableReflectivity && ((this._reflectivityIndex = e), e++),
            e
          );
        }),
        (e.prototype._createRenderTargets = function () {
          var e = this,
            t = this._scene.getEngine(),
            i = this._assignRenderTargetIndices();
          if (
            ((this._multiRenderTarget = new kl(
              "gBuffer",
              {
                width: t.getRenderWidth() * this._ratio,
                height: t.getRenderHeight() * this._ratio,
              },
              i,
              this._scene,
              {
                generateMipMaps: !1,
                generateDepthTexture: !0,
                defaultType: 1,
              }
            )),
            this.isSupported)
          ) {
            (this._multiRenderTarget.wrapU = mn.CLAMP_ADDRESSMODE),
              (this._multiRenderTarget.wrapV = mn.CLAMP_ADDRESSMODE),
              (this._multiRenderTarget.refreshRate = 1),
              (this._multiRenderTarget.renderParticles = !1),
              (this._multiRenderTarget.renderList = null),
              this._multiRenderTarget.onClearObservable.add(function (e) {
                e.clear(new T(0, 0, 0, 1), !0, !0, !0);
              }),
              (this._resizeObserver = t.onResizeObservable.add(function () {
                e._multiRenderTarget &&
                  e._multiRenderTarget.resize({
                    width: t.getRenderWidth() * e._ratio,
                    height: t.getRenderHeight() * e._ratio,
                  });
              }));
            var n = function (t) {
              var i = t.getRenderingMesh(),
                n = t.getEffectiveMesh(),
                r = e._scene,
                o = r.getEngine(),
                s = t.getMaterial();
              if (s) {
                if (
                  ((n._internalAbstractMeshDataInfo._isActiveIntermediate = !1),
                  e._enableVelocity &&
                    !e._previousTransformationMatrices[n.uniqueId] &&
                    ((e._previousTransformationMatrices[n.uniqueId] = {
                      world: g.Identity(),
                      viewProjection: r.getTransformMatrix(),
                    }),
                    i.skeleton))
                ) {
                  var a = i.skeleton.getTransformMatrices(i);
                  e._previousBonesTransformationMatrices[i.uniqueId] =
                    e._copyBonesTransformationMatrices(
                      a,
                      new Float32Array(a.length)
                    );
                }
                var l = i._getInstancesRenderList(
                  t._id,
                  !!t.getReplacementMesh()
                );
                if (!l.mustReturn) {
                  var c =
                      o.getCaps().instancedArrays &&
                      (null !== l.visibleInstances[t._id] ||
                        i.hasThinInstances),
                    u = n.getWorldMatrix();
                  if (e.isReady(t, c)) {
                    if (
                      (o.enableEffect(e._effect),
                      i._bind(t, e._effect, s.fillMode),
                      e._effect.setMatrix(
                        "viewProjection",
                        r.getTransformMatrix()
                      ),
                      e._effect.setMatrix("view", r.getViewMatrix()),
                      s)
                    ) {
                      var h,
                        d = n._instanceDataStorage;
                      if (
                        d.isFrozen ||
                        (!s.backFaceCulling &&
                          null === s.overrideMaterialSideOrientation)
                      )
                        h = d.sideOrientation;
                      else {
                        var p = n._getWorldMatrixDeterminant();
                        null == (h = s.overrideMaterialSideOrientation) &&
                          (h = s.sideOrientation),
                          p < 0 &&
                            (h =
                              h === si.ClockWiseSideOrientation
                                ? si.CounterClockWiseSideOrientation
                                : si.ClockWiseSideOrientation);
                      }
                      if ((s._preBind(e._effect, h), s.needAlphaTesting())) {
                        var f = s.getAlphaTestTexture();
                        f &&
                          (e._effect.setTexture("diffuseSampler", f),
                          e._effect.setMatrix(
                            "diffuseMatrix",
                            f.getTextureMatrix()
                          ));
                      }
                      s.bumpTexture &&
                        r.getEngine().getCaps().standardDerivatives &&
                        qr.BumpTextureEnabled &&
                        (e._effect.setFloat3(
                          "vBumpInfos",
                          s.bumpTexture.coordinatesIndex,
                          1 / s.bumpTexture.level,
                          s.parallaxScaleBias
                        ),
                        e._effect.setMatrix(
                          "bumpMatrix",
                          s.bumpTexture.getTextureMatrix()
                        ),
                        e._effect.setTexture("bumpSampler", s.bumpTexture),
                        e._effect.setFloat2(
                          "vTangentSpaceParams",
                          s.invertNormalMapX ? -1 : 1,
                          s.invertNormalMapY ? -1 : 1
                        )),
                        e._enableReflectivity &&
                          (s instanceof qr && s.specularTexture
                            ? (e._effect.setMatrix(
                                "reflectivityMatrix",
                                s.specularTexture.getTextureMatrix()
                              ),
                              e._effect.setTexture(
                                "reflectivitySampler",
                                s.specularTexture
                              ))
                            : s instanceof Zs &&
                              s.reflectivityTexture &&
                              (e._effect.setMatrix(
                                "reflectivityMatrix",
                                s.reflectivityTexture.getTextureMatrix()
                              ),
                              e._effect.setTexture(
                                "reflectivitySampler",
                                s.reflectivityTexture
                              )));
                    }
                    i.useBones &&
                      i.computeBonesUsingShaders &&
                      i.skeleton &&
                      (e._effect.setMatrices(
                        "mBones",
                        i.skeleton.getTransformMatrices(i)
                      ),
                      e._enableVelocity &&
                        e._effect.setMatrices(
                          "mPreviousBones",
                          e._previousBonesTransformationMatrices[i.uniqueId]
                        )),
                      Hr.BindMorphTargetParameters(i, e._effect),
                      e._enableVelocity &&
                        (e._effect.setMatrix(
                          "previousWorld",
                          e._previousTransformationMatrices[n.uniqueId].world
                        ),
                        e._effect.setMatrix(
                          "previousViewProjection",
                          e._previousTransformationMatrices[n.uniqueId]
                            .viewProjection
                        )),
                      i._processRendering(
                        n,
                        t,
                        e._effect,
                        s.fillMode,
                        l,
                        c,
                        function (t, i) {
                          return e._effect.setMatrix("world", i);
                        }
                      );
                  }
                  e._enableVelocity &&
                    ((e._previousTransformationMatrices[n.uniqueId].world =
                      u.clone()),
                    (e._previousTransformationMatrices[
                      n.uniqueId
                    ].viewProjection = e._scene.getTransformMatrix().clone()),
                    i.skeleton &&
                      e._copyBonesTransformationMatrices(
                        i.skeleton.getTransformMatrices(i),
                        e._previousBonesTransformationMatrices[n.uniqueId]
                      ));
                }
              }
            };
            this._multiRenderTarget.customRenderFunction = function (
              i,
              r,
              o,
              s
            ) {
              var a;
              if (e._linkedWithPrePass) {
                if (!e._prePassRenderer.enabled) return;
                e._scene.getEngine().bindAttachments(e._attachments);
              }
              if (s.length) {
                for (t.setColorWrite(!1), a = 0; a < s.length; a++)
                  n(s.data[a]);
                t.setColorWrite(!0);
              }
              for (a = 0; a < i.length; a++) n(i.data[a]);
              for (a = 0; a < r.length; a++) n(r.data[a]);
              if (e.renderTransparentMeshes)
                for (a = 0; a < o.length; a++) n(o.data[a]);
            };
          }
        }),
        (e.prototype._copyBonesTransformationMatrices = function (e, t) {
          for (var i = 0; i < e.length; i++) t[i] = e[i];
          return t;
        }),
        (e.DEPTHNORMAL_TEXTURE_TYPE = 0),
        (e.POSITION_TEXTURE_TYPE = 1),
        (e.VELOCITY_TEXTURE_TYPE = 2),
        (e.REFLECTIVITY_TEXTURE_TYPE = 3),
        (e._SceneComponentInitialization = function (e) {
          throw $.WarnImport("GeometryBufferRendererSceneComponent");
        }),
        e
      );
    })(),
    md = function () {
      (this.enabled = !1),
        (this.name = "motionBlur"),
        (this.texturesRequired = [2]);
    };
  Object.defineProperty(Ci.prototype, "geometryBufferRenderer", {
    get: function () {
      this._geometryBufferRenderer;
    },
    set: function (e) {
      e && e.isSupported && (this._geometryBufferRenderer = e);
    },
    enumerable: !0,
    configurable: !0,
  }),
    (Ci.prototype.enableGeometryBufferRenderer = function (e) {
      return (
        void 0 === e && (e = 1),
        this._geometryBufferRenderer ||
          ((this._geometryBufferRenderer = new _d(this, e)),
          this._geometryBufferRenderer.isSupported ||
            (this._geometryBufferRenderer = null)),
        this._geometryBufferRenderer
      );
    }),
    (Ci.prototype.disableGeometryBufferRenderer = function () {
      this._geometryBufferRenderer &&
        (this._geometryBufferRenderer.dispose(),
        (this._geometryBufferRenderer = null));
    });
  var gd = (function () {
    function e(e) {
      (this.name = hi.NAME_GEOMETRYBUFFERRENDERER), (this.scene = e);
    }
    return (
      (e.prototype.register = function () {
        this.scene._gatherRenderTargetsStage.registerStep(
          hi.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER,
          this,
          this._gatherRenderTargets
        );
      }),
      (e.prototype.rebuild = function () {}),
      (e.prototype.dispose = function () {}),
      (e.prototype._gatherRenderTargets = function (e) {
        this.scene._geometryBufferRenderer &&
          e.push(this.scene._geometryBufferRenderer.getGBuffer());
      }),
      e
    );
  })();
  _d._SceneComponentInitialization = function (e) {
    var t = e._getComponent(hi.NAME_GEOMETRYBUFFERRENDERER);
    t || ((t = new gd(e)), e._addComponent(t));
  };
  Ke.ShadersStore.motionBlurPixelShader =
    "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform float motionStrength;\nuniform float motionScale;\nuniform vec2 screenSize;\n#ifdef OBJECT_BASED\nuniform sampler2D velocitySampler;\n#else\nuniform sampler2D depthSampler;\nuniform mat4 inverseViewProjection;\nuniform mat4 prevViewProjection;\n#endif\nvoid main(void)\n{\n#ifdef GEOMETRY_SUPPORTED\n#ifdef OBJECT_BASED\nvec2 texelSize=1.0/screenSize;\nvec2 velocityColor=texture2D(velocitySampler,vUV).rg*2.0-1.0;\nvec2 velocity=vec2(pow(velocityColor.r,3.0),pow(velocityColor.g,3.0));\nvelocity*=motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint samplesCount=int(clamp(speed,1.0,SAMPLES));\nvelocity=normalize(velocity)*texelSize;\nfloat hlim=float(-samplesCount)*0.5+0.5;\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(SAMPLES); ++i)\n{\nif (i>=samplesCount)\nbreak;\nvec2 offset=vUV+velocity*(hlim+float(i));\nresult+=texture2D(textureSampler,offset);\n}\ngl_FragColor=result/float(samplesCount);\ngl_FragColor.a=1.0;\n#else\nvec2 texelSize=1.0/screenSize;\nfloat depth=texture2D(depthSampler,vUV).r;\nvec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);\ncpos=cpos*inverseViewProjection;\nvec4 ppos=cpos*prevViewProjection;\nppos.xyz/=ppos.w;\nppos.xy=ppos.xy*0.5+0.5;\nvec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint nSamples=int(clamp(speed,1.0,SAMPLES));\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(SAMPLES); ++i) {\nif (i>=nSamples)\nbreak;\nvec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);\nresult+=texture2D(textureSampler,offset1);\n}\ngl_FragColor=result/float(nSamples);\n#endif\n#else\ngl_FragColor=texture2D(textureSampler,vUV);\n#endif\n}\n";
  var vd = (function (e) {
    function t(t, i, n, r, o, s, a, l, c, u) {
      void 0 === l && (l = 0),
        void 0 === c && (c = !1),
        void 0 === u && (u = !0);
      var h =
        e.call(
          this,
          t,
          "motionBlur",
          [
            "motionStrength",
            "motionScale",
            "screenSize",
            "inverseViewProjection",
            "prevViewProjection",
          ],
          ["velocitySampler"],
          n,
          r,
          o,
          s,
          a,
          "#define GEOMETRY_SUPPORTED\n#define SAMPLES 64.0\n#define OBJECT_BASED",
          l,
          void 0,
          null,
          c
        ) || this;
      return (
        (h.motionStrength = 1),
        (h._motionBlurSamples = 32),
        (h._isObjectBased = !0),
        (h._forceGeometryBuffer = !1),
        (h._geometryBufferRenderer = null),
        (h._prePassRenderer = null),
        (h._invViewProjection = null),
        (h._previousViewProjection = null),
        (h._forceGeometryBuffer = u),
        h._forceGeometryBuffer
          ? ((h._geometryBufferRenderer = i.enableGeometryBufferRenderer()),
            h._geometryBufferRenderer &&
              (h._geometryBufferRenderer.enableVelocity = !0))
          : ((h._prePassRenderer = i.enablePrePassRenderer()),
            h._prePassRenderer &&
              (h._prePassRenderer.markAsDirty(),
              (h._prePassEffectConfiguration = new md()))),
        h._applyMode(),
        h
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "motionBlurSamples", {
        get: function () {
          return this._motionBlurSamples;
        },
        set: function (e) {
          (this._motionBlurSamples = e), this._updateEffect();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "isObjectBased", {
        get: function () {
          return this._isObjectBased;
        },
        set: function (e) {
          this._isObjectBased !== e &&
            ((this._isObjectBased = e), this._applyMode());
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.getClassName = function () {
        return "MotionBlurPostProcess";
      }),
      (t.prototype.excludeSkinnedMesh = function (e) {
        if (e.skeleton) {
          var t = void 0;
          if (this._geometryBufferRenderer)
            t = this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity;
          else {
            if (!this._prePassRenderer) return;
            t = this._prePassRenderer.excludedSkinnedMesh;
          }
          t.push(e);
        }
      }),
      (t.prototype.removeExcludedSkinnedMesh = function (e) {
        if (e.skeleton) {
          var t = void 0;
          if (this._geometryBufferRenderer)
            t = this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity;
          else {
            if (!this._prePassRenderer) return;
            t = this._prePassRenderer.excludedSkinnedMesh;
          }
          var i = t.indexOf(e);
          -1 !== i && t.splice(i, 1);
        }
      }),
      (t.prototype.dispose = function (t) {
        this._geometryBufferRenderer &&
          ((this._geometryBufferRenderer._previousTransformationMatrices = {}),
          (this._geometryBufferRenderer._previousBonesTransformationMatrices =
            {}),
          (this._geometryBufferRenderer.excludedSkinnedMeshesFromVelocity =
            [])),
          e.prototype.dispose.call(this, t);
      }),
      (t.prototype._applyMode = function () {
        var e = this;
        if (!this._geometryBufferRenderer && !this._prePassRenderer)
          return (
            F.Warn(
              "Multiple Render Target support needed to compute object based motion blur"
            ),
            this.updateEffect()
          );
        this._updateEffect(),
          (this._invViewProjection = null),
          (this._previousViewProjection = null),
          this.isObjectBased
            ? (this._prePassRenderer &&
                this._prePassEffectConfiguration &&
                (this._prePassEffectConfiguration.texturesRequired[0] = 2),
              (this.onApply = function (t) {
                return e._onApplyObjectBased(t);
              }))
            : ((this._invViewProjection = g.Identity()),
              (this._previousViewProjection = g.Identity()),
              this._prePassRenderer &&
                this._prePassEffectConfiguration &&
                (this._prePassEffectConfiguration.texturesRequired[0] = 5),
              (this.onApply = function (t) {
                return e._onApplyScreenBased(t);
              }));
      }),
      (t.prototype._onApplyObjectBased = function (e) {
        if (
          (e.setVector2("screenSize", new p(this.width, this.height)),
          e.setFloat("motionScale", this._scene.getAnimationRatio()),
          e.setFloat("motionStrength", this.motionStrength),
          this._geometryBufferRenderer)
        ) {
          var t = this._geometryBufferRenderer.getTextureIndex(
            _d.VELOCITY_TEXTURE_TYPE
          );
          e.setTexture(
            "velocitySampler",
            this._geometryBufferRenderer.getGBuffer().textures[t]
          );
        } else
          this._prePassRenderer &&
            ((t = this._prePassRenderer.getIndex(2)),
            e.setTexture(
              "velocitySampler",
              this._prePassRenderer.prePassRT.textures[t]
            ));
      }),
      (t.prototype._onApplyScreenBased = function (e) {
        var t = this._scene
          .getProjectionMatrix()
          .multiply(this._scene.getViewMatrix());
        if (
          (t.invertToRef(this._invViewProjection),
          e.setMatrix("inverseViewProjection", this._invViewProjection),
          e.setMatrix("prevViewProjection", this._previousViewProjection),
          (this._previousViewProjection = t),
          e.setVector2("screenSize", new p(this.width, this.height)),
          e.setFloat("motionScale", this._scene.getAnimationRatio()),
          e.setFloat("motionStrength", this.motionStrength),
          this._geometryBufferRenderer)
        ) {
          var i = this._geometryBufferRenderer.getTextureIndex(
            _d.DEPTHNORMAL_TEXTURE_TYPE
          );
          e.setTexture(
            "depthSampler",
            this._geometryBufferRenderer.getGBuffer().textures[i]
          );
        } else
          this._prePassRenderer &&
            ((i = this._prePassRenderer.getIndex(5)),
            e.setTexture(
              "depthSampler",
              this._prePassRenderer.prePassRT.textures[i]
            ));
      }),
      (t.prototype._updateEffect = function () {
        if (this._geometryBufferRenderer || this._prePassRenderer) {
          var e = [
            "#define GEOMETRY_SUPPORTED",
            "#define SAMPLES " + this._motionBlurSamples.toFixed(1),
            this._isObjectBased
              ? "#define OBJECT_BASED"
              : "#define SCREEN_BASED",
          ];
          this.updateEffect(e.join("\n"));
        }
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              n,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.reusable,
              e.textureType,
              !1
            );
          },
          e,
          n,
          r
        );
      }),
      R([se()], t.prototype, "motionStrength", void 0),
      R([se()], t.prototype, "motionBlurSamples", null),
      R([se()], t.prototype, "isObjectBased", null),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.MotionBlurPostProcess"] = vd;
  Ke.ShadersStore.refractionPixelShader =
    "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}";
  var yd = (function (e) {
    function t(t, i, n, r, o, s, a, l, c, u) {
      var h =
        e.call(
          this,
          t,
          "refraction",
          ["baseColor", "depth", "colorLevel"],
          ["refractionSampler"],
          s,
          a,
          l,
          c,
          u
        ) || this;
      return (
        (h._ownRefractionTexture = !0),
        (h.color = n),
        (h.depth = r),
        (h.colorLevel = o),
        (h.refractionTextureUrl = i),
        h.onActivateObservable.add(function (e) {
          h._refTexture = h._refTexture || new mn(i, e.getScene());
        }),
        h.onApplyObservable.add(function (e) {
          e.setColor3("baseColor", h.color),
            e.setFloat("depth", h.depth),
            e.setFloat("colorLevel", h.colorLevel),
            e.setTexture("refractionSampler", h._refTexture);
        }),
        h
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "refractionTexture", {
        get: function () {
          return this._refTexture;
        },
        set: function (e) {
          this._refTexture &&
            this._ownRefractionTexture &&
            this._refTexture.dispose(),
            (this._refTexture = e),
            (this._ownRefractionTexture = !1);
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.getClassName = function () {
        return "RefractionPostProcess";
      }),
      (t.prototype.dispose = function (t) {
        this._refTexture &&
          this._ownRefractionTexture &&
          (this._refTexture.dispose(), (this._refTexture = null)),
          e.prototype.dispose.call(this, t);
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              e.refractionTextureUrl,
              e.color,
              e.depth,
              e.colorLevel,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.reusable
            );
          },
          e,
          n,
          r
        );
      }),
      R([se()], t.prototype, "color", void 0),
      R([se()], t.prototype, "depth", void 0),
      R([se()], t.prototype, "colorLevel", void 0),
      R([se()], t.prototype, "refractionTextureUrl", void 0),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.RefractionPostProcess"] = yd;
  Ke.ShadersStore.sharpenPixelShader =
    "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform vec2 sharpnessAmounts;\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 color=texture2D(textureSampler,vUV);\nvec4 edgeDetection=texture2D(textureSampler,vUV+onePixel*vec2(0,-1)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0)) +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1)) -\ncolor*4.0;\ngl_FragColor=max(vec4(color.rgb*sharpnessAmounts.y,color.a)-(sharpnessAmounts.x*vec4(edgeDetection.rgb,0)),0.);\n}";
  var bd = (function (e) {
    function t(t, i, n, r, o, s, a, l) {
      void 0 === a && (a = 0), void 0 === l && (l = !1);
      var c =
        e.call(
          this,
          t,
          "sharpen",
          ["sharpnessAmounts", "screenSize"],
          null,
          i,
          n,
          r,
          o,
          s,
          null,
          a,
          void 0,
          null,
          l
        ) || this;
      return (
        (c.colorAmount = 1),
        (c.edgeAmount = 0.3),
        (c.onApply = function (e) {
          e.setFloat2("screenSize", c.width, c.height),
            e.setFloat2("sharpnessAmounts", c.edgeAmount, c.colorAmount);
        }),
        c
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "SharpenPostProcess";
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.textureType,
              e.reusable
            );
          },
          e,
          n,
          r
        );
      }),
      R([se()], t.prototype, "colorAmount", void 0),
      R([se()], t.prototype, "edgeAmount", void 0),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.SharpenPostProcess"] = bd;
  var Td = (function () {
      function e(e, t) {
        (this.engine = e),
          (this._name = t),
          (this._renderEffects = {}),
          (this._renderEffectsForIsolatedPass = new Array()),
          (this._cameras = []);
      }
      return (
        Object.defineProperty(e.prototype, "name", {
          get: function () {
            return this._name;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "cameras", {
          get: function () {
            return this._cameras;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.getClassName = function () {
          return "PostProcessRenderPipeline";
        }),
        Object.defineProperty(e.prototype, "isSupported", {
          get: function () {
            for (var e in this._renderEffects)
              if (
                this._renderEffects.hasOwnProperty(e) &&
                !this._renderEffects[e].isSupported
              )
                return !1;
            return !0;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.addEffect = function (e) {
          this._renderEffects[e._name] = e;
        }),
        (e.prototype._rebuild = function () {}),
        (e.prototype._enableEffect = function (e, t) {
          var i = this._renderEffects[e];
          i && i._enable(yt.MakeArray(t || this._cameras));
        }),
        (e.prototype._disableEffect = function (e, t) {
          var i = this._renderEffects[e];
          i && i._disable(yt.MakeArray(t || this._cameras));
        }),
        (e.prototype._attachCameras = function (e, t) {
          var i = yt.MakeArray(e || this._cameras);
          if (i) {
            var n,
              r = [];
            for (n = 0; n < i.length; n++) {
              var o = i[n];
              if (o) {
                var s = o.name;
                -1 === this._cameras.indexOf(o)
                  ? (this._cameras[s] = o)
                  : t && r.push(n);
              }
            }
            for (n = 0; n < r.length; n++) e.splice(r[n], 1);
            for (var a in this._renderEffects)
              this._renderEffects.hasOwnProperty(a) &&
                this._renderEffects[a]._attachCameras(i);
          }
        }),
        (e.prototype._detachCameras = function (e) {
          var t = yt.MakeArray(e || this._cameras);
          if (t) {
            for (var i in this._renderEffects)
              this._renderEffects.hasOwnProperty(i) &&
                this._renderEffects[i]._detachCameras(t);
            for (var n = 0; n < t.length; n++)
              this._cameras.splice(this._cameras.indexOf(t[n]), 1);
          }
        }),
        (e.prototype._update = function () {
          for (var e in this._renderEffects)
            this._renderEffects.hasOwnProperty(e) &&
              this._renderEffects[e]._update();
          for (var t = 0; t < this._cameras.length; t++)
            if (this._cameras[t]) {
              var i = this._cameras[t].name;
              this._renderEffectsForIsolatedPass[i] &&
                this._renderEffectsForIsolatedPass[i]._update();
            }
        }),
        (e.prototype._reset = function () {
          (this._renderEffects = {}),
            (this._renderEffectsForIsolatedPass = new Array());
        }),
        (e.prototype._enableMSAAOnFirstPostProcess = function (e) {
          if (1 === this.engine.webGLVersion) return !1;
          var t = Object.keys(this._renderEffects);
          if (t.length > 0) {
            var i = this._renderEffects[t[0]].getPostProcesses();
            i && (i[0].samples = e);
          }
          return !0;
        }),
        (e.prototype.setPrePassRenderer = function (e) {
          return !1;
        }),
        (e.prototype.dispose = function () {}),
        R([se()], e.prototype, "_name", void 0),
        e
      );
    })(),
    Sd = (function () {
      function e() {
        this._renderPipelines = {};
      }
      return (
        Object.defineProperty(e.prototype, "supportedPipelines", {
          get: function () {
            var e = [];
            for (var t in this._renderPipelines)
              if (this._renderPipelines.hasOwnProperty(t)) {
                var i = this._renderPipelines[t];
                i.isSupported && e.push(i);
              }
            return e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.addPipeline = function (e) {
          this._renderPipelines[e._name] = e;
        }),
        (e.prototype.attachCamerasToRenderPipeline = function (e, t, i) {
          void 0 === i && (i = !1);
          var n = this._renderPipelines[e];
          n && n._attachCameras(t, i);
        }),
        (e.prototype.detachCamerasFromRenderPipeline = function (e, t) {
          var i = this._renderPipelines[e];
          i && i._detachCameras(t);
        }),
        (e.prototype.enableEffectInPipeline = function (e, t, i) {
          var n = this._renderPipelines[e];
          n && n._enableEffect(t, i);
        }),
        (e.prototype.disableEffectInPipeline = function (e, t, i) {
          var n = this._renderPipelines[e];
          n && n._disableEffect(t, i);
        }),
        (e.prototype.update = function () {
          for (var e in this._renderPipelines)
            if (this._renderPipelines.hasOwnProperty(e)) {
              var t = this._renderPipelines[e];
              t.isSupported
                ? t._update()
                : (t.dispose(), delete this._renderPipelines[e]);
            }
        }),
        (e.prototype._rebuild = function () {
          for (var e in this._renderPipelines)
            this._renderPipelines.hasOwnProperty(e) &&
              this._renderPipelines[e]._rebuild();
        }),
        (e.prototype.dispose = function () {
          for (var e in this._renderPipelines)
            this._renderPipelines.hasOwnProperty(e) &&
              this._renderPipelines[e].dispose();
        }),
        e
      );
    })();
  Object.defineProperty(Ci.prototype, "postProcessRenderPipelineManager", {
    get: function () {
      if (!this._postProcessRenderPipelineManager) {
        var e = this._getComponent(hi.NAME_POSTPROCESSRENDERPIPELINEMANAGER);
        e || ((e = new Cd(this)), this._addComponent(e)),
          (this._postProcessRenderPipelineManager = new Sd());
      }
      return this._postProcessRenderPipelineManager;
    },
    enumerable: !0,
    configurable: !0,
  });
  var Cd = (function () {
      function e(e) {
        (this.name = hi.NAME_POSTPROCESSRENDERPIPELINEMANAGER),
          (this.scene = e);
      }
      return (
        (e.prototype.register = function () {
          this.scene._gatherRenderTargetsStage.registerStep(
            hi.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER,
            this,
            this._gatherRenderTargets
          );
        }),
        (e.prototype.rebuild = function () {
          this.scene._postProcessRenderPipelineManager &&
            this.scene._postProcessRenderPipelineManager._rebuild();
        }),
        (e.prototype.dispose = function () {
          this.scene._postProcessRenderPipelineManager &&
            this.scene._postProcessRenderPipelineManager.dispose();
        }),
        (e.prototype._gatherRenderTargets = function () {
          this.scene._postProcessRenderPipelineManager &&
            this.scene._postProcessRenderPipelineManager.update();
        }),
        e
      );
    })(),
    xd = (function (e) {
      function t(t, i, n, r, s) {
        void 0 === t && (t = ""),
          void 0 === i && (i = !0),
          void 0 === n && (n = j.LastCreatedScene),
          void 0 === s && (s = !0);
        var a = e.call(this, n.getEngine(), t) || this;
        (a._camerasToBeAttached = []),
          (a.SharpenPostProcessId = "SharpenPostProcessEffect"),
          (a.ImageProcessingPostProcessId = "ImageProcessingPostProcessEffect"),
          (a.FxaaPostProcessId = "FxaaPostProcessEffect"),
          (a.ChromaticAberrationPostProcessId =
            "ChromaticAberrationPostProcessEffect"),
          (a.GrainPostProcessId = "GrainPostProcessEffect"),
          (a._glowLayer = null),
          (a.animations = []),
          (a._imageProcessingConfigurationObserver = null),
          (a._sharpenEnabled = !1),
          (a._bloomEnabled = !1),
          (a._depthOfFieldEnabled = !1),
          (a._depthOfFieldBlurLevel = ld.Low),
          (a._fxaaEnabled = !1),
          (a._imageProcessingEnabled = !0),
          (a._bloomScale = 0.5),
          (a._chromaticAberrationEnabled = !1),
          (a._grainEnabled = !1),
          (a._buildAllowed = !0),
          (a.onBuildObservable = new o()),
          (a._resizeObserver = null),
          (a._hardwareScaleLevel = 1),
          (a._bloomKernel = 64),
          (a._bloomWeight = 0.15),
          (a._bloomThreshold = 0.9),
          (a._samples = 1),
          (a._hasCleared = !1),
          (a._prevPostProcess = null),
          (a._prevPrevPostProcess = null),
          (a._depthOfFieldSceneObserver = null),
          (a._cameras = r || n.cameras),
          (a._cameras = a._cameras.slice()),
          (a._camerasToBeAttached = a._cameras.slice()),
          (a._buildAllowed = s),
          (a._scene = n);
        var l = a._scene.getEngine().getCaps();
        (a._hdr = i && (l.textureHalfFloatRender || l.textureFloatRender)),
          a._hdr
            ? l.textureHalfFloatRender
              ? (a._defaultPipelineTextureType = 2)
              : l.textureFloatRender && (a._defaultPipelineTextureType = 1)
            : (a._defaultPipelineTextureType = 0),
          n.postProcessRenderPipelineManager.addPipeline(a);
        var c = a._scene.getEngine();
        return (
          (a.sharpen = new bd(
            "sharpen",
            1,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            c,
            !1,
            a._defaultPipelineTextureType,
            !0
          )),
          (a._sharpenEffect = new $h(
            c,
            a.SharpenPostProcessId,
            function () {
              return a.sharpen;
            },
            !0
          )),
          (a.depthOfField = new ud(
            a._scene,
            null,
            a._depthOfFieldBlurLevel,
            a._defaultPipelineTextureType,
            !0
          )),
          (a.bloom = new id(
            a._scene,
            a._bloomScale,
            a._bloomWeight,
            a.bloomKernel,
            a._defaultPipelineTextureType,
            !0
          )),
          (a.chromaticAberration = new nd(
            "ChromaticAberration",
            c.getRenderWidth(),
            c.getRenderHeight(),
            1,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            c,
            !1,
            a._defaultPipelineTextureType,
            !0
          )),
          (a._chromaticAberrationEffect = new $h(
            c,
            a.ChromaticAberrationPostProcessId,
            function () {
              return a.chromaticAberration;
            },
            !0
          )),
          (a.grain = new fd(
            "Grain",
            1,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            c,
            !1,
            a._defaultPipelineTextureType,
            !0
          )),
          (a._grainEffect = new $h(
            c,
            a.GrainPostProcessId,
            function () {
              return a.grain;
            },
            !0
          )),
          (a._resizeObserver = c.onResizeObservable.add(function () {
            (a._hardwareScaleLevel = c.getHardwareScalingLevel()),
              (a.bloomKernel = a.bloomKernel);
          })),
          (a._imageProcessingConfigurationObserver =
            a._scene.imageProcessingConfiguration.onUpdateParameters.add(
              function () {
                (a.bloom._downscale._exposure =
                  a._scene.imageProcessingConfiguration.exposure),
                  a.imageProcessingEnabled !==
                    a._scene.imageProcessingConfiguration.isEnabled &&
                    ((a._imageProcessingEnabled =
                      a._scene.imageProcessingConfiguration.isEnabled),
                    a._buildPipeline());
              }
            )),
          a._buildPipeline(),
          a
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "scene", {
          get: function () {
            return this._scene;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "sharpenEnabled", {
          get: function () {
            return this._sharpenEnabled;
          },
          set: function (e) {
            this._sharpenEnabled !== e &&
              ((this._sharpenEnabled = e), this._buildPipeline());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "bloomKernel", {
          get: function () {
            return this._bloomKernel;
          },
          set: function (e) {
            (this._bloomKernel = e),
              (this.bloom.kernel = e / this._hardwareScaleLevel);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "bloomWeight", {
          get: function () {
            return this._bloomWeight;
          },
          set: function (e) {
            this._bloomWeight !== e &&
              ((this.bloom.weight = e), (this._bloomWeight = e));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "bloomThreshold", {
          get: function () {
            return this._bloomThreshold;
          },
          set: function (e) {
            this._bloomThreshold !== e &&
              ((this.bloom.threshold = e), (this._bloomThreshold = e));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "bloomScale", {
          get: function () {
            return this._bloomScale;
          },
          set: function (e) {
            this._bloomScale !== e &&
              ((this._bloomScale = e),
              this._rebuildBloom(),
              this._buildPipeline());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "bloomEnabled", {
          get: function () {
            return this._bloomEnabled;
          },
          set: function (e) {
            this._bloomEnabled !== e &&
              ((this._bloomEnabled = e), this._buildPipeline());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._rebuildBloom = function () {
          var e = this.bloom;
          (this.bloom = new id(
            this._scene,
            this.bloomScale,
            this._bloomWeight,
            this.bloomKernel,
            this._defaultPipelineTextureType,
            !1
          )),
            (this.bloom.threshold = e.threshold);
          for (var t = 0; t < this._cameras.length; t++)
            e.disposeEffects(this._cameras[t]);
        }),
        Object.defineProperty(t.prototype, "depthOfFieldEnabled", {
          get: function () {
            return this._depthOfFieldEnabled;
          },
          set: function (e) {
            this._depthOfFieldEnabled !== e &&
              ((this._depthOfFieldEnabled = e), this._buildPipeline());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "depthOfFieldBlurLevel", {
          get: function () {
            return this._depthOfFieldBlurLevel;
          },
          set: function (e) {
            if (this._depthOfFieldBlurLevel !== e) {
              this._depthOfFieldBlurLevel = e;
              var t = this.depthOfField;
              (this.depthOfField = new ud(
                this._scene,
                null,
                this._depthOfFieldBlurLevel,
                this._defaultPipelineTextureType,
                !1
              )),
                (this.depthOfField.focalLength = t.focalLength),
                (this.depthOfField.focusDistance = t.focusDistance),
                (this.depthOfField.fStop = t.fStop),
                (this.depthOfField.lensSize = t.lensSize);
              for (var i = 0; i < this._cameras.length; i++)
                t.disposeEffects(this._cameras[i]);
              this._buildPipeline();
            }
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "fxaaEnabled", {
          get: function () {
            return this._fxaaEnabled;
          },
          set: function (e) {
            this._fxaaEnabled !== e &&
              ((this._fxaaEnabled = e), this._buildPipeline());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "samples", {
          get: function () {
            return this._samples;
          },
          set: function (e) {
            this._samples !== e && ((this._samples = e), this._buildPipeline());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "imageProcessingEnabled", {
          get: function () {
            return this._imageProcessingEnabled;
          },
          set: function (e) {
            this._imageProcessingEnabled !== e &&
              (this._scene.imageProcessingConfiguration.isEnabled = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "glowLayerEnabled", {
          get: function () {
            return null != this._glowLayer;
          },
          set: function (e) {
            e && !this._glowLayer
              ? (this._glowLayer = new Va("", this._scene))
              : !e &&
                this._glowLayer &&
                (this._glowLayer.dispose(), (this._glowLayer = null));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "glowLayer", {
          get: function () {
            return this._glowLayer;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "chromaticAberrationEnabled", {
          get: function () {
            return this._chromaticAberrationEnabled;
          },
          set: function (e) {
            this._chromaticAberrationEnabled !== e &&
              ((this._chromaticAberrationEnabled = e), this._buildPipeline());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "grainEnabled", {
          get: function () {
            return this._grainEnabled;
          },
          set: function (e) {
            this._grainEnabled !== e &&
              ((this._grainEnabled = e), this._buildPipeline());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getClassName = function () {
          return "DefaultRenderingPipeline";
        }),
        (t.prototype.prepare = function () {
          var e = this._buildAllowed;
          (this._buildAllowed = !0),
            this._buildPipeline(),
            (this._buildAllowed = e);
        }),
        (t.prototype._setAutoClearAndTextureSharing = function (e, t) {
          void 0 === t && (t = !1),
            this._hasCleared
              ? (e.autoClear = !1)
              : ((e.autoClear = !0),
                (this._scene.autoClear = !1),
                (this._hasCleared = !0)),
            t ||
              (this._prevPrevPostProcess
                ? e.shareOutputWith(this._prevPrevPostProcess)
                : e.useOwnOutput(),
              this._prevPostProcess &&
                (this._prevPrevPostProcess = this._prevPostProcess),
              (this._prevPostProcess = e));
        }),
        (t.prototype._buildPipeline = function () {
          var e = this;
          if (this._buildAllowed) {
            this._scene.autoClear = !0;
            var t = this._scene.getEngine();
            if (
              (this._disposePostProcesses(),
              null !== this._cameras &&
                (this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(
                  this._name,
                  this._cameras
                ),
                (this._cameras = this._camerasToBeAttached.slice())),
              this._reset(),
              (this._prevPostProcess = null),
              (this._prevPrevPostProcess = null),
              (this._hasCleared = !1),
              this.depthOfFieldEnabled)
            ) {
              if (this._cameras.length > 1) {
                for (var i = 0, n = this._cameras; i < n.length; i++) {
                  var r = n[i];
                  (o =
                    this._scene.enableDepthRenderer(r)).useOnlyInActiveCamera =
                    !0;
                }
                this._depthOfFieldSceneObserver =
                  this._scene.onAfterRenderTargetsRenderObservable.add(
                    function (t) {
                      e._cameras.indexOf(t.activeCamera) > -1 &&
                        (e.depthOfField.depthTexture = t
                          .enableDepthRenderer(t.activeCamera)
                          .getDepthMap());
                    }
                  );
              } else {
                this._scene.onAfterRenderTargetsRenderObservable.remove(
                  this._depthOfFieldSceneObserver
                );
                var o = this._scene.enableDepthRenderer(this._cameras[0]);
                this.depthOfField.depthTexture = o.getDepthMap();
              }
              this.depthOfField._isReady() ||
                this.depthOfField._updateEffects(),
                this.addEffect(this.depthOfField),
                this._setAutoClearAndTextureSharing(
                  this.depthOfField._effects[0],
                  !0
                );
            } else
              this._scene.onAfterRenderTargetsRenderObservable.remove(
                this._depthOfFieldSceneObserver
              );
            this.bloomEnabled &&
              (this.bloom._isReady() || this.bloom._updateEffects(),
              this.addEffect(this.bloom),
              this._setAutoClearAndTextureSharing(this.bloom._effects[0], !0)),
              this._imageProcessingEnabled &&
                ((this.imageProcessing = new Jr(
                  "imageProcessing",
                  1,
                  null,
                  mn.BILINEAR_SAMPLINGMODE,
                  t,
                  !1,
                  this._defaultPipelineTextureType
                )),
                this._hdr
                  ? (this.addEffect(
                      new $h(
                        t,
                        this.ImageProcessingPostProcessId,
                        function () {
                          return e.imageProcessing;
                        },
                        !0
                      )
                    ),
                    this._setAutoClearAndTextureSharing(this.imageProcessing))
                  : (this._scene.imageProcessingConfiguration.applyByPostProcess =
                      !1),
                (this.cameras && 0 !== this.cameras.length) ||
                  (this._scene.imageProcessingConfiguration.applyByPostProcess =
                    !1),
                this.imageProcessing.getEffect() ||
                  this.imageProcessing._updateParameters()),
              this.sharpenEnabled &&
                (this.sharpen.isReady() || this.sharpen.updateEffect(),
                this.addEffect(this._sharpenEffect),
                this._setAutoClearAndTextureSharing(this.sharpen)),
              this.grainEnabled &&
                (this.grain.isReady() || this.grain.updateEffect(),
                this.addEffect(this._grainEffect),
                this._setAutoClearAndTextureSharing(this.grain)),
              this.chromaticAberrationEnabled &&
                (this.chromaticAberration.isReady() ||
                  this.chromaticAberration.updateEffect(),
                this.addEffect(this._chromaticAberrationEffect),
                this._setAutoClearAndTextureSharing(this.chromaticAberration)),
              this.fxaaEnabled &&
                ((this.fxaa = new pd(
                  "fxaa",
                  1,
                  null,
                  mn.BILINEAR_SAMPLINGMODE,
                  t,
                  !1,
                  this._defaultPipelineTextureType
                )),
                this.addEffect(
                  new $h(
                    t,
                    this.FxaaPostProcessId,
                    function () {
                      return e.fxaa;
                    },
                    !0
                  )
                ),
                this._setAutoClearAndTextureSharing(this.fxaa, !0)),
              null !== this._cameras &&
                this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(
                  this._name,
                  this._cameras
                ),
              this._scene.activeCameras &&
                this._scene.activeCameras.length > 1 &&
                (this._scene.autoClear = !0),
              !this._enableMSAAOnFirstPostProcess(this.samples) &&
                this.samples > 1 &&
                F.Warn(
                  "MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0"
                ),
              this.onBuildObservable.notifyObservers(this);
          }
        }),
        (t.prototype._disposePostProcesses = function (e) {
          void 0 === e && (e = !1);
          for (var t = 0; t < this._cameras.length; t++) {
            var i = this._cameras[t];
            this.imageProcessing && this.imageProcessing.dispose(i),
              this.fxaa && this.fxaa.dispose(i),
              e &&
                (this.sharpen && this.sharpen.dispose(i),
                this.depthOfField &&
                  (this._scene.onAfterRenderTargetsRenderObservable.remove(
                    this._depthOfFieldSceneObserver
                  ),
                  this.depthOfField.disposeEffects(i)),
                this.bloom && this.bloom.disposeEffects(i),
                this.chromaticAberration && this.chromaticAberration.dispose(i),
                this.grain && this.grain.dispose(i),
                this._glowLayer && this._glowLayer.dispose());
          }
          (this.imageProcessing = null),
            (this.fxaa = null),
            e &&
              ((this.sharpen = null),
              (this._sharpenEffect = null),
              (this.depthOfField = null),
              (this.bloom = null),
              (this.chromaticAberration = null),
              (this._chromaticAberrationEffect = null),
              (this.grain = null),
              (this._grainEffect = null),
              (this._glowLayer = null));
        }),
        (t.prototype.addCamera = function (e) {
          this._camerasToBeAttached.push(e), this._buildPipeline();
        }),
        (t.prototype.removeCamera = function (e) {
          var t = this._camerasToBeAttached.indexOf(e);
          this._camerasToBeAttached.splice(t, 1), this._buildPipeline();
        }),
        (t.prototype.dispose = function () {
          this.onBuildObservable.clear(),
            this._disposePostProcesses(!0),
            this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(
              this._name,
              this._cameras
            ),
            (this._scene.autoClear = !0),
            this._resizeObserver &&
              (this._scene
                .getEngine()
                .onResizeObservable.remove(this._resizeObserver),
              (this._resizeObserver = null)),
            this._scene.imageProcessingConfiguration.onUpdateParameters.remove(
              this._imageProcessingConfigurationObserver
            ),
            e.prototype.dispose.call(this);
        }),
        (t.prototype.serialize = function () {
          var e = ge.Serialize(this);
          return (e.customType = "DefaultRenderingPipeline"), e;
        }),
        (t.Parse = function (e, i, n) {
          return ge.Parse(
            function () {
              return new t(e._name, e._name._hdr, i);
            },
            e,
            i,
            n
          );
        }),
        R([se()], t.prototype, "sharpenEnabled", null),
        R([se()], t.prototype, "bloomKernel", null),
        R([se()], t.prototype, "_bloomWeight", void 0),
        R([se()], t.prototype, "_bloomThreshold", void 0),
        R([se()], t.prototype, "_hdr", void 0),
        R([se()], t.prototype, "bloomWeight", null),
        R([se()], t.prototype, "bloomThreshold", null),
        R([se()], t.prototype, "bloomScale", null),
        R([se()], t.prototype, "bloomEnabled", null),
        R([se()], t.prototype, "depthOfFieldEnabled", null),
        R([se()], t.prototype, "depthOfFieldBlurLevel", null),
        R([se()], t.prototype, "fxaaEnabled", null),
        R([se()], t.prototype, "samples", null),
        R([se()], t.prototype, "imageProcessingEnabled", null),
        R([se()], t.prototype, "glowLayerEnabled", null),
        R([se()], t.prototype, "chromaticAberrationEnabled", null),
        R([se()], t.prototype, "grainEnabled", null),
        t
      );
    })(Td);
  h.RegisteredTypes["BABYLON.DefaultRenderingPipeline"] = xd;
  Ke.ShadersStore.lensHighlightsPixelShader =
    "\nuniform sampler2D textureSampler;\n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}";
  (Ke.ShadersStore.depthOfFieldPixelShader =
    "\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance;\nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1\n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight;\n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV);\nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height);\nfloat depth=texture2D(depthSampler,distorted_coords).r;\nfloat distance=near+(far-near)*depth;\nvec4 color=texture2D(textureSampler,vUV);\n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n"),
    (function (e) {
      function t(t, i, n, r, o) {
        void 0 === r && (r = 1);
        var s = e.call(this, n.getEngine(), t) || this;
        return (
          (s.LensChromaticAberrationEffect = "LensChromaticAberrationEffect"),
          (s.HighlightsEnhancingEffect = "HighlightsEnhancingEffect"),
          (s.LensDepthOfFieldEffect = "LensDepthOfFieldEffect"),
          (s._pentagonBokehIsEnabled = !1),
          (s._scene = n),
          (s._depthTexture = n.enableDepthRenderer().getDepthMap()),
          i.grain_texture
            ? (s._grainTexture = i.grain_texture)
            : s._createGrainTexture(),
          (s._edgeBlur = i.edge_blur ? i.edge_blur : 0),
          (s._grainAmount = i.grain_amount ? i.grain_amount : 0),
          (s._chromaticAberration = i.chromatic_aberration
            ? i.chromatic_aberration
            : 0),
          (s._distortion = i.distortion ? i.distortion : 0),
          (s._highlightsGain = void 0 !== i.dof_gain ? i.dof_gain : -1),
          (s._highlightsThreshold = i.dof_threshold ? i.dof_threshold : 1),
          (s._dofDistance =
            void 0 !== i.dof_focus_distance ? i.dof_focus_distance : -1),
          (s._dofAperture = i.dof_aperture ? i.dof_aperture : 1),
          (s._dofDarken = i.dof_darken ? i.dof_darken : 0),
          (s._dofPentagon = void 0 === i.dof_pentagon || i.dof_pentagon),
          (s._blurNoise = void 0 === i.blur_noise || i.blur_noise),
          s._createChromaticAberrationPostProcess(r),
          s._createHighlightsPostProcess(r),
          s._createDepthOfFieldPostProcess(r / 4),
          s.addEffect(
            new $h(
              n.getEngine(),
              s.LensChromaticAberrationEffect,
              function () {
                return s._chromaticAberrationPostProcess;
              },
              !0
            )
          ),
          s.addEffect(
            new $h(
              n.getEngine(),
              s.HighlightsEnhancingEffect,
              function () {
                return s._highlightsPostProcess;
              },
              !0
            )
          ),
          s.addEffect(
            new $h(
              n.getEngine(),
              s.LensDepthOfFieldEffect,
              function () {
                return s._depthOfFieldPostProcess;
              },
              !0
            )
          ),
          -1 === s._highlightsGain &&
            s._disableEffect(s.HighlightsEnhancingEffect, null),
          n.postProcessRenderPipelineManager.addPipeline(s),
          o &&
            n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(
              t,
              o
            ),
          s
        );
      }
      P(t, e),
        (t.prototype.getClassName = function () {
          return "LensRenderingPipeline";
        }),
        Object.defineProperty(t.prototype, "scene", {
          get: function () {
            return this._scene;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "edgeBlur", {
          get: function () {
            return this._edgeBlur;
          },
          set: function (e) {
            this.setEdgeBlur(e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "grainAmount", {
          get: function () {
            return this._grainAmount;
          },
          set: function (e) {
            this.setGrainAmount(e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "chromaticAberration", {
          get: function () {
            return this._chromaticAberration;
          },
          set: function (e) {
            this.setChromaticAberration(e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "dofAperture", {
          get: function () {
            return this._dofAperture;
          },
          set: function (e) {
            this.setAperture(e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "edgeDistortion", {
          get: function () {
            return this._distortion;
          },
          set: function (e) {
            this.setEdgeDistortion(e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "dofDistortion", {
          get: function () {
            return this._dofDistance;
          },
          set: function (e) {
            this.setFocusDistance(e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "darkenOutOfFocus", {
          get: function () {
            return this._dofDarken;
          },
          set: function (e) {
            this.setDarkenOutOfFocus(e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "blurNoise", {
          get: function () {
            return this._blurNoise;
          },
          set: function (e) {
            this._blurNoise = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "pentagonBokeh", {
          get: function () {
            return this._pentagonBokehIsEnabled;
          },
          set: function (e) {
            e ? this.enablePentagonBokeh() : this.disablePentagonBokeh();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "highlightsGain", {
          get: function () {
            return this._highlightsGain;
          },
          set: function (e) {
            this.setHighlightsGain(e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "highlightsThreshold", {
          get: function () {
            return this._highlightsThreshold;
          },
          set: function (e) {
            this.setHighlightsThreshold(e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.setEdgeBlur = function (e) {
          this._edgeBlur = e;
        }),
        (t.prototype.disableEdgeBlur = function () {
          this._edgeBlur = 0;
        }),
        (t.prototype.setGrainAmount = function (e) {
          this._grainAmount = e;
        }),
        (t.prototype.disableGrain = function () {
          this._grainAmount = 0;
        }),
        (t.prototype.setChromaticAberration = function (e) {
          this._chromaticAberration = e;
        }),
        (t.prototype.disableChromaticAberration = function () {
          this._chromaticAberration = 0;
        }),
        (t.prototype.setEdgeDistortion = function (e) {
          this._distortion = e;
        }),
        (t.prototype.disableEdgeDistortion = function () {
          this._distortion = 0;
        }),
        (t.prototype.setFocusDistance = function (e) {
          this._dofDistance = e;
        }),
        (t.prototype.disableDepthOfField = function () {
          this._dofDistance = -1;
        }),
        (t.prototype.setAperture = function (e) {
          this._dofAperture = e;
        }),
        (t.prototype.setDarkenOutOfFocus = function (e) {
          this._dofDarken = e;
        }),
        (t.prototype.enablePentagonBokeh = function () {
          this._highlightsPostProcess.updateEffect("#define PENTAGON\n"),
            (this._pentagonBokehIsEnabled = !0);
        }),
        (t.prototype.disablePentagonBokeh = function () {
          (this._pentagonBokehIsEnabled = !1),
            this._highlightsPostProcess.updateEffect();
        }),
        (t.prototype.enableNoiseBlur = function () {
          this._blurNoise = !0;
        }),
        (t.prototype.disableNoiseBlur = function () {
          this._blurNoise = !1;
        }),
        (t.prototype.setHighlightsGain = function (e) {
          this._highlightsGain = e;
        }),
        (t.prototype.setHighlightsThreshold = function (e) {
          -1 === this._highlightsGain && (this._highlightsGain = 1),
            (this._highlightsThreshold = e);
        }),
        (t.prototype.disableHighlights = function () {
          this._highlightsGain = -1;
        }),
        (t.prototype.dispose = function (e) {
          void 0 === e && (e = !1),
            this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(
              this._name,
              this._scene.cameras
            ),
            (this._chromaticAberrationPostProcess = null),
            (this._highlightsPostProcess = null),
            (this._depthOfFieldPostProcess = null),
            this._grainTexture.dispose(),
            e && this._scene.disableDepthRenderer();
        }),
        (t.prototype._createChromaticAberrationPostProcess = function (e) {
          var t = this;
          (this._chromaticAberrationPostProcess = new vr(
            "LensChromaticAberration",
            "chromaticAberration",
            [
              "chromatic_aberration",
              "screen_width",
              "screen_height",
              "direction",
              "radialIntensity",
              "centerPosition",
            ],
            [],
            e,
            null,
            mn.TRILINEAR_SAMPLINGMODE,
            this._scene.getEngine(),
            !1
          )),
            (this._chromaticAberrationPostProcess.onApply = function (e) {
              e.setFloat("chromatic_aberration", t._chromaticAberration),
                e.setFloat(
                  "screen_width",
                  t._scene.getEngine().getRenderWidth()
                ),
                e.setFloat(
                  "screen_height",
                  t._scene.getEngine().getRenderHeight()
                ),
                e.setFloat("radialIntensity", 1),
                e.setFloat2("direction", 17, 17),
                e.setFloat2("centerPosition", 0.5, 0.5);
            });
        }),
        (t.prototype._createHighlightsPostProcess = function (e) {
          var t = this;
          (this._highlightsPostProcess = new vr(
            "LensHighlights",
            "lensHighlights",
            ["gain", "threshold", "screen_width", "screen_height"],
            [],
            e,
            null,
            mn.TRILINEAR_SAMPLINGMODE,
            this._scene.getEngine(),
            !1,
            this._dofPentagon ? "#define PENTAGON\n" : ""
          )),
            (this._highlightsPostProcess.onApply = function (e) {
              e.setFloat("gain", t._highlightsGain),
                e.setFloat("threshold", t._highlightsThreshold),
                e.setTextureFromPostProcess(
                  "textureSampler",
                  t._chromaticAberrationPostProcess
                ),
                e.setFloat(
                  "screen_width",
                  t._scene.getEngine().getRenderWidth()
                ),
                e.setFloat(
                  "screen_height",
                  t._scene.getEngine().getRenderHeight()
                );
            });
        }),
        (t.prototype._createDepthOfFieldPostProcess = function (e) {
          var t = this;
          (this._depthOfFieldPostProcess = new vr(
            "LensDepthOfField",
            "depthOfField",
            [
              "grain_amount",
              "blur_noise",
              "screen_width",
              "screen_height",
              "distortion",
              "dof_enabled",
              "screen_distance",
              "aperture",
              "darken",
              "edge_blur",
              "highlights",
              "near",
              "far",
            ],
            ["depthSampler", "grainSampler", "highlightsSampler"],
            e,
            null,
            mn.TRILINEAR_SAMPLINGMODE,
            this._scene.getEngine(),
            !1
          )),
            (this._depthOfFieldPostProcess.onApply = function (e) {
              e.setTexture("depthSampler", t._depthTexture),
                e.setTexture("grainSampler", t._grainTexture),
                e.setTextureFromPostProcess(
                  "textureSampler",
                  t._highlightsPostProcess
                ),
                e.setTextureFromPostProcess(
                  "highlightsSampler",
                  t._depthOfFieldPostProcess
                ),
                e.setFloat("grain_amount", t._grainAmount),
                e.setBool("blur_noise", t._blurNoise),
                e.setFloat(
                  "screen_width",
                  t._scene.getEngine().getRenderWidth()
                ),
                e.setFloat(
                  "screen_height",
                  t._scene.getEngine().getRenderHeight()
                ),
                e.setFloat("distortion", t._distortion),
                e.setBool("dof_enabled", -1 !== t._dofDistance),
                e.setFloat("screen_distance", 1 / (0.1 - 1 / t._dofDistance)),
                e.setFloat("aperture", t._dofAperture),
                e.setFloat("darken", t._dofDarken),
                e.setFloat("edge_blur", t._edgeBlur),
                e.setBool("highlights", -1 !== t._highlightsGain),
                t._scene.activeCamera &&
                  (e.setFloat("near", t._scene.activeCamera.minZ),
                  e.setFloat("far", t._scene.activeCamera.maxZ));
            });
        }),
        (t.prototype._createGrainTexture = function () {
          (this._grainTexture = new Zr(
            "LensNoiseTexture",
            512,
            this._scene,
            !1,
            mn.BILINEAR_SAMPLINGMODE
          )),
            (this._grainTexture.wrapU = mn.WRAP_ADDRESSMODE),
            (this._grainTexture.wrapV = mn.WRAP_ADDRESSMODE);
          for (var e, t = this._grainTexture.getContext(), i = 0; i < 512; i++)
            for (var n = 0; n < 512; n++)
              (e = Math.floor(
                255 * (0.42, 0.58, Math.random() * (0.58 - 0.42) + 0.42)
              )),
                (t.fillStyle = "rgb(" + e + ", " + e + ", " + e + ")"),
                t.fillRect(i, n, 1, 1);
          this._grainTexture.update(!1);
        });
    })(Td);
  var Ed = function () {
    (this.enabled = !1), (this.name = "ssao2"), (this.texturesRequired = [5]);
  };
  Ke.ShadersStore.ssao2PixelShader =
    "\nprecision highp float;\nuniform sampler2D textureSampler;\nuniform float near;\nuniform float far;\nuniform float radius;\nfloat scales[16]=float[16](\n0.1,\n0.11406250000000001,\n0.131640625,\n0.15625,\n0.187890625,\n0.2265625,\n0.272265625,\n0.325,\n0.384765625,\n0.4515625,\n0.525390625,\n0.60625,\n0.694140625,\n0.7890625,\n0.891015625,\n1.0\n);\nvarying vec2 vUV;\nfloat perspectiveDepthToViewZ( const in float invClipZ,const in float near,const in float far ) {\nreturn ( near*far )/( ( far-near )*invClipZ-far );\n}\nfloat viewZToPerspectiveDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( near*far/viewZ+far)/( far-near );\n}\nfloat viewZToOrthographicDepth( const in float viewZ,const in float near,const in float far ) {\nreturn ( viewZ+near )/( near-far );\n}\n#ifdef SSAO\nuniform sampler2D randomSampler;\n#ifndef GEOMETRYBUFFER\nuniform sampler2D depthNormalSampler;\n#else\nuniform sampler2D depthSampler;\nuniform sampler2D normalSampler;\n#endif\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float base;\nuniform float xViewport;\nuniform float yViewport;\nuniform float maxZ;\nuniform float minZAspect;\nuniform vec2 texelSize;\nuniform mat4 projection;\nvoid main()\n{\nvec3 random=texture2D(randomSampler,vUV*randTextureTiles).rgb;\n#ifndef GEOMETRYBUFFER\nfloat depth=texture2D(depthNormalSampler,vUV).r;\n#else\nfloat depth=texture2D(depthSampler,vUV).r;\n#endif\nfloat depthSign=depth/abs(depth);\ndepth=depth*depthSign;\n#ifndef GEOMETRYBUFFER\nvec3 normal=texture2D(depthNormalSampler,vUV).gba;\n#else\nvec3 normal=texture2D(normalSampler,vUV).rgb;\n#endif\nfloat occlusion=0.0;\nfloat correctedRadius=min(radius,minZAspect*depth/near);\nvec3 vViewRay=vec3((vUV.x*2.0-1.0)*xViewport,(vUV.y*2.0-1.0)*yViewport,depthSign);\nvec3 origin=vViewRay*depth;\nvec3 rvec=random*2.0-1.0;\nrvec.z=0.0;\n\nfloat dotProduct=dot(rvec,normal);\nrvec=1.0-abs(dotProduct)>1e-2 ? rvec : vec3(-rvec.y,0.0,rvec.x);\nvec3 tangent=normalize(rvec-normal*dot(rvec,normal));\nvec3 bitangent=cross(normal,tangent);\nmat3 tbn=mat3(tangent,bitangent,normal);\nfloat difference;\nfor (int i=0; i<SAMPLES; ++i) {\n\nvec3 samplePosition=scales[(i+int(random.x*16.0)) % 16]*tbn*sampleSphere[(i+int(random.y*16.0)) % 16];\nsamplePosition=samplePosition*correctedRadius+origin;\n\nvec4 offset=vec4(samplePosition,1.0);\noffset=projection*offset;\noffset.xyz/=offset.w;\noffset.xy=offset.xy*0.5+0.5;\nif (offset.x<0.0 || offset.y<0.0 || offset.x>1.0 || offset.y>1.0) {\ncontinue;\n}\n\n#ifndef GEOMETRYBUFFER\nfloat sampleDepth=abs(texture2D(depthNormalSampler,offset.xy).r);\n#else\nfloat sampleDepth=abs(texture2D(depthSampler,offset.xy).r);\n#endif\n\ndifference=depthSign*samplePosition.z-sampleDepth;\nfloat rangeCheck=1.0-smoothstep(correctedRadius*0.5,correctedRadius,difference);\nocclusion+=(difference>=0.0 ? 1.0 : 0.0)*rangeCheck;\n}\nocclusion=occlusion*(1.0-smoothstep(maxZ*0.75,maxZ,depth));\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor=vec4(vec3(result),1.0);\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthNormalSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvec4 blur9(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.3846153846)*direction;\nvec2 off2=vec2(3.2307692308)*direction;\ncolor+=texture2D(image,uv)*0.2270270270;\ncolor+=texture2D(image,uv+(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv-(off1/resolution))*0.3162162162;\ncolor+=texture2D(image,uv+(off2/resolution))*0.0702702703;\ncolor+=texture2D(image,uv-(off2/resolution))*0.0702702703;\nreturn color;\n}\nvec4 blur13(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\ncolor+=texture2D(image,uv)*0.1964825501511404;\ncolor+=texture2D(image,uv+(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv-(off1/resolution))*0.2969069646728344;\ncolor+=texture2D(image,uv+(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv-(off2/resolution))*0.09447039785044732;\ncolor+=texture2D(image,uv+(off3/resolution))*0.010381362401148057;\ncolor+=texture2D(image,uv-(off3/resolution))*0.010381362401148057;\nreturn color;\n}\nvec4 blur13Bilateral(sampler2D image,vec2 uv,float resolution,vec2 direction) {\nvec4 color=vec4(0.0);\nvec2 off1=vec2(1.411764705882353)*direction;\nvec2 off2=vec2(3.2941176470588234)*direction;\nvec2 off3=vec2(5.176470588235294)*direction;\nfloat compareDepth=abs(texture2D(depthNormalSampler,uv).r);\nfloat sampleDepth;\nfloat weight;\nfloat weightSum=30.0;\ncolor+=texture2D(image,uv)*30.0;\nsampleDepth=abs(texture2D(depthNormalSampler,uv+(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthNormalSampler,uv-(off1/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off1/resolution))*weight;\nsampleDepth=abs(texture2D(depthNormalSampler,uv+(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthNormalSampler,uv-(off2/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off2/resolution))*weight;\nsampleDepth=abs(texture2D(depthNormalSampler,uv+(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv+(off3/resolution))*weight;\nsampleDepth=abs(texture2D(depthNormalSampler,uv-(off3/resolution)).r);\nweight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30.0);\nweightSum+=weight;\ncolor+=texture2D(image,uv-(off3/resolution))*weight;\nreturn color/weightSum;\n}\nvoid main()\n{\n#if EXPENSIVE\nfloat compareDepth=abs(texture2D(depthNormalSampler,vUV).r);\nfloat texelsize=1.0/outSize;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 direction=vec2(0.0,1.0);\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=abs(texture2D(depthNormalSampler,samplePos).r);\nfloat weight=clamp(1.0/( 0.003+abs(compareDepth-sampleDepth)),0.0,30000.0);\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n#else\nvec4 color;\n#ifdef BILATERAL_BLUR_H\nvec2 direction=vec2(1.0,0.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#else\nvec2 direction=vec2(0.0,1.0);\ncolor=blur13Bilateral(textureSampler,vUV,outSize,direction);\n#endif\ngl_FragColor.rgb=vec3(color.r);\ngl_FragColor.a=1.0;\n#endif\n}\n#endif\n";
  Ke.ShadersStore.ssaoCombinePixelShader =
    "uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nuniform vec4 viewport;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,viewport.xy+vUV*viewport.zw);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n";
  var Pd = (function (e) {
    function t(t, i, n, r, o) {
      void 0 === o && (o = !0);
      var s = e.call(this, i.getEngine(), t) || this;
      if (
        ((s.SSAOOriginalSceneColorEffect = "SSAOOriginalSceneColorEffect"),
        (s.SSAORenderEffect = "SSAORenderEffect"),
        (s.SSAOBlurHRenderEffect = "SSAOBlurHRenderEffect"),
        (s.SSAOBlurVRenderEffect = "SSAOBlurVRenderEffect"),
        (s.SSAOCombineRenderEffect = "SSAOCombineRenderEffect"),
        (s.totalStrength = 1),
        (s.maxZ = 100),
        (s.minZAspect = 0.2),
        (s._samples = 8),
        (s._textureSamples = 1),
        (s._forceGeometryBuffer = !1),
        (s._expensiveBlur = !0),
        (s.radius = 2),
        (s.base = 0),
        (s._bits = new Uint32Array(1)),
        (s._scene = i),
        (s._ratio = n),
        (s._forceGeometryBuffer = o),
        !s.isSupported)
      )
        return F.Error("SSAO 2 needs WebGL 2 support."), s;
      var a = s._ratio.ssaoRatio || n,
        l = s._ratio.blurRatio || n;
      return (
        s._forceGeometryBuffer
          ? i.enableGeometryBufferRenderer()
          : (s._prePassRenderer = i.enablePrePassRenderer()),
        s._createRandomTexture(),
        (s._originalColorPostProcess = new yr(
          "SSAOOriginalSceneColor",
          1,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          i.getEngine(),
          !1
        )),
        (s._originalColorPostProcess.samples = s.textureSamples),
        s._createSSAOPostProcess(1),
        s._createBlurPostProcess(a, l),
        s._createSSAOCombinePostProcess(l),
        s.addEffect(
          new $h(
            i.getEngine(),
            s.SSAOOriginalSceneColorEffect,
            function () {
              return s._originalColorPostProcess;
            },
            !0
          )
        ),
        s.addEffect(
          new $h(
            i.getEngine(),
            s.SSAORenderEffect,
            function () {
              return s._ssaoPostProcess;
            },
            !0
          )
        ),
        s.addEffect(
          new $h(
            i.getEngine(),
            s.SSAOBlurHRenderEffect,
            function () {
              return s._blurHPostProcess;
            },
            !0
          )
        ),
        s.addEffect(
          new $h(
            i.getEngine(),
            s.SSAOBlurVRenderEffect,
            function () {
              return s._blurVPostProcess;
            },
            !0
          )
        ),
        s.addEffect(
          new $h(
            i.getEngine(),
            s.SSAOCombineRenderEffect,
            function () {
              return s._ssaoCombinePostProcess;
            },
            !0
          )
        ),
        i.postProcessRenderPipelineManager.addPipeline(s),
        r &&
          i.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(
            t,
            r
          ),
        s
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "samples", {
        get: function () {
          return this._samples;
        },
        set: function (e) {
          (this._samples = e),
            this._ssaoPostProcess.updateEffect(this._getDefinesForSSAO()),
            (this._sampleSphere = this._generateHemisphere());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "textureSamples", {
        get: function () {
          return this._textureSamples;
        },
        set: function (e) {
          (this._textureSamples = e),
            (this._originalColorPostProcess.samples = e),
            (this._blurHPostProcess.samples = e),
            (this._blurVPostProcess.samples = e),
            (this._ssaoPostProcess.samples = e),
            (this._ssaoCombinePostProcess.samples = e);
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "expensiveBlur", {
        get: function () {
          return this._expensiveBlur;
        },
        set: function (e) {
          this._blurHPostProcess.updateEffect(
            "#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE " +
              (e ? "1" : "0") +
              "\n",
            null,
            ["textureSampler", "depthNormalSampler"]
          ),
            this._blurVPostProcess.updateEffect(
              "#define BILATERAL_BLUR\n#define SAMPLES 16\n#define EXPENSIVE " +
                (e ? "1" : "0") +
                "\n",
              null,
              ["textureSampler", "depthNormalSampler"]
            ),
            (this._expensiveBlur = e);
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t, "IsSupported", {
        get: function () {
          var e = j.LastCreatedEngine;
          return !!e && e.webGLVersion >= 2;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "scene", {
        get: function () {
          return this._scene;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.getClassName = function () {
        return "SSAO2RenderingPipeline";
      }),
      (t.prototype.dispose = function (t) {
        void 0 === t && (t = !1);
        for (var i = 0; i < this._scene.cameras.length; i++) {
          var n = this._scene.cameras[i];
          this._originalColorPostProcess.dispose(n),
            this._ssaoPostProcess.dispose(n),
            this._blurHPostProcess.dispose(n),
            this._blurVPostProcess.dispose(n),
            this._ssaoCombinePostProcess.dispose(n);
        }
        this._randomTexture.dispose(),
          t && this._scene.disableGeometryBufferRenderer(),
          this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(
            this._name,
            this._scene.cameras
          ),
          e.prototype.dispose.call(this);
      }),
      (t.prototype._createBlurPostProcess = function (e, t) {
        var i = this;
        this._samplerOffsets = [];
        for (var n = this.expensiveBlur, r = -8; r < 8; r++)
          this._samplerOffsets.push(2 * r + 0.5);
        (this._blurHPostProcess = new vr(
          "BlurH",
          "ssao2",
          ["outSize", "samplerOffsets", "near", "far", "radius"],
          ["depthNormalSampler"],
          e,
          null,
          mn.TRILINEAR_SAMPLINGMODE,
          this._scene.getEngine(),
          !1,
          "#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16\n#define EXPENSIVE " +
            (n ? "1" : "0") +
            "\n"
        )),
          (this._blurHPostProcess.onApply = function (e) {
            i._scene.activeCamera &&
              (e.setFloat(
                "outSize",
                i._ssaoCombinePostProcess.width > 0
                  ? i._ssaoCombinePostProcess.width
                  : i._originalColorPostProcess.width
              ),
              e.setFloat("near", i._scene.activeCamera.minZ),
              e.setFloat("far", i._scene.activeCamera.maxZ),
              e.setFloat("radius", i.radius),
              i._forceGeometryBuffer
                ? e.setTexture(
                    "depthNormalSampler",
                    i._scene.enableGeometryBufferRenderer().getGBuffer()
                      .textures[0]
                  )
                : e.setTexture(
                    "depthNormalSampler",
                    i._prePassRenderer.prePassRT.textures[
                      i._prePassRenderer.getIndex(5)
                    ]
                  ),
              e.setArray("samplerOffsets", i._samplerOffsets));
          }),
          (this._blurVPostProcess = new vr(
            "BlurV",
            "ssao2",
            ["outSize", "samplerOffsets", "near", "far", "radius"],
            ["depthNormalSampler"],
            t,
            null,
            mn.TRILINEAR_SAMPLINGMODE,
            this._scene.getEngine(),
            !1,
            "#define BILATERAL_BLUR\n#define BILATERAL_BLUR_V\n#define SAMPLES 16\n#define EXPENSIVE " +
              (n ? "1" : "0") +
              "\n"
          )),
          (this._blurVPostProcess.onApply = function (e) {
            i._scene.activeCamera &&
              (e.setFloat(
                "outSize",
                i._ssaoCombinePostProcess.height > 0
                  ? i._ssaoCombinePostProcess.height
                  : i._originalColorPostProcess.height
              ),
              e.setFloat("near", i._scene.activeCamera.minZ),
              e.setFloat("far", i._scene.activeCamera.maxZ),
              e.setFloat("radius", i.radius),
              i._forceGeometryBuffer
                ? e.setTexture(
                    "depthNormalSampler",
                    i._scene.enableGeometryBufferRenderer().getGBuffer()
                      .textures[0]
                  )
                : e.setTexture(
                    "depthNormalSampler",
                    i._prePassRenderer.prePassRT.textures[
                      i._prePassRenderer.getIndex(5)
                    ]
                  ),
              e.setArray("samplerOffsets", i._samplerOffsets));
          }),
          (this._blurHPostProcess.samples = this.textureSamples),
          (this._blurVPostProcess.samples = this.textureSamples);
      }),
      (t.prototype._rebuild = function () {
        e.prototype._rebuild.call(this);
      }),
      (t.prototype._radicalInverse_VdC = function (e) {
        return (
          (this._bits[0] = e),
          (this._bits[0] =
            ((this._bits[0] << 16) | (this._bits[0] >> 16)) >>> 0),
          (this._bits[0] =
            ((1431655765 & this._bits[0]) << 1) |
            (((2863311530 & this._bits[0]) >>> 1) >>> 0)),
          (this._bits[0] =
            ((858993459 & this._bits[0]) << 2) |
            (((3435973836 & this._bits[0]) >>> 2) >>> 0)),
          (this._bits[0] =
            ((252645135 & this._bits[0]) << 4) |
            (((4042322160 & this._bits[0]) >>> 4) >>> 0)),
          (this._bits[0] =
            ((16711935 & this._bits[0]) << 8) |
            (((4278255360 & this._bits[0]) >>> 8) >>> 0)),
          2.3283064365386963e-10 * this._bits[0]
        );
      }),
      (t.prototype._hammersley = function (e, t) {
        return [e / t, this._radicalInverse_VdC(e)];
      }),
      (t.prototype._hemisphereSample_uniform = function (e, t) {
        var i = 2 * t * Math.PI,
          n = 1 - (0.85 * e + 0.15),
          r = Math.sqrt(1 - n * n);
        return new f(Math.cos(i) * r, Math.sin(i) * r, n);
      }),
      (t.prototype._generateHemisphere = function () {
        for (var e, t = this.samples, i = [], n = 0; n < t; ) {
          if (t < 16)
            e = this._hemisphereSample_uniform(Math.random(), Math.random());
          else {
            var r = this._hammersley(n, t);
            e = this._hemisphereSample_uniform(r[0], r[1]);
          }
          i.push(e.x, e.y, e.z), n++;
        }
        return i;
      }),
      (t.prototype._getDefinesForSSAO = function () {
        var e = "#define SAMPLES " + this.samples + "\n#define SSAO";
        return (
          this._forceGeometryBuffer && (e += "\n#define GEOMETRYBUFFER"), e
        );
      }),
      (t.prototype._createSSAOPostProcess = function (e) {
        var t = this;
        this._sampleSphere = this._generateHemisphere();
        var i,
          n = this._getDefinesForSSAO();
        (i = this._forceGeometryBuffer
          ? ["randomSampler", "depthSampler", "normalSampler"]
          : ["randomSampler", "depthNormalSampler"]),
          (this._ssaoPostProcess = new vr(
            "ssao2",
            "ssao2",
            [
              "sampleSphere",
              "samplesFactor",
              "randTextureTiles",
              "totalStrength",
              "radius",
              "base",
              "range",
              "projection",
              "near",
              "far",
              "texelSize",
              "xViewport",
              "yViewport",
              "maxZ",
              "minZAspect",
            ],
            i,
            e,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            this._scene.getEngine(),
            !1,
            n
          )),
          (this._ssaoPostProcess.onApply = function (e) {
            t._scene.activeCamera &&
              (e.setArray3("sampleSphere", t._sampleSphere),
              e.setFloat("randTextureTiles", 32),
              e.setFloat("samplesFactor", 1 / t.samples),
              e.setFloat("totalStrength", t.totalStrength),
              e.setFloat2(
                "texelSize",
                1 / t._ssaoPostProcess.width,
                1 / t._ssaoPostProcess.height
              ),
              e.setFloat("radius", t.radius),
              e.setFloat("maxZ", t.maxZ),
              e.setFloat("minZAspect", t.minZAspect),
              e.setFloat("base", t.base),
              e.setFloat("near", t._scene.activeCamera.minZ),
              e.setFloat("far", t._scene.activeCamera.maxZ),
              e.setFloat(
                "xViewport",
                Math.tan(t._scene.activeCamera.fov / 2) *
                  t._scene.getEngine().getAspectRatio(t._scene.activeCamera, !0)
              ),
              e.setFloat("yViewport", Math.tan(t._scene.activeCamera.fov / 2)),
              e.setMatrix("projection", t._scene.getProjectionMatrix()),
              t._forceGeometryBuffer
                ? (e.setTexture(
                    "depthSampler",
                    t._scene.enableGeometryBufferRenderer().getGBuffer()
                      .textures[0]
                  ),
                  e.setTexture(
                    "normalSampler",
                    t._scene.enableGeometryBufferRenderer().getGBuffer()
                      .textures[1]
                  ))
                : e.setTexture(
                    "depthNormalSampler",
                    t._prePassRenderer.prePassRT.textures[
                      t._prePassRenderer.getIndex(5)
                    ]
                  ),
              e.setTexture("randomSampler", t._randomTexture));
          }),
          (this._ssaoPostProcess.samples = this.textureSamples);
      }),
      (t.prototype._createSSAOCombinePostProcess = function (e) {
        var t = this;
        (this._ssaoCombinePostProcess = new vr(
          "ssaoCombine",
          "ssaoCombine",
          [],
          ["originalColor", "viewport"],
          e,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          this._scene.getEngine(),
          !1
        )),
          (this._ssaoCombinePostProcess.onApply = function (e) {
            var i = t._scene.activeCamera.viewport;
            e.setVector4(
              "viewport",
              y.Vector4[0].copyFromFloats(i.x, i.y, i.width, i.height)
            ),
              e.setTextureFromPostProcessOutput(
                "originalColor",
                t._originalColorPostProcess
              );
          }),
          (this._ssaoCombinePostProcess.samples = this.textureSamples),
          this._forceGeometryBuffer ||
            (this._ssaoCombinePostProcess._prePassEffectConfiguration =
              new Ed());
      }),
      (t.prototype._createRandomTexture = function () {
        (this._randomTexture = new Zr(
          "SSAORandomTexture",
          128,
          this._scene,
          !1,
          mn.TRILINEAR_SAMPLINGMODE
        )),
          (this._randomTexture.wrapU = mn.WRAP_ADDRESSMODE),
          (this._randomTexture.wrapV = mn.WRAP_ADDRESSMODE);
        for (
          var e = this._randomTexture.getContext(),
            t = function (e, t) {
              return Math.random() * (t - e) + e;
            },
            i = f.Zero(),
            n = 0;
          n < 128;
          n++
        )
          for (var r = 0; r < 128; r++)
            (i.x = t(0, 1)),
              (i.y = t(0, 1)),
              (i.z = 0),
              i.normalize(),
              i.scaleInPlace(255),
              (i.x = Math.floor(i.x)),
              (i.y = Math.floor(i.y)),
              (e.fillStyle = "rgb(" + i.x + ", " + i.y + ", " + i.z + ")"),
              e.fillRect(n, r, 1, 1);
        this._randomTexture.update(!1);
      }),
      (t.prototype.serialize = function () {
        var e = ge.Serialize(this);
        return (e.customType = "SSAO2RenderingPipeline"), e;
      }),
      (t.Parse = function (e, i, n) {
        return ge.Parse(
          function () {
            return new t(e._name, i, e._ratio);
          },
          e,
          i,
          n
        );
      }),
      R([se()], t.prototype, "totalStrength", void 0),
      R([se()], t.prototype, "maxZ", void 0),
      R([se()], t.prototype, "minZAspect", void 0),
      R([se("samples")], t.prototype, "_samples", void 0),
      R([se("textureSamples")], t.prototype, "_textureSamples", void 0),
      R([se()], t.prototype, "_ratio", void 0),
      R([se("expensiveBlur")], t.prototype, "_expensiveBlur", void 0),
      R([se()], t.prototype, "radius", void 0),
      R([se()], t.prototype, "base", void 0),
      t
    );
  })(Td);
  h.RegisteredTypes["BABYLON.SSAO2RenderingPipeline"] = Pd;
  (Ke.ShadersStore.ssaoPixelShader =
    "\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n"),
    (function (e) {
      function t(t, i, n, r) {
        var o = e.call(this, i.getEngine(), t) || this;
        (o.SSAOOriginalSceneColorEffect = "SSAOOriginalSceneColorEffect"),
          (o.SSAORenderEffect = "SSAORenderEffect"),
          (o.SSAOBlurHRenderEffect = "SSAOBlurHRenderEffect"),
          (o.SSAOBlurVRenderEffect = "SSAOBlurVRenderEffect"),
          (o.SSAOCombineRenderEffect = "SSAOCombineRenderEffect"),
          (o.totalStrength = 1),
          (o.radius = 1e-4),
          (o.area = 0.0075),
          (o.fallOff = 1e-6),
          (o.base = 0.5),
          (o._firstUpdate = !0),
          (o._scene = i),
          o._createRandomTexture(),
          (o._depthTexture = i.enableDepthRenderer().getDepthMap());
        var s = n.ssaoRatio || n,
          a = n.combineRatio || n;
        return (
          (o._originalColorPostProcess = new yr(
            "SSAOOriginalSceneColor",
            a,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            i.getEngine(),
            !1
          )),
          o._createSSAOPostProcess(s),
          o._createBlurPostProcess(s),
          o._createSSAOCombinePostProcess(a),
          o.addEffect(
            new $h(
              i.getEngine(),
              o.SSAOOriginalSceneColorEffect,
              function () {
                return o._originalColorPostProcess;
              },
              !0
            )
          ),
          o.addEffect(
            new $h(
              i.getEngine(),
              o.SSAORenderEffect,
              function () {
                return o._ssaoPostProcess;
              },
              !0
            )
          ),
          o.addEffect(
            new $h(
              i.getEngine(),
              o.SSAOBlurHRenderEffect,
              function () {
                return o._blurHPostProcess;
              },
              !0
            )
          ),
          o.addEffect(
            new $h(
              i.getEngine(),
              o.SSAOBlurVRenderEffect,
              function () {
                return o._blurVPostProcess;
              },
              !0
            )
          ),
          o.addEffect(
            new $h(
              i.getEngine(),
              o.SSAOCombineRenderEffect,
              function () {
                return o._ssaoCombinePostProcess;
              },
              !0
            )
          ),
          i.postProcessRenderPipelineManager.addPipeline(o),
          r &&
            i.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(
              t,
              r
            ),
          o
        );
      }
      P(t, e),
        Object.defineProperty(t.prototype, "scene", {
          get: function () {
            return this._scene;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getClassName = function () {
          return "SSAORenderingPipeline";
        }),
        (t.prototype.dispose = function (t) {
          void 0 === t && (t = !1);
          for (var i = 0; i < this._scene.cameras.length; i++) {
            var n = this._scene.cameras[i];
            this._originalColorPostProcess.dispose(n),
              this._ssaoPostProcess.dispose(n),
              this._blurHPostProcess.dispose(n),
              this._blurVPostProcess.dispose(n),
              this._ssaoCombinePostProcess.dispose(n);
          }
          this._randomTexture.dispose(),
            t && this._scene.disableDepthRenderer(),
            this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(
              this._name,
              this._scene.cameras
            ),
            e.prototype.dispose.call(this);
        }),
        (t.prototype._createBlurPostProcess = function (e) {
          var t = this;
          (this._blurHPostProcess = new Ns(
            "BlurH",
            new p(1, 0),
            16,
            e,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            this._scene.getEngine(),
            !1,
            0
          )),
            (this._blurVPostProcess = new Ns(
              "BlurV",
              new p(0, 1),
              16,
              e,
              null,
              mn.BILINEAR_SAMPLINGMODE,
              this._scene.getEngine(),
              !1,
              0
            )),
            this._blurHPostProcess.onActivateObservable.add(function () {
              var e =
                t._blurHPostProcess.width /
                t._scene.getEngine().getRenderWidth();
              t._blurHPostProcess.kernel = 16 * e;
            }),
            this._blurVPostProcess.onActivateObservable.add(function () {
              var e =
                t._blurVPostProcess.height /
                t._scene.getEngine().getRenderHeight();
              t._blurVPostProcess.kernel = 16 * e;
            });
        }),
        (t.prototype._rebuild = function () {
          (this._firstUpdate = !0), e.prototype._rebuild.call(this);
        }),
        (t.prototype._createSSAOPostProcess = function (e) {
          var t = this,
            i = [
              0.5381, 0.1856, -0.4319, 0.1379, 0.2486, 0.443, 0.3371, 0.5679,
              -0.0057, -0.6999, -0.0451, -0.0019, 0.0689, -0.1598, -0.8547,
              0.056, 0.0069, -0.1843, -0.0146, 0.1402, 0.0762, 0.01, -0.1924,
              -0.0344, -0.3577, -0.5301, -0.4358, -0.3169, 0.1063, 0.0158,
              0.0103, -0.5869, 0.0046, -0.0897, -0.494, 0.3287, 0.7119, -0.0154,
              -0.0918, -0.0533, 0.0596, -0.5411, 0.0352, -0.0631, 0.546,
              -0.4776, 0.2847, -0.0271,
            ];
          (this._ssaoPostProcess = new vr(
            "ssao",
            "ssao",
            [
              "sampleSphere",
              "samplesFactor",
              "randTextureTiles",
              "totalStrength",
              "radius",
              "area",
              "fallOff",
              "base",
              "range",
              "viewport",
            ],
            ["randomSampler"],
            e,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            this._scene.getEngine(),
            !1,
            "#define SAMPLES 16\n#define SSAO"
          )),
            (this._ssaoPostProcess.onApply = function (e) {
              t._firstUpdate &&
                (e.setArray3("sampleSphere", i),
                e.setFloat("samplesFactor", 0.0625),
                e.setFloat("randTextureTiles", 4)),
                e.setFloat("totalStrength", t.totalStrength),
                e.setFloat("radius", t.radius),
                e.setFloat("area", t.area),
                e.setFloat("fallOff", t.fallOff),
                e.setFloat("base", t.base),
                e.setTexture("textureSampler", t._depthTexture),
                e.setTexture("randomSampler", t._randomTexture);
            });
        }),
        (t.prototype._createSSAOCombinePostProcess = function (e) {
          var t = this;
          (this._ssaoCombinePostProcess = new vr(
            "ssaoCombine",
            "ssaoCombine",
            [],
            ["originalColor", "viewport"],
            e,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            this._scene.getEngine(),
            !1
          )),
            (this._ssaoCombinePostProcess.onApply = function (e) {
              e.setVector4("viewport", y.Vector4[0].copyFromFloats(0, 0, 1, 1)),
                e.setTextureFromPostProcess(
                  "originalColor",
                  t._originalColorPostProcess
                );
            });
        }),
        (t.prototype._createRandomTexture = function () {
          (this._randomTexture = new Zr(
            "SSAORandomTexture",
            512,
            this._scene,
            !1,
            mn.TRILINEAR_SAMPLINGMODE
          )),
            (this._randomTexture.wrapU = mn.WRAP_ADDRESSMODE),
            (this._randomTexture.wrapV = mn.WRAP_ADDRESSMODE);
          for (
            var e = this._randomTexture.getContext(),
              t = function (e, t) {
                return Math.random() * (t - e) + e;
              },
              i = f.Zero(),
              n = 0;
            n < 512;
            n++
          )
            for (var r = 0; r < 512; r++)
              (i.x = Math.floor(255 * t(-1, 1))),
                (i.y = Math.floor(255 * t(-1, 1))),
                (i.z = Math.floor(255 * t(-1, 1))),
                (e.fillStyle = "rgb(" + i.x + ", " + i.y + ", " + i.z + ")"),
                e.fillRect(n, r, 1, 1);
          this._randomTexture.update(!1);
        }),
        R([se()], t.prototype, "totalStrength", void 0),
        R([se()], t.prototype, "radius", void 0),
        R([se()], t.prototype, "area", void 0),
        R([se()], t.prototype, "fallOff", void 0),
        R([se()], t.prototype, "base", void 0);
    })(Td);
  var Ad = function () {
    (this.enabled = !1),
      (this.name = "screenSpaceReflections"),
      (this.texturesRequired = [5, 3, 1]);
  };
  Ke.ShadersStore.screenSpaceReflectionPixelShader =
    "\n\nuniform sampler2D textureSampler;\nuniform sampler2D normalSampler;\nuniform sampler2D positionSampler;\nuniform sampler2D reflectivitySampler;\nuniform mat4 view;\nuniform mat4 projection;\nuniform float step;\nuniform float strength;\nuniform float threshold;\nuniform float roughnessFactor;\nuniform float reflectionSpecularFalloffExponent;\n\nvarying vec2 vUV;\n\nstruct ReflectionInfo {\nvec3 color;\nvec4 coords;\n};\n\nvec3 fresnelSchlick(float cosTheta,vec3 F0)\n{\nreturn F0+(1.0-F0)*pow(1.0-cosTheta,5.0);\n}\n\nReflectionInfo smoothReflectionInfo(vec3 dir,vec3 hitCoord)\n{\nReflectionInfo info;\ninfo.color=vec3(0.0);\nvec4 projectedCoord;\nfloat sampledDepth;\nfor(int i=0; i<SMOOTH_STEPS; i++)\n{\nprojectedCoord=projection*vec4(hitCoord,1.0);\nprojectedCoord.xy/=projectedCoord.w;\nprojectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);\nsampledDepth=(view*texture2D(positionSampler,projectedCoord.xy)).z;\nfloat depth=sampledDepth-hitCoord.z;\ndir*=0.5;\nif(depth>0.0)\nhitCoord-=dir;\nelse\nhitCoord+=dir;\ninfo.color+=texture2D(textureSampler,projectedCoord.xy).rgb;\n}\nprojectedCoord=projection*vec4(hitCoord,1.0);\nprojectedCoord.xy/=projectedCoord.w;\nprojectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);\n\ninfo.coords=vec4(projectedCoord.xy,sampledDepth,1.0);\ninfo.color+=texture2D(textureSampler,projectedCoord.xy).rgb;\ninfo.color/=float(SMOOTH_STEPS+1);\nreturn info;\n}\n\nReflectionInfo getReflectionInfo(vec3 dir,vec3 hitCoord)\n{\nReflectionInfo info;\nvec4 projectedCoord;\nfloat sampledDepth;\ndir*=step;\nfor(int i=0; i<REFLECTION_SAMPLES; i++)\n{\nhitCoord+=dir;\nprojectedCoord=projection*vec4(hitCoord,1.0);\nprojectedCoord.xy/=projectedCoord.w;\nprojectedCoord.xy=0.5*projectedCoord.xy+vec2(0.5);\nsampledDepth=(view*texture2D(positionSampler,projectedCoord.xy)).z;\nfloat depth=sampledDepth-hitCoord.z;\nif(((depth-dir.z)<threshold) && depth<=0.0)\n{\n#ifdef ENABLE_SMOOTH_REFLECTIONS\nreturn smoothReflectionInfo(dir,hitCoord);\n#else\ninfo.color=texture2D(textureSampler,projectedCoord.xy).rgb;\ninfo.coords=vec4(projectedCoord.xy,sampledDepth,0.0);\nreturn info;\n#endif\n}\n}\ninfo.color=texture2D(textureSampler,projectedCoord.xy).rgb;\ninfo.coords=vec4(projectedCoord.xy,sampledDepth,0.0);\nreturn info;\n}\nvec3 hash(vec3 a)\n{\na=fract(a*0.8);\na+=dot(a,a.yxz+19.19);\nreturn fract((a.xxy+a.yxx)*a.zyx);\n}\nvoid main()\n{\n#ifdef SSR_SUPPORTED\n\nvec4 albedoFull=texture2D(textureSampler,vUV);\nvec3 albedo=albedoFull.rgb;\nfloat spec=texture2D(reflectivitySampler,vUV).r;\nif (spec == 0.0) {\ngl_FragColor=albedoFull;\nreturn;\n}\n\n#ifdef PREPASS_LAYOUT\nvec3 normal=(texture2D(normalSampler,vUV)).gba;\n#else\nvec3 normal=(texture2D(normalSampler,vUV)).xyz;\n#endif\nvec3 position=(view*texture2D(positionSampler,vUV)).xyz;\nvec3 reflected=normalize(reflect(normalize(position),normalize(normal)));\nfloat roughness=1.0-texture2D(reflectivitySampler,vUV).a;\nvec3 jitt=mix(vec3(0.0),hash(position),roughness)*roughnessFactor;\nReflectionInfo info=getReflectionInfo(jitt+reflected,position);\n\nvec2 dCoords=smoothstep(0.2,0.6,abs(vec2(0.5,0.5)-info.coords.xy));\nfloat screenEdgefactor=clamp(1.0-(dCoords.x+dCoords.y),0.0,1.0);\n\nvec3 F0=vec3(0.04);\nF0=mix(F0,albedo,spec);\nvec3 fresnel=fresnelSchlick(max(dot(normalize(normal),normalize(position)),0.0),F0);\n\nfloat reflectionMultiplier=clamp(pow(spec*strength,reflectionSpecularFalloffExponent)*screenEdgefactor*reflected.z,0.0,0.9);\nfloat albedoMultiplier=1.0-reflectionMultiplier;\nvec3 SSR=info.color*fresnel;\ngl_FragColor=vec4((albedo*albedoMultiplier)+(SSR*reflectionMultiplier),albedoFull.a);\n#else\ngl_FragColor=texture2D(textureSampler,vUV);\n#endif\n}\n";
  var Rd = (function (e) {
    function t(t, i, n, r, o, s, a, l, c, u) {
      void 0 === l && (l = 0),
        void 0 === c && (c = !1),
        void 0 === u && (u = !0);
      var h =
        e.call(
          this,
          t,
          "screenSpaceReflection",
          [
            "projection",
            "view",
            "threshold",
            "reflectionSpecularFalloffExponent",
            "strength",
            "step",
            "roughnessFactor",
          ],
          [
            "textureSampler",
            "normalSampler",
            "positionSampler",
            "reflectivitySampler",
          ],
          n,
          r,
          o,
          s,
          a,
          "#define SSR_SUPPORTED\n#define REFLECTION_SAMPLES 64\n#define SMOOTH_STEPS 5\n",
          l,
          void 0,
          null,
          c
        ) || this;
      if (
        ((h.threshold = 1.2),
        (h.strength = 1),
        (h.reflectionSpecularFalloffExponent = 3),
        (h.step = 1),
        (h.roughnessFactor = 0.2),
        (h._forceGeometryBuffer = !1),
        (h._enableSmoothReflections = !1),
        (h._reflectionSamples = 64),
        (h._smoothSteps = 5),
        (h._forceGeometryBuffer = u),
        h._forceGeometryBuffer)
      ) {
        var d = i.enableGeometryBufferRenderer();
        d &&
          d.isSupported &&
          ((d.enablePosition = !0),
          (d.enableReflectivity = !0),
          (h._geometryBufferRenderer = d));
      } else
        (h._prePassRenderer = i.enablePrePassRenderer()),
          h._prePassRenderer.markAsDirty(),
          (h._prePassEffectConfiguration = new Ad());
      return (
        h._updateEffectDefines(),
        (h.onApply = function (e) {
          var t = h._geometryBufferRenderer,
            n = h._prePassRenderer;
          if (n || t) {
            if (t) {
              var r = t.getTextureIndex(_d.POSITION_TEXTURE_TYPE),
                o = t.getTextureIndex(_d.REFLECTIVITY_TEXTURE_TYPE);
              e.setTexture("normalSampler", t.getGBuffer().textures[1]),
                e.setTexture("positionSampler", t.getGBuffer().textures[r]),
                e.setTexture("reflectivitySampler", t.getGBuffer().textures[o]);
            } else {
              (r = n.getIndex(1)), (o = n.getIndex(3));
              var s = n.getIndex(5);
              e.setTexture("normalSampler", n.prePassRT.textures[s]),
                e.setTexture("positionSampler", n.prePassRT.textures[r]),
                e.setTexture("reflectivitySampler", n.prePassRT.textures[o]);
            }
            var a = i.activeCamera;
            if (a) {
              var l = a.getViewMatrix(),
                c = a.getProjectionMatrix();
              e.setMatrix("projection", c),
                e.setMatrix("view", l),
                e.setFloat("threshold", h.threshold),
                e.setFloat(
                  "reflectionSpecularFalloffExponent",
                  h.reflectionSpecularFalloffExponent
                ),
                e.setFloat("strength", h.strength),
                e.setFloat("step", h.step),
                e.setFloat("roughnessFactor", h.roughnessFactor);
            }
          }
        }),
        h
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ScreenSpaceReflectionPostProcess";
      }),
      Object.defineProperty(t.prototype, "enableSmoothReflections", {
        get: function () {
          return this._enableSmoothReflections;
        },
        set: function (e) {
          e !== this._enableSmoothReflections &&
            ((this._enableSmoothReflections = e), this._updateEffectDefines());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "reflectionSamples", {
        get: function () {
          return this._reflectionSamples;
        },
        set: function (e) {
          e !== this._reflectionSamples &&
            ((this._reflectionSamples = e), this._updateEffectDefines());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "smoothSteps", {
        get: function () {
          return this._smoothSteps;
        },
        set: function (e) {
          e !== this._smoothSteps &&
            ((this._smoothSteps = e), this._updateEffectDefines());
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._updateEffectDefines = function () {
        var e = [];
        (this._geometryBufferRenderer || this._prePassRenderer) &&
          (e.push("#define SSR_SUPPORTED"),
          this._prePassRenderer && e.push("#define PREPASS_LAYOUT")),
          this._enableSmoothReflections &&
            e.push("#define ENABLE_SMOOTH_REFLECTIONS"),
          e.push(
            "#define REFLECTION_SAMPLES " + (this._reflectionSamples >> 0)
          ),
          e.push("#define SMOOTH_STEPS " + (this._smoothSteps >> 0)),
          this.updateEffect(e.join("\n"));
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              n,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.textureType,
              e.reusable
            );
          },
          e,
          n,
          r
        );
      }),
      R([se()], t.prototype, "threshold", void 0),
      R([se()], t.prototype, "strength", void 0),
      R([se()], t.prototype, "reflectionSpecularFalloffExponent", void 0),
      R([se()], t.prototype, "step", void 0),
      R([se()], t.prototype, "roughnessFactor", void 0),
      R([se()], t.prototype, "enableSmoothReflections", null),
      R([se()], t.prototype, "reflectionSamples", null),
      R([se()], t.prototype, "smoothSteps", null),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.ScreenSpaceReflectionPostProcess"] = Rd;
  Ke.ShadersStore.standardPixelShader =
    "uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(PASS_POST_PROCESS)\nvoid main(void)\n{\nvec4 color=texture2D(textureSampler,vUV);\ngl_FragColor=color;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main(void)\n{\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nuniform sampler2D lensSampler;\nuniform float exposure;\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\ncolour*=exposure;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\ncolour+=colour*texture2D(lensSampler,vUV).rgb;\nvec4 finalColor=vec4(colour.rgb,1.0)+texture2D(otherSampler,vUV);\ngl_FragColor=finalColor;\n}\n#endif\n#if defined(VLS)\n#define PI 3.1415926535897932384626433832795\nuniform mat4 shadowViewProjection;\nuniform mat4 lightWorld;\nuniform vec3 cameraPosition;\nuniform vec3 sunDirection;\nuniform vec3 sunColor;\nuniform vec2 depthValues;\nuniform float scatteringCoefficient;\nuniform float scatteringPower;\nuniform sampler2D shadowMapSampler;\nuniform sampler2D positionSampler;\nfloat computeScattering(float lightDotView)\n{\nfloat result=1.0-scatteringCoefficient*scatteringCoefficient;\nresult/=(4.0*PI*pow(1.0+scatteringCoefficient*scatteringCoefficient-(2.0*scatteringCoefficient)*lightDotView,1.5));\nreturn result;\n}\nvoid main(void)\n{\n\nvec3 worldPos=texture2D(positionSampler,vUV).rgb;\nvec3 startPosition=cameraPosition;\nvec3 rayVector=worldPos-startPosition;\nfloat rayLength=length(rayVector);\nvec3 rayDirection=rayVector/rayLength;\nfloat stepLength=rayLength/NB_STEPS;\nvec3 stepL=rayDirection*stepLength;\nvec3 currentPosition=startPosition;\nvec3 accumFog=vec3(0.0);\nfor (int i=0; i<int(NB_STEPS); i++)\n{\nvec4 worldInShadowCameraSpace=shadowViewProjection*vec4(currentPosition,1.0);\nfloat depthMetric=(worldInShadowCameraSpace.z+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depthMetric,0.0,1.0);\nworldInShadowCameraSpace.xyz/=worldInShadowCameraSpace.w;\nworldInShadowCameraSpace.xyz=0.5*worldInShadowCameraSpace.xyz+vec3(0.5);\nfloat shadowMapValue=texture2D(shadowMapSampler,worldInShadowCameraSpace.xy).r;\nif (shadowMapValue>shadowPixelDepth)\naccumFog+=sunColor*computeScattering(dot(rayDirection,sunDirection));\ncurrentPosition+=stepL;\n}\naccumFog/=NB_STEPS;\nvec3 color=accumFog*scatteringPower;\ngl_FragColor=vec4(color*exp(color) ,1.0);\n}\n#endif\n#if defined(VLSMERGE)\nuniform sampler2D originalSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(originalSampler,vUV)+texture2D(textureSampler,vUV);\n}\n#endif\n#if defined(LUMINANCE)\nuniform vec2 lumOffsets[4];\nvoid main()\n{\nfloat average=0.0;\nvec4 color=vec4(0.0);\nfloat maximum=-1e20;\nvec3 weight=vec3(0.299,0.587,0.114);\nfor (int i=0; i<4; i++)\n{\ncolor=texture2D(textureSampler,vUV+ lumOffsets[i]);\n\nfloat GreyValue=dot(color.rgb,vec3(0.33,0.33,0.33));\n\n#ifdef WEIGHTED_AVERAGE\nfloat GreyValue=dot(color.rgb,weight);\n#endif\n#ifdef BRIGHTNESS\nfloat GreyValue=max(color.r,max(color.g,color.b));\n#endif\n#ifdef HSL_COMPONENT\nfloat GreyValue=0.5*(max(color.r,max(color.g,color.b))+min(color.r,min(color.g,color.b)));\n#endif\n#ifdef MAGNITUDE\nfloat GreyValue=length(color.rgb);\n#endif\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(LUMINANCE_DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLER\n#include<packingFunctions>\n#endif\nvoid main()\n{\nvec4 color=vec4(0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++)\n{\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifdef FINAL_DOWN_SAMPLER\ngl_FragColor=pack(average);\n#else\ngl_FragColor=vec4(average,average,0.0,1.0);\n#endif\n}\n#endif\n#if defined(HDR)\nuniform sampler2D textureAdderSampler;\nuniform float averageLuminance;\nvoid main()\n{\nvec4 color=texture2D(textureAdderSampler,vUV);\n#ifndef AUTO_EXPOSURE\nvec4 adjustedColor=color/averageLuminance;\ncolor=adjustedColor;\ncolor.a=1.0;\n#endif\ngl_FragColor=color;\n}\n#endif\n#if defined(LENS_FLARE)\n#define GHOSTS 3\nuniform sampler2D lensColorSampler;\nuniform float strength;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform vec2 resolution;\nuniform float distortionStrength;\nfloat hash(vec2 p)\n{\nfloat h=dot(p,vec2(127.1,311.7));\nreturn -1.0+2.0*fract(sin(h)*43758.5453123);\n}\nfloat noise(in vec2 p)\n{\nvec2 i=floor(p);\nvec2 f=fract(p);\nvec2 u=f*f*(3.0-2.0*f);\nreturn mix(mix(hash(i+vec2(0.0,0.0)),\nhash(i+vec2(1.0,0.0)),u.x),\nmix(hash(i+vec2(0.0,1.0)),\nhash(i+vec2(1.0,1.0)),u.x),u.y);\n}\nfloat fbm(vec2 p)\n{\nfloat f=0.0;\nf+=0.5000*noise(p); p*=2.02;\nf+=0.2500*noise(p); p*=2.03;\nf+=0.1250*noise(p); p*=2.01;\nf+=0.0625*noise(p); p*=2.04;\nf/=0.9375;\nreturn f;\n}\nvec3 pattern(vec2 uv)\n{\nvec2 p=-1.0+2.0*uv;\nfloat p2=dot(p,p);\nfloat f=fbm(vec2(15.0*p2))/2.0;\nfloat r=0.2+0.6*sin(12.5*length(uv-vec2(0.5)));\nfloat g=0.2+0.6*sin(20.5*length(uv-vec2(0.5)));\nfloat b=0.2+0.6*sin(17.2*length(uv-vec2(0.5)));\nreturn (1.0-f)*vec3(r,g,b);\n}\nfloat luminance(vec3 color)\n{\nreturn dot(color.rgb,vec3(0.2126,0.7152,0.0722));\n}\nvec4 textureDistorted(sampler2D tex,vec2 texcoord,vec2 direction,vec3 distortion)\n{\nreturn vec4(\ntexture2D(tex,texcoord+direction*distortion.r).r,\ntexture2D(tex,texcoord+direction*distortion.g).g,\ntexture2D(tex,texcoord+direction*distortion.b).b,\n1.0\n);\n}\nvoid main(void)\n{\nvec2 uv=-vUV+vec2(1.0);\nvec2 ghostDir=(vec2(0.5)-uv)*ghostDispersal;\nvec2 texelSize=1.0/resolution;\nvec3 distortion=vec3(-texelSize.x*distortionStrength,0.0,texelSize.x*distortionStrength);\nvec4 result=vec4(0.0);\nfloat ghostIndice=1.0;\nfor (int i=0; i<GHOSTS; ++i)\n{\nvec2 offset=fract(uv+ghostDir*ghostIndice);\nfloat weight=length(vec2(0.5)-offset)/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,offset,normalize(ghostDir),distortion)*weight*strength;\nghostIndice+=1.0;\n}\nvec2 haloVec=normalize(ghostDir)*haloWidth;\nfloat weight=length(vec2(0.5)-fract(uv+haloVec))/length(vec2(0.5));\nweight=pow(1.0-weight,10.0);\nresult+=textureDistorted(textureSampler,fract(uv+haloVec),normalize(ghostDir),distortion)*weight*strength;\nresult*=texture2D(lensColorSampler,vec2(length(vec2(0.5)-uv)/length(vec2(0.5))));\ngl_FragColor=result;\n}\n#endif\n#if defined(LENS_FLARE_COMPOSE)\nuniform sampler2D otherSampler;\nuniform sampler2D lensDirtSampler;\nuniform sampler2D lensStarSampler;\nuniform mat4 lensStarMatrix;\nvoid main(void)\n{\nvec2 lensFlareCoords=(lensStarMatrix*vec4(vUV,1.0,1.0)).xy;\nvec4 lensMod=texture2D(lensDirtSampler,vUV);\nlensMod+=texture2D(lensStarSampler,vUV);\nvec4 result=texture2D(textureSampler,vUV)*lensMod;\ngl_FragColor=texture2D(otherSampler,vUV)+result;\n}\n#endif\n#if defined(DEPTH_OF_FIELD)\nuniform sampler2D otherSampler;\nuniform sampler2D depthSampler;\nuniform float distance;\nvoid main(void)\n{\nvec4 sharp=texture2D(otherSampler,vUV);\nvec4 blur=texture2D(textureSampler,vUV);\nfloat dist=clamp(texture2D(depthSampler,vUV).r*distance,0.0,1.0);\nfloat factor=0.0;\nif (dist<0.05)\nfactor=1.0;\nelse if (dist<0.1)\nfactor=20.0*(0.1-dist);\nelse if (dist<0.5)\nfactor=0.0;\nelse\nfactor=2.0*(dist-0.5);\nfactor=clamp(factor,0.0,0.90);\ngl_FragColor=mix(sharp,blur,factor);\n}\n#endif\n#if defined(MOTION_BLUR)\nuniform mat4 inverseViewProjection;\nuniform mat4 prevViewProjection;\nuniform vec2 screenSize;\nuniform float motionScale;\nuniform float motionStrength;\nuniform sampler2D depthSampler;\nvoid main(void)\n{\nvec2 texelSize=1.0/screenSize;\nfloat depth=texture2D(depthSampler,vUV).r;\nvec4 cpos=vec4(vUV*2.0-1.0,depth,1.0);\ncpos=cpos*inverseViewProjection;\nvec4 ppos=cpos*prevViewProjection;\nppos.xyz/=ppos.w;\nppos.xy=ppos.xy*0.5+0.5;\nvec2 velocity=(ppos.xy-vUV)*motionScale*motionStrength;\nfloat speed=length(velocity/texelSize);\nint nSamples=int(clamp(speed,1.0,MAX_MOTION_SAMPLES));\nvec4 result=texture2D(textureSampler,vUV);\nfor (int i=1; i<int(MAX_MOTION_SAMPLES); ++i) {\nif (i>=nSamples)\nbreak;\nvec2 offset1=vUV+velocity*(float(i)/float(nSamples-1)-0.5);\nresult+=texture2D(textureSampler,offset1);\n}\ngl_FragColor=result/float(nSamples);\n}\n#endif\n";
  var Md = (function (e) {
    function t(t, i, n, r, o) {
      void 0 === r && (r = null);
      var s = e.call(this, i.getEngine(), t) || this;
      return (
        (s.downSampleX4PostProcess = null),
        (s.brightPassPostProcess = null),
        (s.blurHPostProcesses = []),
        (s.blurVPostProcesses = []),
        (s.textureAdderPostProcess = null),
        (s.volumetricLightPostProcess = null),
        (s.volumetricLightSmoothXPostProcess = null),
        (s.volumetricLightSmoothYPostProcess = null),
        (s.volumetricLightMergePostProces = null),
        (s.volumetricLightFinalPostProcess = null),
        (s.luminancePostProcess = null),
        (s.luminanceDownSamplePostProcesses = []),
        (s.hdrPostProcess = null),
        (s.textureAdderFinalPostProcess = null),
        (s.lensFlareFinalPostProcess = null),
        (s.hdrFinalPostProcess = null),
        (s.lensFlarePostProcess = null),
        (s.lensFlareComposePostProcess = null),
        (s.motionBlurPostProcess = null),
        (s.depthOfFieldPostProcess = null),
        (s.fxaaPostProcess = null),
        (s.screenSpaceReflectionPostProcess = null),
        (s.brightThreshold = 1),
        (s.blurWidth = 512),
        (s.horizontalBlur = !1),
        (s.lensTexture = null),
        (s.volumetricLightCoefficient = 0.2),
        (s.volumetricLightPower = 4),
        (s.volumetricLightBlurScale = 64),
        (s.sourceLight = null),
        (s.hdrMinimumLuminance = 1),
        (s.hdrDecreaseRate = 0.5),
        (s.hdrIncreaseRate = 0.5),
        (s.lensColorTexture = null),
        (s.lensFlareStrength = 20),
        (s.lensFlareGhostDispersal = 1.4),
        (s.lensFlareHaloWidth = 0.7),
        (s.lensFlareDistortionStrength = 16),
        (s.lensFlareBlurWidth = 512),
        (s.lensStarTexture = null),
        (s.lensFlareDirtTexture = null),
        (s.depthOfFieldDistance = 10),
        (s.depthOfFieldBlurWidth = 64),
        (s.animations = []),
        (s._currentDepthOfFieldSource = null),
        (s._fixedExposure = 1),
        (s._currentExposure = 1),
        (s._hdrAutoExposure = !1),
        (s._hdrCurrentLuminance = 1),
        (s._motionStrength = 1),
        (s._isObjectBasedMotionBlur = !1),
        (s._camerasToBeAttached = []),
        (s._bloomEnabled = !1),
        (s._depthOfFieldEnabled = !1),
        (s._vlsEnabled = !1),
        (s._lensFlareEnabled = !1),
        (s._hdrEnabled = !1),
        (s._motionBlurEnabled = !1),
        (s._fxaaEnabled = !1),
        (s._screenSpaceReflectionsEnabled = !1),
        (s._motionBlurSamples = 64),
        (s._volumetricLightStepsCount = 50),
        (s._samples = 1),
        (s._cameras = o || i.cameras),
        (s._cameras = s._cameras.slice()),
        (s._camerasToBeAttached = s._cameras.slice()),
        (s._scene = i),
        (s._basePostProcess = r),
        (s._ratio = n),
        (s._floatTextureType = i.getEngine().getCaps().textureFloatRender
          ? 1
          : 2),
        i.postProcessRenderPipelineManager.addPipeline(s),
        s._buildPipeline(),
        s
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "exposure", {
        get: function () {
          return this._fixedExposure;
        },
        set: function (e) {
          (this._fixedExposure = e), (this._currentExposure = e);
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "hdrAutoExposure", {
        get: function () {
          return this._hdrAutoExposure;
        },
        set: function (e) {
          if (((this._hdrAutoExposure = e), this.hdrPostProcess)) {
            var t = ["#define HDR"];
            e && t.push("#define AUTO_EXPOSURE"),
              this.hdrPostProcess.updateEffect(t.join("\n"));
          }
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "motionStrength", {
        get: function () {
          return this._motionStrength;
        },
        set: function (e) {
          (this._motionStrength = e),
            this._isObjectBasedMotionBlur &&
              this.motionBlurPostProcess &&
              (this.motionBlurPostProcess.motionStrength = e);
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "objectBasedMotionBlur", {
        get: function () {
          return this._isObjectBasedMotionBlur;
        },
        set: function (e) {
          var t = this._isObjectBasedMotionBlur !== e;
          (this._isObjectBasedMotionBlur = e), t && this._buildPipeline();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "BloomEnabled", {
        get: function () {
          return this._bloomEnabled;
        },
        set: function (e) {
          this._bloomEnabled !== e &&
            ((this._bloomEnabled = e), this._buildPipeline());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "DepthOfFieldEnabled", {
        get: function () {
          return this._depthOfFieldEnabled;
        },
        set: function (e) {
          this._depthOfFieldEnabled !== e &&
            ((this._depthOfFieldEnabled = e), this._buildPipeline());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "LensFlareEnabled", {
        get: function () {
          return this._lensFlareEnabled;
        },
        set: function (e) {
          this._lensFlareEnabled !== e &&
            ((this._lensFlareEnabled = e), this._buildPipeline());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "HDREnabled", {
        get: function () {
          return this._hdrEnabled;
        },
        set: function (e) {
          this._hdrEnabled !== e &&
            ((this._hdrEnabled = e), this._buildPipeline());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "VLSEnabled", {
        get: function () {
          return this._vlsEnabled;
        },
        set: function (e) {
          if (this._vlsEnabled !== e) {
            if (e && !this._scene.enableGeometryBufferRenderer())
              return void F.Warn(
                "Geometry renderer is not supported, cannot create volumetric lights in Standard Rendering Pipeline"
              );
            (this._vlsEnabled = e), this._buildPipeline();
          }
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "MotionBlurEnabled", {
        get: function () {
          return this._motionBlurEnabled;
        },
        set: function (e) {
          this._motionBlurEnabled !== e &&
            ((this._motionBlurEnabled = e), this._buildPipeline());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "fxaaEnabled", {
        get: function () {
          return this._fxaaEnabled;
        },
        set: function (e) {
          this._fxaaEnabled !== e &&
            ((this._fxaaEnabled = e), this._buildPipeline());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "screenSpaceReflectionsEnabled", {
        get: function () {
          return this._screenSpaceReflectionsEnabled;
        },
        set: function (e) {
          this._screenSpaceReflectionsEnabled !== e &&
            ((this._screenSpaceReflectionsEnabled = e), this._buildPipeline());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "volumetricLightStepsCount", {
        get: function () {
          return this._volumetricLightStepsCount;
        },
        set: function (e) {
          this.volumetricLightPostProcess &&
            this.volumetricLightPostProcess.updateEffect(
              "#define VLS\n#define NB_STEPS " + e.toFixed(1)
            ),
            (this._volumetricLightStepsCount = e);
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "motionBlurSamples", {
        get: function () {
          return this._motionBlurSamples;
        },
        set: function (e) {
          this.motionBlurPostProcess &&
            (this._isObjectBasedMotionBlur
              ? (this.motionBlurPostProcess.motionBlurSamples = e)
              : this.motionBlurPostProcess.updateEffect(
                  "#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES " +
                    e.toFixed(1)
                )),
            (this._motionBlurSamples = e);
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "samples", {
        get: function () {
          return this._samples;
        },
        set: function (e) {
          this._samples !== e && ((this._samples = e), this._buildPipeline());
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._buildPipeline = function () {
        var e = this,
          t = this._ratio,
          i = this._scene;
        this._disposePostProcesses(),
          null !== this._cameras &&
            (this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(
              this._name,
              this._cameras
            ),
            (this._cameras = this._camerasToBeAttached.slice())),
          this._reset(),
          this._screenSpaceReflectionsEnabled &&
            ((this.screenSpaceReflectionPostProcess = new Rd(
              "HDRPass",
              i,
              t,
              null,
              mn.BILINEAR_SAMPLINGMODE,
              i.getEngine(),
              !1,
              this._floatTextureType
            )),
            this.screenSpaceReflectionPostProcess.onApplyObservable.add(
              function () {
                e._currentDepthOfFieldSource =
                  e.screenSpaceReflectionPostProcess;
              }
            ),
            this.addEffect(
              new $h(
                i.getEngine(),
                "HDRScreenSpaceReflections",
                function () {
                  return e.screenSpaceReflectionPostProcess;
                },
                !0
              )
            )),
          this._basePostProcess
            ? (this.originalPostProcess = this._basePostProcess)
            : (this.originalPostProcess = new vr(
                "HDRPass",
                "standard",
                [],
                [],
                t,
                null,
                mn.BILINEAR_SAMPLINGMODE,
                i.getEngine(),
                !1,
                "#define PASS_POST_PROCESS",
                this._floatTextureType
              )),
          (this.originalPostProcess.autoClear =
            !this.screenSpaceReflectionPostProcess),
          this.originalPostProcess.onApplyObservable.add(function () {
            e._currentDepthOfFieldSource = e.originalPostProcess;
          }),
          this.addEffect(
            new $h(
              i.getEngine(),
              "HDRPassPostProcess",
              function () {
                return e.originalPostProcess;
              },
              !0
            )
          ),
          this._bloomEnabled &&
            (this._createDownSampleX4PostProcess(i, t / 4),
            this._createBrightPassPostProcess(i, t / 4),
            this._createBlurPostProcesses(i, t / 4, 1),
            this._createTextureAdderPostProcess(i, t),
            (this.textureAdderFinalPostProcess = new vr(
              "HDRDepthOfFieldSource",
              "standard",
              [],
              [],
              t,
              null,
              mn.BILINEAR_SAMPLINGMODE,
              i.getEngine(),
              !1,
              "#define PASS_POST_PROCESS",
              0
            )),
            this.addEffect(
              new $h(
                i.getEngine(),
                "HDRBaseDepthOfFieldSource",
                function () {
                  return e.textureAdderFinalPostProcess;
                },
                !0
              )
            )),
          this._vlsEnabled &&
            (this._createVolumetricLightPostProcess(i, t),
            (this.volumetricLightFinalPostProcess = new vr(
              "HDRVLSFinal",
              "standard",
              [],
              [],
              t,
              null,
              mn.BILINEAR_SAMPLINGMODE,
              i.getEngine(),
              !1,
              "#define PASS_POST_PROCESS",
              0
            )),
            this.addEffect(
              new $h(
                i.getEngine(),
                "HDRVLSFinal",
                function () {
                  return e.volumetricLightFinalPostProcess;
                },
                !0
              )
            )),
          this._lensFlareEnabled &&
            (this._createLensFlarePostProcess(i, t),
            (this.lensFlareFinalPostProcess = new vr(
              "HDRPostLensFlareDepthOfFieldSource",
              "standard",
              [],
              [],
              t,
              null,
              mn.BILINEAR_SAMPLINGMODE,
              i.getEngine(),
              !1,
              "#define PASS_POST_PROCESS",
              0
            )),
            this.addEffect(
              new $h(
                i.getEngine(),
                "HDRPostLensFlareDepthOfFieldSource",
                function () {
                  return e.lensFlareFinalPostProcess;
                },
                !0
              )
            )),
          this._hdrEnabled &&
            (this._createLuminancePostProcesses(i, this._floatTextureType),
            this._createHdrPostProcess(i, t),
            (this.hdrFinalPostProcess = new vr(
              "HDRPostHDReDepthOfFieldSource",
              "standard",
              [],
              [],
              t,
              null,
              mn.BILINEAR_SAMPLINGMODE,
              i.getEngine(),
              !1,
              "#define PASS_POST_PROCESS",
              0
            )),
            this.addEffect(
              new $h(
                i.getEngine(),
                "HDRPostHDReDepthOfFieldSource",
                function () {
                  return e.hdrFinalPostProcess;
                },
                !0
              )
            )),
          this._depthOfFieldEnabled &&
            (this._createBlurPostProcesses(
              i,
              t / 2,
              3,
              "depthOfFieldBlurWidth"
            ),
            this._createDepthOfFieldPostProcess(i, t)),
          this._motionBlurEnabled && this._createMotionBlurPostProcess(i, t),
          this._fxaaEnabled &&
            ((this.fxaaPostProcess = new pd(
              "fxaa",
              1,
              null,
              mn.BILINEAR_SAMPLINGMODE,
              i.getEngine(),
              !1,
              0
            )),
            this.addEffect(
              new $h(
                i.getEngine(),
                "HDRFxaa",
                function () {
                  return e.fxaaPostProcess;
                },
                !0
              )
            )),
          null !== this._cameras &&
            this._scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(
              this._name,
              this._cameras
            ),
          !this._enableMSAAOnFirstPostProcess(this._samples) &&
            this._samples > 1 &&
            F.Warn(
              "MSAA failed to enable, MSAA is only supported in browsers that support webGL >= 2.0"
            );
      }),
      (t.prototype._createDownSampleX4PostProcess = function (e, t) {
        var i = this,
          n = new Array(32);
        (this.downSampleX4PostProcess = new vr(
          "HDRDownSampleX4",
          "standard",
          ["dsOffsets"],
          [],
          t,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          e.getEngine(),
          !1,
          "#define DOWN_SAMPLE_X4",
          this._floatTextureType
        )),
          (this.downSampleX4PostProcess.onApply = function (e) {
            for (
              var t = 0,
                r = i.downSampleX4PostProcess.width,
                o = i.downSampleX4PostProcess.height,
                s = -2;
              s < 2;
              s++
            )
              for (var a = -2; a < 2; a++)
                (n[t] = (s + 0.5) * (1 / r)),
                  (n[t + 1] = (a + 0.5) * (1 / o)),
                  (t += 2);
            e.setArray2("dsOffsets", n);
          }),
          this.addEffect(
            new $h(
              e.getEngine(),
              "HDRDownSampleX4",
              function () {
                return i.downSampleX4PostProcess;
              },
              !0
            )
          );
      }),
      (t.prototype._createBrightPassPostProcess = function (e, t) {
        var i = this,
          n = new Array(8);
        (this.brightPassPostProcess = new vr(
          "HDRBrightPass",
          "standard",
          ["dsOffsets", "brightThreshold"],
          [],
          t,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          e.getEngine(),
          !1,
          "#define BRIGHT_PASS",
          this._floatTextureType
        )),
          (this.brightPassPostProcess.onApply = function (e) {
            var t = 1 / i.brightPassPostProcess.width,
              r = 1 / i.brightPassPostProcess.height;
            (n[0] = -0.5 * t),
              (n[1] = 0.5 * r),
              (n[2] = 0.5 * t),
              (n[3] = 0.5 * r),
              (n[4] = -0.5 * t),
              (n[5] = -0.5 * r),
              (n[6] = 0.5 * t),
              (n[7] = -0.5 * r),
              e.setArray2("dsOffsets", n),
              e.setFloat("brightThreshold", i.brightThreshold);
          }),
          this.addEffect(
            new $h(
              e.getEngine(),
              "HDRBrightPass",
              function () {
                return i.brightPassPostProcess;
              },
              !0
            )
          );
      }),
      (t.prototype._createBlurPostProcesses = function (e, t, i, n) {
        var r = this;
        void 0 === n && (n = "blurWidth");
        var o = e.getEngine(),
          s = new Ns(
            "HDRBlurH_" + i,
            new p(1, 0),
            this[n],
            t,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            e.getEngine(),
            !1,
            this._floatTextureType
          ),
          a = new Ns(
            "HDRBlurV_" + i,
            new p(0, 1),
            this[n],
            t,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            e.getEngine(),
            !1,
            this._floatTextureType
          );
        s.onActivateObservable.add(function () {
          var e = s.width / o.getRenderWidth();
          s.kernel = r[n] * e;
        }),
          a.onActivateObservable.add(function () {
            var e = a.height / o.getRenderHeight();
            a.kernel = r.horizontalBlur ? 64 * e : r[n] * e;
          }),
          this.addEffect(
            new $h(
              e.getEngine(),
              "HDRBlurH" + i,
              function () {
                return s;
              },
              !0
            )
          ),
          this.addEffect(
            new $h(
              e.getEngine(),
              "HDRBlurV" + i,
              function () {
                return a;
              },
              !0
            )
          ),
          this.blurHPostProcesses.push(s),
          this.blurVPostProcesses.push(a);
      }),
      (t.prototype._createTextureAdderPostProcess = function (e, t) {
        var i = this;
        (this.textureAdderPostProcess = new vr(
          "HDRTextureAdder",
          "standard",
          ["exposure"],
          ["otherSampler", "lensSampler"],
          t,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          e.getEngine(),
          !1,
          "#define TEXTURE_ADDER",
          this._floatTextureType
        )),
          (this.textureAdderPostProcess.onApply = function (e) {
            e.setTextureFromPostProcess(
              "otherSampler",
              i._vlsEnabled
                ? i._currentDepthOfFieldSource
                : i.originalPostProcess
            ),
              e.setTexture("lensSampler", i.lensTexture),
              e.setFloat("exposure", i._currentExposure),
              (i._currentDepthOfFieldSource = i.textureAdderFinalPostProcess);
          }),
          this.addEffect(
            new $h(
              e.getEngine(),
              "HDRTextureAdder",
              function () {
                return i.textureAdderPostProcess;
              },
              !0
            )
          );
      }),
      (t.prototype._createVolumetricLightPostProcess = function (e, t) {
        var i = this,
          n = e.enableGeometryBufferRenderer();
        n.enablePosition = !0;
        var r = n.getGBuffer();
        this.volumetricLightPostProcess = new vr(
          "HDRVLS",
          "standard",
          [
            "shadowViewProjection",
            "cameraPosition",
            "sunDirection",
            "sunColor",
            "scatteringCoefficient",
            "scatteringPower",
            "depthValues",
          ],
          ["shadowMapSampler", "positionSampler"],
          t / 8,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          e.getEngine(),
          !1,
          "#define VLS\n#define NB_STEPS " +
            this._volumetricLightStepsCount.toFixed(1)
        );
        var o = p.Zero();
        (this.volumetricLightPostProcess.onApply = function (e) {
          if (
            i.sourceLight &&
            i.sourceLight.getShadowGenerator() &&
            i._scene.activeCamera
          ) {
            var t = i.sourceLight.getShadowGenerator();
            e.setTexture("shadowMapSampler", t.getShadowMap()),
              e.setTexture("positionSampler", r.textures[2]),
              e.setColor3("sunColor", i.sourceLight.diffuse),
              e.setVector3("sunDirection", i.sourceLight.getShadowDirection()),
              e.setVector3(
                "cameraPosition",
                i._scene.activeCamera.globalPosition
              ),
              e.setMatrix("shadowViewProjection", t.getTransformMatrix()),
              e.setFloat("scatteringCoefficient", i.volumetricLightCoefficient),
              e.setFloat("scatteringPower", i.volumetricLightPower),
              (o.x = i.sourceLight.getDepthMinZ(i._scene.activeCamera)),
              (o.y = i.sourceLight.getDepthMaxZ(i._scene.activeCamera)),
              e.setVector2("depthValues", o);
          }
        }),
          this.addEffect(
            new $h(
              e.getEngine(),
              "HDRVLS",
              function () {
                return i.volumetricLightPostProcess;
              },
              !0
            )
          ),
          this._createBlurPostProcesses(
            e,
            t / 4,
            0,
            "volumetricLightBlurScale"
          ),
          (this.volumetricLightMergePostProces = new vr(
            "HDRVLSMerge",
            "standard",
            [],
            ["originalSampler"],
            t,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            e.getEngine(),
            !1,
            "#define VLSMERGE"
          )),
          (this.volumetricLightMergePostProces.onApply = function (e) {
            e.setTextureFromPostProcess(
              "originalSampler",
              i._bloomEnabled
                ? i.textureAdderFinalPostProcess
                : i.originalPostProcess
            ),
              (i._currentDepthOfFieldSource =
                i.volumetricLightFinalPostProcess);
          }),
          this.addEffect(
            new $h(
              e.getEngine(),
              "HDRVLSMerge",
              function () {
                return i.volumetricLightMergePostProces;
              },
              !0
            )
          );
      }),
      (t.prototype._createLuminancePostProcesses = function (e, i) {
        var n = this,
          r = Math.pow(3, t.LuminanceSteps);
        this.luminancePostProcess = new vr(
          "HDRLuminance",
          "standard",
          ["lumOffsets"],
          [],
          {
            width: r,
            height: r,
          },
          null,
          mn.BILINEAR_SAMPLINGMODE,
          e.getEngine(),
          !1,
          "#define LUMINANCE",
          i
        );
        var o = [];
        (this.luminancePostProcess.onApply = function (e) {
          var t = 1 / n.luminancePostProcess.width,
            i = 1 / n.luminancePostProcess.height;
          (o[0] = -0.5 * t),
            (o[1] = 0.5 * i),
            (o[2] = 0.5 * t),
            (o[3] = 0.5 * i),
            (o[4] = -0.5 * t),
            (o[5] = -0.5 * i),
            (o[6] = 0.5 * t),
            (o[7] = -0.5 * i),
            e.setArray2("lumOffsets", o);
        }),
          this.addEffect(
            new $h(
              e.getEngine(),
              "HDRLuminance",
              function () {
                return n.luminancePostProcess;
              },
              !0
            )
          );
        for (var s = t.LuminanceSteps - 1; s >= 0; s--) {
          r = Math.pow(3, s);
          var a = "#define LUMINANCE_DOWN_SAMPLE\n";
          0 === s && (a += "#define FINAL_DOWN_SAMPLER");
          var l = new vr(
            "HDRLuminanceDownSample" + s,
            "standard",
            ["dsOffsets", "halfDestPixelSize"],
            [],
            {
              width: r,
              height: r,
            },
            null,
            mn.BILINEAR_SAMPLINGMODE,
            e.getEngine(),
            !1,
            a,
            i
          );
          this.luminanceDownSamplePostProcesses.push(l);
        }
        var c = this.luminancePostProcess;
        this.luminanceDownSamplePostProcesses.forEach(function (t, i) {
          var r = new Array(18);
          (t.onApply = function (e) {
            if (c) {
              for (var o = 0, s = -1; s < 2; s++)
                for (var a = -1; a < 2; a++)
                  (r[o] = s / c.width), (r[o + 1] = a / c.height), (o += 2);
              e.setArray2("dsOffsets", r),
                e.setFloat("halfDestPixelSize", 0.5 / c.width),
                (c =
                  i === n.luminanceDownSamplePostProcesses.length - 1
                    ? n.luminancePostProcess
                    : t);
            }
          }),
            i === n.luminanceDownSamplePostProcesses.length - 1 &&
              (t.onAfterRender = function () {
                var t = e.getEngine().readPixels(0, 0, 1, 1),
                  i = new _(1 / 16581375, 1 / 65025, 1 / 255, 1);
                n._hdrCurrentLuminance =
                  (t[0] * i.x + t[1] * i.y + t[2] * i.z + t[3] * i.w) / 100;
              }),
            n.addEffect(
              new $h(
                e.getEngine(),
                "HDRLuminanceDownSample" + i,
                function () {
                  return t;
                },
                !0
              )
            );
        });
      }),
      (t.prototype._createHdrPostProcess = function (e, t) {
        var i = this,
          n = ["#define HDR"];
        this._hdrAutoExposure && n.push("#define AUTO_EXPOSURE"),
          (this.hdrPostProcess = new vr(
            "HDR",
            "standard",
            ["averageLuminance"],
            ["textureAdderSampler"],
            t,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            e.getEngine(),
            !1,
            n.join("\n"),
            0
          ));
        var r = 1,
          o = 0,
          a = 0;
        (this.hdrPostProcess.onApply = function (t) {
          if (
            (t.setTextureFromPostProcess(
              "textureAdderSampler",
              i._currentDepthOfFieldSource
            ),
            (o += e.getEngine().getDeltaTime()),
            r < 0)
          )
            r = i._hdrCurrentLuminance;
          else {
            var n = (a - o) / 1e3;
            i._hdrCurrentLuminance < r + i.hdrDecreaseRate * n
              ? (r += i.hdrDecreaseRate * n)
              : i._hdrCurrentLuminance > r - i.hdrIncreaseRate * n
                ? (r -= i.hdrIncreaseRate * n)
                : (r = i._hdrCurrentLuminance);
          }
          i.hdrAutoExposure
            ? (i._currentExposure = i._fixedExposure / r)
            : ((r = s.Clamp(r, i.hdrMinimumLuminance, 1e20)),
              t.setFloat("averageLuminance", r)),
            (a = o),
            (i._currentDepthOfFieldSource = i.hdrFinalPostProcess);
        }),
          this.addEffect(
            new $h(
              e.getEngine(),
              "HDR",
              function () {
                return i.hdrPostProcess;
              },
              !0
            )
          );
      }),
      (t.prototype._createLensFlarePostProcess = function (e, t) {
        var i = this;
        (this.lensFlarePostProcess = new vr(
          "HDRLensFlare",
          "standard",
          [
            "strength",
            "ghostDispersal",
            "haloWidth",
            "resolution",
            "distortionStrength",
          ],
          ["lensColorSampler"],
          t / 2,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          e.getEngine(),
          !1,
          "#define LENS_FLARE",
          0
        )),
          this.addEffect(
            new $h(
              e.getEngine(),
              "HDRLensFlare",
              function () {
                return i.lensFlarePostProcess;
              },
              !0
            )
          ),
          this._createBlurPostProcesses(e, t / 4, 2, "lensFlareBlurWidth"),
          (this.lensFlareComposePostProcess = new vr(
            "HDRLensFlareCompose",
            "standard",
            ["lensStarMatrix"],
            ["otherSampler", "lensDirtSampler", "lensStarSampler"],
            t,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            e.getEngine(),
            !1,
            "#define LENS_FLARE_COMPOSE",
            0
          )),
          this.addEffect(
            new $h(
              e.getEngine(),
              "HDRLensFlareCompose",
              function () {
                return i.lensFlareComposePostProcess;
              },
              !0
            )
          );
        var n = new p(0, 0);
        this.lensFlarePostProcess.onApply = function (e) {
          e.setTextureFromPostProcess(
            "textureSampler",
            i._bloomEnabled ? i.blurHPostProcesses[0] : i.originalPostProcess
          ),
            e.setTexture("lensColorSampler", i.lensColorTexture),
            e.setFloat("strength", i.lensFlareStrength),
            e.setFloat("ghostDispersal", i.lensFlareGhostDispersal),
            e.setFloat("haloWidth", i.lensFlareHaloWidth),
            (n.x = i.lensFlarePostProcess.width),
            (n.y = i.lensFlarePostProcess.height),
            e.setVector2("resolution", n),
            e.setFloat("distortionStrength", i.lensFlareDistortionStrength);
        };
        var r = g.FromValues(2, 0, -1, 0, 0, 2, -1, 0, 0, 0, 1, 0, 0, 0, 0, 1),
          o = g.FromValues(
            0.5,
            0,
            0.5,
            0,
            0,
            0.5,
            0.5,
            0,
            0,
            0,
            1,
            0,
            0,
            0,
            0,
            1
          );
        this.lensFlareComposePostProcess.onApply = function (e) {
          if (i._scene.activeCamera) {
            e.setTextureFromPostProcess("otherSampler", i.lensFlarePostProcess),
              e.setTexture("lensDirtSampler", i.lensFlareDirtTexture),
              e.setTexture("lensStarSampler", i.lensStarTexture);
            var t = i._scene.activeCamera.getViewMatrix().getRow(0),
              n = i._scene.activeCamera.getViewMatrix().getRow(2),
              s =
                f.Dot(t.toVector3(), new f(1, 0, 0)) +
                f.Dot(n.toVector3(), new f(0, 0, 1));
            s *= 4;
            var a = g.FromValues(
                0.5 * Math.cos(s),
                -Math.sin(s),
                0,
                0,
                Math.sin(s),
                0.5 * Math.cos(s),
                0,
                0,
                0,
                0,
                1,
                0,
                0,
                0,
                0,
                1
              ),
              l = o.multiply(a).multiply(r);
            e.setMatrix("lensStarMatrix", l),
              (i._currentDepthOfFieldSource = i.lensFlareFinalPostProcess);
          }
        };
      }),
      (t.prototype._createDepthOfFieldPostProcess = function (e, t) {
        var i = this;
        (this.depthOfFieldPostProcess = new vr(
          "HDRDepthOfField",
          "standard",
          ["distance"],
          ["otherSampler", "depthSampler"],
          t,
          null,
          mn.BILINEAR_SAMPLINGMODE,
          e.getEngine(),
          !1,
          "#define DEPTH_OF_FIELD",
          0
        )),
          (this.depthOfFieldPostProcess.onApply = function (e) {
            e.setTextureFromPostProcess(
              "otherSampler",
              i._currentDepthOfFieldSource
            ),
              e.setTexture("depthSampler", i._getDepthTexture()),
              e.setFloat("distance", i.depthOfFieldDistance);
          }),
          this.addEffect(
            new $h(
              e.getEngine(),
              "HDRDepthOfField",
              function () {
                return i.depthOfFieldPostProcess;
              },
              !0
            )
          );
      }),
      (t.prototype._createMotionBlurPostProcess = function (e, t) {
        var i = this;
        if (this._isObjectBasedMotionBlur) {
          var n = new vd(
            "HDRMotionBlur",
            e,
            t,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            e.getEngine(),
            !1,
            0
          );
          (n.motionStrength = this.motionStrength),
            (n.motionBlurSamples = this.motionBlurSamples),
            (this.motionBlurPostProcess = n);
        } else {
          this.motionBlurPostProcess = new vr(
            "HDRMotionBlur",
            "standard",
            [
              "inverseViewProjection",
              "prevViewProjection",
              "screenSize",
              "motionScale",
              "motionStrength",
            ],
            ["depthSampler"],
            t,
            null,
            mn.BILINEAR_SAMPLINGMODE,
            e.getEngine(),
            !1,
            "#define MOTION_BLUR\n#define MAX_MOTION_SAMPLES " +
              this.motionBlurSamples.toFixed(1),
            0
          );
          var r = 0,
            o = g.Identity(),
            s = g.Identity(),
            a = g.Identity(),
            l = p.Zero();
          this.motionBlurPostProcess.onApply = function (t) {
            (a = e
              .getProjectionMatrix()
              .multiply(e.getViewMatrix())).invertToRef(s),
              t.setMatrix("inverseViewProjection", s),
              t.setMatrix("prevViewProjection", o),
              (o = a),
              (l.x = i.motionBlurPostProcess.width),
              (l.y = i.motionBlurPostProcess.height),
              t.setVector2("screenSize", l),
              (r = e.getEngine().getFps() / 60),
              t.setFloat("motionScale", r),
              t.setFloat("motionStrength", i.motionStrength),
              t.setTexture("depthSampler", i._getDepthTexture());
          };
        }
        this.addEffect(
          new $h(
            e.getEngine(),
            "HDRMotionBlur",
            function () {
              return i.motionBlurPostProcess;
            },
            !0
          )
        );
      }),
      (t.prototype._getDepthTexture = function () {
        return this._scene.getEngine().getCaps().drawBuffersExtension
          ? this._scene.enableGeometryBufferRenderer().getGBuffer().textures[0]
          : this._scene.enableDepthRenderer().getDepthMap();
      }),
      (t.prototype._disposePostProcesses = function () {
        for (var e = 0; e < this._cameras.length; e++) {
          var t = this._cameras[e];
          this.originalPostProcess && this.originalPostProcess.dispose(t),
            this.screenSpaceReflectionPostProcess &&
              this.screenSpaceReflectionPostProcess.dispose(t),
            this.downSampleX4PostProcess &&
              this.downSampleX4PostProcess.dispose(t),
            this.brightPassPostProcess && this.brightPassPostProcess.dispose(t),
            this.textureAdderPostProcess &&
              this.textureAdderPostProcess.dispose(t),
            this.volumetricLightPostProcess &&
              this.volumetricLightPostProcess.dispose(t),
            this.volumetricLightSmoothXPostProcess &&
              this.volumetricLightSmoothXPostProcess.dispose(t),
            this.volumetricLightSmoothYPostProcess &&
              this.volumetricLightSmoothYPostProcess.dispose(t),
            this.volumetricLightMergePostProces &&
              this.volumetricLightMergePostProces.dispose(t),
            this.volumetricLightFinalPostProcess &&
              this.volumetricLightFinalPostProcess.dispose(t),
            this.lensFlarePostProcess && this.lensFlarePostProcess.dispose(t),
            this.lensFlareComposePostProcess &&
              this.lensFlareComposePostProcess.dispose(t);
          for (var i = 0; i < this.luminanceDownSamplePostProcesses.length; i++)
            this.luminanceDownSamplePostProcesses[i].dispose(t);
          for (
            this.luminancePostProcess && this.luminancePostProcess.dispose(t),
              this.hdrPostProcess && this.hdrPostProcess.dispose(t),
              this.hdrFinalPostProcess && this.hdrFinalPostProcess.dispose(t),
              this.depthOfFieldPostProcess &&
                this.depthOfFieldPostProcess.dispose(t),
              this.motionBlurPostProcess &&
                this.motionBlurPostProcess.dispose(t),
              this.fxaaPostProcess && this.fxaaPostProcess.dispose(t),
              i = 0;
            i < this.blurHPostProcesses.length;
            i++
          )
            this.blurHPostProcesses[i].dispose(t);
          for (i = 0; i < this.blurVPostProcesses.length; i++)
            this.blurVPostProcesses[i].dispose(t);
        }
        (this.originalPostProcess = null),
          (this.downSampleX4PostProcess = null),
          (this.brightPassPostProcess = null),
          (this.textureAdderPostProcess = null),
          (this.textureAdderFinalPostProcess = null),
          (this.volumetricLightPostProcess = null),
          (this.volumetricLightSmoothXPostProcess = null),
          (this.volumetricLightSmoothYPostProcess = null),
          (this.volumetricLightMergePostProces = null),
          (this.volumetricLightFinalPostProcess = null),
          (this.lensFlarePostProcess = null),
          (this.lensFlareComposePostProcess = null),
          (this.luminancePostProcess = null),
          (this.hdrPostProcess = null),
          (this.hdrFinalPostProcess = null),
          (this.depthOfFieldPostProcess = null),
          (this.motionBlurPostProcess = null),
          (this.fxaaPostProcess = null),
          (this.screenSpaceReflectionPostProcess = null),
          (this.luminanceDownSamplePostProcesses = []),
          (this.blurHPostProcesses = []),
          (this.blurVPostProcesses = []);
      }),
      (t.prototype.dispose = function () {
        this._disposePostProcesses(),
          this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(
            this._name,
            this._cameras
          ),
          e.prototype.dispose.call(this);
      }),
      (t.prototype.serialize = function () {
        var e = ge.Serialize(this);
        return (
          this.sourceLight && (e.sourceLightId = this.sourceLight.id),
          this.screenSpaceReflectionPostProcess &&
            (e.screenSpaceReflectionPostProcess = ge.Serialize(
              this.screenSpaceReflectionPostProcess
            )),
          (e.customType = "StandardRenderingPipeline"),
          e
        );
      }),
      (t.Parse = function (e, i, n) {
        var r = ge.Parse(
          function () {
            return new t(e._name, i, e._ratio);
          },
          e,
          i,
          n
        );
        return (
          e.sourceLightId && (r.sourceLight = i.getLightByID(e.sourceLightId)),
          e.screenSpaceReflectionPostProcess &&
            ge.Parse(
              function () {
                return r.screenSpaceReflectionPostProcess;
              },
              e.screenSpaceReflectionPostProcess,
              i,
              n
            ),
          r
        );
      }),
      (t.LuminanceSteps = 6),
      R([se()], t.prototype, "brightThreshold", void 0),
      R([se()], t.prototype, "blurWidth", void 0),
      R([se()], t.prototype, "horizontalBlur", void 0),
      R([se()], t.prototype, "exposure", null),
      R([ae("lensTexture")], t.prototype, "lensTexture", void 0),
      R([se()], t.prototype, "volumetricLightCoefficient", void 0),
      R([se()], t.prototype, "volumetricLightPower", void 0),
      R([se()], t.prototype, "volumetricLightBlurScale", void 0),
      R([se()], t.prototype, "hdrMinimumLuminance", void 0),
      R([se()], t.prototype, "hdrDecreaseRate", void 0),
      R([se()], t.prototype, "hdrIncreaseRate", void 0),
      R([se()], t.prototype, "hdrAutoExposure", null),
      R([ae("lensColorTexture")], t.prototype, "lensColorTexture", void 0),
      R([se()], t.prototype, "lensFlareStrength", void 0),
      R([se()], t.prototype, "lensFlareGhostDispersal", void 0),
      R([se()], t.prototype, "lensFlareHaloWidth", void 0),
      R([se()], t.prototype, "lensFlareDistortionStrength", void 0),
      R([se()], t.prototype, "lensFlareBlurWidth", void 0),
      R([ae("lensStarTexture")], t.prototype, "lensStarTexture", void 0),
      R(
        [ae("lensFlareDirtTexture")],
        t.prototype,
        "lensFlareDirtTexture",
        void 0
      ),
      R([se()], t.prototype, "depthOfFieldDistance", void 0),
      R([se()], t.prototype, "depthOfFieldBlurWidth", void 0),
      R([se()], t.prototype, "motionStrength", null),
      R([se()], t.prototype, "objectBasedMotionBlur", null),
      R([se()], t.prototype, "_ratio", void 0),
      R([se()], t.prototype, "BloomEnabled", null),
      R([se()], t.prototype, "DepthOfFieldEnabled", null),
      R([se()], t.prototype, "LensFlareEnabled", null),
      R([se()], t.prototype, "HDREnabled", null),
      R([se()], t.prototype, "VLSEnabled", null),
      R([se()], t.prototype, "MotionBlurEnabled", null),
      R([se()], t.prototype, "fxaaEnabled", null),
      R([se()], t.prototype, "screenSpaceReflectionsEnabled", null),
      R([se()], t.prototype, "volumetricLightStepsCount", null),
      R([se()], t.prototype, "motionBlurSamples", null),
      R([se()], t.prototype, "samples", null),
      t
    );
  })(Td);
  h.RegisteredTypes["BABYLON.StandardRenderingPipeline"] = Md;
  (Ke.ShadersStore.stereoscopicInterlacePixelShader =
    "const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamA;\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\nuseCamA=!useCamB;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\n#ifdef IS_STEREOSCOPIC_INTERLACED\nfloat rowNum=floor(vUV.y/stepSize.y);\nuseCamA=mod(rowNum,2.0) == 1.0;\nuseCamB=mod(rowNum,2.0) == 0.0;\ntexCoord1=vec2(vUV.x,vUV.y);\ntexCoord2=vec2(vUV.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\nuseCamA=!useCamB;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else if (useCamA){\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}else {\ndiscard;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}\n"),
    (function (e) {
      function t(t, i, n, r, o, s, a) {
        var l =
          e.call(
            this,
            t,
            "stereoscopicInterlace",
            ["stepSize"],
            ["camASampler"],
            1,
            i[1],
            o,
            s,
            a,
            r
              ? "#define IS_STEREOSCOPIC_INTERLACED 1"
              : n
                ? "#define IS_STEREOSCOPIC_HORIZ 1"
                : void 0
          ) || this;
        return (
          (l._passedProcess = i[0]._rigPostProcess),
          (l._stepSize = new p(1 / l.width, 1 / l.height)),
          l.onSizeChangedObservable.add(function () {
            l._stepSize = new p(1 / l.width, 1 / l.height);
          }),
          l.onApplyObservable.add(function (e) {
            e.setTextureFromPostProcess("camASampler", l._passedProcess),
              e.setFloat2("stepSize", l._stepSize.x, l._stepSize.y);
          }),
          l
        );
      }
      P(t, e),
        (t.prototype.getClassName = function () {
          return "StereoscopicInterlacePostProcessI";
        });
    })(vr),
    (function (e) {
      function t(t, i, n, r, o, s) {
        var a =
          e.call(
            this,
            t,
            "stereoscopicInterlace",
            ["stepSize"],
            ["camASampler"],
            1,
            i[1],
            r,
            o,
            s,
            n ? "#define IS_STEREOSCOPIC_HORIZ 1" : void 0
          ) || this;
        return (
          (a._passedProcess = i[0]._rigPostProcess),
          (a._stepSize = new p(1 / a.width, 1 / a.height)),
          a.onSizeChangedObservable.add(function () {
            a._stepSize = new p(1 / a.width, 1 / a.height);
          }),
          a.onApplyObservable.add(function (e) {
            e.setTextureFromPostProcess("camASampler", a._passedProcess),
              e.setFloat2("stepSize", a._stepSize.x, a._stepSize.y);
          }),
          a
        );
      }
      P(t, e),
        (t.prototype.getClassName = function () {
          return "StereoscopicInterlacePostProcess";
        });
    })(vr);
  var Od;
  (Ke.ShadersStore.tonemapPixelShader =
    "\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void)\n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb);\nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm);\ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}"),
    (function (e) {
      (e[(e.Hable = 0)] = "Hable"),
        (e[(e.Reinhard = 1)] = "Reinhard"),
        (e[(e.HejiDawson = 2)] = "HejiDawson"),
        (e[(e.Photographic = 3)] = "Photographic");
    })(Od || (Od = {})),
    (function (e) {
      function t(t, i, n, r, o, s, a) {
        void 0 === o && (o = 2), void 0 === a && (a = 0);
        var l =
          e.call(
            this,
            t,
            "tonemap",
            ["_ExposureAdjustment"],
            null,
            1,
            r,
            o,
            s,
            !0,
            null,
            a
          ) || this;
        (l._operator = i), (l.exposureAdjustment = n);
        var c = "#define ";
        return (
          l._operator === Od.Hable
            ? (c += "HABLE_TONEMAPPING")
            : l._operator === Od.Reinhard
              ? (c += "REINHARD_TONEMAPPING")
              : l._operator === Od.HejiDawson
                ? (c += "OPTIMIZED_HEJIDAWSON_TONEMAPPING")
                : l._operator === Od.Photographic &&
                  (c += "PHOTOGRAPHIC_TONEMAPPING"),
          l.updateEffect(c),
          (l.onApply = function (e) {
            e.setFloat("_ExposureAdjustment", l.exposureAdjustment);
          }),
          l
        );
      }
      P(t, e),
        (t.prototype.getClassName = function () {
          return "TonemapPostProcess";
        });
    })(vr);
  Ke.ShadersStore.volumetricLightScatteringPixelShader =
    "uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 dataSample=texture2D(lightScatteringSampler,tc)*0.4;\ndataSample*=illuminationDecay*weight;\ncolor+=dataSample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n";
  Ke.ShadersStore.volumetricLightScatteringPassVertexShader =
    "\nattribute vec3 position;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#if (defined(ALPHATEST) || defined(NEED_UV)) && defined(UV1)\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(positionUpdated,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}\n";
  Ke.ShadersStore.volumetricLightScatteringPassPixelShader =
    "#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n";
  var Id = (function (e) {
    function t(i, n, r, o, s, a, l, c, u) {
      void 0 === s && (s = 100), void 0 === a && (a = mn.BILINEAR_SAMPLINGMODE);
      var h =
        e.call(
          this,
          i,
          "volumetricLightScattering",
          ["decay", "exposure", "weight", "meshPositionOnScreen", "density"],
          ["lightScatteringSampler"],
          n.postProcessRatio || n,
          r,
          a,
          l,
          c,
          "#define NUM_SAMPLES " + s
        ) || this;
      return (
        (h._screenCoordinates = p.Zero()),
        (h.customMeshPosition = f.Zero()),
        (h.useCustomMeshPosition = !1),
        (h.invert = !0),
        (h.excludedMeshes = new Array()),
        (h.exposure = 0.3),
        (h.decay = 0.96815),
        (h.weight = 0.58767),
        (h.density = 0.926),
        (l = (u = null === r ? u : r.getScene()).getEngine()),
        (h._viewPort = new Kt(0, 0, 1, 1).toGlobal(
          l.getRenderWidth(),
          l.getRenderHeight()
        )),
        (h.mesh =
          null !== o
            ? o
            : t.CreateDefaultMesh("VolumetricLightScatteringMesh", u)),
        h._createPass(u, n.passRatio || n),
        (h.onActivate = function (e) {
          h.isSupported || h.dispose(e), (h.onActivate = null);
        }),
        h.onApplyObservable.add(function (e) {
          h._updateMeshScreenCoordinates(u),
            e.setTexture(
              "lightScatteringSampler",
              h._volumetricLightScatteringRTT
            ),
            e.setFloat("exposure", h.exposure),
            e.setFloat("decay", h.decay),
            e.setFloat("weight", h.weight),
            e.setFloat("density", h.density),
            e.setVector2("meshPositionOnScreen", h._screenCoordinates);
        }),
        h
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "useDiffuseColor", {
        get: function () {
          return (
            F.Warn(
              "VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"
            ),
            !1
          );
        },
        set: function (e) {
          F.Warn(
            "VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"
          );
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.getClassName = function () {
        return "VolumetricLightScatteringPostProcess";
      }),
      (t.prototype._isReady = function (e, t) {
        var i = e.getMesh();
        if (i === this.mesh && i.material) return i.material.isReady(i);
        var n = [],
          r = [wt.PositionKind],
          o = e.getMaterial();
        o &&
          (o.needAlphaTesting() && n.push("#define ALPHATEST"),
          i.isVerticesDataPresent(wt.UVKind) &&
            (r.push(wt.UVKind), n.push("#define UV1")),
          i.isVerticesDataPresent(wt.UV2Kind) &&
            (r.push(wt.UV2Kind), n.push("#define UV2"))),
          i.useBones && i.computeBonesUsingShaders
            ? (r.push(wt.MatricesIndicesKind),
              r.push(wt.MatricesWeightsKind),
              n.push("#define NUM_BONE_INFLUENCERS " + i.numBoneInfluencers),
              n.push(
                "#define BonesPerMesh " +
                  (i.skeleton ? i.skeleton.bones.length + 1 : 0)
              ))
            : n.push("#define NUM_BONE_INFLUENCERS 0"),
          t &&
            (n.push("#define INSTANCES"),
            Hr.PushAttributesForInstances(r),
            e.getRenderingMesh().hasThinInstances &&
              n.push("#define THIN_INSTANCES"));
        var s = n.join("\n");
        return (
          this._cachedDefines !== s &&
            ((this._cachedDefines = s),
            (this._volumetricLightScatteringPass = i
              .getScene()
              .getEngine()
              .createEffect(
                "volumetricLightScatteringPass",
                r,
                ["world", "mBones", "viewProjection", "diffuseMatrix"],
                ["diffuseSampler"],
                s,
                void 0,
                void 0,
                void 0,
                {
                  maxSimultaneousMorphTargets: i.numBoneInfluencers,
                }
              ))),
          this._volumetricLightScatteringPass.isReady()
        );
      }),
      (t.prototype.setCustomMeshPosition = function (e) {
        this.customMeshPosition = e;
      }),
      (t.prototype.getCustomMeshPosition = function () {
        return this.customMeshPosition;
      }),
      (t.prototype.dispose = function (t) {
        var i = t
          .getScene()
          .customRenderTargets.indexOf(this._volumetricLightScatteringRTT);
        -1 !== i && t.getScene().customRenderTargets.splice(i, 1),
          this._volumetricLightScatteringRTT.dispose(),
          e.prototype.dispose.call(this, t);
      }),
      (t.prototype.getPass = function () {
        return this._volumetricLightScatteringRTT;
      }),
      (t.prototype._meshExcluded = function (e) {
        return (
          this.excludedMeshes.length > 0 &&
          -1 !== this.excludedMeshes.indexOf(e)
        );
      }),
      (t.prototype._createPass = function (e, t) {
        var i = this,
          n = e.getEngine();
        (this._volumetricLightScatteringRTT = new Dr(
          "volumetricLightScatteringMap",
          {
            width: n.getRenderWidth() * t,
            height: n.getRenderHeight() * t,
          },
          e,
          !1,
          !0,
          0
        )),
          (this._volumetricLightScatteringRTT.wrapU = mn.CLAMP_ADDRESSMODE),
          (this._volumetricLightScatteringRTT.wrapV = mn.CLAMP_ADDRESSMODE),
          (this._volumetricLightScatteringRTT.renderList = null),
          (this._volumetricLightScatteringRTT.renderParticles = !1),
          (this._volumetricLightScatteringRTT.ignoreCameraViewport = !0);
        var r = this.getCamera();
        r
          ? r.customRenderTargets.push(this._volumetricLightScatteringRTT)
          : e.customRenderTargets.push(this._volumetricLightScatteringRTT);
        var o,
          s = function (e) {
            var t = e.getRenderingMesh(),
              n = e.getEffectiveMesh();
            if (!i._meshExcluded(t)) {
              n._internalAbstractMeshDataInfo._isActiveIntermediate = !1;
              var r = e.getMaterial();
              if (r) {
                var o = t.getScene(),
                  s = o.getEngine();
                s.setState(r.backFaceCulling);
                var a = t._getInstancesRenderList(
                  e._id,
                  !!e.getReplacementMesh()
                );
                if (!a.mustReturn) {
                  var l =
                    s.getCaps().instancedArrays &&
                    (null !== a.visibleInstances[e._id] || t.hasThinInstances);
                  if (i._isReady(e, l)) {
                    var c = i._volumetricLightScatteringPass;
                    if (
                      (t === i.mesh &&
                        (c = e.effect ? e.effect : r.getEffect()),
                      s.enableEffect(c),
                      t._bind(e, c, r.fillMode),
                      t === i.mesh)
                    )
                      r.bind(n.getWorldMatrix(), t);
                    else {
                      if (
                        (i._volumetricLightScatteringPass.setMatrix(
                          "viewProjection",
                          o.getTransformMatrix()
                        ),
                        r && r.needAlphaTesting())
                      ) {
                        var u = r.getAlphaTestTexture();
                        i._volumetricLightScatteringPass.setTexture(
                          "diffuseSampler",
                          u
                        ),
                          u &&
                            i._volumetricLightScatteringPass.setMatrix(
                              "diffuseMatrix",
                              u.getTextureMatrix()
                            );
                      }
                      t.useBones &&
                        t.computeBonesUsingShaders &&
                        t.skeleton &&
                        i._volumetricLightScatteringPass.setMatrices(
                          "mBones",
                          t.skeleton.getTransformMatrices(t)
                        );
                    }
                    t._processRendering(
                      n,
                      e,
                      i._volumetricLightScatteringPass,
                      si.TriangleFillMode,
                      a,
                      l,
                      function (e, t) {
                        return c.setMatrix("world", t);
                      }
                    );
                  }
                }
              }
            }
          },
          a = new T(0, 0, 0, 1);
        this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(
          function () {
            (o = e.clearColor), (e.clearColor = a);
          }
        ),
          this._volumetricLightScatteringRTT.onAfterRenderObservable.add(
            function () {
              e.clearColor = o;
            }
          ),
          (this._volumetricLightScatteringRTT.customRenderFunction = function (
            t,
            i,
            n,
            r
          ) {
            var o,
              a = e.getEngine();
            if (r.length) {
              for (a.setColorWrite(!1), o = 0; o < r.length; o++) s(r.data[o]);
              a.setColorWrite(!0);
            }
            for (o = 0; o < t.length; o++) s(t.data[o]);
            for (o = 0; o < i.length; o++) s(i.data[o]);
            if (n.length) {
              for (o = 0; o < n.length; o++) {
                var l = n.data[o],
                  c = l.getBoundingInfo();
                c &&
                  e.activeCamera &&
                  ((l._alphaIndex = l.getMesh().alphaIndex),
                  (l._distanceToCamera = c.boundingSphere.centerWorld
                    .subtract(e.activeCamera.position)
                    .length()));
              }
              var u = n.data.slice(0, n.length);
              for (
                u.sort(function (e, t) {
                  return e._alphaIndex > t._alphaIndex
                    ? 1
                    : e._alphaIndex < t._alphaIndex
                      ? -1
                      : e._distanceToCamera < t._distanceToCamera
                        ? 1
                        : e._distanceToCamera > t._distanceToCamera
                          ? -1
                          : 0;
                }),
                  a.setAlphaMode(2),
                  o = 0;
                o < u.length;
                o++
              )
                s(u[o]);
              a.setAlphaMode(0);
            }
          });
      }),
      (t.prototype._updateMeshScreenCoordinates = function (e) {
        var t,
          i = e.getTransformMatrix();
        t = this.useCustomMeshPosition
          ? this.customMeshPosition
          : this.attachedNode
            ? this.attachedNode.position
            : this.mesh.parent
              ? this.mesh.getAbsolutePosition()
              : this.mesh.position;
        var n = f.Project(t, g.Identity(), i, this._viewPort);
        (this._screenCoordinates.x = n.x / this._viewPort.width),
          (this._screenCoordinates.y = n.y / this._viewPort.height),
          this.invert &&
            (this._screenCoordinates.y = 1 - this._screenCoordinates.y);
      }),
      (t.CreateDefaultMesh = function (e, t) {
        var i = Qi.CreatePlane(e, 1, t);
        i.billboardMode = Yt.BILLBOARDMODE_ALL;
        var n = new qr(e + "Material", t);
        return (n.emissiveColor = new b(1, 1, 1)), (i.material = n), i;
      }),
      R([he()], t.prototype, "customMeshPosition", void 0),
      R([se()], t.prototype, "useCustomMeshPosition", void 0),
      R([se()], t.prototype, "invert", void 0),
      R([de()], t.prototype, "mesh", void 0),
      R([se()], t.prototype, "excludedMeshes", void 0),
      R([se()], t.prototype, "exposure", void 0),
      R([se()], t.prototype, "decay", void 0),
      R([se()], t.prototype, "weight", void 0),
      R([se()], t.prototype, "density", void 0),
      t
    );
  })(vr);
  h.RegisteredTypes["BABYLON.VolumetricLightScatteringPostProcess"] = Id;
  Ke.ShadersStore.screenSpaceCurvaturePixelShader =
    "\n\nprecision highp float;\n\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D normalSampler;\nuniform float curvature_ridge;\nuniform float curvature_valley;\n#ifndef CURVATURE_OFFSET\n#define CURVATURE_OFFSET 1\n#endif\nfloat curvature_soft_clamp(float curvature,float control)\n{\nif (curvature<0.5/control)\nreturn curvature*(1.0-curvature*control);\nreturn 0.25/control;\n}\nfloat calculate_curvature(ivec2 texel,float ridge,float valley)\n{\nvec2 normal_up=texelFetchOffset(normalSampler,texel,0,ivec2(0,CURVATURE_OFFSET)).rb;\nvec2 normal_down=texelFetchOffset(normalSampler,texel,0,ivec2(0,-CURVATURE_OFFSET)).rb;\nvec2 normal_left=texelFetchOffset(normalSampler,texel,0,ivec2(-CURVATURE_OFFSET,0)).rb;\nvec2 normal_right=texelFetchOffset(normalSampler,texel,0,ivec2( CURVATURE_OFFSET,0)).rb;\nfloat normal_diff=((normal_up.g-normal_down.g)+(normal_right.r-normal_left.r));\nif (normal_diff<0.0)\nreturn -2.0*curvature_soft_clamp(-normal_diff,valley);\nreturn 2.0*curvature_soft_clamp(normal_diff,ridge);\n}\nvoid main(void)\n{\nivec2 texel=ivec2(gl_FragCoord.xy);\nvec4 baseColor=texture2D(textureSampler,vUV);\nfloat curvature=calculate_curvature(texel,curvature_ridge,curvature_valley);\nbaseColor.rgb*=curvature+1.0;\ngl_FragColor=baseColor;\n}";
  var Dd = (function (e) {
    function t(t, i, n, r, o, s, a, l, c) {
      void 0 === l && (l = 0), void 0 === c && (c = !1);
      var u =
        e.call(
          this,
          t,
          "screenSpaceCurvature",
          ["curvature_ridge", "curvature_valley"],
          ["textureSampler", "normalSampler"],
          n,
          r,
          o,
          s,
          a,
          void 0,
          l,
          void 0,
          null,
          c
        ) || this;
      return (
        (u.ridge = 1),
        (u.valley = 1),
        (u._geometryBufferRenderer = i.enableGeometryBufferRenderer()),
        u._geometryBufferRenderer
          ? (u.onApply = function (e) {
              e.setFloat(
                "curvature_ridge",
                0.5 / Math.max(u.ridge * u.ridge, 1e-4)
              ),
                e.setFloat(
                  "curvature_valley",
                  0.7 / Math.max(u.valley * u.valley, 1e-4)
                );
              var t = u._geometryBufferRenderer.getGBuffer().textures[1];
              e.setTexture("normalSampler", t);
            })
          : F.Error(
              "Multiple Render Target support needed for screen space curvature post process. Please use IsSupported test first."
            ),
        u
      );
    }
    return (
      P(t, e),
      (t.prototype.getClassName = function () {
        return "ScreenSpaceCurvaturePostProcess";
      }),
      Object.defineProperty(t, "IsSupported", {
        get: function () {
          var e = j.LastCreatedEngine;
          return (
            !!e && (e.webGLVersion > 1 || e.getCaps().drawBuffersExtension)
          );
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t._Parse = function (e, i, n, r) {
        return ge.Parse(
          function () {
            return new t(
              e.name,
              n,
              e.options,
              i,
              e.renderTargetSamplingMode,
              n.getEngine(),
              e.textureType,
              e.reusable
            );
          },
          e,
          n,
          r
        );
      }),
      R([se()], t.prototype, "ridge", void 0),
      R([se()], t.prototype, "valley", void 0),
      t
    );
  })(vr);
  (h.RegisteredTypes["BABYLON.ScreenSpaceCurvaturePostProcess"] = Dd),
    Object.defineProperty(Ci.prototype, "forceShowBoundingBoxes", {
      get: function () {
        return this._forceShowBoundingBoxes || !1;
      },
      set: function (e) {
        (this._forceShowBoundingBoxes = e), e && this.getBoundingBoxRenderer();
      },
      enumerable: !0,
      configurable: !0,
    }),
    (Ci.prototype.getBoundingBoxRenderer = function () {
      return (
        this._boundingBoxRenderer || (this._boundingBoxRenderer = new wd(this)),
        this._boundingBoxRenderer
      );
    }),
    Object.defineProperty(Yt.prototype, "showBoundingBox", {
      get: function () {
        return this._showBoundingBox || !1;
      },
      set: function (e) {
        (this._showBoundingBox = e),
          e && this.getScene().getBoundingBoxRenderer();
      },
      enumerable: !0,
      configurable: !0,
    });
  var wd = (function () {
    function e(e) {
      (this.name = hi.NAME_BOUNDINGBOXRENDERER),
        (this.frontColor = new b(1, 1, 1)),
        (this.backColor = new b(0.1, 0.1, 0.1)),
        (this.showBackLines = !0),
        (this.onBeforeBoxRenderingObservable = new o()),
        (this.onAfterBoxRenderingObservable = new o()),
        (this.onResourcesReadyObservable = new o()),
        (this.enabled = !0),
        (this.renderList = new St(32)),
        (this._vertexBuffers = {}),
        (this._fillIndexBuffer = null),
        (this._fillIndexData = null),
        (this.scene = e),
        e._addComponent(this);
    }
    return (
      (e.prototype.register = function () {
        this.scene._beforeEvaluateActiveMeshStage.registerStep(
          hi.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,
          this,
          this.reset
        ),
          this.scene._preActiveMeshStage.registerStep(
            hi.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER,
            this,
            this._preActiveMesh
          ),
          this.scene._evaluateSubMeshStage.registerStep(
            hi.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,
            this,
            this._evaluateSubMesh
          ),
          this.scene._afterRenderingGroupDrawStage.registerStep(
            hi.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,
            this,
            this.render
          );
      }),
      (e.prototype._evaluateSubMesh = function (e, t) {
        if (e.showSubMeshesBoundingBox) {
          var i = t.getBoundingInfo();
          null != i &&
            ((i.boundingBox._tag = e.renderingGroupId),
            this.renderList.push(i.boundingBox));
        }
      }),
      (e.prototype._preActiveMesh = function (e) {
        if (e.showBoundingBox || this.scene.forceShowBoundingBoxes) {
          var t = e.getBoundingInfo();
          (t.boundingBox._tag = e.renderingGroupId),
            this.renderList.push(t.boundingBox);
        }
      }),
      (e.prototype._prepareResources = function () {
        if (!this._colorShader) {
          (this._colorShader = new Do("colorShader", this.scene, "color", {
            attributes: [wt.PositionKind],
            uniforms: ["world", "viewProjection", "color"],
          })),
            (this._colorShader.reservedDataStore = {
              hidden: !0,
            });
          var e = this.scene.getEngine(),
            t = Nt.CreateBox({
              size: 1,
            });
          (this._vertexBuffers[wt.PositionKind] = new wt(
            e,
            t.positions,
            wt.PositionKind,
            !1
          )),
            this._createIndexBuffer(),
            (this._fillIndexData = t.indices),
            this.onResourcesReadyObservable.notifyObservers(this);
        }
      }),
      (e.prototype._createIndexBuffer = function () {
        var e = this.scene.getEngine();
        this._indexBuffer = e.createIndexBuffer([
          0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 7, 1, 6, 2, 5, 3,
          4,
        ]);
      }),
      (e.prototype.rebuild = function () {
        var e = this._vertexBuffers[wt.PositionKind];
        e && e._rebuild(), this._createIndexBuffer();
      }),
      (e.prototype.reset = function () {
        this.renderList.reset();
      }),
      (e.prototype.render = function (e) {
        if (
          0 !== this.renderList.length &&
          this.enabled &&
          (this._prepareResources(), this._colorShader.isReady())
        ) {
          var t = this.scene.getEngine();
          t.setDepthWrite(!1), this._colorShader._preBind();
          for (var i = 0; i < this.renderList.length; i++) {
            var n = this.renderList.data[i];
            if (n._tag === e) {
              this.onBeforeBoxRenderingObservable.notifyObservers(n);
              var r = n.minimum,
                o = n.maximum.subtract(r),
                s = r.add(o.scale(0.5)),
                a = g
                  .Scaling(o.x, o.y, o.z)
                  .multiply(g.Translation(s.x, s.y, s.z))
                  .multiply(n.getWorldMatrix());
              t.bindBuffers(
                this._vertexBuffers,
                this._indexBuffer,
                this._colorShader.getEffect()
              ),
                this.showBackLines &&
                  (t.setDepthFunctionToGreaterOrEqual(),
                  this.scene.resetCachedMaterial(),
                  this._colorShader.setColor4(
                    "color",
                    this.backColor.toColor4()
                  ),
                  this._colorShader.bind(a),
                  t.drawElementsType(si.LineListDrawMode, 0, 24)),
                t.setDepthFunctionToLess(),
                this.scene.resetCachedMaterial(),
                this._colorShader.setColor4(
                  "color",
                  this.frontColor.toColor4()
                ),
                this._colorShader.bind(a),
                t.drawElementsType(si.LineListDrawMode, 0, 24),
                this.onAfterBoxRenderingObservable.notifyObservers(n);
            }
          }
          this._colorShader.unbind(),
            t.setDepthFunctionToLessOrEqual(),
            t.setDepthWrite(!0);
        }
      }),
      (e.prototype.renderOcclusionBoundingBox = function (e) {
        if (
          (this._prepareResources(),
          this._colorShader.isReady() && e._boundingInfo)
        ) {
          var t = this.scene.getEngine();
          this._fillIndexBuffer ||
            (this._fillIndexBuffer = t.createIndexBuffer(this._fillIndexData)),
            t.setDepthWrite(!1),
            t.setColorWrite(!1),
            this._colorShader._preBind();
          var i = e._boundingInfo.boundingBox,
            n = i.minimum,
            r = i.maximum.subtract(n),
            o = n.add(r.scale(0.5)),
            s = g
              .Scaling(r.x, r.y, r.z)
              .multiply(g.Translation(o.x, o.y, o.z))
              .multiply(i.getWorldMatrix());
          t.bindBuffers(
            this._vertexBuffers,
            this._fillIndexBuffer,
            this._colorShader.getEffect()
          ),
            t.setDepthFunctionToLess(),
            this.scene.resetCachedMaterial(),
            this._colorShader.bind(s),
            t.drawElementsType(si.TriangleFillMode, 0, 36),
            this._colorShader.unbind(),
            t.setDepthFunctionToLessOrEqual(),
            t.setDepthWrite(!0),
            t.setColorWrite(!0);
        }
      }),
      (e.prototype.dispose = function () {
        if (this._colorShader) {
          this.onBeforeBoxRenderingObservable.clear(),
            this.onAfterBoxRenderingObservable.clear(),
            this.onResourcesReadyObservable.clear(),
            this.renderList.dispose(),
            this._colorShader.dispose();
          var e = this._vertexBuffers[wt.PositionKind];
          e && (e.dispose(), (this._vertexBuffers[wt.PositionKind] = null)),
            this.scene.getEngine()._releaseBuffer(this._indexBuffer),
            this._fillIndexBuffer &&
              (this.scene.getEngine()._releaseBuffer(this._fillIndexBuffer),
              (this._fillIndexBuffer = null));
        }
      }),
      e
    );
  })();
  (Ci.prototype.enableDepthRenderer = function (e, t, i) {
    if (
      (void 0 === t && (t = !1),
      void 0 === i && (i = !1),
      !(e = e || this.activeCamera))
    )
      throw "No camera available to enable depth renderer";
    if (
      (this._depthRenderer || (this._depthRenderer = {}),
      !this._depthRenderer[e.id])
    ) {
      var n,
        r = !!this.getEngine().getCaps().textureFloatRender;
      (n =
        !this.getEngine().getCaps().textureHalfFloatRender || (i && r)
          ? r
            ? 1
            : 0
          : 2),
        (this._depthRenderer[e.id] = new Qa(this, n, e, t));
    }
    return this._depthRenderer[e.id];
  }),
    (Ci.prototype.disableDepthRenderer = function (e) {
      (e = e || this.activeCamera) &&
        this._depthRenderer &&
        this._depthRenderer[e.id] &&
        (this._depthRenderer[e.id].dispose(), delete this._depthRenderer[e.id]);
    });
  var Nd = (function () {
    function e(e) {
      (this.name = hi.NAME_DEPTHRENDERER), (this.scene = e);
    }
    return (
      (e.prototype.register = function () {
        this.scene._gatherRenderTargetsStage.registerStep(
          hi.STEP_GATHERRENDERTARGETS_DEPTHRENDERER,
          this,
          this._gatherRenderTargets
        ),
          this.scene._gatherActiveCameraRenderTargetsStage.registerStep(
            hi.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,
            this,
            this._gatherActiveCameraRenderTargets
          );
      }),
      (e.prototype.rebuild = function () {}),
      (e.prototype.dispose = function () {
        for (var e in this.scene._depthRenderer)
          this.scene._depthRenderer[e].dispose();
      }),
      (e.prototype._gatherRenderTargets = function (e) {
        if (this.scene._depthRenderer)
          for (var t in this.scene._depthRenderer) {
            var i = this.scene._depthRenderer[t];
            i.enabled && !i.useOnlyInActiveCamera && e.push(i.getDepthMap());
          }
      }),
      (e.prototype._gatherActiveCameraRenderTargets = function (e) {
        if (this.scene._depthRenderer)
          for (var t in this.scene._depthRenderer) {
            var i = this.scene._depthRenderer[t];
            i.enabled &&
              i.useOnlyInActiveCamera &&
              this.scene.activeCamera.id === t &&
              e.push(i.getDepthMap());
          }
      }),
      e
    );
  })();
  Qa._SceneComponentInitialization = function (e) {
    var t = e._getComponent(hi.NAME_DEPTHRENDERER);
    t || ((t = new Nd(e)), e._addComponent(t));
  };
  Ke.ShadersStore.linePixelShader =
    "uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}";
  (Ke.ShadersStore.lineVertexShader =
    "#include<instancesDeclaration>\n\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 viewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\n#include<instancesVertex>\nmat4 worldViewProjection=viewProjection*finalWorld;\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}"),
    (Yt.prototype.disableEdgesRendering = function () {
      return (
        this._edgesRenderer &&
          (this._edgesRenderer.dispose(), (this._edgesRenderer = null)),
        this
      );
    }),
    (Yt.prototype.enableEdgesRendering = function (e, t, i) {
      return (
        void 0 === e && (e = 0.95),
        void 0 === t && (t = !1),
        this.disableEdgesRendering(),
        (this._edgesRenderer = new Fd(this, e, t, !0, i)),
        this
      );
    }),
    Object.defineProperty(Yt.prototype, "edgesRenderer", {
      get: function () {
        return this._edgesRenderer;
      },
      enumerable: !0,
      configurable: !0,
    }),
    (wo.prototype.enableEdgesRendering = function (e, t) {
      return (
        void 0 === e && (e = 0.95),
        void 0 === t && (t = !1),
        this.disableEdgesRendering(),
        (this._edgesRenderer = new Bd(this, e, t)),
        this
      );
    }),
    (No.prototype.enableEdgesRendering = function (e, t) {
      return (
        void 0 === e && (e = 0.95),
        void 0 === t && (t = !1),
        wo.prototype.enableEdgesRendering.apply(this, arguments),
        this
      );
    });
  var Ld = function () {
      (this.edges = new Array()), (this.edgesConnectedCount = 0);
    },
    Fd = (function () {
      function e(e, t, i, n, r) {
        var o,
          s = this;
        void 0 === t && (t = 0.95),
          void 0 === i && (i = !1),
          void 0 === n && (n = !0),
          (this.edgesWidthScalerForOrthographic = 1e3),
          (this.edgesWidthScalerForPerspective = 50),
          (this._linesPositions = new Array()),
          (this._linesNormals = new Array()),
          (this._linesIndices = new Array()),
          (this._buffers = {}),
          (this._buffersForInstances = {}),
          (this._checkVerticesInsteadOfIndices = !1),
          (this.isEnabled = !0),
          (this.customInstances = new St(32)),
          (this._source = e),
          (this._checkVerticesInsteadOfIndices = i),
          (this._options = null != r ? r : null),
          (this._epsilon = t),
          this._prepareRessources(),
          n &&
            (null === (o = null == r ? void 0 : r.useAlternateEdgeFinder) ||
            void 0 === o ||
            o
              ? this._generateEdgesLinesAlternate()
              : this._generateEdgesLines()),
          (this._meshRebuildObserver = this._source.onRebuildObservable.add(
            function () {
              s._rebuild();
            }
          )),
          (this._meshDisposeObserver = this._source.onDisposeObservable.add(
            function () {
              s.dispose();
            }
          ));
      }
      return (
        Object.defineProperty(e.prototype, "linesPositions", {
          get: function () {
            return this._linesPositions;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "linesNormals", {
          get: function () {
            return this._linesNormals;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "linesIndices", {
          get: function () {
            return this._linesIndices;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.GetShader = function (e) {
          if (!e._edgeRenderLineShader) {
            var t = new Do("lineShader", e, "line", {
              attributes: ["position", "normal"],
              uniforms: [
                "world",
                "viewProjection",
                "color",
                "width",
                "aspectRatio",
              ],
            });
            (t.disableDepthWrite = !0),
              (t.backFaceCulling = !1),
              (e._edgeRenderLineShader = t);
          }
          return e._edgeRenderLineShader;
        }),
        (e.prototype._prepareRessources = function () {
          this._lineShader ||
            (this._lineShader = e.GetShader(this._source.getScene()));
        }),
        (e.prototype._rebuild = function () {
          var e = this._buffers[wt.PositionKind];
          e && e._rebuild(), (e = this._buffers[wt.NormalKind]) && e._rebuild();
          var t = this._source.getScene().getEngine();
          this._ib = t.createIndexBuffer(this._linesIndices);
        }),
        (e.prototype.dispose = function () {
          this._source.onRebuildObservable.remove(this._meshRebuildObserver),
            this._source.onDisposeObservable.remove(this._meshDisposeObserver);
          var e = this._buffers[wt.PositionKind];
          e && (e.dispose(), (this._buffers[wt.PositionKind] = null)),
            (e = this._buffers[wt.NormalKind]) &&
              (e.dispose(), (this._buffers[wt.NormalKind] = null)),
            this._ib &&
              this._source.getScene().getEngine()._releaseBuffer(this._ib),
            this._lineShader.dispose();
        }),
        (e.prototype._processEdgeForAdjacencies = function (e, t, i, n, r) {
          return (e === i && t === n) || (e === n && t === i)
            ? 0
            : (e === n && t === r) || (e === r && t === n)
              ? 1
              : (e === r && t === i) || (e === i && t === r)
                ? 2
                : -1;
        }),
        (e.prototype._processEdgeForAdjacenciesWithVertices = function (
          e,
          t,
          i,
          n,
          r
        ) {
          var o = 1e-10;
          return (e.equalsWithEpsilon(i, o) && t.equalsWithEpsilon(n, o)) ||
            (e.equalsWithEpsilon(n, o) && t.equalsWithEpsilon(i, o))
            ? 0
            : (e.equalsWithEpsilon(n, o) && t.equalsWithEpsilon(r, o)) ||
                (e.equalsWithEpsilon(r, o) && t.equalsWithEpsilon(n, o))
              ? 1
              : (e.equalsWithEpsilon(r, o) && t.equalsWithEpsilon(i, o)) ||
                  (e.equalsWithEpsilon(i, o) && t.equalsWithEpsilon(r, o))
                ? 2
                : -1;
        }),
        (e.prototype._checkEdge = function (e, t, i, n, r) {
          (void 0 === t || f.Dot(i[e], i[t]) < this._epsilon) &&
            this.createLine(n, r, this._linesPositions.length / 3);
        }),
        (e.prototype.createLine = function (e, t, i) {
          this._linesPositions.push(
            e.x,
            e.y,
            e.z,
            e.x,
            e.y,
            e.z,
            t.x,
            t.y,
            t.z,
            t.x,
            t.y,
            t.z
          ),
            this._linesNormals.push(
              t.x,
              t.y,
              t.z,
              -1,
              t.x,
              t.y,
              t.z,
              1,
              e.x,
              e.y,
              e.z,
              -1,
              e.x,
              e.y,
              e.z,
              1
            ),
            this._linesIndices.push(i, i + 1, i + 2, i, i + 2, i + 3);
        }),
        (e.prototype._tessellateTriangle = function (e, t, i, n) {
          var r = function (e, t, i) {
              i >= 0 && t.push(i);
              for (var n = 0; n < e.length; ++n) t.push(e[n][0]);
            },
            o = 0;
          e[1].length >= e[0].length && e[1].length >= e[2].length
            ? (o = 1)
            : e[2].length >= e[0].length &&
              e[2].length >= e[1].length &&
              (o = 2);
          for (var s = 0; s < 3; ++s)
            s === o
              ? e[s].sort(function (e, t) {
                  return e[1] < t[1] ? -1 : e[1] > t[1] ? 1 : 0;
                })
              : e[s].sort(function (e, t) {
                  return e[1] > t[1] ? -1 : e[1] < t[1] ? 1 : 0;
                });
          var a = [],
            l = [];
          r(e[o], a, -1);
          for (var c = a.length, u = o + 2; u >= o + 1; --u)
            r(e[u % 3], l, u !== o + 2 ? n[i[t + ((u + 1) % 3)]] : -1);
          var h = l.length;
          i.push(n[i[t + o]], a[0], l[0]),
            i.push(n[i[t + ((o + 1) % 3)]], l[h - 1], a[c - 1]);
          for (
            var d = c <= h,
              p = d ? c : h,
              f = d ? h : c,
              _ = d ? c - 1 : h - 1,
              m = d ? 0 : 1,
              g = c + h - 2,
              v = 0,
              y = 0,
              b = d ? a : l,
              T = d ? l : a,
              S = 0;
            g-- > 0;

          ) {
            m ? i.push(b[v], T[y]) : i.push(T[y], b[v]);
            var C = void 0;
            (S += p) >= f && v < _ ? ((C = b[++v]), (S -= f)) : (C = T[++y]),
              i.push(C);
          }
          (i[t + 0] = i[i.length - 3]),
            (i[t + 1] = i[i.length - 2]),
            (i[t + 2] = i[i.length - 1]),
            (i.length = i.length - 3);
        }),
        (e.prototype._generateEdgesLinesAlternate = function () {
          var e,
            t,
            i,
            n,
            r,
            o,
            s,
            a,
            l,
            c = this._source.getVerticesData(wt.PositionKind),
            u = this._source.getIndices();
          if (u && c) {
            Array.isArray(u) || (u = yt.SliceToArray(u));
            var h =
                null ===
                  (t =
                    null === (e = this._options) || void 0 === e
                      ? void 0
                      : e.useFastVertexMerger) ||
                void 0 === t ||
                t,
              d = h
                ? Math.round(
                    -Math.log(
                      null !==
                        (n =
                          null === (i = this._options) || void 0 === i
                            ? void 0
                            : i.epsilonVertexMerge) && void 0 !== n
                        ? n
                        : 1e-6
                    ) / Math.log(10)
                  )
                : null !==
                      (o =
                        null === (r = this._options) || void 0 === r
                          ? void 0
                          : r.epsilonVertexMerge) && void 0 !== o
                  ? o
                  : 1e-6,
              p = [],
              _ = [];
            if (h)
              for (var m = {}, g = 0; g < c.length; g += 3) {
                var v = c[g + 0],
                  b = c[g + 1],
                  T = c[g + 2];
                if (
                  void 0 !==
                  m[
                    (te =
                      v.toFixed(d) + "|" + b.toFixed(d) + "|" + T.toFixed(d))
                  ]
                )
                  p.push(m[te]);
                else {
                  var S = g / 3;
                  (m[te] = S), p.push(S), _.push(S);
                }
              }
            else
              for (g = 0; g < c.length; g += 3) {
                (v = c[g + 0]), (b = c[g + 1]), (T = c[g + 2]);
                for (var C = !1, x = 0; x < g && !C; x += 3) {
                  var E = c[x + 0],
                    P = c[x + 1],
                    A = c[x + 2];
                  if (
                    Math.abs(v - E) < d &&
                    Math.abs(b - P) < d &&
                    Math.abs(T - A) < d
                  ) {
                    p.push(x / 3), (C = !0);
                    break;
                  }
                }
                C || (p.push(g / 3), _.push(g / 3));
              }
            if (
              null === (s = this._options) || void 0 === s
                ? void 0
                : s.applyTessellation
            ) {
              for (
                var R =
                    null !==
                      (l =
                        null === (a = this._options) || void 0 === a
                          ? void 0
                          : a.epsilonVertexAligned) && void 0 !== l
                      ? l
                      : 1e-6,
                  M = [],
                  O = 0;
                O < u.length;
                O += 3
              )
                for (var I = void 0, D = 0; D < 3; ++D) {
                  var w = p[u[O + D]],
                    N = p[u[O + ((D + 1) % 3)]],
                    L = p[u[O + ((D + 2) % 3)]];
                  if (w !== N)
                    for (
                      var F = c[3 * w + 0],
                        B = c[3 * w + 1],
                        V = c[3 * w + 2],
                        k = c[3 * N + 0],
                        U = c[3 * N + 1],
                        z = c[3 * N + 2],
                        G = Math.sqrt(
                          (k - F) * (k - F) +
                            (U - B) * (U - B) +
                            (z - V) * (z - V)
                        ),
                        W = 0;
                      W < _.length - 1;
                      W++
                    ) {
                      var H = _[W];
                      if (H !== w && H !== N && H !== L) {
                        var j = c[3 * H + 0],
                          X = c[3 * H + 1],
                          Y = c[3 * H + 2],
                          K = Math.sqrt(
                            (j - F) * (j - F) +
                              (X - B) * (X - B) +
                              (Y - V) * (Y - V)
                          ),
                          Q = Math.sqrt(
                            (j - k) * (j - k) +
                              (X - U) * (X - U) +
                              (Y - z) * (Y - z)
                          );
                        Math.abs(K + Q - G) < R &&
                          (I ||
                            ((I = {
                              index: O,
                              edgesPoints: [[], [], []],
                            }),
                            M.push(I)),
                          I.edgesPoints[D].push([H, K]));
                      }
                    }
                }
              for (var q = 0; q < M.length; ++q) {
                var Z = M[q];
                this._tessellateTriangle(Z.edgesPoints, Z.index, u, p);
              }
              M = null;
            }
            var J = {};
            for (O = 0; O < u.length; O += 3) {
              var $ = void 0;
              for (D = 0; D < 3; ++D)
                if (
                  ((w = p[u[O + D]]),
                  (N = p[u[O + ((D + 1) % 3)]]),
                  (L = p[u[O + ((D + 2) % 3)]]),
                  w !== N)
                ) {
                  if (
                    (y.Vector3[0].copyFromFloats(
                      c[3 * w + 0],
                      c[3 * w + 1],
                      c[3 * w + 2]
                    ),
                    y.Vector3[1].copyFromFloats(
                      c[3 * N + 0],
                      c[3 * N + 1],
                      c[3 * N + 2]
                    ),
                    y.Vector3[2].copyFromFloats(
                      c[3 * L + 0],
                      c[3 * L + 1],
                      c[3 * L + 2]
                    ),
                    $ ||
                      (y.Vector3[1].subtractToRef(y.Vector3[0], y.Vector3[3]),
                      y.Vector3[2].subtractToRef(y.Vector3[1], y.Vector3[4]),
                      ($ = f.Cross(y.Vector3[3], y.Vector3[4])).normalize()),
                    w > N)
                  ) {
                    var ee = w;
                    (w = N), (N = ee);
                  }
                  (ie = J[(te = w + "_" + N)])
                    ? ie.done ||
                      (f.Dot($, ie.normal) < this._epsilon &&
                        this.createLine(
                          y.Vector3[0],
                          y.Vector3[1],
                          this._linesPositions.length / 3
                        ),
                      (ie.done = !0))
                    : (J[te] = {
                        normal: $,
                        done: !1,
                        index: O,
                        i: D,
                      });
                }
            }
            for (var te in J) {
              var ie;
              (ie = J[te]).done ||
                ((w = p[u[ie.index + ie.i]]),
                (N = p[u[ie.index + ((ie.i + 1) % 3)]]),
                y.Vector3[0].copyFromFloats(
                  c[3 * w + 0],
                  c[3 * w + 1],
                  c[3 * w + 2]
                ),
                y.Vector3[1].copyFromFloats(
                  c[3 * N + 0],
                  c[3 * N + 1],
                  c[3 * N + 2]
                ),
                this.createLine(
                  y.Vector3[0],
                  y.Vector3[1],
                  this._linesPositions.length / 3
                ));
            }
            var ne = this._source.getScene().getEngine();
            (this._buffers[wt.PositionKind] = new wt(
              ne,
              this._linesPositions,
              wt.PositionKind,
              !1
            )),
              (this._buffers[wt.NormalKind] = new wt(
                ne,
                this._linesNormals,
                wt.NormalKind,
                !1,
                !1,
                4
              )),
              (this._buffersForInstances[wt.PositionKind] =
                this._buffers[wt.PositionKind]),
              (this._buffersForInstances[wt.NormalKind] =
                this._buffers[wt.NormalKind]),
              (this._ib = ne.createIndexBuffer(this._linesIndices)),
              (this._indicesCount = this._linesIndices.length);
          }
        }),
        (e.prototype._generateEdgesLines = function () {
          var e = this._source.getVerticesData(wt.PositionKind),
            t = this._source.getIndices();
          if (t && e) {
            var i,
              n,
              r = new Array(),
              o = new Array();
            for (i = 0; i < t.length; i += 3) {
              n = new Ld();
              var s = t[i],
                a = t[i + 1],
                l = t[i + 2];
              (n.p0 = new f(e[3 * s], e[3 * s + 1], e[3 * s + 2])),
                (n.p1 = new f(e[3 * a], e[3 * a + 1], e[3 * a + 2])),
                (n.p2 = new f(e[3 * l], e[3 * l + 1], e[3 * l + 2]));
              var c = f.Cross(n.p1.subtract(n.p0), n.p2.subtract(n.p1));
              c.normalize(), o.push(c), r.push(n);
            }
            for (i = 0; i < r.length; i++) {
              n = r[i];
              for (var u = i + 1; u < r.length; u++) {
                var h = r[u];
                if (3 === n.edgesConnectedCount) break;
                if (3 !== h.edgesConnectedCount)
                  for (
                    var d = t[3 * u], p = t[3 * u + 1], _ = t[3 * u + 2], m = 0;
                    m < 3;
                    m++
                  ) {
                    var g = 0;
                    if (void 0 === n.edges[m]) {
                      switch (m) {
                        case 0:
                          g = this._checkVerticesInsteadOfIndices
                            ? this._processEdgeForAdjacenciesWithVertices(
                                n.p0,
                                n.p1,
                                h.p0,
                                h.p1,
                                h.p2
                              )
                            : this._processEdgeForAdjacencies(
                                t[3 * i],
                                t[3 * i + 1],
                                d,
                                p,
                                _
                              );
                          break;
                        case 1:
                          g = this._checkVerticesInsteadOfIndices
                            ? this._processEdgeForAdjacenciesWithVertices(
                                n.p1,
                                n.p2,
                                h.p0,
                                h.p1,
                                h.p2
                              )
                            : this._processEdgeForAdjacencies(
                                t[3 * i + 1],
                                t[3 * i + 2],
                                d,
                                p,
                                _
                              );
                          break;
                        case 2:
                          g = this._checkVerticesInsteadOfIndices
                            ? this._processEdgeForAdjacenciesWithVertices(
                                n.p2,
                                n.p0,
                                h.p0,
                                h.p1,
                                h.p2
                              )
                            : this._processEdgeForAdjacencies(
                                t[3 * i + 2],
                                t[3 * i],
                                d,
                                p,
                                _
                              );
                      }
                      if (
                        -1 !== g &&
                        ((n.edges[m] = u),
                        (h.edges[g] = i),
                        n.edgesConnectedCount++,
                        h.edgesConnectedCount++,
                        3 === n.edgesConnectedCount)
                      )
                        break;
                    }
                  }
              }
            }
            for (i = 0; i < r.length; i++) {
              var v = r[i];
              this._checkEdge(i, v.edges[0], o, v.p0, v.p1),
                this._checkEdge(i, v.edges[1], o, v.p1, v.p2),
                this._checkEdge(i, v.edges[2], o, v.p2, v.p0);
            }
            var y = this._source.getScene().getEngine();
            (this._buffers[wt.PositionKind] = new wt(
              y,
              this._linesPositions,
              wt.PositionKind,
              !1
            )),
              (this._buffers[wt.NormalKind] = new wt(
                y,
                this._linesNormals,
                wt.NormalKind,
                !1,
                !1,
                4
              )),
              (this._buffersForInstances[wt.PositionKind] =
                this._buffers[wt.PositionKind]),
              (this._buffersForInstances[wt.NormalKind] =
                this._buffers[wt.NormalKind]),
              (this._ib = y.createIndexBuffer(this._linesIndices)),
              (this._indicesCount = this._linesIndices.length);
          }
        }),
        (e.prototype.isReady = function () {
          return this._lineShader.isReady(
            this._source,
            (this._source.hasInstances && this.customInstances.length > 0) ||
              this._source.hasThinInstances
          );
        }),
        (e.prototype.render = function () {
          var e = this._source.getScene();
          if (this.isReady() && e.activeCamera) {
            var t = e.getEngine();
            this._lineShader._preBind(),
              1 !== this._source.edgesColor.a
                ? t.setAlphaMode(2)
                : t.setAlphaMode(0);
            var i =
                this._source.hasInstances && this.customInstances.length > 0,
              n = i || this._source.hasThinInstances,
              r = 0;
            if (n)
              if (
                ((this._buffersForInstances.world0 =
                  this._source.getVertexBuffer("world0")),
                (this._buffersForInstances.world1 =
                  this._source.getVertexBuffer("world1")),
                (this._buffersForInstances.world2 =
                  this._source.getVertexBuffer("world2")),
                (this._buffersForInstances.world3 =
                  this._source.getVertexBuffer("world3")),
                i)
              ) {
                var o = this._source._instanceDataStorage;
                if (((r = this.customInstances.length), !o.isFrozen)) {
                  for (var s = 0, a = 0; a < r; ++a)
                    this.customInstances.data[a].copyToArray(
                      o.instancesData,
                      s
                    ),
                      (s += 16);
                  o.instancesBuffer.updateDirectly(o.instancesData, 0, r);
                }
              } else r = this._source.thinInstanceCount;
            t.bindBuffers(
              n ? this._buffersForInstances : this._buffers,
              this._ib,
              this._lineShader.getEffect()
            ),
              e.resetCachedMaterial(),
              this._lineShader.setColor4("color", this._source.edgesColor),
              e.activeCamera.mode === Zt.ORTHOGRAPHIC_CAMERA
                ? this._lineShader.setFloat(
                    "width",
                    this._source.edgesWidth /
                      this.edgesWidthScalerForOrthographic
                  )
                : this._lineShader.setFloat(
                    "width",
                    this._source.edgesWidth /
                      this.edgesWidthScalerForPerspective
                  ),
              this._lineShader.setFloat(
                "aspectRatio",
                t.getAspectRatio(e.activeCamera)
              ),
              this._lineShader.bind(this._source.getWorldMatrix()),
              t.drawElementsType(si.TriangleFillMode, 0, this._indicesCount, r),
              this._lineShader.unbind(),
              n && t.unbindInstanceAttributes(),
              this._source.getScene()._activeMeshesFrozen ||
                this.customInstances.reset();
          }
        }),
        e
      );
    })(),
    Bd = (function (e) {
      function t(t, i, n) {
        void 0 === i && (i = 0.95), void 0 === n && (n = !1);
        var r = e.call(this, t, i, n, !1) || this;
        return r._generateEdgesLines(), r;
      }
      return (
        P(t, e),
        (t.prototype._generateEdgesLines = function () {
          var e = this._source.getVerticesData(wt.PositionKind),
            t = this._source.getIndices();
          if (t && e) {
            for (
              var i = y.Vector3[0],
                n = y.Vector3[1],
                r = t.length - 1,
                o = 0,
                s = 0;
              o < r;
              o += 2, s += 4
            )
              f.FromArrayToRef(e, 3 * t[o], i),
                f.FromArrayToRef(e, 3 * t[o + 1], n),
                this.createLine(i, n, s);
            var a = this._source.getScene().getEngine();
            (this._buffers[wt.PositionKind] = new wt(
              a,
              this._linesPositions,
              wt.PositionKind,
              !1
            )),
              (this._buffers[wt.NormalKind] = new wt(
                a,
                this._linesNormals,
                wt.NormalKind,
                !1,
                !1,
                4
              )),
              (this._ib = a.createIndexBuffer(this._linesIndices)),
              (this._indicesCount = this._linesIndices.length);
          }
        }),
        t
      );
    })(Fd),
    Vd = (function () {
      function e(t) {
        (this._textureFormats = [
          {
            type: 0,
            format: 2,
          },
          {
            type: 1,
            format: 2,
          },
          {
            type: 2,
            format: 2,
          },
          {
            type: 3,
            format: 0,
          },
          {
            type: 4,
            format: 2,
          },
          {
            type: 5,
            format: 2,
          },
          {
            type: 6,
            format: 0,
          },
        ]),
          (this.excludedSkinnedMesh = []),
          (this.excludedMaterials = []),
          (this._textureIndices = []),
          (this._isDirty = !1),
          (this.mrtCount = 0),
          (this._postProcesses = []),
          (this._clearColor = new T(0, 0, 0, 0)),
          (this._effectConfigurations = []),
          (this._mrtFormats = []),
          (this._enabled = !1),
          (this._useGeometryBufferFallback = !1),
          (this.disableGammaTransform = !1),
          (this._scene = t),
          (this._engine = t.getEngine()),
          e._SceneComponentInitialization(this._scene),
          this._resetLayout();
      }
      return (
        Object.defineProperty(e.prototype, "enabled", {
          get: function () {
            return this._enabled;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "samples", {
          get: function () {
            return this.prePassRT.samples;
          },
          set: function (e) {
            this.imageProcessingPostProcess || this._createCompositionEffect(),
              (this.prePassRT.samples = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "useGeometryBufferFallback", {
          get: function () {
            return this._useGeometryBufferFallback;
          },
          set: function (e) {
            if (((this._useGeometryBufferFallback = e), e)) {
              if (
                ((this._geometryBuffer =
                  this._scene.enableGeometryBufferRenderer()),
                !this._geometryBuffer)
              )
                return void (this._useGeometryBufferFallback = !1);
              (this._geometryBuffer.renderList = []),
                this._geometryBuffer._linkPrePassRenderer(this),
                this._updateGeometryBufferLayout();
            } else
              this._geometryBuffer &&
                this._geometryBuffer._unlinkPrePassRenderer(),
                (this._geometryBuffer = null),
                this._scene.disableGeometryBufferRenderer();
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype._initializeAttachments = function () {
          for (var e = [], t = [!1], i = [!0], n = 0; n < this.mrtCount; n++)
            e.push(!0), n > 0 && (t.push(!0), i.push(!1));
          (this._multiRenderAttachments = this._engine.buildTextureLayout(e)),
            (this._clearAttachments = this._engine.buildTextureLayout(t)),
            (this._defaultAttachments = this._engine.buildTextureLayout(i));
        }),
        (e.prototype._createCompositionEffect = function () {
          (this.prePassRT = new kl(
            "sceneprePassRT",
            {
              width: this._engine.getRenderWidth(),
              height: this._engine.getRenderHeight(),
            },
            this.mrtCount,
            this._scene,
            {
              generateMipMaps: !1,
              generateDepthTexture: !0,
              defaultType: 0,
              types: this._mrtFormats,
            }
          )),
            (this.prePassRT.samples = 1),
            this._initializeAttachments(),
            this._useGeometryBufferFallback &&
              !this._geometryBuffer &&
              (this.useGeometryBufferFallback = !0),
            (this.imageProcessingPostProcess = new Jr(
              "sceneCompositionPass",
              1,
              null,
              void 0,
              this._engine
            )),
            (this.imageProcessingPostProcess.autoClear = !1);
        }),
        Object.defineProperty(e.prototype, "isSupported", {
          get: function () {
            return (
              this._engine.webGLVersion > 1 ||
              this._scene.getEngine().getCaps().drawBuffersExtension
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.bindAttachmentsForEffect = function (e, t) {
          if (this.enabled)
            if (e._multiTarget)
              this._engine.bindAttachments(this._multiRenderAttachments);
            else if (
              (this._engine.bindAttachments(this._defaultAttachments),
              this._geometryBuffer)
            ) {
              var i = t.getMaterial();
              i &&
                -1 === this.excludedMaterials.indexOf(i) &&
                this._geometryBuffer.renderList.push(t.getRenderingMesh());
            }
        }),
        (e.prototype.restoreAttachments = function () {
          this.enabled &&
            this._defaultAttachments &&
            this._engine.bindAttachments(this._defaultAttachments);
        }),
        (e.prototype._beforeCameraDraw = function () {
          this._isDirty && this._update(),
            this._geometryBuffer &&
              (this._geometryBuffer.renderList.length = 0),
            this._bindFrameBuffer();
        }),
        (e.prototype._afterCameraDraw = function () {
          if (this._enabled) {
            var e =
              this._scene.activeCamera &&
              this._scene.activeCamera._getFirstPostProcess();
            e &&
              this._postProcesses.length &&
              this._scene.postProcessManager._prepareFrame(),
              this._scene.postProcessManager.directRender(
                this._postProcesses,
                e ? e.inputTexture : null
              );
          }
        }),
        (e.prototype._checkRTSize = function () {
          var e = this._engine.getRenderWidth(!0),
            t = this._engine.getRenderHeight(!0),
            i = this.prePassRT.getRenderWidth(),
            n = this.prePassRT.getRenderHeight();
          (i === e && n === t) ||
            (this.prePassRT.resize({
              width: e,
              height: t,
            }),
            this._updateGeometryBufferLayout(),
            this._bindPostProcessChain());
        }),
        (e.prototype._bindFrameBuffer = function () {
          if (this._enabled) {
            this._checkRTSize();
            var e = this.prePassRT.getInternalTexture();
            e && this._engine.bindFramebuffer(e);
          }
        }),
        (e.prototype.clear = function () {
          this._enabled &&
            (this._bindFrameBuffer(),
            this._engine.clear(
              this._scene.clearColor,
              this._scene.autoClear ||
                this._scene.forceWireframe ||
                this._scene.forcePointsCloud,
              this._scene.autoClearDepthAndStencil,
              this._scene.autoClearDepthAndStencil
            ),
            this._engine.bindAttachments(this._clearAttachments),
            this._engine.clear(this._clearColor, !0, !1, !1),
            this._engine.bindAttachments(this._defaultAttachments));
        }),
        (e.prototype._setState = function (e) {
          (this._enabled = e),
            (this._scene.prePass = e),
            this.imageProcessingPostProcess &&
              (this.imageProcessingPostProcess.imageProcessingConfiguration.applyByPostProcess =
                e);
        }),
        (e.prototype._updateGeometryBufferLayout = function () {
          if (this._geometryBuffer) {
            this._geometryBuffer._resetLayout();
            for (var e = [], t = 0; t < this._mrtLayout.length; t++) e.push(!1);
            this._geometryBuffer._linkInternalTexture(
              this.prePassRT.getInternalTexture()
            );
            var i = [
              {
                prePassConstant: 5,
                geometryBufferConstant: _d.DEPTHNORMAL_TEXTURE_TYPE,
              },
              {
                prePassConstant: 1,
                geometryBufferConstant: _d.POSITION_TEXTURE_TYPE,
              },
              {
                prePassConstant: 3,
                geometryBufferConstant: _d.REFLECTIVITY_TEXTURE_TYPE,
              },
              {
                prePassConstant: 2,
                geometryBufferConstant: _d.VELOCITY_TEXTURE_TYPE,
              },
            ];
            for (t = 0; t < i.length; t++) {
              var n = this._mrtLayout.indexOf(i[t].prePassConstant);
              -1 !== n &&
                (this._geometryBuffer._forceTextureType(
                  i[t].geometryBufferConstant,
                  n
                ),
                (e[n] = !0));
            }
            this._geometryBuffer._setAttachments(
              this._engine.buildTextureLayout(e)
            );
          }
        }),
        (e.prototype.addEffectConfiguration = function (e) {
          for (var t = 0; t < this._effectConfigurations.length; t++)
            if (this._effectConfigurations[t].name === e.name)
              return this._effectConfigurations[t];
          return this._effectConfigurations.push(e), e;
        }),
        (e.prototype.getIndex = function (e) {
          return this._textureIndices[e];
        }),
        (e.prototype._enable = function () {
          for (
            var e, t, i = this.mrtCount, n = 0;
            n < this._effectConfigurations.length;
            n++
          )
            this._effectConfigurations[n].enabled &&
              this._enableTextures(
                this._effectConfigurations[n].texturesRequired
              );
          for (
            this.prePassRT &&
              this.mrtCount !== i &&
              this.prePassRT.updateCount(this.mrtCount, {
                types: this._mrtFormats,
              }),
              this._updateGeometryBufferLayout(),
              this._resetPostProcessChain(),
              n = 0;
            n < this._effectConfigurations.length;
            n++
          )
            this._effectConfigurations[n].enabled &&
              (!this._effectConfigurations[n].postProcess &&
                this._effectConfigurations[n].createPostProcess &&
                this._effectConfigurations[n].createPostProcess(),
              this._effectConfigurations[n].postProcess &&
                this._postProcesses.push(
                  this._effectConfigurations[n].postProcess
                ));
          this._initializeAttachments(),
            this.imageProcessingPostProcess || this._createCompositionEffect();
          var r = !1;
          if (
            null === (e = this._scene.activeCamera) || void 0 === e
              ? void 0
              : e._postProcesses
          )
            for (n = 0; n < this._scene.activeCamera._postProcesses.length; n++)
              "ImageProcessingPostProcess" ===
                (null === (t = this._scene.activeCamera._postProcesses[n]) ||
                void 0 === t
                  ? void 0
                  : t.getClassName()) && (r = !0);
          r ||
            this.disableGammaTransform ||
            this._postProcesses.push(this.imageProcessingPostProcess),
            this._bindPostProcessChain(),
            this._setState(!0);
        }),
        (e.prototype._disable = function () {
          this._setState(!1), this._resetLayout();
          for (var e = 0; e < this._effectConfigurations.length; e++)
            this._effectConfigurations[e].enabled = !1;
        }),
        (e.prototype._resetLayout = function () {
          for (var e = 0; e < this._textureFormats.length; e++)
            this._textureIndices[this._textureFormats[e].type] = -1;
          (this._textureIndices[4] = 0),
            (this._mrtLayout = [4]),
            (this._mrtFormats = [2]),
            (this.mrtCount = 1);
        }),
        (e.prototype._resetPostProcessChain = function () {
          (this._postProcesses = []),
            this.imageProcessingPostProcess &&
              this.imageProcessingPostProcess.restoreDefaultInputTexture();
          for (var e = 0; e < this._effectConfigurations.length; e++)
            this._effectConfigurations[e].postProcess &&
              this._effectConfigurations[
                e
              ].postProcess.restoreDefaultInputTexture();
        }),
        (e.prototype._bindPostProcessChain = function () {
          var e;
          if (this._postProcesses.length)
            this._postProcesses[0].inputTexture =
              this.prePassRT.getInternalTexture();
          else {
            var t =
              null === (e = this._scene.activeCamera) || void 0 === e
                ? void 0
                : e._getFirstPostProcess();
            t && (t.inputTexture = this.prePassRT.getInternalTexture());
          }
        }),
        (e.prototype.markAsDirty = function () {
          this._isDirty = !0;
        }),
        (e.prototype._enableTextures = function (e) {
          for (var t = 0; t < e.length; t++) {
            var i = e[t];
            -1 === this._textureIndices[i] &&
              ((this._textureIndices[i] = this._mrtLayout.length),
              this._mrtLayout.push(i),
              this._mrtFormats.push(this._textureFormats[i].format),
              this.mrtCount++);
          }
        }),
        (e.prototype._update = function () {
          this._disable();
          for (var e = !1, t = 0; t < this._scene.materials.length; t++)
            this._scene.materials[t].setPrePassRenderer(this) && (e = !0);
          var i = this._scene.activeCamera;
          if (i) {
            var n = i._postProcesses.filter(function (e) {
              return null != e;
            });
            if (n)
              for (t = 0; t < n.length; t++)
                n[t].setPrePassRenderer(this) && (e = !0);
            this._markAllMaterialsAsPrePassDirty(),
              (this._isDirty = !1),
              e && this._enable(),
              this.enabled ||
                (this._engine.restoreDefaultFramebuffer(),
                this._engine.restoreSingleAttachment());
          }
        }),
        (e.prototype._markAllMaterialsAsPrePassDirty = function () {
          for (var e = this._scene.materials, t = 0; t < e.length; t++)
            e[t].markAsDirty(si.PrePassDirtyFlag);
        }),
        (e.prototype.dispose = function () {
          for (var e = 0; e < this._effectConfigurations.length; e++)
            this._effectConfigurations[e].dispose &&
              this._effectConfigurations[e].dispose();
          this.imageProcessingPostProcess.dispose(), this.prePassRT.dispose();
        }),
        (e._SceneComponentInitialization = function (e) {
          throw $.WarnImport("PrePassRendererSceneComponent");
        }),
        e
      );
    })();
  Object.defineProperty(Ci.prototype, "prePassRenderer", {
    get: function () {
      return this._prePassRenderer;
    },
    set: function (e) {
      e && e.isSupported && (this._prePassRenderer = e);
    },
    enumerable: !0,
    configurable: !0,
  }),
    (Ci.prototype.enablePrePassRenderer = function () {
      return (
        this._prePassRenderer ||
          ((this._prePassRenderer = new Vd(this)),
          this._prePassRenderer.isSupported ||
            ((this._prePassRenderer = null),
            F.Error(
              "PrePassRenderer needs WebGL 2 support.\nMaybe you tried to use the following features that need the PrePassRenderer :\n + Subsurface Scattering"
            ))),
        this._prePassRenderer
      );
    }),
    (Ci.prototype.disablePrePassRenderer = function () {
      this._prePassRenderer &&
        (this._prePassRenderer.dispose(), (this._prePassRenderer = null));
    });
  var kd = (function () {
    function e(e) {
      (this.name = hi.NAME_PREPASSRENDERER), (this.scene = e);
    }
    return (
      (e.prototype.register = function () {
        this.scene._beforeCameraDrawStage.registerStep(
          hi.STEP_BEFORECAMERADRAW_PREPASS,
          this,
          this._beforeCameraDraw
        ),
          this.scene._afterCameraDrawStage.registerStep(
            hi.STEP_AFTERCAMERADRAW_PREPASS,
            this,
            this._afterCameraDraw
          ),
          this.scene._beforeClearStage.registerStep(
            hi.STEP_BEFORECLEARSTAGE_PREPASS,
            this,
            this._beforeClearStage
          ),
          this.scene._beforeRenderingMeshStage.registerStep(
            hi.STEP_BEFORERENDERINGMESH_PREPASS,
            this,
            this._beforeRenderingMeshStage
          ),
          this.scene._afterRenderingMeshStage.registerStep(
            hi.STEP_AFTERRENDERINGMESH_PREPASS,
            this,
            this._afterRenderingMeshStage
          );
      }),
      (e.prototype._beforeCameraDraw = function () {
        this.scene.prePassRenderer &&
          this.scene.prePassRenderer._beforeCameraDraw();
      }),
      (e.prototype._afterCameraDraw = function () {
        this.scene.prePassRenderer &&
          this.scene.prePassRenderer._afterCameraDraw();
      }),
      (e.prototype._beforeClearStage = function () {
        this.scene.prePassRenderer && this.scene.prePassRenderer.clear();
      }),
      (e.prototype._beforeRenderingMeshStage = function (e, t, i, n) {
        if (n) {
          var r = e.getScene();
          r.prePassRenderer && r.prePassRenderer.bindAttachmentsForEffect(n, t);
        }
      }),
      (e.prototype._afterRenderingMeshStage = function (e) {
        var t = e.getScene();
        t.prePassRenderer && t.prePassRenderer.restoreAttachments();
      }),
      (e.prototype.rebuild = function () {}),
      (e.prototype.dispose = function () {}),
      e
    );
  })();
  Vd._SceneComponentInitialization = function (e) {
    var t = e._getComponent(hi.NAME_PREPASSRENDERER);
    t || ((t = new kd(e)), e._addComponent(t));
  };
  Ke.IncludesShadersStore.fibonacci =
    "#define rcp(x) 1./x\n#define GOLDEN_RATIO 1.618033988749895\n#define TWO_PI 6.2831855\n\n\nvec2 Golden2dSeq(int i,float n)\n{\n\n\nreturn vec2(float(i)/n+(0.5/n),fract(float(i)*rcp(GOLDEN_RATIO)));\n}\nvec2 SampleDiskGolden(int i,int sampleCount)\n{\nvec2 f=Golden2dSeq(i,float(sampleCount));\nreturn vec2(sqrt(f.x),TWO_PI*f.y);\n}";
  Ke.IncludesShadersStore.diffusionProfile =
    "uniform vec3 diffusionS[5];\nuniform float diffusionD[5];\nuniform float filterRadii[5];";
  Ke.ShadersStore.subSurfaceScatteringPixelShader =
    "\n#include<fibonacci>\n#include<helperFunctions>\n#include<subSurfaceScatteringFunctions>\n#include<diffusionProfile>\nvarying vec2 vUV;\nuniform vec2 texelSize;\nuniform sampler2D textureSampler;\nuniform sampler2D irradianceSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D albedoSampler;\nuniform vec2 viewportSize;\nuniform float metersPerUnit;\nconst float LOG2_E=1.4426950408889634;\nconst float SSS_PIXELS_PER_SAMPLE=4.;\nconst int _SssSampleBudget=40;\n#define rcp(x) 1./x\n#define Sq(x) x*x\n#define SSS_BILATERAL_FILTER true\n\n\nvec3 EvalBurleyDiffusionProfile(float r,vec3 S)\n{\nvec3 exp_13=exp2(((LOG2_E*(-1.0/3.0))*r)*S);\nvec3 expSum=exp_13*(1.+exp_13*exp_13);\nreturn (S*rcp(8.*PI))*expSum;\n}\n\n\n\n\n\n\nvec2 SampleBurleyDiffusionProfile(float u,float rcpS)\n{\nu=1.-u;\nfloat g=1.+(4.*u)*(2.*u+sqrt(1.+(4.*u)*u));\nfloat n=exp2(log2(g)*(-1.0/3.0));\nfloat p=(g*n)*n;\nfloat c=1.+p+n;\nfloat d=(3./LOG2_E*2.)+(3./LOG2_E)*log2(u);\nfloat x=(3./LOG2_E)*log2(c)-d;\n\n\n\n\n\n\nfloat rcpExp=((c*c)*c)*rcp((4.*u)*((c*c)+(4.*u)*(4.*u)));\nfloat r=x*rcpS;\nfloat rcpPdf=(8.*PI*rcpS)*rcpExp;\nreturn vec2(r,rcpPdf);\n}\n\n\nvec3 ComputeBilateralWeight(float xy2,float z,float mmPerUnit,vec3 S,float rcpPdf)\n{\n#ifndef SSS_BILATERAL_FILTER\nz=0.;\n#endif\n\n\n\nfloat r=sqrt(xy2+(z*mmPerUnit)*(z*mmPerUnit));\nfloat area=rcpPdf;\n#if SSS_CLAMP_ARTIFACT\nreturn clamp(EvalBurleyDiffusionProfile(r,S)*area,0.0,1.0);\n#else\nreturn EvalBurleyDiffusionProfile(r,S)*area;\n#endif\n}\nvoid EvaluateSample(int i,int n,vec3 S,float d,vec3 centerPosVS,float mmPerUnit,float pixelsPerMm,\nfloat phase,inout vec3 totalIrradiance,inout vec3 totalWeight)\n{\n\nfloat scale=rcp(float(n));\nfloat offset=rcp(float(n))*0.5;\n\nfloat sinPhase,cosPhase;\nsinPhase=sin(phase);\ncosPhase=cos(phase);\nvec2 bdp=SampleBurleyDiffusionProfile(float(i)*scale+offset,d);\nfloat r=bdp.x;\nfloat rcpPdf=bdp.y;\nfloat phi=SampleDiskGolden(i,n).y;\nfloat sinPhi,cosPhi;\nsinPhi=sin(phi);\ncosPhi=cos(phi);\nfloat sinPsi=cosPhase*sinPhi+sinPhase*cosPhi;\nfloat cosPsi=cosPhase*cosPhi-sinPhase*sinPhi;\nvec2 vec=r*vec2(cosPsi,sinPsi);\n\nvec2 position;\nfloat xy2;\nposition=vUV+round((pixelsPerMm*r)*vec2(cosPsi,sinPsi))*texelSize;\nxy2=r*r;\nvec4 textureSample=texture2D(irradianceSampler,position);\nfloat viewZ=texture2D(depthSampler,position).r;\nvec3 irradiance=textureSample.rgb;\nif (testLightingForSSS(textureSample.a))\n{\n\nfloat relZ=viewZ-centerPosVS.z;\nvec3 weight=ComputeBilateralWeight(xy2,relZ,mmPerUnit,S,rcpPdf);\ntotalIrradiance+=weight*irradiance;\ntotalWeight+=weight;\n}\nelse\n{\n\n\n\n\n\n\n}\n}\nvoid main(void)\n{\nvec4 irradianceAndDiffusionProfile=texture2D(irradianceSampler,vUV);\nvec3 centerIrradiance=irradianceAndDiffusionProfile.rgb;\nint diffusionProfileIndex=int(round(irradianceAndDiffusionProfile.a*255.));\nfloat centerDepth=0.;\nvec4 inputColor=texture2D(textureSampler,vUV);\nbool passedStencilTest=testLightingForSSS(irradianceAndDiffusionProfile.a);\nif (passedStencilTest)\n{\ncenterDepth=texture2D(depthSampler,vUV).r;\n}\nif (!passedStencilTest) {\ngl_FragColor=inputColor;\nreturn;\n}\nfloat distScale=1.;\nvec3 S=diffusionS[diffusionProfileIndex];\nfloat d=diffusionD[diffusionProfileIndex];\nfloat filterRadius=filterRadii[diffusionProfileIndex];\n\nvec2 centerPosNDC=vUV;\nvec2 cornerPosNDC=vUV+0.5*texelSize;\nvec3 centerPosVS=vec3(centerPosNDC*viewportSize,1.0)*centerDepth;\nvec3 cornerPosVS=vec3(cornerPosNDC*viewportSize,1.0)*centerDepth;\n\nfloat mmPerUnit=1000.*(metersPerUnit*rcp(distScale));\nfloat unitsPerMm=rcp(mmPerUnit);\n\n\nfloat unitsPerPixel=2.*abs(cornerPosVS.x-centerPosVS.x);\nfloat pixelsPerMm=rcp(unitsPerPixel)*unitsPerMm;\n\nfloat filterArea=PI*Sq(filterRadius*pixelsPerMm);\nint sampleCount=int(filterArea*rcp(SSS_PIXELS_PER_SAMPLE));\nint sampleBudget=_SssSampleBudget;\nint texturingMode=0;\nvec3 albedo=texture2D(albedoSampler,vUV).rgb;\nif (distScale == 0. || sampleCount<1)\n{\n#ifdef DEBUG_SSS_SAMPLES\nvec3 green=vec3(0.,1.,0.);\ngl_FragColor=vec4(green,1.0);\nreturn;\n#endif\ngl_FragColor=vec4(inputColor.rgb+albedo*centerIrradiance,1.0);\nreturn;\n}\n#ifdef DEBUG_SSS_SAMPLES\nvec3 red=vec3(1.,0.,0.);\nvec3 blue=vec3(0.,0.,1.);\ngl_FragColor=vec4(mix(blue,red,clamp(float(sampleCount)/float(sampleBudget),0.0,1.0)),1.0);\nreturn;\n#endif\n\nfloat phase=0.;\nint n=min(sampleCount,sampleBudget);\n\nvec3 centerWeight=vec3(0.);\nvec3 totalIrradiance=vec3(0.);\nvec3 totalWeight=vec3(0.);\nfor (int i=0; i<n; i++)\n{\n\nEvaluateSample(i,n,S,d,centerPosVS,mmPerUnit,pixelsPerMm,\nphase,totalIrradiance,totalWeight);\n}\n\ntotalWeight=max(totalWeight,HALF_MIN);\ngl_FragColor=vec4(inputColor.rgb+albedo*max(totalIrradiance/totalWeight,vec3(0.0)),1.);\n}";
  var Ud = (function (e) {
      function t(t, i, n, r, o, s, a, l) {
        void 0 === r && (r = null), void 0 === l && (l = 0);
        var c =
          e.call(
            this,
            t,
            "subSurfaceScattering",
            ["texelSize", "viewportSize", "metersPerUnit"],
            [
              "diffusionS",
              "diffusionD",
              "filterRadii",
              "irradianceSampler",
              "depthSampler",
              "albedoSampler",
            ],
            n,
            r,
            o || mn.BILINEAR_SAMPLINGMODE,
            s,
            a,
            null,
            l,
            "postprocess",
            void 0,
            !0
          ) || this;
        return (
          (c._scene = i),
          c.updateEffect(),
          c.onApplyObservable.add(function (e) {
            if (i.prePassRenderer && i.subSurfaceConfiguration) {
              var t = c.texelSize;
              e.setFloat(
                "metersPerUnit",
                i.subSurfaceConfiguration.metersPerUnit
              ),
                e.setFloat2("texelSize", t.x, t.y),
                e.setTexture(
                  "irradianceSampler",
                  i.prePassRenderer.prePassRT.textures[
                    i.prePassRenderer.getIndex(0)
                  ]
                ),
                e.setTexture(
                  "depthSampler",
                  i.prePassRenderer.prePassRT.textures[
                    i.prePassRenderer.getIndex(5)
                  ]
                ),
                e.setTexture(
                  "albedoSampler",
                  i.prePassRenderer.prePassRT.textures[
                    i.prePassRenderer.getIndex(6)
                  ]
                ),
                e.setFloat2(
                  "viewportSize",
                  Math.tan(i.activeCamera.fov / 2) *
                    i.getEngine().getAspectRatio(i.activeCamera, !0),
                  Math.tan(i.activeCamera.fov / 2)
                ),
                e.setArray3(
                  "diffusionS",
                  i.subSurfaceConfiguration.ssDiffusionS
                ),
                e.setArray(
                  "diffusionD",
                  i.subSurfaceConfiguration.ssDiffusionD
                ),
                e.setArray(
                  "filterRadii",
                  i.subSurfaceConfiguration.ssFilterRadii
                );
            } else
              F.Error(
                "PrePass and subsurface configuration needs to be enabled for subsurface scattering."
              );
          }),
          c
        );
      }
      return (
        P(t, e),
        (t.prototype.getClassName = function () {
          return "SubSurfaceScatteringPostProcess";
        }),
        t
      );
    })(vr),
    zd = (function () {
      function e(t) {
        (this._ssDiffusionS = []),
          (this._ssFilterRadii = []),
          (this._ssDiffusionD = []),
          (this.enabled = !1),
          (this.name = hi.NAME_SUBSURFACE),
          (this.ssDiffusionProfileColors = []),
          (this.metersPerUnit = 1),
          (this.texturesRequired = [5, 6, 4, 0]),
          this.addDiffusionProfile(new b(1, 1, 1)),
          (this._scene = t),
          e._SceneComponentInitialization(this._scene);
      }
      return (
        Object.defineProperty(e.prototype, "ssDiffusionS", {
          get: function () {
            return this._ssDiffusionS;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "ssDiffusionD", {
          get: function () {
            return this._ssDiffusionD;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "ssFilterRadii", {
          get: function () {
            return this._ssFilterRadii;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.addDiffusionProfile = function (e) {
          if (this.ssDiffusionD.length >= 5)
            return (
              F.Error(
                "You already reached the maximum number of diffusion profiles."
              ),
              0
            );
          for (var t = 0; t < this._ssDiffusionS.length / 3; t++)
            if (
              this._ssDiffusionS[3 * t] === e.r &&
              this._ssDiffusionS[3 * t + 1] === e.g &&
              this._ssDiffusionS[3 * t + 2] === e.b
            )
              return t;
          return (
            this._ssDiffusionS.push(e.r, e.b, e.g),
            this._ssDiffusionD.push(Math.max(Math.max(e.r, e.b), e.g)),
            this._ssFilterRadii.push(this.getDiffusionProfileParameters(e)),
            this.ssDiffusionProfileColors.push(e),
            this._ssDiffusionD.length - 1
          );
        }),
        (e.prototype.createPostProcess = function () {
          return (
            (this.postProcess = new Ud(
              "subSurfaceScattering",
              this._scene,
              1,
              null,
              void 0,
              this._scene.getEngine()
            )),
            (this.postProcess.autoClear = !1),
            this.postProcess
          );
        }),
        (e.prototype.clearAllDiffusionProfiles = function () {
          (this._ssDiffusionD = []),
            (this._ssDiffusionS = []),
            (this._ssFilterRadii = []),
            (this.ssDiffusionProfileColors = []);
        }),
        (e.prototype.dispose = function () {
          this.clearAllDiffusionProfiles(), this.postProcess.dispose();
        }),
        (e.prototype.getDiffusionProfileParameters = function (e) {
          var t = Math.max(e.r, e.g, e.b);
          return this._sampleBurleyDiffusionProfile(0.997, t);
        }),
        (e.prototype._sampleBurleyDiffusionProfile = function (e, t) {
          var i = 1 + 4 * (e = 1 - e) * (2 * e + Math.sqrt(1 + 4 * e * e)),
            n = Math.pow(i, -1 / 3),
            r = 1 + i * n * n + n;
          return 3 * Math.log(r / (4 * e)) * t;
        }),
        (e._SceneComponentInitialization = function (e) {
          throw $.WarnImport("PrePassRendererSceneComponent");
        }),
        e
      );
    })();
  t.AddParser(hi.NAME_SUBSURFACE, function (e, t) {
    if (
      void 0 !== e.ssDiffusionProfileColors &&
      null !== e.ssDiffusionProfileColors &&
      (t.enableSubSurfaceForPrePass(), t.subSurfaceConfiguration)
    )
      for (var i = 0, n = e.ssDiffusionProfileColors.length; i < n; i++) {
        var r = e.ssDiffusionProfileColors[i];
        t.subSurfaceConfiguration.addDiffusionProfile(new b(r.r, r.g, r.b));
      }
  }),
    Object.defineProperty(Ci.prototype, "subSurfaceConfiguration", {
      get: function () {
        return this._subSurfaceConfiguration;
      },
      set: function (e) {
        e &&
          this.enablePrePassRenderer() &&
          (this._subSurfaceConfiguration = e);
      },
      enumerable: !0,
      configurable: !0,
    }),
    (Ci.prototype.enableSubSurfaceForPrePass = function () {
      if (this._subSurfaceConfiguration) return this._subSurfaceConfiguration;
      var e = this.enablePrePassRenderer();
      return e
        ? ((this._subSurfaceConfiguration = new zd(this)),
          e.addEffectConfiguration(this._subSurfaceConfiguration),
          this._subSurfaceConfiguration)
        : null;
    }),
    (Ci.prototype.disableSubSurfaceForPrePass = function () {
      this._subSurfaceConfiguration &&
        (this._subSurfaceConfiguration.dispose(),
        (this._subSurfaceConfiguration = null));
    });
  var Gd = (function () {
    function e(e) {
      (this.name = hi.NAME_PREPASSRENDERER), (this.scene = e);
    }
    return (
      (e.prototype.register = function () {}),
      (e.prototype.serialize = function (e) {
        if (this.scene.subSurfaceConfiguration) {
          var t = this.scene.subSurfaceConfiguration.ssDiffusionProfileColors;
          e.ssDiffusionProfileColors = [];
          for (var i = 0; i < t.length; i++)
            e.ssDiffusionProfileColors.push({
              r: t[i].r,
              g: t[i].g,
              b: t[i].b,
            });
        }
      }),
      (e.prototype.addFromContainer = function (e) {}),
      (e.prototype.removeFromContainer = function (e, t) {
        this.scene.prePassRenderer &&
          this.scene.subSurfaceConfiguration &&
          this.scene.subSurfaceConfiguration.clearAllDiffusionProfiles();
      }),
      (e.prototype.rebuild = function () {}),
      (e.prototype.dispose = function () {}),
      e
    );
  })();
  zd._SceneComponentInitialization = function (e) {
    var t = e._getComponent(hi.NAME_SUBSURFACE);
    t || ((t = new Gd(e)), e._addComponent(t));
  };
  Ke.ShadersStore.outlinePixelShader =
    "#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#include<logDepthFragment>\ngl_FragColor=color;\n}";
  (Ke.ShadersStore.outlineVertexShader =
    "\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<logDepthDeclaration>\nvoid main(void)\n{\nvec3 positionUpdated=position;\nvec3 normalUpdated=normal;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\nvec3 offsetPosition=positionUpdated+(normalUpdated*offset);\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<logDepthVertex>\n}\n"),
    (Ci.prototype.getOutlineRenderer = function () {
      return (
        this._outlineRenderer || (this._outlineRenderer = new Wd(this)),
        this._outlineRenderer
      );
    }),
    Object.defineProperty(Qi.prototype, "renderOutline", {
      get: function () {
        return this._renderOutline;
      },
      set: function (e) {
        e && this.getScene().getOutlineRenderer(), (this._renderOutline = e);
      },
      enumerable: !0,
      configurable: !0,
    }),
    Object.defineProperty(Qi.prototype, "renderOverlay", {
      get: function () {
        return this._renderOverlay;
      },
      set: function (e) {
        e && this.getScene().getOutlineRenderer(), (this._renderOverlay = e);
      },
      enumerable: !0,
      configurable: !0,
    });
  var Wd = (function () {
      function e(e) {
        (this.name = hi.NAME_OUTLINERENDERER),
          (this.zOffset = 1),
          (this.scene = e),
          (this._engine = e.getEngine()),
          this.scene._addComponent(this);
      }
      return (
        (e.prototype.register = function () {
          this.scene._beforeRenderingMeshStage.registerStep(
            hi.STEP_BEFORERENDERINGMESH_OUTLINE,
            this,
            this._beforeRenderingMesh
          ),
            this.scene._afterRenderingMeshStage.registerStep(
              hi.STEP_AFTERRENDERINGMESH_OUTLINE,
              this,
              this._afterRenderingMesh
            );
        }),
        (e.prototype.rebuild = function () {}),
        (e.prototype.dispose = function () {}),
        (e.prototype.render = function (e, t, i) {
          var n = this;
          void 0 === i && (i = !1);
          var r = this.scene,
            o = r.getEngine(),
            s =
              o.getCaps().instancedArrays &&
              ((null !== t.visibleInstances[e._id] &&
                void 0 !== t.visibleInstances[e._id]) ||
                e.getRenderingMesh().hasThinInstances);
          if (this.isReady(e, s)) {
            var a = e.getMesh(),
              l = a._internalAbstractMeshDataInfo._actAsRegularMesh ? a : null,
              c = e.getRenderingMesh(),
              u = l || c,
              h = e.getMaterial();
            if (h && r.activeCamera) {
              if (
                (o.enableEffect(this._effect),
                h.useLogarithmicDepth &&
                  this._effect.setFloat(
                    "logarithmicDepthConstant",
                    2 / (Math.log(r.activeCamera.maxZ + 1) / Math.LN2)
                  ),
                this._effect.setFloat("offset", i ? 0 : c.outlineWidth),
                this._effect.setColor4(
                  "color",
                  i ? c.overlayColor : c.outlineColor,
                  i ? c.overlayAlpha : h.alpha
                ),
                this._effect.setMatrix(
                  "viewProjection",
                  r.getTransformMatrix()
                ),
                this._effect.setMatrix("world", u.getWorldMatrix()),
                c.useBones &&
                  c.computeBonesUsingShaders &&
                  c.skeleton &&
                  this._effect.setMatrices(
                    "mBones",
                    c.skeleton.getTransformMatrices(c)
                  ),
                Hr.BindMorphTargetParameters(c, this._effect),
                c._bind(e, this._effect, h.fillMode),
                h && h.needAlphaTesting())
              ) {
                var d = h.getAlphaTestTexture();
                d &&
                  (this._effect.setTexture("diffuseSampler", d),
                  this._effect.setMatrix(
                    "diffuseMatrix",
                    d.getTextureMatrix()
                  ));
              }
              o.setZOffset(-this.zOffset),
                c._processRendering(
                  u,
                  e,
                  this._effect,
                  h.fillMode,
                  t,
                  s,
                  function (e, t) {
                    n._effect.setMatrix("world", t);
                  }
                ),
                o.setZOffset(0);
            }
          }
        }),
        (e.prototype.isReady = function (e, t) {
          var i = [],
            n = [wt.PositionKind, wt.NormalKind],
            r = e.getMesh(),
            o = e.getMaterial();
          o &&
            (o.needAlphaTesting() &&
              (i.push("#define ALPHATEST"),
              r.isVerticesDataPresent(wt.UVKind) &&
                (n.push(wt.UVKind), i.push("#define UV1")),
              r.isVerticesDataPresent(wt.UV2Kind) &&
                (n.push(wt.UV2Kind), i.push("#define UV2"))),
            o.useLogarithmicDepth && i.push("#define LOGARITHMICDEPTH")),
            r.useBones && r.computeBonesUsingShaders
              ? (n.push(wt.MatricesIndicesKind),
                n.push(wt.MatricesWeightsKind),
                r.numBoneInfluencers > 4 &&
                  (n.push(wt.MatricesIndicesExtraKind),
                  n.push(wt.MatricesWeightsExtraKind)),
                i.push("#define NUM_BONE_INFLUENCERS " + r.numBoneInfluencers),
                i.push(
                  "#define BonesPerMesh " +
                    (r.skeleton ? r.skeleton.bones.length + 1 : 0)
                ))
              : i.push("#define NUM_BONE_INFLUENCERS 0");
          var s = r.morphTargetManager,
            a = 0;
          s &&
            s.numInfluencers > 0 &&
            ((a = s.numInfluencers),
            i.push("#define MORPHTARGETS"),
            i.push("#define NUM_MORPH_INFLUENCERS " + a),
            Hr.PrepareAttributesForMorphTargetsInfluencers(n, r, a)),
            t &&
              (i.push("#define INSTANCES"),
              Hr.PushAttributesForInstances(n),
              e.getRenderingMesh().hasThinInstances &&
                i.push("#define THIN_INSTANCES"));
          var l = i.join("\n");
          return (
            this._cachedDefines !== l &&
              ((this._cachedDefines = l),
              (this._effect = this.scene
                .getEngine()
                .createEffect(
                  "outline",
                  n,
                  [
                    "world",
                    "mBones",
                    "viewProjection",
                    "diffuseMatrix",
                    "offset",
                    "color",
                    "logarithmicDepthConstant",
                    "morphTargetInfluences",
                  ],
                  ["diffuseSampler"],
                  l,
                  void 0,
                  void 0,
                  void 0,
                  {
                    maxSimultaneousMorphTargets: a,
                  }
                ))),
            this._effect.isReady()
          );
        }),
        (e.prototype._beforeRenderingMesh = function (t, i, n) {
          if (
            ((this._savedDepthWrite = this._engine.getDepthWrite()),
            t.renderOutline)
          ) {
            var r = i.getMaterial();
            r &&
              r.needAlphaBlendingForMesh(t) &&
              (this._engine.cacheStencilState(),
              this._engine.setDepthWrite(!1),
              this._engine.setColorWrite(!1),
              this._engine.setStencilBuffer(!0),
              this._engine.setStencilOperationPass(7681),
              this._engine.setStencilFunction(519),
              this._engine.setStencilMask(e._StencilReference),
              this._engine.setStencilFunctionReference(e._StencilReference),
              this.render(i, n, !0),
              this._engine.setColorWrite(!0),
              this._engine.setStencilFunction(517)),
              this._engine.setDepthWrite(!1),
              this.render(i, n),
              this._engine.setDepthWrite(this._savedDepthWrite),
              r &&
                r.needAlphaBlendingForMesh(t) &&
                this._engine.restoreStencilState();
          }
        }),
        (e.prototype._afterRenderingMesh = function (e, t, i) {
          if (e.renderOverlay) {
            var n = this._engine.getAlphaMode(),
              r = this._engine.alphaState.alphaBlend;
            this._engine.setAlphaMode(2),
              this.render(t, i, !0),
              this._engine.setAlphaMode(n),
              this._engine.setDepthWrite(this._savedDepthWrite),
              (this._engine.alphaState.alphaBlend = r);
          }
          e.renderOutline &&
            this._savedDepthWrite &&
            (this._engine.setDepthWrite(!0),
            this._engine.setColorWrite(!1),
            this.render(t, i),
            this._engine.setColorWrite(!0));
        }),
        (e._StencilReference = 4),
        e
      );
    })(),
    Hd = (function (e) {
      function t(t, i) {
        var n = e.call(this) || this;
        return (
          (n.name = t),
          (n.animations = new Array()),
          (n.isPickable = !1),
          (n.useAlphaForPicking = !1),
          (n.onDisposeObservable = new o()),
          (n._onAnimationEnd = null),
          (n._endAnimation = function () {
            n._onAnimationEnd && n._onAnimationEnd(),
              n.disposeWhenFinishedAnimating && n.dispose();
          }),
          (n.color = new T(1, 1, 1, 1)),
          (n.position = f.Zero()),
          (n._manager = i),
          n._manager.sprites.push(n),
          (n.uniqueId = n._manager.scene.getUniqueId()),
          n
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "size", {
          get: function () {
            return this.width;
          },
          set: function (e) {
            (this.width = e), (this.height = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "manager", {
          get: function () {
            return this._manager;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getClassName = function () {
          return "Sprite";
        }),
        Object.defineProperty(t.prototype, "fromIndex", {
          get: function () {
            return this._fromIndex;
          },
          set: function (e) {
            this.playAnimation(
              e,
              this._toIndex,
              this._loopAnimation,
              this._delay,
              this._onAnimationEnd
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "toIndex", {
          get: function () {
            return this._toIndex;
          },
          set: function (e) {
            this.playAnimation(
              this._fromIndex,
              e,
              this._loopAnimation,
              this._delay,
              this._onAnimationEnd
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "loopAnimation", {
          get: function () {
            return this._loopAnimation;
          },
          set: function (e) {
            this.playAnimation(
              this._fromIndex,
              this._toIndex,
              e,
              this._delay,
              this._onAnimationEnd
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "delay", {
          get: function () {
            return Math.max(this._delay, 1);
          },
          set: function (e) {
            this.playAnimation(
              this._fromIndex,
              this._toIndex,
              this._loopAnimation,
              e,
              this._onAnimationEnd
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.playAnimation = function (t, i, n, r, o) {
          void 0 === o && (o = null),
            (this._onAnimationEnd = o),
            e.prototype.playAnimation.call(
              this,
              t,
              i,
              n,
              r,
              this._endAnimation
            );
        }),
        (t.prototype.dispose = function () {
          for (var e = 0; e < this._manager.sprites.length; e++)
            this._manager.sprites[e] == this &&
              this._manager.sprites.splice(e, 1);
          this.onDisposeObservable.notifyObservers(this),
            this.onDisposeObservable.clear();
        }),
        (t.prototype.serialize = function () {
          var e = {};
          return (
            (e.name = this.name),
            (e.position = this.position.asArray()),
            (e.color = this.color.asArray()),
            (e.width = this.width),
            (e.height = this.height),
            (e.angle = this.angle),
            (e.cellIndex = this.cellIndex),
            (e.cellRef = this.cellRef),
            (e.invertU = this.invertU),
            (e.invertV = this.invertV),
            (e.disposeWhenFinishedAnimating =
              this.disposeWhenFinishedAnimating),
            (e.isPickable = this.isPickable),
            (e.isVisible = this.isVisible),
            (e.useAlphaForPicking = this.useAlphaForPicking),
            (e.animationStarted = this.animationStarted),
            (e.fromIndex = this.fromIndex),
            (e.toIndex = this.toIndex),
            (e.loopAnimation = this.loopAnimation),
            (e.delay = this.delay),
            e
          );
        }),
        (t.Parse = function (e, i) {
          var n = new t(e.name, i);
          return (
            (n.position = f.FromArray(e.position)),
            (n.color = T.FromArray(e.color)),
            (n.width = e.width),
            (n.height = e.height),
            (n.angle = e.angle),
            (n.cellIndex = e.cellIndex),
            (n.cellRef = e.cellRef),
            (n.invertU = e.invertU),
            (n.invertV = e.invertV),
            (n.disposeWhenFinishedAnimating = e.disposeWhenFinishedAnimating),
            (n.isPickable = e.isPickable),
            (n.isVisible = e.isVisible),
            (n.useAlphaForPicking = e.useAlphaForPicking),
            (n.fromIndex = e.fromIndex),
            (n.toIndex = e.toIndex),
            (n.loopAnimation = e.loopAnimation),
            (n.delay = e.delay),
            e.animationStarted &&
              n.playAnimation(n.fromIndex, n.toIndex, n.loopAnimation, n.delay),
            n
          );
        }),
        t
      );
    })(
      (function () {
        function e() {
          (this.width = 1),
            (this.height = 1),
            (this.angle = 0),
            (this.invertU = !1),
            (this.invertV = !1),
            (this.isVisible = !0),
            (this._animationStarted = !1),
            (this._loopAnimation = !1),
            (this._fromIndex = 0),
            (this._toIndex = 0),
            (this._delay = 0),
            (this._direction = 1),
            (this._time = 0),
            (this._onBaseAnimationEnd = null),
            (this.position = {
              x: 1,
              y: 1,
              z: 1,
            }),
            (this.color = {
              r: 1,
              g: 1,
              b: 1,
              a: 1,
            });
        }
        return (
          Object.defineProperty(e.prototype, "animationStarted", {
            get: function () {
              return this._animationStarted;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "fromIndex", {
            get: function () {
              return this._fromIndex;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "toIndex", {
            get: function () {
              return this._toIndex;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "loopAnimation", {
            get: function () {
              return this._loopAnimation;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "delay", {
            get: function () {
              return Math.max(this._delay, 1);
            },
            enumerable: !1,
            configurable: !0,
          }),
          (e.prototype.playAnimation = function (e, t, i, n, r) {
            (this._fromIndex = e),
              (this._toIndex = t),
              (this._loopAnimation = i),
              (this._delay = n || 1),
              (this._animationStarted = !0),
              (this._onBaseAnimationEnd = r),
              e < t
                ? (this._direction = 1)
                : ((this._direction = -1),
                  (this._toIndex = e),
                  (this._fromIndex = t)),
              (this.cellIndex = e),
              (this._time = 0);
          }),
          (e.prototype.stopAnimation = function () {
            this._animationStarted = !1;
          }),
          (e.prototype._animate = function (e) {
            this._animationStarted &&
              ((this._time += e),
              this._time > this._delay &&
                ((this._time = this._time % this._delay),
                (this.cellIndex += this._direction),
                ((this._direction > 0 && this.cellIndex > this._toIndex) ||
                  (this._direction < 0 && this.cellIndex < this._fromIndex)) &&
                  (this._loopAnimation
                    ? (this.cellIndex =
                        this._direction > 0 ? this._fromIndex : this._toIndex)
                    : ((this.cellIndex = this._toIndex),
                      (this._animationStarted = !1),
                      this._onBaseAnimationEnd &&
                        this._onBaseAnimationEnd()))));
          }),
          e
        );
      })()
    );
  (Ci.prototype._internalPickSprites = function (e, t, i, n) {
    if (!Lt) return null;
    var r = null;
    if (!n) {
      if (!this.activeCamera) return null;
      n = this.activeCamera;
    }
    if (this.spriteManagers.length > 0)
      for (var o = 0; o < this.spriteManagers.length; o++) {
        var s = this.spriteManagers[o];
        if (s.isPickable) {
          var a = s.intersects(e, n, t, i);
          if (
            a &&
            a.hit &&
            (i || null == r || !(a.distance >= r.distance)) &&
            ((r = a), i)
          )
            break;
        }
      }
    return r || new Lt();
  }),
    (Ci.prototype._internalMultiPickSprites = function (e, t, i) {
      if (!Lt) return null;
      var n = new Array();
      if (!i) {
        if (!this.activeCamera) return null;
        i = this.activeCamera;
      }
      if (this.spriteManagers.length > 0)
        for (var r = 0; r < this.spriteManagers.length; r++) {
          var o = this.spriteManagers[r];
          if (o.isPickable) {
            var s = o.multiIntersects(e, i, t);
            null !== s && (n = n.concat(s));
          }
        }
      return n;
    }),
    (Ci.prototype.pickSprite = function (e, t, i, n, r) {
      return this._tempSpritePickingRay
        ? (this.createPickingRayInCameraSpaceToRef(
            e,
            t,
            this._tempSpritePickingRay,
            r
          ),
          this._internalPickSprites(this._tempSpritePickingRay, i, n, r))
        : null;
    }),
    (Ci.prototype.pickSpriteWithRay = function (e, t, i, n) {
      if (!this._tempSpritePickingRay) return null;
      if (!n) {
        if (!this.activeCamera) return null;
        n = this.activeCamera;
      }
      return (
        cn.TransformToRef(e, n.getViewMatrix(), this._tempSpritePickingRay),
        this._internalPickSprites(this._tempSpritePickingRay, t, i, n)
      );
    }),
    (Ci.prototype.multiPickSprite = function (e, t, i, n) {
      return (
        this.createPickingRayInCameraSpaceToRef(
          e,
          t,
          this._tempSpritePickingRay,
          n
        ),
        this._internalMultiPickSprites(this._tempSpritePickingRay, i, n)
      );
    }),
    (Ci.prototype.multiPickSpriteWithRay = function (e, t, i) {
      if (!this._tempSpritePickingRay) return null;
      if (!i) {
        if (!this.activeCamera) return null;
        i = this.activeCamera;
      }
      return (
        cn.TransformToRef(e, i.getViewMatrix(), this._tempSpritePickingRay),
        this._internalMultiPickSprites(this._tempSpritePickingRay, t, i)
      );
    }),
    (Ci.prototype.setPointerOverSprite = function (e) {
      this._pointerOverSprite !== e &&
        (this._pointerOverSprite &&
          this._pointerOverSprite.actionManager &&
          this._pointerOverSprite.actionManager.processTrigger(
            10,
            x.CreateNewFromSprite(this._pointerOverSprite, this)
          ),
        (this._pointerOverSprite = e),
        this._pointerOverSprite &&
          this._pointerOverSprite.actionManager &&
          this._pointerOverSprite.actionManager.processTrigger(
            9,
            x.CreateNewFromSprite(this._pointerOverSprite, this)
          ));
    }),
    (Ci.prototype.getPointerOverSprite = function () {
      return this._pointerOverSprite;
    });
  var jd = (function () {
    function e(e) {
      (this.name = hi.NAME_SPRITE),
        (this.scene = e),
        (this.scene.spriteManagers = new Array()),
        (this.scene._tempSpritePickingRay = cn ? cn.Zero() : null),
        (this.scene.onBeforeSpritesRenderingObservable = new o()),
        (this.scene.onAfterSpritesRenderingObservable = new o()),
        (this._spritePredicate = function (e) {
          return (
            !!e.actionManager &&
            e.isPickable &&
            e.actionManager.hasPointerTriggers
          );
        });
    }
    return (
      (e.prototype.register = function () {
        this.scene._pointerMoveStage.registerStep(
          hi.STEP_POINTERMOVE_SPRITE,
          this,
          this._pointerMove
        ),
          this.scene._pointerDownStage.registerStep(
            hi.STEP_POINTERDOWN_SPRITE,
            this,
            this._pointerDown
          ),
          this.scene._pointerUpStage.registerStep(
            hi.STEP_POINTERUP_SPRITE,
            this,
            this._pointerUp
          );
      }),
      (e.prototype.rebuild = function () {}),
      (e.prototype.dispose = function () {
        this.scene.onBeforeSpritesRenderingObservable.clear(),
          this.scene.onAfterSpritesRenderingObservable.clear();
        for (var e = this.scene.spriteManagers; e.length; ) e[0].dispose();
      }),
      (e.prototype._pickSpriteButKeepRay = function (e, t, i, n, r) {
        var o = this.scene.pickSprite(t, i, this._spritePredicate, n, r);
        return o && (o.ray = e ? e.ray : null), o;
      }),
      (e.prototype._pointerMove = function (e, t, i, n, r) {
        var o = this.scene;
        return (
          n
            ? o.setPointerOverSprite(null)
            : (i = this._pickSpriteButKeepRay(
                  i,
                  e,
                  t,
                  !1,
                  o.cameraToUseForPointers || void 0
                )) &&
                i.hit &&
                i.pickedSprite
              ? (o.setPointerOverSprite(i.pickedSprite),
                o.doNotHandleCursors ||
                  (o._pointerOverSprite &&
                  o._pointerOverSprite.actionManager &&
                  o._pointerOverSprite.actionManager.hoverCursor
                    ? (r.style.cursor =
                        o._pointerOverSprite.actionManager.hoverCursor)
                    : (r.style.cursor = o.hoverCursor)))
              : o.setPointerOverSprite(null),
          i
        );
      }),
      (e.prototype._pointerDown = function (e, t, i, n) {
        var r = this.scene;
        if (
          ((r._pickedDownSprite = null),
          r.spriteManagers.length > 0 &&
            (i = r.pickSprite(
              e,
              t,
              this._spritePredicate,
              !1,
              r.cameraToUseForPointers || void 0
            )) &&
            i.hit &&
            i.pickedSprite &&
            i.pickedSprite.actionManager)
        ) {
          switch (((r._pickedDownSprite = i.pickedSprite), n.button)) {
            case 0:
              i.pickedSprite.actionManager.processTrigger(
                2,
                x.CreateNewFromSprite(i.pickedSprite, r, n)
              );
              break;
            case 1:
              i.pickedSprite.actionManager.processTrigger(
                4,
                x.CreateNewFromSprite(i.pickedSprite, r, n)
              );
              break;
            case 2:
              i.pickedSprite.actionManager.processTrigger(
                3,
                x.CreateNewFromSprite(i.pickedSprite, r, n)
              );
          }
          i.pickedSprite.actionManager &&
            i.pickedSprite.actionManager.processTrigger(
              5,
              x.CreateNewFromSprite(i.pickedSprite, r, n)
            );
        }
        return i;
      }),
      (e.prototype._pointerUp = function (e, t, i, n) {
        var r = this.scene;
        if (r.spriteManagers.length > 0) {
          var o = r.pickSprite(
            e,
            t,
            this._spritePredicate,
            !1,
            r.cameraToUseForPointers || void 0
          );
          o &&
            (o.hit &&
              o.pickedSprite &&
              o.pickedSprite.actionManager &&
              (o.pickedSprite.actionManager.processTrigger(
                7,
                x.CreateNewFromSprite(o.pickedSprite, r, n)
              ),
              o.pickedSprite.actionManager &&
                (this.scene._inputManager._isPointerSwiping() ||
                  o.pickedSprite.actionManager.processTrigger(
                    1,
                    x.CreateNewFromSprite(o.pickedSprite, r, n)
                  ))),
            r._pickedDownSprite &&
              r._pickedDownSprite.actionManager &&
              r._pickedDownSprite !== o.pickedSprite &&
              r._pickedDownSprite.actionManager.processTrigger(
                16,
                x.CreateNewFromSprite(r._pickedDownSprite, r, n)
              ));
        }
        return i;
      }),
      e
    );
  })();
  Ke.IncludesShadersStore.imageProcessingCompatibility =
    "#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif";
  Ke.ShadersStore.spritesPixelShader =
    "uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest)\n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";
  Ke.ShadersStore.spritesVertexShader =
    "\nattribute vec4 position;\nattribute vec2 options;\nattribute vec2 offsets;\nattribute vec2 inverts;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) {\nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz;\nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=offsets.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0);\n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-inverts.x),abs(1.0-offset.y-inverts.y));\nvec2 uvPlace=cellInfo.xy;\nvec2 uvSize=cellInfo.zw;\nvUV.x=uvPlace.x+uvSize.x*uvOffset.x;\nvUV.y=uvPlace.y+uvSize.y*uvOffset.y;\n\n#ifdef FOG\nvFogDistance=viewPos;\n#endif\n}";
  var Xd = (function () {
      function e(e, t, i, n) {
        if (
          (void 0 === i && (i = 0.01),
          void 0 === n && (n = null),
          (this.blendMode = 2),
          (this.autoResetAlpha = !0),
          (this.disableDepthWrite = !1),
          (this.fogEnabled = !0),
          (this._useVAO = !1),
          (this._useInstancing = !1),
          (this._vertexBuffers = {}),
          (this._capacity = t),
          (this._epsilon = i),
          (this._engine = e),
          (this._useInstancing = e.getCaps().instancedArrays),
          (this._useVAO =
            e.getCaps().vertexArrayObject && !e.disableVertexArrayObjects),
          (this._scene = n),
          !this._useInstancing)
        ) {
          for (var r = [], o = 0, s = 0; s < t; s++)
            r.push(o),
              r.push(o + 1),
              r.push(o + 2),
              r.push(o),
              r.push(o + 2),
              r.push(o + 3),
              (o += 4);
          this._indexBuffer = e.createIndexBuffer(r);
        }
        (this._vertexBufferSize = this._useInstancing ? 16 : 18),
          (this._vertexData = new Float32Array(
            t * this._vertexBufferSize * (this._useInstancing ? 1 : 4)
          )),
          (this._buffer = new Dt(
            e,
            this._vertexData,
            !0,
            this._vertexBufferSize
          ));
        var a,
          l = this._buffer.createVertexBuffer(
            wt.PositionKind,
            0,
            4,
            this._vertexBufferSize,
            this._useInstancing
          ),
          c = this._buffer.createVertexBuffer(
            "options",
            4,
            2,
            this._vertexBufferSize,
            this._useInstancing
          ),
          u = 6;
        if (this._useInstancing) {
          var h = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]);
          (this._spriteBuffer = new Dt(e, h, !1, 2)),
            (a = this._spriteBuffer.createVertexBuffer("offsets", 0, 2));
        } else
          (a = this._buffer.createVertexBuffer(
            "offsets",
            u,
            2,
            this._vertexBufferSize,
            this._useInstancing
          )),
            (u += 2);
        var d = this._buffer.createVertexBuffer(
            "inverts",
            u,
            2,
            this._vertexBufferSize,
            this._useInstancing
          ),
          p = this._buffer.createVertexBuffer(
            "cellInfo",
            u + 2,
            4,
            this._vertexBufferSize,
            this._useInstancing
          ),
          f = this._buffer.createVertexBuffer(
            wt.ColorKind,
            u + 6,
            4,
            this._vertexBufferSize,
            this._useInstancing
          );
        (this._vertexBuffers[wt.PositionKind] = l),
          (this._vertexBuffers.options = c),
          (this._vertexBuffers.offsets = a),
          (this._vertexBuffers.inverts = d),
          (this._vertexBuffers.cellInfo = p),
          (this._vertexBuffers[wt.ColorKind] = f),
          (this._effectBase = this._engine.createEffect(
            "sprites",
            [
              wt.PositionKind,
              "options",
              "offsets",
              "inverts",
              "cellInfo",
              wt.ColorKind,
            ],
            ["view", "projection", "textureInfos", "alphaTest"],
            ["diffuseSampler"],
            ""
          )),
          this._scene &&
            (this._effectFog = this._scene
              .getEngine()
              .createEffect(
                "sprites",
                [
                  wt.PositionKind,
                  "options",
                  "offsets",
                  "inverts",
                  "cellInfo",
                  wt.ColorKind,
                ],
                [
                  "view",
                  "projection",
                  "textureInfos",
                  "alphaTest",
                  "vFogInfos",
                  "vFogColor",
                ],
                ["diffuseSampler"],
                "#define FOG"
              ));
      }
      return (
        Object.defineProperty(e.prototype, "capacity", {
          get: function () {
            return this._capacity;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.render = function (e, t, i, n, r) {
          if (
            (void 0 === r && (r = null),
            this.texture && this.texture.isReady() && e.length)
          ) {
            var o = this._effectBase,
              s = !1;
            if (
              (this.fogEnabled &&
                this._scene &&
                this._scene.fogEnabled &&
                0 !== this._scene.fogMode &&
                ((o = this._effectFog), (s = !0)),
              o.isReady())
            ) {
              for (
                var a = this._engine,
                  l = !(!this._scene || !this._scene.useRightHandedSystem),
                  c = this.texture.getBaseSize(),
                  u = Math.min(this._capacity, e.length),
                  h = 0,
                  d = !0,
                  p = 0;
                p < u;
                p++
              ) {
                var f = e[p];
                f &&
                  f.isVisible &&
                  ((d = !1),
                  f._animate(t),
                  this._appendSpriteVertex(h++, f, 0, 0, c, l, r),
                  this._useInstancing ||
                    (this._appendSpriteVertex(h++, f, 1, 0, c, l, r),
                    this._appendSpriteVertex(h++, f, 1, 1, c, l, r),
                    this._appendSpriteVertex(h++, f, 0, 1, c, l, r)));
              }
              if (!d) {
                this._buffer.update(this._vertexData);
                var _ = a.depthCullingState.cull || !0,
                  m = a.depthCullingState.zOffset;
                if (
                  (l && this._scene.getEngine().setState(_, m, !1, !1),
                  a.enableEffect(o),
                  o.setTexture("diffuseSampler", this.texture),
                  o.setMatrix("view", i),
                  o.setMatrix("projection", n),
                  s)
                ) {
                  var g = this._scene;
                  o.setFloat4(
                    "vFogInfos",
                    g.fogMode,
                    g.fogStart,
                    g.fogEnd,
                    g.fogDensity
                  ),
                    o.setColor3("vFogColor", g.fogColor);
                }
                this._useVAO
                  ? (this._vertexArrayObject ||
                      (this._vertexArrayObject = a.recordVertexArrayObject(
                        this._vertexBuffers,
                        this._indexBuffer,
                        o
                      )),
                    a.bindVertexArrayObject(
                      this._vertexArrayObject,
                      this._indexBuffer
                    ))
                  : a.bindBuffers(this._vertexBuffers, this._indexBuffer, o),
                  (a.depthCullingState.depthFunc = 515),
                  this.disableDepthWrite ||
                    (o.setBool("alphaTest", !0),
                    a.setColorWrite(!1),
                    this._useInstancing
                      ? a.drawArraysType(8, 0, 4, h)
                      : a.drawElementsType(0, 0, (h / 4) * 6),
                    a.setColorWrite(!0),
                    o.setBool("alphaTest", !1)),
                  a.setAlphaMode(this.blendMode),
                  this._useInstancing
                    ? a.drawArraysType(8, 0, 4, h)
                    : a.drawElementsType(0, 0, (h / 4) * 6),
                  this.autoResetAlpha && a.setAlphaMode(0),
                  l && this._scene.getEngine().setState(_, m, !1, !0),
                  a.unbindInstanceAttributes();
              }
            }
          }
        }),
        (e.prototype._appendSpriteVertex = function (e, t, i, n, r, o, s) {
          var a = e * this._vertexBufferSize;
          if (
            (0 === i ? (i = this._epsilon) : 1 === i && (i = 1 - this._epsilon),
            0 === n ? (n = this._epsilon) : 1 === n && (n = 1 - this._epsilon),
            s)
          )
            s(t, r);
          else {
            t.cellIndex || (t.cellIndex = 0);
            var l = r.width / this.cellWidth,
              c = (t.cellIndex / l) >> 0;
            (t._xOffset = ((t.cellIndex - c * l) * this.cellWidth) / r.width),
              (t._yOffset = (c * this.cellHeight) / r.height),
              (t._xSize = this.cellWidth),
              (t._ySize = this.cellHeight);
          }
          (this._vertexData[a] = t.position.x),
            (this._vertexData[a + 1] = t.position.y),
            (this._vertexData[a + 2] = t.position.z),
            (this._vertexData[a + 3] = t.angle),
            (this._vertexData[a + 4] = t.width),
            (this._vertexData[a + 5] = t.height),
            this._useInstancing
              ? (a -= 2)
              : ((this._vertexData[a + 6] = i), (this._vertexData[a + 7] = n)),
            (this._vertexData[a + 8] = o
              ? t.invertU
                ? 0
                : 1
              : t.invertU
                ? 1
                : 0),
            (this._vertexData[a + 9] = t.invertV ? 1 : 0),
            (this._vertexData[a + 10] = t._xOffset),
            (this._vertexData[a + 11] = t._yOffset),
            (this._vertexData[a + 12] = t._xSize / r.width),
            (this._vertexData[a + 13] = t._ySize / r.height),
            (this._vertexData[a + 14] = t.color.r),
            (this._vertexData[a + 15] = t.color.g),
            (this._vertexData[a + 16] = t.color.b),
            (this._vertexData[a + 17] = t.color.a);
        }),
        (e.prototype.dispose = function () {
          this._buffer && (this._buffer.dispose(), (this._buffer = null)),
            this._spriteBuffer &&
              (this._spriteBuffer.dispose(), (this._spriteBuffer = null)),
            this._indexBuffer &&
              (this._engine._releaseBuffer(this._indexBuffer),
              (this._indexBuffer = null)),
            this._vertexArrayObject &&
              (this._engine.releaseVertexArrayObject(this._vertexArrayObject),
              (this._vertexArrayObject = null)),
            this.texture && (this.texture.dispose(), (this.texture = null));
        }),
        e
      );
    })(),
    Yd = (function () {
      function e(e, t, i, n, r, s, a, l, c) {
        var u = this;
        void 0 === s && (s = 0.01),
          void 0 === a && (a = mn.TRILINEAR_SAMPLINGMODE),
          void 0 === l && (l = !1),
          void 0 === c && (c = null),
          (this.name = e),
          (this.sprites = new Array()),
          (this.renderingGroupId = 0),
          (this.layerMask = 268435455),
          (this.isPickable = !1),
          (this.onDisposeObservable = new o()),
          (this.disableDepthWrite = !1),
          (this._packedAndReady = !1),
          (this._customUpdate = function (e, t) {
            e.cellRef || (e.cellIndex = 0);
            var i = e.cellIndex;
            "number" == typeof i &&
              isFinite(i) &&
              Math.floor(i) === i &&
              (e.cellRef = u._spriteMap[e.cellIndex]),
              (e._xOffset = u._cellData[e.cellRef].frame.x / t.width),
              (e._yOffset = u._cellData[e.cellRef].frame.y / t.height),
              (e._xSize = u._cellData[e.cellRef].frame.w),
              (e._ySize = u._cellData[e.cellRef].frame.h);
          }),
          r || (r = It.LastCreatedScene),
          r._getComponent(hi.NAME_SPRITE) || r._addComponent(new jd(r)),
          (this._fromPacked = l),
          (this._scene = r);
        var h = this._scene.getEngine();
        if (((this._spriteRenderer = new Xd(h, i, s, r)), n.width && n.height))
          (this.cellWidth = n.width), (this.cellHeight = n.height);
        else {
          if (void 0 === n) return void (this._spriteRenderer = null);
          (this.cellWidth = n), (this.cellHeight = n);
        }
        this._scene.spriteManagers.push(this),
          (this.uniqueId = this.scene.getUniqueId()),
          t && (this.texture = new mn(t, r, !0, !1, a)),
          this._fromPacked && this._makePacked(t, c);
      }
      return (
        Object.defineProperty(e.prototype, "onDispose", {
          set: function (e) {
            this._onDisposeObserver &&
              this.onDisposeObservable.remove(this._onDisposeObserver),
              (this._onDisposeObserver = this.onDisposeObservable.add(e));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "children", {
          get: function () {
            return this.sprites;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "scene", {
          get: function () {
            return this._scene;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "capacity", {
          get: function () {
            return this._spriteRenderer.capacity;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "texture", {
          get: function () {
            return this._spriteRenderer.texture;
          },
          set: function (e) {
            (e.wrapU = mn.CLAMP_ADDRESSMODE),
              (e.wrapV = mn.CLAMP_ADDRESSMODE),
              (this._spriteRenderer.texture = e),
              (this._textureContent = null);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "cellWidth", {
          get: function () {
            return this._spriteRenderer.cellWidth;
          },
          set: function (e) {
            this._spriteRenderer.cellWidth = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "cellHeight", {
          get: function () {
            return this._spriteRenderer.cellHeight;
          },
          set: function (e) {
            this._spriteRenderer.cellHeight = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "fogEnabled", {
          get: function () {
            return this._spriteRenderer.fogEnabled;
          },
          set: function (e) {
            this._spriteRenderer.fogEnabled = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "blendMode", {
          get: function () {
            return this._spriteRenderer.blendMode;
          },
          set: function (e) {
            this._spriteRenderer.blendMode = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.getClassName = function () {
          return "SpriteManager";
        }),
        (e.prototype._makePacked = function (e, t) {
          var i = this;
          if (null !== t)
            try {
              var n = void 0;
              if (
                (n = "string" == typeof t ? JSON.parse(t) : t).frames.length
              ) {
                for (var r = {}, o = 0; o < n.frames.length; o++) {
                  var s = n.frames[o];
                  if ("string" != typeof Object.keys(s)[0])
                    throw new Error(
                      "Invalid JSON Format.  Check the frame values and make sure the name is the first parameter."
                    );
                  r[s[Object.keys(s)[0]]] = s;
                }
                n.frames = r;
              }
              var a = Reflect.ownKeys(n.frames);
              (this._spriteMap = a),
                (this._packedAndReady = !0),
                (this._cellData = n.frames);
            } catch (e) {
              throw (
                ((this._fromPacked = !1),
                (this._packedAndReady = !1),
                new Error(
                  "Invalid JSON from string. Spritesheet managed with constant cell size."
                ))
              );
            }
          else {
            var l = /\./g,
              c = void 0;
            do {
              (c = l.lastIndex), l.test(e);
            } while (l.lastIndex > 0);
            var u = e.substring(0, c - 1) + ".json",
              h = new XMLHttpRequest();
            h.open("GET", u, !0),
              (h.onerror = function () {
                F.Error("JSON ERROR: Unable to load JSON file."),
                  (i._fromPacked = !1),
                  (i._packedAndReady = !1);
              }),
              (h.onload = function () {
                try {
                  var e = JSON.parse(h.response),
                    t = Reflect.ownKeys(e.frames);
                  (i._spriteMap = t),
                    (i._packedAndReady = !0),
                    (i._cellData = e.frames);
                } catch (e) {
                  throw (
                    ((i._fromPacked = !1),
                    (i._packedAndReady = !1),
                    new Error(
                      "Invalid JSON format. Please check documentation for format specifications."
                    ))
                  );
                }
              }),
              h.send();
          }
        }),
        (e.prototype._checkTextureAlpha = function (e, t, i, n, r) {
          if (!e.useAlphaForPicking || !this.texture) return !0;
          var o = this.texture.getSize();
          this._textureContent ||
            ((this._textureContent = new Uint8Array(o.width * o.height * 4)),
            this.texture.readPixels(0, 0, this._textureContent));
          var s = y.Vector3[0];
          s.copyFrom(t.direction),
            s.normalize(),
            s.scaleInPlace(i),
            s.addInPlace(t.origin);
          var a = (s.x - n.x) / (r.x - n.x) - 0.5,
            l = 1 - (s.y - n.y) / (r.y - n.y) - 0.5,
            c = e.angle,
            u = a * Math.cos(c) - l * Math.sin(c) + 0.5,
            h = a * Math.sin(c) + l * Math.cos(c) + 0.5,
            d = (e._xOffset * o.width + u * e._xSize) | 0,
            p = (e._yOffset * o.height + h * e._ySize) | 0;
          return this._textureContent[4 * (d + p * o.width) + 3] > 0.5;
        }),
        (e.prototype.intersects = function (e, t, i, n) {
          for (
            var r = Math.min(this.capacity, this.sprites.length),
              o = f.Zero(),
              s = f.Zero(),
              a = Number.MAX_VALUE,
              l = null,
              c = y.Vector3[0],
              u = y.Vector3[1],
              h = t.getViewMatrix(),
              d = 0;
            d < r;
            d++
          ) {
            var p = this.sprites[d];
            if (p) {
              if (i) {
                if (!i(p)) continue;
              } else if (!p.isPickable) continue;
              if (
                (f.TransformCoordinatesToRef(p.position, h, u),
                o.copyFromFloats(u.x - p.width / 2, u.y - p.height / 2, u.z),
                s.copyFromFloats(u.x + p.width / 2, u.y + p.height / 2, u.z),
                e.intersectsBoxMinMax(o, s))
              ) {
                var _ = f.Distance(u, e.origin);
                if (a > _) {
                  if (!this._checkTextureAlpha(p, e, _, o, s)) continue;
                  if (((a = _), (l = p), n)) break;
                }
              }
            }
          }
          if (l) {
            var m = new Lt();
            h.invertToRef(y.Matrix[0]),
              (m.hit = !0),
              (m.pickedSprite = l),
              (m.distance = a);
            var g = y.Vector3[2];
            return (
              g.copyFrom(e.direction),
              g.normalize(),
              g.scaleInPlace(a),
              e.origin.addToRef(g, c),
              (m.pickedPoint = f.TransformCoordinates(c, y.Matrix[0])),
              m
            );
          }
          return null;
        }),
        (e.prototype.multiIntersects = function (e, t, i) {
          for (
            var n,
              r = Math.min(this.capacity, this.sprites.length),
              o = f.Zero(),
              s = f.Zero(),
              a = [],
              l = y.Vector3[0].copyFromFloats(0, 0, 0),
              c = y.Vector3[1].copyFromFloats(0, 0, 0),
              u = t.getViewMatrix(),
              h = 0;
            h < r;
            h++
          ) {
            var d = this.sprites[h];
            if (d) {
              if (i) {
                if (!i(d)) continue;
              } else if (!d.isPickable) continue;
              if (
                (f.TransformCoordinatesToRef(d.position, u, c),
                o.copyFromFloats(c.x - d.width / 2, c.y - d.height / 2, c.z),
                s.copyFromFloats(c.x + d.width / 2, c.y + d.height / 2, c.z),
                e.intersectsBoxMinMax(o, s))
              ) {
                if (
                  ((n = f.Distance(c, e.origin)),
                  !this._checkTextureAlpha(d, e, n, o, s))
                )
                  continue;
                var p = new Lt();
                a.push(p),
                  u.invertToRef(y.Matrix[0]),
                  (p.hit = !0),
                  (p.pickedSprite = d),
                  (p.distance = n);
                var _ = y.Vector3[2];
                _.copyFrom(e.direction),
                  _.normalize(),
                  _.scaleInPlace(n),
                  e.origin.addToRef(_, l),
                  (p.pickedPoint = f.TransformCoordinates(l, y.Matrix[0]));
              }
            }
          }
          return a;
        }),
        (e.prototype.render = function () {
          if (
            !this._fromPacked ||
            (this._packedAndReady && this._spriteMap && this._cellData)
          ) {
            var e = this._scene.getEngine().getDeltaTime();
            this._packedAndReady
              ? this._spriteRenderer.render(
                  this.sprites,
                  e,
                  this._scene.getViewMatrix(),
                  this._scene.getProjectionMatrix(),
                  this._customUpdate
                )
              : this._spriteRenderer.render(
                  this.sprites,
                  e,
                  this._scene.getViewMatrix(),
                  this._scene.getProjectionMatrix()
                );
          }
        }),
        (e.prototype.dispose = function () {
          this._spriteRenderer &&
            (this._spriteRenderer.dispose(), (this._spriteRenderer = null)),
            (this._textureContent = null);
          var e = this._scene.spriteManagers.indexOf(this);
          this._scene.spriteManagers.splice(e, 1),
            this.onDisposeObservable.notifyObservers(this),
            this.onDisposeObservable.clear();
        }),
        (e.prototype.serialize = function (e) {
          void 0 === e && (e = !1);
          var t = {};
          (t.name = this.name),
            (t.capacity = this.capacity),
            (t.cellWidth = this.cellWidth),
            (t.cellHeight = this.cellHeight),
            this.texture &&
              (e
                ? (t.texture = this.texture.serialize())
                : ((t.textureUrl = this.texture.name),
                  (t.invertY = this.texture._invertY))),
            (t.sprites = []);
          for (var i = 0, n = this.sprites; i < n.length; i++) {
            var r = n[i];
            t.sprites.push(r.serialize());
          }
          return t;
        }),
        (e.Parse = function (t, i, n) {
          var r = new e(
            t.name,
            "",
            t.capacity,
            {
              width: t.cellWidth,
              height: t.cellHeight,
            },
            i
          );
          t.texture
            ? (r.texture = mn.Parse(t.texture, i, n))
            : t.textureName &&
              (r.texture = new mn(
                n + t.textureUrl,
                i,
                !1,
                void 0 === t.invertY || t.invertY
              ));
          for (var o = 0, s = t.sprites; o < s.length; o++) {
            var a = s[o];
            Hd.Parse(a, r);
          }
          return r;
        }),
        (e.ParseFromFileAsync = function (t, i, n, r) {
          return (
            void 0 === r && (r = ""),
            new Promise(function (o, s) {
              var a = new Te();
              a.addEventListener("readystatechange", function () {
                if (4 == a.readyState)
                  if (200 == a.status) {
                    var i = JSON.parse(a.responseText),
                      l = e.Parse(i, n || It.LastCreatedScene, r);
                    t && (l.name = t), o(l);
                  } else s("Unable to load the sprite manager");
              }),
                a.open("GET", i),
                a.send();
            })
          );
        }),
        (e.CreateFromSnippetAsync = function (t, i, n) {
          var r = this;
          return (
            void 0 === n && (n = ""),
            "_BLANK" === t
              ? Promise.resolve(
                  new e(
                    "Default sprite manager",
                    "//playground.babylonjs.com/textures/player.png",
                    500,
                    64,
                    i
                  )
                )
              : new Promise(function (o, s) {
                  var a = new Te();
                  a.addEventListener("readystatechange", function () {
                    if (4 == a.readyState)
                      if (200 == a.status) {
                        var r = JSON.parse(
                            JSON.parse(a.responseText).jsonPayload
                          ),
                          l = JSON.parse(r.spriteManager),
                          c = e.Parse(l, i || It.LastCreatedScene, n);
                        (c.snippetId = t), o(c);
                      } else s("Unable to load the snippet " + t);
                  }),
                    a.open("GET", r.SnippetUrl + "/" + t.replace(/#/g, "/")),
                    a.send();
                })
          );
        }),
        (e.SnippetUrl = "https://snippet.babylonjs.com"),
        e
      );
    })();
  Ke.ShadersStore.spriteMapPixelShader =
    "precision highp float;\nvarying vec3 vPosition;\nvarying vec2 vUV;\nvarying vec2 tUV;\nuniform float time;\nuniform float spriteCount;\nuniform sampler2D spriteSheet;\nuniform vec2 spriteMapSize;\nuniform vec2 outputSize;\nuniform vec2 stageSize;\nuniform sampler2D frameMap;\nuniform sampler2D tileMaps[LAYERS];\nuniform sampler2D animationMap;\nuniform vec3 colorMul;\nfloat mt;\nconst float fdStep=1./4.;\nconst float aFrameSteps=1./MAX_ANIMATION_FRAMES;\nmat4 getFrameData(float frameID){\nfloat fX=frameID/spriteCount;\nreturn mat4(\ntexture2D(frameMap,vec2(fX,0.),0.),\ntexture2D(frameMap,vec2(fX,fdStep*1.),0.),\ntexture2D(frameMap,vec2(fX,fdStep*2.),0.),\nvec4(0.)\n);\n}\nvoid main(){\nvec4 color=vec4(0.);\nvec2 tileUV=fract(tUV);\n#ifdef FLIPU\ntileUV.y=1.0-tileUV.y;\n#endif\nvec2 tileID=floor(tUV);\nvec2 sheetUnits=1./spriteMapSize;\nfloat spriteUnits=1./spriteCount;\nvec2 stageUnits=1./stageSize;\nfor(int i=0; i<LAYERS; i++) {\nfloat frameID;\n#define LAYER_ID_SWITCH\nvec4 animationData=texture2D(animationMap,vec2((frameID+0.5)/spriteCount,0.),0.);\nif(animationData.y>0.) {\nmt=mod(time*animationData.z,1.0);\nfor(float f=0.; f<MAX_ANIMATION_FRAMES; f++){\nif(animationData.y>mt){\nframeID=animationData.x;\nbreak;\n}\nanimationData=texture2D(animationMap,vec2((frameID+0.5)/spriteCount,aFrameSteps*f),0.);\n}\n}\n\nmat4 frameData=getFrameData(frameID+0.5);\nvec2 frameSize=(frameData[0].wz)/spriteMapSize;\nvec2 offset=frameData[0].xy*sheetUnits;\nvec2 ratio=frameData[2].xy/frameData[0].wz;\n\nif (frameData[2].z == 1.){\ntileUV.xy=tileUV.yx;\n}\nif (i == 0){\ncolor=texture2D(spriteSheet,tileUV*frameSize+offset);\n} else {\nvec4 nc=texture2D(spriteSheet,tileUV*frameSize+offset);\nfloat alpha=min(color.a+nc.a,1.0);\nvec3 mixed=mix(color.xyz,nc.xyz,nc.a);\ncolor=vec4(mixed,alpha);\n}\n}\ncolor.xyz*=colorMul;\ngl_FragColor=color;\n}";
  var Kd, Qd;
  (Ke.ShadersStore.spriteMapVertexShader =
    "precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\nvarying vec3 vPosition;\nvarying vec2 vUV;\nvarying vec2 tUV;\nvarying vec2 stageUnits;\nvarying vec2 levelUnits;\nvarying vec2 tileID;\n\nuniform float time;\nuniform mat4 worldViewProjection;\nuniform vec2 outputSize;\nuniform vec2 stageSize;\nuniform vec2 spriteMapSize;\nuniform float stageScale;\nvoid main() {\nvec4 p=vec4( position,1. );\nvPosition=p.xyz;\nvUV=uv;\ntUV=uv*stageSize;\ngl_Position=worldViewProjection*p;\n}"),
    (function () {
      function e(e, t, i, n, r) {
        var o = this;
        (this.name = e),
          (this.sprites = []),
          (this.atlasJSON = t),
          (this.sprites = this.atlasJSON.frames),
          (this.spriteSheet = i),
          (this.options = n),
          (n.stageSize = n.stageSize || new p(1, 1)),
          (n.outputSize = n.outputSize || n.stageSize),
          (n.outputPosition = n.outputPosition || f.Zero()),
          (n.outputRotation = n.outputRotation || f.Zero()),
          (n.layerCount = n.layerCount || 1),
          (n.maxAnimationFrames = n.maxAnimationFrames || 0),
          (n.baseTile = n.baseTile || 0),
          (n.flipU = n.flipU || !1),
          (n.colorMultiply = n.colorMultiply || new f(1, 1, 1)),
          (this._scene = r),
          (this._frameMap = this._createFrameBuffer()),
          (this._tileMaps = new Array());
        for (var s = 0; s < n.layerCount; s++)
          this._tileMaps.push(this._createTileBuffer(null, s));
        this._animationMap = this._createTileAnimationBuffer(null);
        var a = [];
        a.push("#define LAYERS " + n.layerCount),
          n.flipU && a.push("#define FLIPU"),
          a.push("#define MAX_ANIMATION_FRAMES " + n.maxAnimationFrames + ".0");
        var l,
          c = Ke.ShadersStore.spriteMapPixelShader;
        if (1 === this._scene.getEngine().webGLVersion)
          for (l = "", s = 0; s < n.layerCount; s++)
            l +=
              "if (" +
              s +
              " == i) { frameID = texture2D(tileMaps[" +
              s +
              "], (tileID + 0.5) / stageSize, 0.).x; }";
        else {
          for (l = "switch(i) {", s = 0; s < n.layerCount; s++)
            (l +=
              "case " +
              s +
              " : frameID = texture(tileMaps[" +
              s +
              "], (tileID + 0.5) / stageSize, 0.).x;"),
              (l += "break;");
          l += "}";
        }
        (Ke.ShadersStore["spriteMap" + this.name + "PixelShader"] = c.replace(
          "#define LAYER_ID_SWITCH",
          l
        )),
          (this._material = new Do(
            "spriteMap:" + this.name,
            this._scene,
            {
              vertex: "spriteMap",
              fragment: "spriteMap" + this.name,
            },
            {
              defines: a,
              attributes: ["position", "normal", "uv"],
              uniforms: [
                "worldViewProjection",
                "time",
                "stageSize",
                "outputSize",
                "spriteMapSize",
                "spriteCount",
                "time",
                "colorMul",
                "mousePosition",
                "curTile",
                "flipU",
              ],
              samplers: ["spriteSheet", "frameMap", "tileMaps", "animationMap"],
              needAlphaBlending: !0,
            }
          )),
          (this._time = 0),
          this._material.setFloat("spriteCount", this.spriteCount),
          this._material.setVector2("stageSize", n.stageSize),
          this._material.setVector2("outputSize", n.outputSize),
          this._material.setTexture("spriteSheet", this.spriteSheet),
          this._material.setVector2("spriteMapSize", new p(1, 1)),
          this._material.setVector3("colorMul", n.colorMultiply);
        var u = 0,
          h = function () {
            o.spriteSheet && o.spriteSheet.isReady() && o.spriteSheet._texture
              ? o._material.setVector2(
                  "spriteMapSize",
                  new p(
                    o.spriteSheet._texture.baseWidth || 1,
                    o.spriteSheet._texture.baseHeight || 1
                  )
                )
              : u < 100 &&
                setTimeout(function () {
                  u++, h();
                }, 100);
          };
        h(),
          this._material.setVector3("colorMul", n.colorMultiply),
          this._material.setTexture("frameMap", this._frameMap),
          this._material.setTextureArray("tileMaps", this._tileMaps),
          this._material.setTexture("animationMap", this._animationMap),
          this._material.setFloat("time", this._time),
          (this._output = Qi.CreatePlane(e + ":output", 1, r, !0)),
          (this._output.scaling.x = n.outputSize.x),
          (this._output.scaling.y = n.outputSize.y),
          (this.position = n.outputPosition),
          (this.rotation = n.outputRotation),
          this._scene.onBeforeRenderObservable.add(function () {
            (o._time += o._scene.getEngine().getDeltaTime()),
              o._material.setFloat("time", o._time);
          }),
          (this._output.material = this._material);
      }
      Object.defineProperty(e.prototype, "spriteCount", {
        get: function () {
          return this.sprites.length;
        },
        enumerable: !1,
        configurable: !0,
      }),
        Object.defineProperty(e.prototype, "position", {
          get: function () {
            return this._output.position;
          },
          set: function (e) {
            this._output.position = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "rotation", {
          get: function () {
            return this._output.rotation;
          },
          set: function (e) {
            this._output.rotation = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "animationMap", {
          get: function () {
            return this._animationMap;
          },
          set: function (e) {
            var t = e._texture._bufferView,
              i = this._createTileAnimationBuffer(t);
            this._animationMap.dispose(),
              (this._animationMap = i),
              this._material.setTexture("animationMap", this._animationMap);
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.getTileID = function () {
          var e = this.getMousePosition();
          return (
            e.multiplyInPlace(this.options.stageSize || p.Zero()),
            (e.x = Math.floor(e.x)),
            (e.y = Math.floor(e.y)),
            e
          );
        }),
        (e.prototype.getMousePosition = function () {
          var e = this._output,
            t = this._scene.pick(
              this._scene.pointerX,
              this._scene.pointerY,
              function (t) {
                return t === e;
              }
            );
          return (
            (t &&
              t.hit &&
              t.getTextureCoordinates &&
              t.getTextureCoordinates()) ||
            new p(-1, -1)
          );
        }),
        (e.prototype._createFrameBuffer = function () {
          for (var e = new Array(), t = 0; t < this.spriteCount; t++)
            e.push(0, 0, 0, 0),
              e.push(0, 0, 0, 0),
              e.push(0, 0, 0, 0),
              e.push(0, 0, 0, 0);
          for (t = 0; t < this.spriteCount; t++) {
            var i = this.sprites[t].frame,
              n = this.sprites[t].spriteSourceSize,
              r = this.sprites[t].sourceSize,
              o = this.sprites[t].rotated ? 1 : 0,
              s = this.sprites[t].trimmed ? 1 : 0;
            (e[4 * t] = i.x),
              (e[4 * t + 1] = i.y),
              (e[4 * t + 2] = i.w),
              (e[4 * t + 3] = i.h),
              (e[4 * t + 4 * this.spriteCount] = n.x),
              (e[4 * t + 1 + 4 * this.spriteCount] = n.y),
              (e[4 * t + 3 + 4 * this.spriteCount] = n.h),
              (e[4 * t + 8 * this.spriteCount] = r.w),
              (e[4 * t + 1 + 8 * this.spriteCount] = r.h),
              (e[4 * t + 2 + 8 * this.spriteCount] = o),
              (e[4 * t + 3 + 8 * this.spriteCount] = s);
          }
          var a = new Float32Array(e);
          return bn.CreateRGBATexture(
            a,
            this.spriteCount,
            4,
            this._scene,
            !1,
            !1,
            mn.NEAREST_NEAREST,
            It.TEXTURETYPE_FLOAT
          );
        }),
        (e.prototype._createTileBuffer = function (e, t) {
          void 0 === t && (t = 0);
          var i = new Array(),
            n = this.options.stageSize.y || 0,
            r = this.options.stageSize.x || 0;
          if (e) i = e;
          else {
            var o = this.options.baseTile;
            0 != t && (o = 0);
            for (var s = 0; s < n; s++)
              for (var a = 0; a < 4 * r; a += 4) i.push(o, 0, 0, 0);
          }
          var l = new Float32Array(i);
          return bn.CreateRGBATexture(
            l,
            r,
            n,
            this._scene,
            !1,
            !1,
            mn.NEAREST_NEAREST,
            It.TEXTURETYPE_FLOAT
          );
        }),
        (e.prototype.changeTiles = function (e, t, i) {
          var n;
          if (
            (void 0 === e && (e = 0),
            void 0 === i && (i = 0),
            null !== (n = this._tileMaps[e]._texture._bufferView))
          ) {
            var r = new Array();
            t instanceof p ? r.push(t) : (r = t);
            for (
              var o = this.options.stageSize.x || 0, s = 0;
              s < r.length;
              s++
            ) {
              var a = r[s];
              (a.x = Math.floor(a.x)),
                (a.y = Math.floor(a.y)),
                (n[4 * a.x + a.y * (4 * o)] = i);
            }
            var l = this._createTileBuffer(n);
            this._tileMaps[e].dispose(),
              (this._tileMaps[e] = l),
              this._material.setTextureArray("tileMap", this._tileMaps);
          }
        }),
        (e.prototype._createTileAnimationBuffer = function (e) {
          var t,
            i = new Array();
          if (e) t = e;
          else {
            for (var n = 0; n < this.spriteCount; n++) {
              i.push(0, 0, 0, 0);
              for (var r = 1; r < (this.options.maxAnimationFrames || 4); )
                i.push(0, 0, 0, 0), r++;
            }
            t = new Float32Array(i);
          }
          return bn.CreateRGBATexture(
            t,
            this.spriteCount,
            this.options.maxAnimationFrames || 4,
            this._scene,
            !1,
            !1,
            mn.NEAREST_NEAREST,
            It.TEXTURETYPE_FLOAT
          );
        }),
        (e.prototype.addAnimationToTile = function (e, t, i, n, r) {
          void 0 === e && (e = 0),
            void 0 === t && (t = 0),
            void 0 === i && (i = 0),
            void 0 === n && (n = 0),
            void 0 === r && (r = 1);
          var o = this._animationMap._texture._bufferView,
            s = 4 * e + 4 * this.spriteCount * t;
          if (o) {
            (o[s] = i), (o[s + 1] = n), (o[s + 2] = r);
            var a = this._createTileAnimationBuffer(o);
            this._animationMap.dispose(),
              (this._animationMap = a),
              this._material.setTexture("animationMap", this._animationMap);
          }
        }),
        (e.prototype.saveTileMaps = function () {
          for (var e = "", t = 0; t < this._tileMaps.length; t++)
            t > 0 && (e += "\n\r"),
              (e += this._tileMaps[t]._texture._bufferView.toString());
          var i = document.createElement("a");
          (i.href = "data:octet/stream;charset=utf-8," + encodeURI(e)),
            (i.target = "_blank"),
            (i.download = this.name + ".tilemaps"),
            i.click(),
            i.remove();
        }),
        (e.prototype.loadTileMaps = function (e) {
          var t = this,
            i = new XMLHttpRequest();
          i.open("GET", e);
          var n = this.options.layerCount || 0;
          (i.onload = function () {
            for (var e = i.response.split("\n\r"), r = 0; r < n; r++) {
              var o = e[r].split(",").map(Number),
                s = t._createTileBuffer(o);
              t._tileMaps[r].dispose(), (t._tileMaps[r] = s);
            }
            t._material.setTextureArray("tileMap", t._tileMaps);
          }),
            i.send();
        }),
        (e.prototype.dispose = function () {
          this._output.dispose(),
            this._material.dispose(),
            this._animationMap.dispose(),
            this._tileMaps.forEach(function (e) {
              e.dispose();
            }),
            this._frameMap.dispose();
        });
    })(),
    P(
      function (e, t, i, n, r, o, s) {
        void 0 === r && (r = null),
          void 0 === o && (o = 0.01),
          void 0 === s && (s = mn.TRILINEAR_SAMPLINGMODE);
        var a = Qd.call(this, e, t, i, 64, n, o, s, !0, r) || this;
        return (a.name = e), a;
      },
      (Qd = Yd)
    ),
    (function (e) {
      (e[(e.INIT = 0)] = "INIT"),
        (e[(e.RUNNING = 1)] = "RUNNING"),
        (e[(e.DONE = 2)] = "DONE"),
        (e[(e.ERROR = 3)] = "ERROR");
    })(Kd || (Kd = {}));
  var qd,
    Zd,
    Jd = (function () {
      function e(e) {
        (this.name = e), (this._isCompleted = !1), (this._taskState = Kd.INIT);
      }
      return (
        Object.defineProperty(e.prototype, "isCompleted", {
          get: function () {
            return this._isCompleted;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "taskState", {
          get: function () {
            return this._taskState;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "errorObject", {
          get: function () {
            return this._errorObject;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype._setErrorObject = function (e, t) {
          this._errorObject ||
            (this._errorObject = {
              message: e,
              exception: t,
            });
        }),
        (e.prototype.run = function (e, t, i) {
          var n = this;
          (this._taskState = Kd.RUNNING),
            this.runTask(
              e,
              function () {
                n.onDoneCallback(t, i);
              },
              function (e, t) {
                n.onErrorCallback(i, e, t);
              }
            );
        }),
        (e.prototype.runTask = function (e, t, i) {
          throw new Error("runTask is not implemented");
        }),
        (e.prototype.reset = function () {
          this._taskState = Kd.INIT;
        }),
        (e.prototype.onErrorCallback = function (e, t, i) {
          (this._taskState = Kd.ERROR),
            (this._errorObject = {
              message: t,
              exception: i,
            }),
            this.onError && this.onError(this, t, i),
            e();
        }),
        (e.prototype.onDoneCallback = function (e, t) {
          try {
            (this._taskState = Kd.DONE),
              (this._isCompleted = !0),
              this.onSuccess && this.onSuccess(this),
              e();
          } catch (e) {
            this.onErrorCallback(
              t,
              "Task is done, error executing success callback(s)",
              e
            );
          }
        }),
        e
      );
    })(),
    $d = function (e, t, i) {
      (this.remainingCount = e), (this.totalCount = t), (this.task = i);
    },
    ep = (function (e) {
      function t(t, i, n, r) {
        var o = e.call(this, t) || this;
        return (
          (o.name = t),
          (o.meshesNames = i),
          (o.rootUrl = n),
          (o.sceneFilename = r),
          o
        );
      }
      return (
        P(t, e),
        (t.prototype.runTask = function (e, t, i) {
          var n = this;
          ds.LoadAssetContainer(
            this.rootUrl,
            this.sceneFilename,
            e,
            function (e) {
              (n.loadedContainer = e),
                (n.loadedMeshes = e.meshes),
                (n.loadedParticleSystems = e.particleSystems),
                (n.loadedSkeletons = e.skeletons),
                (n.loadedAnimationGroups = e.animationGroups),
                t();
            },
            null,
            function (e, t, n) {
              i(t, n);
            }
          );
        }),
        t
      );
    })(Jd),
    tp = (function (e) {
      function t(t, i, n, r) {
        var o = e.call(this, t) || this;
        return (
          (o.name = t),
          (o.meshesNames = i),
          (o.rootUrl = n),
          (o.sceneFilename = r),
          o
        );
      }
      return (
        P(t, e),
        (t.prototype.runTask = function (e, t, i) {
          var n = this;
          ds.ImportMesh(
            this.meshesNames,
            this.rootUrl,
            this.sceneFilename,
            e,
            function (e, i, r, o) {
              (n.loadedMeshes = e),
                (n.loadedParticleSystems = i),
                (n.loadedSkeletons = r),
                (n.loadedAnimationGroups = o),
                t();
            },
            null,
            function (e, t, n) {
              i(t, n);
            }
          );
        }),
        t
      );
    })(Jd),
    ip = (function (e) {
      function t(t, i) {
        var n = e.call(this, t) || this;
        return (n.name = t), (n.url = i), n;
      }
      return (
        P(t, e),
        (t.prototype.runTask = function (e, t, i) {
          var n = this;
          e._loadFile(
            this.url,
            function (e) {
              (n.text = e), t();
            },
            void 0,
            !1,
            !1,
            function (e, t) {
              e && i(e.status + " " + e.statusText, t);
            }
          );
        }),
        t
      );
    })(Jd),
    np = (function (e) {
      function t(t, i) {
        var n = e.call(this, t) || this;
        return (n.name = t), (n.url = i), n;
      }
      return (
        P(t, e),
        (t.prototype.runTask = function (e, t, i) {
          var n = this;
          e._loadFile(
            this.url,
            function (e) {
              (n.data = e), t();
            },
            void 0,
            !0,
            !0,
            function (e, t) {
              e && i(e.status + " " + e.statusText, t);
            }
          );
        }),
        t
      );
    })(Jd),
    rp = (function (e) {
      function t(t, i) {
        var n = e.call(this, t) || this;
        return (n.name = t), (n.url = i), n;
      }
      return (
        P(t, e),
        (t.prototype.runTask = function (e, t, i) {
          var n = this,
            r = new Image();
          yt.SetCorsBehavior(this.url, r),
            (r.onload = function () {
              (n.image = r), t();
            }),
            (r.onerror = function (e) {
              i("Error loading image", e);
            }),
            (r.src = this.url);
        }),
        t
      );
    })(Jd),
    op = (function (e) {
      function t(t, i, n, r, o) {
        void 0 === r && (r = !0),
          void 0 === o && (o = mn.TRILINEAR_SAMPLINGMODE);
        var s = e.call(this, t) || this;
        return (
          (s.name = t),
          (s.url = i),
          (s.noMipmap = n),
          (s.invertY = r),
          (s.samplingMode = o),
          s
        );
      }
      return (
        P(t, e),
        (t.prototype.runTask = function (e, t, i) {
          this.texture = new mn(
            this.url,
            e,
            this.noMipmap,
            this.invertY,
            this.samplingMode,
            function () {
              t();
            },
            function (e, t) {
              i(e, t);
            }
          );
        }),
        t
      );
    })(Jd),
    sp = (function (e) {
      function t(t, i, n, r, o) {
        var s = e.call(this, t) || this;
        return (
          (s.name = t),
          (s.url = i),
          (s.extensions = n),
          (s.noMipmap = r),
          (s.files = o),
          s
        );
      }
      return (
        P(t, e),
        (t.prototype.runTask = function (e, t, i) {
          this.texture = new Fs(
            this.url,
            e,
            this.extensions,
            this.noMipmap,
            this.files,
            function () {
              t();
            },
            function (e, t) {
              i(e, t);
            }
          );
        }),
        t
      );
    })(Jd),
    ap = (function (e) {
      function t(t, i, n, r, o, s, a) {
        void 0 === r && (r = !1),
          void 0 === o && (o = !0),
          void 0 === s && (s = !1),
          void 0 === a && (a = !1);
        var l = e.call(this, t) || this;
        return (
          (l.name = t),
          (l.url = i),
          (l.size = n),
          (l.noMipmap = r),
          (l.generateHarmonics = o),
          (l.gammaSpace = s),
          (l.reserved = a),
          l
        );
      }
      return (
        P(t, e),
        (t.prototype.runTask = function (e, t, i) {
          this.texture = new dl(
            this.url,
            e,
            this.size,
            this.noMipmap,
            this.generateHarmonics,
            this.gammaSpace,
            this.reserved,
            function () {
              t();
            },
            function (e, t) {
              i(e, t);
            }
          );
        }),
        t
      );
    })(Jd),
    lp = (function (e) {
      function t(t, i, n, r, o) {
        void 0 === r && (r = !1), void 0 === o && (o = !0);
        var s = e.call(this, t) || this;
        return (
          (s.name = t),
          (s.url = i),
          (s.size = n),
          (s.noMipmap = r),
          (s.gammaSpace = o),
          s
        );
      }
      return (
        P(t, e),
        (t.prototype.runTask = function (e, t, i) {
          this.texture = new wl(
            this.url,
            e,
            this.size,
            this.noMipmap,
            this.gammaSpace,
            function () {
              t();
            },
            function (e, t) {
              i(e, t);
            }
          );
        }),
        t
      );
    })(Jd),
    cp = (function () {
      function e(e) {
        (this._isLoading = !1),
          (this._tasks = new Array()),
          (this._waitingTasksCount = 0),
          (this._totalTasksCount = 0),
          (this.onTaskSuccessObservable = new o()),
          (this.onTaskErrorObservable = new o()),
          (this.onTasksDoneObservable = new o()),
          (this.onProgressObservable = new o()),
          (this.useDefaultLoadingScreen = !0),
          (this.autoHideLoadingUI = !0),
          (this._scene = e);
      }
      return (
        (e.prototype.addContainerTask = function (e, t, i, n) {
          var r = new ep(e, t, i, n);
          return this._tasks.push(r), r;
        }),
        (e.prototype.addMeshTask = function (e, t, i, n) {
          var r = new tp(e, t, i, n);
          return this._tasks.push(r), r;
        }),
        (e.prototype.addTextFileTask = function (e, t) {
          var i = new ip(e, t);
          return this._tasks.push(i), i;
        }),
        (e.prototype.addBinaryFileTask = function (e, t) {
          var i = new np(e, t);
          return this._tasks.push(i), i;
        }),
        (e.prototype.addImageTask = function (e, t) {
          var i = new rp(e, t);
          return this._tasks.push(i), i;
        }),
        (e.prototype.addTextureTask = function (e, t, i, n, r) {
          void 0 === r && (r = mn.TRILINEAR_SAMPLINGMODE);
          var o = new op(e, t, i, n, r);
          return this._tasks.push(o), o;
        }),
        (e.prototype.addCubeTextureTask = function (e, t, i, n, r) {
          var o = new sp(e, t, i, n, r);
          return this._tasks.push(o), o;
        }),
        (e.prototype.addHDRCubeTextureTask = function (e, t, i, n, r, o, s) {
          void 0 === n && (n = !1),
            void 0 === r && (r = !0),
            void 0 === o && (o = !1),
            void 0 === s && (s = !1);
          var a = new ap(e, t, i, n, r, o, s);
          return this._tasks.push(a), a;
        }),
        (e.prototype.addEquiRectangularCubeTextureAssetTask = function (
          e,
          t,
          i,
          n,
          r
        ) {
          void 0 === n && (n = !1), void 0 === r && (r = !0);
          var o = new lp(e, t, i, n, r);
          return this._tasks.push(o), o;
        }),
        (e.prototype.removeTask = function (e) {
          var t = this._tasks.indexOf(e);
          t > -1 && this._tasks.splice(t, 1);
        }),
        (e.prototype._decreaseWaitingTasksCount = function (e) {
          this._waitingTasksCount--;
          try {
            this.onProgress &&
              this.onProgress(
                this._waitingTasksCount,
                this._totalTasksCount,
                e
              ),
              this.onProgressObservable.notifyObservers(
                new $d(this._waitingTasksCount, this._totalTasksCount, e)
              );
          } catch (e) {
            F.Error("Error running progress callbacks."), console.log(e);
          }
          if (0 === this._waitingTasksCount) {
            try {
              var t = this._tasks.slice();
              this.onFinish && this.onFinish(t);
              for (var i = 0, n = t; i < n.length; i++)
                if ((e = n[i]).taskState === Kd.DONE) {
                  var r = this._tasks.indexOf(e);
                  r > -1 && this._tasks.splice(r, 1);
                }
              this.onTasksDoneObservable.notifyObservers(this._tasks);
            } catch (e) {
              F.Error("Error running tasks-done callbacks."), console.log(e);
            }
            (this._isLoading = !1),
              this.autoHideLoadingUI && this._scene.getEngine().hideLoadingUI();
          }
        }),
        (e.prototype._runTask = function (e) {
          var t = this,
            i = function (i, n) {
              e._setErrorObject(i, n),
                t.onTaskError && t.onTaskError(e),
                t.onTaskErrorObservable.notifyObservers(e),
                t._decreaseWaitingTasksCount(e);
            };
          e.run(
            this._scene,
            function () {
              try {
                t.onTaskSuccess && t.onTaskSuccess(e),
                  t.onTaskSuccessObservable.notifyObservers(e),
                  t._decreaseWaitingTasksCount(e);
              } catch (e) {
                i("Error executing task success callbacks", e);
              }
            },
            i
          );
        }),
        (e.prototype.reset = function () {
          return (this._isLoading = !1), (this._tasks = new Array()), this;
        }),
        (e.prototype.load = function () {
          if (this._isLoading) return this;
          if (
            ((this._isLoading = !0),
            (this._waitingTasksCount = this._tasks.length),
            (this._totalTasksCount = this._tasks.length),
            0 === this._waitingTasksCount)
          )
            return (
              (this._isLoading = !1),
              this.onFinish && this.onFinish(this._tasks),
              this.onTasksDoneObservable.notifyObservers(this._tasks),
              this
            );
          this.useDefaultLoadingScreen &&
            this._scene.getEngine().displayLoadingUI();
          for (var e = 0; e < this._tasks.length; e++) {
            var t = this._tasks[e];
            t.taskState === Kd.INIT && this._runTask(t);
          }
          return this;
        }),
        (e.prototype.loadAsync = function () {
          var e = this;
          return new Promise(function (t, i) {
            e._isLoading
              ? t()
              : (e.onTasksDoneObservable.addOnce(function (e) {
                  e && e.length ? i(e) : t();
                }),
                e.load());
          });
        }),
        e
      );
    })(),
    up =
      ((function () {
        function e() {
          var e = this;
          this.promise = new Promise(function (t, i) {
            (e._resolve = t), (e._reject = i);
          });
        }
        Object.defineProperty(e.prototype, "resolve", {
          get: function () {
            return this._resolve;
          },
          enumerable: !1,
          configurable: !0,
        }),
          Object.defineProperty(e.prototype, "reject", {
            get: function () {
              return this._reject;
            },
            enumerable: !1,
            configurable: !0,
          });
      })(),
      (function () {
        function e(e, t) {
          (this._meshesOrigins = []),
            (this._toCenterVectors = []),
            (this._scaledDirection = f.Zero()),
            (this._newPosition = f.Zero()),
            (this._centerPosition = f.Zero()),
            (this._meshes = e.slice()),
            t ? (this._centerMesh = t) : this._setCenterMesh();
          var i = this._meshes.indexOf(this._centerMesh);
          i >= 0 && this._meshes.splice(i, 1),
            (this._centerPosition = this._centerMesh
              .getAbsolutePosition()
              .clone());
          for (var n = 0; n < this._meshes.length; n++)
            if (this._meshes[n]) {
              var r = this._meshes[n];
              (this._meshesOrigins[n] = r.getAbsolutePosition().clone()),
                (this._toCenterVectors[n] = f.Zero()),
                r._boundingInfo &&
                  this._centerMesh._boundingInfo &&
                  r._boundingInfo.boundingBox.centerWorld.subtractToRef(
                    this._centerMesh._boundingInfo.boundingBox.centerWorld,
                    this._toCenterVectors[n]
                  );
            }
        }
        (e.prototype._setCenterMesh = function () {
          for (
            var e = f.Zero(), t = f.Zero(), i = Number.MAX_VALUE, n = 0;
            n < this._meshes.length;
            n++
          )
            this._meshes[n] &&
              (o = (r = this._meshes[n]).getBoundingInfo()) &&
              t.addInPlace(o.boundingBox.centerWorld);
          for (
            e = t.scale(1 / this._meshes.length), n = 0;
            n < this._meshes.length;
            n++
          ) {
            var r, o;
            if (
              this._meshes[n] &&
              (o = (r = this._meshes[n]).getBoundingInfo())
            ) {
              var s = o.boundingBox.centerWorld.subtract(e).lengthSquared();
              s < i && ((this._centerMesh = r), (i = s));
            }
          }
        }),
          (e.prototype.getClassName = function () {
            return "MeshExploder";
          }),
          (e.prototype.getMeshes = function () {
            var e = this._meshes.slice();
            return e.unshift(this._centerMesh), e;
          }),
          (e.prototype.explode = function (e) {
            void 0 === e && (e = 1);
            for (var t = 0; t < this._meshes.length; t++)
              this._meshes[t] &&
                this._meshesOrigins[t] &&
                this._toCenterVectors[t] &&
                (this._toCenterVectors[t].scaleToRef(e, this._scaledDirection),
                this._meshesOrigins[t].addToRef(
                  this._scaledDirection,
                  this._newPosition
                ),
                this._meshes[t].setAbsolutePosition(this._newPosition));
            this._centerMesh.setAbsolutePosition(this._centerPosition);
          });
      })(),
      (function () {
        function e(e, t, i, n, r, o, s, a, l) {
          (this.onProcessFileCallback = function () {
            return !0;
          }),
            (this._engine = e),
            (this._currentScene = t),
            (this._sceneLoadedCallback = i),
            (this._progressCallback = n),
            (this._additionalRenderLoopLogicCallback = r),
            (this._textureLoadingCallback = o),
            (this._startingProcessingFilesCallback = s),
            (this._onReloadCallback = a),
            (this._errorCallback = l);
        }
        Object.defineProperty(e, "FilesToLoad", {
          get: function () {
            return we.FilesToLoad;
          },
          enumerable: !1,
          configurable: !0,
        }),
          (e.prototype.monitorElementForDragNDrop = function (e) {
            var t = this;
            e &&
              ((this._elementToMonitor = e),
              (this._dragEnterHandler = function (e) {
                t.drag(e);
              }),
              (this._dragOverHandler = function (e) {
                t.drag(e);
              }),
              (this._dropHandler = function (e) {
                t.drop(e);
              }),
              this._elementToMonitor.addEventListener(
                "dragenter",
                this._dragEnterHandler,
                !1
              ),
              this._elementToMonitor.addEventListener(
                "dragover",
                this._dragOverHandler,
                !1
              ),
              this._elementToMonitor.addEventListener(
                "drop",
                this._dropHandler,
                !1
              ));
          }),
          Object.defineProperty(e.prototype, "filesToLoad", {
            get: function () {
              return this._filesToLoad;
            },
            enumerable: !1,
            configurable: !0,
          }),
          (e.prototype.dispose = function () {
            this._elementToMonitor &&
              (this._elementToMonitor.removeEventListener(
                "dragenter",
                this._dragEnterHandler
              ),
              this._elementToMonitor.removeEventListener(
                "dragover",
                this._dragOverHandler
              ),
              this._elementToMonitor.removeEventListener(
                "drop",
                this._dropHandler
              ));
          }),
          (e.prototype.renderFunction = function () {
            if (
              (this._additionalRenderLoopLogicCallback &&
                this._additionalRenderLoopLogicCallback(),
              this._currentScene)
            ) {
              if (this._textureLoadingCallback) {
                var e = this._currentScene.getWaitingItemsCount();
                e > 0 && this._textureLoadingCallback(e);
              }
              this._currentScene.render();
            }
          }),
          (e.prototype.drag = function (e) {
            e.stopPropagation(), e.preventDefault();
          }),
          (e.prototype.drop = function (e) {
            e.stopPropagation(), e.preventDefault(), this.loadFiles(e);
          }),
          (e.prototype._traverseFolder = function (e, t, i, n) {
            var r = this,
              o = e.createReader(),
              s = e.fullPath.replace(/^\//, "").replace(/(.+?)\/?$/, "$1/");
            o.readEntries(function (e) {
              i.count += e.length;
              for (var o = 0, a = e; o < a.length; o++) {
                var l = a[o];
                l.isFile
                  ? l.file(function (e) {
                      (e.correctName = s + e.name),
                        t.push(e),
                        0 == --i.count && n();
                    })
                  : l.isDirectory && r._traverseFolder(l, t, i, n);
              }
              0 == --i.count && n();
            });
          }),
          (e.prototype._processFiles = function (t) {
            for (var i = 0; i < t.length; i++) {
              var n = t[i].correctName.toLowerCase(),
                r = n.split(".").pop();
              this.onProcessFileCallback(t[i], n, r) &&
                (ds.IsPluginForExtensionAvailable("." + r) &&
                  (this._sceneFileToLoad = t[i]),
                (e.FilesToLoad[n] = t[i]));
            }
          }),
          (e.prototype.loadFiles = function (e) {
            var t = this;
            if (
              (e &&
                e.dataTransfer &&
                e.dataTransfer.files &&
                (this._filesToLoad = e.dataTransfer.files),
              e &&
                e.target &&
                e.target.files &&
                (this._filesToLoad = e.target.files),
              this._filesToLoad &&
                0 !== this._filesToLoad.length &&
                (this._startingProcessingFilesCallback &&
                  this._startingProcessingFilesCallback(this._filesToLoad),
                this._filesToLoad && this._filesToLoad.length > 0))
            ) {
              for (
                var i = new Array(),
                  n = [],
                  r = e.dataTransfer ? e.dataTransfer.items : null,
                  o = 0;
                o < this._filesToLoad.length;
                o++
              ) {
                var s = this._filesToLoad[o],
                  a = s.name.toLowerCase(),
                  l = void 0;
                if (((s.correctName = a), r)) {
                  var c = r[o];
                  c.getAsEntry
                    ? (l = c.getAsEntry())
                    : c.webkitGetAsEntry && (l = c.webkitGetAsEntry());
                }
                l && l.isDirectory ? n.push(l) : i.push(s);
              }
              if (0 === n.length) this._processFiles(i), this._processReload();
              else
                for (
                  var u = {
                      count: n.length,
                    },
                    h = 0,
                    d = n;
                  h < d.length;
                  h++
                ) {
                  var p = d[h];
                  this._traverseFolder(p, i, u, function () {
                    t._processFiles(i), 0 === u.count && t._processReload();
                  });
                }
            }
          }),
          (e.prototype._processReload = function () {
            this._onReloadCallback
              ? this._onReloadCallback(this._sceneFileToLoad)
              : this.reload();
          }),
          (e.prototype.reload = function () {
            var e = this;
            this._sceneFileToLoad
              ? (this._currentScene &&
                  (F.errorsCount > 0 && F.ClearLogCache(),
                  this._engine.stopRenderLoop()),
                (ds.ShowLoadingScreen = !1),
                this._engine.displayLoadingUI(),
                ds
                  .LoadAsync(
                    "file:",
                    this._sceneFileToLoad,
                    this._engine,
                    function (t) {
                      e._progressCallback && e._progressCallback(t);
                    }
                  )
                  .then(function (t) {
                    e._currentScene && e._currentScene.dispose(),
                      (e._currentScene = t),
                      e._sceneLoadedCallback &&
                        e._sceneLoadedCallback(
                          e._sceneFileToLoad,
                          e._currentScene
                        ),
                      e._currentScene.executeWhenReady(function () {
                        e._engine.hideLoadingUI(),
                          e._engine.runRenderLoop(function () {
                            e.renderFunction();
                          });
                      });
                  })
                  .catch(function (t) {
                    e._engine.hideLoadingUI(),
                      e._errorCallback &&
                        e._errorCallback(
                          e._sceneFileToLoad,
                          e._currentScene,
                          t.message
                        );
                  }))
              : F.Error("Please provide a valid .babylon file.");
          });
      })(),
      (function () {
        function e(e) {
          void 0 === e && (e = 0), (this.priority = e);
        }
        return (
          (e.prototype.getDescription = function () {
            return "";
          }),
          (e.prototype.apply = function (e, t) {
            return !0;
          }),
          e
        );
      })()),
    hp = (function (e) {
      function t(t, i, n) {
        void 0 === t && (t = 0),
          void 0 === i && (i = 1024),
          void 0 === n && (n = 0.5);
        var r = e.call(this, t) || this;
        return (r.priority = t), (r.maximumSize = i), (r.step = n), r;
      }
      return (
        P(t, e),
        (t.prototype.getDescription = function () {
          return "Reducing render target texture size to " + this.maximumSize;
        }),
        (t.prototype.apply = function (e, t) {
          for (var i = !0, n = 0; n < e.textures.length; n++) {
            var r = e.textures[n];
            if (r.canRescale && !r.getContext) {
              var o = r.getSize();
              Math.max(o.width, o.height) > this.maximumSize &&
                (r.scale(this.step), (i = !1));
            }
          }
          return i;
        }),
        t
      );
    })(up),
    dp = (function (e) {
      function t(t, i, n) {
        void 0 === t && (t = 0),
          void 0 === i && (i = 2),
          void 0 === n && (n = 0.25);
        var r = e.call(this, t) || this;
        return (
          (r.priority = t),
          (r.maximumScale = i),
          (r.step = n),
          (r._currentScale = -1),
          (r._directionOffset = 1),
          r
        );
      }
      return (
        P(t, e),
        (t.prototype.getDescription = function () {
          return "Setting hardware scaling level to " + this._currentScale;
        }),
        (t.prototype.apply = function (e, t) {
          return (
            -1 === this._currentScale &&
              ((this._currentScale = e.getEngine().getHardwareScalingLevel()),
              this._currentScale > this.maximumScale &&
                (this._directionOffset = -1)),
            (this._currentScale += this._directionOffset * this.step),
            e.getEngine().setHardwareScalingLevel(this._currentScale),
            1 === this._directionOffset
              ? this._currentScale >= this.maximumScale
              : this._currentScale <= this.maximumScale
          );
        }),
        t
      );
    })(up),
    pp = (function (e) {
      function t() {
        return (null !== e && e.apply(this, arguments)) || this;
      }
      return (
        P(t, e),
        (t.prototype.getDescription = function () {
          return "Turning shadows on/off";
        }),
        (t.prototype.apply = function (e, t) {
          return (e.shadowsEnabled = t.isInImprovementMode), !0;
        }),
        t
      );
    })(up),
    fp = (function (e) {
      function t() {
        return (null !== e && e.apply(this, arguments)) || this;
      }
      return (
        P(t, e),
        (t.prototype.getDescription = function () {
          return "Turning post-processes on/off";
        }),
        (t.prototype.apply = function (e, t) {
          return (e.postProcessesEnabled = t.isInImprovementMode), !0;
        }),
        t
      );
    })(up),
    _p = (function (e) {
      function t() {
        return (null !== e && e.apply(this, arguments)) || this;
      }
      return (
        P(t, e),
        (t.prototype.getDescription = function () {
          return "Turning lens flares on/off";
        }),
        (t.prototype.apply = function (e, t) {
          return (e.lensFlaresEnabled = t.isInImprovementMode), !0;
        }),
        t
      );
    })(up),
    mp = (function (e) {
      function t() {
        return (null !== e && e.apply(this, arguments)) || this;
      }
      return (
        P(t, e),
        (t.prototype.getDescription = function () {
          return this.onGetDescription
            ? this.onGetDescription()
            : "Running user defined callback";
        }),
        (t.prototype.apply = function (e, t) {
          return !this.onApply || this.onApply(e, t);
        }),
        t
      );
    })(up),
    gp = (function (e) {
      function t() {
        return (null !== e && e.apply(this, arguments)) || this;
      }
      return (
        P(t, e),
        (t.prototype.getDescription = function () {
          return "Turning particles on/off";
        }),
        (t.prototype.apply = function (e, t) {
          return (e.particlesEnabled = t.isInImprovementMode), !0;
        }),
        t
      );
    })(up),
    vp = (function (e) {
      function t() {
        return (null !== e && e.apply(this, arguments)) || this;
      }
      return (
        P(t, e),
        (t.prototype.getDescription = function () {
          return "Turning render targets off";
        }),
        (t.prototype.apply = function (e, t) {
          return (e.renderTargetsEnabled = t.isInImprovementMode), !0;
        }),
        t
      );
    })(up),
    yp = (function (e) {
      function t() {
        var t = (null !== e && e.apply(this, arguments)) || this;
        return (
          (t._canBeMerged = function (e) {
            if (!(e instanceof Qi)) return !1;
            var t = e;
            return !(
              t.isDisposed() ||
              !t.isVisible ||
              !t.isEnabled() ||
              t.instances.length > 0 ||
              t.skeleton ||
              t.hasLODLevels
            );
          }),
          t
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t, "UpdateSelectionTree", {
          get: function () {
            return t._UpdateSelectionTree;
          },
          set: function (e) {
            t._UpdateSelectionTree = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getDescription = function () {
          return "Merging similar meshes together";
        }),
        (t.prototype.apply = function (e, i, n) {
          for (var r = e.meshes.slice(0), o = r.length, s = 0; s < o; s++) {
            var a = new Array(),
              l = r[s];
            if (this._canBeMerged(l)) {
              a.push(l);
              for (var c = s + 1; c < o; c++) {
                var u = r[c];
                this._canBeMerged(u) &&
                  u.material === l.material &&
                  u.checkCollisions === l.checkCollisions &&
                  (a.push(u), o--, r.splice(c, 1), c--);
              }
              a.length < 2 || Qi.MergeMeshes(a, void 0, !0);
            }
          }
          var h = e;
          return (
            h.createOrUpdateSelectionOctree &&
              (null != n
                ? n && h.createOrUpdateSelectionOctree()
                : t.UpdateSelectionTree && h.createOrUpdateSelectionOctree()),
            !0
          );
        }),
        (t._UpdateSelectionTree = !1),
        t
      );
    })(up),
    bp = (function () {
      function e(e, t) {
        void 0 === e && (e = 60),
          void 0 === t && (t = 2e3),
          (this.targetFrameRate = e),
          (this.trackerDuration = t),
          (this.optimizations = new Array());
      }
      return (
        (e.prototype.addOptimization = function (e) {
          return this.optimizations.push(e), this;
        }),
        (e.prototype.addCustomOptimization = function (e, t, i) {
          void 0 === i && (i = 0);
          var n = new mp(i);
          return (
            (n.onApply = e),
            (n.onGetDescription = t),
            this.optimizations.push(n),
            this
          );
        }),
        (e.LowDegradationAllowed = function (t) {
          var i = new e(t),
            n = 0;
          return (
            i.addOptimization(new yp(n)),
            i.addOptimization(new pp(n)),
            i.addOptimization(new _p(n)),
            n++,
            i.addOptimization(new fp(n)),
            i.addOptimization(new gp(n)),
            n++,
            i.addOptimization(new hp(n, 1024)),
            i
          );
        }),
        (e.ModerateDegradationAllowed = function (t) {
          var i = new e(t),
            n = 0;
          return (
            i.addOptimization(new yp(n)),
            i.addOptimization(new pp(n)),
            i.addOptimization(new _p(n)),
            n++,
            i.addOptimization(new fp(n)),
            i.addOptimization(new gp(n)),
            n++,
            i.addOptimization(new hp(n, 512)),
            n++,
            i.addOptimization(new vp(n)),
            n++,
            i.addOptimization(new dp(n, 2)),
            i
          );
        }),
        (e.HighDegradationAllowed = function (t) {
          var i = new e(t),
            n = 0;
          return (
            i.addOptimization(new yp(n)),
            i.addOptimization(new pp(n)),
            i.addOptimization(new _p(n)),
            n++,
            i.addOptimization(new fp(n)),
            i.addOptimization(new gp(n)),
            n++,
            i.addOptimization(new hp(n, 256)),
            n++,
            i.addOptimization(new vp(n)),
            n++,
            i.addOptimization(new dp(n, 4)),
            i
          );
        }),
        e
      );
    })(),
    Tp =
      ((function () {
        function e(e, t, i, n) {
          var r = this;
          if (
            (void 0 === i && (i = !0),
            void 0 === n && (n = !1),
            (this._isRunning = !1),
            (this._currentPriorityLevel = 0),
            (this._targetFrameRate = 60),
            (this._trackerDuration = 2e3),
            (this._currentFrameRate = 0),
            (this._improvementMode = !1),
            (this.onSuccessObservable = new o()),
            (this.onNewOptimizationAppliedObservable = new o()),
            (this.onFailureObservable = new o()),
            (this._options = t || new bp()),
            this._options.targetFrameRate &&
              (this._targetFrameRate = this._options.targetFrameRate),
            this._options.trackerDuration &&
              (this._trackerDuration = this._options.trackerDuration),
            i)
          )
            for (
              var s = 0, a = 0, l = this._options.optimizations;
              a < l.length;
              a++
            )
              l[a].priority = s++;
          (this._improvementMode = n),
            (this._scene = e || j.LastCreatedScene),
            (this._sceneDisposeObserver = this._scene.onDisposeObservable.add(
              function () {
                (r._sceneDisposeObserver = null), r.dispose();
              }
            ));
        }
        Object.defineProperty(e.prototype, "isInImprovementMode", {
          get: function () {
            return this._improvementMode;
          },
          enumerable: !1,
          configurable: !0,
        }),
          Object.defineProperty(e.prototype, "currentPriorityLevel", {
            get: function () {
              return this._currentPriorityLevel;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "currentFrameRate", {
            get: function () {
              return this._currentFrameRate;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "targetFrameRate", {
            get: function () {
              return this._targetFrameRate;
            },
            set: function (e) {
              this._targetFrameRate = e;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "trackerDuration", {
            get: function () {
              return this._trackerDuration;
            },
            set: function (e) {
              this._trackerDuration = e;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "optimizations", {
            get: function () {
              return this._options.optimizations;
            },
            enumerable: !1,
            configurable: !0,
          }),
          (e.prototype.stop = function () {
            this._isRunning = !1;
          }),
          (e.prototype.reset = function () {
            this._currentPriorityLevel = 0;
          }),
          (e.prototype.start = function () {
            var e = this;
            this._isRunning ||
              ((this._isRunning = !0),
              this._scene.executeWhenReady(function () {
                setTimeout(function () {
                  e._checkCurrentState();
                }, e._trackerDuration);
              }));
          }),
          (e.prototype._checkCurrentState = function () {
            var e = this;
            if (this._isRunning) {
              var t = this._scene,
                i = this._options;
              if (
                ((this._currentFrameRate = Math.round(t.getEngine().getFps())),
                (this._improvementMode &&
                  this._currentFrameRate <= this._targetFrameRate) ||
                  (!this._improvementMode &&
                    this._currentFrameRate >= this._targetFrameRate))
              )
                return (
                  (this._isRunning = !1),
                  void this.onSuccessObservable.notifyObservers(this)
                );
              for (var n = !0, r = !0, o = 0; o < i.optimizations.length; o++) {
                var s = i.optimizations[o];
                s.priority === this._currentPriorityLevel &&
                  ((r = !1),
                  (n = n && s.apply(t, this)),
                  this.onNewOptimizationAppliedObservable.notifyObservers(s));
              }
              if (r)
                return (
                  (this._isRunning = !1),
                  void this.onFailureObservable.notifyObservers(this)
                );
              n && this._currentPriorityLevel++,
                t.executeWhenReady(function () {
                  setTimeout(function () {
                    e._checkCurrentState();
                  }, e._trackerDuration);
                });
            }
          }),
          (e.prototype.dispose = function () {
            this.stop(),
              this.onSuccessObservable.clear(),
              this.onFailureObservable.clear(),
              this.onNewOptimizationAppliedObservable.clear(),
              this._sceneDisposeObserver &&
                this._scene.onDisposeObservable.remove(
                  this._sceneDisposeObserver
                );
          }),
          (e.OptimizeAsync = function (t, i, n, r) {
            var o = new e(t, i || bp.ModerateDegradationAllowed(), !1);
            return (
              n &&
                o.onSuccessObservable.add(function () {
                  n();
                }),
              r &&
                o.onFailureObservable.add(function () {
                  r();
                }),
              o.start(),
              o
            );
          });
      })(),
      []),
    Sp = function (e, t) {
      Tp[e.id] ||
        e.doNotSerialize ||
        (t.vertexData.push(e.serializeVerticeData()), (Tp[e.id] = !0));
    },
    Cp = function (e, t) {
      var i = {},
        n = e._geometry;
      return (
        n && (e.getScene().getGeometryByID(n.id) || Sp(n, t.geometries)),
        e.serialize && e.serialize(i),
        i
      );
    },
    xp = (function () {
      function e() {}
      return (
        (e.ClearCache = function () {
          Tp = [];
        }),
        (e.Serialize = function (t) {
          var i,
            n,
            r,
            o = {};
          if (
            (e.ClearCache(),
            (o.useDelayedTextureLoading = t.useDelayedTextureLoading),
            (o.autoClear = t.autoClear),
            (o.clearColor = t.clearColor.asArray()),
            (o.ambientColor = t.ambientColor.asArray()),
            (o.gravity = t.gravity.asArray()),
            (o.collisionsEnabled = t.collisionsEnabled),
            t.fogMode &&
              0 !== t.fogMode &&
              ((o.fogMode = t.fogMode),
              (o.fogColor = t.fogColor.asArray()),
              (o.fogStart = t.fogStart),
              (o.fogEnd = t.fogEnd),
              (o.fogDensity = t.fogDensity)),
            t.isPhysicsEnabled())
          ) {
            var s = t.getPhysicsEngine();
            s &&
              ((o.physicsEnabled = !0),
              (o.physicsGravity = s.gravity.asArray()),
              (o.physicsEngine = s.getPhysicsPluginName()));
          }
          t.metadata && (o.metadata = t.metadata), (o.morphTargetManagers = []);
          for (var a = 0, l = t.meshes; a < l.length; a++) {
            var c = (v = l[a]).morphTargetManager;
            c && o.morphTargetManagers.push(c.serialize());
          }
          for (o.lights = [], i = 0; i < t.lights.length; i++)
            (n = t.lights[i]).doNotSerialize || o.lights.push(n.serialize());
          for (o.cameras = [], i = 0; i < t.cameras.length; i++) {
            var u = t.cameras[i];
            u.doNotSerialize || o.cameras.push(u.serialize());
          }
          if (
            (t.activeCamera && (o.activeCameraID = t.activeCamera.id),
            ge.AppendSerializedAnimations(t, o),
            t.animationGroups && t.animationGroups.length > 0)
          ) {
            o.animationGroups = [];
            for (var h = 0; h < t.animationGroups.length; h++) {
              var d = t.animationGroups[h];
              o.animationGroups.push(d.serialize());
            }
          }
          if (t.reflectionProbes && t.reflectionProbes.length > 0)
            for (
              o.reflectionProbes = [], i = 0;
              i < t.reflectionProbes.length;
              i++
            ) {
              var p = t.reflectionProbes[i];
              o.reflectionProbes.push(p.serialize());
            }
          for (
            o.materials = [], o.multiMaterials = [], i = 0;
            i < t.materials.length;
            i++
          )
            (r = t.materials[i]).doNotSerialize ||
              o.materials.push(r.serialize());
          for (o.multiMaterials = [], i = 0; i < t.multiMaterials.length; i++) {
            var f = t.multiMaterials[i];
            o.multiMaterials.push(f.serialize());
          }
          for (
            t.environmentTexture &&
              (o.environmentTexture = t.environmentTexture.name),
              o.environmentIntensity = t.environmentIntensity,
              o.skeletons = [],
              i = 0;
            i < t.skeletons.length;
            i++
          ) {
            var _ = t.skeletons[i];
            _.doNotSerialize || o.skeletons.push(_.serialize());
          }
          for (o.transformNodes = [], i = 0; i < t.transformNodes.length; i++)
            t.transformNodes[i].doNotSerialize ||
              o.transformNodes.push(t.transformNodes[i].serialize());
          (o.geometries = {}),
            (o.geometries.boxes = []),
            (o.geometries.spheres = []),
            (o.geometries.cylinders = []),
            (o.geometries.toruses = []),
            (o.geometries.grounds = []),
            (o.geometries.planes = []),
            (o.geometries.torusKnots = []),
            (o.geometries.vertexData = []),
            (Tp = []);
          var m = t.getGeometries();
          for (i = 0; i < m.length; i++) {
            var g = m[i];
            g.isReady() && Sp(g, o.geometries);
          }
          for (o.meshes = [], i = 0; i < t.meshes.length; i++) {
            var v;
            if ((v = t.meshes[i]) instanceof Qi) {
              var y = v;
              y.doNotSerialize ||
                (1 !== y.delayLoadState && 0 !== y.delayLoadState) ||
                o.meshes.push(Cp(y, o));
            }
          }
          for (o.particleSystems = [], i = 0; i < t.particleSystems.length; i++)
            o.particleSystems.push(t.particleSystems[i].serialize(!1));
          for (o.postProcesses = [], i = 0; i < t.postProcesses.length; i++)
            o.postProcesses.push(t.postProcesses[i].serialize());
          t.actionManager && (o.actions = t.actionManager.serialize("scene"));
          for (var b = 0, T = t._serializableComponents; b < T.length; b++)
            T[b].serialize(o);
          return o;
        }),
        (e.SerializeMesh = function (t, i, n) {
          void 0 === i && (i = !1), void 0 === n && (n = !1);
          var r = {};
          if ((e.ClearCache(), (t = t instanceof Array ? t : [t]), i || n))
            for (var o = 0; o < t.length; ++o)
              n &&
                t[o].getDescendants().forEach(function (e) {
                  e instanceof Qi &&
                    t.indexOf(e) < 0 &&
                    !e.doNotSerialize &&
                    t.push(e);
                }),
                i &&
                  t[o].parent &&
                  t.indexOf(t[o].parent) < 0 &&
                  !t[o].parent.doNotSerialize &&
                  t.push(t[o].parent);
          return (
            t.forEach(function (e) {
              !(function (e, t) {
                if (1 === e.delayLoadState || 0 === e.delayLoadState) {
                  if (e.material && !e.material.doNotSerialize)
                    if (e.material instanceof Gi) {
                      if (
                        ((t.multiMaterials = t.multiMaterials || []),
                        (t.materials = t.materials || []),
                        !t.multiMaterials.some(function (t) {
                          return t.id === e.material.id;
                        }))
                      ) {
                        t.multiMaterials.push(e.material.serialize());
                        for (
                          var i = function (e) {
                              e &&
                                (t.materials.some(function (t) {
                                  return t.id === e.id;
                                }) ||
                                  t.materials.push(e.serialize()));
                            },
                            n = 0,
                            r = e.material.subMaterials;
                          n < r.length;
                          n++
                        )
                          i(r[n]);
                      }
                    } else
                      (t.materials = t.materials || []),
                        t.materials.some(function (t) {
                          return t.id === e.material.id;
                        }) || t.materials.push(e.material.serialize());
                  var o = e._geometry;
                  o &&
                    (t.geometries ||
                      ((t.geometries = {}),
                      (t.geometries.boxes = []),
                      (t.geometries.spheres = []),
                      (t.geometries.cylinders = []),
                      (t.geometries.toruses = []),
                      (t.geometries.grounds = []),
                      (t.geometries.planes = []),
                      (t.geometries.torusKnots = []),
                      (t.geometries.vertexData = [])),
                    Sp(o, t.geometries)),
                    e.skeleton &&
                      !e.skeleton.doNotSerialize &&
                      ((t.skeletons = t.skeletons || []),
                      t.skeletons.push(e.skeleton.serialize())),
                    (t.meshes = t.meshes || []),
                    t.meshes.push(Cp(e, t));
                }
              })(e, r);
            }),
            r
          );
        }),
        e
      );
    })(),
    Ep =
      ((function () {
        function e(t, i) {
          if ((void 0 === i && (i = null), !e.IsSupported(t)))
            throw "Your browser does not support recording so far.";
          var n = t.getRenderingCanvas();
          if (!n) throw "The babylon engine must have a canvas to be recorded";
          (this._canvas = n),
            (this._canvas.isRecording = !1),
            (this._options = A(A({}, e._defaultOptions), i));
          var r = this._canvas.captureStream(this._options.fps);
          if (this._options.audioTracks)
            for (var o = 0, s = this._options.audioTracks; o < s.length; o++) {
              var a = s[o];
              r.addTrack(a);
            }
          (this._mediaRecorder = new MediaRecorder(r, {
            mimeType: this._options.mimeType,
          })),
            (this._mediaRecorder.ondataavailable =
              this._handleDataAvailable.bind(this)),
            (this._mediaRecorder.onerror = this._handleError.bind(this)),
            (this._mediaRecorder.onstop = this._handleStop.bind(this));
        }
        (e.IsSupported = function (e) {
          var t = e.getRenderingCanvas();
          return !!t && "function" == typeof t.captureStream;
        }),
          Object.defineProperty(e.prototype, "isRecording", {
            get: function () {
              return !!this._canvas && this._canvas.isRecording;
            },
            enumerable: !1,
            configurable: !0,
          }),
          (e.prototype.stopRecording = function () {
            this._canvas &&
              this._mediaRecorder &&
              this.isRecording &&
              ((this._canvas.isRecording = !1), this._mediaRecorder.stop());
          }),
          (e.prototype.startRecording = function (e, t) {
            var i = this;
            if (
              (void 0 === e && (e = "babylonjs.webm"),
              void 0 === t && (t = 7),
              !this._canvas || !this._mediaRecorder)
            )
              throw "Recorder has already been disposed";
            if (this.isRecording) throw "Recording already in progress";
            return (
              t > 0 &&
                setTimeout(function () {
                  i.stopRecording();
                }, 1e3 * t),
              (this._fileName = e),
              (this._recordedChunks = []),
              (this._resolve = null),
              (this._reject = null),
              (this._canvas.isRecording = !0),
              this._mediaRecorder.start(this._options.recordChunckSize),
              new Promise(function (e, t) {
                (i._resolve = e), (i._reject = t);
              })
            );
          }),
          (e.prototype.dispose = function () {
            (this._canvas = null),
              (this._mediaRecorder = null),
              (this._recordedChunks = []),
              (this._fileName = null),
              (this._resolve = null),
              (this._reject = null);
          }),
          (e.prototype._handleDataAvailable = function (e) {
            e.data.size > 0 && this._recordedChunks.push(e.data);
          }),
          (e.prototype._handleError = function (e) {
            if ((this.stopRecording(), !this._reject)) throw new e.error();
            this._reject(e.error);
          }),
          (e.prototype._handleStop = function () {
            this.stopRecording();
            var e = new Blob(this._recordedChunks);
            this._resolve && this._resolve(e),
              window.URL.createObjectURL(e),
              this._fileName && yt.Download(e, this._fileName);
          }),
          (e._defaultOptions = {
            mimeType: "video/webm",
            fps: 25,
            recordChunckSize: 3e3,
          });
      })(),
      (function () {
        function e() {}
        return (
          (e.CreateScreenshot = function (t, i, n, r, o) {
            void 0 === o && (o = "image/png");
            var s = e._getScreenshotSize(t, i, n),
              a = s.height,
              l = s.width;
            if (a && l) {
              yt._ScreenshotCanvas ||
                (yt._ScreenshotCanvas = document.createElement("canvas")),
                (yt._ScreenshotCanvas.width = l),
                (yt._ScreenshotCanvas.height = a);
              var c = yt._ScreenshotCanvas.getContext("2d"),
                u = t.getRenderWidth() / t.getRenderHeight(),
                h = l,
                d = h / u;
              d > a && (h = (d = a) * u);
              var p = Math.max(0, l - h) / 2,
                f = Math.max(0, a - d) / 2,
                _ = t.getRenderingCanvas();
              c && _ && c.drawImage(_, p, f, h, d),
                yt.EncodeScreenshotCanvasData(r, o);
            } else F.Error("Invalid 'size' parameter !");
          }),
          (e.CreateScreenshotAsync = function (t, i, n, r) {
            return (
              void 0 === r && (r = "image/png"),
              new Promise(function (o, s) {
                e.CreateScreenshot(
                  t,
                  i,
                  n,
                  function (e) {
                    void 0 !== e ? o(e) : s(new Error("Data is undefined"));
                  },
                  r
                );
              })
            );
          }),
          (e.CreateScreenshotUsingRenderTarget = function (
            t,
            i,
            n,
            r,
            o,
            s,
            a,
            l,
            c,
            u
          ) {
            void 0 === o && (o = "image/png"),
              void 0 === s && (s = 1),
              void 0 === a && (a = !1),
              void 0 === c && (c = !1),
              void 0 === u && (u = !1);
            var h = e._getScreenshotSize(t, i, n),
              d = h.height,
              p = h.width,
              f = {
                width: p,
                height: d,
              };
            if (d && p) {
              var _ = t.getRenderingCanvas();
              if (_) {
                var m = {
                  width: _.width,
                  height: _.height,
                };
                t.setSize(p, d);
                var g = i.getScene(),
                  v = null,
                  y = g.activeCameras;
                (g.activeCamera !== i ||
                  (g.activeCameras && g.activeCameras.length)) &&
                  ((v = g.activeCamera), (g.activeCamera = i)),
                  g.render();
                var b = new Dr(
                  "screenShot",
                  f,
                  g,
                  !1,
                  !1,
                  0,
                  !1,
                  mn.NEAREST_SAMPLINGMODE,
                  void 0,
                  u
                );
                (b.renderList = null),
                  (b.samples = s),
                  (b.renderSprites = c),
                  b.onAfterRenderObservable.add(function () {
                    yt.DumpFramebuffer(p, d, t, r, o, l);
                  });
                var T = function () {
                  g.incrementRenderId(),
                    g.resetCachedMaterial(),
                    b.render(!0),
                    b.dispose(),
                    v && (g.activeCamera = v),
                    (g.activeCameras = y),
                    t.setSize(m.width, m.height),
                    i.getProjectionMatrix(!0);
                };
                if (a) {
                  var S = new pd("antialiasing", 1, g.activeCamera);
                  b.addPostProcess(S),
                    S.getEffect().isReady()
                      ? T()
                      : (S.getEffect().onCompiled = function () {
                          T();
                        });
                } else T();
              } else F.Error("No rendering canvas found !");
            } else F.Error("Invalid 'size' parameter !");
          }),
          (e.CreateScreenshotUsingRenderTargetAsync = function (
            t,
            i,
            n,
            r,
            o,
            s,
            a,
            l
          ) {
            return (
              void 0 === r && (r = "image/png"),
              void 0 === o && (o = 1),
              void 0 === s && (s = !1),
              void 0 === l && (l = !1),
              new Promise(function (c, u) {
                e.CreateScreenshotUsingRenderTarget(
                  t,
                  i,
                  n,
                  function (e) {
                    void 0 !== e ? c(e) : u(new Error("Data is undefined"));
                  },
                  r,
                  o,
                  s,
                  a,
                  l
                );
              })
            );
          }),
          (e._getScreenshotSize = function (e, t, i) {
            var n = 0,
              r = 0;
            if ("object" == typeof i) {
              var o = i.precision ? Math.abs(i.precision) : 1;
              i.width && i.height
                ? ((n = i.height * o), (r = i.width * o))
                : i.width && !i.height
                  ? ((r = i.width * o),
                    (n = Math.round(r / e.getAspectRatio(t))))
                  : i.height && !i.width
                    ? ((n = i.height * o),
                      (r = Math.round(n * e.getAspectRatio(t))))
                    : ((r = Math.round(e.getRenderWidth() * o)),
                      (n = Math.round(r / e.getAspectRatio(t))));
            } else isNaN(i) || ((n = i), (r = i));
            return (
              r && (r = Math.floor(r)),
              n && (n = Math.floor(n)),
              {
                height: 0 | n,
                width: 0 | r,
              }
            );
          }),
          e
        );
      })());
  (yt.CreateScreenshot = Ep.CreateScreenshot),
    (yt.CreateScreenshotAsync = Ep.CreateScreenshotAsync),
    (yt.CreateScreenshotUsingRenderTarget =
      Ep.CreateScreenshotUsingRenderTarget),
    (yt.CreateScreenshotUsingRenderTargetAsync =
      Ep.CreateScreenshotUsingRenderTargetAsync),
    (function (e) {
      (e[(e.Checkbox = 0)] = "Checkbox"),
        (e[(e.Slider = 1)] = "Slider"),
        (e[(e.Vector3 = 2)] = "Vector3"),
        (e[(e.Quaternion = 3)] = "Quaternion"),
        (e[(e.Color3 = 4)] = "Color3"),
        (e[(e.String = 5)] = "String");
    })(qd || (qd = {})),
    (function () {
      function e(e) {
        (this.byteOffset = 0), (this.buffer = e);
      }
      (e.prototype.loadAsync = function (e) {
        var t = this;
        return this.buffer.readAsync(this.byteOffset, e).then(function (e) {
          (t._dataView = new DataView(e.buffer, e.byteOffset, e.byteLength)),
            (t._dataByteOffset = 0);
        });
      }),
        (e.prototype.readUint32 = function () {
          var e = this._dataView.getUint32(this._dataByteOffset, !0);
          return (this._dataByteOffset += 4), (this.byteOffset += 4), e;
        }),
        (e.prototype.readUint8Array = function (e) {
          var t = new Uint8Array(
            this._dataView.buffer,
            this._dataView.byteOffset + this._dataByteOffset,
            e
          );
          return (this._dataByteOffset += e), (this.byteOffset += e), t;
        }),
        (e.prototype.readString = function (e) {
          return X.Decode(this.readUint8Array(e));
        }),
        (e.prototype.skipBytes = function (e) {
          (this._dataByteOffset += e), (this.byteOffset += e);
        });
    })(),
    (function () {
      function e() {}
      (e._GetStorage = function () {
        try {
          return (
            localStorage.setItem("test", ""),
            localStorage.removeItem("test"),
            localStorage
          );
        } catch (t) {
          var e = {};
          return {
            getItem: function (t) {
              var i = e[t];
              return void 0 === i ? null : i;
            },
            setItem: function (t, i) {
              e[t] = i;
            },
          };
        }
      }),
        (e.ReadString = function (e, t) {
          var i = this._Storage.getItem(e);
          return null !== i ? i : t;
        }),
        (e.WriteString = function (e, t) {
          this._Storage.setItem(e, t);
        }),
        (e.ReadBoolean = function (e, t) {
          var i = this._Storage.getItem(e);
          return null !== i ? "true" === i : t;
        }),
        (e.WriteBoolean = function (e, t) {
          this._Storage.setItem(e, t ? "true" : "false");
        }),
        (e.ReadNumber = function (e, t) {
          var i = this._Storage.getItem(e);
          return null !== i ? parseFloat(i) : t;
        }),
        (e.WriteNumber = function (e, t) {
          this._Storage.setItem(e, t.toString());
        }),
        (e._Storage = e._GetStorage());
    })(),
    (function () {
      function e() {
        this._trackedScene = null;
      }
      (e.prototype.track = function (e) {
        (this._trackedScene = e), (this._savedJSON = xp.Serialize(e));
      }),
        (e.prototype.getDelta = function () {
          if (!this._trackedScene) return null;
          var e = xp.Serialize(this._trackedScene),
            t = {};
          for (var i in e)
            this._compareCollections(i, this._savedJSON[i], e[i], t);
          return t;
        }),
        (e.prototype._compareArray = function (e, t, i, n) {
          if (0 === t.length && 0 === i.length) return !0;
          if ((t.length && !isNaN(t[0])) || (i.length && !isNaN(i[0]))) {
            if (t.length !== i.length) return !1;
            if (0 === t.length) return !0;
            for (var r = 0; r < t.length; r++)
              if (t[r] !== i[r]) return (n[e] = i), !1;
            return !0;
          }
          var o = [],
            s = function () {
              var s = t[r],
                l = s.uniqueId;
              o.push(l);
              var c = i.filter(function (e) {
                return e.uniqueId === l;
              });
              if (c.length) {
                var u = c[0],
                  h = {};
                a._compareObjects(s, u, h) ||
                  (n[e] || (n[e] = []),
                  (h.__state = {
                    id: u.id || u.name,
                  }),
                  n[e].push(h));
              } else
                (h = {
                  __state: {
                    deleteId: s.id || s.name,
                  },
                }),
                  n[e].push(h);
            },
            a = this;
          for (r = 0; r < t.length; r++) s();
          for (r = 0; r < i.length; r++) {
            var l = i[r],
              c = l.uniqueId;
            -1 === o.indexOf(c) && (n[e] || (n[e] = []), n[e].push(l));
          }
          return !0;
        }),
        (e.prototype._compareObjects = function (e, t, i) {
          var n = !1;
          for (var r in e)
            if (e.hasOwnProperty(r)) {
              var o = e[r],
                s = t[r],
                a = !1;
              Array.isArray(o)
                ? (a = JSON.stringify(o) !== JSON.stringify(s))
                : (isNaN(o) &&
                    "[object String]" != Object.prototype.toString.call(o)) ||
                  (a = o !== s),
                a && ((n = !0), (i[r] = s));
            }
          return !n;
        }),
        (e.prototype._compareCollections = function (e, t, i, n) {
          if (t !== i && t && i)
            if (Array.isArray(t) && Array.isArray(i)) {
              if (this._compareArray(e, t, i, n)) return;
            } else if ("object" == typeof t && "object" == typeof i) {
              var r = {};
              return void (this._compareObjects(t, i, r) || (n[e] = r));
            }
        }),
        (e.GetShadowGeneratorById = function (e, t) {
          for (
            var i = 0,
              n = e.lights.map(function (e) {
                return e.getShadowGenerator();
              });
            i < n.length;
            i++
          ) {
            var r = n[i];
            if (r && r.id === t) return r;
          }
          return null;
        }),
        (e.ApplyDelta = function (e, t) {
          var i = this;
          "string" == typeof e && (e = JSON.parse(e));
          var n = t;
          for (var r in e) {
            var o = e[r],
              s = n[r];
            if (Array.isArray(s) || "shadowGenerators" === r)
              switch (r) {
                case "cameras":
                  this._ApplyDeltaForEntity(
                    o,
                    t,
                    t.getCameraByID.bind(t),
                    function (e) {
                      return Zt.Parse(e, t);
                    }
                  );
                  break;
                case "lights":
                  this._ApplyDeltaForEntity(
                    o,
                    t,
                    t.getLightByID.bind(t),
                    function (e) {
                      return ni.Parse(e, t);
                    }
                  );
                  break;
                case "shadowGenerators":
                  this._ApplyDeltaForEntity(
                    o,
                    t,
                    function (e) {
                      return i.GetShadowGeneratorById(t, e);
                    },
                    function (e) {
                      return Ka.Parse(e, t);
                    }
                  );
                  break;
                case "meshes":
                  this._ApplyDeltaForEntity(
                    o,
                    t,
                    t.getMeshByID.bind(t),
                    function (e) {
                      return Qi.Parse(e, t, "");
                    }
                  );
                  break;
                case "skeletons":
                  this._ApplyDeltaForEntity(
                    o,
                    t,
                    t.getSkeletonById.bind(t),
                    function (e) {
                      return Tn.Parse(e, t);
                    }
                  );
                  break;
                case "materials":
                  this._ApplyDeltaForEntity(
                    o,
                    t,
                    t.getMaterialByID.bind(t),
                    function (e) {
                      return si.Parse(e, t, "");
                    }
                  );
                  break;
                case "multiMaterials":
                  this._ApplyDeltaForEntity(
                    o,
                    t,
                    t.getMaterialByID.bind(t),
                    function (e) {
                      return Gi.Parse(e, t, "");
                    }
                  );
                  break;
                case "transformNodes":
                  this._ApplyDeltaForEntity(
                    o,
                    t,
                    t.getTransformNodeByID.bind(t),
                    function (e) {
                      return At.Parse(e, t, "");
                    }
                  );
                  break;
                case "particleSystems":
                  this._ApplyDeltaForEntity(
                    o,
                    t,
                    t.getParticleSystemByID.bind(t),
                    function (e) {
                      return Dh.Parse(e, t, "");
                    }
                  );
                  break;
                case "morphTargetManagers":
                  this._ApplyDeltaForEntity(
                    o,
                    t,
                    t.getMorphTargetById.bind(t),
                    function (e) {
                      return fl.Parse(e, t);
                    }
                  );
                  break;
                case "postProcesses":
                  this._ApplyDeltaForEntity(
                    o,
                    t,
                    t.getPostProcessByName.bind(t),
                    function (e) {
                      return vr.Parse(e, t, "");
                    }
                  );
              }
            else isNaN(s) ? s.fromArray && s.fromArray(o) : (n[r] = o);
          }
        }),
        (e._ApplyPropertiesToEntity = function (e, t) {
          for (var i in e) {
            var n = e[i],
              r = t[i];
            void 0 !== r &&
              (!isNaN(r) || Array.isArray(r)
                ? (t[i] = n)
                : r.fromArray && r.fromArray(n));
          }
        }),
        (e._ApplyDeltaForEntity = function (e, t, i, n) {
          for (var r = 0, o = e; r < o.length; r++) {
            var s = o[r];
            if (s.__state && void 0 !== s.__state.id) {
              var a = i(s.__state.id);
              a && this._ApplyPropertiesToEntity(s, a);
            } else if (s.__state && void 0 !== s.__state.deleteId) {
              var l = i(s.__state.deleteId);
              null == l || l.dispose();
            } else n(s);
          }
        });
    })(),
    (function (e) {
      var t = (function () {
        function e(e, t, i, n) {
          var r;
          void 0 === t && (t = null),
            void 0 === i && (i = null),
            void 0 === n && (n = null),
            (t =
              null != t
                ? t
                : function () {
                    return 1;
                  }),
            (i =
              null != i
                ? i
                : function () {
                    return 1;
                  }),
            (n =
              null != n
                ? n
                : function (e, t) {
                    return e === t ? 0 : 1;
                  }),
            (this._characterToIdx = new Map()),
            (this._insertionCosts = new Array(e.length)),
            (this._deletionCosts = new Array(e.length)),
            (this._substitutionCosts = new Array(e.length));
          for (var o = 0; o < e.length; ++o) {
            (r = e[o]),
              this._characterToIdx.set(r, o),
              (this._insertionCosts[o] = t(r)),
              (this._deletionCosts[o] = i(r)),
              (this._substitutionCosts[o] = new Array(e.length));
            for (var s = o; s < e.length; ++s)
              this._substitutionCosts[o][s] = n(r, e[s]);
          }
        }
        return (
          (e.prototype.serialize = function () {
            var e = {},
              t = new Array(this._characterToIdx.size);
            return (
              this._characterToIdx.forEach(function (e, i) {
                t[e] = i;
              }),
              (e.characters = t),
              (e.insertionCosts = this._insertionCosts),
              (e.deletionCosts = this._deletionCosts),
              (e.substitutionCosts = this._substitutionCosts),
              JSON.stringify(e)
            );
          }),
          (e.Deserialize = function (t) {
            var i = JSON.parse(t),
              n = new e(i.characters);
            return (
              (n._insertionCosts = i.insertionCosts),
              (n._deletionCosts = i.deletionCosts),
              (n._substitutionCosts = i.substitutionCosts),
              n
            );
          }),
          (e.prototype.getCharacterIdx = function (e) {
            return this._characterToIdx.get(e);
          }),
          (e.prototype.getInsertionCost = function (e) {
            return this._insertionCosts[e];
          }),
          (e.prototype.getDeletionCost = function (e) {
            return this._deletionCosts[e];
          }),
          (e.prototype.getSubstitutionCost = function (e, t) {
            var i = Math.min(e, t),
              n = Math.max(e, t);
            return this._substitutionCosts[i][n];
          }),
          e
        );
      })();
      e.Alphabet = t;
      var i = (function () {
        function e(t, i) {
          var n = this;
          if (t.length > e.MAX_SEQUENCE_LENGTH)
            throw new Error(
              "Sequences longer than " +
                e.MAX_SEQUENCE_LENGTH +
                " not supported."
            );
          (this._alphabet = i),
            (this._characters = t.map(function (e) {
              return n._alphabet.getCharacterIdx(e);
            }));
        }
        return (
          (e.prototype.serialize = function () {
            return JSON.stringify(this._characters);
          }),
          (e.Deserialize = function (t, i) {
            var n = new e([], i);
            return (n._characters = JSON.parse(t)), n;
          }),
          (e.prototype.distance = function (t) {
            return e._distance(this, t);
          }),
          (e._distance = function (t, i) {
            var n = t._alphabet;
            if (n !== i._alphabet)
              throw new Error(
                "Cannot Levenshtein compare Sequences built from different alphabets."
              );
            var r = t._characters,
              o = i._characters,
              s = r.length,
              a = o.length,
              l = e._costMatrix;
            l[0][0] = 0;
            for (var c = 0; c < s; ++c)
              l[c + 1][0] = l[c][0] + n.getInsertionCost(r[c]);
            for (c = 0; c < a; ++c)
              l[0][c + 1] = l[0][c] + n.getInsertionCost(o[c]);
            for (var u = 0; u < s; ++u)
              for (var h = 0; h < a; ++h)
                (e._insertionCost = l[u + 1][h] + n.getInsertionCost(o[h])),
                  (e._deletionCost = l[u][h + 1] + n.getDeletionCost(r[u])),
                  (e._substitutionCost =
                    l[u][h] + n.getSubstitutionCost(r[u], o[h])),
                  (l[u + 1][h + 1] = Math.min(
                    e._insertionCost,
                    e._deletionCost,
                    e._substitutionCost
                  ));
            return l[s][a];
          }),
          (e.MAX_SEQUENCE_LENGTH = 256),
          (e._costMatrix = I(Array(e.MAX_SEQUENCE_LENGTH + 1)).map(
            function (t) {
              return new Array(e.MAX_SEQUENCE_LENGTH + 1);
            }
          )),
          e
        );
      })();
      e.Sequence = i;
    })(Zd || (Zd = {})),
    (function () {
      function e(e) {
        void 0 === e && (e = 0.01),
          (this._points = []),
          (this._segmentLength = e);
      }
      (e.prototype.serialize = function () {
        return JSON.stringify(this);
      }),
        (e.Deserialize = function (t) {
          var i = JSON.parse(t),
            n = new e(i._segmentLength);
          return (
            (n._points = i._points.map(function (e) {
              return new f(e._x, e._y, e._z);
            })),
            n
          );
        }),
        (e.prototype.getLength = function () {
          return this._points.length * this._segmentLength;
        }),
        (e.prototype.add = function (e) {
          var t = this,
            i = this._points.length;
          if (0 === i) this._points.push(e.clone());
          else
            for (
              var n = function () {
                  return t._segmentLength / f.Distance(t._points[i - 1], e);
                },
                r = n();
              r <= 1;
              r = n()
            ) {
              var o = this._points[i - 1].scale(1 - r);
              e.scaleAndAddToRef(r, o), this._points.push(o), ++i;
            }
        }),
        (e.prototype.resampleAtTargetResolution = function (t) {
          var i = new e(this.getLength() / t);
          return (
            this._points.forEach(function (e) {
              i.add(e);
            }),
            i
          );
        }),
        (e.prototype.tokenize = function (t) {
          for (var i = [], n = new f(), r = 2; r < this._points.length; ++r)
            e._transformSegmentDirToRef(
              this._points[r - 2],
              this._points[r - 1],
              this._points[r],
              n
            ) && i.push(e._tokenizeSegment(n, t));
          return i;
        }),
        (e._transformSegmentDirToRef = function (t, i, n, r) {
          return (
            i.subtractToRef(t, e._forwardDir),
            e._forwardDir.normalize(),
            i.scaleToRef(-1, e._inverseFromVec),
            e._inverseFromVec.normalize(),
            !(
              Math.abs(f.Dot(e._forwardDir, e._inverseFromVec)) > 0.98 ||
              (f.CrossToRef(e._forwardDir, e._inverseFromVec, e._upDir),
              e._upDir.normalize(),
              g.LookAtLHToRef(t, i, e._upDir, e._lookMatrix),
              n.subtractToRef(i, e._fromToVec),
              e._fromToVec.normalize(),
              f.TransformNormalToRef(e._fromToVec, e._lookMatrix, r),
              0)
            )
          );
        }),
        (e._tokenizeSegment = function (t, i) {
          (e._bestMatch = 0),
            (e._score = f.Dot(t, i[0])),
            (e._bestScore = e._score);
          for (var n = 1; n < i.length; ++n)
            (e._score = f.Dot(t, i[n])),
              e._score > e._bestScore &&
                ((e._bestMatch = n), (e._bestScore = e._score));
          return e._bestMatch;
        }),
        (e._forwardDir = new f()),
        (e._inverseFromVec = new f()),
        (e._upDir = new f()),
        (e._fromToVec = new f()),
        (e._lookMatrix = new g());
    })();
  var Pp = (function () {
      function e(e) {
        this.chars = new Array(e);
      }
      return (
        (e.Generate = function (t, i, n, r, o) {
          void 0 === t && (t = 64),
            void 0 === i && (i = 256),
            void 0 === n && (n = 0.1),
            void 0 === r && (r = 0.001),
            void 0 === o && (o = []);
          for (var s, a, l = new e(t), c = 0; c < t; ++c)
            (l.chars[c] = new f(
              Math.random() - 0.5,
              Math.random() - 0.5,
              Math.random() - 0.5
            )),
              l.chars[c].normalize();
          for (c = 0; c < o.length; ++c) l.chars[c].copyFrom(o[c]);
          for (var u, h = new f(), d = new f(), p = 0; p < i; ++p) {
            s = (1 - (u = p / (i - 1))) * n + u * r;
            var _ = function (e) {
              h.copyFromFloats(0, 0, 0),
                l.chars.forEach(function (t) {
                  l.chars[e].subtractToRef(t, d),
                    (a = d.lengthSquared()) > 1e-6 &&
                      d.scaleAndAddToRef(1 / (d.lengthSquared() * a), h);
                }),
                h.scaleInPlace(s),
                l.chars[e].addInPlace(h),
                l.chars[e].normalize();
            };
            for (c = o.length; c < l.chars.length; ++c) _(c);
          }
          return l;
        }),
        (e.prototype.serialize = function () {
          return JSON.stringify(this.chars);
        }),
        (e.Deserialize = function (t) {
          for (
            var i = JSON.parse(t), n = new e(i.length), r = 0;
            r < i.length;
            ++r
          )
            n.chars[r] = new f(i[r]._x, i[r]._y, i[r]._z);
          return n;
        }),
        e
      );
    })(),
    Ap = (function () {
      function e() {
        this._sequences = [];
      }
      return (
        (e.prototype.serialize = function () {
          return JSON.stringify(
            this._sequences.map(function (e) {
              return e.serialize();
            })
          );
        }),
        (e.Deserialize = function (t, i) {
          var n = new e();
          return (
            (n._sequences = JSON.parse(t).map(function (e) {
              return Zd.Sequence.Deserialize(e, i);
            })),
            n
          );
        }),
        (e.CreateFromTrajectory = function (t, i, n) {
          return e.CreateFromTokenizationPyramid(
            e._getTokenizationPyramid(t, i),
            n
          );
        }),
        (e.CreateFromTokenizationPyramid = function (t, i) {
          var n = new e();
          return (
            (n._sequences = t.map(function (e) {
              return new Zd.Sequence(e, i);
            })),
            n
          );
        }),
        (e._getTokenizationPyramid = function (t, i, n) {
          void 0 === n && (n = e.FINEST_DESCRIPTOR_RESOLUTION);
          for (var r = [], o = n; o > 4; o = Math.floor(o / 2))
            r.push(t.resampleAtTargetResolution(o).tokenize(i.chars));
          return r;
        }),
        (e.prototype.distance = function (e) {
          for (var t = 0, i = 0; i < this._sequences.length; ++i)
            t += Math.pow(2, i) * this._sequences[i].distance(e._sequences[i]);
          return t;
        }),
        (e.FINEST_DESCRIPTOR_RESOLUTION = 32),
        e
      );
    })(),
    Rp = (function () {
      function e(e) {
        void 0 === e && (e = []),
          (this._descriptors = e),
          (this._centroidIdx = -1),
          (this._averageDistance = 0),
          this._refreshDescription();
      }
      return (
        (e.prototype.serialize = function () {
          var e = {};
          return (
            (e.descriptors = this._descriptors.map(function (e) {
              return e.serialize();
            })),
            (e.centroidIdx = this._centroidIdx),
            (e.averageDistance = this._averageDistance),
            JSON.stringify(e)
          );
        }),
        (e.Deserialize = function (t, i) {
          var n = JSON.parse(t),
            r = new e();
          return (
            (r._descriptors = n.descriptors.map(function (e) {
              return Ap.Deserialize(e, i);
            })),
            (r._centroidIdx = n.centroidIdx),
            (r._averageDistance = n.averageDistance),
            r
          );
        }),
        (e.prototype.add = function (e) {
          this._descriptors.push(e), this._refreshDescription();
        }),
        (e.prototype.getMatchCost = function (e) {
          return (
            e.distance(this._descriptors[this._centroidIdx]) /
            this._averageDistance
          );
        }),
        (e.prototype.getMatchMinimumDistance = function (e) {
          return Math.min.apply(
            Math,
            this._descriptors.map(function (t) {
              return t.distance(e);
            })
          );
        }),
        (e.prototype._refreshDescription = function () {
          var t,
            i = this;
          this._centroidIdx = -1;
          for (
            var n = this._descriptors.map(function (e) {
                return (
                  (t = 0),
                  i._descriptors.forEach(function (i) {
                    t += e.distance(i);
                  }),
                  t
                );
              }),
              r = 0;
            r < n.length;
            ++r
          )
            (this._centroidIdx < 0 || n[r] < n[this._centroidIdx]) &&
              (this._centroidIdx = r);
          (this._averageDistance = 0),
            this._descriptors.forEach(function (e) {
              i._averageDistance += e.distance(i._descriptors[i._centroidIdx]);
            }),
            this._descriptors.length > 0 &&
              (this._averageDistance = Math.max(
                this._averageDistance / this._descriptors.length,
                e.MIN_AVERAGE_DISTANCE
              ));
        }),
        (e.MIN_AVERAGE_DISTANCE = 1),
        e
      );
    })(),
    Mp =
      ((function () {
        function e() {
          (this._maximumAllowableMatchCost = 4),
            (this._nameToDescribedTrajectory = new Map());
        }
        (e.prototype.serialize = function () {
          var e = {};
          return (
            (e.maximumAllowableMatchCost = this._maximumAllowableMatchCost),
            (e.vector3Alphabet = this._vector3Alphabet.serialize()),
            (e.levenshteinAlphabet = this._levenshteinAlphabet.serialize()),
            (e.nameToDescribedTrajectory = []),
            this._nameToDescribedTrajectory.forEach(function (t, i) {
              e.nameToDescribedTrajectory.push(i),
                e.nameToDescribedTrajectory.push(t.serialize());
            }),
            JSON.stringify(e)
          );
        }),
          (e.Deserialize = function (t) {
            var i = JSON.parse(t),
              n = new e();
            (n._maximumAllowableMatchCost = i.maximumAllowableMatchCost),
              (n._vector3Alphabet = Pp.Deserialize(i.vector3Alphabet)),
              (n._levenshteinAlphabet = Zd.Alphabet.Deserialize(
                i.levenshteinAlphabet
              ));
            for (var r = 0; r < i.nameToDescribedTrajectory.length; r += 2)
              n._nameToDescribedTrajectory.set(
                i.nameToDescribedTrajectory[r],
                Rp.Deserialize(
                  i.nameToDescribedTrajectory[r + 1],
                  n._levenshteinAlphabet
                )
              );
            return n;
          }),
          (e.Generate = function () {
            for (
              var t = Pp.Generate(64, 256, 0.1, 0.001, [f.Forward()]),
                i = new Array(t.chars.length),
                n = 0;
              n < i.length;
              ++n
            )
              i[n] = n;
            var r = new Zd.Alphabet(
                i,
                function (e) {
                  return 0 === e ? 0 : 1;
                },
                function (e) {
                  return 0 === e ? 0 : 1;
                },
                function (e, i) {
                  return Math.min(1 - f.Dot(t.chars[e], t.chars[i]), 1);
                }
              ),
              o = new e();
            return (o._vector3Alphabet = t), (o._levenshteinAlphabet = r), o;
          }),
          (e.prototype.addTrajectoryToClassification = function (e, t) {
            this._nameToDescribedTrajectory.has(t) ||
              this._nameToDescribedTrajectory.set(t, new Rp()),
              this._nameToDescribedTrajectory
                .get(t)
                .add(
                  Ap.CreateFromTrajectory(
                    e,
                    this._vector3Alphabet,
                    this._levenshteinAlphabet
                  )
                );
          }),
          (e.prototype.deleteClassification = function (e) {
            return this._nameToDescribedTrajectory.delete(e);
          }),
          (e.prototype.classifyTrajectory = function (e) {
            var t = this,
              i = Ap.CreateFromTrajectory(
                e,
                this._vector3Alphabet,
                this._levenshteinAlphabet
              ),
              n = [];
            if (
              (this._nameToDescribedTrajectory.forEach(function (e, r) {
                e.getMatchCost(i) < t._maximumAllowableMatchCost && n.push(r);
              }),
              0 === n.length)
            )
              return null;
            for (
              var r,
                o = 0,
                s = this._nameToDescribedTrajectory
                  .get(n[o])
                  .getMatchMinimumDistance(i),
                a = 0;
              a < n.length;
              ++a
            )
              (r = this._nameToDescribedTrajectory
                .get(n[a])
                .getMatchMinimumDistance(i)) < s && ((s = r), (o = a));
            return n[o];
          });
      })(),
      (function (e) {
        function t(i, n) {
          void 0 === n && (n = {});
          var r = e.call(this, i) || this;
          return (
            (r.options = n),
            (r._direction = new f(0, 0, -1)),
            (r._mat = new g()),
            (r._onSelectEnabled = !1),
            (r._origin = new f(0, 0, 0)),
            (r.lastNativeXRHitResults = []),
            (r.onHitTestResultObservable = new o()),
            (r._onHitTestResults = function (e) {
              var t = e.map(function (e) {
                var t = g.FromArray(e.hitMatrix);
                return (
                  r._xrSessionManager.scene.useRightHandedSystem ||
                    t.toggleModelMatrixHandInPlace(),
                  r.options.worldParentNode &&
                    t.multiplyToRef(
                      r.options.worldParentNode.getWorldMatrix(),
                      t
                    ),
                  {
                    xrHitResult: e,
                    transformationMatrix: t,
                  }
                );
              });
              (r.lastNativeXRHitResults = e),
                r.onHitTestResultObservable.notifyObservers(t);
            }),
            (r._onSelect = function (e) {
              r._onSelectEnabled &&
                t.XRHitTestWithSelectEvent(
                  e,
                  r._xrSessionManager.referenceSpace
                );
            }),
            (r.xrNativeFeatureName = "hit-test"),
            yt.Warn("A newer version of this plugin is available"),
            r
          );
        }
        return (
          P(t, e),
          (t.XRHitTestWithRay = function (e, t, i, n) {
            return e.requestHitTest(t, i).then(function (e) {
              var t =
                n ||
                function (e) {
                  return !!e.hitMatrix;
                };
              return e.filter(t);
            });
          }),
          (t.XRHitTestWithSelectEvent = function (e, t) {
            var i = e.frame.getPose(e.inputSource.targetRaySpace, t);
            if (!i) return Promise.resolve([]);
            var n = new XRRay(i.transform);
            return this.XRHitTestWithRay(e.frame.session, n, t);
          }),
          (t.prototype.attach = function () {
            return (
              !!e.prototype.attach.call(this) &&
              (this.options.testOnPointerDownOnly &&
                this._xrSessionManager.session.addEventListener(
                  "select",
                  this._onSelect,
                  !1
                ),
              !0)
            );
          }),
          (t.prototype.detach = function () {
            return (
              !!e.prototype.detach.call(this) &&
              ((this._onSelectEnabled = !1),
              this._xrSessionManager.session.removeEventListener(
                "select",
                this._onSelect
              ),
              !0)
            );
          }),
          (t.prototype.dispose = function () {
            e.prototype.dispose.call(this),
              this.onHitTestResultObservable.clear();
          }),
          (t.prototype._onXRFrame = function (e) {
            if (this.attached && !this.options.testOnPointerDownOnly) {
              var i = e.getViewerPose(this._xrSessionManager.referenceSpace);
              if (i) {
                g.FromArrayToRef(i.transform.matrix, 0, this._mat),
                  f.TransformCoordinatesFromFloatsToRef(
                    0,
                    0,
                    0,
                    this._mat,
                    this._origin
                  ),
                  f.TransformCoordinatesFromFloatsToRef(
                    0,
                    0,
                    -1,
                    this._mat,
                    this._direction
                  ),
                  this._direction.subtractInPlace(this._origin),
                  this._direction.normalize();
                var n = new XRRay(
                  {
                    x: this._origin.x,
                    y: this._origin.y,
                    z: this._origin.z,
                    w: 0,
                  },
                  {
                    x: this._direction.x,
                    y: this._direction.y,
                    z: this._direction.z,
                    w: 0,
                  }
                );
                t.XRHitTestWithRay(
                  this._xrSessionManager.session,
                  n,
                  this._xrSessionManager.referenceSpace
                ).then(this._onHitTestResults);
              }
            }
          }),
          (t.Name = fa.HIT_TEST),
          (t.Version = 1),
          t
        );
      })(Pa));
  _a.AddWebXRFeature(
    Mp.Name,
    function (e, t) {
      return function () {
        return new Mp(e, t);
      };
    },
    Mp.Version,
    !1
  );
  var Op = 0,
    Ip = (function (e) {
      function t(t, i) {
        void 0 === i && (i = {});
        var n = e.call(this, t) || this;
        return (
          (n._options = i),
          (n._lastFrameDetected = new Set()),
          (n._trackedAnchors = []),
          (n._futureAnchors = []),
          (n.onAnchorAddedObservable = new o()),
          (n.onAnchorRemovedObservable = new o()),
          (n.onAnchorUpdatedObservable = new o()),
          (n._tmpVector = new f()),
          (n._tmpQuaternion = new m()),
          (n.xrNativeFeatureName = "anchors"),
          n
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "referenceSpaceForFrameAnchors", {
          set: function (e) {
            this._referenceSpaceForFrameAnchors = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._populateTmpTransformation = function (e, t) {
          return (
            this._tmpVector.copyFrom(e),
            this._tmpQuaternion.copyFrom(t),
            this._xrSessionManager.scene.useRightHandedSystem ||
              ((this._tmpVector.z *= -1),
              (this._tmpQuaternion.z *= -1),
              (this._tmpQuaternion.w *= -1)),
            {
              position: this._tmpVector,
              rotationQuaternion: this._tmpQuaternion,
            }
          );
        }),
        (t.prototype.addAnchorPointUsingHitTestResultAsync = function (
          e,
          t,
          i
        ) {
          return (
            void 0 === t && (t = new f()),
            void 0 === i && (i = new m()),
            M(this, void 0, void 0, function () {
              var n,
                r,
                o,
                s = this;
              return O(this, function (a) {
                switch (a.label) {
                  case 0:
                    if (
                      (this._populateTmpTransformation(t, i),
                      (n = new XRRigidTransform(
                        {
                          x: this._tmpVector.x,
                          y: this._tmpVector.y,
                          z: this._tmpVector.z,
                        },
                        {
                          x: this._tmpQuaternion.x,
                          y: this._tmpQuaternion.y,
                          z: this._tmpQuaternion.z,
                          w: this._tmpQuaternion.w,
                        }
                      )),
                      e.xrHitResult.createAnchor)
                    )
                      return [3, 1];
                    throw (
                      (this.detach(),
                      new Error(
                        "Anchors not enabled in this environment/browser"
                      ))
                    );
                  case 1:
                    return (
                      a.trys.push([1, 3, , 4]),
                      [4, e.xrHitResult.createAnchor(n)]
                    );
                  case 2:
                    return (
                      (r = a.sent()),
                      [
                        2,
                        new Promise(function (e, t) {
                          s._futureAnchors.push({
                            nativeAnchor: r,
                            resolved: !1,
                            submitted: !0,
                            xrTransformation: n,
                            resolve: e,
                            reject: t,
                          });
                        }),
                      ]
                    );
                  case 3:
                    throw ((o = a.sent()), new Error(o));
                  case 4:
                    return [2];
                }
              });
            })
          );
        }),
        (t.prototype.addAnchorAtPositionAndRotationAsync = function (e, t, i) {
          return (
            void 0 === t && (t = new m()),
            void 0 === i && (i = !1),
            M(this, void 0, void 0, function () {
              var n,
                r,
                o,
                s = this;
              return O(this, function (a) {
                switch (a.label) {
                  case 0:
                    return (
                      this._populateTmpTransformation(e, t),
                      (n = new XRRigidTransform(
                        {
                          x: this._tmpVector.x,
                          y: this._tmpVector.y,
                          z: this._tmpVector.z,
                        },
                        {
                          x: this._tmpQuaternion.x,
                          y: this._tmpQuaternion.y,
                          z: this._tmpQuaternion.z,
                          w: this._tmpQuaternion.w,
                        }
                      )),
                      i && this.attached && this._xrSessionManager.currentFrame
                        ? [
                            4,
                            this._createAnchorAtTransformation(
                              n,
                              this._xrSessionManager.currentFrame
                            ),
                          ]
                        : [3, 2]
                    );
                  case 1:
                    return (o = a.sent()), [3, 3];
                  case 2:
                    (o = void 0), (a.label = 3);
                  case 3:
                    return (
                      (r = o),
                      [
                        2,
                        new Promise(function (e, t) {
                          s._futureAnchors.push({
                            nativeAnchor: r,
                            resolved: !1,
                            submitted: !1,
                            xrTransformation: n,
                            resolve: e,
                            reject: t,
                          });
                        }),
                      ]
                    );
                }
              });
            })
          );
        }),
        Object.defineProperty(t.prototype, "anchors", {
          get: function () {
            return this._trackedAnchors;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.detach = function () {
          if (!e.prototype.detach.call(this)) return !1;
          if (!this._options.doNotRemoveAnchorsOnSessionEnded)
            for (; this._trackedAnchors.length; ) {
              var t = this._trackedAnchors.pop();
              if (t) {
                try {
                  t.remove();
                } catch (e) {}
                this.onAnchorRemovedObservable.notifyObservers(t);
              }
            }
          return !0;
        }),
        (t.prototype.dispose = function () {
          (this._futureAnchors.length = 0),
            e.prototype.dispose.call(this),
            this.onAnchorAddedObservable.clear(),
            this.onAnchorRemovedObservable.clear(),
            this.onAnchorUpdatedObservable.clear();
        }),
        (t.prototype._onXRFrame = function (e) {
          var t = this;
          if (this.attached && e) {
            var i = e.trackedAnchors;
            if (i) {
              var n = this._trackedAnchors
                  .filter(function (e) {
                    return !i.has(e.xrAnchor);
                  })
                  .map(function (e) {
                    return t._trackedAnchors.indexOf(e);
                  }),
                r = 0;
              n.forEach(function (e) {
                var i = t._trackedAnchors.splice(e - r, 1)[0];
                t.onAnchorRemovedObservable.notifyObservers(i), r++;
              }),
                i.forEach(function (i) {
                  if (t._lastFrameDetected.has(i)) {
                    var n = t._findIndexInAnchorArray(i);
                    o = t._trackedAnchors[n];
                    try {
                      t._updateAnchorWithXRFrame(i, o, e),
                        o.attachedNode &&
                          ((o.attachedNode.rotationQuaternion =
                            o.attachedNode.rotationQuaternion || new m()),
                          o.transformationMatrix.decompose(
                            o.attachedNode.scaling,
                            o.attachedNode.rotationQuaternion,
                            o.attachedNode.position
                          )),
                        t.onAnchorUpdatedObservable.notifyObservers(o);
                    } catch (e) {
                      yt.Warn("Anchor could not be updated");
                    }
                  } else {
                    var r = {
                        id: Op++,
                        xrAnchor: i,
                        remove: i.delete,
                      },
                      o = t._updateAnchorWithXRFrame(i, r, e);
                    t._trackedAnchors.push(o),
                      t.onAnchorAddedObservable.notifyObservers(o);
                    var s = t._futureAnchors.filter(function (e) {
                      return e.nativeAnchor === i;
                    })[0];
                    s && (s.resolve(o), (s.resolved = !0));
                  }
                }),
                (this._lastFrameDetected = i);
            }
            this._futureAnchors.forEach(function (i) {
              i.resolved ||
                i.submitted ||
                (t._createAnchorAtTransformation(i.xrTransformation, e).then(
                  function (e) {
                    i.nativeAnchor = e;
                  },
                  function (e) {
                    (i.resolved = !0), i.reject(e);
                  }
                ),
                (i.submitted = !0));
            });
          }
        }),
        (t.prototype._findIndexInAnchorArray = function (e) {
          for (var t = 0; t < this._trackedAnchors.length; ++t)
            if (this._trackedAnchors[t].xrAnchor === e) return t;
          return -1;
        }),
        (t.prototype._updateAnchorWithXRFrame = function (e, t, i) {
          var n = i.getPose(
            e.anchorSpace,
            this._xrSessionManager.referenceSpace
          );
          if (n) {
            var r = t.transformationMatrix || new g();
            g.FromArrayToRef(n.transform.matrix, 0, r),
              this._xrSessionManager.scene.useRightHandedSystem ||
                r.toggleModelMatrixHandInPlace(),
              (t.transformationMatrix = r),
              this._options.worldParentNode &&
                r.multiplyToRef(
                  this._options.worldParentNode.getWorldMatrix(),
                  r
                );
          }
          return t;
        }),
        (t.prototype._createAnchorAtTransformation = function (e, t) {
          var i;
          return M(this, void 0, void 0, function () {
            return O(this, function (n) {
              if (!t.createAnchor)
                throw (
                  (this.detach(),
                  new Error("Anchors are not enabled in your browser"))
                );
              try {
                return [
                  2,
                  t.createAnchor(
                    e,
                    null !== (i = this._referenceSpaceForFrameAnchors) &&
                      void 0 !== i
                      ? i
                      : this._xrSessionManager.referenceSpace
                  ),
                ];
              } catch (e) {
                throw new Error(e);
              }
              return [2];
            });
          });
        }),
        (t.Name = fa.ANCHOR_SYSTEM),
        (t.Version = 1),
        t
      );
    })(Pa);
  _a.AddWebXRFeature(
    Ip.Name,
    function (e, t) {
      return function () {
        return new Ip(e, t);
      };
    },
    Ip.Version
  );
  var Dp = 0,
    wp = (function (e) {
      function t(t, i) {
        void 0 === i && (i = {});
        var n = e.call(this, t) || this;
        return (
          (n._options = i),
          (n._detectedPlanes = []),
          (n._enabled = !1),
          (n._lastFrameDetected = new Set()),
          (n.onPlaneAddedObservable = new o()),
          (n.onPlaneRemovedObservable = new o()),
          (n.onPlaneUpdatedObservable = new o()),
          (n.xrNativeFeatureName = "plane-detection"),
          n._xrSessionManager.session
            ? n._init()
            : n._xrSessionManager.onXRSessionInit.addOnce(function () {
                n._init();
              }),
          n
        );
      }
      return (
        P(t, e),
        (t.prototype.detach = function () {
          if (!e.prototype.detach.call(this)) return !1;
          if (!this._options.doNotRemovePlanesOnSessionEnded)
            for (; this._detectedPlanes.length; ) {
              var t = this._detectedPlanes.pop();
              t && this.onPlaneRemovedObservable.notifyObservers(t);
            }
          return !0;
        }),
        (t.prototype.dispose = function () {
          e.prototype.dispose.call(this),
            this.onPlaneAddedObservable.clear(),
            this.onPlaneRemovedObservable.clear(),
            this.onPlaneUpdatedObservable.clear();
        }),
        (t.prototype.isCompatible = function () {
          return "undefined" != typeof XRPlane;
        }),
        (t.prototype._onXRFrame = function (e) {
          var t = this;
          if (this.attached && this._enabled && e) {
            var i = e.worldInformation.detectedPlanes;
            if (i) {
              var n = this._detectedPlanes
                  .filter(function (e) {
                    return !i.has(e.xrPlane);
                  })
                  .map(function (e) {
                    return t._detectedPlanes.indexOf(e);
                  }),
                r = 0;
              n.forEach(function (e) {
                var i = t._detectedPlanes.splice(e - r, 1)[0];
                t.onPlaneRemovedObservable.notifyObservers(i), r++;
              }),
                i.forEach(function (i) {
                  if (t._lastFrameDetected.has(i)) {
                    if (
                      i.lastChangedTime === t._xrSessionManager.currentTimestamp
                    ) {
                      var n = t.findIndexInPlaneArray(i);
                      (o = t._detectedPlanes[n]),
                        t._updatePlaneWithXRPlane(i, o, e),
                        t.onPlaneUpdatedObservable.notifyObservers(o);
                    }
                  } else {
                    var r = {
                        id: Dp++,
                        xrPlane: i,
                        polygonDefinition: [],
                      },
                      o = t._updatePlaneWithXRPlane(i, r, e);
                    t._detectedPlanes.push(o),
                      t.onPlaneAddedObservable.notifyObservers(o);
                  }
                }),
                (this._lastFrameDetected = i);
            }
          }
        }),
        (t.prototype._init = function () {
          var e,
            t,
            i = this,
            n = function () {
              (i._enabled = !0),
                i._detectedPlanes.length && (i._detectedPlanes.length = 0);
            };
          this._xrSessionManager.session.updateWorldTrackingState
            ? (this._xrSessionManager.session.updateWorldTrackingState({
                planeDetectionState: {
                  enabled: !0,
                },
              }),
              n())
            : (null ===
                (t =
                  null ===
                    (e = this._xrSessionManager.session.worldTrackingState) ||
                  void 0 === e
                    ? void 0
                    : e.planeDetectionState) || void 0 === t
                ? void 0
                : t.enabled) && n();
        }),
        (t.prototype._updatePlaneWithXRPlane = function (e, t, i) {
          var n = this;
          t.polygonDefinition = e.polygon.map(function (e) {
            var t = n._xrSessionManager.scene.useRightHandedSystem ? 1 : -1;
            return new f(e.x, e.y, e.z * t);
          });
          var r = i.getPose(
            e.planeSpace,
            this._xrSessionManager.referenceSpace
          );
          if (r) {
            var o = t.transformationMatrix || new g();
            g.FromArrayToRef(r.transform.matrix, 0, o),
              this._xrSessionManager.scene.useRightHandedSystem ||
                o.toggleModelMatrixHandInPlace(),
              (t.transformationMatrix = o),
              this._options.worldParentNode &&
                o.multiplyToRef(
                  this._options.worldParentNode.getWorldMatrix(),
                  o
                );
          }
          return t;
        }),
        (t.prototype.findIndexInPlaneArray = function (e) {
          for (var t = 0; t < this._detectedPlanes.length; ++t)
            if (this._detectedPlanes[t].xrPlane === e) return t;
          return -1;
        }),
        (t.Name = fa.PLANE_DETECTION),
        (t.Version = 1),
        t
      );
    })(Pa);
  _a.AddWebXRFeature(
    wp.Name,
    function (e, t) {
      return function () {
        return new wp(e, t);
      };
    },
    wp.Version
  );
  var Np = (function (e) {
    function t(t, i) {
      void 0 === i && (i = {});
      var n = e.call(this, t) || this;
      return (
        (n.options = i), (n.onBackgroundStateChangedObservable = new o()), n
      );
    }
    return (
      P(t, e),
      (t.prototype.attach = function () {
        return this._setBackgroundState(!1), e.prototype.attach.call(this);
      }),
      (t.prototype.detach = function () {
        return this._setBackgroundState(!0), e.prototype.detach.call(this);
      }),
      (t.prototype.dispose = function () {
        e.prototype.dispose.call(this),
          this.onBackgroundStateChangedObservable.clear();
      }),
      (t.prototype._onXRFrame = function (e) {}),
      (t.prototype._setBackgroundState = function (e) {
        var t = this._xrSessionManager.scene;
        if (!this.options.ignoreEnvironmentHelper)
          if (this.options.environmentHelperRemovalFlags) {
            if (this.options.environmentHelperRemovalFlags.skyBox) {
              var i = t.getMeshByName("BackgroundSkybox");
              i && i.setEnabled(e);
            }
            if (this.options.environmentHelperRemovalFlags.ground) {
              var n = t.getMeshByName("BackgroundPlane");
              n && n.setEnabled(e);
            }
          } else {
            var r = t.getMeshByName("BackgroundHelper");
            r && r.setEnabled(e);
          }
        this.options.backgroundMeshes &&
          this.options.backgroundMeshes.forEach(function (t) {
            return t.setEnabled(e);
          }),
          this.onBackgroundStateChangedObservable.notifyObservers(e);
      }),
      (t.Name = fa.BACKGROUND_REMOVER),
      (t.Version = 1),
      t
    );
  })(Pa);
  _a.AddWebXRFeature(
    Np.Name,
    function (e, t) {
      return function () {
        return new Np(e, t);
      };
    },
    Np.Version,
    !0
  );
  var Lp = (function (e) {
    function t(t, i) {
      var n = e.call(this, t) || this;
      return (
        (n._options = i),
        (n._attachController = function (e) {
          if (!n._controllers[e.uniqueId])
            if (
              (n._xrSessionManager.scene.isPhysicsEnabled() ||
                F.Warn(
                  "physics engine not enabled, skipped. Please add this controller manually."
                ),
              n._options.physicsProperties.useControllerMesh &&
                e.inputSource.gamepad)
            )
              e.onMotionControllerInitObservable.addOnce(function (t) {
                t.onModelLoadedObservable.addOnce(function () {
                  var i = new Mo(
                      t.rootMesh,
                      Mo.MeshImpostor,
                      A(
                        {
                          mass: 0,
                        },
                        n._options.physicsProperties
                      )
                    ),
                    r = e.grip || e.pointer;
                  n._controllers[e.uniqueId] = {
                    xrController: e,
                    impostor: i,
                    oldPos: r.position.clone(),
                    oldRotation: r.rotationQuaternion.clone(),
                  };
                });
              });
            else {
              var t =
                  n._options.physicsProperties.impostorType ||
                  Mo.SphereImpostor,
                i = n._options.physicsProperties.impostorSize || 0.1,
                r = Po.CreateSphere("impostor-mesh-" + e.uniqueId, {
                  diameterX: "number" == typeof i ? i : i.width,
                  diameterY: "number" == typeof i ? i : i.height,
                  diameterZ: "number" == typeof i ? i : i.depth,
                });
              (r.isVisible = n._debugMode),
                (r.isPickable = !1),
                (r.rotationQuaternion = new m());
              var o = e.grip || e.pointer;
              r.position.copyFrom(o.position),
                r.rotationQuaternion.copyFrom(o.rotationQuaternion);
              var s = new Mo(
                r,
                t,
                A(
                  {
                    mass: 0,
                  },
                  n._options.physicsProperties
                )
              );
              n._controllers[e.uniqueId] = {
                xrController: e,
                impostor: s,
                impostorMesh: r,
              };
            }
        }),
        (n._controllers = {}),
        (n._debugMode = !1),
        (n._delta = 0),
        (n._lastTimestamp = 0),
        (n._tmpQuaternion = new m()),
        (n._tmpVector = new f()),
        n._options.physicsProperties || (n._options.physicsProperties = {}),
        n
      );
    }
    return (
      P(t, e),
      (t.prototype._enablePhysicsDebug = function () {
        var e = this;
        (this._debugMode = !0),
          Object.keys(this._controllers).forEach(function (t) {
            var i = e._controllers[t];
            i.impostorMesh && (i.impostorMesh.isVisible = !0);
          });
      }),
      (t.prototype.addController = function (e) {
        this._attachController(e);
      }),
      (t.prototype.attach = function () {
        var t = this;
        if (!e.prototype.attach.call(this)) return !1;
        if (!this._options.xrInput) return !0;
        if (
          (this._options.xrInput.controllers.forEach(this._attachController),
          this._addNewAttachObserver(
            this._options.xrInput.onControllerAddedObservable,
            this._attachController
          ),
          this._addNewAttachObserver(
            this._options.xrInput.onControllerRemovedObservable,
            function (e) {
              t._detachController(e.uniqueId);
            }
          ),
          this._options.enableHeadsetImpostor)
        ) {
          var i = this._options.headsetImpostorParams || {
              impostorType: Mo.SphereImpostor,
              restitution: 0.8,
              impostorSize: 0.3,
            },
            n = i.impostorSize || 0.3;
          (this._headsetMesh = Po.CreateSphere("headset-mesh", {
            diameterX: "number" == typeof n ? n : n.width,
            diameterY: "number" == typeof n ? n : n.height,
            diameterZ: "number" == typeof n ? n : n.depth,
          })),
            (this._headsetMesh.rotationQuaternion = new m()),
            (this._headsetMesh.isVisible = !1),
            (this._headsetImpostor = new Mo(
              this._headsetMesh,
              i.impostorType,
              A(
                {
                  mass: 0,
                },
                i
              )
            ));
        }
        return !0;
      }),
      (t.prototype.detach = function () {
        var t = this;
        return (
          !!e.prototype.detach.call(this) &&
          (Object.keys(this._controllers).forEach(function (e) {
            t._detachController(e);
          }),
          this._headsetMesh && this._headsetMesh.dispose(),
          !0)
        );
      }),
      (t.prototype.getHeadsetImpostor = function () {
        return this._headsetImpostor;
      }),
      (t.prototype.getImpostorForController = function (e) {
        var t = "string" == typeof e ? e : e.uniqueId;
        return this._controllers[t] ? this._controllers[t].impostor : null;
      }),
      (t.prototype.setPhysicsProperties = function (e) {
        this._options.physicsProperties = A(
          A({}, this._options.physicsProperties),
          e
        );
      }),
      (t.prototype._onXRFrame = function (e) {
        var t = this;
        (this._delta =
          this._xrSessionManager.currentTimestamp - this._lastTimestamp),
          (this._lastTimestamp = this._xrSessionManager.currentTimestamp),
          this._headsetMesh &&
            (this._headsetMesh.position.copyFrom(
              this._options.xrInput.xrCamera.position
            ),
            this._headsetMesh.rotationQuaternion.copyFrom(
              this._options.xrInput.xrCamera.rotationQuaternion
            )),
          Object.keys(this._controllers).forEach(function (e) {
            var i = t._controllers[e],
              n = i.xrController.grip || i.xrController.pointer,
              r = i.oldPos || i.impostorMesh.position,
              o = i.oldRotation || i.impostorMesh.rotationQuaternion;
            if (
              (n.position.subtractToRef(r, t._tmpVector),
              t._tmpVector.scaleInPlace(1e3 / t._delta),
              i.impostor.setLinearVelocity(t._tmpVector),
              t._debugMode && console.log(t._tmpVector, "linear"),
              !o.equalsWithEpsilon(n.rotationQuaternion))
            ) {
              o.conjugateInPlace().multiplyToRef(
                n.rotationQuaternion,
                t._tmpQuaternion
              );
              var s = Math.sqrt(
                t._tmpQuaternion.x * t._tmpQuaternion.x +
                  t._tmpQuaternion.y * t._tmpQuaternion.y +
                  t._tmpQuaternion.z * t._tmpQuaternion.z
              );
              if (
                (t._tmpVector.set(
                  t._tmpQuaternion.x,
                  t._tmpQuaternion.y,
                  t._tmpQuaternion.z
                ),
                s < 0.001)
              )
                t._tmpVector.scaleInPlace(2);
              else {
                var a = 2 * Math.atan2(s, t._tmpQuaternion.w);
                t._tmpVector.scaleInPlace(a / (s * (t._delta / 1e3)));
              }
              i.impostor.setAngularVelocity(t._tmpVector),
                t._debugMode &&
                  console.log(t._tmpVector, t._tmpQuaternion, "angular");
            }
            r.copyFrom(n.position), o.copyFrom(n.rotationQuaternion);
          });
      }),
      (t.prototype._detachController = function (e) {
        var t = this._controllers[e];
        t &&
          (t.impostorMesh && t.impostorMesh.dispose(),
          delete this._controllers[e]);
      }),
      (t.Name = fa.PHYSICS_CONTROLLERS),
      (t.Version = 1),
      t
    );
  })(Pa);
  _a.AddWebXRFeature(
    Lp.Name,
    function (e, t) {
      return function () {
        return new Lp(e, t);
      };
    },
    Lp.Version,
    !0
  );
  var Fp = (function (e) {
    function t(t, i) {
      void 0 === i && (i = {});
      var n = e.call(this, t) || this;
      return (
        (n.options = i),
        (n._tmpMat = new g()),
        (n._tmpPos = new f()),
        (n._tmpQuat = new m()),
        (n.initHitTestSource = function (e) {
          if (e) {
            var t = new XRRay(n.options.offsetRay || {}),
              i = {
                space: n.options.useReferenceSpace
                  ? e
                  : n._xrSessionManager.viewerReferenceSpace,
                offsetRay: t,
              };
            n.options.entityTypes && (i.entityTypes = n.options.entityTypes),
              i.space
                ? n._xrSessionManager.session
                    .requestHitTestSource(i)
                    .then(function (e) {
                      n._xrHitTestSource && n._xrHitTestSource.cancel(),
                        (n._xrHitTestSource = e);
                    })
                : yt.Warn("waiting for viewer reference space to initialize");
          }
        }),
        (n.autoCloneTransformation = !1),
        (n.onHitTestResultObservable = new o()),
        (n.paused = !1),
        (n.xrNativeFeatureName = "hit-test"),
        yt.Warn("Hit test is an experimental and unstable feature."),
        n
      );
    }
    return (
      P(t, e),
      (t.prototype.attach = function () {
        var t = this;
        if (!e.prototype.attach.call(this)) return !1;
        if (!this._xrSessionManager.session.requestHitTestSource) return !1;
        if (
          (this.options.disablePermanentHitTest ||
            (this._xrSessionManager.referenceSpace &&
              this.initHitTestSource(this._xrSessionManager.referenceSpace),
            this._xrSessionManager.onXRReferenceSpaceChanged.add(
              this.initHitTestSource
            )),
          this.options.enableTransientHitTest)
        ) {
          var i = new XRRay(this.options.transientOffsetRay || {});
          this._xrSessionManager.session
            .requestHitTestSourceForTransientInput({
              profile: "generic-touchscreen",
              offsetRay: i,
              entityTypes: this.options.entityTypes,
            })
            .then(function (e) {
              t._transientXrHitTestSource = e;
            });
        }
        return !0;
      }),
      (t.prototype.detach = function () {
        return (
          !!e.prototype.detach.call(this) &&
          (this._xrHitTestSource &&
            (this._xrHitTestSource.cancel(), (this._xrHitTestSource = null)),
          this._xrSessionManager.onXRReferenceSpaceChanged.removeCallback(
            this.initHitTestSource
          ),
          this._transientXrHitTestSource &&
            (this._transientXrHitTestSource.cancel(),
            (this._transientXrHitTestSource = null)),
          !0)
        );
      }),
      (t.prototype.dispose = function () {
        e.prototype.dispose.call(this), this.onHitTestResultObservable.clear();
      }),
      (t.prototype._onXRFrame = function (e) {
        var t = this;
        if (this.attached && !this.paused) {
          if (this._xrHitTestSource) {
            var i = e.getHitTestResults(this._xrHitTestSource);
            this._processWebXRHitTestResult(i);
          }
          this._transientXrHitTestSource &&
            e
              .getHitTestResultsForTransientInput(
                this._transientXrHitTestSource
              )
              .forEach(function (e) {
                t._processWebXRHitTestResult(e.results, e.inputSource);
              });
        }
      }),
      (t.prototype._processWebXRHitTestResult = function (e, t) {
        var i = this,
          n = [];
        e.forEach(function (e) {
          var r = e.getPose(i._xrSessionManager.referenceSpace);
          if (r) {
            var o = r.transform.position,
              s = r.transform.orientation;
            i._tmpPos.set(o.x, o.y, o.z),
              i._tmpQuat.set(s.x, s.y, s.z, s.w),
              g.FromFloat32ArrayToRefScaled(
                r.transform.matrix,
                0,
                1,
                i._tmpMat
              ),
              i._xrSessionManager.scene.useRightHandedSystem ||
                ((i._tmpPos.z *= -1),
                (i._tmpQuat.z *= -1),
                (i._tmpQuat.w *= -1),
                i._tmpMat.toggleModelMatrixHandInPlace());
            var a = {
              position: i.autoCloneTransformation
                ? i._tmpPos.clone()
                : i._tmpPos,
              rotationQuaternion: i.autoCloneTransformation
                ? i._tmpQuat.clone()
                : i._tmpQuat,
              transformationMatrix: i.autoCloneTransformation
                ? i._tmpMat.clone()
                : i._tmpMat,
              inputSource: t,
              isTransient: !!t,
              xrHitResult: e,
            };
            n.push(a);
          }
        }),
          this.onHitTestResultObservable.notifyObservers(n);
      }),
      (t.Name = fa.HIT_TEST),
      (t.Version = 2),
      t
    );
  })(Pa);
  _a.AddWebXRFeature(
    Fp.Name,
    function (e, t) {
      return function () {
        return new Fp(e, t);
      };
    },
    Fp.Version,
    !1
  );
  var Bp = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      return (
        (i._enabled = !1),
        (i._featurePointCloud = []),
        (i.onFeaturePointsAddedObservable = new o()),
        (i.onFeaturePointsUpdatedObservable = new o()),
        (i.xrNativeFeatureName = "bjsfeature-points"),
        i._xrSessionManager.session
          ? i._init()
          : i._xrSessionManager.onXRSessionInit.addOnce(function () {
              i._init();
            }),
        i
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "featurePointCloud", {
        get: function () {
          return this._featurePointCloud;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.detach = function () {
        return (
          !!e.prototype.detach.call(this) &&
          ((this.featurePointCloud.length = 0), !0)
        );
      }),
      (t.prototype.dispose = function () {
        e.prototype.dispose.call(this),
          (this._featurePointCloud.length = 0),
          this.onFeaturePointsUpdatedObservable.clear(),
          this.onFeaturePointsAddedObservable.clear();
      }),
      (t.prototype._onXRFrame = function (e) {
        if (this.attached && this._enabled && e) {
          var t = e.featurePointCloud;
          if (t && 0 !== t.length) {
            if (t.length % 5 != 0)
              throw new Error(
                "Received malformed feature point cloud of length: " + t.length
              );
            for (
              var i = t.length / 5, n = new Array(), r = new Array(), o = 0;
              o < i;
              o++
            ) {
              var s = 5 * o,
                a = t[s + 4];
              this._featurePointCloud[a]
                ? n.push(a)
                : ((this._featurePointCloud[a] = {
                    position: new f(),
                    confidenceValue: 0,
                  }),
                  r.push(a)),
                (this._featurePointCloud[a].position.x = t[s]),
                (this._featurePointCloud[a].position.y = t[s + 1]),
                (this._featurePointCloud[a].position.z = t[s + 2]),
                (this._featurePointCloud[a].confidenceValue = t[s + 3]);
            }
            r.length > 0 &&
              this.onFeaturePointsAddedObservable.notifyObservers(r),
              n.length > 0 &&
                this.onFeaturePointsUpdatedObservable.notifyObservers(n);
          }
        }
      }),
      (t.prototype._init = function () {
        this._xrSessionManager.session.trySetFeaturePointCloudEnabled &&
          this._xrSessionManager.session.trySetFeaturePointCloudEnabled(!0) &&
          (this._enabled = !0);
      }),
      (t.Name = fa.FEATURE_POINTS),
      (t.Version = 1),
      t
    );
  })(Pa);
  _a.AddWebXRFeature(
    Bp.Name,
    function (e) {
      return function () {
        return new Bp(e);
      };
    },
    Bp.Version
  );
  var Vp = (function () {
      function e(e, t, i, n, r) {
        (this.xrController = e),
          (this.trackedMeshes = t),
          (this._handMesh = i),
          (this._rigMapping = n),
          (this._defaultHandMesh = !1),
          (this._transformNodeMapping = []),
          (this.handPartsDefinition = this.generateHandPartsDefinition(
            e.inputSource.hand
          )),
          (this._scene = t[0].getScene()),
          this._handMesh && this._rigMapping
            ? (this._defaultHandMesh = !1)
            : r || this._generateDefaultHandMesh(),
          this.xrController.motionController &&
            (this.xrController.motionController.rootMesh
              ? this.xrController.motionController.rootMesh.setEnabled(!1)
              : this.xrController.motionController.onModelLoadedObservable.add(
                  function (e) {
                    e.rootMesh && e.rootMesh.setEnabled(!1);
                  }
                )),
          this.xrController.onMotionControllerInitObservable.add(function (e) {
            e.onModelLoadedObservable.add(function (e) {
              e.rootMesh && e.rootMesh.setEnabled(!1);
            }),
              e.rootMesh && e.rootMesh.setEnabled(!1);
          });
      }
      return (
        (e.prototype.generateHandPartsDefinition = function (e) {
          var t;
          return (
            ((t = {}).wrist = [e.WRIST]),
            (t.thumb = [
              e.THUMB_METACARPAL,
              e.THUMB_PHALANX_PROXIMAL,
              e.THUMB_PHALANX_DISTAL,
              e.THUMB_PHALANX_TIP,
            ]),
            (t.index = [
              e.INDEX_METACARPAL,
              e.INDEX_PHALANX_PROXIMAL,
              e.INDEX_PHALANX_INTERMEDIATE,
              e.INDEX_PHALANX_DISTAL,
              e.INDEX_PHALANX_TIP,
            ]),
            (t.middle = [
              e.MIDDLE_METACARPAL,
              e.MIDDLE_PHALANX_PROXIMAL,
              e.MIDDLE_PHALANX_INTERMEDIATE,
              e.MIDDLE_PHALANX_DISTAL,
              e.MIDDLE_PHALANX_TIP,
            ]),
            (t.ring = [
              e.RING_METACARPAL,
              e.RING_PHALANX_PROXIMAL,
              e.RING_PHALANX_INTERMEDIATE,
              e.RING_PHALANX_DISTAL,
              e.RING_PHALANX_TIP,
            ]),
            (t.little = [
              e.LITTLE_METACARPAL,
              e.LITTLE_PHALANX_PROXIMAL,
              e.LITTLE_PHALANX_INTERMEDIATE,
              e.LITTLE_PHALANX_DISTAL,
              e.LITTLE_PHALANX_TIP,
            ]),
            t
          );
        }),
        (e.prototype.updateFromXRFrame = function (e, t, i) {
          var n = this;
          void 0 === i && (i = 2);
          var r = this.xrController.inputSource.hand;
          r &&
            this.trackedMeshes.forEach(function (o, s) {
              var a = r[s];
              if (a) {
                var l = e.getJointPose(a, t);
                if (!l || !l.transform) return;
                var c = l.transform.position,
                  u = l.transform.orientation;
                o.position.set(c.x, c.y, c.z),
                  o.rotationQuaternion.set(u.x, u.y, u.z, u.w);
                var h = (l.radius || 0.008) * i;
                o.scaling.set(h, h, h),
                  n._handMesh &&
                    n._rigMapping &&
                    n._rigMapping[s] &&
                    ((n._transformNodeMapping[s] =
                      n._transformNodeMapping[s] ||
                      n._scene.getTransformNodeByName(n._rigMapping[s])),
                    n._transformNodeMapping[s] &&
                      (n._transformNodeMapping[s].position.copyFrom(o.position),
                      n._transformNodeMapping[s].rotationQuaternion.copyFrom(
                        o.rotationQuaternion
                      ),
                      (o.isVisible = !1))),
                  o.getScene().useRightHandedSystem ||
                    ((o.position.z *= -1),
                    (o.rotationQuaternion.z *= -1),
                    (o.rotationQuaternion.w *= -1));
              }
            });
        }),
        (e.prototype.getHandPartMeshes = function (e) {
          var t = this;
          return this.handPartsDefinition[e].map(function (e) {
            return t.trackedMeshes[e];
          });
        }),
        (e.prototype.dispose = function () {
          this.trackedMeshes.forEach(function (e) {
            return e.dispose();
          }),
            this._defaultHandMesh && this._handMesh && this._handMesh.dispose();
        }),
        (e.prototype._generateDefaultHandMesh = function () {
          return M(this, void 0, void 0, function () {
            var e, t, i, n, r, o, s, a;
            return O(this, function (l) {
              switch (l.label) {
                case 0:
                  return (
                    l.trys.push([0, 3, , 4]),
                    (e =
                      "right" === this.xrController.inputSource.handedness
                        ? "right"
                        : "left"),
                    (t =
                      ("right" === e ? "r" : "l") +
                      "_hand_" +
                      (this._scene.useRightHandedSystem ? "r" : "l") +
                      "hs.glb"),
                    [
                      4,
                      ds.ImportMeshAsync(
                        "",
                        "https://assets.babylonjs.com/meshes/HandMeshes/",
                        t,
                        this._scene
                      ),
                    ]
                  );
                case 1:
                  return (
                    (i = l.sent()),
                    (n = {
                      base: b.FromInts(116, 63, 203),
                      fresnel: b.FromInts(149, 102, 229),
                      fingerColor: b.FromInts(177, 130, 255),
                      tipFresnel: b.FromInts(220, 200, 255),
                    }),
                    [
                      4,
                      (r = new Nc("leftHandShader", this._scene, {
                        emitComments: !1,
                      })).loadAsync(
                        "https://patrickryanms.github.io/BabylonJStextures/Demos/xrHandMesh/handsShader.json"
                      ),
                    ]
                  );
                case 2:
                  if (
                    (l.sent(),
                    r.build(!1),
                    (r.needDepthPrePass = !0),
                    (r.transparencyMode = si.MATERIAL_ALPHABLEND),
                    (r.alphaMode = It.ALPHA_COMBINE),
                    ((o = {
                      base: r.getBlockByName("baseColor"),
                      fresnel: r.getBlockByName("fresnelColor"),
                      fingerColor: r.getBlockByName("fingerColor"),
                      tipFresnel: r.getBlockByName("tipFresnelColor"),
                    }).base.value = n.base),
                    (o.fresnel.value = n.fresnel),
                    (o.fingerColor.value = n.fingerColor),
                    (o.tipFresnel.value = n.tipFresnel),
                    (i.meshes[1].material = r),
                    (this._defaultHandMesh = !0),
                    (this._handMesh = i.meshes[0]),
                    (this._rigMapping = [
                      "wrist_",
                      "thumb_metacarpal_",
                      "thumb_proxPhalanx_",
                      "thumb_distPhalanx_",
                      "thumb_tip_",
                      "index_metacarpal_",
                      "index_proxPhalanx_",
                      "index_intPhalanx_",
                      "index_distPhalanx_",
                      "index_tip_",
                      "middle_metacarpal_",
                      "middle_proxPhalanx_",
                      "middle_intPhalanx_",
                      "middle_distPhalanx_",
                      "middle_tip_",
                      "ring_metacarpal_",
                      "ring_proxPhalanx_",
                      "ring_intPhalanx_",
                      "ring_distPhalanx_",
                      "ring_tip_",
                      "little_metacarpal_",
                      "little_proxPhalanx_",
                      "little_intPhalanx_",
                      "little_distPhalanx_",
                      "little_tip_",
                    ].map(function (t) {
                      return t + ("right" === e ? "R" : "L");
                    })),
                    !(s = this._scene.getTransformNodeByName(
                      this._rigMapping[0]
                    )))
                  )
                    throw new Error("could not find the wrist node");
                  return s.parent && s.parent.rotate(Pt.Y, Math.PI), [3, 4];
                case 3:
                  return (
                    (a = l.sent()),
                    yt.Error("error loading hand mesh"),
                    console.log(a),
                    [3, 4]
                  );
                case 4:
                  return [2];
              }
            });
          });
        }),
        e
      );
    })(),
    kp = (function (e) {
      function t(i, n) {
        var r = e.call(this, i) || this;
        return (
          (r.options = n),
          (r.onHandAddedObservable = new o()),
          (r.onHandRemovedObservable = new o()),
          (r._hands = {}),
          (r._attachHand = function (e) {
            var i, n, o, s, a, l, c, u, h, d;
            if (e.inputSource.hand && !r._hands[e.uniqueId]) {
              var p = e.inputSource.hand,
                f = [],
                _ =
                  (null === (i = r.options.jointMeshes) || void 0 === i
                    ? void 0
                    : i.sourceMesh) ||
                  Po.CreateSphere("jointParent", {
                    diameter: 1,
                  });
              _.isVisible = !!(null === (n = r.options.jointMeshes) ||
              void 0 === n
                ? void 0
                : n.keepOriginalVisible);
              for (var g = 0; g < p.length; ++g) {
                var v = _.createInstance(e.uniqueId + "-handJoint-" + g);
                if (
                  null === (o = r.options.jointMeshes) || void 0 === o
                    ? void 0
                    : o.onHandJointMeshGenerated
                ) {
                  var y = r.options.jointMeshes.onHandJointMeshGenerated(
                    v,
                    g,
                    e.uniqueId
                  );
                  y && y !== v && (v.dispose(), (v = y));
                }
                if (
                  ((v.isPickable = !1),
                  null === (s = r.options.jointMeshes) || void 0 === s
                    ? void 0
                    : s.enablePhysics)
                ) {
                  var b = r.options.jointMeshes.physicsProps || {},
                    T =
                      void 0 !== b.impostorType
                        ? b.impostorType
                        : Mo.SphereImpostor;
                  v.physicsImpostor = new Mo(
                    v,
                    T,
                    A(
                      {
                        mass: 0,
                      },
                      b
                    )
                  );
                }
                (v.rotationQuaternion = new m()),
                  (null === (a = r.options.jointMeshes) || void 0 === a
                    ? void 0
                    : a.invisible) && (v.isVisible = !1),
                  f.push(v);
              }
              var S = "right" === e.inputSource.handedness ? "right" : "left",
                C =
                  (null === (l = r.options.jointMeshes) || void 0 === l
                    ? void 0
                    : l.handMeshes) &&
                  (null === (c = r.options.jointMeshes) || void 0 === c
                    ? void 0
                    : c.handMeshes[S]),
                x =
                  (null === (u = r.options.jointMeshes) || void 0 === u
                    ? void 0
                    : u.rigMapping) &&
                  (null === (h = r.options.jointMeshes) || void 0 === h
                    ? void 0
                    : h.rigMapping[S]),
                E = new Vp(
                  e,
                  f,
                  C,
                  x,
                  null === (d = r.options.jointMeshes) || void 0 === d
                    ? void 0
                    : d.disableDefaultHandMesh
                );
              (r._hands[e.uniqueId] = {
                handObject: E,
                id: t._idCounter++,
              }),
                r.onHandAddedObservable.notifyObservers(E);
            }
          }),
          (r.xrNativeFeatureName = "hand-tracking"),
          r
        );
      }
      return (
        P(t, e),
        (t.prototype.isCompatible = function () {
          return "undefined" != typeof XRHand;
        }),
        (t.prototype.attach = function () {
          var t = this;
          return (
            !!e.prototype.attach.call(this) &&
            (this.options.xrInput.controllers.forEach(this._attachHand),
            this._addNewAttachObserver(
              this.options.xrInput.onControllerAddedObservable,
              this._attachHand
            ),
            this._addNewAttachObserver(
              this.options.xrInput.onControllerRemovedObservable,
              function (e) {
                t._detachHand(e.uniqueId);
              }
            ),
            !0)
          );
        }),
        (t.prototype.detach = function () {
          var t = this;
          return (
            !!e.prototype.detach.call(this) &&
            (Object.keys(this._hands).forEach(function (e) {
              t._detachHand(e);
            }),
            !0)
          );
        }),
        (t.prototype.dispose = function () {
          e.prototype.dispose.call(this), this.onHandAddedObservable.clear();
        }),
        (t.prototype.getHandByControllerId = function (e) {
          var t;
          return (
            (null === (t = this._hands[e]) || void 0 === t
              ? void 0
              : t.handObject) || null
          );
        }),
        (t.prototype.getHandByHandedness = function (e) {
          var t = this,
            i = Object.keys(this._hands)
              .map(function (e) {
                return t._hands[e].handObject.xrController.inputSource
                  .handedness;
              })
              .indexOf(e);
          return -1 !== i ? this._hands[i].handObject : null;
        }),
        (t.prototype._onXRFrame = function (e) {
          var t = this;
          Object.keys(this._hands).forEach(function (i) {
            var n;
            t._hands[i].handObject.updateFromXRFrame(
              e,
              t._xrSessionManager.referenceSpace,
              null === (n = t.options.jointMeshes) || void 0 === n
                ? void 0
                : n.scaleFactor
            );
          });
        }),
        (t.prototype._detachHand = function (e) {
          this._hands[e] &&
            (this.onHandRemovedObservable.notifyObservers(
              this._hands[e].handObject
            ),
            this._hands[e].handObject.dispose());
        }),
        (t._idCounter = 0),
        (t.Name = fa.HAND_TRACKING),
        (t.Version = 1),
        t
      );
    })(Pa);
  _a.AddWebXRFeature(
    kp.Name,
    function (e, t) {
      return function () {
        return new kp(e, t);
      };
    },
    kp.Version,
    !1
  );
  var Up = (function (e) {
    function t(t, i, n) {
      var r = e.call(this, t, zp["left-right"], i, n) || this;
      return (
        (r._mapping = {
          defaultButton: {
            valueNodeName: "VALUE",
            unpressedNodeName: "UNPRESSED",
            pressedNodeName: "PRESSED",
          },
          defaultAxis: {
            valueNodeName: "VALUE",
            minNodeName: "MIN",
            maxNodeName: "MAX",
          },
          buttons: {
            "xr-standard-trigger": {
              rootNodeName: "SELECT",
              componentProperty: "button",
              states: ["default", "touched", "pressed"],
            },
            "xr-standard-squeeze": {
              rootNodeName: "GRASP",
              componentProperty: "state",
              states: ["pressed"],
            },
            "xr-standard-touchpad": {
              rootNodeName: "TOUCHPAD_PRESS",
              labelAnchorNodeName: "squeeze-label",
              touchPointNodeName: "TOUCH",
            },
            "xr-standard-thumbstick": {
              rootNodeName: "THUMBSTICK_PRESS",
              componentProperty: "state",
              states: ["pressed"],
            },
          },
          axes: {
            "xr-standard-touchpad": {
              "x-axis": {
                rootNodeName: "TOUCHPAD_TOUCH_X",
              },
              "y-axis": {
                rootNodeName: "TOUCHPAD_TOUCH_Y",
              },
            },
            "xr-standard-thumbstick": {
              "x-axis": {
                rootNodeName: "THUMBSTICK_X",
              },
              "y-axis": {
                rootNodeName: "THUMBSTICK_Y",
              },
            },
          },
        }),
        (r.profileId = "microsoft-mixed-reality"),
        r
      );
    }
    return (
      P(t, e),
      (t.prototype._getFilenameAndPath = function () {
        return {
          filename:
            "left" === this.handedness
              ? t.MODEL_LEFT_FILENAME
              : t.MODEL_RIGHT_FILENAME,
          path: t.MODEL_BASE_URL + "default/",
        };
      }),
      (t.prototype._getModelLoadingConstraints = function () {
        var e = ds.IsPluginForExtensionAvailable(".glb");
        return (
          e ||
            F.Warn(
              "glTF / glb loaded was not registered, using generic controller instead"
            ),
          e
        );
      }),
      (t.prototype._processLoadedModel = function (e) {
        var t = this;
        this.rootMesh &&
          (this.getComponentIds().forEach(function (e, i) {
            if (!t.disableAnimation && e && t.rootMesh) {
              var n = t._mapping.buttons[e],
                r = n.rootNodeName;
              if (!r)
                return void F.Log(
                  "Skipping unknown button at index: " +
                    i +
                    " with mapped name: " +
                    e
                );
              var o = t._getChildByName(t.rootMesh, r);
              if (!o) return void F.Warn("Missing button mesh with name: " + r);
              if (
                ((n.valueMesh = t._getImmediateChildByName(
                  o,
                  t._mapping.defaultButton.valueNodeName
                )),
                (n.pressedMesh = t._getImmediateChildByName(
                  o,
                  t._mapping.defaultButton.pressedNodeName
                )),
                (n.unpressedMesh = t._getImmediateChildByName(
                  o,
                  t._mapping.defaultButton.unpressedNodeName
                )),
                n.valueMesh && n.pressedMesh && n.unpressedMesh)
              ) {
                var s = t.getComponent(e);
                s &&
                  s.onButtonStateChangedObservable.add(
                    function (e) {
                      t._lerpTransform(n, e.value);
                    },
                    void 0,
                    !0
                  );
              } else
                F.Warn("Missing button submesh under mesh with name: " + r);
            }
          }),
          this.getComponentIds().forEach(function (e, i) {
            var n = t.getComponent(e);
            n.isAxes() &&
              ["x-axis", "y-axis"].forEach(function (i) {
                if (t.rootMesh) {
                  var r = t._mapping.axes[e][i],
                    o = t._getChildByName(t.rootMesh, r.rootNodeName);
                  o
                    ? ((r.valueMesh = t._getImmediateChildByName(
                        o,
                        t._mapping.defaultAxis.valueNodeName
                      )),
                      (r.minMesh = t._getImmediateChildByName(
                        o,
                        t._mapping.defaultAxis.minNodeName
                      )),
                      (r.maxMesh = t._getImmediateChildByName(
                        o,
                        t._mapping.defaultAxis.maxNodeName
                      )),
                      r.valueMesh && r.minMesh && r.maxMesh
                        ? n &&
                          n.onAxisValueChangedObservable.add(
                            function (e) {
                              var n = "x-axis" === i ? e.x : e.y;
                              t._lerpTransform(r, n, !0);
                            },
                            void 0,
                            !0
                          )
                        : F.Warn(
                            "Missing axis submesh under mesh with name: " +
                              r.rootNodeName
                          ))
                    : F.Warn("Missing axis mesh with name: " + r.rootNodeName);
                }
              });
          }));
      }),
      (t.prototype._setRootMesh = function (e) {
        var t;
        (this.rootMesh = new Qi(
          this.profileId + " " + this.handedness,
          this.scene
        )),
          (this.rootMesh.isPickable = !1);
        for (var i = 0; i < e.length; i++) {
          var n = e[i];
          (n.isPickable = !1), n.parent || (t = n);
        }
        t && t.setParent(this.rootMesh),
          this.scene.useRightHandedSystem ||
            (this.rootMesh.rotationQuaternion = m.FromEulerAngles(
              0,
              Math.PI,
              0
            ));
      }),
      (t.prototype._updateModel = function () {}),
      (t.MODEL_BASE_URL = "https://controllers.babylonjs.com/microsoft/"),
      (t.MODEL_LEFT_FILENAME = "left.glb"),
      (t.MODEL_RIGHT_FILENAME = "right.glb"),
      t
    );
  })(va);
  Sa.RegisterController("windows-mixed-reality", function (e, t) {
    return new Up(t, e.gamepad, e.handedness);
  });
  var zp = {
      left: {
        selectComponentId: "xr-standard-trigger",
        components: {
          "xr-standard-trigger": {
            type: "trigger",
            gamepadIndices: {
              button: 0,
            },
            rootNodeName: "xr_standard_trigger",
            visualResponses: {
              xr_standard_trigger_pressed: {
                componentProperty: "button",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_trigger_pressed_value",
                minNodeName: "xr_standard_trigger_pressed_min",
                maxNodeName: "xr_standard_trigger_pressed_max",
              },
            },
          },
          "xr-standard-squeeze": {
            type: "squeeze",
            gamepadIndices: {
              button: 1,
            },
            rootNodeName: "xr_standard_squeeze",
            visualResponses: {
              xr_standard_squeeze_pressed: {
                componentProperty: "button",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_squeeze_pressed_value",
                minNodeName: "xr_standard_squeeze_pressed_min",
                maxNodeName: "xr_standard_squeeze_pressed_max",
              },
            },
          },
          "xr-standard-touchpad": {
            type: "touchpad",
            gamepadIndices: {
              button: 2,
              xAxis: 0,
              yAxis: 1,
            },
            rootNodeName: "xr_standard_touchpad",
            visualResponses: {
              xr_standard_touchpad_pressed: {
                componentProperty: "button",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_touchpad_pressed_value",
                minNodeName: "xr_standard_touchpad_pressed_min",
                maxNodeName: "xr_standard_touchpad_pressed_max",
              },
              xr_standard_touchpad_xaxis_pressed: {
                componentProperty: "xAxis",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_touchpad_xaxis_pressed_value",
                minNodeName: "xr_standard_touchpad_xaxis_pressed_min",
                maxNodeName: "xr_standard_touchpad_xaxis_pressed_max",
              },
              xr_standard_touchpad_yaxis_pressed: {
                componentProperty: "yAxis",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_touchpad_yaxis_pressed_value",
                minNodeName: "xr_standard_touchpad_yaxis_pressed_min",
                maxNodeName: "xr_standard_touchpad_yaxis_pressed_max",
              },
              xr_standard_touchpad_xaxis_touched: {
                componentProperty: "xAxis",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_touchpad_xaxis_touched_value",
                minNodeName: "xr_standard_touchpad_xaxis_touched_min",
                maxNodeName: "xr_standard_touchpad_xaxis_touched_max",
              },
              xr_standard_touchpad_yaxis_touched: {
                componentProperty: "yAxis",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_touchpad_yaxis_touched_value",
                minNodeName: "xr_standard_touchpad_yaxis_touched_min",
                maxNodeName: "xr_standard_touchpad_yaxis_touched_max",
              },
              xr_standard_touchpad_axes_touched: {
                componentProperty: "state",
                states: ["touched", "pressed"],
                valueNodeProperty: "visibility",
                valueNodeName: "xr_standard_touchpad_axes_touched_value",
              },
            },
            touchPointNodeName: "xr_standard_touchpad_axes_touched_value",
          },
          "xr-standard-thumbstick": {
            type: "thumbstick",
            gamepadIndices: {
              button: 3,
              xAxis: 2,
              yAxis: 3,
            },
            rootNodeName: "xr_standard_thumbstick",
            visualResponses: {
              xr_standard_thumbstick_pressed: {
                componentProperty: "button",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_thumbstick_pressed_value",
                minNodeName: "xr_standard_thumbstick_pressed_min",
                maxNodeName: "xr_standard_thumbstick_pressed_max",
              },
              xr_standard_thumbstick_xaxis_pressed: {
                componentProperty: "xAxis",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_thumbstick_xaxis_pressed_value",
                minNodeName: "xr_standard_thumbstick_xaxis_pressed_min",
                maxNodeName: "xr_standard_thumbstick_xaxis_pressed_max",
              },
              xr_standard_thumbstick_yaxis_pressed: {
                componentProperty: "yAxis",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_thumbstick_yaxis_pressed_value",
                minNodeName: "xr_standard_thumbstick_yaxis_pressed_min",
                maxNodeName: "xr_standard_thumbstick_yaxis_pressed_max",
              },
            },
          },
        },
        gamepadMapping: "xr-standard",
        rootNodeName: "microsoft-mixed-reality-left",
        assetPath: "left.glb",
      },
      right: {
        selectComponentId: "xr-standard-trigger",
        components: {
          "xr-standard-trigger": {
            type: "trigger",
            gamepadIndices: {
              button: 0,
            },
            rootNodeName: "xr_standard_trigger",
            visualResponses: {
              xr_standard_trigger_pressed: {
                componentProperty: "button",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_trigger_pressed_value",
                minNodeName: "xr_standard_trigger_pressed_min",
                maxNodeName: "xr_standard_trigger_pressed_max",
              },
            },
          },
          "xr-standard-squeeze": {
            type: "squeeze",
            gamepadIndices: {
              button: 1,
            },
            rootNodeName: "xr_standard_squeeze",
            visualResponses: {
              xr_standard_squeeze_pressed: {
                componentProperty: "button",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_squeeze_pressed_value",
                minNodeName: "xr_standard_squeeze_pressed_min",
                maxNodeName: "xr_standard_squeeze_pressed_max",
              },
            },
          },
          "xr-standard-touchpad": {
            type: "touchpad",
            gamepadIndices: {
              button: 2,
              xAxis: 0,
              yAxis: 1,
            },
            rootNodeName: "xr_standard_touchpad",
            visualResponses: {
              xr_standard_touchpad_pressed: {
                componentProperty: "button",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_touchpad_pressed_value",
                minNodeName: "xr_standard_touchpad_pressed_min",
                maxNodeName: "xr_standard_touchpad_pressed_max",
              },
              xr_standard_touchpad_xaxis_pressed: {
                componentProperty: "xAxis",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_touchpad_xaxis_pressed_value",
                minNodeName: "xr_standard_touchpad_xaxis_pressed_min",
                maxNodeName: "xr_standard_touchpad_xaxis_pressed_max",
              },
              xr_standard_touchpad_yaxis_pressed: {
                componentProperty: "yAxis",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_touchpad_yaxis_pressed_value",
                minNodeName: "xr_standard_touchpad_yaxis_pressed_min",
                maxNodeName: "xr_standard_touchpad_yaxis_pressed_max",
              },
              xr_standard_touchpad_xaxis_touched: {
                componentProperty: "xAxis",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_touchpad_xaxis_touched_value",
                minNodeName: "xr_standard_touchpad_xaxis_touched_min",
                maxNodeName: "xr_standard_touchpad_xaxis_touched_max",
              },
              xr_standard_touchpad_yaxis_touched: {
                componentProperty: "yAxis",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_touchpad_yaxis_touched_value",
                minNodeName: "xr_standard_touchpad_yaxis_touched_min",
                maxNodeName: "xr_standard_touchpad_yaxis_touched_max",
              },
              xr_standard_touchpad_axes_touched: {
                componentProperty: "state",
                states: ["touched", "pressed"],
                valueNodeProperty: "visibility",
                valueNodeName: "xr_standard_touchpad_axes_touched_value",
              },
            },
            touchPointNodeName: "xr_standard_touchpad_axes_touched_value",
          },
          "xr-standard-thumbstick": {
            type: "thumbstick",
            gamepadIndices: {
              button: 3,
              xAxis: 2,
              yAxis: 3,
            },
            rootNodeName: "xr_standard_thumbstick",
            visualResponses: {
              xr_standard_thumbstick_pressed: {
                componentProperty: "button",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_thumbstick_pressed_value",
                minNodeName: "xr_standard_thumbstick_pressed_min",
                maxNodeName: "xr_standard_thumbstick_pressed_max",
              },
              xr_standard_thumbstick_xaxis_pressed: {
                componentProperty: "xAxis",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_thumbstick_xaxis_pressed_value",
                minNodeName: "xr_standard_thumbstick_xaxis_pressed_min",
                maxNodeName: "xr_standard_thumbstick_xaxis_pressed_max",
              },
              xr_standard_thumbstick_yaxis_pressed: {
                componentProperty: "yAxis",
                states: ["default", "touched", "pressed"],
                valueNodeProperty: "transform",
                valueNodeName: "xr_standard_thumbstick_yaxis_pressed_value",
                minNodeName: "xr_standard_thumbstick_yaxis_pressed_min",
                maxNodeName: "xr_standard_thumbstick_yaxis_pressed_max",
              },
            },
          },
        },
        gamepadMapping: "xr-standard",
        rootNodeName: "microsoft-mixed-reality-right",
        assetPath: "right.glb",
      },
    },
    Gp = (function (e) {
      function t(t, i, n, r, o) {
        void 0 === r && (r = !1), void 0 === o && (o = !1);
        var s = e.call(this, t, Wp[n], i, n) || this;
        return (
          (s._forceLegacyControllers = o), (s.profileId = "oculus-touch"), s
        );
      }
      return (
        P(t, e),
        (t.prototype._getFilenameAndPath = function () {
          return {
            filename:
              "left" === this.handedness
                ? t.MODEL_LEFT_FILENAME
                : t.MODEL_RIGHT_FILENAME,
            path: this._isQuest() ? t.QUEST_MODEL_BASE_URL : t.MODEL_BASE_URL,
          };
        }),
        (t.prototype._getModelLoadingConstraints = function () {
          return !0;
        }),
        (t.prototype._processLoadedModel = function (e) {
          var t = this,
            i = this._isQuest(),
            n = "right" === this.handedness ? -1 : 1;
          this.getComponentIds().forEach(function (e) {
            var r = e && t.getComponent(e);
            r &&
              r.onButtonStateChangedObservable.add(
                function (r) {
                  if (t.rootMesh && !t.disableAnimation)
                    switch (e) {
                      case "xr-standard-trigger":
                        return void (
                          i ||
                          ((t._modelRootNode.getChildren()[3].rotation.x =
                            0.2 * -r.value),
                          (t._modelRootNode.getChildren()[3].position.y =
                            0.005 * -r.value),
                          (t._modelRootNode.getChildren()[3].position.z =
                            0.005 * -r.value))
                        );
                      case "xr-standard-squeeze":
                        return void (
                          i ||
                          (t._modelRootNode.getChildren()[4].position.x =
                            n * r.value * 0.0035)
                        );
                      case "xr-standard-thumbstick":
                        return;
                      case "a-button":
                      case "x-button":
                        return void (
                          i ||
                          (r.pressed
                            ? (t._modelRootNode.getChildren()[1].position.y =
                                -0.001)
                            : (t._modelRootNode.getChildren()[1].position.y = 0))
                        );
                      case "b-button":
                      case "y-button":
                        return void (
                          i ||
                          (r.pressed
                            ? (t._modelRootNode.getChildren()[2].position.y =
                                -0.001)
                            : (t._modelRootNode.getChildren()[2].position.y = 0))
                        );
                    }
                },
                void 0,
                !0
              );
          });
        }),
        (t.prototype._setRootMesh = function (e) {
          (this.rootMesh = new Qi(
            this.profileId + " " + this.handedness,
            this.scene
          )),
            this.scene.useRightHandedSystem ||
              (this.rootMesh.rotationQuaternion = m.FromEulerAngles(
                0,
                Math.PI,
                0
              )),
            e.forEach(function (e) {
              e.isPickable = !1;
            }),
            this._isQuest()
              ? (this._modelRootNode = e[0])
              : ((this._modelRootNode = e[1]),
                (this.rootMesh.position.y = 0.034),
                (this.rootMesh.position.z = 0.052)),
            (this._modelRootNode.parent = this.rootMesh);
        }),
        (t.prototype._updateModel = function () {}),
        (t.prototype._isQuest = function () {
          return (
            !!navigator.userAgent.match(/Quest/gi) &&
            !this._forceLegacyControllers
          );
        }),
        (t.MODEL_BASE_URL = "https://controllers.babylonjs.com/oculus/"),
        (t.MODEL_LEFT_FILENAME = "left.babylon"),
        (t.MODEL_RIGHT_FILENAME = "right.babylon"),
        (t.QUEST_MODEL_BASE_URL =
          "https://controllers.babylonjs.com/oculusQuest/"),
        t
      );
    })(va);
  Sa.RegisterController("oculus-touch", function (e, t) {
    return new Gp(t, e.gamepad, e.handedness);
  }),
    Sa.RegisterController("oculus-touch-legacy", function (e, t) {
      return new Gp(t, e.gamepad, e.handedness, !0);
    });
  var Wp = {
      left: {
        selectComponentId: "xr-standard-trigger",
        components: {
          "xr-standard-trigger": {
            type: "trigger",
            gamepadIndices: {
              button: 0,
            },
            rootNodeName: "xr_standard_trigger",
            visualResponses: {},
          },
          "xr-standard-squeeze": {
            type: "squeeze",
            gamepadIndices: {
              button: 1,
            },
            rootNodeName: "xr_standard_squeeze",
            visualResponses: {},
          },
          "xr-standard-thumbstick": {
            type: "thumbstick",
            gamepadIndices: {
              button: 3,
              xAxis: 2,
              yAxis: 3,
            },
            rootNodeName: "xr_standard_thumbstick",
            visualResponses: {},
          },
          "x-button": {
            type: "button",
            gamepadIndices: {
              button: 4,
            },
            rootNodeName: "x_button",
            visualResponses: {},
          },
          "y-button": {
            type: "button",
            gamepadIndices: {
              button: 5,
            },
            rootNodeName: "y_button",
            visualResponses: {},
          },
          thumbrest: {
            type: "button",
            gamepadIndices: {
              button: 6,
            },
            rootNodeName: "thumbrest",
            visualResponses: {},
          },
        },
        gamepadMapping: "xr-standard",
        rootNodeName: "oculus-touch-v2-left",
        assetPath: "left.glb",
      },
      right: {
        selectComponentId: "xr-standard-trigger",
        components: {
          "xr-standard-trigger": {
            type: "trigger",
            gamepadIndices: {
              button: 0,
            },
            rootNodeName: "xr_standard_trigger",
            visualResponses: {},
          },
          "xr-standard-squeeze": {
            type: "squeeze",
            gamepadIndices: {
              button: 1,
            },
            rootNodeName: "xr_standard_squeeze",
            visualResponses: {},
          },
          "xr-standard-thumbstick": {
            type: "thumbstick",
            gamepadIndices: {
              button: 3,
              xAxis: 2,
              yAxis: 3,
            },
            rootNodeName: "xr_standard_thumbstick",
            visualResponses: {},
          },
          "a-button": {
            type: "button",
            gamepadIndices: {
              button: 4,
            },
            rootNodeName: "a_button",
            visualResponses: {},
          },
          "b-button": {
            type: "button",
            gamepadIndices: {
              button: 5,
            },
            rootNodeName: "b_button",
            visualResponses: {},
          },
          thumbrest: {
            type: "button",
            gamepadIndices: {
              button: 6,
            },
            rootNodeName: "thumbrest",
            visualResponses: {},
          },
        },
        gamepadMapping: "xr-standard",
        rootNodeName: "oculus-touch-v2-right",
        assetPath: "right.glb",
      },
    },
    Hp = (function (e) {
      function t(t, i, n) {
        var r = e.call(this, t, Xp[n], i, n) || this;
        return (r.profileId = "htc-vive"), r;
      }
      return (
        P(t, e),
        (t.prototype._getFilenameAndPath = function () {
          return {
            filename: t.MODEL_FILENAME,
            path: t.MODEL_BASE_URL,
          };
        }),
        (t.prototype._getModelLoadingConstraints = function () {
          return !0;
        }),
        (t.prototype._processLoadedModel = function (e) {
          var t = this;
          this.getComponentIds().forEach(function (e) {
            var i = e && t.getComponent(e);
            i &&
              i.onButtonStateChangedObservable.add(
                function (i) {
                  if (t.rootMesh && !t.disableAnimation)
                    switch (e) {
                      case "xr-standard-trigger":
                        return void (t._modelRootNode.getChildren()[6].rotation.x =
                          0.15 * -i.value);
                      case "xr-standard-touchpad":
                      case "xr-standard-squeeze":
                        return;
                    }
                },
                void 0,
                !0
              );
          });
        }),
        (t.prototype._setRootMesh = function (e) {
          (this.rootMesh = new Qi(
            this.profileId + " " + this.handedness,
            this.scene
          )),
            e.forEach(function (e) {
              e.isPickable = !1;
            }),
            (this._modelRootNode = e[1]),
            (this._modelRootNode.parent = this.rootMesh),
            this.scene.useRightHandedSystem ||
              (this.rootMesh.rotationQuaternion = m.FromEulerAngles(
                0,
                Math.PI,
                0
              ));
        }),
        (t.prototype._updateModel = function () {}),
        (t.MODEL_BASE_URL = "https://controllers.babylonjs.com/vive/"),
        (t.MODEL_FILENAME = "wand.babylon"),
        t
      );
    })(va);
  Sa.RegisterController("htc-vive", function (e, t) {
    return new Hp(t, e.gamepad, e.handedness);
  });
  var jp,
    Xp = {
      left: {
        selectComponentId: "xr-standard-trigger",
        components: {
          "xr-standard-trigger": {
            type: "trigger",
            gamepadIndices: {
              button: 0,
            },
            rootNodeName: "xr_standard_trigger",
            visualResponses: {},
          },
          "xr-standard-squeeze": {
            type: "squeeze",
            gamepadIndices: {
              button: 1,
            },
            rootNodeName: "xr_standard_squeeze",
            visualResponses: {},
          },
          "xr-standard-touchpad": {
            type: "touchpad",
            gamepadIndices: {
              button: 2,
              xAxis: 0,
              yAxis: 1,
            },
            rootNodeName: "xr_standard_touchpad",
            visualResponses: {},
          },
          menu: {
            type: "button",
            gamepadIndices: {
              button: 4,
            },
            rootNodeName: "menu",
            visualResponses: {},
          },
        },
        gamepadMapping: "xr-standard",
        rootNodeName: "htc_vive_none",
        assetPath: "none.glb",
      },
      right: {
        selectComponentId: "xr-standard-trigger",
        components: {
          "xr-standard-trigger": {
            type: "trigger",
            gamepadIndices: {
              button: 0,
            },
            rootNodeName: "xr_standard_trigger",
            visualResponses: {},
          },
          "xr-standard-squeeze": {
            type: "squeeze",
            gamepadIndices: {
              button: 1,
            },
            rootNodeName: "xr_standard_squeeze",
            visualResponses: {},
          },
          "xr-standard-touchpad": {
            type: "touchpad",
            gamepadIndices: {
              button: 2,
              xAxis: 0,
              yAxis: 1,
            },
            rootNodeName: "xr_standard_touchpad",
            visualResponses: {},
          },
          menu: {
            type: "button",
            gamepadIndices: {
              button: 4,
            },
            rootNodeName: "menu",
            visualResponses: {},
          },
        },
        gamepadMapping: "xr-standard",
        rootNodeName: "htc_vive_none",
        assetPath: "none.glb",
      },
      none: {
        selectComponentId: "xr-standard-trigger",
        components: {
          "xr-standard-trigger": {
            type: "trigger",
            gamepadIndices: {
              button: 0,
            },
            rootNodeName: "xr_standard_trigger",
            visualResponses: {},
          },
          "xr-standard-squeeze": {
            type: "squeeze",
            gamepadIndices: {
              button: 1,
            },
            rootNodeName: "xr_standard_squeeze",
            visualResponses: {},
          },
          "xr-standard-touchpad": {
            type: "touchpad",
            gamepadIndices: {
              button: 2,
              xAxis: 0,
              yAxis: 1,
            },
            rootNodeName: "xr_standard_touchpad",
            visualResponses: {},
          },
          menu: {
            type: "button",
            gamepadIndices: {
              button: 4,
            },
            rootNodeName: "menu",
            visualResponses: {},
          },
        },
        gamepadMapping: "xr-standard",
        rootNodeName: "htc-vive-none",
        assetPath: "none.glb",
      },
    };
  !(function (e) {
    var t;
    !(function (e) {
      (e[(e.pbrmat = 0)] = "pbrmat"),
        (e[(e.stdmat = 1)] = "stdmat"),
        (e[(e.texture = 2)] = "texture"),
        (e[(e.image = 3)] = "image"),
        (e[(e.json = 4)] = "json"),
        (e[(e.dds = 5)] = "dds"),
        (e[(e.obj3d = 6)] = "obj3d"),
        (e[(e.sound = 7)] = "sound"),
        (e[(e.uiButton = 8)] = "uiButton"),
        (e[(e.nodeMaterial = 9)] = "nodeMaterial"),
        (e[(e.uiSlider = 10)] = "uiSlider"),
        (e[(e.uiCheck = 11)] = "uiCheck"),
        (e[(e.blob = 12)] = "blob");
    })(e.ResTypes || (e.ResTypes = {})),
      ((t = e.ResState || (e.ResState = {}))[(t.undef = 0)] = "undef"),
      (t[(t.init = 1)] = "init"),
      (t[(t.lazy = 2)] = "lazy"),
      (t[(t.ready = 3)] = "ready"),
      (t[(t.neterror = 4)] = "neterror"),
      (t[(t.buildError = 5)] = "buildError"),
      (e.PrefMap = [
        "fetch",
        "fetch",
        "image",
        "image",
        "fetch",
        "fetch",
        "fetch",
        "audio",
      ]);
  })(jp || (jp = {})),
    jp.PrefMap;
  var Yp,
    Kp,
    Qp = jp.ResTypes;
  jp.ResState,
    (function (e) {
      (e[(e.SOURCE = 0)] = "SOURCE"), (e[(e.CLONE = 1)] = "CLONE");
    })(Yp || (Yp = {})),
    (function (e) {
      e.DIAMOND_DEMO = [
        {
          uID: "diamond_demo_loading_scene",
          type: Qp.obj3d,
          url: "/accel/static/assets/meshes/diamondDemo/diamond.glb",
        },
      ];
    })(Kp || (Kp = {}));
  var qp = Kp.DIAMOND_DEMO,
    Zp = (function () {
      function e(t, i, n) {
        void 0 === i && (i = e.UNITMODE_PIXEL),
          void 0 === n && (n = !0),
          (this.unit = i),
          (this.negativeValueAllowed = n),
          (this._value = 1),
          (this.ignoreAdaptiveScaling = !1),
          (this._value = t),
          (this._originalUnit = i);
      }
      return (
        Object.defineProperty(e.prototype, "isPercentage", {
          get: function () {
            return this.unit === e.UNITMODE_PERCENTAGE;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isPixel", {
          get: function () {
            return this.unit === e.UNITMODE_PIXEL;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "internalValue", {
          get: function () {
            return this._value;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.getValueInPixel = function (e, t) {
          return this.isPixel ? this.getValue(e) : this.getValue(e) * t;
        }),
        (e.prototype.updateInPlace = function (t, i) {
          return (
            void 0 === i && (i = e.UNITMODE_PIXEL),
            (this._value = t),
            (this.unit = i),
            this
          );
        }),
        (e.prototype.getValue = function (t) {
          if (
            t &&
            !this.ignoreAdaptiveScaling &&
            this.unit !== e.UNITMODE_PERCENTAGE
          ) {
            var i = 0,
              n = 0;
            if (
              (t.idealWidth &&
                (i = (this._value * t.getSize().width) / t.idealWidth),
              t.idealHeight &&
                (n = (this._value * t.getSize().height) / t.idealHeight),
              t.useSmallestIdeal && t.idealWidth && t.idealHeight)
            )
              return window.innerWidth < window.innerHeight ? i : n;
            if (t.idealWidth) return i;
            if (t.idealHeight) return n;
          }
          return this._value;
        }),
        (e.prototype.toString = function (t, i) {
          switch (this.unit) {
            case e.UNITMODE_PERCENTAGE:
              var n = 100 * this.getValue(t);
              return (i ? n.toFixed(i) : n) + "%";
            case e.UNITMODE_PIXEL:
              var r = this.getValue(t);
              return (i ? r.toFixed(i) : r) + "px";
          }
          return this.unit.toString();
        }),
        (e.prototype.fromString = function (t) {
          var i = e._Regex.exec(t.toString());
          if (!i || 0 === i.length) return !1;
          var n = parseFloat(i[1]),
            r = this._originalUnit;
          if ((this.negativeValueAllowed || (n < 0 && (n = 0)), 4 === i.length))
            switch (i[3]) {
              case "px":
                r = e.UNITMODE_PIXEL;
                break;
              case "%":
                (r = e.UNITMODE_PERCENTAGE), (n /= 100);
            }
          return (
            (n !== this._value || r !== this.unit) &&
            ((this._value = n), (this.unit = r), !0)
          );
        }),
        Object.defineProperty(e, "UNITMODE_PERCENTAGE", {
          get: function () {
            return e._UNITMODE_PERCENTAGE;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e, "UNITMODE_PIXEL", {
          get: function () {
            return e._UNITMODE_PIXEL;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e._Regex = /(^-?\d*(\.\d+)?)(%|px)?/),
        (e._UNITMODE_PERCENTAGE = 0),
        (e._UNITMODE_PIXEL = 1),
        e
      );
    })(),
    Jp = [new p(0, 0), new p(0, 0), new p(0, 0), new p(0, 0)],
    $p = [new p(0, 0), new p(0, 0), new p(0, 0), new p(0, 0)],
    ef = new p(0, 0),
    tf = new p(0, 0),
    nf = (function () {
      function e(e, t, i, n) {
        (this.left = e), (this.top = t), (this.width = i), (this.height = n);
      }
      return (
        (e.prototype.copyFrom = function (e) {
          (this.left = e.left),
            (this.top = e.top),
            (this.width = e.width),
            (this.height = e.height);
        }),
        (e.prototype.copyFromFloats = function (e, t, i, n) {
          (this.left = e), (this.top = t), (this.width = i), (this.height = n);
        }),
        (e.CombineToRef = function (e, t, i) {
          var n = Math.min(e.left, t.left),
            r = Math.min(e.top, t.top),
            o = Math.max(e.left + e.width, t.left + t.width),
            s = Math.max(e.top + e.height, t.top + t.height);
          (i.left = n), (i.top = r), (i.width = o - n), (i.height = s - r);
        }),
        (e.prototype.addAndTransformToRef = function (e, t, i, n, r, o) {
          var s = this.left + t,
            a = this.top + i,
            l = this.width + n,
            c = this.height + r;
          Jp[0].copyFromFloats(s, a),
            Jp[1].copyFromFloats(s + l, a),
            Jp[2].copyFromFloats(s + l, a + c),
            Jp[3].copyFromFloats(s, a + c),
            ef.copyFromFloats(Number.MAX_VALUE, Number.MAX_VALUE),
            tf.copyFromFloats(0, 0);
          for (var u = 0; u < 4; u++)
            e.transformCoordinates(Jp[u].x, Jp[u].y, $p[u]),
              (ef.x = Math.floor(Math.min(ef.x, $p[u].x))),
              (ef.y = Math.floor(Math.min(ef.y, $p[u].y))),
              (tf.x = Math.ceil(Math.max(tf.x, $p[u].x))),
              (tf.y = Math.ceil(Math.max(tf.y, $p[u].y)));
          (o.left = ef.x),
            (o.top = ef.y),
            (o.width = tf.x - ef.x),
            (o.height = tf.y - ef.y);
        }),
        (e.prototype.transformToRef = function (e, t) {
          this.addAndTransformToRef(e, 0, 0, 0, 0, t);
        }),
        (e.prototype.isEqualsTo = function (e) {
          return (
            this.left === e.left &&
            this.top === e.top &&
            this.width === e.width &&
            this.height === e.height
          );
        }),
        (e.Empty = function () {
          return new e(0, 0, 0, 0);
        }),
        e
      );
    })(),
    rf = (function (e) {
      function t(t, i) {
        void 0 === i && (i = 0);
        var n = e.call(this, t.x, t.y) || this;
        return (n.buttonIndex = i), n;
      }
      return P(t, e), t;
    })(p),
    of = (function () {
      function e(e, t, i, n, r, o) {
        (this.m = new Float32Array(6)), this.fromValues(e, t, i, n, r, o);
      }
      return (
        (e.prototype.fromValues = function (e, t, i, n, r, o) {
          return (
            (this.m[0] = e),
            (this.m[1] = t),
            (this.m[2] = i),
            (this.m[3] = n),
            (this.m[4] = r),
            (this.m[5] = o),
            this
          );
        }),
        (e.prototype.determinant = function () {
          return this.m[0] * this.m[3] - this.m[1] * this.m[2];
        }),
        (e.prototype.invertToRef = function (e) {
          var t = this.m[0],
            i = this.m[1],
            n = this.m[2],
            r = this.m[3],
            o = this.m[4],
            s = this.m[5],
            a = this.determinant();
          if (a < 1e-6)
            return (
              (e.m[0] = 0),
              (e.m[1] = 0),
              (e.m[2] = 0),
              (e.m[3] = 0),
              (e.m[4] = 0),
              (e.m[5] = 0),
              this
            );
          var l = 1 / a,
            c = n * s - r * o,
            u = i * o - t * s;
          return (
            (e.m[0] = r * l),
            (e.m[1] = -i * l),
            (e.m[2] = -n * l),
            (e.m[3] = t * l),
            (e.m[4] = c * l),
            (e.m[5] = u * l),
            this
          );
        }),
        (e.prototype.multiplyToRef = function (e, t) {
          var i = this.m[0],
            n = this.m[1],
            r = this.m[2],
            o = this.m[3],
            s = this.m[4],
            a = this.m[5],
            l = e.m[0],
            c = e.m[1],
            u = e.m[2],
            h = e.m[3],
            d = e.m[4],
            p = e.m[5];
          return (
            (t.m[0] = i * l + n * u),
            (t.m[1] = i * c + n * h),
            (t.m[2] = r * l + o * u),
            (t.m[3] = r * c + o * h),
            (t.m[4] = s * l + a * u + d),
            (t.m[5] = s * c + a * h + p),
            this
          );
        }),
        (e.prototype.transformCoordinates = function (e, t, i) {
          return (
            (i.x = e * this.m[0] + t * this.m[2] + this.m[4]),
            (i.y = e * this.m[1] + t * this.m[3] + this.m[5]),
            this
          );
        }),
        (e.Identity = function () {
          return new e(1, 0, 0, 1, 0, 0);
        }),
        (e.TranslationToRef = function (e, t, i) {
          i.fromValues(1, 0, 0, 1, e, t);
        }),
        (e.ScalingToRef = function (e, t, i) {
          i.fromValues(e, 0, 0, t, 0, 0);
        }),
        (e.RotationToRef = function (e, t) {
          var i = Math.sin(e),
            n = Math.cos(e);
          t.fromValues(n, i, -i, n, 0, 0);
        }),
        (e.ComposeToRef = function (t, i, n, r, o, s, a) {
          e.TranslationToRef(t, i, e._TempPreTranslationMatrix),
            e.ScalingToRef(r, o, e._TempScalingMatrix),
            e.RotationToRef(n, e._TempRotationMatrix),
            e.TranslationToRef(-t, -i, e._TempPostTranslationMatrix),
            e._TempPreTranslationMatrix.multiplyToRef(
              e._TempScalingMatrix,
              e._TempCompose0
            ),
            e._TempCompose0.multiplyToRef(
              e._TempRotationMatrix,
              e._TempCompose1
            ),
            s
              ? (e._TempCompose1.multiplyToRef(
                  e._TempPostTranslationMatrix,
                  e._TempCompose2
                ),
                e._TempCompose2.multiplyToRef(s, a))
              : e._TempCompose1.multiplyToRef(e._TempPostTranslationMatrix, a);
        }),
        (e._TempPreTranslationMatrix = e.Identity()),
        (e._TempPostTranslationMatrix = e.Identity()),
        (e._TempRotationMatrix = e.Identity()),
        (e._TempScalingMatrix = e.Identity()),
        (e._TempCompose0 = e.Identity()),
        (e._TempCompose1 = e.Identity()),
        (e._TempCompose2 = e.Identity()),
        e
      );
    })(),
    sf = (function () {
      function e(t) {
        (this.name = t),
          (this._alpha = 1),
          (this._alphaSet = !1),
          (this._zIndex = 0),
          (this._currentMeasure = nf.Empty()),
          (this._fontFamily = "Arial"),
          (this._fontStyle = ""),
          (this._fontWeight = ""),
          (this._fontSize = new Zp(18, Zp.UNITMODE_PIXEL, !1)),
          (this._width = new Zp(1, Zp.UNITMODE_PERCENTAGE, !1)),
          (this._height = new Zp(1, Zp.UNITMODE_PERCENTAGE, !1)),
          (this._color = ""),
          (this._style = null),
          (this._horizontalAlignment = e.HORIZONTAL_ALIGNMENT_CENTER),
          (this._verticalAlignment = e.VERTICAL_ALIGNMENT_CENTER),
          (this._isDirty = !0),
          (this._wasDirty = !1),
          (this._tempParentMeasure = nf.Empty()),
          (this._prevCurrentMeasureTransformedIntoGlobalSpace = nf.Empty()),
          (this._cachedParentMeasure = nf.Empty()),
          (this._paddingLeft = new Zp(0)),
          (this._paddingRight = new Zp(0)),
          (this._paddingTop = new Zp(0)),
          (this._paddingBottom = new Zp(0)),
          (this._left = new Zp(0)),
          (this._top = new Zp(0)),
          (this._scaleX = 1),
          (this._scaleY = 1),
          (this._rotation = 0),
          (this._transformCenterX = 0.5),
          (this._transformCenterY = 0.5),
          (this._transformMatrix = of.Identity()),
          (this._invertTransformMatrix = of.Identity()),
          (this._transformedPosition = p.Zero()),
          (this._isMatrixDirty = !0),
          (this._isVisible = !0),
          (this._isHighlighted = !1),
          (this._fontSet = !1),
          (this._dummyVector2 = p.Zero()),
          (this._downCount = 0),
          (this._enterCount = -1),
          (this._doNotRender = !1),
          (this._downPointerIds = {}),
          (this._isEnabled = !0),
          (this._disabledColor = "#9a9a9a"),
          (this._disabledColorItem = "#6a6a6a"),
          (this._rebuildLayout = !1),
          (this._customData = {}),
          (this._isClipped = !1),
          (this._automaticSize = !1),
          (this.metadata = null),
          (this.isHitTestVisible = !0),
          (this.isPointerBlocker = !1),
          (this.isFocusInvisible = !1),
          (this.clipChildren = !0),
          (this.clipContent = !0),
          (this.useBitmapCache = !1),
          (this._shadowOffsetX = 0),
          (this._shadowOffsetY = 0),
          (this._shadowBlur = 0),
          (this._shadowColor = "black"),
          (this.hoverCursor = ""),
          (this._linkOffsetX = new Zp(0)),
          (this._linkOffsetY = new Zp(0)),
          (this.onWheelObservable = new o()),
          (this.onPointerMoveObservable = new o()),
          (this.onPointerOutObservable = new o()),
          (this.onPointerDownObservable = new o()),
          (this.onPointerUpObservable = new o()),
          (this.onPointerClickObservable = new o()),
          (this.onPointerEnterObservable = new o()),
          (this.onDirtyObservable = new o()),
          (this.onBeforeDrawObservable = new o()),
          (this.onAfterDrawObservable = new o()),
          (this.onDisposeObservable = new o()),
          (this.fixedRatio = 0),
          (this._fixedRatioMasterIsWidth = !0),
          (this._tmpMeasureA = new nf(0, 0, 0, 0));
      }
      return (
        Object.defineProperty(e.prototype, "shadowOffsetX", {
          get: function () {
            return this._shadowOffsetX;
          },
          set: function (e) {
            this._shadowOffsetX !== e &&
              ((this._shadowOffsetX = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "shadowOffsetY", {
          get: function () {
            return this._shadowOffsetY;
          },
          set: function (e) {
            this._shadowOffsetY !== e &&
              ((this._shadowOffsetY = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "shadowBlur", {
          get: function () {
            return this._shadowBlur;
          },
          set: function (e) {
            this._shadowBlur !== e &&
              ((this._shadowBlur = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "shadowColor", {
          get: function () {
            return this._shadowColor;
          },
          set: function (e) {
            this._shadowColor !== e &&
              ((this._shadowColor = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "typeName", {
          get: function () {
            return this._getTypeName();
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.getClassName = function () {
          return this._getTypeName();
        }),
        Object.defineProperty(e.prototype, "host", {
          get: function () {
            return this._host;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "fontOffset", {
          get: function () {
            return this._fontOffset;
          },
          set: function (e) {
            this._fontOffset = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "alpha", {
          get: function () {
            return this._alpha;
          },
          set: function (e) {
            this._alpha !== e &&
              ((this._alphaSet = !0), (this._alpha = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isHighlighted", {
          get: function () {
            return this._isHighlighted;
          },
          set: function (e) {
            this._isHighlighted !== e &&
              ((this._isHighlighted = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "scaleX", {
          get: function () {
            return this._scaleX;
          },
          set: function (e) {
            this._scaleX !== e &&
              ((this._scaleX = e),
              this._markAsDirty(),
              this._markMatrixAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "scaleY", {
          get: function () {
            return this._scaleY;
          },
          set: function (e) {
            this._scaleY !== e &&
              ((this._scaleY = e),
              this._markAsDirty(),
              this._markMatrixAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "rotation", {
          get: function () {
            return this._rotation;
          },
          set: function (e) {
            this._rotation !== e &&
              ((this._rotation = e),
              this._markAsDirty(),
              this._markMatrixAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "transformCenterY", {
          get: function () {
            return this._transformCenterY;
          },
          set: function (e) {
            this._transformCenterY !== e &&
              ((this._transformCenterY = e),
              this._markAsDirty(),
              this._markMatrixAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "transformCenterX", {
          get: function () {
            return this._transformCenterX;
          },
          set: function (e) {
            this._transformCenterX !== e &&
              ((this._transformCenterX = e),
              this._markAsDirty(),
              this._markMatrixAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "horizontalAlignment", {
          get: function () {
            return this._horizontalAlignment;
          },
          set: function (e) {
            this._horizontalAlignment !== e &&
              ((this._horizontalAlignment = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "verticalAlignment", {
          get: function () {
            return this._verticalAlignment;
          },
          set: function (e) {
            this._verticalAlignment !== e &&
              ((this._verticalAlignment = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "width", {
          get: function () {
            return this._width.toString(this._host);
          },
          set: function (e) {
            (this._fixedRatioMasterIsWidth = !0),
              this._width.toString(this._host) !== e &&
                this._width.fromString(e) &&
                this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "widthInPixels", {
          get: function () {
            return this._width.getValueInPixel(
              this._host,
              this._cachedParentMeasure.width
            );
          },
          set: function (e) {
            isNaN(e) ||
              ((this._fixedRatioMasterIsWidth = !0), (this.width = e + "px"));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "height", {
          get: function () {
            return this._height.toString(this._host);
          },
          set: function (e) {
            (this._fixedRatioMasterIsWidth = !1),
              this._height.toString(this._host) !== e &&
                this._height.fromString(e) &&
                this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "heightInPixels", {
          get: function () {
            return this._height.getValueInPixel(
              this._host,
              this._cachedParentMeasure.height
            );
          },
          set: function (e) {
            isNaN(e) ||
              ((this._fixedRatioMasterIsWidth = !1), (this.height = e + "px"));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "fontFamily", {
          get: function () {
            return this._fontSet ? this._fontFamily : "";
          },
          set: function (e) {
            this._fontFamily !== e &&
              ((this._fontFamily = e), this._resetFontCache());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "fontStyle", {
          get: function () {
            return this._fontStyle;
          },
          set: function (e) {
            this._fontStyle !== e &&
              ((this._fontStyle = e), this._resetFontCache());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "fontWeight", {
          get: function () {
            return this._fontWeight;
          },
          set: function (e) {
            this._fontWeight !== e &&
              ((this._fontWeight = e), this._resetFontCache());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "style", {
          get: function () {
            return this._style;
          },
          set: function (e) {
            var t = this;
            this._style &&
              (this._style.onChangedObservable.remove(this._styleObserver),
              (this._styleObserver = null)),
              (this._style = e),
              this._style &&
                (this._styleObserver = this._style.onChangedObservable.add(
                  function () {
                    t._markAsDirty(), t._resetFontCache();
                  }
                )),
              this._markAsDirty(),
              this._resetFontCache();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "_isFontSizeInPercentage", {
          get: function () {
            return this._fontSize.isPercentage;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "fontSizeInPixels", {
          get: function () {
            var e = this._style ? this._style._fontSize : this._fontSize;
            return e.isPixel
              ? e.getValue(this._host)
              : e.getValueInPixel(
                  this._host,
                  this._tempParentMeasure.height ||
                    this._cachedParentMeasure.height
                );
          },
          set: function (e) {
            isNaN(e) || (this.fontSize = e + "px");
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "fontSize", {
          get: function () {
            return this._fontSize.toString(this._host);
          },
          set: function (e) {
            this._fontSize.toString(this._host) !== e &&
              this._fontSize.fromString(e) &&
              (this._markAsDirty(), this._resetFontCache());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "color", {
          get: function () {
            return this._color;
          },
          set: function (e) {
            this._color !== e && ((this._color = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "zIndex", {
          get: function () {
            return this._zIndex;
          },
          set: function (e) {
            this.zIndex !== e &&
              ((this._zIndex = e),
              this.parent && this.parent._reOrderControl(this));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "notRenderable", {
          get: function () {
            return this._doNotRender;
          },
          set: function (e) {
            this._doNotRender !== e &&
              ((this._doNotRender = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isVisible", {
          get: function () {
            return this._isVisible;
          },
          set: function (e) {
            this._isVisible !== e &&
              ((this._isVisible = e), this._markAsDirty(!0));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isDirty", {
          get: function () {
            return this._isDirty;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "linkedMesh", {
          get: function () {
            return this._linkedMesh;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "paddingLeft", {
          get: function () {
            return this._paddingLeft.toString(this._host);
          },
          set: function (e) {
            this._paddingLeft.fromString(e) && this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "paddingLeftInPixels", {
          get: function () {
            return this._paddingLeft.getValueInPixel(
              this._host,
              this._cachedParentMeasure.width
            );
          },
          set: function (e) {
            isNaN(e) || (this.paddingLeft = e + "px");
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "paddingRight", {
          get: function () {
            return this._paddingRight.toString(this._host);
          },
          set: function (e) {
            this._paddingRight.fromString(e) && this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "paddingRightInPixels", {
          get: function () {
            return this._paddingRight.getValueInPixel(
              this._host,
              this._cachedParentMeasure.width
            );
          },
          set: function (e) {
            isNaN(e) || (this.paddingRight = e + "px");
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "paddingTop", {
          get: function () {
            return this._paddingTop.toString(this._host);
          },
          set: function (e) {
            this._paddingTop.fromString(e) && this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "paddingTopInPixels", {
          get: function () {
            return this._paddingTop.getValueInPixel(
              this._host,
              this._cachedParentMeasure.height
            );
          },
          set: function (e) {
            isNaN(e) || (this.paddingTop = e + "px");
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "paddingBottom", {
          get: function () {
            return this._paddingBottom.toString(this._host);
          },
          set: function (e) {
            this._paddingBottom.fromString(e) && this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "paddingBottomInPixels", {
          get: function () {
            return this._paddingBottom.getValueInPixel(
              this._host,
              this._cachedParentMeasure.height
            );
          },
          set: function (e) {
            isNaN(e) || (this.paddingBottom = e + "px");
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "left", {
          get: function () {
            return this._left.toString(this._host);
          },
          set: function (e) {
            this._left.fromString(e) && this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "leftInPixels", {
          get: function () {
            return this._left.getValueInPixel(
              this._host,
              this._cachedParentMeasure.width
            );
          },
          set: function (e) {
            isNaN(e) || (this.left = e + "px");
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "top", {
          get: function () {
            return this._top.toString(this._host);
          },
          set: function (e) {
            this._top.fromString(e) && this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "topInPixels", {
          get: function () {
            return this._top.getValueInPixel(
              this._host,
              this._cachedParentMeasure.height
            );
          },
          set: function (e) {
            isNaN(e) || (this.top = e + "px");
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "linkOffsetX", {
          get: function () {
            return this._linkOffsetX.toString(this._host);
          },
          set: function (e) {
            this._linkOffsetX.fromString(e) && this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "linkOffsetXInPixels", {
          get: function () {
            return this._linkOffsetX.getValueInPixel(
              this._host,
              this._cachedParentMeasure.width
            );
          },
          set: function (e) {
            isNaN(e) || (this.linkOffsetX = e + "px");
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "linkOffsetY", {
          get: function () {
            return this._linkOffsetY.toString(this._host);
          },
          set: function (e) {
            this._linkOffsetY.fromString(e) && this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "linkOffsetYInPixels", {
          get: function () {
            return this._linkOffsetY.getValueInPixel(
              this._host,
              this._cachedParentMeasure.height
            );
          },
          set: function (e) {
            isNaN(e) || (this.linkOffsetY = e + "px");
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "centerX", {
          get: function () {
            return this._currentMeasure.left + this._currentMeasure.width / 2;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "centerY", {
          get: function () {
            return this._currentMeasure.top + this._currentMeasure.height / 2;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "isEnabled", {
          get: function () {
            return this._isEnabled;
          },
          set: function (e) {
            this._isEnabled !== e &&
              ((this._isEnabled = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "disabledColor", {
          get: function () {
            return this._disabledColor;
          },
          set: function (e) {
            this._disabledColor !== e &&
              ((this._disabledColor = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "disabledColorItem", {
          get: function () {
            return this._disabledColorItem;
          },
          set: function (e) {
            this._disabledColorItem !== e &&
              ((this._disabledColorItem = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype._getTypeName = function () {
          return "Control";
        }),
        (e.prototype.getAscendantOfClass = function (e) {
          return this.parent
            ? this.parent.getClassName() === e
              ? this.parent
              : this.parent.getAscendantOfClass(e)
            : null;
        }),
        (e.prototype._resetFontCache = function () {
          (this._fontSet = !0), this._markAsDirty();
        }),
        (e.prototype.isAscendant = function (e) {
          return (
            !!this.parent && (this.parent === e || this.parent.isAscendant(e))
          );
        }),
        (e.prototype.getLocalCoordinates = function (e) {
          var t = p.Zero();
          return this.getLocalCoordinatesToRef(e, t), t;
        }),
        (e.prototype.getLocalCoordinatesToRef = function (e, t) {
          return (
            (t.x = e.x - this._currentMeasure.left),
            (t.y = e.y - this._currentMeasure.top),
            this
          );
        }),
        (e.prototype.getParentLocalCoordinates = function (e) {
          var t = p.Zero();
          return (
            (t.x = e.x - this._cachedParentMeasure.left),
            (t.y = e.y - this._cachedParentMeasure.top),
            t
          );
        }),
        (e.prototype.moveToVector3 = function (t, i) {
          if (this._host && this.parent === this._host._rootContainer) {
            (this.horizontalAlignment = e.HORIZONTAL_ALIGNMENT_LEFT),
              (this.verticalAlignment = e.VERTICAL_ALIGNMENT_TOP);
            var n = this._host._getGlobalViewport(i),
              r = f.Project(t, g.Identity(), i.getTransformMatrix(), n);
            this._moveToProjectedPosition(r),
              r.z < 0 || r.z > 1
                ? (this.notRenderable = !0)
                : (this.notRenderable = !1);
          } else
            yt.Error(
              "Cannot move a control to a vector3 if the control is not at root level"
            );
        }),
        (e.prototype.getDescendantsToRef = function (e, t, i) {
          void 0 === t && (t = !1);
        }),
        (e.prototype.getDescendants = function (e, t) {
          var i = new Array();
          return this.getDescendantsToRef(i, e, t), i;
        }),
        (e.prototype.linkWithMesh = function (t) {
          if (
            !this._host ||
            (this.parent && this.parent !== this._host._rootContainer)
          )
            t &&
              yt.Error(
                "Cannot link a control to a mesh if the control is not at root level"
              );
          else {
            var i = this._host._linkedControls.indexOf(this);
            if (-1 !== i)
              return (
                (this._linkedMesh = t),
                void (t || this._host._linkedControls.splice(i, 1))
              );
            t &&
              ((this.horizontalAlignment = e.HORIZONTAL_ALIGNMENT_LEFT),
              (this.verticalAlignment = e.VERTICAL_ALIGNMENT_TOP),
              (this._linkedMesh = t),
              this._host._linkedControls.push(this));
          }
        }),
        (e.prototype._moveToProjectedPosition = function (e) {
          var t = this._left.getValue(this._host),
            i = this._top.getValue(this._host),
            n =
              e.x +
              this._linkOffsetX.getValue(this._host) -
              this._currentMeasure.width / 2,
            r =
              e.y +
              this._linkOffsetY.getValue(this._host) -
              this._currentMeasure.height / 2;
          this._left.ignoreAdaptiveScaling &&
            this._top.ignoreAdaptiveScaling &&
            (Math.abs(n - t) < 0.5 && (n = t),
            Math.abs(r - i) < 0.5 && (r = i)),
            (this.left = n + "px"),
            (this.top = r + "px"),
            (this._left.ignoreAdaptiveScaling = !0),
            (this._top.ignoreAdaptiveScaling = !0),
            this._markAsDirty();
        }),
        (e.prototype._offsetLeft = function (e) {
          (this._isDirty = !0), (this._currentMeasure.left += e);
        }),
        (e.prototype._offsetTop = function (e) {
          (this._isDirty = !0), (this._currentMeasure.top += e);
        }),
        (e.prototype._markMatrixAsDirty = function () {
          (this._isMatrixDirty = !0), this._flagDescendantsAsMatrixDirty();
        }),
        (e.prototype._flagDescendantsAsMatrixDirty = function () {}),
        (e.prototype._intersectsRect = function (e) {
          return (
            this._currentMeasure.transformToRef(
              this._transformMatrix,
              this._tmpMeasureA
            ),
            !(
              this._tmpMeasureA.left >= e.left + e.width ||
              this._tmpMeasureA.top >= e.top + e.height ||
              this._tmpMeasureA.left + this._tmpMeasureA.width <= e.left ||
              this._tmpMeasureA.top + this._tmpMeasureA.height <= e.top
            )
          );
        }),
        (e.prototype.invalidateRect = function () {
          if (
            (this._transform(),
            this.host && this.host.useInvalidateRectOptimization)
          )
            if (
              (this._currentMeasure.transformToRef(
                this._transformMatrix,
                this._tmpMeasureA
              ),
              nf.CombineToRef(
                this._tmpMeasureA,
                this._prevCurrentMeasureTransformedIntoGlobalSpace,
                this._tmpMeasureA
              ),
              this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY)
            ) {
              var e = this.shadowOffsetX,
                t = this.shadowOffsetY,
                i = this.shadowBlur,
                n = Math.min(Math.min(e, 0) - 2 * i, 0),
                r = Math.max(Math.max(e, 0) + 2 * i, 0),
                o = Math.min(Math.min(t, 0) - 2 * i, 0),
                s = Math.max(Math.max(t, 0) + 2 * i, 0);
              this.host.invalidateRect(
                Math.floor(this._tmpMeasureA.left + n),
                Math.floor(this._tmpMeasureA.top + o),
                Math.ceil(this._tmpMeasureA.left + this._tmpMeasureA.width + r),
                Math.ceil(this._tmpMeasureA.top + this._tmpMeasureA.height + s)
              );
            } else
              this.host.invalidateRect(
                Math.floor(this._tmpMeasureA.left),
                Math.floor(this._tmpMeasureA.top),
                Math.ceil(this._tmpMeasureA.left + this._tmpMeasureA.width),
                Math.ceil(this._tmpMeasureA.top + this._tmpMeasureA.height)
              );
        }),
        (e.prototype._markAsDirty = function (e) {
          void 0 === e && (e = !1),
            (this._isVisible || e) &&
              ((this._isDirty = !0), this._host && this._host.markAsDirty());
        }),
        (e.prototype._markAllAsDirty = function () {
          this._markAsDirty(), this._font && this._prepareFont();
        }),
        (e.prototype._link = function (e) {
          (this._host = e),
            this._host && (this.uniqueId = this._host.getScene().getUniqueId());
        }),
        (e.prototype._transform = function (e) {
          if (
            this._isMatrixDirty ||
            1 !== this._scaleX ||
            1 !== this._scaleY ||
            0 !== this._rotation
          ) {
            var t =
                this._currentMeasure.width * this._transformCenterX +
                this._currentMeasure.left,
              i =
                this._currentMeasure.height * this._transformCenterY +
                this._currentMeasure.top;
            e &&
              (e.translate(t, i),
              e.rotate(this._rotation),
              e.scale(this._scaleX, this._scaleY),
              e.translate(-t, -i)),
              (this._isMatrixDirty ||
                this._cachedOffsetX !== t ||
                this._cachedOffsetY !== i) &&
                ((this._cachedOffsetX = t),
                (this._cachedOffsetY = i),
                (this._isMatrixDirty = !1),
                this._flagDescendantsAsMatrixDirty(),
                of.ComposeToRef(
                  -t,
                  -i,
                  this._rotation,
                  this._scaleX,
                  this._scaleY,
                  this.parent ? this.parent._transformMatrix : null,
                  this._transformMatrix
                ),
                this._transformMatrix.invertToRef(this._invertTransformMatrix));
          }
        }),
        (e.prototype._renderHighlight = function (e) {
          this.isHighlighted &&
            (e.save(),
            (e.strokeStyle = "#4affff"),
            (e.lineWidth = 2),
            this._renderHighlightSpecific(e),
            e.restore());
        }),
        (e.prototype._renderHighlightSpecific = function (e) {
          e.strokeRect(
            this._currentMeasure.left,
            this._currentMeasure.top,
            this._currentMeasure.width,
            this._currentMeasure.height
          );
        }),
        (e.prototype._applyStates = function (t) {
          this._isFontSizeInPercentage && (this._fontSet = !0),
            this._fontSet && (this._prepareFont(), (this._fontSet = !1)),
            this._font && (t.font = this._font),
            this._color && (t.fillStyle = this._color),
            e.AllowAlphaInheritance
              ? (t.globalAlpha *= this._alpha)
              : this._alphaSet &&
                (t.globalAlpha = this.parent
                  ? this.parent.alpha * this._alpha
                  : this._alpha);
        }),
        (e.prototype._layout = function (e, t) {
          if (!this.isDirty && (!this.isVisible || this.notRenderable))
            return !1;
          if (this._isDirty || !this._cachedParentMeasure.isEqualsTo(e)) {
            this.host._numLayoutCalls++,
              this._currentMeasure.addAndTransformToRef(
                this._transformMatrix,
                0 | -this.paddingLeftInPixels,
                0 | -this.paddingTopInPixels,
                0 | this.paddingRightInPixels,
                0 | this.paddingBottomInPixels,
                this._prevCurrentMeasureTransformedIntoGlobalSpace
              ),
              t.save(),
              this._applyStates(t);
            var i = 0;
            do {
              (this._rebuildLayout = !1), this._processMeasures(e, t), i++;
            } while (this._rebuildLayout && i < 3);
            i >= 3 &&
              F.Error(
                "Layout cycle detected in GUI (Control name=" +
                  this.name +
                  ", uniqueId=" +
                  this.uniqueId +
                  ")"
              ),
              t.restore(),
              this.invalidateRect(),
              this._evaluateClippingState(e);
          }
          return (this._wasDirty = this._isDirty), (this._isDirty = !1), !0;
        }),
        (e.prototype._processMeasures = function (e, t) {
          this._currentMeasure.copyFrom(e),
            this._preMeasure(e, t),
            this._measure(),
            this._computeAlignment(e, t),
            (this._currentMeasure.left = 0 | this._currentMeasure.left),
            (this._currentMeasure.top = 0 | this._currentMeasure.top),
            (this._currentMeasure.width = 0 | this._currentMeasure.width),
            (this._currentMeasure.height = 0 | this._currentMeasure.height),
            this._additionalProcessing(e, t),
            this._cachedParentMeasure.copyFrom(e),
            this.onDirtyObservable.hasObservers() &&
              this.onDirtyObservable.notifyObservers(this);
        }),
        (e.prototype._evaluateClippingState = function (e) {
          if (this.parent && this.parent.clipChildren) {
            if (this._currentMeasure.left > e.left + e.width)
              return void (this._isClipped = !0);
            if (this._currentMeasure.left + this._currentMeasure.width < e.left)
              return void (this._isClipped = !0);
            if (this._currentMeasure.top > e.top + e.height)
              return void (this._isClipped = !0);
            if (this._currentMeasure.top + this._currentMeasure.height < e.top)
              return void (this._isClipped = !0);
          }
          this._isClipped = !1;
        }),
        (e.prototype._measure = function () {
          this._width.isPixel
            ? (this._currentMeasure.width = this._width.getValue(this._host))
            : (this._currentMeasure.width *= this._width.getValue(this._host)),
            this._height.isPixel
              ? (this._currentMeasure.height = this._height.getValue(
                  this._host
                ))
              : (this._currentMeasure.height *= this._height.getValue(
                  this._host
                )),
            0 !== this.fixedRatio &&
              (this._fixedRatioMasterIsWidth
                ? (this._currentMeasure.height =
                    this._currentMeasure.width * this.fixedRatio)
                : (this._currentMeasure.width =
                    this._currentMeasure.height * this.fixedRatio));
        }),
        (e.prototype._computeAlignment = function (t, i) {
          var n = this._currentMeasure.width,
            r = this._currentMeasure.height,
            o = t.width,
            s = t.height,
            a = 0,
            l = 0;
          switch (this.horizontalAlignment) {
            case e.HORIZONTAL_ALIGNMENT_LEFT:
              a = 0;
              break;
            case e.HORIZONTAL_ALIGNMENT_RIGHT:
              a = o - n;
              break;
            case e.HORIZONTAL_ALIGNMENT_CENTER:
              a = (o - n) / 2;
          }
          switch (this.verticalAlignment) {
            case e.VERTICAL_ALIGNMENT_TOP:
              l = 0;
              break;
            case e.VERTICAL_ALIGNMENT_BOTTOM:
              l = s - r;
              break;
            case e.VERTICAL_ALIGNMENT_CENTER:
              l = (s - r) / 2;
          }
          this._paddingLeft.isPixel
            ? ((this._currentMeasure.left += this._paddingLeft.getValue(
                this._host
              )),
              (this._currentMeasure.width -= this._paddingLeft.getValue(
                this._host
              )))
            : ((this._currentMeasure.left +=
                o * this._paddingLeft.getValue(this._host)),
              (this._currentMeasure.width -=
                o * this._paddingLeft.getValue(this._host))),
            this._paddingRight.isPixel
              ? (this._currentMeasure.width -= this._paddingRight.getValue(
                  this._host
                ))
              : (this._currentMeasure.width -=
                  o * this._paddingRight.getValue(this._host)),
            this._paddingTop.isPixel
              ? ((this._currentMeasure.top += this._paddingTop.getValue(
                  this._host
                )),
                (this._currentMeasure.height -= this._paddingTop.getValue(
                  this._host
                )))
              : ((this._currentMeasure.top +=
                  s * this._paddingTop.getValue(this._host)),
                (this._currentMeasure.height -=
                  s * this._paddingTop.getValue(this._host))),
            this._paddingBottom.isPixel
              ? (this._currentMeasure.height -= this._paddingBottom.getValue(
                  this._host
                ))
              : (this._currentMeasure.height -=
                  s * this._paddingBottom.getValue(this._host)),
            this._left.isPixel
              ? (this._currentMeasure.left += this._left.getValue(this._host))
              : (this._currentMeasure.left +=
                  o * this._left.getValue(this._host)),
            this._top.isPixel
              ? (this._currentMeasure.top += this._top.getValue(this._host))
              : (this._currentMeasure.top +=
                  s * this._top.getValue(this._host)),
            (this._currentMeasure.left += a),
            (this._currentMeasure.top += l);
        }),
        (e.prototype._preMeasure = function (e, t) {}),
        (e.prototype._additionalProcessing = function (e, t) {}),
        (e.prototype._clipForChildren = function (e) {}),
        (e.prototype._clip = function (t, i) {
          if (
            (t.beginPath(), e._ClipMeasure.copyFrom(this._currentMeasure), i)
          ) {
            i.transformToRef(this._invertTransformMatrix, this._tmpMeasureA);
            var n = new nf(0, 0, 0, 0);
            (n.left = Math.max(
              this._tmpMeasureA.left,
              this._currentMeasure.left
            )),
              (n.top = Math.max(
                this._tmpMeasureA.top,
                this._currentMeasure.top
              )),
              (n.width =
                Math.min(
                  this._tmpMeasureA.left + this._tmpMeasureA.width,
                  this._currentMeasure.left + this._currentMeasure.width
                ) - n.left),
              (n.height =
                Math.min(
                  this._tmpMeasureA.top + this._tmpMeasureA.height,
                  this._currentMeasure.top + this._currentMeasure.height
                ) - n.top),
              e._ClipMeasure.copyFrom(n);
          }
          if (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) {
            var r = this.shadowOffsetX,
              o = this.shadowOffsetY,
              s = this.shadowBlur,
              a = Math.min(Math.min(r, 0) - 2 * s, 0),
              l = Math.max(Math.max(r, 0) + 2 * s, 0),
              c = Math.min(Math.min(o, 0) - 2 * s, 0),
              u = Math.max(Math.max(o, 0) + 2 * s, 0);
            t.rect(
              e._ClipMeasure.left + a,
              e._ClipMeasure.top + c,
              e._ClipMeasure.width + l - a,
              e._ClipMeasure.height + u - c
            );
          } else
            t.rect(
              e._ClipMeasure.left,
              e._ClipMeasure.top,
              e._ClipMeasure.width,
              e._ClipMeasure.height
            );
          t.clip();
        }),
        (e.prototype._render = function (e, t) {
          return !this.isVisible || this.notRenderable || this._isClipped
            ? ((this._isDirty = !1), !1)
            : (this.host._numRenderCalls++,
              e.save(),
              this._applyStates(e),
              this._transform(e),
              this.clipContent && this._clip(e, t),
              this.onBeforeDrawObservable.hasObservers() &&
                this.onBeforeDrawObservable.notifyObservers(this),
              this.useBitmapCache && !this._wasDirty && this._cacheData
                ? e.putImageData(
                    this._cacheData,
                    this._currentMeasure.left,
                    this._currentMeasure.top
                  )
                : this._draw(e, t),
              this.useBitmapCache &&
                this._wasDirty &&
                (this._cacheData = e.getImageData(
                  this._currentMeasure.left,
                  this._currentMeasure.top,
                  this._currentMeasure.width,
                  this._currentMeasure.height
                )),
              this._renderHighlight(e),
              this.onAfterDrawObservable.hasObservers() &&
                this.onAfterDrawObservable.notifyObservers(this),
              e.restore(),
              !0);
        }),
        (e.prototype._draw = function (e, t) {}),
        (e.prototype.contains = function (e, t) {
          return (
            this._invertTransformMatrix.transformCoordinates(
              e,
              t,
              this._transformedPosition
            ),
            (e = this._transformedPosition.x),
            (t = this._transformedPosition.y),
            !(
              e < this._currentMeasure.left ||
              e > this._currentMeasure.left + this._currentMeasure.width ||
              t < this._currentMeasure.top ||
              t > this._currentMeasure.top + this._currentMeasure.height ||
              (this.isPointerBlocker && (this._host._shouldBlockPointer = !0),
              0)
            )
          );
        }),
        (e.prototype._processPicking = function (e, t, i, n, r, o, s, a) {
          return !(
            !this._isEnabled ||
            !this.isHitTestVisible ||
            !this.isVisible ||
            this._doNotRender ||
            !this.contains(e, t) ||
            (this._processObservables(n, e, t, i, r, o, s, a), 0)
          );
        }),
        (e.prototype._onPointerMove = function (e, t, i, n) {
          this.onPointerMoveObservable.notifyObservers(t, -1, e, this, n) &&
            null != this.parent &&
            this.parent._onPointerMove(e, t, i, n);
        }),
        (e.prototype._onPointerEnter = function (e, t) {
          return !(
            !this._isEnabled ||
            this._enterCount > 0 ||
            (-1 === this._enterCount && (this._enterCount = 0),
            this._enterCount++,
            this.onPointerEnterObservable.notifyObservers(
              this,
              -1,
              e,
              this,
              t
            ) &&
              null != this.parent &&
              this.parent._onPointerEnter(e, t),
            0)
          );
        }),
        (e.prototype._onPointerOut = function (e, t, i) {
          if (
            (void 0 === i && (i = !1), i || (this._isEnabled && e !== this))
          ) {
            this._enterCount = 0;
            var n = !0;
            e.isAscendant(this) ||
              (n = this.onPointerOutObservable.notifyObservers(
                this,
                -1,
                e,
                this,
                t
              )),
              n && null != this.parent && this.parent._onPointerOut(e, t, i);
          }
        }),
        (e.prototype._onPointerDown = function (e, t, i, n, r) {
          return (
            this._onPointerEnter(this, r),
            0 === this._downCount &&
              (this._downCount++,
              (this._downPointerIds[i] = !0),
              this.onPointerDownObservable.notifyObservers(
                new rf(t, n),
                -1,
                e,
                this,
                r
              ) &&
                null != this.parent &&
                this.parent._onPointerDown(e, t, i, n, r),
              !0)
          );
        }),
        (e.prototype._onPointerUp = function (e, t, i, n, r, o) {
          if (this._isEnabled) {
            (this._downCount = 0), delete this._downPointerIds[i];
            var s = r;
            r &&
              (this._enterCount > 0 || -1 === this._enterCount) &&
              (s = this.onPointerClickObservable.notifyObservers(
                new rf(t, n),
                -1,
                e,
                this,
                o
              )),
              this.onPointerUpObservable.notifyObservers(
                new rf(t, n),
                -1,
                e,
                this,
                o
              ) &&
                null != this.parent &&
                this.parent._onPointerUp(e, t, i, n, s, o);
          }
        }),
        (e.prototype._forcePointerUp = function (e) {
          if ((void 0 === e && (e = null), null !== e))
            this._onPointerUp(this, p.Zero(), e, 0, !0);
          else
            for (var t in this._downPointerIds)
              this._onPointerUp(this, p.Zero(), +t, 0, !0);
        }),
        (e.prototype._onWheelScroll = function (e, t) {
          this._isEnabled &&
            this.onWheelObservable.notifyObservers(new p(e, t)) &&
            null != this.parent &&
            this.parent._onWheelScroll(e, t);
        }),
        (e.prototype._onCanvasBlur = function () {}),
        (e.prototype._processObservables = function (e, t, i, n, r, o, s, a) {
          if (!this._isEnabled) return !1;
          if ((this._dummyVector2.copyFromFloats(t, i), e === pi.POINTERMOVE)) {
            this._onPointerMove(this, this._dummyVector2, r, n);
            var l = this._host._lastControlOver[r];
            return (
              l && l !== this && l._onPointerOut(this, n),
              l !== this && this._onPointerEnter(this, n),
              (this._host._lastControlOver[r] = this),
              !0
            );
          }
          return e === pi.POINTERDOWN
            ? (this._onPointerDown(this, this._dummyVector2, r, o, n),
              this._host._registerLastControlDown(this, r),
              (this._host._lastPickedControl = this),
              !0)
            : e === pi.POINTERUP
              ? (this._host._lastControlDown[r] &&
                  this._host._lastControlDown[r]._onPointerUp(
                    this,
                    this._dummyVector2,
                    r,
                    o,
                    !0,
                    n
                  ),
                delete this._host._lastControlDown[r],
                !0)
              : !(
                  e !== pi.POINTERWHEEL ||
                  !this._host._lastControlOver[r] ||
                  (this._host._lastControlOver[r]._onWheelScroll(s, a), 0)
                );
        }),
        (e.prototype._prepareFont = function () {
          (this._font || this._fontSet) &&
            (this._style
              ? (this._font =
                  this._style.fontStyle +
                  " " +
                  this._style.fontWeight +
                  " " +
                  this.fontSizeInPixels +
                  "px " +
                  this._style.fontFamily)
              : (this._font =
                  this._fontStyle +
                  " " +
                  this._fontWeight +
                  " " +
                  this.fontSizeInPixels +
                  "px " +
                  this._fontFamily),
            (this._fontOffset = e._GetFontOffset(this._font)));
        }),
        (e.prototype.dispose = function () {
          this.onDirtyObservable.clear(),
            this.onBeforeDrawObservable.clear(),
            this.onAfterDrawObservable.clear(),
            this.onPointerDownObservable.clear(),
            this.onPointerEnterObservable.clear(),
            this.onPointerMoveObservable.clear(),
            this.onPointerOutObservable.clear(),
            this.onPointerUpObservable.clear(),
            this.onPointerClickObservable.clear(),
            this.onWheelObservable.clear(),
            this._styleObserver &&
              this._style &&
              (this._style.onChangedObservable.remove(this._styleObserver),
              (this._styleObserver = null)),
            this.parent &&
              (this.parent.removeControl(this), (this.parent = null)),
            this._host &&
              this._host._linkedControls.indexOf(this) > -1 &&
              this.linkWithMesh(null),
            this.onDisposeObservable.notifyObservers(this),
            this.onDisposeObservable.clear();
        }),
        Object.defineProperty(e, "HORIZONTAL_ALIGNMENT_LEFT", {
          get: function () {
            return e._HORIZONTAL_ALIGNMENT_LEFT;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e, "HORIZONTAL_ALIGNMENT_RIGHT", {
          get: function () {
            return e._HORIZONTAL_ALIGNMENT_RIGHT;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e, "HORIZONTAL_ALIGNMENT_CENTER", {
          get: function () {
            return e._HORIZONTAL_ALIGNMENT_CENTER;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e, "VERTICAL_ALIGNMENT_TOP", {
          get: function () {
            return e._VERTICAL_ALIGNMENT_TOP;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e, "VERTICAL_ALIGNMENT_BOTTOM", {
          get: function () {
            return e._VERTICAL_ALIGNMENT_BOTTOM;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e, "VERTICAL_ALIGNMENT_CENTER", {
          get: function () {
            return e._VERTICAL_ALIGNMENT_CENTER;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e._GetFontOffset = function (t) {
          if (e._FontHeightSizes[t]) return e._FontHeightSizes[t];
          var i = document.createElement("span");
          (i.innerHTML = "Hg"), (i.style.font = t);
          var n = document.createElement("div");
          (n.style.display = "inline-block"),
            (n.style.width = "1px"),
            (n.style.height = "0px"),
            (n.style.verticalAlign = "bottom");
          var r = document.createElement("div");
          (r.style.whiteSpace = "nowrap"),
            r.appendChild(i),
            r.appendChild(n),
            document.body.appendChild(r);
          var o = 0,
            s = 0;
          try {
            (s = n.getBoundingClientRect().top - i.getBoundingClientRect().top),
              (n.style.verticalAlign = "baseline"),
              (o =
                n.getBoundingClientRect().top - i.getBoundingClientRect().top);
          } finally {
            document.body.removeChild(r);
          }
          var a = {
            ascent: o,
            height: s,
            descent: s - o,
          };
          return (e._FontHeightSizes[t] = a), a;
        }),
        (e.drawEllipse = function (e, t, i, n, r) {
          r.translate(e, t),
            r.scale(i, n),
            r.beginPath(),
            r.arc(0, 0, 1, 0, 2 * Math.PI),
            r.closePath(),
            r.scale(1 / i, 1 / n),
            r.translate(-e, -t);
        }),
        (e.AllowAlphaInheritance = !1),
        (e._ClipMeasure = new nf(0, 0, 0, 0)),
        (e._HORIZONTAL_ALIGNMENT_LEFT = 0),
        (e._HORIZONTAL_ALIGNMENT_RIGHT = 1),
        (e._HORIZONTAL_ALIGNMENT_CENTER = 2),
        (e._VERTICAL_ALIGNMENT_TOP = 0),
        (e._VERTICAL_ALIGNMENT_BOTTOM = 1),
        (e._VERTICAL_ALIGNMENT_CENTER = 2),
        (e._FontHeightSizes = {}),
        (e.AddHeader = function () {}),
        e
      );
    })();
  h.RegisteredTypes["BABYLON.GUI.Control"] = sf;
  var af = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      return (
        (i.name = t),
        (i._children = new Array()),
        (i._measureForChildren = nf.Empty()),
        (i._background = ""),
        (i._adaptWidthToChildren = !1),
        (i._adaptHeightToChildren = !1),
        (i.logLayoutCycleErrors = !1),
        (i.maxLayoutCycle = 3),
        i
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "adaptHeightToChildren", {
        get: function () {
          return this._adaptHeightToChildren;
        },
        set: function (e) {
          this._adaptHeightToChildren !== e &&
            ((this._adaptHeightToChildren = e),
            e && (this.height = "100%"),
            this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "adaptWidthToChildren", {
        get: function () {
          return this._adaptWidthToChildren;
        },
        set: function (e) {
          this._adaptWidthToChildren !== e &&
            ((this._adaptWidthToChildren = e),
            e && (this.width = "100%"),
            this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "background", {
        get: function () {
          return this._background;
        },
        set: function (e) {
          this._background !== e &&
            ((this._background = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "children", {
        get: function () {
          return this._children;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._getTypeName = function () {
        return "Container";
      }),
      (t.prototype._flagDescendantsAsMatrixDirty = function () {
        for (var e = 0, t = this.children; e < t.length; e++)
          t[e]._markMatrixAsDirty();
      }),
      (t.prototype.getChildByName = function (e) {
        for (var t = 0, i = this.children; t < i.length; t++) {
          var n = i[t];
          if (n.name === e) return n;
        }
        return null;
      }),
      (t.prototype.getChildByType = function (e, t) {
        for (var i = 0, n = this.children; i < n.length; i++) {
          var r = n[i];
          if (r.typeName === t) return r;
        }
        return null;
      }),
      (t.prototype.containsControl = function (e) {
        return -1 !== this.children.indexOf(e);
      }),
      (t.prototype.addControl = function (e) {
        return e
          ? (-1 !== this._children.indexOf(e) ||
              (e._link(this._host),
              e._markAllAsDirty(),
              this._reOrderControl(e),
              this._markAsDirty()),
            this)
          : this;
      }),
      (t.prototype.clearControls = function () {
        for (var e = 0, t = this.children.slice(); e < t.length; e++) {
          var i = t[e];
          this.removeControl(i);
        }
        return this;
      }),
      (t.prototype.removeControl = function (e) {
        var t = this._children.indexOf(e);
        return (
          -1 !== t && (this._children.splice(t, 1), (e.parent = null)),
          e.linkWithMesh(null),
          this._host && this._host._cleanControlAfterRemoval(e),
          this._markAsDirty(),
          this
        );
      }),
      (t.prototype._reOrderControl = function (e) {
        this.removeControl(e);
        for (var t = !1, i = 0; i < this._children.length; i++)
          if (this._children[i].zIndex > e.zIndex) {
            this._children.splice(i, 0, e), (t = !0);
            break;
          }
        t || this._children.push(e), (e.parent = this), this._markAsDirty();
      }),
      (t.prototype._offsetLeft = function (t) {
        e.prototype._offsetLeft.call(this, t);
        for (var i = 0, n = this._children; i < n.length; i++)
          n[i]._offsetLeft(t);
      }),
      (t.prototype._offsetTop = function (t) {
        e.prototype._offsetTop.call(this, t);
        for (var i = 0, n = this._children; i < n.length; i++)
          n[i]._offsetTop(t);
      }),
      (t.prototype._markAllAsDirty = function () {
        e.prototype._markAllAsDirty.call(this);
        for (var t = 0; t < this._children.length; t++)
          this._children[t]._markAllAsDirty();
      }),
      (t.prototype._localDraw = function (e) {
        this._background &&
          (e.save(),
          (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
            ((e.shadowColor = this.shadowColor),
            (e.shadowBlur = this.shadowBlur),
            (e.shadowOffsetX = this.shadowOffsetX),
            (e.shadowOffsetY = this.shadowOffsetY)),
          (e.fillStyle = this._background),
          e.fillRect(
            this._currentMeasure.left,
            this._currentMeasure.top,
            this._currentMeasure.width,
            this._currentMeasure.height
          ),
          e.restore());
      }),
      (t.prototype._link = function (t) {
        e.prototype._link.call(this, t);
        for (var i = 0, n = this._children; i < n.length; i++) n[i]._link(t);
      }),
      (t.prototype._beforeLayout = function () {}),
      (t.prototype._processMeasures = function (t, i) {
        (!this._isDirty && this._cachedParentMeasure.isEqualsTo(t)) ||
          (e.prototype._processMeasures.call(this, t, i),
          this._evaluateClippingState(t));
      }),
      (t.prototype._layout = function (e, t) {
        if (!this.isDirty && (!this.isVisible || this.notRenderable)) return !1;
        this.host._numLayoutCalls++,
          this._isDirty &&
            this._currentMeasure.transformToRef(
              this._transformMatrix,
              this._prevCurrentMeasureTransformedIntoGlobalSpace
            );
        var i = 0;
        t.save(), this._applyStates(t), this._beforeLayout();
        do {
          var n = -1,
            r = -1;
          if (
            ((this._rebuildLayout = !1),
            this._processMeasures(e, t),
            !this._isClipped)
          ) {
            for (var o = 0, s = this._children; o < s.length; o++) {
              var a = s[o];
              a._tempParentMeasure.copyFrom(this._measureForChildren),
                a._layout(this._measureForChildren, t) &&
                  (this.adaptWidthToChildren &&
                    a._width.isPixel &&
                    (n = Math.max(
                      n,
                      a._currentMeasure.width +
                        a.paddingLeftInPixels +
                        a.paddingRightInPixels
                    )),
                  this.adaptHeightToChildren &&
                    a._height.isPixel &&
                    (r = Math.max(
                      r,
                      a._currentMeasure.height +
                        a.paddingTopInPixels +
                        a.paddingBottomInPixels
                    )));
            }
            this.adaptWidthToChildren &&
              n >= 0 &&
              ((n += this.paddingLeftInPixels + this.paddingRightInPixels),
              this.width !== n + "px" &&
                ((this.width = n + "px"), (this._rebuildLayout = !0))),
              this.adaptHeightToChildren &&
                r >= 0 &&
                ((r += this.paddingTopInPixels + this.paddingBottomInPixels),
                this.height !== r + "px" &&
                  ((this.height = r + "px"), (this._rebuildLayout = !0))),
              this._postMeasure();
          }
          i++;
        } while (this._rebuildLayout && i < this.maxLayoutCycle);
        return (
          i >= 3 &&
            this.logLayoutCycleErrors &&
            F.Error(
              "Layout cycle detected in GUI (Container name=" +
                this.name +
                ", uniqueId=" +
                this.uniqueId +
                ")"
            ),
          t.restore(),
          this._isDirty && (this.invalidateRect(), (this._isDirty = !1)),
          !0
        );
      }),
      (t.prototype._postMeasure = function () {}),
      (t.prototype._draw = function (e, t) {
        this._localDraw(e), this.clipChildren && this._clipForChildren(e);
        for (var i = 0, n = this._children; i < n.length; i++) {
          var r = n[i];
          (t && !r._intersectsRect(t)) || r._render(e, t);
        }
      }),
      (t.prototype.getDescendantsToRef = function (e, t, i) {
        if ((void 0 === t && (t = !1), this.children))
          for (var n = 0; n < this.children.length; n++) {
            var r = this.children[n];
            (i && !i(r)) || e.push(r), t || r.getDescendantsToRef(e, !1, i);
          }
      }),
      (t.prototype._processPicking = function (t, i, n, r, o, s, a, l) {
        if (!this._isEnabled || !this.isVisible || this.notRenderable)
          return !1;
        if (!e.prototype.contains.call(this, t, i)) return !1;
        for (var c = this._children.length - 1; c >= 0; c--) {
          var u = this._children[c];
          if (u._processPicking(t, i, n, r, o, s, a, l))
            return u.hoverCursor && this._host._changeCursor(u.hoverCursor), !0;
        }
        return (
          !!this.isHitTestVisible &&
          this._processObservables(r, t, i, n, o, s, a, l)
        );
      }),
      (t.prototype._additionalProcessing = function (t, i) {
        e.prototype._additionalProcessing.call(this, t, i),
          this._measureForChildren.copyFrom(this._currentMeasure);
      }),
      (t.prototype.dispose = function () {
        e.prototype.dispose.call(this);
        for (var t = this.children.length - 1; t >= 0; t--)
          this.children[t].dispose();
      }),
      t
    );
  })(sf);
  h.RegisteredTypes["BABYLON.GUI.Container"] = af;
  var lf,
    cf = (function (e) {
      function t(t) {
        var i = e.call(this, t) || this;
        return (i.name = t), (i._thickness = 1), (i._cornerRadius = 0), i;
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "thickness", {
          get: function () {
            return this._thickness;
          },
          set: function (e) {
            this._thickness !== e &&
              ((this._thickness = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "cornerRadius", {
          get: function () {
            return this._cornerRadius;
          },
          set: function (e) {
            e < 0 && (e = 0),
              this._cornerRadius !== e &&
                ((this._cornerRadius = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._getTypeName = function () {
          return "Rectangle";
        }),
        (t.prototype._localDraw = function (e) {
          e.save(),
            (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
              ((e.shadowColor = this.shadowColor),
              (e.shadowBlur = this.shadowBlur),
              (e.shadowOffsetX = this.shadowOffsetX),
              (e.shadowOffsetY = this.shadowOffsetY)),
            this._background &&
              ((e.fillStyle = this._background),
              this._cornerRadius
                ? (this._drawRoundedRect(e, this._thickness / 2), e.fill())
                : e.fillRect(
                    this._currentMeasure.left,
                    this._currentMeasure.top,
                    this._currentMeasure.width,
                    this._currentMeasure.height
                  )),
            this._thickness &&
              ((this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
                ((e.shadowBlur = 0),
                (e.shadowOffsetX = 0),
                (e.shadowOffsetY = 0)),
              this.color && (e.strokeStyle = this.color),
              (e.lineWidth = this._thickness),
              this._cornerRadius
                ? (this._drawRoundedRect(e, this._thickness / 2), e.stroke())
                : e.strokeRect(
                    this._currentMeasure.left + this._thickness / 2,
                    this._currentMeasure.top + this._thickness / 2,
                    this._currentMeasure.width - this._thickness,
                    this._currentMeasure.height - this._thickness
                  )),
            e.restore();
        }),
        (t.prototype._additionalProcessing = function (t, i) {
          e.prototype._additionalProcessing.call(this, t, i),
            (this._measureForChildren.width -= 2 * this._thickness),
            (this._measureForChildren.height -= 2 * this._thickness),
            (this._measureForChildren.left += this._thickness),
            (this._measureForChildren.top += this._thickness);
        }),
        (t.prototype._drawRoundedRect = function (e, t) {
          void 0 === t && (t = 0);
          var i = this._currentMeasure.left + t,
            n = this._currentMeasure.top + t,
            r = this._currentMeasure.width - 2 * t,
            o = this._currentMeasure.height - 2 * t,
            s = Math.min(o / 2 - 2, Math.min(r / 2 - 2, this._cornerRadius));
          e.beginPath(),
            e.moveTo(i + s, n),
            e.lineTo(i + r - s, n),
            e.quadraticCurveTo(i + r, n, i + r, n + s),
            e.lineTo(i + r, n + o - s),
            e.quadraticCurveTo(i + r, n + o, i + r - s, n + o),
            e.lineTo(i + s, n + o),
            e.quadraticCurveTo(i, n + o, i, n + o - s),
            e.lineTo(i, n + s),
            e.quadraticCurveTo(i, n, i + s, n),
            e.closePath();
        }),
        (t.prototype._clipForChildren = function (e) {
          this._cornerRadius &&
            (this._drawRoundedRect(e, this._thickness), e.clip());
        }),
        t
      );
    })(af);
  (h.RegisteredTypes["BABYLON.GUI.Rectangle"] = cf),
    (function (e) {
      (e[(e.Clip = 0)] = "Clip"),
        (e[(e.WordWrap = 1)] = "WordWrap"),
        (e[(e.Ellipsis = 2)] = "Ellipsis");
    })(lf || (lf = {}));
  var uf = (function (e) {
    function t(t, i) {
      void 0 === i && (i = "");
      var n = e.call(this, t) || this;
      return (
        (n.name = t),
        (n._text = ""),
        (n._textWrapping = lf.Clip),
        (n._textHorizontalAlignment = sf.HORIZONTAL_ALIGNMENT_CENTER),
        (n._textVerticalAlignment = sf.VERTICAL_ALIGNMENT_CENTER),
        (n._resizeToFit = !1),
        (n._lineSpacing = new Zp(0)),
        (n._outlineWidth = 0),
        (n._outlineColor = "white"),
        (n._underline = !1),
        (n._lineThrough = !1),
        (n.onTextChangedObservable = new o()),
        (n.onLinesReadyObservable = new o()),
        (n.text = i),
        n
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "lines", {
        get: function () {
          return this._lines;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "resizeToFit", {
        get: function () {
          return this._resizeToFit;
        },
        set: function (e) {
          this._resizeToFit !== e &&
            ((this._resizeToFit = e),
            this._resizeToFit &&
              ((this._width.ignoreAdaptiveScaling = !0),
              (this._height.ignoreAdaptiveScaling = !0)),
            this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "textWrapping", {
        get: function () {
          return this._textWrapping;
        },
        set: function (e) {
          this._textWrapping !== e &&
            ((this._textWrapping = +e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "text", {
        get: function () {
          return this._text;
        },
        set: function (e) {
          this._text !== e &&
            ((this._text = e),
            this._markAsDirty(),
            this.onTextChangedObservable.notifyObservers(this));
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "textHorizontalAlignment", {
        get: function () {
          return this._textHorizontalAlignment;
        },
        set: function (e) {
          this._textHorizontalAlignment !== e &&
            ((this._textHorizontalAlignment = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "textVerticalAlignment", {
        get: function () {
          return this._textVerticalAlignment;
        },
        set: function (e) {
          this._textVerticalAlignment !== e &&
            ((this._textVerticalAlignment = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "lineSpacing", {
        get: function () {
          return this._lineSpacing.toString(this._host);
        },
        set: function (e) {
          this._lineSpacing.fromString(e) && this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "outlineWidth", {
        get: function () {
          return this._outlineWidth;
        },
        set: function (e) {
          this._outlineWidth !== e &&
            ((this._outlineWidth = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "underline", {
        get: function () {
          return this._underline;
        },
        set: function (e) {
          this._underline !== e && ((this._underline = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "lineThrough", {
        get: function () {
          return this._lineThrough;
        },
        set: function (e) {
          this._lineThrough !== e &&
            ((this._lineThrough = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "outlineColor", {
        get: function () {
          return this._outlineColor;
        },
        set: function (e) {
          this._outlineColor !== e &&
            ((this._outlineColor = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._getTypeName = function () {
        return "TextBlock";
      }),
      (t.prototype._processMeasures = function (t, i) {
        this._fontOffset || (this._fontOffset = sf._GetFontOffset(i.font)),
          e.prototype._processMeasures.call(this, t, i),
          (this._lines = this._breakLines(this._currentMeasure.width, i)),
          this.onLinesReadyObservable.notifyObservers(this);
        for (var n = 0, r = 0; r < this._lines.length; r++) {
          var o = this._lines[r];
          o.width > n && (n = o.width);
        }
        if (this._resizeToFit) {
          if (this._textWrapping === lf.Clip) {
            var s =
              (this.paddingLeftInPixels + this.paddingRightInPixels + n) | 0;
            s !== this._width.internalValue &&
              (this._width.updateInPlace(s, Zp.UNITMODE_PIXEL),
              (this._rebuildLayout = !0));
          }
          var a =
            (this.paddingTopInPixels +
              this.paddingBottomInPixels +
              this._fontOffset.height * this._lines.length) |
            0;
          if (this._lines.length > 0 && 0 !== this._lineSpacing.internalValue) {
            var l;
            (l = this._lineSpacing.isPixel
              ? this._lineSpacing.getValue(this._host)
              : this._lineSpacing.getValue(this._host) *
                this._height.getValueInPixel(
                  this._host,
                  this._cachedParentMeasure.height
                )),
              (a += (this._lines.length - 1) * l);
          }
          a !== this._height.internalValue &&
            (this._height.updateInPlace(a, Zp.UNITMODE_PIXEL),
            (this._rebuildLayout = !0));
        }
      }),
      (t.prototype._drawText = function (e, t, i, n) {
        var r = this._currentMeasure.width,
          o = 0;
        switch (this._textHorizontalAlignment) {
          case sf.HORIZONTAL_ALIGNMENT_LEFT:
            o = 0;
            break;
          case sf.HORIZONTAL_ALIGNMENT_RIGHT:
            o = r - t;
            break;
          case sf.HORIZONTAL_ALIGNMENT_CENTER:
            o = (r - t) / 2;
        }
        (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
          ((n.shadowColor = this.shadowColor),
          (n.shadowBlur = this.shadowBlur),
          (n.shadowOffsetX = this.shadowOffsetX),
          (n.shadowOffsetY = this.shadowOffsetY)),
          this.outlineWidth &&
            n.strokeText(e, this._currentMeasure.left + o, i),
          n.fillText(e, this._currentMeasure.left + o, i),
          this._underline &&
            (n.beginPath(),
            (n.lineWidth = Math.round(0.05 * this.fontSizeInPixels)),
            n.moveTo(this._currentMeasure.left + o, i + 3),
            n.lineTo(this._currentMeasure.left + o + t, i + 3),
            n.stroke(),
            n.closePath()),
          this._lineThrough &&
            (n.beginPath(),
            (n.lineWidth = Math.round(0.05 * this.fontSizeInPixels)),
            n.moveTo(
              this._currentMeasure.left + o,
              i - this.fontSizeInPixels / 3
            ),
            n.lineTo(
              this._currentMeasure.left + o + t,
              i - this.fontSizeInPixels / 3
            ),
            n.stroke(),
            n.closePath());
      }),
      (t.prototype._draw = function (e, t) {
        e.save(), this._applyStates(e), this._renderLines(e), e.restore();
      }),
      (t.prototype._applyStates = function (t) {
        e.prototype._applyStates.call(this, t),
          this.outlineWidth &&
            ((t.lineWidth = this.outlineWidth),
            (t.strokeStyle = this.outlineColor),
            (t.lineJoin = "miter"),
            (t.miterLimit = 2));
      }),
      (t.prototype._breakLines = function (e, t) {
        var i = [],
          n = this.text.split("\n");
        if (this._textWrapping === lf.Ellipsis)
          for (var r = 0, o = n; r < o.length; r++) {
            var s = o[r];
            i.push(this._parseLineEllipsis(s, e, t));
          }
        else if (this._textWrapping === lf.WordWrap)
          for (var a = 0, l = n; a < l.length; a++)
            (s = l[a]), i.push.apply(i, this._parseLineWordWrap(s, e, t));
        else
          for (var c = 0, u = n; c < u.length; c++)
            (s = u[c]), i.push(this._parseLine(s, t));
        return i;
      }),
      (t.prototype._parseLine = function (e, t) {
        return (
          void 0 === e && (e = ""),
          {
            text: e,
            width: t.measureText(e).width,
          }
        );
      }),
      (t.prototype._parseLineEllipsis = function (e, t, i) {
        void 0 === e && (e = "");
        var n = i.measureText(e).width;
        n > t && (e += "");
        var r = Array.from && Array.from(e);
        if (r)
          for (; r.length && n > t; )
            r.pop(), (e = r.join("") + "..."), (n = i.measureText(e).width);
        else
          for (; e.length > 2 && n > t; )
            (e = e.slice(0, -2) + ""), (n = i.measureText(e).width);
        return {
          text: e,
          width: n,
        };
      }),
      (t.prototype._parseLineWordWrap = function (e, t, i) {
        void 0 === e && (e = "");
        for (
          var n = [],
            r = this.wordSplittingFunction
              ? this.wordSplittingFunction(e)
              : e.split(" "),
            o = 0,
            s = 0;
          s < r.length;
          s++
        ) {
          var a = s > 0 ? e + " " + r[s] : r[0],
            l = i.measureText(a).width;
          l > t && s > 0
            ? (n.push({
                text: e,
                width: o,
              }),
              (e = r[s]),
              (o = i.measureText(e).width))
            : ((o = l), (e = a));
        }
        return (
          n.push({
            text: e,
            width: o,
          }),
          n
        );
      }),
      (t.prototype._renderLines = function (e) {
        var t = this._currentMeasure.height,
          i = 0;
        switch (this._textVerticalAlignment) {
          case sf.VERTICAL_ALIGNMENT_TOP:
            i = this._fontOffset.ascent;
            break;
          case sf.VERTICAL_ALIGNMENT_BOTTOM:
            i =
              t -
              this._fontOffset.height * (this._lines.length - 1) -
              this._fontOffset.descent;
            break;
          case sf.VERTICAL_ALIGNMENT_CENTER:
            i =
              this._fontOffset.ascent +
              (t - this._fontOffset.height * this._lines.length) / 2;
        }
        i += this._currentMeasure.top;
        for (var n = 0; n < this._lines.length; n++) {
          var r = this._lines[n];
          0 !== n &&
            0 !== this._lineSpacing.internalValue &&
            (this._lineSpacing.isPixel
              ? (i += this._lineSpacing.getValue(this._host))
              : (i +=
                  this._lineSpacing.getValue(this._host) *
                  this._height.getValueInPixel(
                    this._host,
                    this._cachedParentMeasure.height
                  ))),
            this._drawText(r.text, r.width, i, e),
            (i += this._fontOffset.height);
        }
      }),
      (t.prototype.computeExpectedHeight = function () {
        if (this.text && this.widthInPixels) {
          var e = document.createElement("canvas").getContext("2d");
          if (e) {
            this._applyStates(e),
              this._fontOffset ||
                (this._fontOffset = sf._GetFontOffset(e.font));
            var t = this._lines
                ? this._lines
                : this._breakLines(
                    this.widthInPixels -
                      this.paddingLeftInPixels -
                      this.paddingRightInPixels,
                    e
                  ),
              i =
                this.paddingTopInPixels +
                this.paddingBottomInPixels +
                this._fontOffset.height * t.length;
            if (t.length > 0 && 0 !== this._lineSpacing.internalValue) {
              var n;
              (n = this._lineSpacing.isPixel
                ? this._lineSpacing.getValue(this._host)
                : this._lineSpacing.getValue(this._host) *
                  this._height.getValueInPixel(
                    this._host,
                    this._cachedParentMeasure.height
                  )),
                (i += (t.length - 1) * n);
            }
            return i;
          }
        }
        return 0;
      }),
      (t.prototype.dispose = function () {
        e.prototype.dispose.call(this), this.onTextChangedObservable.clear();
      }),
      t
    );
  })(sf);
  h.RegisteredTypes["BABYLON.GUI.TextBlock"] = uf;
  var hf = (function (e) {
    function t(i, n) {
      void 0 === n && (n = null);
      var r = e.call(this, i) || this;
      return (
        (r.name = i),
        (r._workingCanvas = null),
        (r._loaded = !1),
        (r._stretch = t.STRETCH_FILL),
        (r._autoScale = !1),
        (r._sourceLeft = 0),
        (r._sourceTop = 0),
        (r._sourceWidth = 0),
        (r._sourceHeight = 0),
        (r._svgAttributesComputationCompleted = !1),
        (r._isSVG = !1),
        (r._cellWidth = 0),
        (r._cellHeight = 0),
        (r._cellId = -1),
        (r._populateNinePatchSlicesFromImage = !1),
        (r._imageDataCache = {
          data: null,
          key: "",
        }),
        (r.onImageLoadedObservable = new o()),
        (r.onSVGAttributesComputedObservable = new o()),
        (r.source = n),
        r
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "isLoaded", {
        get: function () {
          return this._loaded;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "populateNinePatchSlicesFromImage", {
        get: function () {
          return this._populateNinePatchSlicesFromImage;
        },
        set: function (e) {
          this._populateNinePatchSlicesFromImage !== e &&
            ((this._populateNinePatchSlicesFromImage = e),
            this._populateNinePatchSlicesFromImage &&
              this._loaded &&
              this._extractNinePatchSliceDataFromImage());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "detectPointerOnOpaqueOnly", {
        get: function () {
          return this._detectPointerOnOpaqueOnly;
        },
        set: function (e) {
          this._detectPointerOnOpaqueOnly !== e &&
            (this._detectPointerOnOpaqueOnly = e);
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "sliceLeft", {
        get: function () {
          return this._sliceLeft;
        },
        set: function (e) {
          this._sliceLeft !== e && ((this._sliceLeft = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "sliceRight", {
        get: function () {
          return this._sliceRight;
        },
        set: function (e) {
          this._sliceRight !== e &&
            ((this._sliceRight = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "sliceTop", {
        get: function () {
          return this._sliceTop;
        },
        set: function (e) {
          this._sliceTop !== e && ((this._sliceTop = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "sliceBottom", {
        get: function () {
          return this._sliceBottom;
        },
        set: function (e) {
          this._sliceBottom !== e &&
            ((this._sliceBottom = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "sourceLeft", {
        get: function () {
          return this._sourceLeft;
        },
        set: function (e) {
          this._sourceLeft !== e &&
            ((this._sourceLeft = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "sourceTop", {
        get: function () {
          return this._sourceTop;
        },
        set: function (e) {
          this._sourceTop !== e && ((this._sourceTop = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "sourceWidth", {
        get: function () {
          return this._sourceWidth;
        },
        set: function (e) {
          this._sourceWidth !== e &&
            ((this._sourceWidth = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "sourceHeight", {
        get: function () {
          return this._sourceHeight;
        },
        set: function (e) {
          this._sourceHeight !== e &&
            ((this._sourceHeight = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "isSVG", {
        get: function () {
          return this._isSVG;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "svgAttributesComputationCompleted", {
        get: function () {
          return this._svgAttributesComputationCompleted;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "autoScale", {
        get: function () {
          return this._autoScale;
        },
        set: function (e) {
          this._autoScale !== e &&
            ((this._autoScale = e),
            e && this._loaded && this.synchronizeSizeWithContent());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "stretch", {
        get: function () {
          return this._stretch;
        },
        set: function (e) {
          this._stretch !== e && ((this._stretch = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._rotate90 = function (e, i) {
        void 0 === i && (i = !1);
        var n = document.createElement("canvas"),
          r = n.getContext("2d"),
          o = this._domImage.width,
          s = this._domImage.height;
        (n.width = s),
          (n.height = o),
          r.translate(n.width / 2, n.height / 2),
          r.rotate((e * Math.PI) / 2),
          r.drawImage(this._domImage, 0, 0, o, s, -o / 2, -s / 2, o, s);
        var a = n.toDataURL("image/jpg"),
          l = new t(this.name + "rotated", a);
        return (
          i &&
            ((l._stretch = this._stretch),
            (l._autoScale = this._autoScale),
            (l._cellId = this._cellId),
            (l._cellWidth = e % 1 ? this._cellHeight : this._cellWidth),
            (l._cellHeight = e % 1 ? this._cellWidth : this._cellHeight)),
          this._handleRotationForSVGImage(this, l, e),
          (this._imageDataCache.data = null),
          l
        );
      }),
      (t.prototype._handleRotationForSVGImage = function (e, t, i) {
        var n = this;
        e._isSVG &&
          (e._svgAttributesComputationCompleted
            ? (this._rotate90SourceProperties(e, t, i), this._markAsDirty())
            : e.onSVGAttributesComputedObservable.addOnce(function () {
                n._rotate90SourceProperties(e, t, i), n._markAsDirty();
              }));
      }),
      (t.prototype._rotate90SourceProperties = function (e, t, i) {
        var n,
          r,
          o = e.sourceLeft,
          s = e.sourceTop,
          a = e.domImage.width,
          l = e.domImage.height,
          c = o,
          u = s,
          h = e.sourceWidth,
          d = e.sourceHeight;
        if (0 != i) {
          var p = i < 0 ? -1 : 1;
          i %= 4;
          for (var f = 0; f < Math.abs(i); ++f)
            (c = -(s - l / 2) * p + l / 2),
              (u = (o - a / 2) * p + a / 2),
              (h = (n = [d, h])[0]),
              (d = n[1]),
              i < 0 ? (u -= d) : (c -= h),
              (o = c),
              (s = u),
              (a = (r = [l, a])[0]),
              (l = r[1]);
        }
        (t.sourceLeft = c),
          (t.sourceTop = u),
          (t.sourceWidth = h),
          (t.sourceHeight = d);
      }),
      Object.defineProperty(t.prototype, "domImage", {
        get: function () {
          return this._domImage;
        },
        set: function (e) {
          var t = this;
          (this._domImage = e),
            (this._loaded = !1),
            (this._imageDataCache.data = null),
            this._domImage.width
              ? this._onImageLoaded()
              : (this._domImage.onload = function () {
                  t._onImageLoaded();
                });
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._onImageLoaded = function () {
        (this._imageDataCache.data = null),
          (this._imageWidth = this._domImage.width),
          (this._imageHeight = this._domImage.height),
          (this._loaded = !0),
          this._populateNinePatchSlicesFromImage &&
            this._extractNinePatchSliceDataFromImage(),
          this._autoScale && this.synchronizeSizeWithContent(),
          this.onImageLoadedObservable.notifyObservers(this),
          this._markAsDirty();
      }),
      (t.prototype._extractNinePatchSliceDataFromImage = function () {
        this._workingCanvas ||
          (this._workingCanvas = document.createElement("canvas"));
        var e = this._workingCanvas,
          t = e.getContext("2d"),
          i = this._domImage.width,
          n = this._domImage.height;
        (e.width = i), (e.height = n), t.drawImage(this._domImage, 0, 0, i, n);
        var r = t.getImageData(0, 0, i, n);
        (this._sliceLeft = -1), (this._sliceRight = -1);
        for (var o = 0; o < i; o++)
          if ((a = r.data[4 * o + 3]) > 127 && -1 === this._sliceLeft)
            this._sliceLeft = o;
          else if (a < 127 && this._sliceLeft > -1) {
            this._sliceRight = o;
            break;
          }
        (this._sliceTop = -1), (this._sliceBottom = -1);
        for (var s = 0; s < n; s++) {
          var a;
          if ((a = r.data[s * i * 4 + 3]) > 127 && -1 === this._sliceTop)
            this._sliceTop = s;
          else if (a < 127 && this._sliceTop > -1) {
            this._sliceBottom = s;
            break;
          }
        }
      }),
      Object.defineProperty(t.prototype, "source", {
        set: function (e) {
          var t = this;
          this._source !== e &&
            ((this._loaded = !1),
            (this._source = e),
            (this._imageDataCache.data = null),
            e && (e = this._svgCheck(e)),
            (this._domImage = document.createElement("img")),
            (this._domImage.onload = function () {
              t._onImageLoaded();
            }),
            e &&
              (yt.SetCorsBehavior(e, this._domImage),
              (this._domImage.src = e)));
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._svgCheck = function (e) {
        var t = this;
        if (
          window.SVGSVGElement &&
          -1 !== e.search(/.svg#/gi) &&
          e.indexOf("#") === e.lastIndexOf("#")
        ) {
          this._isSVG = !0;
          var i = e.split("#")[0],
            n = e.split("#")[1],
            r = document.body.querySelector('object[data="' + i + '"]');
          if (r) {
            var o = r.contentDocument;
            if (o && o.documentElement) {
              var s = o.documentElement.getAttribute("viewBox"),
                a = Number(o.documentElement.getAttribute("width")),
                l = Number(o.documentElement.getAttribute("height"));
              if (o.getElementById(n) && s && a && l)
                return this._getSVGAttribs(r, n), e;
            }
            r.addEventListener("load", function () {
              t._getSVGAttribs(r, n);
            });
          } else {
            var c = document.createElement("object");
            (c.data = i),
              (c.type = "image/svg+xml"),
              (c.width = "0%"),
              (c.height = "0%"),
              document.body.appendChild(c),
              (c.onload = function () {
                var e = document.body.querySelector('object[data="' + i + '"]');
                e && t._getSVGAttribs(e, n);
              });
          }
          return i;
        }
        return e;
      }),
      (t.prototype._getSVGAttribs = function (e, t) {
        var i = e.contentDocument;
        if (i && i.documentElement) {
          var n = i.documentElement.getAttribute("viewBox"),
            r = Number(i.documentElement.getAttribute("width")),
            o = Number(i.documentElement.getAttribute("height")),
            s = i.getElementById(t);
          if (n && r && o && s) {
            var a = Number(n.split(" ")[2]),
              l = Number(n.split(" ")[3]),
              c = s.getBBox(),
              u = 1,
              h = 1,
              d = 0,
              p = 0;
            s.transform &&
              s.transform.baseVal.consolidate() &&
              ((u = s.transform.baseVal.consolidate().matrix.a),
              (h = s.transform.baseVal.consolidate().matrix.d),
              (d = s.transform.baseVal.consolidate().matrix.e),
              (p = s.transform.baseVal.consolidate().matrix.f)),
              (this.sourceLeft = ((u * c.x + d) * r) / a),
              (this.sourceTop = ((h * c.y + p) * o) / l),
              (this.sourceWidth = c.width * u * (r / a)),
              (this.sourceHeight = c.height * h * (o / l)),
              (this._svgAttributesComputationCompleted = !0),
              this.onSVGAttributesComputedObservable.notifyObservers(this);
          }
        }
      }),
      Object.defineProperty(t.prototype, "cellWidth", {
        get: function () {
          return this._cellWidth;
        },
        set: function (e) {
          this._cellWidth !== e && ((this._cellWidth = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "cellHeight", {
        get: function () {
          return this._cellHeight;
        },
        set: function (e) {
          this._cellHeight !== e &&
            ((this._cellHeight = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "cellId", {
        get: function () {
          return this._cellId;
        },
        set: function (e) {
          this._cellId !== e && ((this._cellId = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.contains = function (t, i) {
        if (!e.prototype.contains.call(this, t, i)) return !1;
        if (!this._detectPointerOnOpaqueOnly || !this._workingCanvas) return !0;
        var n = 0 | this._currentMeasure.width,
          r = 0 | this._currentMeasure.height,
          o = n + "_" + r,
          s = this._imageDataCache.data;
        if (!s || this._imageDataCache.key !== o) {
          var a = this._workingCanvas.getContext("2d");
          (this._imageDataCache.data = s = a.getImageData(0, 0, n, r).data),
            (this._imageDataCache.key = o);
        }
        return (
          s[
            4 *
              ((t = (t - this._currentMeasure.left) | 0) +
                (i = (i - this._currentMeasure.top) | 0) * n) +
              3
          ] > 0
        );
      }),
      (t.prototype._getTypeName = function () {
        return "Image";
      }),
      (t.prototype.synchronizeSizeWithContent = function () {
        this._loaded &&
          ((this.width = this._domImage.width + "px"),
          (this.height = this._domImage.height + "px"));
      }),
      (t.prototype._processMeasures = function (i, n) {
        if (this._loaded)
          switch (this._stretch) {
            case t.STRETCH_NONE:
            case t.STRETCH_FILL:
            case t.STRETCH_UNIFORM:
            case t.STRETCH_NINE_PATCH:
              break;
            case t.STRETCH_EXTEND:
              this._autoScale && this.synchronizeSizeWithContent(),
                this.parent &&
                  this.parent.parent &&
                  ((this.parent.adaptWidthToChildren = !0),
                  (this.parent.adaptHeightToChildren = !0));
          }
        e.prototype._processMeasures.call(this, i, n);
      }),
      (t.prototype._prepareWorkingCanvasForOpaqueDetection = function () {
        if (this._detectPointerOnOpaqueOnly) {
          this._workingCanvas ||
            (this._workingCanvas = document.createElement("canvas"));
          var e = this._workingCanvas,
            t = this._currentMeasure.width,
            i = this._currentMeasure.height,
            n = e.getContext("2d");
          (e.width = t), (e.height = i), n.clearRect(0, 0, t, i);
        }
      }),
      (t.prototype._drawImage = function (e, t, i, n, r, o, s, a, l) {
        e.drawImage(this._domImage, t, i, n, r, o, s, a, l),
          this._detectPointerOnOpaqueOnly &&
            (e = this._workingCanvas.getContext("2d")).drawImage(
              this._domImage,
              t,
              i,
              n,
              r,
              o - this._currentMeasure.left,
              s - this._currentMeasure.top,
              a,
              l
            );
      }),
      (t.prototype._draw = function (e) {
        var i, n, r, o;
        if (
          (e.save(),
          (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
            ((e.shadowColor = this.shadowColor),
            (e.shadowBlur = this.shadowBlur),
            (e.shadowOffsetX = this.shadowOffsetX),
            (e.shadowOffsetY = this.shadowOffsetY)),
          -1 == this.cellId)
        )
          (i = this._sourceLeft),
            (n = this._sourceTop),
            (r = this._sourceWidth ? this._sourceWidth : this._imageWidth),
            (o = this._sourceHeight ? this._sourceHeight : this._imageHeight);
        else {
          var s = this._domImage.naturalWidth / this.cellWidth,
            a = (this.cellId / s) >> 0,
            l = this.cellId % s;
          (i = this.cellWidth * l),
            (n = this.cellHeight * a),
            (r = this.cellWidth),
            (o = this.cellHeight);
        }
        if (
          (this._prepareWorkingCanvasForOpaqueDetection(),
          this._applyStates(e),
          this._loaded)
        )
          switch (this._stretch) {
            case t.STRETCH_NONE:
            case t.STRETCH_FILL:
              this._drawImage(
                e,
                i,
                n,
                r,
                o,
                this._currentMeasure.left,
                this._currentMeasure.top,
                this._currentMeasure.width,
                this._currentMeasure.height
              );
              break;
            case t.STRETCH_UNIFORM:
              var c = this._currentMeasure.width / r,
                u = this._currentMeasure.height / o,
                h = Math.min(c, u),
                d = (this._currentMeasure.width - r * h) / 2,
                p = (this._currentMeasure.height - o * h) / 2;
              this._drawImage(
                e,
                i,
                n,
                r,
                o,
                this._currentMeasure.left + d,
                this._currentMeasure.top + p,
                r * h,
                o * h
              );
              break;
            case t.STRETCH_EXTEND:
              this._drawImage(
                e,
                i,
                n,
                r,
                o,
                this._currentMeasure.left,
                this._currentMeasure.top,
                this._currentMeasure.width,
                this._currentMeasure.height
              );
              break;
            case t.STRETCH_NINE_PATCH:
              this._renderNinePatch(e);
          }
        e.restore();
      }),
      (t.prototype._renderCornerPatch = function (e, t, i, n, r, o, s) {
        this._drawImage(
          e,
          t,
          i,
          n,
          r,
          this._currentMeasure.left + o,
          this._currentMeasure.top + s,
          n,
          r
        );
      }),
      (t.prototype._renderNinePatch = function (e) {
        var t = this._imageHeight,
          i = this._sliceLeft,
          n = this._sliceTop,
          r = this._imageHeight - this._sliceBottom,
          o = this._imageWidth - this._sliceRight,
          s = 0,
          a = 0;
        this._populateNinePatchSlicesFromImage &&
          ((s = 1), (a = 1), (t -= 2), (i -= 1), (n -= 1), (r -= 1), (o -= 1));
        var l = this._sliceRight - this._sliceLeft,
          c = this._currentMeasure.width - o - this.sliceLeft,
          u = this._currentMeasure.height - t + this._sliceBottom;
        this._renderCornerPatch(e, s, a, i, n, 0, 0),
          this._renderCornerPatch(
            e,
            s,
            this._sliceBottom,
            i,
            t - this._sliceBottom,
            0,
            u
          ),
          this._renderCornerPatch(
            e,
            this._sliceRight,
            a,
            o,
            n,
            this._currentMeasure.width - o,
            0
          ),
          this._renderCornerPatch(
            e,
            this._sliceRight,
            this._sliceBottom,
            o,
            t - this._sliceBottom,
            this._currentMeasure.width - o,
            u
          ),
          this._drawImage(
            e,
            this._sliceLeft,
            this._sliceTop,
            l,
            this._sliceBottom - this._sliceTop,
            this._currentMeasure.left + i,
            this._currentMeasure.top + n,
            c,
            u - n
          ),
          this._drawImage(
            e,
            s,
            this._sliceTop,
            i,
            this._sliceBottom - this._sliceTop,
            this._currentMeasure.left,
            this._currentMeasure.top + n,
            i,
            u - n
          ),
          this._drawImage(
            e,
            this._sliceRight,
            this._sliceTop,
            i,
            this._sliceBottom - this._sliceTop,
            this._currentMeasure.left + this._currentMeasure.width - o,
            this._currentMeasure.top + n,
            i,
            u - n
          ),
          this._drawImage(
            e,
            this._sliceLeft,
            a,
            l,
            n,
            this._currentMeasure.left + i,
            this._currentMeasure.top,
            c,
            n
          ),
          this._drawImage(
            e,
            this._sliceLeft,
            this._sliceBottom,
            l,
            r,
            this._currentMeasure.left + i,
            this._currentMeasure.top + u,
            c,
            r
          );
      }),
      (t.prototype.dispose = function () {
        e.prototype.dispose.call(this),
          this.onImageLoadedObservable.clear(),
          this.onSVGAttributesComputedObservable.clear();
      }),
      (t.STRETCH_NONE = 0),
      (t.STRETCH_FILL = 1),
      (t.STRETCH_UNIFORM = 2),
      (t.STRETCH_EXTEND = 3),
      (t.STRETCH_NINE_PATCH = 4),
      t
    );
  })(sf);
  h.RegisteredTypes["BABYLON.GUI.Image"] = hf;
  var df = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      (i.name = t),
        (i.delegatePickingToChildren = !1),
        (i.thickness = 1),
        (i.isPointerBlocker = !0);
      var n = null;
      return (
        (i.pointerEnterAnimation = function () {
          (n = i.alpha), (i.alpha -= 0.1);
        }),
        (i.pointerOutAnimation = function () {
          null !== n && (i.alpha = n);
        }),
        (i.pointerDownAnimation = function () {
          (i.scaleX -= 0.05), (i.scaleY -= 0.05);
        }),
        (i.pointerUpAnimation = function () {
          (i.scaleX += 0.05), (i.scaleY += 0.05);
        }),
        i
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "image", {
        get: function () {
          return this._image;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "textBlock", {
        get: function () {
          return this._textBlock;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._getTypeName = function () {
        return "Button";
      }),
      (t.prototype._processPicking = function (t, i, n, r, o, s, a, l) {
        if (
          !this._isEnabled ||
          !this.isHitTestVisible ||
          !this.isVisible ||
          this.notRenderable
        )
          return !1;
        if (!e.prototype.contains.call(this, t, i)) return !1;
        if (this.delegatePickingToChildren) {
          for (var c = !1, u = this._children.length - 1; u >= 0; u--) {
            var h = this._children[u];
            if (
              h.isEnabled &&
              h.isHitTestVisible &&
              h.isVisible &&
              !h.notRenderable &&
              h.contains(t, i)
            ) {
              c = !0;
              break;
            }
          }
          if (!c) return !1;
        }
        return this._processObservables(r, t, i, n, o, s, a, l), !0;
      }),
      (t.prototype._onPointerEnter = function (t, i) {
        return (
          !!e.prototype._onPointerEnter.call(this, t, i) &&
          (this.pointerEnterAnimation && this.pointerEnterAnimation(), !0)
        );
      }),
      (t.prototype._onPointerOut = function (t, i, n) {
        void 0 === n && (n = !1),
          this.pointerOutAnimation && this.pointerOutAnimation(),
          e.prototype._onPointerOut.call(this, t, i, n);
      }),
      (t.prototype._onPointerDown = function (t, i, n, r, o) {
        return (
          !!e.prototype._onPointerDown.call(this, t, i, n, r, o) &&
          (this.pointerDownAnimation && this.pointerDownAnimation(), !0)
        );
      }),
      (t.prototype._onPointerUp = function (t, i, n, r, o, s) {
        this.pointerUpAnimation && this.pointerUpAnimation(),
          e.prototype._onPointerUp.call(this, t, i, n, r, o, s);
      }),
      (t.CreateImageButton = function (e, i, n) {
        var r = new t(e),
          o = new uf(e + "_button", i);
        (o.textWrapping = !0),
          (o.textHorizontalAlignment = sf.HORIZONTAL_ALIGNMENT_CENTER),
          (o.paddingLeft = "20%"),
          r.addControl(o);
        var s = new hf(e + "_icon", n);
        return (
          (s.width = "20%"),
          (s.stretch = hf.STRETCH_UNIFORM),
          (s.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
          r.addControl(s),
          (r._image = s),
          (r._textBlock = o),
          r
        );
      }),
      (t.CreateImageOnlyButton = function (e, i) {
        var n = new t(e),
          r = new hf(e + "_icon", i);
        return (
          (r.stretch = hf.STRETCH_FILL),
          (r.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
          n.addControl(r),
          (n._image = r),
          n
        );
      }),
      (t.CreateSimpleButton = function (e, i) {
        var n = new t(e),
          r = new uf(e + "_button", i);
        return (
          (r.textWrapping = !0),
          (r.textHorizontalAlignment = sf.HORIZONTAL_ALIGNMENT_CENTER),
          n.addControl(r),
          (n._textBlock = r),
          n
        );
      }),
      (t.CreateImageWithCenterTextButton = function (e, i, n) {
        var r = new t(e),
          o = new hf(e + "_icon", n);
        (o.stretch = hf.STRETCH_FILL), r.addControl(o);
        var s = new uf(e + "_button", i);
        return (
          (s.textWrapping = !0),
          (s.textHorizontalAlignment = sf.HORIZONTAL_ALIGNMENT_CENTER),
          r.addControl(s),
          (r._image = o),
          (r._textBlock = s),
          r
        );
      }),
      t
    );
  })(cf);
  h.RegisteredTypes["BABYLON.GUI.Button"] = df;
  var pf = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      return (
        (i.name = t),
        (i._isVertical = !0),
        (i._manualWidth = !1),
        (i._manualHeight = !1),
        (i._doNotTrackManualChanges = !1),
        (i.ignoreLayoutWarnings = !1),
        i
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "isVertical", {
        get: function () {
          return this._isVertical;
        },
        set: function (e) {
          this._isVertical !== e &&
            ((this._isVertical = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "width", {
        get: function () {
          return this._width.toString(this._host);
        },
        set: function (e) {
          this._doNotTrackManualChanges || (this._manualWidth = !0),
            this._width.toString(this._host) !== e &&
              this._width.fromString(e) &&
              this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "height", {
        get: function () {
          return this._height.toString(this._host);
        },
        set: function (e) {
          this._doNotTrackManualChanges || (this._manualHeight = !0),
            this._height.toString(this._host) !== e &&
              this._height.fromString(e) &&
              this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._getTypeName = function () {
        return "StackPanel";
      }),
      (t.prototype._preMeasure = function (t, i) {
        for (var n = 0, r = this._children; n < r.length; n++) {
          var o = r[n];
          this._isVertical
            ? (o.verticalAlignment = sf.VERTICAL_ALIGNMENT_TOP)
            : (o.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT);
        }
        e.prototype._preMeasure.call(this, t, i);
      }),
      (t.prototype._additionalProcessing = function (t, i) {
        e.prototype._additionalProcessing.call(this, t, i),
          this._measureForChildren.copyFrom(t),
          (this._measureForChildren.left = this._currentMeasure.left),
          (this._measureForChildren.top = this._currentMeasure.top),
          (this.isVertical && !this._manualWidth) ||
            (this._measureForChildren.width = this._currentMeasure.width),
          (this.isVertical || this._manualHeight) &&
            (this._measureForChildren.height = this._currentMeasure.height);
      }),
      (t.prototype._postMeasure = function () {
        for (var t = 0, i = 0, n = 0, r = this._children; n < r.length; n++) {
          var o = r[n];
          o.isVisible &&
            !o.notRenderable &&
            (this._isVertical
              ? (o.top !== i + "px" &&
                  ((o.top = i + "px"),
                  (this._rebuildLayout = !0),
                  (o._top.ignoreAdaptiveScaling = !0)),
                o._height.isPercentage && !o._automaticSize
                  ? this.ignoreLayoutWarnings ||
                    yt.Warn(
                      "Control (Name:" +
                        o.name +
                        ", UniqueId:" +
                        o.uniqueId +
                        ") is using height in percentage mode inside a vertical StackPanel"
                    )
                  : (i +=
                      o._currentMeasure.height +
                      o.paddingTopInPixels +
                      o.paddingBottomInPixels))
              : (o.left !== t + "px" &&
                  ((o.left = t + "px"),
                  (this._rebuildLayout = !0),
                  (o._left.ignoreAdaptiveScaling = !0)),
                o._width.isPercentage && !o._automaticSize
                  ? this.ignoreLayoutWarnings ||
                    yt.Warn(
                      "Control (Name:" +
                        o.name +
                        ", UniqueId:" +
                        o.uniqueId +
                        ") is using width in percentage mode inside a horizontal StackPanel"
                    )
                  : (t +=
                      o._currentMeasure.width +
                      o.paddingLeftInPixels +
                      o.paddingRightInPixels)));
        }
        (t += this.paddingLeftInPixels + this.paddingRightInPixels),
          (i += this.paddingTopInPixels + this.paddingBottomInPixels),
          (this._doNotTrackManualChanges = !0);
        var s = !1,
          a = !1;
        if (!this._manualHeight && this._isVertical) {
          var l = this.height;
          (this.height = i + "px"),
            (a = l !== this.height || !this._height.ignoreAdaptiveScaling);
        }
        if (!this._manualWidth && !this._isVertical) {
          var c = this.width;
          (this.width = t + "px"),
            (s = c !== this.width || !this._width.ignoreAdaptiveScaling);
        }
        a && (this._height.ignoreAdaptiveScaling = !0),
          s && (this._width.ignoreAdaptiveScaling = !0),
          (this._doNotTrackManualChanges = !1),
          (s || a) && (this._rebuildLayout = !0),
          e.prototype._postMeasure.call(this);
      }),
      t
    );
  })(af);
  h.RegisteredTypes["BABYLON.GUI.StackPanel"] = pf;
  var ff = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      return (
        (i.name = t),
        (i._isChecked = !1),
        (i._background = "black"),
        (i._checkSizeRatio = 0.8),
        (i._thickness = 1),
        (i.onIsCheckedChangedObservable = new o()),
        (i.isPointerBlocker = !0),
        i
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "thickness", {
        get: function () {
          return this._thickness;
        },
        set: function (e) {
          this._thickness !== e && ((this._thickness = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "checkSizeRatio", {
        get: function () {
          return this._checkSizeRatio;
        },
        set: function (e) {
          (e = Math.max(Math.min(1, e), 0)),
            this._checkSizeRatio !== e &&
              ((this._checkSizeRatio = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "background", {
        get: function () {
          return this._background;
        },
        set: function (e) {
          this._background !== e &&
            ((this._background = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "isChecked", {
        get: function () {
          return this._isChecked;
        },
        set: function (e) {
          this._isChecked !== e &&
            ((this._isChecked = e),
            this._markAsDirty(),
            this.onIsCheckedChangedObservable.notifyObservers(e));
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._getTypeName = function () {
        return "Checkbox";
      }),
      (t.prototype._draw = function (e, t) {
        e.save(), this._applyStates(e);
        var i = this._currentMeasure.width - this._thickness,
          n = this._currentMeasure.height - this._thickness;
        if (
          ((this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
            ((e.shadowColor = this.shadowColor),
            (e.shadowBlur = this.shadowBlur),
            (e.shadowOffsetX = this.shadowOffsetX),
            (e.shadowOffsetY = this.shadowOffsetY)),
          (e.fillStyle = this._isEnabled
            ? this._background
            : this._disabledColor),
          e.fillRect(
            this._currentMeasure.left + this._thickness / 2,
            this._currentMeasure.top + this._thickness / 2,
            i,
            n
          ),
          (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
            ((e.shadowBlur = 0), (e.shadowOffsetX = 0), (e.shadowOffsetY = 0)),
          this._isChecked)
        ) {
          e.fillStyle = this._isEnabled ? this.color : this._disabledColorItem;
          var r = i * this._checkSizeRatio,
            o = n * this._checkSizeRatio;
          e.fillRect(
            this._currentMeasure.left + this._thickness / 2 + (i - r) / 2,
            this._currentMeasure.top + this._thickness / 2 + (n - o) / 2,
            r,
            o
          );
        }
        (e.strokeStyle = this.color),
          (e.lineWidth = this._thickness),
          e.strokeRect(
            this._currentMeasure.left + this._thickness / 2,
            this._currentMeasure.top + this._thickness / 2,
            i,
            n
          ),
          e.restore();
      }),
      (t.prototype._onPointerDown = function (t, i, n, r, o) {
        return (
          !!e.prototype._onPointerDown.call(this, t, i, n, r, o) &&
          ((this.isChecked = !this.isChecked), !0)
        );
      }),
      (t.AddCheckBoxWithHeader = function (e, i) {
        var n = new pf();
        (n.isVertical = !1), (n.height = "30px");
        var r = new t();
        (r.width = "20px"),
          (r.height = "20px"),
          (r.isChecked = !0),
          (r.color = "green"),
          r.onIsCheckedChangedObservable.add(i),
          n.addControl(r);
        var o = new uf();
        return (
          (o.text = e),
          (o.width = "180px"),
          (o.paddingLeft = "5px"),
          (o.textHorizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
          (o.color = "white"),
          n.addControl(o),
          n
        );
      }),
      t
    );
  })(sf);
  h.RegisteredTypes["BABYLON.GUI.Checkbox"] = ff;
  var _f = (function () {
      function e() {}
      return (
        Object.defineProperty(e.prototype, "text", {
          get: function () {
            return this._characters ? this._characters.join("") : this._text;
          },
          set: function (e) {
            (this._text = e), (this._characters = Array.from && Array.from(e));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "length", {
          get: function () {
            return this._characters
              ? this._characters.length
              : this._text.length;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.removePart = function (e, t, i) {
          var n;
          if (
            ((this._text =
              this._text.slice(0, e) + (i || "") + this._text.slice(t)),
            this._characters)
          ) {
            var r = i ? Array.from(i) : [];
            (n = this._characters).splice.apply(n, I([e, t - e], r));
          }
        }),
        (e.prototype.charAt = function (e) {
          return this._characters ? this._characters[e] : this._text.charAt(e);
        }),
        (e.prototype.substr = function (e, t) {
          if (this._characters) {
            (e = isNaN(e)
              ? 0
              : e >= 0
                ? Math.min(e, this._characters.length)
                : this._characters.length +
                  Math.max(e, -this._characters.length)),
              void 0 === t
                ? (t = this._characters.length - e)
                : (isNaN(t) || t < 0) && (t = 0);
            for (var i = []; --t >= 0; ) i[t] = this._characters[e + t];
            return i.join("");
          }
          return this._text.substr(e, t);
        }),
        (e.prototype.substring = function (e, t) {
          if (this._characters) {
            isNaN(e)
              ? (e = 0)
              : e > this._characters.length
                ? (e = this._characters.length)
                : e < 0 && (e = 0),
              void 0 === t
                ? (t = this._characters.length)
                : isNaN(t)
                  ? (t = 0)
                  : t > this._characters.length
                    ? (t = this._characters.length)
                    : t < 0 && (t = 0);
            for (var i = [], n = 0; e < t; ) i[n++] = this._characters[e++];
            return i.join("");
          }
          return this._text.substring(e, t);
        }),
        (e.prototype.isWord = function (e) {
          var t = /\w/g;
          return this._characters
            ? -1 !== this._characters[e].search(t)
            : -1 !== this._text.search(t);
        }),
        e
      );
    })(),
    mf = (function (e) {
      function t(t, i) {
        void 0 === i && (i = "");
        var n = e.call(this, t) || this;
        return (
          (n.name = t),
          (n._placeholderText = ""),
          (n._background = "#222222"),
          (n._focusedBackground = "#000000"),
          (n._focusedColor = "white"),
          (n._placeholderColor = "gray"),
          (n._thickness = 1),
          (n._margin = new Zp(10, Zp.UNITMODE_PIXEL)),
          (n._autoStretchWidth = !0),
          (n._maxWidth = new Zp(1, Zp.UNITMODE_PERCENTAGE, !1)),
          (n._isFocused = !1),
          (n._blinkIsEven = !1),
          (n._cursorOffset = 0),
          (n._deadKey = !1),
          (n._addKey = !0),
          (n._currentKey = ""),
          (n._isTextHighlightOn = !1),
          (n._textHighlightColor = "#d5e0ff"),
          (n._highligherOpacity = 0.4),
          (n._highlightedText = ""),
          (n._startHighlightIndex = 0),
          (n._endHighlightIndex = 0),
          (n._cursorIndex = -1),
          (n._onFocusSelectAll = !1),
          (n._isPointerDown = !1),
          (n.promptMessage = "Please enter text:"),
          (n.disableMobilePrompt = !1),
          (n.onTextChangedObservable = new o()),
          (n.onBeforeKeyAddObservable = new o()),
          (n.onFocusObservable = new o()),
          (n.onBlurObservable = new o()),
          (n.onTextHighlightObservable = new o()),
          (n.onTextCopyObservable = new o()),
          (n.onTextCutObservable = new o()),
          (n.onTextPasteObservable = new o()),
          (n.onKeyboardEventProcessedObservable = new o()),
          (n.text = i),
          (n.isPointerBlocker = !0),
          n
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "maxWidth", {
          get: function () {
            return this._maxWidth.toString(this._host);
          },
          set: function (e) {
            this._maxWidth.toString(this._host) !== e &&
              this._maxWidth.fromString(e) &&
              this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "maxWidthInPixels", {
          get: function () {
            return this._maxWidth.getValueInPixel(
              this._host,
              this._cachedParentMeasure.width
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "highligherOpacity", {
          get: function () {
            return this._highligherOpacity;
          },
          set: function (e) {
            this._highligherOpacity !== e &&
              ((this._highligherOpacity = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "onFocusSelectAll", {
          get: function () {
            return this._onFocusSelectAll;
          },
          set: function (e) {
            this._onFocusSelectAll !== e &&
              ((this._onFocusSelectAll = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "textHighlightColor", {
          get: function () {
            return this._textHighlightColor;
          },
          set: function (e) {
            this._textHighlightColor !== e &&
              ((this._textHighlightColor = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "margin", {
          get: function () {
            return this._margin.toString(this._host);
          },
          set: function (e) {
            this._margin.toString(this._host) !== e &&
              this._margin.fromString(e) &&
              this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "marginInPixels", {
          get: function () {
            return this._margin.getValueInPixel(
              this._host,
              this._cachedParentMeasure.width
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "autoStretchWidth", {
          get: function () {
            return this._autoStretchWidth;
          },
          set: function (e) {
            this._autoStretchWidth !== e &&
              ((this._autoStretchWidth = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "thickness", {
          get: function () {
            return this._thickness;
          },
          set: function (e) {
            this._thickness !== e &&
              ((this._thickness = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "focusedBackground", {
          get: function () {
            return this._focusedBackground;
          },
          set: function (e) {
            this._focusedBackground !== e &&
              ((this._focusedBackground = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "focusedColor", {
          get: function () {
            return this._focusedColor;
          },
          set: function (e) {
            this._focusedColor !== e &&
              ((this._focusedColor = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "background", {
          get: function () {
            return this._background;
          },
          set: function (e) {
            this._background !== e &&
              ((this._background = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "placeholderColor", {
          get: function () {
            return this._placeholderColor;
          },
          set: function (e) {
            this._placeholderColor !== e &&
              ((this._placeholderColor = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "placeholderText", {
          get: function () {
            return this._placeholderText;
          },
          set: function (e) {
            this._placeholderText !== e &&
              ((this._placeholderText = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "deadKey", {
          get: function () {
            return this._deadKey;
          },
          set: function (e) {
            this._deadKey = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "highlightedText", {
          get: function () {
            return this._highlightedText;
          },
          set: function (e) {
            this._highlightedText !== e &&
              ((this._highlightedText = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "addKey", {
          get: function () {
            return this._addKey;
          },
          set: function (e) {
            this._addKey = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "currentKey", {
          get: function () {
            return this._currentKey;
          },
          set: function (e) {
            this._currentKey = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "text", {
          get: function () {
            return this._textWrapper.text;
          },
          set: function (e) {
            var t = e.toString();
            this._textWrapper || (this._textWrapper = new _f()),
              this._textWrapper.text !== t &&
                ((this._textWrapper.text = t), this._textHasChanged());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._textHasChanged = function () {
          this._markAsDirty(),
            this.onTextChangedObservable.notifyObservers(this);
        }),
        Object.defineProperty(t.prototype, "width", {
          get: function () {
            return this._width.toString(this._host);
          },
          set: function (e) {
            this._width.toString(this._host) !== e &&
              (this._width.fromString(e) && this._markAsDirty(),
              (this.autoStretchWidth = !1));
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.onBlur = function () {
          (this._isFocused = !1),
            (this._scrollLeft = null),
            (this._cursorOffset = 0),
            clearTimeout(this._blinkTimeout),
            this._markAsDirty(),
            this.onBlurObservable.notifyObservers(this),
            this._host.unRegisterClipboardEvents(),
            this._onClipboardObserver &&
              this._host.onClipboardObservable.remove(
                this._onClipboardObserver
              );
          var e = this._host.getScene();
          this._onPointerDblTapObserver &&
            e &&
            e.onPointerObservable.remove(this._onPointerDblTapObserver);
        }),
        (t.prototype.onFocus = function () {
          var e = this;
          if (this._isEnabled) {
            if (
              ((this._scrollLeft = null),
              (this._isFocused = !0),
              (this._blinkIsEven = !1),
              (this._cursorOffset = 0),
              this._markAsDirty(),
              this.onFocusObservable.notifyObservers(this),
              -1 !== navigator.userAgent.indexOf("Mobile") &&
                !this.disableMobilePrompt)
            ) {
              var t = prompt(this.promptMessage);
              return (
                null !== t && (this.text = t),
                void (this._host.focusedControl = null)
              );
            }
            this._host.registerClipboardEvents(),
              (this._onClipboardObserver = this._host.onClipboardObservable.add(
                function (t) {
                  switch (t.type) {
                    case us.COPY:
                      e._onCopyText(t.event),
                        e.onTextCopyObservable.notifyObservers(e);
                      break;
                    case us.CUT:
                      e._onCutText(t.event),
                        e.onTextCutObservable.notifyObservers(e);
                      break;
                    case us.PASTE:
                      e._onPasteText(t.event),
                        e.onTextPasteObservable.notifyObservers(e);
                      break;
                    default:
                      return;
                  }
                }
              ));
            var i = this._host.getScene();
            i &&
              (this._onPointerDblTapObserver = i.onPointerObservable.add(
                function (t) {
                  e._isFocused &&
                    t.type === pi.POINTERDOUBLETAP &&
                    e._processDblClick(t);
                }
              )),
              this._onFocusSelectAll && this._selectAllText();
          }
        }),
        (t.prototype._getTypeName = function () {
          return "InputText";
        }),
        (t.prototype.keepsFocusWith = function () {
          return this._connectedVirtualKeyboard
            ? [this._connectedVirtualKeyboard]
            : null;
        }),
        (t.prototype.processKey = function (e, t, i) {
          if (
            !i ||
            (!i.ctrlKey && !i.metaKey) ||
            (67 !== e && 86 !== e && 88 !== e)
          ) {
            if (i && (i.ctrlKey || i.metaKey) && 65 === e)
              return this._selectAllText(), void i.preventDefault();
            switch (e) {
              case 32:
                t = " ";
                break;
              case 191:
                i && i.preventDefault();
                break;
              case 8:
                if (this._textWrapper.text && this._textWrapper.length > 0) {
                  if (this._isTextHighlightOn)
                    return (
                      this._textWrapper.removePart(
                        this._startHighlightIndex,
                        this._endHighlightIndex
                      ),
                      this._textHasChanged(),
                      (this._isTextHighlightOn = !1),
                      (this._cursorOffset =
                        this._textWrapper.length - this._startHighlightIndex),
                      (this._blinkIsEven = !1),
                      void (i && i.preventDefault())
                    );
                  0 === this._cursorOffset
                    ? (this.text = this._textWrapper.substr(
                        0,
                        this._textWrapper.length - 1
                      ))
                    : (n = this._textWrapper.length - this._cursorOffset) > 0 &&
                      (this._textWrapper.removePart(n - 1, n),
                      this._textHasChanged());
                }
                return void (i && i.preventDefault());
              case 46:
                if (this._isTextHighlightOn)
                  return (
                    this._textWrapper.removePart(
                      this._startHighlightIndex,
                      this._endHighlightIndex
                    ),
                    this._textHasChanged(),
                    (this._isTextHighlightOn = !1),
                    (this._cursorOffset =
                      this._textWrapper.length - this._startHighlightIndex),
                    void (i && i.preventDefault())
                  );
                if (
                  this._textWrapper.text &&
                  this._textWrapper.length > 0 &&
                  this._cursorOffset > 0
                ) {
                  var n = this._textWrapper.length - this._cursorOffset;
                  this._textWrapper.removePart(n, n + 1),
                    this._textHasChanged(),
                    this._cursorOffset--;
                }
                return void (i && i.preventDefault());
              case 13:
                return (
                  (this._host.focusedControl = null),
                  void (this._isTextHighlightOn = !1)
                );
              case 35:
                return (
                  (this._cursorOffset = 0),
                  (this._blinkIsEven = !1),
                  (this._isTextHighlightOn = !1),
                  void this._markAsDirty()
                );
              case 36:
                return (
                  (this._cursorOffset = this._textWrapper.length),
                  (this._blinkIsEven = !1),
                  (this._isTextHighlightOn = !1),
                  void this._markAsDirty()
                );
              case 37:
                if (
                  (this._cursorOffset++,
                  this._cursorOffset > this._textWrapper.length &&
                    (this._cursorOffset = this._textWrapper.length),
                  i && i.shiftKey)
                ) {
                  if (((this._blinkIsEven = !1), i.ctrlKey || i.metaKey)) {
                    if (!this._isTextHighlightOn) {
                      if (this._textWrapper.length === this._cursorOffset)
                        return;
                      this._endHighlightIndex =
                        this._textWrapper.length - this._cursorOffset + 1;
                    }
                    return (
                      (this._startHighlightIndex = 0),
                      (this._cursorIndex =
                        this._textWrapper.length - this._endHighlightIndex),
                      (this._cursorOffset = this._textWrapper.length),
                      (this._isTextHighlightOn = !0),
                      void this._markAsDirty()
                    );
                  }
                  return (
                    this._isTextHighlightOn
                      ? -1 === this._cursorIndex &&
                        ((this._cursorIndex =
                          this._textWrapper.length - this._endHighlightIndex),
                        (this._cursorOffset =
                          0 === this._startHighlightIndex
                            ? this._textWrapper.length
                            : this._textWrapper.length -
                              this._startHighlightIndex +
                              1))
                      : ((this._isTextHighlightOn = !0),
                        (this._cursorIndex =
                          this._cursorOffset >= this._textWrapper.length
                            ? this._textWrapper.length
                            : this._cursorOffset - 1)),
                    this._cursorIndex < this._cursorOffset
                      ? ((this._endHighlightIndex =
                          this._textWrapper.length - this._cursorIndex),
                        (this._startHighlightIndex =
                          this._textWrapper.length - this._cursorOffset))
                      : this._cursorIndex > this._cursorOffset
                        ? ((this._endHighlightIndex =
                            this._textWrapper.length - this._cursorOffset),
                          (this._startHighlightIndex =
                            this._textWrapper.length - this._cursorIndex))
                        : (this._isTextHighlightOn = !1),
                    void this._markAsDirty()
                  );
                }
                return (
                  this._isTextHighlightOn &&
                    ((this._cursorOffset =
                      this._textWrapper.length - this._startHighlightIndex),
                    (this._isTextHighlightOn = !1)),
                  i &&
                    (i.ctrlKey || i.metaKey) &&
                    ((this._cursorOffset = this._textWrapper.length),
                    i.preventDefault()),
                  (this._blinkIsEven = !1),
                  (this._isTextHighlightOn = !1),
                  (this._cursorIndex = -1),
                  void this._markAsDirty()
                );
              case 39:
                if (
                  (this._cursorOffset--,
                  this._cursorOffset < 0 && (this._cursorOffset = 0),
                  i && i.shiftKey)
                ) {
                  if (((this._blinkIsEven = !1), i.ctrlKey || i.metaKey)) {
                    if (!this._isTextHighlightOn) {
                      if (0 === this._cursorOffset) return;
                      this._startHighlightIndex =
                        this._textWrapper.length - this._cursorOffset - 1;
                    }
                    return (
                      (this._endHighlightIndex = this._textWrapper.length),
                      (this._isTextHighlightOn = !0),
                      (this._cursorIndex =
                        this._textWrapper.length - this._startHighlightIndex),
                      (this._cursorOffset = 0),
                      void this._markAsDirty()
                    );
                  }
                  return (
                    this._isTextHighlightOn
                      ? -1 === this._cursorIndex &&
                        ((this._cursorIndex =
                          this._textWrapper.length - this._startHighlightIndex),
                        (this._cursorOffset =
                          this._textWrapper.length === this._endHighlightIndex
                            ? 0
                            : this._textWrapper.length -
                              this._endHighlightIndex -
                              1))
                      : ((this._isTextHighlightOn = !0),
                        (this._cursorIndex =
                          this._cursorOffset <= 0
                            ? 0
                            : this._cursorOffset + 1)),
                    this._cursorIndex < this._cursorOffset
                      ? ((this._endHighlightIndex =
                          this._textWrapper.length - this._cursorIndex),
                        (this._startHighlightIndex =
                          this._textWrapper.length - this._cursorOffset))
                      : this._cursorIndex > this._cursorOffset
                        ? ((this._endHighlightIndex =
                            this._textWrapper.length - this._cursorOffset),
                          (this._startHighlightIndex =
                            this._textWrapper.length - this._cursorIndex))
                        : (this._isTextHighlightOn = !1),
                    void this._markAsDirty()
                  );
                }
                return (
                  this._isTextHighlightOn &&
                    ((this._cursorOffset =
                      this._textWrapper.length - this._endHighlightIndex),
                    (this._isTextHighlightOn = !1)),
                  i &&
                    (i.ctrlKey || i.metaKey) &&
                    ((this._cursorOffset = 0), i.preventDefault()),
                  (this._blinkIsEven = !1),
                  (this._isTextHighlightOn = !1),
                  (this._cursorIndex = -1),
                  void this._markAsDirty()
                );
              case 222:
                i && i.preventDefault(),
                  (this._cursorIndex = -1),
                  (this.deadKey = !0);
            }
            if (
              t &&
              (-1 === e ||
                32 === e ||
                (e > 47 && e < 64) ||
                (e > 64 && e < 91) ||
                (e > 159 && e < 193) ||
                (e > 218 && e < 223) ||
                (e > 95 && e < 112)) &&
              ((this._currentKey = t),
              this.onBeforeKeyAddObservable.notifyObservers(this),
              (t = this._currentKey),
              this._addKey)
            )
              if (this._isTextHighlightOn)
                this._textWrapper.removePart(
                  this._startHighlightIndex,
                  this._endHighlightIndex,
                  t
                ),
                  this._textHasChanged(),
                  (this._cursorOffset =
                    this._textWrapper.length - (this._startHighlightIndex + 1)),
                  (this._isTextHighlightOn = !1),
                  (this._blinkIsEven = !1),
                  this._markAsDirty();
              else if (0 === this._cursorOffset) this.text += t;
              else {
                var r = this._textWrapper.length - this._cursorOffset;
                this._textWrapper.removePart(r, r, t), this._textHasChanged();
              }
          }
        }),
        (t.prototype._updateValueFromCursorIndex = function (e) {
          if (((this._blinkIsEven = !1), -1 === this._cursorIndex))
            this._cursorIndex = e;
          else if (this._cursorIndex < this._cursorOffset)
            (this._endHighlightIndex =
              this._textWrapper.length - this._cursorIndex),
              (this._startHighlightIndex =
                this._textWrapper.length - this._cursorOffset);
          else {
            if (!(this._cursorIndex > this._cursorOffset))
              return (this._isTextHighlightOn = !1), void this._markAsDirty();
            (this._endHighlightIndex =
              this._textWrapper.length - this._cursorOffset),
              (this._startHighlightIndex =
                this._textWrapper.length - this._cursorIndex);
          }
          (this._isTextHighlightOn = !0), this._markAsDirty();
        }),
        (t.prototype._processDblClick = function (e) {
          var t, i;
          (this._startHighlightIndex =
            this._textWrapper.length - this._cursorOffset),
            (this._endHighlightIndex = this._startHighlightIndex);
          do {
            (i =
              this._endHighlightIndex < this._textWrapper.length &&
              this._textWrapper.isWord(this._endHighlightIndex)
                ? ++this._endHighlightIndex
                : 0),
              (t =
                this._startHighlightIndex > 0 &&
                this._textWrapper.isWord(this._startHighlightIndex - 1)
                  ? --this._startHighlightIndex
                  : 0);
          } while (t || i);
          (this._cursorOffset =
            this._textWrapper.length - this._startHighlightIndex),
            this.onTextHighlightObservable.notifyObservers(this),
            (this._isTextHighlightOn = !0),
            (this._clickedCoordinate = null),
            (this._blinkIsEven = !0),
            (this._cursorIndex = -1),
            this._markAsDirty();
        }),
        (t.prototype._selectAllText = function () {
          (this._blinkIsEven = !0),
            (this._isTextHighlightOn = !0),
            (this._startHighlightIndex = 0),
            (this._endHighlightIndex = this._textWrapper.length),
            (this._cursorOffset = this._textWrapper.length),
            (this._cursorIndex = -1),
            this._markAsDirty();
        }),
        (t.prototype.processKeyboard = function (e) {
          this.processKey(e.keyCode, e.key, e),
            this.onKeyboardEventProcessedObservable.notifyObservers(e);
        }),
        (t.prototype._onCopyText = function (e) {
          this._isTextHighlightOn = !1;
          try {
            e.clipboardData &&
              e.clipboardData.setData("text/plain", this._highlightedText);
          } catch (e) {}
          this._host.clipboardData = this._highlightedText;
        }),
        (t.prototype._onCutText = function (e) {
          if (this._highlightedText) {
            this._textWrapper.removePart(
              this._startHighlightIndex,
              this._endHighlightIndex
            ),
              this._textHasChanged(),
              (this._isTextHighlightOn = !1),
              (this._cursorOffset =
                this._textWrapper.length - this._startHighlightIndex);
            try {
              e.clipboardData &&
                e.clipboardData.setData("text/plain", this._highlightedText);
            } catch (e) {}
            (this._host.clipboardData = this._highlightedText),
              (this._highlightedText = "");
          }
        }),
        (t.prototype._onPasteText = function (e) {
          var t;
          t =
            e.clipboardData &&
            -1 !== e.clipboardData.types.indexOf("text/plain")
              ? e.clipboardData.getData("text/plain")
              : this._host.clipboardData;
          var i = this._textWrapper.length - this._cursorOffset;
          this._textWrapper.removePart(i, i, t), this._textHasChanged();
        }),
        (t.prototype._draw = function (e, t) {
          var i = this;
          e.save(),
            this._applyStates(e),
            (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
              ((e.shadowColor = this.shadowColor),
              (e.shadowBlur = this.shadowBlur),
              (e.shadowOffsetX = this.shadowOffsetX),
              (e.shadowOffsetY = this.shadowOffsetY)),
            this._isFocused
              ? this._focusedBackground &&
                ((e.fillStyle = this._isEnabled
                  ? this._focusedBackground
                  : this._disabledColor),
                e.fillRect(
                  this._currentMeasure.left,
                  this._currentMeasure.top,
                  this._currentMeasure.width,
                  this._currentMeasure.height
                ))
              : this._background &&
                ((e.fillStyle = this._isEnabled
                  ? this._background
                  : this._disabledColor),
                e.fillRect(
                  this._currentMeasure.left,
                  this._currentMeasure.top,
                  this._currentMeasure.width,
                  this._currentMeasure.height
                )),
            (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
              ((e.shadowBlur = 0),
              (e.shadowOffsetX = 0),
              (e.shadowOffsetY = 0)),
            this._fontOffset || (this._fontOffset = sf._GetFontOffset(e.font));
          var n =
            this._currentMeasure.left +
            this._margin.getValueInPixel(
              this._host,
              this._tempParentMeasure.width
            );
          this.color && (e.fillStyle = this.color);
          var r = this._beforeRenderText(this._textWrapper);
          this._isFocused ||
            this._textWrapper.text ||
            !this._placeholderText ||
            (((r = new _f()).text = this._placeholderText),
            this._placeholderColor && (e.fillStyle = this._placeholderColor)),
            (this._textWidth = e.measureText(r.text).width);
          var o =
            2 *
            this._margin.getValueInPixel(
              this._host,
              this._tempParentMeasure.width
            );
          this._autoStretchWidth &&
            (this.width =
              Math.min(
                this._maxWidth.getValueInPixel(
                  this._host,
                  this._tempParentMeasure.width
                ),
                this._textWidth + o
              ) + "px");
          var s =
              this._fontOffset.ascent +
              (this._currentMeasure.height - this._fontOffset.height) / 2,
            a =
              this._width.getValueInPixel(
                this._host,
                this._tempParentMeasure.width
              ) - o;
          if (
            (e.save(),
            e.beginPath(),
            e.rect(
              n,
              this._currentMeasure.top +
                (this._currentMeasure.height - this._fontOffset.height) / 2,
              a + 2,
              this._currentMeasure.height
            ),
            e.clip(),
            this._isFocused && this._textWidth > a)
          ) {
            var l = n - this._textWidth + a;
            this._scrollLeft || (this._scrollLeft = l);
          } else this._scrollLeft = n;
          if (
            (e.fillText(r.text, this._scrollLeft, this._currentMeasure.top + s),
            this._isFocused)
          ) {
            if (this._clickedCoordinate) {
              var c =
                  this._scrollLeft + this._textWidth - this._clickedCoordinate,
                u = 0;
              this._cursorOffset = 0;
              var h = 0;
              do {
                this._cursorOffset && (h = Math.abs(c - u)),
                  this._cursorOffset++,
                  (u = e.measureText(
                    r.substr(r.length - this._cursorOffset, this._cursorOffset)
                  ).width);
              } while (u < c && r.length >= this._cursorOffset);
              Math.abs(c - u) > h && this._cursorOffset--,
                (this._blinkIsEven = !1),
                (this._clickedCoordinate = null);
            }
            if (!this._blinkIsEven) {
              var d = r.substr(r.length - this._cursorOffset),
                p = e.measureText(d).width,
                f = this._scrollLeft + this._textWidth - p;
              f < n
                ? ((this._scrollLeft += n - f), (f = n), this._markAsDirty())
                : f > n + a &&
                  ((this._scrollLeft += n + a - f),
                  (f = n + a),
                  this._markAsDirty()),
                this._isTextHighlightOn ||
                  e.fillRect(
                    f,
                    this._currentMeasure.top +
                      (this._currentMeasure.height - this._fontOffset.height) /
                        2,
                    2,
                    this._fontOffset.height
                  );
            }
            if (
              (clearTimeout(this._blinkTimeout),
              (this._blinkTimeout = setTimeout(function () {
                (i._blinkIsEven = !i._blinkIsEven), i._markAsDirty();
              }, 500)),
              this._isTextHighlightOn)
            ) {
              clearTimeout(this._blinkTimeout);
              var _ = e.measureText(
                  r.substring(this._startHighlightIndex)
                ).width,
                m = this._scrollLeft + this._textWidth - _;
              this._highlightedText = r.substring(
                this._startHighlightIndex,
                this._endHighlightIndex
              );
              var g = e.measureText(
                r.substring(this._startHighlightIndex, this._endHighlightIndex)
              ).width;
              m < n &&
                ((g -= n - m) ||
                  (g = e.measureText(
                    r.charAt(r.length - this._cursorOffset)
                  ).width),
                (m = n)),
                (e.globalAlpha = this._highligherOpacity),
                (e.fillStyle = this._textHighlightColor),
                e.fillRect(
                  m,
                  this._currentMeasure.top +
                    (this._currentMeasure.height - this._fontOffset.height) / 2,
                  g,
                  this._fontOffset.height
                ),
                (e.globalAlpha = 1);
            }
          }
          e.restore(),
            this._thickness &&
              (this._isFocused
                ? this.focusedColor && (e.strokeStyle = this.focusedColor)
                : this.color && (e.strokeStyle = this.color),
              (e.lineWidth = this._thickness),
              e.strokeRect(
                this._currentMeasure.left + this._thickness / 2,
                this._currentMeasure.top + this._thickness / 2,
                this._currentMeasure.width - this._thickness,
                this._currentMeasure.height - this._thickness
              )),
            e.restore();
        }),
        (t.prototype._onPointerDown = function (t, i, n, r, o) {
          return !(
            !e.prototype._onPointerDown.call(this, t, i, n, r, o) ||
            ((this._clickedCoordinate = i.x),
            (this._isTextHighlightOn = !1),
            (this._highlightedText = ""),
            (this._cursorIndex = -1),
            (this._isPointerDown = !0),
            (this._host._capturingControl[n] = this),
            this._host.focusedControl === this
              ? (clearTimeout(this._blinkTimeout), this._markAsDirty(), 0)
              : !this._isEnabled || ((this._host.focusedControl = this), 0))
          );
        }),
        (t.prototype._onPointerMove = function (t, i, n, r) {
          this._host.focusedControl === this &&
            this._isPointerDown &&
            ((this._clickedCoordinate = i.x),
            this._markAsDirty(),
            this._updateValueFromCursorIndex(this._cursorOffset)),
            e.prototype._onPointerMove.call(this, t, i, n, r);
        }),
        (t.prototype._onPointerUp = function (t, i, n, r, o) {
          (this._isPointerDown = !1),
            delete this._host._capturingControl[n],
            e.prototype._onPointerUp.call(this, t, i, n, r, o);
        }),
        (t.prototype._beforeRenderText = function (e) {
          return e;
        }),
        (t.prototype.dispose = function () {
          e.prototype.dispose.call(this),
            this.onBlurObservable.clear(),
            this.onFocusObservable.clear(),
            this.onTextChangedObservable.clear(),
            this.onTextCopyObservable.clear(),
            this.onTextCutObservable.clear(),
            this.onTextPasteObservable.clear(),
            this.onTextHighlightObservable.clear(),
            this.onKeyboardEventProcessedObservable.clear();
        }),
        t
      );
    })(sf);
  h.RegisteredTypes["BABYLON.GUI.InputText"] = mf;
  var gf = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      return (
        (i.name = t),
        (i._rowDefinitions = new Array()),
        (i._columnDefinitions = new Array()),
        (i._cells = {}),
        (i._childControls = new Array()),
        i
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "columnCount", {
        get: function () {
          return this._columnDefinitions.length;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "rowCount", {
        get: function () {
          return this._rowDefinitions.length;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "children", {
        get: function () {
          return this._childControls;
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "cells", {
        get: function () {
          return this._cells;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.getRowDefinition = function (e) {
        return e < 0 || e >= this._rowDefinitions.length
          ? null
          : this._rowDefinitions[e];
      }),
      (t.prototype.getColumnDefinition = function (e) {
        return e < 0 || e >= this._columnDefinitions.length
          ? null
          : this._columnDefinitions[e];
      }),
      (t.prototype.addRowDefinition = function (e, t) {
        return (
          void 0 === t && (t = !1),
          this._rowDefinitions.push(
            new Zp(e, t ? Zp.UNITMODE_PIXEL : Zp.UNITMODE_PERCENTAGE)
          ),
          this._markAsDirty(),
          this
        );
      }),
      (t.prototype.addColumnDefinition = function (e, t) {
        return (
          void 0 === t && (t = !1),
          this._columnDefinitions.push(
            new Zp(e, t ? Zp.UNITMODE_PIXEL : Zp.UNITMODE_PERCENTAGE)
          ),
          this._markAsDirty(),
          this
        );
      }),
      (t.prototype.setRowDefinition = function (e, t, i) {
        if (
          (void 0 === i && (i = !1), e < 0 || e >= this._rowDefinitions.length)
        )
          return this;
        var n = this._rowDefinitions[e];
        return (
          (n && n.isPixel === i && n.internalValue === t) ||
            ((this._rowDefinitions[e] = new Zp(
              t,
              i ? Zp.UNITMODE_PIXEL : Zp.UNITMODE_PERCENTAGE
            )),
            this._markAsDirty()),
          this
        );
      }),
      (t.prototype.setColumnDefinition = function (e, t, i) {
        if (
          (void 0 === i && (i = !1),
          e < 0 || e >= this._columnDefinitions.length)
        )
          return this;
        var n = this._columnDefinitions[e];
        return (
          (n && n.isPixel === i && n.internalValue === t) ||
            ((this._columnDefinitions[e] = new Zp(
              t,
              i ? Zp.UNITMODE_PIXEL : Zp.UNITMODE_PERCENTAGE
            )),
            this._markAsDirty()),
          this
        );
      }),
      (t.prototype.getChildrenAt = function (e, t) {
        var i = this._cells[e + ":" + t];
        return i ? i.children : null;
      }),
      (t.prototype.getChildCellInfo = function (e) {
        return e._tag;
      }),
      (t.prototype._removeCell = function (t, i) {
        if (t) {
          e.prototype.removeControl.call(this, t);
          for (var n = 0, r = t.children; n < r.length; n++) {
            var o = r[n],
              s = this._childControls.indexOf(o);
            -1 !== s && this._childControls.splice(s, 1);
          }
          delete this._cells[i];
        }
      }),
      (t.prototype._offsetCell = function (e, t) {
        if (this._cells[t]) {
          this._cells[e] = this._cells[t];
          for (var i = 0, n = this._cells[e].children; i < n.length; i++)
            n[i]._tag = e;
          delete this._cells[t];
        }
      }),
      (t.prototype.removeColumnDefinition = function (e) {
        if (e < 0 || e >= this._columnDefinitions.length) return this;
        for (var t = 0; t < this._rowDefinitions.length; t++) {
          var i = t + ":" + e,
            n = this._cells[i];
          this._removeCell(n, i);
        }
        for (t = 0; t < this._rowDefinitions.length; t++)
          for (var r = e + 1; r < this._columnDefinitions.length; r++) {
            var o = t + ":" + (r - 1);
            (i = t + ":" + r), this._offsetCell(o, i);
          }
        return this._columnDefinitions.splice(e, 1), this._markAsDirty(), this;
      }),
      (t.prototype.removeRowDefinition = function (e) {
        if (e < 0 || e >= this._rowDefinitions.length) return this;
        for (var t = 0; t < this._columnDefinitions.length; t++) {
          var i = e + ":" + t,
            n = this._cells[i];
          this._removeCell(n, i);
        }
        for (t = 0; t < this._columnDefinitions.length; t++)
          for (var r = e + 1; r < this._rowDefinitions.length; r++) {
            var o = r - 1 + ":" + t;
            (i = r + ":" + t), this._offsetCell(o, i);
          }
        return this._rowDefinitions.splice(e, 1), this._markAsDirty(), this;
      }),
      (t.prototype.addControl = function (t, i, n) {
        if (
          (void 0 === i && (i = 0),
          void 0 === n && (n = 0),
          0 === this._rowDefinitions.length && this.addRowDefinition(1, !1),
          0 === this._columnDefinitions.length &&
            this.addColumnDefinition(1, !1),
          -1 !== this._childControls.indexOf(t))
        )
          return (
            yt.Warn(
              "Control (Name:" +
                t.name +
                ", UniqueId:" +
                t.uniqueId +
                ") is already associated with this grid. You must remove it before reattaching it"
            ),
            this
          );
        var r =
            Math.min(i, this._rowDefinitions.length - 1) +
            ":" +
            Math.min(n, this._columnDefinitions.length - 1),
          o = this._cells[r];
        return (
          o ||
            ((o = new af(r)),
            (this._cells[r] = o),
            (o.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
            (o.verticalAlignment = sf.VERTICAL_ALIGNMENT_TOP),
            e.prototype.addControl.call(this, o)),
          o.addControl(t),
          this._childControls.push(t),
          (t._tag = r),
          (t.parent = this),
          this._markAsDirty(),
          this
        );
      }),
      (t.prototype.removeControl = function (e) {
        var t = this._childControls.indexOf(e);
        -1 !== t && this._childControls.splice(t, 1);
        var i = this._cells[e._tag];
        return (
          i && (i.removeControl(e), (e._tag = null)), this._markAsDirty(), this
        );
      }),
      (t.prototype._getTypeName = function () {
        return "Grid";
      }),
      (t.prototype._getGridDefinitions = function (e) {
        for (
          var t = [],
            i = [],
            n = [],
            r = [],
            o = this._currentMeasure.width,
            s = 0,
            a = this._currentMeasure.height,
            l = 0,
            c = 0,
            u = 0,
            h = this._rowDefinitions;
          u < h.length;
          u++
        )
          (m = h[u]).isPixel
            ? ((a -= _ = m.getValue(this._host)), (i[c] = _))
            : (l += m.internalValue),
            c++;
        var d = 0;
        c = 0;
        for (var p = 0, f = this._rowDefinitions; p < f.length; p++) {
          var _,
            m = f[p];
          r.push(d),
            m.isPixel
              ? (d += m.getValue(this._host))
              : ((d += _ = (m.internalValue / l) * a), (i[c] = _)),
            c++;
        }
        c = 0;
        for (var g = 0, v = this._columnDefinitions; g < v.length; g++)
          (m = v[g]).isPixel
            ? ((o -= S = m.getValue(this._host)), (t[c] = S))
            : (s += m.internalValue),
            c++;
        var y = 0;
        c = 0;
        for (var b = 0, T = this._columnDefinitions; b < T.length; b++) {
          var S;
          (m = T[b]),
            n.push(y),
            m.isPixel
              ? (y += m.getValue(this._host))
              : ((y += S = (m.internalValue / s) * o), (t[c] = S)),
            c++;
        }
        e(n, r, t, i);
      }),
      (t.prototype._additionalProcessing = function (t, i) {
        var n = this;
        this._getGridDefinitions(function (e, t, i, r) {
          for (var o in n._cells)
            if (n._cells.hasOwnProperty(o)) {
              var s = o.split(":"),
                a = parseInt(s[0]),
                l = parseInt(s[1]),
                c = n._cells[o];
              (c.left = e[l] + "px"),
                (c.top = t[a] + "px"),
                (c.width = i[l] + "px"),
                (c.height = r[a] + "px"),
                (c._left.ignoreAdaptiveScaling = !0),
                (c._top.ignoreAdaptiveScaling = !0),
                (c._width.ignoreAdaptiveScaling = !0),
                (c._height.ignoreAdaptiveScaling = !0);
            }
        }),
          e.prototype._additionalProcessing.call(this, t, i);
      }),
      (t.prototype._flagDescendantsAsMatrixDirty = function () {
        for (var e in this._cells)
          this._cells.hasOwnProperty(e) && this._cells[e]._markMatrixAsDirty();
      }),
      (t.prototype._renderHighlightSpecific = function (t) {
        var i = this;
        e.prototype._renderHighlightSpecific.call(this, t),
          this._getGridDefinitions(function (e, n, r, o) {
            for (var s = 0; s < e.length; s++) {
              var a = i._currentMeasure.left + e[s] + r[s];
              t.beginPath(),
                t.moveTo(a, i._currentMeasure.top),
                t.lineTo(a, i._currentMeasure.top + i._currentMeasure.height),
                t.stroke();
            }
            for (s = 0; s < n.length; s++) {
              var l = i._currentMeasure.top + n[s] + o[s];
              t.beginPath(),
                t.moveTo(i._currentMeasure.left, l),
                t.lineTo(i._currentMeasure.left + i._currentMeasure.width, l),
                t.stroke();
            }
          }),
          t.restore();
      }),
      (t.prototype.dispose = function () {
        e.prototype.dispose.call(this);
        for (var t = 0, i = this._childControls; t < i.length; t++)
          i[t].dispose();
        this._childControls = [];
      }),
      t
    );
  })(af);
  h.RegisteredTypes["BABYLON.GUI.Grid"] = gf;
  var vf = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      return (
        (i.name = t),
        (i._value = b.Red()),
        (i._tmpColor = new b()),
        (i._pointerStartedOnSquare = !1),
        (i._pointerStartedOnWheel = !1),
        (i._squareLeft = 0),
        (i._squareTop = 0),
        (i._squareSize = 0),
        (i._h = 360),
        (i._s = 1),
        (i._v = 1),
        (i._lastPointerDownID = -1),
        (i.onValueChangedObservable = new o()),
        (i._pointerIsDown = !1),
        (i.value = new b(0.88, 0.1, 0.1)),
        (i.size = "200px"),
        (i.isPointerBlocker = !0),
        i
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "value", {
        get: function () {
          return this._value;
        },
        set: function (e) {
          this._value.equals(e) ||
            (this._value.copyFrom(e),
            this._value.toHSVToRef(this._tmpColor),
            (this._h = this._tmpColor.r),
            (this._s = Math.max(this._tmpColor.g, 1e-5)),
            (this._v = Math.max(this._tmpColor.b, 1e-5)),
            this._markAsDirty(),
            this._value.r <= t._Epsilon && (this._value.r = 0),
            this._value.g <= t._Epsilon && (this._value.g = 0),
            this._value.b <= t._Epsilon && (this._value.b = 0),
            this._value.r >= 1 - t._Epsilon && (this._value.r = 1),
            this._value.g >= 1 - t._Epsilon && (this._value.g = 1),
            this._value.b >= 1 - t._Epsilon && (this._value.b = 1),
            this.onValueChangedObservable.notifyObservers(this._value));
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "width", {
        get: function () {
          return this._width.toString(this._host);
        },
        set: function (e) {
          this._width.toString(this._host) !== e &&
            this._width.fromString(e) &&
            (this._height.fromString(e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "height", {
        get: function () {
          return this._height.toString(this._host);
        },
        set: function (e) {
          this._height.toString(this._host) !== e &&
            this._height.fromString(e) &&
            (this._width.fromString(e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "size", {
        get: function () {
          return this.width;
        },
        set: function (e) {
          this.width = e;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._getTypeName = function () {
        return "ColorPicker";
      }),
      (t.prototype._preMeasure = function (e, t) {
        e.width < e.height
          ? (this._currentMeasure.height = e.width)
          : (this._currentMeasure.width = e.height);
      }),
      (t.prototype._updateSquareProps = function () {
        var e =
            0.5 *
            Math.min(this._currentMeasure.width, this._currentMeasure.height),
          t = (2 * (e - 0.2 * e)) / Math.sqrt(2),
          i = e - 0.5 * t;
        (this._squareLeft = this._currentMeasure.left + i),
          (this._squareTop = this._currentMeasure.top + i),
          (this._squareSize = t);
      }),
      (t.prototype._drawGradientSquare = function (e, t, i, n, r, o) {
        var s = o.createLinearGradient(t, i, n + t, i);
        s.addColorStop(0, "#fff"),
          s.addColorStop(1, "hsl(" + e + ", 100%, 50%)"),
          (o.fillStyle = s),
          o.fillRect(t, i, n, r);
        var a = o.createLinearGradient(t, i, t, r + i);
        a.addColorStop(0, "rgba(0,0,0,0)"),
          a.addColorStop(1, "#000"),
          (o.fillStyle = a),
          o.fillRect(t, i, n, r);
      }),
      (t.prototype._drawCircle = function (e, t, i, n) {
        n.beginPath(),
          n.arc(e, t, i + 1, 0, 2 * Math.PI, !1),
          (n.lineWidth = 3),
          (n.strokeStyle = "#333333"),
          n.stroke(),
          n.beginPath(),
          n.arc(e, t, i, 0, 2 * Math.PI, !1),
          (n.lineWidth = 3),
          (n.strokeStyle = "#ffffff"),
          n.stroke();
      }),
      (t.prototype._createColorWheelCanvas = function (e, t) {
        var i = document.createElement("canvas");
        (i.width = 2 * e), (i.height = 2 * e);
        for (
          var n = i.getContext("2d"),
            r = n.getImageData(0, 0, 2 * e, 2 * e),
            o = r.data,
            s = this._tmpColor,
            a = e * e,
            l = e - t,
            c = l * l,
            u = -e;
          u < e;
          u++
        )
          for (var h = -e; h < e; h++) {
            var d = u * u + h * h;
            if (!(d > a || d < c)) {
              var p = Math.sqrt(d),
                f = Math.atan2(h, u);
              b.HSVtoRGBToRef((180 * f) / Math.PI + 180, p / e, 1, s);
              var _ = 4 * (u + e + 2 * (h + e) * e);
              (o[_] = 255 * s.r),
                (o[_ + 1] = 255 * s.g),
                (o[_ + 2] = 255 * s.b);
              var m;
              m =
                e < 50 ? 0.2 : e > 150 ? 0.04 : (-0.16 * (e - 50)) / 100 + 0.2;
              var g = (p - l) / (e - l);
              o[_ + 3] =
                g < m
                  ? (g / m) * 255
                  : g > 1 - m
                    ? 255 * (1 - (g - (1 - m)) / m)
                    : 255;
            }
          }
        return n.putImageData(r, 0, 0), i;
      }),
      (t.prototype._draw = function (e) {
        e.save(), this._applyStates(e);
        var t =
            0.5 *
            Math.min(this._currentMeasure.width, this._currentMeasure.height),
          i = 0.2 * t,
          n = this._currentMeasure.left,
          r = this._currentMeasure.top;
        (this._colorWheelCanvas && this._colorWheelCanvas.width == 2 * t) ||
          (this._colorWheelCanvas = this._createColorWheelCanvas(t, i)),
          this._updateSquareProps(),
          (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
            ((e.shadowColor = this.shadowColor),
            (e.shadowBlur = this.shadowBlur),
            (e.shadowOffsetX = this.shadowOffsetX),
            (e.shadowOffsetY = this.shadowOffsetY),
            e.fillRect(
              this._squareLeft,
              this._squareTop,
              this._squareSize,
              this._squareSize
            )),
          e.drawImage(this._colorWheelCanvas, n, r),
          (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
            ((e.shadowBlur = 0), (e.shadowOffsetX = 0), (e.shadowOffsetY = 0)),
          this._drawGradientSquare(
            this._h,
            this._squareLeft,
            this._squareTop,
            this._squareSize,
            this._squareSize,
            e
          );
        var o = this._squareLeft + this._squareSize * this._s,
          s = this._squareTop + this._squareSize * (1 - this._v);
        this._drawCircle(o, s, 0.04 * t, e);
        var a = t - 0.5 * i;
        (o = n + t + Math.cos(((this._h - 180) * Math.PI) / 180) * a),
          (s = r + t + Math.sin(((this._h - 180) * Math.PI) / 180) * a),
          this._drawCircle(o, s, 0.35 * i, e),
          e.restore();
      }),
      (t.prototype._updateValueFromPointer = function (e, i) {
        if (this._pointerStartedOnWheel) {
          var n =
              0.5 *
              Math.min(this._currentMeasure.width, this._currentMeasure.height),
            r = n + this._currentMeasure.left,
            o = n + this._currentMeasure.top;
          this._h = (180 * Math.atan2(i - o, e - r)) / Math.PI + 180;
        } else
          this._pointerStartedOnSquare &&
            (this._updateSquareProps(),
            (this._s = (e - this._squareLeft) / this._squareSize),
            (this._v = 1 - (i - this._squareTop) / this._squareSize),
            (this._s = Math.min(this._s, 1)),
            (this._s = Math.max(this._s, t._Epsilon)),
            (this._v = Math.min(this._v, 1)),
            (this._v = Math.max(this._v, t._Epsilon)));
        b.HSVtoRGBToRef(this._h, this._s, this._v, this._tmpColor),
          (this.value = this._tmpColor);
      }),
      (t.prototype._isPointOnSquare = function (e, t) {
        this._updateSquareProps();
        var i = this._squareLeft,
          n = this._squareTop,
          r = this._squareSize;
        return e >= i && e <= i + r && t >= n && t <= n + r;
      }),
      (t.prototype._isPointOnWheel = function (e, t) {
        var i =
            0.5 *
            Math.min(this._currentMeasure.width, this._currentMeasure.height),
          n = i - 0.2 * i,
          r = e - (i + this._currentMeasure.left),
          o = t - (i + this._currentMeasure.top),
          s = r * r + o * o;
        return s <= i * i && s >= n * n;
      }),
      (t.prototype._onPointerDown = function (t, i, n, r, o) {
        if (!e.prototype._onPointerDown.call(this, t, i, n, r, o)) return !1;
        (this._pointerIsDown = !0),
          (this._pointerStartedOnSquare = !1),
          (this._pointerStartedOnWheel = !1),
          this._invertTransformMatrix.transformCoordinates(
            i.x,
            i.y,
            this._transformedPosition
          );
        var s = this._transformedPosition.x,
          a = this._transformedPosition.y;
        return (
          this._isPointOnSquare(s, a)
            ? (this._pointerStartedOnSquare = !0)
            : this._isPointOnWheel(s, a) && (this._pointerStartedOnWheel = !0),
          this._updateValueFromPointer(s, a),
          (this._host._capturingControl[n] = this),
          (this._lastPointerDownID = n),
          !0
        );
      }),
      (t.prototype._onPointerMove = function (t, i, n, r) {
        if (n == this._lastPointerDownID) {
          this._invertTransformMatrix.transformCoordinates(
            i.x,
            i.y,
            this._transformedPosition
          );
          var o = this._transformedPosition.x,
            s = this._transformedPosition.y;
          this._pointerIsDown && this._updateValueFromPointer(o, s),
            e.prototype._onPointerMove.call(this, t, i, n, r);
        }
      }),
      (t.prototype._onPointerUp = function (t, i, n, r, o, s) {
        (this._pointerIsDown = !1),
          delete this._host._capturingControl[n],
          e.prototype._onPointerUp.call(this, t, i, n, r, o, s);
      }),
      (t.prototype._onCanvasBlur = function () {
        this._forcePointerUp(), e.prototype._onCanvasBlur.call(this);
      }),
      (t.ShowPickerDialogAsync = function (e, i) {
        return new Promise(function (n, r) {
          (i.pickerWidth = i.pickerWidth || "640px"),
            (i.pickerHeight = i.pickerHeight || "400px"),
            (i.headerHeight = i.headerHeight || "35px"),
            (i.lastColor = i.lastColor || "#000000"),
            (i.swatchLimit = i.swatchLimit || 20),
            (i.numSwatchesPerLine = i.numSwatchesPerLine || 10);
          var o,
            s,
            a,
            l,
            c,
            u,
            h,
            d,
            p,
            f,
            _,
            m,
            g,
            v,
            y,
            T,
            S,
            C,
            x,
            E = i.swatchLimit / i.numSwatchesPerLine,
            P = parseFloat(i.pickerWidth) / i.numSwatchesPerLine,
            A = Math.floor(0.25 * P),
            R = A * (i.numSwatchesPerLine + 1),
            M = Math.floor(
              (parseFloat(i.pickerWidth) - R) / i.numSwatchesPerLine
            ),
            O = M * E + A * (E + 1),
            I =
              (parseInt(i.pickerHeight) + O + Math.floor(0.25 * M)).toString() +
              "px",
            D = "#c0c0c0",
            w = "#535353",
            N = "#414141",
            L = "515151",
            F = b.FromHexString("#dddddd"),
            B = F.r + F.g + F.b,
            V = ["R", "G", "B"],
            k = "#454545",
            U = "#f0f0f0",
            z = !1;
          function G(e, t) {
            x = t;
            var i = e.toHexString();
            if (
              ((S.background = i),
              f.name != x && (f.text = Math.floor(255 * e.r).toString()),
              _.name != x && (_.text = Math.floor(255 * e.g).toString()),
              m.name != x && (m.text = Math.floor(255 * e.b).toString()),
              g.name != x && (g.text = e.r.toString()),
              v.name != x && (v.text = e.g.toString()),
              y.name != x && (y.text = e.b.toString()),
              T.name != x)
            ) {
              var n = i.split("#");
              T.text = n[1];
            }
            p.name != x && (p.value = e);
          }
          function W(e, t) {
            var i = e.text;
            if (/[^0-9]/g.test(i)) e.text = C;
            else if (
              ("" != i &&
                (Math.floor(parseInt(i)) < 0
                  ? (i = "0")
                  : Math.floor(parseInt(i)) > 255
                    ? (i = "255")
                    : isNaN(parseInt(i)) && (i = "0")),
              x == e.name && (C = i),
              "" != i)
            ) {
              (i = parseInt(i).toString()), (e.text = i);
              var n = b.FromHexString(S.background);
              x == e.name &&
                G(
                  "r" == t
                    ? new b(parseInt(i) / 255, n.g, n.b)
                    : "g" == t
                      ? new b(n.r, parseInt(i) / 255, n.b)
                      : new b(n.r, n.g, parseInt(i) / 255),
                  e.name
                );
            }
          }
          function H(e, t) {
            var i = e.text;
            if (/[^0-9\.]/g.test(i)) e.text = C;
            else {
              "" != i &&
                "." != i &&
                0 != parseFloat(i) &&
                (parseFloat(i) < 0
                  ? (i = "0.0")
                  : parseFloat(i) > 1
                    ? (i = "1.0")
                    : isNaN(parseFloat(i)) && (i = "0.0")),
                x == e.name && (C = i),
                "" != i && "." != i && 0 != parseFloat(i)
                  ? ((i = parseFloat(i).toString()), (e.text = i))
                  : (i = "0.0");
              var n = b.FromHexString(S.background);
              x == e.name &&
                G(
                  "r" == t
                    ? new b(parseFloat(i), n.g, n.b)
                    : "g" == t
                      ? new b(n.r, parseFloat(i), n.b)
                      : new b(n.r, n.g, parseFloat(i)),
                  e.name
                );
            }
          }
          function j() {
            if (i.savedColors && i.savedColors[h]) {
              if (z) var e = "b";
              else e = "";
              var t = df.CreateSimpleButton("Swatch_" + h, e);
              t.fontFamily = "BabylonJSglyphs";
              var n = b.FromHexString(i.savedColors[h]),
                r = n.r + n.g + n.b;
              (t.color = r > B ? "#aaaaaa" : "#ffffff"),
                (t.fontSize = Math.floor(0.7 * M)),
                (t.textBlock.verticalAlignment = sf.VERTICAL_ALIGNMENT_CENTER),
                (t.height = t.width = M.toString() + "px"),
                (t.background = i.savedColors[h]),
                (t.thickness = 2);
              var o = h;
              return (
                (t.pointerDownAnimation = function () {
                  t.thickness = 4;
                }),
                (t.pointerUpAnimation = function () {
                  t.thickness = 3;
                }),
                (t.pointerEnterAnimation = function () {
                  t.thickness = 3;
                }),
                (t.pointerOutAnimation = function () {
                  t.thickness = 2;
                }),
                t.onPointerClickObservable.add(function () {
                  var e;
                  z
                    ? ((e = o),
                      i.savedColors && i.savedColors.splice(e, 1),
                      i.savedColors &&
                        0 == i.savedColors.length &&
                        (K(!1), (z = !1)),
                      Y("", Me))
                    : i.savedColors &&
                      G(b.FromHexString(i.savedColors[o]), t.name);
                }),
                t
              );
            }
            return null;
          }
          function X(e) {
            if ((void 0 !== e && (z = e), z)) {
              for (var t = 0; t < d.children.length; t++)
                d.children[t].textBlock.text = "b";
              void 0 !== a && (a.textBlock.text = "Done");
            } else {
              for (t = 0; t < d.children.length; t++)
                d.children[t].textBlock.text = "";
              void 0 !== a && (a.textBlock.text = "Edit");
            }
          }
          function Y(e, t) {
            if (i.savedColors) {
              "" != e && i.savedColors.push(e), (h = 0), d.clearControls();
              var n = Math.ceil(i.savedColors.length / i.numSwatchesPerLine);
              if (0 == n) var r = 0;
              else r = n + 1;
              if (d.rowCount != n + r) {
                for (var o = d.rowCount, s = 0; s < o; s++)
                  d.removeRowDefinition(0);
                for (s = 0; s < n + r; s++)
                  s % 2 ? d.addRowDefinition(M, !0) : d.addRowDefinition(A, !0);
              }
              d.height = (M * n + r * A).toString() + "px";
              for (var a = 1, l = 1; a < n + r; a += 2, l++) {
                if (i.savedColors.length > l * i.numSwatchesPerLine)
                  var c = i.numSwatchesPerLine;
                else c = i.savedColors.length - (l - 1) * i.numSwatchesPerLine;
                for (
                  var u = Math.min(Math.max(c, 0), i.numSwatchesPerLine),
                    p = 0,
                    f = 1;
                  p < u;
                  p++
                )
                  if (!(p > i.numSwatchesPerLine)) {
                    var _ = j();
                    null != _ && (d.addControl(_, a, f), (f += 2), h++);
                  }
              }
              i.savedColors.length >= i.swatchLimit ? Q(t, !0) : Q(t, !1);
            }
          }
          function K(e) {
            e
              ? (((a = df.CreateSimpleButton("butEdit", "Edit")).width = l),
                (a.height = c),
                (a.left = Math.floor(0.1 * parseInt(l)).toString() + "px"),
                (a.top = (-1 * parseFloat(a.left)).toString() + "px"),
                (a.verticalAlignment = sf.VERTICAL_ALIGNMENT_BOTTOM),
                (a.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
                (a.thickness = 2),
                (a.color = D),
                (a.fontSize = s),
                (a.background = w),
                a.onPointerEnterObservable.add(function () {
                  a.background = N;
                }),
                a.onPointerOutObservable.add(function () {
                  a.background = w;
                }),
                (a.pointerDownAnimation = function () {
                  a.background = L;
                }),
                (a.pointerUpAnimation = function () {
                  a.background = N;
                }),
                a.onPointerClickObservable.add(function () {
                  (z = !z), X();
                }),
                ue.addControl(a, 1, 0))
              : ue.removeControl(a);
          }
          function Q(e, t) {
            t
              ? ((e.color = "#555555"), (e.background = "#454545"))
              : ((e.color = D), (e.background = w));
          }
          function q(t) {
            i.savedColors && i.savedColors.length > 0
              ? n({
                  savedColors: i.savedColors,
                  pickedColor: t,
                })
              : n({
                  pickedColor: t,
                }),
              e.removeControl(Z);
          }
          var Z = new gf();
          if (
            ((Z.name = "Dialog Container"),
            (Z.width = i.pickerWidth),
            i.savedColors)
          ) {
            Z.height = I;
            var J = parseInt(i.pickerHeight) / parseInt(I);
            Z.addRowDefinition(J, !1), Z.addRowDefinition(1 - J, !1);
          } else (Z.height = i.pickerHeight), Z.addRowDefinition(1, !1);
          if ((e.addControl(Z), i.savedColors)) {
            ((d = new gf()).name = "Swatch Drawer"),
              (d.verticalAlignment = sf.VERTICAL_ALIGNMENT_TOP),
              (d.background = w),
              (d.width = i.pickerWidth);
            var $ = i.savedColors.length / i.numSwatchesPerLine;
            if (0 == $) var ee = 0;
            else ee = $ + 1;
            (d.height = (M * $ + ee * A).toString() + "px"),
              (d.top = Math.floor(0.25 * M).toString() + "px");
            for (
              var te = 0;
              te <
              2 * Math.ceil(i.savedColors.length / i.numSwatchesPerLine) + 1;
              te++
            )
              te % 2 != 0
                ? d.addRowDefinition(M, !0)
                : d.addRowDefinition(A, !0);
            for (te = 0; te < 2 * i.numSwatchesPerLine + 1; te++)
              te % 2 != 0
                ? d.addColumnDefinition(M, !0)
                : d.addColumnDefinition(A, !0);
            Z.addControl(d, 1, 0);
          }
          var ie = new gf();
          (ie.name = "Picker Panel"), (ie.height = i.pickerHeight);
          var ne = parseInt(i.headerHeight) / parseInt(i.pickerHeight),
            re = [ne, 1 - ne];
          ie.addRowDefinition(re[0], !1),
            ie.addRowDefinition(re[1], !1),
            Z.addControl(ie, 0, 0);
          var oe = new cf();
          (oe.name = "Dialogue Header Bar"),
            (oe.background = "#cccccc"),
            (oe.thickness = 0),
            ie.addControl(oe, 0, 0);
          var se = df.CreateSimpleButton("closeButton", "a");
          se.fontFamily = "BabylonJSglyphs";
          var ae = b.FromHexString(oe.background);
          (o = new b(1 - ae.r, 1 - ae.g, 1 - ae.b)),
            (se.color = o.toHexString()),
            (se.fontSize = Math.floor(0.6 * parseInt(i.headerHeight))),
            (se.textBlock.textVerticalAlignment = sf.VERTICAL_ALIGNMENT_CENTER),
            (se.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_RIGHT),
            (se.height = se.width = i.headerHeight),
            (se.background = oe.background),
            (se.thickness = 0),
            (se.pointerDownAnimation = function () {}),
            (se.pointerUpAnimation = function () {
              se.background = oe.background;
            }),
            (se.pointerEnterAnimation = function () {
              (se.color = oe.background), (se.background = "red");
            }),
            (se.pointerOutAnimation = function () {
              (se.color = o.toHexString()), (se.background = oe.background);
            }),
            se.onPointerClickObservable.add(function () {
              q(Se.background);
            }),
            ie.addControl(se, 0, 0);
          var le = new gf();
          (le.name = "Dialogue Body"), (le.background = w);
          var ce = [0.4375, 0.5625];
          le.addRowDefinition(1, !1),
            le.addColumnDefinition(ce[0], !1),
            le.addColumnDefinition(ce[1], !1),
            ie.addControl(le, 1, 0);
          var ue = new gf();
          (ue.name = "Picker Grid"),
            ue.addRowDefinition(0.85, !1),
            ue.addRowDefinition(0.15, !1),
            le.addControl(ue, 0, 0),
            ((p = new t()).name = "GUI Color Picker"),
            i.pickerHeight < i.pickerWidth
              ? (p.width = 0.89)
              : (p.height = 0.89),
            (p.value = b.FromHexString(i.lastColor)),
            (p.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_CENTER),
            (p.verticalAlignment = sf.VERTICAL_ALIGNMENT_CENTER),
            p.onPointerDownObservable.add(function () {
              (x = p.name), (C = ""), X(!1);
            }),
            p.onValueChangedObservable.add(function (e) {
              x == p.name && G(e, p.name);
            }),
            ue.addControl(p, 0, 0);
          var he = new gf();
          (he.name = "Dialogue Right Half"),
            (he.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT);
          var de = [0.514, 0.486];
          he.addRowDefinition(de[0], !1),
            he.addRowDefinition(de[1], !1),
            le.addControl(he, 1, 1);
          var pe = new gf();
          pe.name = "Swatches and Buttons";
          var fe = [0.417, 0.583];
          pe.addRowDefinition(1, !1),
            pe.addColumnDefinition(fe[0], !1),
            pe.addColumnDefinition(fe[1], !1),
            he.addControl(pe, 0, 0);
          var _e = new gf();
          _e.name = "New and Current Swatches";
          var me = [0.04, 0.16, 0.64, 0.16];
          _e.addRowDefinition(me[0], !1),
            _e.addRowDefinition(me[1], !1),
            _e.addRowDefinition(me[2], !1),
            _e.addRowDefinition(me[3], !1),
            pe.addControl(_e, 0, 0);
          var ge = new gf();
          (ge.name = "Active Swatches"),
            (ge.width = 0.67),
            ge.addRowDefinition(0.5, !1),
            ge.addRowDefinition(0.5, !1),
            _e.addControl(ge, 2, 0);
          var ve = Math.floor(parseInt(i.pickerWidth) * ce[1] * fe[0] * 0.11),
            ye = Math.floor(
              parseInt(i.pickerHeight) * re[1] * de[0] * me[1] * 0.5
            );
          if (i.pickerWidth > i.pickerHeight) var be = ye;
          else be = ve;
          var Te = new uf();
          (Te.text = "new"),
            (Te.name = "New Color Label"),
            (Te.color = D),
            (Te.fontSize = be),
            _e.addControl(Te, 1, 0),
            ((S = new cf()).name = "New Color Swatch"),
            (S.background = i.lastColor),
            (S.thickness = 0),
            ge.addControl(S, 0, 0);
          var Se = df.CreateSimpleButton("currentSwatch", "");
          (Se.background = i.lastColor),
            (Se.thickness = 0),
            Se.onPointerClickObservable.add(function () {
              G(b.FromHexString(Se.background), Se.name), X(!1);
            }),
            (Se.pointerDownAnimation = function () {}),
            (Se.pointerUpAnimation = function () {}),
            (Se.pointerEnterAnimation = function () {}),
            (Se.pointerOutAnimation = function () {}),
            ge.addControl(Se, 1, 0);
          var Ce = new cf();
          (Ce.name = "Swatch Outline"),
            (Ce.width = 0.67),
            (Ce.thickness = 2),
            (Ce.color = "#404040"),
            (Ce.isHitTestVisible = !1),
            _e.addControl(Ce, 2, 0);
          var xe = new uf();
          (xe.name = "Current Color Label"),
            (xe.text = "current"),
            (xe.color = D),
            (xe.fontSize = be),
            _e.addControl(xe, 3, 0);
          var Ee = new gf();
          (Ee.name = "Button Grid"), (Ee.height = 0.8);
          var Pe = 1 / 3;
          Ee.addRowDefinition(Pe, !1),
            Ee.addRowDefinition(Pe, !1),
            Ee.addRowDefinition(Pe, !1),
            pe.addControl(Ee, 0, 1),
            (l =
              Math.floor(
                parseInt(i.pickerWidth) * ce[1] * fe[1] * 0.67
              ).toString() + "px"),
            (c =
              Math.floor(
                parseInt(i.pickerHeight) *
                  re[1] *
                  de[0] *
                  (parseFloat(Ee.height.toString()) / 100) *
                  Pe *
                  0.7
              ).toString() + "px"),
            (s =
              parseFloat(l) > parseFloat(c)
                ? Math.floor(0.45 * parseFloat(c))
                : Math.floor(0.11 * parseFloat(l)));
          var Ae = df.CreateSimpleButton("butOK", "OK");
          (Ae.width = l),
            (Ae.height = c),
            (Ae.verticalAlignment = sf.VERTICAL_ALIGNMENT_CENTER),
            (Ae.thickness = 2),
            (Ae.color = D),
            (Ae.fontSize = s),
            (Ae.background = w),
            Ae.onPointerEnterObservable.add(function () {
              Ae.background = N;
            }),
            Ae.onPointerOutObservable.add(function () {
              Ae.background = w;
            }),
            (Ae.pointerDownAnimation = function () {
              Ae.background = L;
            }),
            (Ae.pointerUpAnimation = function () {
              Ae.background = N;
            }),
            Ae.onPointerClickObservable.add(function () {
              X(!1), q(S.background);
            }),
            Ee.addControl(Ae, 0, 0);
          var Re = df.CreateSimpleButton("butCancel", "Cancel");
          if (
            ((Re.width = l),
            (Re.height = c),
            (Re.verticalAlignment = sf.VERTICAL_ALIGNMENT_CENTER),
            (Re.thickness = 2),
            (Re.color = D),
            (Re.fontSize = s),
            (Re.background = w),
            Re.onPointerEnterObservable.add(function () {
              Re.background = N;
            }),
            Re.onPointerOutObservable.add(function () {
              Re.background = w;
            }),
            (Re.pointerDownAnimation = function () {
              Re.background = L;
            }),
            (Re.pointerUpAnimation = function () {
              Re.background = N;
            }),
            Re.onPointerClickObservable.add(function () {
              X(!1), q(Se.background);
            }),
            Ee.addControl(Re, 1, 0),
            i.savedColors)
          ) {
            var Me = df.CreateSimpleButton("butSave", "Save");
            (Me.width = l),
              (Me.height = c),
              (Me.verticalAlignment = sf.VERTICAL_ALIGNMENT_CENTER),
              (Me.thickness = 2),
              (Me.fontSize = s),
              i.savedColors.length < i.swatchLimit
                ? ((Me.color = D), (Me.background = w))
                : Q(Me, !0),
              Me.onPointerEnterObservable.add(function () {
                i.savedColors &&
                  i.savedColors.length < i.swatchLimit &&
                  (Me.background = N);
              }),
              Me.onPointerOutObservable.add(function () {
                i.savedColors &&
                  i.savedColors.length < i.swatchLimit &&
                  (Me.background = w);
              }),
              (Me.pointerDownAnimation = function () {
                i.savedColors &&
                  i.savedColors.length < i.swatchLimit &&
                  (Me.background = L);
              }),
              (Me.pointerUpAnimation = function () {
                i.savedColors &&
                  i.savedColors.length < i.swatchLimit &&
                  (Me.background = N);
              }),
              Me.onPointerClickObservable.add(function () {
                i.savedColors &&
                  (0 == i.savedColors.length && K(!0),
                  i.savedColors.length < i.swatchLimit && Y(S.background, Me),
                  X(!1));
              }),
              i.savedColors.length > 0 && K(!0),
              Ee.addControl(Me, 2, 0);
          }
          var Oe = new gf();
          (Oe.name = "Dialog Lower Right"),
            Oe.addRowDefinition(0.02, !1),
            Oe.addRowDefinition(0.63, !1),
            Oe.addRowDefinition(0.21, !1),
            Oe.addRowDefinition(0.14, !1),
            he.addControl(Oe, 1, 0),
            (u = b.FromHexString(i.lastColor));
          var Ie = new gf();
          for (
            Ie.name = "RGB Values",
              Ie.width = 0.82,
              Ie.verticalAlignment = sf.VERTICAL_ALIGNMENT_CENTER,
              Ie.addRowDefinition(1 / 3, !1),
              Ie.addRowDefinition(1 / 3, !1),
              Ie.addRowDefinition(1 / 3, !1),
              Ie.addColumnDefinition(0.1, !1),
              Ie.addColumnDefinition(0.2, !1),
              Ie.addColumnDefinition(0.7, !1),
              Oe.addControl(Ie, 1, 0),
              te = 0;
            te < V.length;
            te++
          )
            ((De = new uf()).text = V[te]),
              (De.color = D),
              (De.fontSize = s),
              Ie.addControl(De, te, 0);
          ((f = new mf()).width = 0.83),
            (f.height = 0.72),
            (f.name = "rIntField"),
            (f.fontSize = s),
            (f.text = (255 * u.r).toString()),
            (f.color = U),
            (f.background = k),
            f.onFocusObservable.add(function () {
              (x = f.name), (C = f.text), X(!1);
            }),
            f.onBlurObservable.add(function () {
              "" == f.text && (f.text = "0"),
                W(f, "r"),
                x == f.name && (x = "");
            }),
            f.onTextChangedObservable.add(function () {
              x == f.name && W(f, "r");
            }),
            Ie.addControl(f, 0, 1),
            ((_ = new mf()).width = 0.83),
            (_.height = 0.72),
            (_.name = "gIntField"),
            (_.fontSize = s),
            (_.text = (255 * u.g).toString()),
            (_.color = U),
            (_.background = k),
            _.onFocusObservable.add(function () {
              (x = _.name), (C = _.text), X(!1);
            }),
            _.onBlurObservable.add(function () {
              "" == _.text && (_.text = "0"),
                W(_, "g"),
                x == _.name && (x = "");
            }),
            _.onTextChangedObservable.add(function () {
              x == _.name && W(_, "g");
            }),
            Ie.addControl(_, 1, 1),
            ((m = new mf()).width = 0.83),
            (m.height = 0.72),
            (m.name = "bIntField"),
            (m.fontSize = s),
            (m.text = (255 * u.b).toString()),
            (m.color = U),
            (m.background = k),
            m.onFocusObservable.add(function () {
              (x = m.name), (C = m.text), X(!1);
            }),
            m.onBlurObservable.add(function () {
              "" == m.text && (m.text = "0"),
                W(m, "b"),
                x == m.name && (x = "");
            }),
            m.onTextChangedObservable.add(function () {
              x == m.name && W(m, "b");
            }),
            Ie.addControl(m, 2, 1),
            ((g = new mf()).width = 0.95),
            (g.height = 0.72),
            (g.name = "rDecField"),
            (g.fontSize = s),
            (g.text = u.r.toString()),
            (g.color = U),
            (g.background = k),
            g.onFocusObservable.add(function () {
              (x = g.name), (C = g.text), X(!1);
            }),
            g.onBlurObservable.add(function () {
              (0 != parseFloat(g.text) && "" != g.text) ||
                ((g.text = "0"), H(g, "r")),
                x == g.name && (x = "");
            }),
            g.onTextChangedObservable.add(function () {
              x == g.name && H(g, "r");
            }),
            Ie.addControl(g, 0, 2),
            ((v = new mf()).width = 0.95),
            (v.height = 0.72),
            (v.name = "gDecField"),
            (v.fontSize = s),
            (v.text = u.g.toString()),
            (v.color = U),
            (v.background = k),
            v.onFocusObservable.add(function () {
              (x = v.name), (C = v.text), X(!1);
            }),
            v.onBlurObservable.add(function () {
              (0 != parseFloat(v.text) && "" != v.text) ||
                ((v.text = "0"), H(v, "g")),
                x == v.name && (x = "");
            }),
            v.onTextChangedObservable.add(function () {
              x == v.name && H(v, "g");
            }),
            Ie.addControl(v, 1, 2),
            ((y = new mf()).width = 0.95),
            (y.height = 0.72),
            (y.name = "bDecField"),
            (y.fontSize = s),
            (y.text = u.b.toString()),
            (y.color = U),
            (y.background = k),
            y.onFocusObservable.add(function () {
              (x = y.name), (C = y.text), X(!1);
            }),
            y.onBlurObservable.add(function () {
              (0 != parseFloat(y.text) && "" != y.text) ||
                ((y.text = "0"), H(y, "b")),
                x == y.name && (x = "");
            }),
            y.onTextChangedObservable.add(function () {
              x == y.name && H(y, "b");
            }),
            Ie.addControl(y, 2, 2);
          var De,
            we = new gf();
          (we.name = "Hex Value"),
            (we.width = 0.82),
            we.addRowDefinition(1, !1),
            we.addColumnDefinition(0.1, !1),
            we.addColumnDefinition(0.9, !1),
            Oe.addControl(we, 2, 0),
            ((De = new uf()).text = "#"),
            (De.color = D),
            (De.fontSize = s),
            we.addControl(De, 0, 0),
            ((T = new mf()).width = 0.96),
            (T.height = 0.72),
            (T.name = "hexField"),
            (T.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_CENTER),
            (T.fontSize = s);
          var Ne = i.lastColor.split("#");
          (T.text = Ne[1]),
            (T.color = U),
            (T.background = k),
            T.onFocusObservable.add(function () {
              (x = T.name), (C = T.text), X(!1);
            }),
            T.onBlurObservable.add(function () {
              if (3 == T.text.length) {
                var e = T.text.split("");
                T.text = e[0] + e[0] + e[1] + e[1] + e[2] + e[2];
              }
              "" == T.text &&
                ((T.text = "000000"), G(b.FromHexString(T.text), "b")),
                x == T.name && (x = "");
            }),
            T.onTextChangedObservable.add(function () {
              var e = T.text,
                t = /[^0-9A-F]/i.test(e);
              if ((T.text.length > 6 || t) && x == T.name) T.text = C;
              else {
                if (T.text.length < 6)
                  for (var i = 6 - T.text.length, n = 0; n < i; n++)
                    e = "0" + e;
                if (3 == T.text.length) {
                  var r = T.text.split("");
                  e = r[0] + r[0] + r[1] + r[1] + r[2] + r[2];
                }
                (e = "#" + e),
                  x == T.name && ((C = T.text), G(b.FromHexString(e), T.name));
              }
            }),
            we.addControl(T, 0, 1),
            i.savedColors && i.savedColors.length > 0 && Y("", Me);
        });
      }),
      (t._Epsilon = 1e-6),
      t
    );
  })(sf);
  h.RegisteredTypes["BABYLON.GUI.ColorPicker"] = vf;
  var yf = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      return (i.name = t), (i._thickness = 1), i;
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "thickness", {
        get: function () {
          return this._thickness;
        },
        set: function (e) {
          this._thickness !== e && ((this._thickness = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._getTypeName = function () {
        return "Ellipse";
      }),
      (t.prototype._localDraw = function (e) {
        e.save(),
          (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
            ((e.shadowColor = this.shadowColor),
            (e.shadowBlur = this.shadowBlur),
            (e.shadowOffsetX = this.shadowOffsetX),
            (e.shadowOffsetY = this.shadowOffsetY)),
          sf.drawEllipse(
            this._currentMeasure.left + this._currentMeasure.width / 2,
            this._currentMeasure.top + this._currentMeasure.height / 2,
            this._currentMeasure.width / 2 - this._thickness / 2,
            this._currentMeasure.height / 2 - this._thickness / 2,
            e
          ),
          this._background && ((e.fillStyle = this._background), e.fill()),
          (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
            ((e.shadowBlur = 0), (e.shadowOffsetX = 0), (e.shadowOffsetY = 0)),
          this._thickness &&
            (this.color && (e.strokeStyle = this.color),
            (e.lineWidth = this._thickness),
            e.stroke()),
          e.restore();
      }),
      (t.prototype._additionalProcessing = function (t, i) {
        e.prototype._additionalProcessing.call(this, t, i),
          (this._measureForChildren.width -= 2 * this._thickness),
          (this._measureForChildren.height -= 2 * this._thickness),
          (this._measureForChildren.left += this._thickness),
          (this._measureForChildren.top += this._thickness);
      }),
      (t.prototype._clipForChildren = function (e) {
        sf.drawEllipse(
          this._currentMeasure.left + this._currentMeasure.width / 2,
          this._currentMeasure.top + this._currentMeasure.height / 2,
          this._currentMeasure.width / 2,
          this._currentMeasure.height / 2,
          e
        ),
          e.clip();
      }),
      t
    );
  })(af);
  h.RegisteredTypes["BABYLON.GUI.Ellipse"] = yf;
  var bf = (function (e) {
    function t() {
      return (null !== e && e.apply(this, arguments)) || this;
    }
    return (
      P(t, e),
      (t.prototype._beforeRenderText = function (e) {
        for (var t = new _f(), i = "", n = 0; n < e.length; n++) i += "";
        return (t.text = i), t;
      }),
      t
    );
  })(mf);
  h.RegisteredTypes["BABYLON.GUI.InputPassword"] = bf;
  var Tf = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      return (
        (i.name = t),
        (i._lineWidth = 1),
        (i._x1 = new Zp(0)),
        (i._y1 = new Zp(0)),
        (i._x2 = new Zp(0)),
        (i._y2 = new Zp(0)),
        (i._dash = new Array()),
        (i._automaticSize = !0),
        (i.isHitTestVisible = !1),
        (i._horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
        (i._verticalAlignment = sf.VERTICAL_ALIGNMENT_TOP),
        i
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "dash", {
        get: function () {
          return this._dash;
        },
        set: function (e) {
          this._dash !== e && ((this._dash = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "connectedControl", {
        get: function () {
          return this._connectedControl;
        },
        set: function (e) {
          var t = this;
          this._connectedControl !== e &&
            (this._connectedControlDirtyObserver &&
              this._connectedControl &&
              (this._connectedControl.onDirtyObservable.remove(
                this._connectedControlDirtyObserver
              ),
              (this._connectedControlDirtyObserver = null)),
            e &&
              (this._connectedControlDirtyObserver = e.onDirtyObservable.add(
                function () {
                  return t._markAsDirty();
                }
              )),
            (this._connectedControl = e),
            this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "x1", {
        get: function () {
          return this._x1.toString(this._host);
        },
        set: function (e) {
          this._x1.toString(this._host) !== e &&
            this._x1.fromString(e) &&
            this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "y1", {
        get: function () {
          return this._y1.toString(this._host);
        },
        set: function (e) {
          this._y1.toString(this._host) !== e &&
            this._y1.fromString(e) &&
            this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "x2", {
        get: function () {
          return this._x2.toString(this._host);
        },
        set: function (e) {
          this._x2.toString(this._host) !== e &&
            this._x2.fromString(e) &&
            this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "y2", {
        get: function () {
          return this._y2.toString(this._host);
        },
        set: function (e) {
          this._y2.toString(this._host) !== e &&
            this._y2.fromString(e) &&
            this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "lineWidth", {
        get: function () {
          return this._lineWidth;
        },
        set: function (e) {
          this._lineWidth !== e && ((this._lineWidth = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "horizontalAlignment", {
        set: function (e) {},
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "verticalAlignment", {
        set: function (e) {},
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "_effectiveX2", {
        get: function () {
          return (
            (this._connectedControl ? this._connectedControl.centerX : 0) +
            this._x2.getValue(this._host)
          );
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "_effectiveY2", {
        get: function () {
          return (
            (this._connectedControl ? this._connectedControl.centerY : 0) +
            this._y2.getValue(this._host)
          );
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._getTypeName = function () {
        return "Line";
      }),
      (t.prototype._draw = function (e) {
        e.save(),
          (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
            ((e.shadowColor = this.shadowColor),
            (e.shadowBlur = this.shadowBlur),
            (e.shadowOffsetX = this.shadowOffsetX),
            (e.shadowOffsetY = this.shadowOffsetY)),
          this._applyStates(e),
          (e.strokeStyle = this.color),
          (e.lineWidth = this._lineWidth),
          e.setLineDash(this._dash),
          e.beginPath(),
          e.moveTo(
            this._cachedParentMeasure.left + this._x1.getValue(this._host),
            this._cachedParentMeasure.top + this._y1.getValue(this._host)
          ),
          e.lineTo(
            this._cachedParentMeasure.left + this._effectiveX2,
            this._cachedParentMeasure.top + this._effectiveY2
          ),
          e.stroke(),
          e.restore();
      }),
      (t.prototype._measure = function () {
        (this._currentMeasure.width =
          Math.abs(this._x1.getValue(this._host) - this._effectiveX2) +
          this._lineWidth),
          (this._currentMeasure.height =
            Math.abs(this._y1.getValue(this._host) - this._effectiveY2) +
            this._lineWidth);
      }),
      (t.prototype._computeAlignment = function (e, t) {
        (this._currentMeasure.left =
          e.left +
          Math.min(this._x1.getValue(this._host), this._effectiveX2) -
          this._lineWidth / 2),
          (this._currentMeasure.top =
            e.top +
            Math.min(this._y1.getValue(this._host), this._effectiveY2) -
            this._lineWidth / 2);
      }),
      (t.prototype.moveToVector3 = function (e, t, i) {
        if (
          (void 0 === i && (i = !1),
          this._host && this.parent === this._host._rootContainer)
        ) {
          var n = this._host._getGlobalViewport(t),
            r = f.Project(e, g.Identity(), t.getTransformMatrix(), n);
          this._moveToProjectedPosition(r, i),
            r.z < 0 || r.z > 1
              ? (this.notRenderable = !0)
              : (this.notRenderable = !1);
        } else
          yt.Error(
            "Cannot move a control to a vector3 if the control is not at root level"
          );
      }),
      (t.prototype._moveToProjectedPosition = function (e, t) {
        void 0 === t && (t = !1);
        var i = e.x + this._linkOffsetX.getValue(this._host) + "px",
          n = e.y + this._linkOffsetY.getValue(this._host) + "px";
        t
          ? ((this.x2 = i),
            (this.y2 = n),
            (this._x2.ignoreAdaptiveScaling = !0),
            (this._y2.ignoreAdaptiveScaling = !0))
          : ((this.x1 = i),
            (this.y1 = n),
            (this._x1.ignoreAdaptiveScaling = !0),
            (this._y1.ignoreAdaptiveScaling = !0));
      }),
      t
    );
  })(sf);
  h.RegisteredTypes["BABYLON.GUI.Line"] = Tf;
  var Sf = (function () {
      function e(e) {
        (this._multiLine = e),
          (this._x = new Zp(0)),
          (this._y = new Zp(0)),
          (this._point = new f(0, 0, 0));
      }
      return (
        Object.defineProperty(e.prototype, "x", {
          get: function () {
            return this._x.toString(this._multiLine._host);
          },
          set: function (e) {
            this._x.toString(this._multiLine._host) !== e &&
              this._x.fromString(e) &&
              this._multiLine._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "y", {
          get: function () {
            return this._y.toString(this._multiLine._host);
          },
          set: function (e) {
            this._y.toString(this._multiLine._host) !== e &&
              this._y.fromString(e) &&
              this._multiLine._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "control", {
          get: function () {
            return this._control;
          },
          set: function (e) {
            this._control !== e &&
              (this._control &&
                this._controlObserver &&
                (this._control.onDirtyObservable.remove(this._controlObserver),
                (this._controlObserver = null)),
              (this._control = e),
              this._control &&
                (this._controlObserver = this._control.onDirtyObservable.add(
                  this._multiLine.onPointUpdate
                )),
              this._multiLine._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "mesh", {
          get: function () {
            return this._mesh;
          },
          set: function (e) {
            this._mesh !== e &&
              (this._mesh &&
                this._meshObserver &&
                this._mesh
                  .getScene()
                  .onAfterCameraRenderObservable.remove(this._meshObserver),
              (this._mesh = e),
              this._mesh &&
                (this._meshObserver = this._mesh
                  .getScene()
                  .onAfterCameraRenderObservable.add(
                    this._multiLine.onPointUpdate
                  )),
              this._multiLine._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.resetLinks = function () {
          (this.control = null), (this.mesh = null);
        }),
        (e.prototype.translate = function () {
          return (this._point = this._translatePoint()), this._point;
        }),
        (e.prototype._translatePoint = function () {
          if (null != this._mesh)
            return this._multiLine._host.getProjectedPositionWithZ(
              this._mesh.getBoundingInfo().boundingSphere.center,
              this._mesh.getWorldMatrix()
            );
          if (null != this._control)
            return new f(this._control.centerX, this._control.centerY, 0.999);
          var e = this._multiLine._host,
            t = this._x.getValueInPixel(e, Number(e._canvas.width)),
            i = this._y.getValueInPixel(e, Number(e._canvas.height));
          return new f(t, i, 0.999);
        }),
        (e.prototype.dispose = function () {
          this.resetLinks();
        }),
        e
      );
    })(),
    Cf = (function (e) {
      function t(t) {
        var i = e.call(this, t) || this;
        return (
          (i.name = t),
          (i._lineWidth = 1),
          (i.onPointUpdate = function () {
            i._markAsDirty();
          }),
          (i._automaticSize = !0),
          (i.isHitTestVisible = !1),
          (i._horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
          (i._verticalAlignment = sf.VERTICAL_ALIGNMENT_TOP),
          (i._dash = []),
          (i._points = []),
          i
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "dash", {
          get: function () {
            return this._dash;
          },
          set: function (e) {
            this._dash !== e && ((this._dash = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getAt = function (e) {
          return (
            this._points[e] || (this._points[e] = new Sf(this)), this._points[e]
          );
        }),
        (t.prototype.add = function () {
          for (var e = this, t = [], i = 0; i < arguments.length; i++)
            t[i] = arguments[i];
          return t.map(function (t) {
            return e.push(t);
          });
        }),
        (t.prototype.push = function (e) {
          var t = this.getAt(this._points.length);
          return (
            null == e ||
              (e instanceof Yt
                ? (t.mesh = e)
                : e instanceof sf
                  ? (t.control = e)
                  : null != e.x && null != e.y && ((t.x = e.x), (t.y = e.y))),
            t
          );
        }),
        (t.prototype.remove = function (e) {
          var t;
          if (e instanceof Sf) {
            if (-1 === (t = this._points.indexOf(e))) return;
          } else t = e;
          var i = this._points[t];
          i && (i.dispose(), this._points.splice(t, 1));
        }),
        (t.prototype.reset = function () {
          for (; this._points.length > 0; )
            this.remove(this._points.length - 1);
        }),
        (t.prototype.resetLinks = function () {
          this._points.forEach(function (e) {
            null != e && e.resetLinks();
          });
        }),
        Object.defineProperty(t.prototype, "lineWidth", {
          get: function () {
            return this._lineWidth;
          },
          set: function (e) {
            this._lineWidth !== e &&
              ((this._lineWidth = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "horizontalAlignment", {
          set: function (e) {},
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "verticalAlignment", {
          set: function (e) {},
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._getTypeName = function () {
          return "MultiLine";
        }),
        (t.prototype._draw = function (e, t) {
          e.save(),
            (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
              ((e.shadowColor = this.shadowColor),
              (e.shadowBlur = this.shadowBlur),
              (e.shadowOffsetX = this.shadowOffsetX),
              (e.shadowOffsetY = this.shadowOffsetY)),
            this._applyStates(e),
            (e.strokeStyle = this.color),
            (e.lineWidth = this._lineWidth),
            e.setLineDash(this._dash),
            e.beginPath();
          var i,
            n = !0;
          this._points.forEach(function (t) {
            t &&
              (n
                ? (e.moveTo(t._point.x, t._point.y), (n = !1))
                : t._point.z < 1 && i.z < 1
                  ? e.lineTo(t._point.x, t._point.y)
                  : e.moveTo(t._point.x, t._point.y),
              (i = t._point));
          }),
            e.stroke(),
            e.restore();
        }),
        (t.prototype._additionalProcessing = function (e, t) {
          var i = this;
          (this._minX = null),
            (this._minY = null),
            (this._maxX = null),
            (this._maxY = null),
            this._points.forEach(function (e, t) {
              e &&
                (e.translate(),
                (null == i._minX || e._point.x < i._minX) &&
                  (i._minX = e._point.x),
                (null == i._minY || e._point.y < i._minY) &&
                  (i._minY = e._point.y),
                (null == i._maxX || e._point.x > i._maxX) &&
                  (i._maxX = e._point.x),
                (null == i._maxY || e._point.y > i._maxY) &&
                  (i._maxY = e._point.y));
            }),
            null == this._minX && (this._minX = 0),
            null == this._minY && (this._minY = 0),
            null == this._maxX && (this._maxX = 0),
            null == this._maxY && (this._maxY = 0);
        }),
        (t.prototype._measure = function () {
          null != this._minX &&
            null != this._maxX &&
            null != this._minY &&
            null != this._maxY &&
            ((this._currentMeasure.width =
              Math.abs(this._maxX - this._minX) + this._lineWidth),
            (this._currentMeasure.height =
              Math.abs(this._maxY - this._minY) + this._lineWidth));
        }),
        (t.prototype._computeAlignment = function (e, t) {
          null != this._minX &&
            null != this._minY &&
            ((this._currentMeasure.left = this._minX - this._lineWidth / 2),
            (this._currentMeasure.top = this._minY - this._lineWidth / 2));
        }),
        (t.prototype.dispose = function () {
          this.reset(), e.prototype.dispose.call(this);
        }),
        t
      );
    })(sf);
  h.RegisteredTypes["BABYLON.GUI.MultiLine"] = Cf;
  var xf = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      return (
        (i.name = t),
        (i._isChecked = !1),
        (i._background = "black"),
        (i._checkSizeRatio = 0.8),
        (i._thickness = 1),
        (i.group = ""),
        (i.onIsCheckedChangedObservable = new o()),
        (i.isPointerBlocker = !0),
        i
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "thickness", {
        get: function () {
          return this._thickness;
        },
        set: function (e) {
          this._thickness !== e && ((this._thickness = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "checkSizeRatio", {
        get: function () {
          return this._checkSizeRatio;
        },
        set: function (e) {
          (e = Math.max(Math.min(1, e), 0)),
            this._checkSizeRatio !== e &&
              ((this._checkSizeRatio = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "background", {
        get: function () {
          return this._background;
        },
        set: function (e) {
          this._background !== e &&
            ((this._background = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "isChecked", {
        get: function () {
          return this._isChecked;
        },
        set: function (e) {
          var t = this;
          this._isChecked !== e &&
            ((this._isChecked = e),
            this._markAsDirty(),
            this.onIsCheckedChangedObservable.notifyObservers(e),
            this._isChecked &&
              this._host &&
              this._host.executeOnAllControls(function (e) {
                if (e !== t && void 0 !== e.group) {
                  var i = e;
                  i.group === t.group && (i.isChecked = !1);
                }
              }));
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._getTypeName = function () {
        return "RadioButton";
      }),
      (t.prototype._draw = function (e) {
        e.save(), this._applyStates(e);
        var t = this._currentMeasure.width - this._thickness,
          i = this._currentMeasure.height - this._thickness;
        if (
          ((this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
            ((e.shadowColor = this.shadowColor),
            (e.shadowBlur = this.shadowBlur),
            (e.shadowOffsetX = this.shadowOffsetX),
            (e.shadowOffsetY = this.shadowOffsetY)),
          sf.drawEllipse(
            this._currentMeasure.left + this._currentMeasure.width / 2,
            this._currentMeasure.top + this._currentMeasure.height / 2,
            this._currentMeasure.width / 2 - this._thickness / 2,
            this._currentMeasure.height / 2 - this._thickness / 2,
            e
          ),
          (e.fillStyle = this._isEnabled
            ? this._background
            : this._disabledColor),
          e.fill(),
          (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
            ((e.shadowBlur = 0), (e.shadowOffsetX = 0), (e.shadowOffsetY = 0)),
          (e.strokeStyle = this.color),
          (e.lineWidth = this._thickness),
          e.stroke(),
          this._isChecked)
        ) {
          e.fillStyle = this._isEnabled ? this.color : this._disabledColor;
          var n = t * this._checkSizeRatio,
            r = i * this._checkSizeRatio;
          sf.drawEllipse(
            this._currentMeasure.left + this._currentMeasure.width / 2,
            this._currentMeasure.top + this._currentMeasure.height / 2,
            n / 2 - this._thickness / 2,
            r / 2 - this._thickness / 2,
            e
          ),
            e.fill();
        }
        e.restore();
      }),
      (t.prototype._onPointerDown = function (t, i, n, r, o) {
        return (
          !!e.prototype._onPointerDown.call(this, t, i, n, r, o) &&
          (this.isChecked || (this.isChecked = !0), !0)
        );
      }),
      (t.AddRadioButtonWithHeader = function (e, i, n, r) {
        var o = new pf();
        (o.isVertical = !1), (o.height = "30px");
        var s = new t();
        (s.width = "20px"),
          (s.height = "20px"),
          (s.isChecked = n),
          (s.color = "green"),
          (s.group = i),
          s.onIsCheckedChangedObservable.add(function (e) {
            return r(s, e);
          }),
          o.addControl(s);
        var a = new uf();
        return (
          (a.text = e),
          (a.width = "180px"),
          (a.paddingLeft = "5px"),
          (a.textHorizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
          (a.color = "white"),
          o.addControl(a),
          o
        );
      }),
      t
    );
  })(sf);
  h.RegisteredTypes["BABYLON.GUI.RadioButton"] = xf;
  var Ef = (function (e) {
      function t(t) {
        var i = e.call(this, t) || this;
        return (
          (i.name = t),
          (i._thumbWidth = new Zp(20, Zp.UNITMODE_PIXEL, !1)),
          (i._minimum = 0),
          (i._maximum = 100),
          (i._value = 50),
          (i._isVertical = !1),
          (i._barOffset = new Zp(5, Zp.UNITMODE_PIXEL, !1)),
          (i._isThumbClamped = !1),
          (i._displayThumb = !0),
          (i._step = 0),
          (i._lastPointerDownID = -1),
          (i._effectiveBarOffset = 0),
          (i.onValueChangedObservable = new o()),
          (i._pointerIsDown = !1),
          (i.isPointerBlocker = !0),
          i
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "displayThumb", {
          get: function () {
            return this._displayThumb;
          },
          set: function (e) {
            this._displayThumb !== e &&
              ((this._displayThumb = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "step", {
          get: function () {
            return this._step;
          },
          set: function (e) {
            this._step !== e && ((this._step = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "barOffset", {
          get: function () {
            return this._barOffset.toString(this._host);
          },
          set: function (e) {
            this._barOffset.toString(this._host) !== e &&
              this._barOffset.fromString(e) &&
              this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "barOffsetInPixels", {
          get: function () {
            return this._barOffset.getValueInPixel(
              this._host,
              this._cachedParentMeasure.width
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "thumbWidth", {
          get: function () {
            return this._thumbWidth.toString(this._host);
          },
          set: function (e) {
            this._thumbWidth.toString(this._host) !== e &&
              this._thumbWidth.fromString(e) &&
              this._markAsDirty();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "thumbWidthInPixels", {
          get: function () {
            return this._thumbWidth.getValueInPixel(
              this._host,
              this._cachedParentMeasure.width
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "minimum", {
          get: function () {
            return this._minimum;
          },
          set: function (e) {
            this._minimum !== e &&
              ((this._minimum = e),
              this._markAsDirty(),
              (this.value = Math.max(
                Math.min(this.value, this._maximum),
                this._minimum
              )));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "maximum", {
          get: function () {
            return this._maximum;
          },
          set: function (e) {
            this._maximum !== e &&
              ((this._maximum = e),
              this._markAsDirty(),
              (this.value = Math.max(
                Math.min(this.value, this._maximum),
                this._minimum
              )));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "value", {
          get: function () {
            return this._value;
          },
          set: function (e) {
            (e = Math.max(Math.min(e, this._maximum), this._minimum)),
              this._value !== e &&
                ((this._value = e),
                this._markAsDirty(),
                this.onValueChangedObservable.notifyObservers(this._value));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "isVertical", {
          get: function () {
            return this._isVertical;
          },
          set: function (e) {
            this._isVertical !== e &&
              ((this._isVertical = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "isThumbClamped", {
          get: function () {
            return this._isThumbClamped;
          },
          set: function (e) {
            this._isThumbClamped !== e &&
              ((this._isThumbClamped = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._getTypeName = function () {
          return "BaseSlider";
        }),
        (t.prototype._getThumbPosition = function () {
          return this.isVertical
            ? ((this.maximum - this.value) / (this.maximum - this.minimum)) *
                this._backgroundBoxLength
            : ((this.value - this.minimum) / (this.maximum - this.minimum)) *
                this._backgroundBoxLength;
        }),
        (t.prototype._getThumbThickness = function (e) {
          var t = 0;
          switch (e) {
            case "circle":
              t = this._thumbWidth.isPixel
                ? Math.max(
                    this._thumbWidth.getValue(this._host),
                    this._backgroundBoxThickness
                  )
                : this._backgroundBoxThickness *
                  this._thumbWidth.getValue(this._host);
              break;
            case "rectangle":
              t = this._thumbWidth.isPixel
                ? Math.min(
                    this._thumbWidth.getValue(this._host),
                    this._backgroundBoxThickness
                  )
                : this._backgroundBoxThickness *
                  this._thumbWidth.getValue(this._host);
          }
          return t;
        }),
        (t.prototype._prepareRenderingData = function (e) {
          (this._effectiveBarOffset = 0),
            (this._renderLeft = this._currentMeasure.left),
            (this._renderTop = this._currentMeasure.top),
            (this._renderWidth = this._currentMeasure.width),
            (this._renderHeight = this._currentMeasure.height),
            (this._backgroundBoxLength = Math.max(
              this._currentMeasure.width,
              this._currentMeasure.height
            )),
            (this._backgroundBoxThickness = Math.min(
              this._currentMeasure.width,
              this._currentMeasure.height
            )),
            (this._effectiveThumbThickness = this._getThumbThickness(e)),
            this.displayThumb &&
              (this._backgroundBoxLength -= this._effectiveThumbThickness),
            this.isVertical &&
            this._currentMeasure.height < this._currentMeasure.width
              ? console.error("Height should be greater than width")
              : (this._barOffset.isPixel
                  ? (this._effectiveBarOffset = Math.min(
                      this._barOffset.getValue(this._host),
                      this._backgroundBoxThickness
                    ))
                  : (this._effectiveBarOffset =
                      this._backgroundBoxThickness *
                      this._barOffset.getValue(this._host)),
                (this._backgroundBoxThickness -= 2 * this._effectiveBarOffset),
                this.isVertical
                  ? ((this._renderLeft += this._effectiveBarOffset),
                    !this.isThumbClamped &&
                      this.displayThumb &&
                      (this._renderTop += this._effectiveThumbThickness / 2),
                    (this._renderHeight = this._backgroundBoxLength),
                    (this._renderWidth = this._backgroundBoxThickness))
                  : ((this._renderTop += this._effectiveBarOffset),
                    !this.isThumbClamped &&
                      this.displayThumb &&
                      (this._renderLeft += this._effectiveThumbThickness / 2),
                    (this._renderHeight = this._backgroundBoxThickness),
                    (this._renderWidth = this._backgroundBoxLength)));
        }),
        (t.prototype._updateValueFromPointer = function (e, t) {
          var i;
          0 != this.rotation &&
            (this._invertTransformMatrix.transformCoordinates(
              e,
              t,
              this._transformedPosition
            ),
            (e = this._transformedPosition.x),
            (t = this._transformedPosition.y)),
            (i = this._isVertical
              ? this._minimum +
                (1 -
                  (t - this._currentMeasure.top) /
                    this._currentMeasure.height) *
                  (this._maximum - this._minimum)
              : this._minimum +
                ((e - this._currentMeasure.left) / this._currentMeasure.width) *
                  (this._maximum - this._minimum));
          var n = (1 / this._step) | 0;
          this.value = this._step ? ((i * n) | 0) / n : i;
        }),
        (t.prototype._onPointerDown = function (t, i, n, r, o) {
          return (
            !!e.prototype._onPointerDown.call(this, t, i, n, r, o) &&
            ((this._pointerIsDown = !0),
            this._updateValueFromPointer(i.x, i.y),
            (this._host._capturingControl[n] = this),
            (this._lastPointerDownID = n),
            !0)
          );
        }),
        (t.prototype._onPointerMove = function (t, i, n, r) {
          n == this._lastPointerDownID &&
            (this._pointerIsDown && this._updateValueFromPointer(i.x, i.y),
            e.prototype._onPointerMove.call(this, t, i, n, r));
        }),
        (t.prototype._onPointerUp = function (t, i, n, r, o) {
          (this._pointerIsDown = !1),
            delete this._host._capturingControl[n],
            e.prototype._onPointerUp.call(this, t, i, n, r, o);
        }),
        (t.prototype._onCanvasBlur = function () {
          this._forcePointerUp(), e.prototype._onCanvasBlur.call(this);
        }),
        t
      );
    })(sf),
    Pf = (function (e) {
      function t(t) {
        var i = e.call(this, t) || this;
        return (
          (i.name = t),
          (i._background = "black"),
          (i._borderColor = "white"),
          (i._thumbColor = ""),
          (i._isThumbCircle = !1),
          (i._displayValueBar = !0),
          i
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "displayValueBar", {
          get: function () {
            return this._displayValueBar;
          },
          set: function (e) {
            this._displayValueBar !== e &&
              ((this._displayValueBar = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "borderColor", {
          get: function () {
            return this._borderColor;
          },
          set: function (e) {
            this._borderColor !== e &&
              ((this._borderColor = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "background", {
          get: function () {
            return this._background;
          },
          set: function (e) {
            this._background !== e &&
              ((this._background = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "thumbColor", {
          get: function () {
            return this._thumbColor;
          },
          set: function (e) {
            this._thumbColor !== e &&
              ((this._thumbColor = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "isThumbCircle", {
          get: function () {
            return this._isThumbCircle;
          },
          set: function (e) {
            this._isThumbCircle !== e &&
              ((this._isThumbCircle = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._getTypeName = function () {
          return "Slider";
        }),
        (t.prototype._draw = function (e, t) {
          e.save(),
            this._applyStates(e),
            this._prepareRenderingData(
              this.isThumbCircle ? "circle" : "rectangle"
            );
          var i = this._renderLeft,
            n = this._renderTop,
            r = this._renderWidth,
            o = this._renderHeight,
            s = 0;
          this.isThumbClamped && this.isThumbCircle
            ? (this.isVertical
                ? (n += this._effectiveThumbThickness / 2)
                : (i += this._effectiveThumbThickness / 2),
              (s = this._backgroundBoxThickness / 2))
            : (s =
                (this._effectiveThumbThickness - this._effectiveBarOffset) / 2),
            (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
              ((e.shadowColor = this.shadowColor),
              (e.shadowBlur = this.shadowBlur),
              (e.shadowOffsetX = this.shadowOffsetX),
              (e.shadowOffsetY = this.shadowOffsetY));
          var a = this._getThumbPosition();
          (e.fillStyle = this._background),
            this.isVertical
              ? this.isThumbClamped
                ? this.isThumbCircle
                  ? (e.beginPath(),
                    e.arc(
                      i + this._backgroundBoxThickness / 2,
                      n,
                      s,
                      Math.PI,
                      2 * Math.PI
                    ),
                    e.fill(),
                    e.fillRect(i, n, r, o))
                  : e.fillRect(i, n, r, o + this._effectiveThumbThickness)
                : e.fillRect(i, n, r, o)
              : this.isThumbClamped
                ? this.isThumbCircle
                  ? (e.beginPath(),
                    e.arc(
                      i + this._backgroundBoxLength,
                      n + this._backgroundBoxThickness / 2,
                      s,
                      0,
                      2 * Math.PI
                    ),
                    e.fill(),
                    e.fillRect(i, n, r, o))
                  : e.fillRect(i, n, r + this._effectiveThumbThickness, o)
                : e.fillRect(i, n, r, o),
            (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
              ((e.shadowBlur = 0),
              (e.shadowOffsetX = 0),
              (e.shadowOffsetY = 0)),
            (e.fillStyle = this.color),
            this._displayValueBar &&
              (this.isVertical
                ? this.isThumbClamped
                  ? this.isThumbCircle
                    ? (e.beginPath(),
                      e.arc(
                        i + this._backgroundBoxThickness / 2,
                        n + this._backgroundBoxLength,
                        s,
                        0,
                        2 * Math.PI
                      ),
                      e.fill(),
                      e.fillRect(i, n + a, r, o - a))
                    : e.fillRect(
                        i,
                        n + a,
                        r,
                        o - a + this._effectiveThumbThickness
                      )
                  : e.fillRect(i, n + a, r, o - a)
                : this.isThumbClamped && this.isThumbCircle
                  ? (e.beginPath(),
                    e.arc(
                      i,
                      n + this._backgroundBoxThickness / 2,
                      s,
                      0,
                      2 * Math.PI
                    ),
                    e.fill(),
                    e.fillRect(i, n, a, o))
                  : e.fillRect(i, n, a, o)),
            (e.fillStyle = this._thumbColor || this.color),
            this.displayThumb &&
              ((this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) &&
                ((e.shadowColor = this.shadowColor),
                (e.shadowBlur = this.shadowBlur),
                (e.shadowOffsetX = this.shadowOffsetX),
                (e.shadowOffsetY = this.shadowOffsetY)),
              this._isThumbCircle
                ? (e.beginPath(),
                  this.isVertical
                    ? e.arc(
                        i + this._backgroundBoxThickness / 2,
                        n + a,
                        s,
                        0,
                        2 * Math.PI
                      )
                    : e.arc(
                        i + a,
                        n + this._backgroundBoxThickness / 2,
                        s,
                        0,
                        2 * Math.PI
                      ),
                  e.fill(),
                  (this.shadowBlur ||
                    this.shadowOffsetX ||
                    this.shadowOffsetY) &&
                    ((e.shadowBlur = 0),
                    (e.shadowOffsetX = 0),
                    (e.shadowOffsetY = 0)),
                  (e.strokeStyle = this._borderColor),
                  e.stroke())
                : (this.isVertical
                    ? e.fillRect(
                        i - this._effectiveBarOffset,
                        this._currentMeasure.top + a,
                        this._currentMeasure.width,
                        this._effectiveThumbThickness
                      )
                    : e.fillRect(
                        this._currentMeasure.left + a,
                        this._currentMeasure.top,
                        this._effectiveThumbThickness,
                        this._currentMeasure.height
                      ),
                  (this.shadowBlur ||
                    this.shadowOffsetX ||
                    this.shadowOffsetY) &&
                    ((e.shadowBlur = 0),
                    (e.shadowOffsetX = 0),
                    (e.shadowOffsetY = 0)),
                  (e.strokeStyle = this._borderColor),
                  this.isVertical
                    ? e.strokeRect(
                        i - this._effectiveBarOffset,
                        this._currentMeasure.top + a,
                        this._currentMeasure.width,
                        this._effectiveThumbThickness
                      )
                    : e.strokeRect(
                        this._currentMeasure.left + a,
                        this._currentMeasure.top,
                        this._effectiveThumbThickness,
                        this._currentMeasure.height
                      ))),
            e.restore();
        }),
        t
      );
    })(Ef);
  h.RegisteredTypes["BABYLON.GUI.Slider"] = Pf;
  var Af = (function () {
      function e(e) {
        (this.name = e),
          (this._groupPanel = new pf()),
          (this._selectors = new Array()),
          (this._groupPanel.verticalAlignment = sf.VERTICAL_ALIGNMENT_TOP),
          (this._groupPanel.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
          (this._groupHeader = this._addGroupHeader(e));
      }
      return (
        Object.defineProperty(e.prototype, "groupPanel", {
          get: function () {
            return this._groupPanel;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "selectors", {
          get: function () {
            return this._selectors;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "header", {
          get: function () {
            return this._groupHeader.text;
          },
          set: function (e) {
            "label" !== this._groupHeader.text && (this._groupHeader.text = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype._addGroupHeader = function (e) {
          var t = new uf("groupHead", e);
          return (
            (t.width = 0.9),
            (t.height = "30px"),
            (t.textWrapping = !0),
            (t.color = "black"),
            (t.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
            (t.textHorizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
            (t.left = "2px"),
            this._groupPanel.addControl(t),
            t
          );
        }),
        (e.prototype._getSelector = function (e) {
          if (!(e < 0 || e >= this._selectors.length))
            return this._selectors[e];
        }),
        (e.prototype.removeSelector = function (e) {
          e < 0 ||
            e >= this._selectors.length ||
            (this._groupPanel.removeControl(this._selectors[e]),
            this._selectors.splice(e, 1));
        }),
        e
      );
    })(),
    Rf =
      ((function (e) {
        function t() {
          return (null !== e && e.apply(this, arguments)) || this;
        }
        P(t, e),
          (t.prototype.addCheckbox = function (e, t, i) {
            void 0 === t && (t = function (e) {}),
              void 0 === i && (i = !1),
              (i = i || !1);
            var n = new ff();
            (n.width = "20px"),
              (n.height = "20px"),
              (n.color = "#364249"),
              (n.background = "#CCCCCC"),
              (n.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
              n.onIsCheckedChangedObservable.add(function (e) {
                t(e);
              });
            var r = sf.AddHeader(n, e, "200px", {
              isHorizontal: !0,
              controlFirst: !0,
            });
            (r.height = "30px"),
              (r.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
              (r.left = "4px"),
              this.groupPanel.addControl(r),
              this.selectors.push(r),
              (n.isChecked = i),
              this.groupPanel.parent &&
                this.groupPanel.parent.parent &&
                ((n.color = this.groupPanel.parent.parent.buttonColor),
                (n.background =
                  this.groupPanel.parent.parent.buttonBackground));
          }),
          (t.prototype._setSelectorLabel = function (e, t) {
            this.selectors[e].children[1].text = t;
          }),
          (t.prototype._setSelectorLabelColor = function (e, t) {
            this.selectors[e].children[1].color = t;
          }),
          (t.prototype._setSelectorButtonColor = function (e, t) {
            this.selectors[e].children[0].color = t;
          }),
          (t.prototype._setSelectorButtonBackground = function (e, t) {
            this.selectors[e].children[0].background = t;
          });
      })(Af),
      (function (e) {
        function t() {
          var t = (null !== e && e.apply(this, arguments)) || this;
          return (t._selectNb = 0), t;
        }
        P(t, e),
          (t.prototype.addRadio = function (e, t, i) {
            void 0 === t && (t = function (e) {}), void 0 === i && (i = !1);
            var n = this._selectNb++,
              r = new xf();
            (r.name = e),
              (r.width = "20px"),
              (r.height = "20px"),
              (r.color = "#364249"),
              (r.background = "#CCCCCC"),
              (r.group = this.name),
              (r.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
              r.onIsCheckedChangedObservable.add(function (e) {
                e && t(n);
              });
            var o = sf.AddHeader(r, e, "200px", {
              isHorizontal: !0,
              controlFirst: !0,
            });
            (o.height = "30px"),
              (o.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
              (o.left = "4px"),
              this.groupPanel.addControl(o),
              this.selectors.push(o),
              (r.isChecked = i),
              this.groupPanel.parent &&
                this.groupPanel.parent.parent &&
                ((r.color = this.groupPanel.parent.parent.buttonColor),
                (r.background =
                  this.groupPanel.parent.parent.buttonBackground));
          }),
          (t.prototype._setSelectorLabel = function (e, t) {
            this.selectors[e].children[1].text = t;
          }),
          (t.prototype._setSelectorLabelColor = function (e, t) {
            this.selectors[e].children[1].color = t;
          }),
          (t.prototype._setSelectorButtonColor = function (e, t) {
            this.selectors[e].children[0].color = t;
          }),
          (t.prototype._setSelectorButtonBackground = function (e, t) {
            this.selectors[e].children[0].background = t;
          });
      })(Af),
      (function (e) {
        function t() {
          return (null !== e && e.apply(this, arguments)) || this;
        }
        P(t, e),
          (t.prototype.addSlider = function (e, t, i, n, r, o, s) {
            void 0 === t && (t = function (e) {}),
              void 0 === i && (i = "Units"),
              void 0 === n && (n = 0),
              void 0 === r && (r = 0),
              void 0 === o && (o = 0),
              void 0 === s &&
                (s = function (e) {
                  return 0 | e;
                });
            var a = new Pf();
            (a.name = i),
              (a.value = o),
              (a.minimum = n),
              (a.maximum = r),
              (a.width = 0.9),
              (a.height = "20px"),
              (a.color = "#364249"),
              (a.background = "#CCCCCC"),
              (a.borderColor = "black"),
              (a.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
              (a.left = "4px"),
              (a.paddingBottom = "4px"),
              a.onValueChangedObservable.add(function (e) {
                (a.parent.children[0].text =
                  a.parent.children[0].name + ": " + s(e) + " " + a.name),
                  t(e);
              });
            var l = sf.AddHeader(a, e + ": " + s(o) + " " + i, "30px", {
              isHorizontal: !1,
              controlFirst: !1,
            });
            (l.height = "60px"),
              (l.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
              (l.left = "4px"),
              (l.children[0].name = e),
              this.groupPanel.addControl(l),
              this.selectors.push(l),
              this.groupPanel.parent &&
                this.groupPanel.parent.parent &&
                ((a.color = this.groupPanel.parent.parent.buttonColor),
                (a.background =
                  this.groupPanel.parent.parent.buttonBackground));
          }),
          (t.prototype._setSelectorLabel = function (e, t) {
            (this.selectors[e].children[0].name = t),
              (this.selectors[e].children[0].text =
                t +
                ": " +
                this.selectors[e].children[1].value +
                " " +
                this.selectors[e].children[1].name);
          }),
          (t.prototype._setSelectorLabelColor = function (e, t) {
            this.selectors[e].children[0].color = t;
          }),
          (t.prototype._setSelectorButtonColor = function (e, t) {
            this.selectors[e].children[1].color = t;
          }),
          (t.prototype._setSelectorButtonBackground = function (e, t) {
            this.selectors[e].children[1].background = t;
          });
      })(Af),
      (function (e) {
        function t(t, i) {
          void 0 === i && (i = []);
          var n = e.call(this, t) || this;
          if (
            ((n.name = t),
            (n.groups = i),
            (n._buttonColor = "#364249"),
            (n._buttonBackground = "#CCCCCC"),
            (n._headerColor = "black"),
            (n._barColor = "white"),
            (n._barHeight = "2px"),
            (n._spacerHeight = "20px"),
            (n._bars = new Array()),
            (n._groups = i),
            (n.thickness = 2),
            (n._panel = new pf()),
            (n._panel.verticalAlignment = sf.VERTICAL_ALIGNMENT_TOP),
            (n._panel.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
            (n._panel.top = 5),
            (n._panel.left = 5),
            (n._panel.width = 0.95),
            i.length > 0)
          ) {
            for (var r = 0; r < i.length - 1; r++)
              n._panel.addControl(i[r].groupPanel), n._addSpacer();
            n._panel.addControl(i[i.length - 1].groupPanel);
          }
          return n.addControl(n._panel), n;
        }
        P(t, e),
          (t.prototype._getTypeName = function () {
            return "SelectionPanel";
          }),
          Object.defineProperty(t.prototype, "panel", {
            get: function () {
              return this._panel;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(t.prototype, "headerColor", {
            get: function () {
              return this._headerColor;
            },
            set: function (e) {
              this._headerColor !== e &&
                ((this._headerColor = e), this._setHeaderColor());
            },
            enumerable: !1,
            configurable: !0,
          }),
          (t.prototype._setHeaderColor = function () {
            for (var e = 0; e < this._groups.length; e++)
              this._groups[e].groupPanel.children[0].color = this._headerColor;
          }),
          Object.defineProperty(t.prototype, "buttonColor", {
            get: function () {
              return this._buttonColor;
            },
            set: function (e) {
              this._buttonColor !== e &&
                ((this._buttonColor = e), this._setbuttonColor());
            },
            enumerable: !1,
            configurable: !0,
          }),
          (t.prototype._setbuttonColor = function () {
            for (var e = 0; e < this._groups.length; e++)
              for (var t = 0; t < this._groups[e].selectors.length; t++)
                this._groups[e]._setSelectorButtonColor(t, this._buttonColor);
          }),
          Object.defineProperty(t.prototype, "labelColor", {
            get: function () {
              return this._labelColor;
            },
            set: function (e) {
              this._labelColor !== e &&
                ((this._labelColor = e), this._setLabelColor());
            },
            enumerable: !1,
            configurable: !0,
          }),
          (t.prototype._setLabelColor = function () {
            for (var e = 0; e < this._groups.length; e++)
              for (var t = 0; t < this._groups[e].selectors.length; t++)
                this._groups[e]._setSelectorLabelColor(t, this._labelColor);
          }),
          Object.defineProperty(t.prototype, "buttonBackground", {
            get: function () {
              return this._buttonBackground;
            },
            set: function (e) {
              this._buttonBackground !== e &&
                ((this._buttonBackground = e), this._setButtonBackground());
            },
            enumerable: !1,
            configurable: !0,
          }),
          (t.prototype._setButtonBackground = function () {
            for (var e = 0; e < this._groups.length; e++)
              for (var t = 0; t < this._groups[e].selectors.length; t++)
                this._groups[e]._setSelectorButtonBackground(
                  t,
                  this._buttonBackground
                );
          }),
          Object.defineProperty(t.prototype, "barColor", {
            get: function () {
              return this._barColor;
            },
            set: function (e) {
              this._barColor !== e &&
                ((this._barColor = e), this._setBarColor());
            },
            enumerable: !1,
            configurable: !0,
          }),
          (t.prototype._setBarColor = function () {
            for (var e = 0; e < this._bars.length; e++)
              this._bars[e].children[0].background = this._barColor;
          }),
          Object.defineProperty(t.prototype, "barHeight", {
            get: function () {
              return this._barHeight;
            },
            set: function (e) {
              this._barHeight !== e &&
                ((this._barHeight = e), this._setBarHeight());
            },
            enumerable: !1,
            configurable: !0,
          }),
          (t.prototype._setBarHeight = function () {
            for (var e = 0; e < this._bars.length; e++)
              this._bars[e].children[0].height = this._barHeight;
          }),
          Object.defineProperty(t.prototype, "spacerHeight", {
            get: function () {
              return this._spacerHeight;
            },
            set: function (e) {
              this._spacerHeight !== e &&
                ((this._spacerHeight = e), this._setSpacerHeight());
            },
            enumerable: !1,
            configurable: !0,
          }),
          (t.prototype._setSpacerHeight = function () {
            for (var e = 0; e < this._bars.length; e++)
              this._bars[e].height = this._spacerHeight;
          }),
          (t.prototype._addSpacer = function () {
            var e = new af();
            (e.width = 1),
              (e.height = this._spacerHeight),
              (e.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT);
            var t = new cf();
            (t.width = 1),
              (t.height = this._barHeight),
              (t.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
              (t.verticalAlignment = sf.VERTICAL_ALIGNMENT_CENTER),
              (t.background = this._barColor),
              (t.color = "transparent"),
              e.addControl(t),
              this._panel.addControl(e),
              this._bars.push(e);
          }),
          (t.prototype.addGroup = function (e) {
            this._groups.length > 0 && this._addSpacer(),
              this._panel.addControl(e.groupPanel),
              this._groups.push(e),
              (e.groupPanel.children[0].color = this._headerColor);
            for (var t = 0; t < e.selectors.length; t++)
              e._setSelectorButtonColor(t, this._buttonColor),
                e._setSelectorButtonBackground(t, this._buttonBackground);
          }),
          (t.prototype.removeGroup = function (e) {
            if (!(e < 0 || e >= this._groups.length)) {
              var t = this._groups[e];
              this._panel.removeControl(t.groupPanel),
                this._groups.splice(e, 1),
                e < this._bars.length &&
                  (this._panel.removeControl(this._bars[e]),
                  this._bars.splice(e, 1));
            }
          }),
          (t.prototype.setHeaderName = function (e, t) {
            t < 0 ||
              t >= this._groups.length ||
              (this._groups[t].groupPanel.children[0].text = e);
          }),
          (t.prototype.relabel = function (e, t, i) {
            if (!(t < 0 || t >= this._groups.length)) {
              var n = this._groups[t];
              i < 0 || i >= n.selectors.length || n._setSelectorLabel(i, e);
            }
          }),
          (t.prototype.removeFromGroupSelector = function (e, t) {
            if (!(e < 0 || e >= this._groups.length)) {
              var i = this._groups[e];
              t < 0 || t >= i.selectors.length || i.removeSelector(t);
            }
          }),
          (t.prototype.addToGroupCheckbox = function (e, t, i, n) {
            void 0 === i && (i = function () {}),
              void 0 === n && (n = !1),
              e < 0 ||
                e >= this._groups.length ||
                this._groups[e].addCheckbox(t, i, n);
          }),
          (t.prototype.addToGroupRadio = function (e, t, i, n) {
            void 0 === i && (i = function () {}),
              void 0 === n && (n = !1),
              e < 0 ||
                e >= this._groups.length ||
                this._groups[e].addRadio(t, i, n);
          }),
          (t.prototype.addToGroupSlider = function (e, t, i, n, r, o, s, a) {
            void 0 === i && (i = function () {}),
              void 0 === n && (n = "Units"),
              void 0 === r && (r = 0),
              void 0 === o && (o = 0),
              void 0 === s && (s = 0),
              void 0 === a &&
                (a = function (e) {
                  return 0 | e;
                }),
              e < 0 ||
                e >= this._groups.length ||
                this._groups[e].addSlider(t, i, n, r, o, s, a);
          });
      })(cf),
      (function (e) {
        function t(t) {
          var i = e.call(this, t) || this;
          return (
            (i._freezeControls = !1),
            (i._bucketWidth = 0),
            (i._bucketHeight = 0),
            (i._buckets = {}),
            i
          );
        }
        return (
          P(t, e),
          Object.defineProperty(t.prototype, "freezeControls", {
            get: function () {
              return this._freezeControls;
            },
            set: function (e) {
              if (this._freezeControls !== e) {
                e || this._restoreMeasures(), (this._freezeControls = !1);
                var t = this.host.getSize(),
                  i = t.width,
                  n = t.height,
                  r = this.host.getContext(),
                  o = new nf(0, 0, i, n);
                (this.host._numLayoutCalls = 0),
                  this.host._rootContainer._layout(o, r),
                  e &&
                    (this._updateMeasures(),
                    this._useBuckets() && this._makeBuckets()),
                  (this._freezeControls = e),
                  this.host.markAsDirty();
              }
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(t.prototype, "bucketWidth", {
            get: function () {
              return this._bucketWidth;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(t.prototype, "bucketHeight", {
            get: function () {
              return this._bucketHeight;
            },
            enumerable: !1,
            configurable: !0,
          }),
          (t.prototype.setBucketSizes = function (e, t) {
            (this._bucketWidth = e),
              (this._bucketHeight = t),
              this._useBuckets()
                ? this._freezeControls && this._makeBuckets()
                : (this._buckets = {});
          }),
          (t.prototype._useBuckets = function () {
            return this._bucketWidth > 0 && this._bucketHeight > 0;
          }),
          (t.prototype._makeBuckets = function () {
            (this._buckets = {}),
              (this._bucketLen = Math.ceil(
                this.widthInPixels / this._bucketWidth
              )),
              this._dispatchInBuckets(this._children),
              (this._oldLeft = null),
              (this._oldTop = null);
          }),
          (t.prototype._dispatchInBuckets = function (e) {
            for (var t = 0; t < e.length; ++t) {
              for (
                var i = e[t],
                  n = Math.max(
                    0,
                    Math.floor(
                      (i._customData._origLeft - this._customData.origLeft) /
                        this._bucketWidth
                    )
                  ),
                  r = Math.floor(
                    (i._customData._origLeft -
                      this._customData.origLeft +
                      i._currentMeasure.width -
                      1) /
                      this._bucketWidth
                  ),
                  o = Math.max(
                    0,
                    Math.floor(
                      (i._customData._origTop - this._customData.origTop) /
                        this._bucketHeight
                    )
                  ),
                  s = Math.floor(
                    (i._customData._origTop -
                      this._customData.origTop +
                      i._currentMeasure.height -
                      1) /
                      this._bucketHeight
                  );
                o <= s;

              ) {
                for (var a = n; a <= r; ++a) {
                  var l = o * this._bucketLen + a,
                    c = this._buckets[l];
                  c || ((c = []), (this._buckets[l] = c)), c.push(i);
                }
                o++;
              }
              i instanceof af &&
                i._children.length > 0 &&
                this._dispatchInBuckets(i._children);
            }
          }),
          (t.prototype._updateMeasures = function () {
            var e = 0 | this.leftInPixels,
              t = 0 | this.topInPixels;
            (this._measureForChildren.left -= e),
              (this._measureForChildren.top -= t),
              (this._currentMeasure.left -= e),
              (this._currentMeasure.top -= t),
              (this._customData.origLeftForChildren =
                this._measureForChildren.left),
              (this._customData.origTopForChildren =
                this._measureForChildren.top),
              (this._customData.origLeft = this._currentMeasure.left),
              (this._customData.origTop = this._currentMeasure.top),
              this._updateChildrenMeasures(this._children, e, t);
          }),
          (t.prototype._updateChildrenMeasures = function (e, t, i) {
            for (var n = 0; n < e.length; ++n) {
              var r = e[n];
              (r._currentMeasure.left -= t),
                (r._currentMeasure.top -= i),
                (r._customData._origLeft = r._currentMeasure.left),
                (r._customData._origTop = r._currentMeasure.top),
                r instanceof af &&
                  r._children.length > 0 &&
                  this._updateChildrenMeasures(r._children, t, i);
            }
          }),
          (t.prototype._restoreMeasures = function () {
            var e = 0 | this.leftInPixels,
              t = 0 | this.topInPixels;
            (this._measureForChildren.left =
              this._customData.origLeftForChildren + e),
              (this._measureForChildren.top =
                this._customData.origTopForChildren + t),
              (this._currentMeasure.left = this._customData.origLeft + e),
              (this._currentMeasure.top = this._customData.origTop + t);
          }),
          (t.prototype._getTypeName = function () {
            return "ScrollViewerWindow";
          }),
          (t.prototype._additionalProcessing = function (t, i) {
            e.prototype._additionalProcessing.call(this, t, i),
              (this._parentMeasure = t),
              (this._measureForChildren.left = this._currentMeasure.left),
              (this._measureForChildren.top = this._currentMeasure.top),
              (this._measureForChildren.width = t.width),
              (this._measureForChildren.height = t.height);
          }),
          (t.prototype._layout = function (t, i) {
            return this._freezeControls
              ? (this.invalidateRect(), !1)
              : e.prototype._layout.call(this, t, i);
          }),
          (t.prototype._scrollChildren = function (e, t, i) {
            for (var n = 0; n < e.length; ++n) {
              var r = e[n];
              (r._currentMeasure.left = r._customData._origLeft + t),
                (r._currentMeasure.top = r._customData._origTop + i),
                (r._isClipped = !1),
                r instanceof af &&
                  r._children.length > 0 &&
                  this._scrollChildren(r._children, t, i);
            }
          }),
          (t.prototype._scrollChildrenWithBuckets = function (e, t, i, n) {
            for (
              var r = Math.max(0, Math.floor(-e / this._bucketWidth)),
                o = Math.floor(
                  (-e + this._parentMeasure.width - 1) / this._bucketWidth
                ),
                s = Math.max(0, Math.floor(-t / this._bucketHeight)),
                a = Math.floor(
                  (-t + this._parentMeasure.height - 1) / this._bucketHeight
                );
              s <= a;

            ) {
              for (var l = r; l <= o; ++l) {
                var c = s * this._bucketLen + l,
                  u = this._buckets[c];
                if (u)
                  for (var h = 0; h < u.length; ++h) {
                    var d = u[h];
                    (d._currentMeasure.left = d._customData._origLeft + i),
                      (d._currentMeasure.top = d._customData._origTop + n),
                      (d._isClipped = !1);
                  }
              }
              s++;
            }
          }),
          (t.prototype._draw = function (t, i) {
            if (this._freezeControls) {
              this._localDraw(t), this.clipChildren && this._clipForChildren(t);
              var n = 0 | this.leftInPixels,
                r = 0 | this.topInPixels;
              this._useBuckets() &&
              null !== this._oldLeft &&
              null !== this._oldTop
                ? (this._scrollChildrenWithBuckets(
                    this._oldLeft,
                    this._oldTop,
                    n,
                    r
                  ),
                  this._scrollChildrenWithBuckets(n, r, n, r))
                : this._scrollChildren(this._children, n, r),
                (this._oldLeft = n),
                (this._oldTop = r);
              for (var o = 0, s = this._children; o < s.length; o++) {
                var a = s[o];
                a._intersectsRect(this._parentMeasure) &&
                  a._render(t, this._parentMeasure);
              }
            } else e.prototype._draw.call(this, t, i);
          }),
          (t.prototype._postMeasure = function () {
            if (this._freezeControls) e.prototype._postMeasure.call(this);
            else {
              for (
                var t = this.parentClientWidth,
                  i = this.parentClientHeight,
                  n = 0,
                  r = this.children;
                n < r.length;
                n++
              ) {
                var o = r[n];
                o.isVisible &&
                  !o.notRenderable &&
                  (o.horizontalAlignment === sf.HORIZONTAL_ALIGNMENT_CENTER &&
                    o._offsetLeft(
                      this._currentMeasure.left - o._currentMeasure.left
                    ),
                  o.verticalAlignment === sf.VERTICAL_ALIGNMENT_CENTER &&
                    o._offsetTop(
                      this._currentMeasure.top - o._currentMeasure.top
                    ),
                  (t = Math.max(
                    t,
                    o._currentMeasure.left -
                      this._currentMeasure.left +
                      o._currentMeasure.width +
                      o.paddingRightInPixels
                  )),
                  (i = Math.max(
                    i,
                    o._currentMeasure.top -
                      this._currentMeasure.top +
                      o._currentMeasure.height +
                      o.paddingBottomInPixels
                  )));
              }
              this._currentMeasure.width !== t &&
                (this._width.updateInPlace(t, Zp.UNITMODE_PIXEL),
                (this._currentMeasure.width = t),
                (this._rebuildLayout = !0),
                (this._isDirty = !0)),
                this._currentMeasure.height !== i &&
                  (this._height.updateInPlace(i, Zp.UNITMODE_PIXEL),
                  (this._currentMeasure.height = i),
                  (this._rebuildLayout = !0),
                  (this._isDirty = !0)),
                e.prototype._postMeasure.call(this);
            }
          }),
          t
        );
      })(af)),
    Mf = (function (e) {
      function t(t) {
        var i = e.call(this, t) || this;
        return (
          (i.name = t),
          (i._background = "black"),
          (i._borderColor = "white"),
          (i._tempMeasure = new nf(0, 0, 0, 0)),
          i
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "borderColor", {
          get: function () {
            return this._borderColor;
          },
          set: function (e) {
            this._borderColor !== e &&
              ((this._borderColor = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "background", {
          get: function () {
            return this._background;
          },
          set: function (e) {
            this._background !== e &&
              ((this._background = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._getTypeName = function () {
          return "Scrollbar";
        }),
        (t.prototype._getThumbThickness = function () {
          return this._thumbWidth.isPixel
            ? this._thumbWidth.getValue(this._host)
            : this._backgroundBoxThickness *
                this._thumbWidth.getValue(this._host);
        }),
        (t.prototype._draw = function (e) {
          e.save(),
            this._applyStates(e),
            this._prepareRenderingData("rectangle");
          var t = this._renderLeft,
            i = this._getThumbPosition();
          (e.fillStyle = this._background),
            e.fillRect(
              this._currentMeasure.left,
              this._currentMeasure.top,
              this._currentMeasure.width,
              this._currentMeasure.height
            ),
            (e.fillStyle = this.color),
            this.isVertical
              ? ((this._tempMeasure.left = t - this._effectiveBarOffset),
                (this._tempMeasure.top = this._currentMeasure.top + i),
                (this._tempMeasure.width = this._currentMeasure.width),
                (this._tempMeasure.height = this._effectiveThumbThickness))
              : ((this._tempMeasure.left = this._currentMeasure.left + i),
                (this._tempMeasure.top = this._currentMeasure.top),
                (this._tempMeasure.width = this._effectiveThumbThickness),
                (this._tempMeasure.height = this._currentMeasure.height)),
            e.fillRect(
              this._tempMeasure.left,
              this._tempMeasure.top,
              this._tempMeasure.width,
              this._tempMeasure.height
            ),
            e.restore();
        }),
        (t.prototype._updateValueFromPointer = function (e, t) {
          0 != this.rotation &&
            (this._invertTransformMatrix.transformCoordinates(
              e,
              t,
              this._transformedPosition
            ),
            (e = this._transformedPosition.x),
            (t = this._transformedPosition.y)),
            this._first &&
              ((this._first = !1),
              (this._originX = e),
              (this._originY = t),
              (e < this._tempMeasure.left ||
                e > this._tempMeasure.left + this._tempMeasure.width ||
                t < this._tempMeasure.top ||
                t > this._tempMeasure.top + this._tempMeasure.height) &&
                (this.isVertical
                  ? (this.value =
                      this.minimum +
                      (1 -
                        (t - this._currentMeasure.top) /
                          this._currentMeasure.height) *
                        (this.maximum - this.minimum))
                  : (this.value =
                      this.minimum +
                      ((e - this._currentMeasure.left) /
                        this._currentMeasure.width) *
                        (this.maximum - this.minimum))));
          var i;
          (i = this.isVertical
            ? -(t - this._originY) /
              (this._currentMeasure.height - this._effectiveThumbThickness)
            : (e - this._originX) /
              (this._currentMeasure.width - this._effectiveThumbThickness)),
            (this.value += i * (this.maximum - this.minimum)),
            (this._originX = e),
            (this._originY = t);
        }),
        (t.prototype._onPointerDown = function (t, i, n, r, o) {
          return (
            (this._first = !0),
            e.prototype._onPointerDown.call(this, t, i, n, r, o)
          );
        }),
        t
      );
    })(Ef),
    Of = (function (e) {
      function t(t) {
        var i = e.call(this, t) || this;
        return (
          (i.name = t),
          (i._thumbLength = 0.5),
          (i._thumbHeight = 1),
          (i._barImageHeight = 1),
          (i._tempMeasure = new nf(0, 0, 0, 0)),
          (i.num90RotationInVerticalMode = 1),
          i
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "backgroundImage", {
          get: function () {
            return this._backgroundBaseImage;
          },
          set: function (e) {
            var t = this;
            this._backgroundBaseImage !== e &&
              ((this._backgroundBaseImage = e),
              this.isVertical && 0 !== this.num90RotationInVerticalMode
                ? e.isLoaded
                  ? ((this._backgroundImage = e._rotate90(
                      this.num90RotationInVerticalMode,
                      !0
                    )),
                    this._markAsDirty())
                  : e.onImageLoadedObservable.addOnce(function () {
                      var i = e._rotate90(t.num90RotationInVerticalMode, !0);
                      (t._backgroundImage = i),
                        i.isLoaded ||
                          i.onImageLoadedObservable.addOnce(function () {
                            t._markAsDirty();
                          }),
                        t._markAsDirty();
                    })
                : ((this._backgroundImage = e),
                  e &&
                    !e.isLoaded &&
                    e.onImageLoadedObservable.addOnce(function () {
                      t._markAsDirty();
                    }),
                  this._markAsDirty()));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "thumbImage", {
          get: function () {
            return this._thumbBaseImage;
          },
          set: function (e) {
            var t = this;
            this._thumbBaseImage !== e &&
              ((this._thumbBaseImage = e),
              this.isVertical && 0 !== this.num90RotationInVerticalMode
                ? e.isLoaded
                  ? ((this._thumbImage = e._rotate90(
                      -this.num90RotationInVerticalMode,
                      !0
                    )),
                    this._markAsDirty())
                  : e.onImageLoadedObservable.addOnce(function () {
                      var i = e._rotate90(-t.num90RotationInVerticalMode, !0);
                      (t._thumbImage = i),
                        i.isLoaded ||
                          i.onImageLoadedObservable.addOnce(function () {
                            t._markAsDirty();
                          }),
                        t._markAsDirty();
                    })
                : ((this._thumbImage = e),
                  e &&
                    !e.isLoaded &&
                    e.onImageLoadedObservable.addOnce(function () {
                      t._markAsDirty();
                    }),
                  this._markAsDirty()));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "thumbLength", {
          get: function () {
            return this._thumbLength;
          },
          set: function (e) {
            this._thumbLength !== e &&
              ((this._thumbLength = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "thumbHeight", {
          get: function () {
            return this._thumbHeight;
          },
          set: function (e) {
            this._thumbLength !== e &&
              ((this._thumbHeight = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "barImageHeight", {
          get: function () {
            return this._barImageHeight;
          },
          set: function (e) {
            this._barImageHeight !== e &&
              ((this._barImageHeight = e), this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._getTypeName = function () {
          return "ImageScrollBar";
        }),
        (t.prototype._getThumbThickness = function () {
          return this._thumbWidth.isPixel
            ? this._thumbWidth.getValue(this._host)
            : this._backgroundBoxThickness *
                this._thumbWidth.getValue(this._host);
        }),
        (t.prototype._draw = function (e) {
          e.save(),
            this._applyStates(e),
            this._prepareRenderingData("rectangle");
          var t = this._getThumbPosition(),
            i = this._renderLeft,
            n = this._renderTop,
            r = this._renderWidth,
            o = this._renderHeight;
          this._backgroundImage &&
            (this._tempMeasure.copyFromFloats(i, n, r, o),
            this.isVertical
              ? (this._tempMeasure.copyFromFloats(
                  i + r * (1 - this._barImageHeight) * 0.5,
                  this._currentMeasure.top,
                  r * this._barImageHeight,
                  o
                ),
                (this._tempMeasure.height += this._effectiveThumbThickness),
                this._backgroundImage._currentMeasure.copyFrom(
                  this._tempMeasure
                ))
              : (this._tempMeasure.copyFromFloats(
                  this._currentMeasure.left,
                  n + o * (1 - this._barImageHeight) * 0.5,
                  r,
                  o * this._barImageHeight
                ),
                (this._tempMeasure.width += this._effectiveThumbThickness),
                this._backgroundImage._currentMeasure.copyFrom(
                  this._tempMeasure
                )),
            this._backgroundImage._draw(e)),
            this.isVertical
              ? this._tempMeasure.copyFromFloats(
                  i -
                    this._effectiveBarOffset +
                    this._currentMeasure.width * (1 - this._thumbHeight) * 0.5,
                  this._currentMeasure.top + t,
                  this._currentMeasure.width * this._thumbHeight,
                  this._effectiveThumbThickness
                )
              : this._tempMeasure.copyFromFloats(
                  this._currentMeasure.left + t,
                  this._currentMeasure.top +
                    this._currentMeasure.height * (1 - this._thumbHeight) * 0.5,
                  this._effectiveThumbThickness,
                  this._currentMeasure.height * this._thumbHeight
                ),
            this._thumbImage &&
              (this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),
              this._thumbImage._draw(e)),
            e.restore();
        }),
        (t.prototype._updateValueFromPointer = function (e, t) {
          0 != this.rotation &&
            (this._invertTransformMatrix.transformCoordinates(
              e,
              t,
              this._transformedPosition
            ),
            (e = this._transformedPosition.x),
            (t = this._transformedPosition.y)),
            this._first &&
              ((this._first = !1),
              (this._originX = e),
              (this._originY = t),
              (e < this._tempMeasure.left ||
                e > this._tempMeasure.left + this._tempMeasure.width ||
                t < this._tempMeasure.top ||
                t > this._tempMeasure.top + this._tempMeasure.height) &&
                (this.isVertical
                  ? (this.value =
                      this.minimum +
                      (1 -
                        (t - this._currentMeasure.top) /
                          this._currentMeasure.height) *
                        (this.maximum - this.minimum))
                  : (this.value =
                      this.minimum +
                      ((e - this._currentMeasure.left) /
                        this._currentMeasure.width) *
                        (this.maximum - this.minimum))));
          var i;
          (i = this.isVertical
            ? -(t - this._originY) /
              (this._currentMeasure.height - this._effectiveThumbThickness)
            : (e - this._originX) /
              (this._currentMeasure.width - this._effectiveThumbThickness)),
            (this.value += i * (this.maximum - this.minimum)),
            (this._originX = e),
            (this._originY = t);
        }),
        (t.prototype._onPointerDown = function (t, i, n, r, o) {
          return (
            (this._first = !0),
            e.prototype._onPointerDown.call(this, t, i, n, r, o)
          );
        }),
        t
      );
    })(Ef),
    If = (function (e) {
      function t(t, i) {
        var n = e.call(this, t) || this;
        return (
          (n._barSize = 20),
          (n._pointerIsOver = !1),
          (n._wheelPrecision = 0.05),
          (n._thumbLength = 0.5),
          (n._thumbHeight = 1),
          (n._barImageHeight = 1),
          (n._horizontalBarImageHeight = 1),
          (n._verticalBarImageHeight = 1),
          (n._oldWindowContentsWidth = 0),
          (n._oldWindowContentsHeight = 0),
          (n._forceHorizontalBar = !1),
          (n._forceVerticalBar = !1),
          (n._useImageBar = i || !1),
          n.onDirtyObservable.add(function () {
            (n._horizontalBarSpace.color = n.color),
              (n._verticalBarSpace.color = n.color),
              (n._dragSpace.color = n.color);
          }),
          n.onPointerEnterObservable.add(function () {
            n._pointerIsOver = !0;
          }),
          n.onPointerOutObservable.add(function () {
            n._pointerIsOver = !1;
          }),
          (n._grid = new gf()),
          n._useImageBar
            ? ((n._horizontalBar = new Of()), (n._verticalBar = new Of()))
            : ((n._horizontalBar = new Mf()), (n._verticalBar = new Mf())),
          (n._window = new Rf("scrollViewer_window")),
          (n._window.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
          (n._window.verticalAlignment = sf.VERTICAL_ALIGNMENT_TOP),
          n._grid.addColumnDefinition(1),
          n._grid.addColumnDefinition(0, !0),
          n._grid.addRowDefinition(1),
          n._grid.addRowDefinition(0, !0),
          e.prototype.addControl.call(n, n._grid),
          n._grid.addControl(n._window, 0, 0),
          (n._verticalBarSpace = new cf()),
          (n._verticalBarSpace.horizontalAlignment =
            sf.HORIZONTAL_ALIGNMENT_LEFT),
          (n._verticalBarSpace.verticalAlignment = sf.VERTICAL_ALIGNMENT_TOP),
          (n._verticalBarSpace.thickness = 1),
          n._grid.addControl(n._verticalBarSpace, 0, 1),
          n._addBar(n._verticalBar, n._verticalBarSpace, !0, Math.PI),
          (n._horizontalBarSpace = new cf()),
          (n._horizontalBarSpace.horizontalAlignment =
            sf.HORIZONTAL_ALIGNMENT_LEFT),
          (n._horizontalBarSpace.verticalAlignment = sf.VERTICAL_ALIGNMENT_TOP),
          (n._horizontalBarSpace.thickness = 1),
          n._grid.addControl(n._horizontalBarSpace, 1, 0),
          n._addBar(n._horizontalBar, n._horizontalBarSpace, !1, 0),
          (n._dragSpace = new cf()),
          (n._dragSpace.thickness = 1),
          n._grid.addControl(n._dragSpace, 1, 1),
          n._useImageBar ||
            ((n.barColor = "grey"), (n.barBackground = "transparent")),
          n
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "horizontalBar", {
          get: function () {
            return this._horizontalBar;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "verticalBar", {
          get: function () {
            return this._verticalBar;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.addControl = function (e) {
          return e ? (this._window.addControl(e), this) : this;
        }),
        (t.prototype.removeControl = function (e) {
          return this._window.removeControl(e), this;
        }),
        Object.defineProperty(t.prototype, "children", {
          get: function () {
            return this._window.children;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._flagDescendantsAsMatrixDirty = function () {
          for (var e = 0, t = this._children; e < t.length; e++)
            t[e]._markMatrixAsDirty();
        }),
        Object.defineProperty(t.prototype, "freezeControls", {
          get: function () {
            return this._window.freezeControls;
          },
          set: function (e) {
            this._window.freezeControls = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "bucketWidth", {
          get: function () {
            return this._window.bucketWidth;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "bucketHeight", {
          get: function () {
            return this._window.bucketHeight;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.setBucketSizes = function (e, t) {
          this._window.setBucketSizes(e, t);
        }),
        Object.defineProperty(t.prototype, "forceHorizontalBar", {
          get: function () {
            return this._forceHorizontalBar;
          },
          set: function (e) {
            this._grid.setRowDefinition(1, e ? this._barSize : 0, !0),
              (this._horizontalBar.isVisible = e),
              (this._forceHorizontalBar = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "forceVerticalBar", {
          get: function () {
            return this._forceVerticalBar;
          },
          set: function (e) {
            this._grid.setColumnDefinition(1, e ? this._barSize : 0, !0),
              (this._verticalBar.isVisible = e),
              (this._forceVerticalBar = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.resetWindow = function () {
          (this._window.width = "100%"), (this._window.height = "100%");
        }),
        (t.prototype._getTypeName = function () {
          return "ScrollViewer";
        }),
        (t.prototype._buildClientSizes = function () {
          var e = this.host.idealRatio;
          (this._window.parentClientWidth =
            this._currentMeasure.width -
            (this._verticalBar.isVisible || this.forceVerticalBar
              ? this._barSize * e
              : 0) -
            2 * this.thickness),
            (this._window.parentClientHeight =
              this._currentMeasure.height -
              (this._horizontalBar.isVisible || this.forceHorizontalBar
                ? this._barSize * e
                : 0) -
              2 * this.thickness),
            (this._clientWidth = this._window.parentClientWidth),
            (this._clientHeight = this._window.parentClientHeight);
        }),
        (t.prototype._additionalProcessing = function (t, i) {
          e.prototype._additionalProcessing.call(this, t, i),
            this._buildClientSizes();
        }),
        (t.prototype._postMeasure = function () {
          e.prototype._postMeasure.call(this),
            this._updateScroller(),
            this._setWindowPosition(!1);
        }),
        Object.defineProperty(t.prototype, "wheelPrecision", {
          get: function () {
            return this._wheelPrecision;
          },
          set: function (e) {
            this._wheelPrecision !== e &&
              (e < 0 && (e = 0), e > 1 && (e = 1), (this._wheelPrecision = e));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "scrollBackground", {
          get: function () {
            return this._horizontalBarSpace.background;
          },
          set: function (e) {
            this._horizontalBarSpace.background !== e &&
              ((this._horizontalBarSpace.background = e),
              (this._verticalBarSpace.background = e));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "barColor", {
          get: function () {
            return this._barColor;
          },
          set: function (e) {
            this._barColor !== e &&
              ((this._barColor = e),
              (this._horizontalBar.color = e),
              (this._verticalBar.color = e));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "thumbImage", {
          get: function () {
            return this._barImage;
          },
          set: function (e) {
            if (this._barImage !== e) {
              this._barImage = e;
              var t = this._horizontalBar,
                i = this._verticalBar;
              (t.thumbImage = e), (i.thumbImage = e);
            }
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "horizontalThumbImage", {
          get: function () {
            return this._horizontalBarImage;
          },
          set: function (e) {
            this._horizontalBarImage !== e &&
              ((this._horizontalBarImage = e),
              (this._horizontalBar.thumbImage = e));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "verticalThumbImage", {
          get: function () {
            return this._verticalBarImage;
          },
          set: function (e) {
            this._verticalBarImage !== e &&
              ((this._verticalBarImage = e),
              (this._verticalBar.thumbImage = e));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "barSize", {
          get: function () {
            return this._barSize;
          },
          set: function (e) {
            this._barSize !== e &&
              ((this._barSize = e),
              this._markAsDirty(),
              this._horizontalBar.isVisible &&
                this._grid.setRowDefinition(1, this._barSize, !0),
              this._verticalBar.isVisible &&
                this._grid.setColumnDefinition(1, this._barSize, !0));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "thumbLength", {
          get: function () {
            return this._thumbLength;
          },
          set: function (e) {
            if (this._thumbLength !== e) {
              e <= 0 && (e = 0.1), e > 1 && (e = 1), (this._thumbLength = e);
              var t = this._horizontalBar,
                i = this._verticalBar;
              (t.thumbLength = e), (i.thumbLength = e), this._markAsDirty();
            }
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "thumbHeight", {
          get: function () {
            return this._thumbHeight;
          },
          set: function (e) {
            if (this._thumbHeight !== e) {
              e <= 0 && (e = 0.1), e > 1 && (e = 1), (this._thumbHeight = e);
              var t = this._horizontalBar,
                i = this._verticalBar;
              (t.thumbHeight = e), (i.thumbHeight = e), this._markAsDirty();
            }
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "barImageHeight", {
          get: function () {
            return this._barImageHeight;
          },
          set: function (e) {
            if (this._barImageHeight !== e) {
              e <= 0 && (e = 0.1), e > 1 && (e = 1), (this._barImageHeight = e);
              var t = this._horizontalBar,
                i = this._verticalBar;
              (t.barImageHeight = e),
                (i.barImageHeight = e),
                this._markAsDirty();
            }
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "horizontalBarImageHeight", {
          get: function () {
            return this._horizontalBarImageHeight;
          },
          set: function (e) {
            this._horizontalBarImageHeight !== e &&
              (e <= 0 && (e = 0.1),
              e > 1 && (e = 1),
              (this._horizontalBarImageHeight = e),
              (this._horizontalBar.barImageHeight = e),
              this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "verticalBarImageHeight", {
          get: function () {
            return this._verticalBarImageHeight;
          },
          set: function (e) {
            this._verticalBarImageHeight !== e &&
              (e <= 0 && (e = 0.1),
              e > 1 && (e = 1),
              (this._verticalBarImageHeight = e),
              (this._verticalBar.barImageHeight = e),
              this._markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "barBackground", {
          get: function () {
            return this._barBackground;
          },
          set: function (e) {
            if (this._barBackground !== e) {
              this._barBackground = e;
              var t = this._horizontalBar,
                i = this._verticalBar;
              (t.background = e),
                (i.background = e),
                (this._dragSpace.background = e);
            }
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "barImage", {
          get: function () {
            return this._barBackgroundImage;
          },
          set: function (e) {
            this._barBackgroundImage, (this._barBackgroundImage = e);
            var t = this._horizontalBar,
              i = this._verticalBar;
            (t.backgroundImage = e), (i.backgroundImage = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "horizontalBarImage", {
          get: function () {
            return this._horizontalBarBackgroundImage;
          },
          set: function (e) {
            this._horizontalBarBackgroundImage,
              (this._horizontalBarBackgroundImage = e),
              (this._horizontalBar.backgroundImage = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "verticalBarImage", {
          get: function () {
            return this._verticalBarBackgroundImage;
          },
          set: function (e) {
            this._verticalBarBackgroundImage,
              (this._verticalBarBackgroundImage = e),
              (this._verticalBar.backgroundImage = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._setWindowPosition = function (e) {
          void 0 === e && (e = !0);
          var t = this.host.idealRatio,
            i = this._window._currentMeasure.width,
            n = this._window._currentMeasure.height;
          if (
            e ||
            this._oldWindowContentsWidth !== i ||
            this._oldWindowContentsHeight !== n
          ) {
            (this._oldWindowContentsWidth = i),
              (this._oldWindowContentsHeight = n);
            var r = this._clientWidth - i,
              o = this._clientHeight - n,
              s = (this._horizontalBar.value / t) * r + "px",
              a = (this._verticalBar.value / t) * o + "px";
            s !== this._window.left &&
              ((this._window.left = s),
              this.freezeControls || (this._rebuildLayout = !0)),
              a !== this._window.top &&
                ((this._window.top = a),
                this.freezeControls || (this._rebuildLayout = !0));
          }
        }),
        (t.prototype._updateScroller = function () {
          var e = this._window._currentMeasure.width,
            t = this._window._currentMeasure.height;
          this._horizontalBar.isVisible &&
          e <= this._clientWidth &&
          !this.forceHorizontalBar
            ? (this._grid.setRowDefinition(1, 0, !0),
              (this._horizontalBar.isVisible = !1),
              (this._horizontalBar.value = 0),
              (this._rebuildLayout = !0))
            : !this._horizontalBar.isVisible &&
              (e > this._clientWidth || this.forceHorizontalBar) &&
              (this._grid.setRowDefinition(1, this._barSize, !0),
              (this._horizontalBar.isVisible = !0),
              (this._rebuildLayout = !0)),
            this._verticalBar.isVisible &&
            t <= this._clientHeight &&
            !this.forceVerticalBar
              ? (this._grid.setColumnDefinition(1, 0, !0),
                (this._verticalBar.isVisible = !1),
                (this._verticalBar.value = 0),
                (this._rebuildLayout = !0))
              : !this._verticalBar.isVisible &&
                (t > this._clientHeight || this.forceVerticalBar) &&
                (this._grid.setColumnDefinition(1, this._barSize, !0),
                (this._verticalBar.isVisible = !0),
                (this._rebuildLayout = !0)),
            this._buildClientSizes();
          var i = this.host.idealRatio;
          (this._horizontalBar.thumbWidth =
            0.9 * this._thumbLength * (this._clientWidth / i) + "px"),
            (this._verticalBar.thumbWidth =
              0.9 * this._thumbLength * (this._clientHeight / i) + "px");
        }),
        (t.prototype._link = function (t) {
          e.prototype._link.call(this, t), this._attachWheel();
        }),
        (t.prototype._addBar = function (e, t, i, n) {
          var r = this;
          (e.paddingLeft = 0),
            (e.width = "100%"),
            (e.height = "100%"),
            (e.barOffset = 0),
            (e.value = 0),
            (e.maximum = 1),
            (e.horizontalAlignment = sf.HORIZONTAL_ALIGNMENT_CENTER),
            (e.verticalAlignment = sf.VERTICAL_ALIGNMENT_CENTER),
            (e.isVertical = i),
            (e.rotation = n),
            (e.isVisible = !1),
            t.addControl(e),
            e.onValueChangedObservable.add(function (e) {
              r._setWindowPosition();
            });
        }),
        (t.prototype._attachWheel = function () {
          var e = this;
          this._host &&
            !this._onWheelObserver &&
            (this._onWheelObserver = this.onWheelObservable.add(function (t) {
              e._pointerIsOver &&
                (1 == e._verticalBar.isVisible &&
                  (t.y < 0 && e._verticalBar.value > 0
                    ? (e._verticalBar.value -= e._wheelPrecision)
                    : t.y > 0 &&
                      e._verticalBar.value < e._verticalBar.maximum &&
                      (e._verticalBar.value += e._wheelPrecision)),
                1 == e._horizontalBar.isVisible &&
                  (t.x < 0 && e._horizontalBar.value < e._horizontalBar.maximum
                    ? (e._horizontalBar.value += e._wheelPrecision)
                    : t.x > 0 &&
                      e._horizontalBar.value > 0 &&
                      (e._horizontalBar.value -= e._wheelPrecision)));
            }));
        }),
        (t.prototype._renderHighlightSpecific = function (t) {
          this.isHighlighted &&
            (e.prototype._renderHighlightSpecific.call(this, t),
            this._grid._renderHighlightSpecific(t),
            t.restore());
        }),
        (t.prototype.dispose = function () {
          this.onWheelObservable.remove(this._onWheelObserver),
            (this._onWheelObserver = null),
            e.prototype.dispose.call(this);
        }),
        t
      );
    })(cf);
  h.RegisteredTypes["BABYLON.GUI.ScrollViewer"] = If;
  var Df = (function (e) {
    function t() {
      var t = (null !== e && e.apply(this, arguments)) || this;
      return (
        (t.onKeyPressObservable = new o()),
        (t.defaultButtonWidth = "40px"),
        (t.defaultButtonHeight = "40px"),
        (t.defaultButtonPaddingLeft = "2px"),
        (t.defaultButtonPaddingRight = "2px"),
        (t.defaultButtonPaddingTop = "2px"),
        (t.defaultButtonPaddingBottom = "2px"),
        (t.defaultButtonColor = "#DDD"),
        (t.defaultButtonBackground = "#070707"),
        (t.shiftButtonColor = "#7799FF"),
        (t.selectedShiftThickness = 1),
        (t.shiftState = 0),
        (t._currentlyConnectedInputText = null),
        (t._connectedInputTexts = []),
        (t._onKeyPressObserver = null),
        t
      );
    }
    return (
      P(t, e),
      (t.prototype._getTypeName = function () {
        return "VirtualKeyboard";
      }),
      (t.prototype._createKey = function (e, t) {
        var i = this,
          n = df.CreateSimpleButton(e, e);
        return (
          (n.width = t && t.width ? t.width : this.defaultButtonWidth),
          (n.height = t && t.height ? t.height : this.defaultButtonHeight),
          (n.color = t && t.color ? t.color : this.defaultButtonColor),
          (n.background =
            t && t.background ? t.background : this.defaultButtonBackground),
          (n.paddingLeft =
            t && t.paddingLeft ? t.paddingLeft : this.defaultButtonPaddingLeft),
          (n.paddingRight =
            t && t.paddingRight
              ? t.paddingRight
              : this.defaultButtonPaddingRight),
          (n.paddingTop =
            t && t.paddingTop ? t.paddingTop : this.defaultButtonPaddingTop),
          (n.paddingBottom =
            t && t.paddingBottom
              ? t.paddingBottom
              : this.defaultButtonPaddingBottom),
          (n.thickness = 0),
          (n.isFocusInvisible = !0),
          (n.shadowColor = this.shadowColor),
          (n.shadowBlur = this.shadowBlur),
          (n.shadowOffsetX = this.shadowOffsetX),
          (n.shadowOffsetY = this.shadowOffsetY),
          n.onPointerUpObservable.add(function () {
            i.onKeyPressObservable.notifyObservers(e);
          }),
          n
        );
      }),
      (t.prototype.addKeysRow = function (e, t) {
        var i = new pf();
        (i.isVertical = !1), (i.isFocusInvisible = !0);
        for (var n = null, r = 0; r < e.length; r++) {
          var o = null;
          t && t.length === e.length && (o = t[r]);
          var s = this._createKey(e[r], o);
          (!n || s.heightInPixels > n.heightInPixels) && (n = s),
            i.addControl(s);
        }
        (i.height = n ? n.height : this.defaultButtonHeight),
          this.addControl(i);
      }),
      (t.prototype.applyShiftState = function (e) {
        if (this.children)
          for (var t = 0; t < this.children.length; t++) {
            var i = this.children[t];
            if (i && i.children)
              for (var n = i, r = 0; r < n.children.length; r++) {
                var o = n.children[r];
                if (o && o.children[0]) {
                  var s = o.children[0];
                  "" === s.text &&
                    ((o.color = e
                      ? this.shiftButtonColor
                      : this.defaultButtonColor),
                    (o.thickness = e > 1 ? this.selectedShiftThickness : 0)),
                    (s.text =
                      e > 0 ? s.text.toUpperCase() : s.text.toLowerCase());
                }
              }
          }
      }),
      Object.defineProperty(t.prototype, "connectedInputText", {
        get: function () {
          return this._currentlyConnectedInputText;
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype.connect = function (e) {
        var t = this;
        if (
          !this._connectedInputTexts.some(function (t) {
            return t.input === e;
          })
        ) {
          null === this._onKeyPressObserver &&
            (this._onKeyPressObserver = this.onKeyPressObservable.add(
              function (e) {
                if (t._currentlyConnectedInputText) {
                  switch (
                    ((t._currentlyConnectedInputText._host.focusedControl =
                      t._currentlyConnectedInputText),
                    e)
                  ) {
                    case "":
                      return (
                        t.shiftState++,
                        t.shiftState > 2 && (t.shiftState = 0),
                        void t.applyShiftState(t.shiftState)
                      );
                    case "":
                      return void t._currentlyConnectedInputText.processKey(8);
                    case "":
                      return void t._currentlyConnectedInputText.processKey(13);
                  }
                  t._currentlyConnectedInputText.processKey(
                    -1,
                    t.shiftState ? e.toUpperCase() : e
                  ),
                    1 === t.shiftState &&
                      ((t.shiftState = 0), t.applyShiftState(t.shiftState));
                }
              }
            )),
            (this.isVisible = !1),
            (this._currentlyConnectedInputText = e),
            (e._connectedVirtualKeyboard = this);
          var i = e.onFocusObservable.add(function () {
              (t._currentlyConnectedInputText = e),
                (e._connectedVirtualKeyboard = t),
                (t.isVisible = !0);
            }),
            n = e.onBlurObservable.add(function () {
              (e._connectedVirtualKeyboard = null),
                (t._currentlyConnectedInputText = null),
                (t.isVisible = !1);
            });
          this._connectedInputTexts.push({
            input: e,
            onBlurObserver: n,
            onFocusObserver: i,
          });
        }
      }),
      (t.prototype.disconnect = function (e) {
        var t = this;
        if (e) {
          var i = this._connectedInputTexts.filter(function (t) {
            return t.input === e;
          });
          1 === i.length &&
            (this._removeConnectedInputObservables(i[0]),
            (this._connectedInputTexts = this._connectedInputTexts.filter(
              function (t) {
                return t.input !== e;
              }
            )),
            this._currentlyConnectedInputText === e &&
              (this._currentlyConnectedInputText = null));
        } else
          this._connectedInputTexts.forEach(function (e) {
            t._removeConnectedInputObservables(e);
          }),
            (this._connectedInputTexts = []);
        0 === this._connectedInputTexts.length &&
          ((this._currentlyConnectedInputText = null),
          this.onKeyPressObservable.remove(this._onKeyPressObserver),
          (this._onKeyPressObserver = null));
      }),
      (t.prototype._removeConnectedInputObservables = function (e) {
        (e.input._connectedVirtualKeyboard = null),
          e.input.onFocusObservable.remove(e.onFocusObserver),
          e.input.onBlurObservable.remove(e.onBlurObserver);
      }),
      (t.prototype.dispose = function () {
        e.prototype.dispose.call(this), this.disconnect();
      }),
      (t.CreateDefaultLayout = function (e) {
        var i = new t(e);
        return (
          i.addKeysRow(["1", "2", "3", "4", "5", "6", "7", "8", "9", "0", ""]),
          i.addKeysRow(["q", "w", "e", "r", "t", "y", "u", "i", "o", "p"]),
          i.addKeysRow([
            "a",
            "s",
            "d",
            "f",
            "g",
            "h",
            "j",
            "k",
            "l",
            ";",
            "'",
            "",
          ]),
          i.addKeysRow(["", "z", "x", "c", "v", "b", "n", "m", ",", ".", "/"]),
          i.addKeysRow(
            [" "],
            [
              {
                width: "200px",
              },
            ]
          ),
          i
        );
      }),
      t
    );
  })(pf);
  h.RegisteredTypes["BABYLON.GUI.VirtualKeyboard"] = Df;
  var wf = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      return (
        (i.name = t),
        (i._cellWidth = 20),
        (i._cellHeight = 20),
        (i._minorLineTickness = 1),
        (i._minorLineColor = "DarkGray"),
        (i._majorLineTickness = 2),
        (i._majorLineColor = "White"),
        (i._majorLineFrequency = 5),
        (i._background = "Black"),
        (i._displayMajorLines = !0),
        (i._displayMinorLines = !0),
        i
      );
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "displayMinorLines", {
        get: function () {
          return this._displayMinorLines;
        },
        set: function (e) {
          this._displayMinorLines !== e &&
            ((this._displayMinorLines = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "displayMajorLines", {
        get: function () {
          return this._displayMajorLines;
        },
        set: function (e) {
          this._displayMajorLines !== e &&
            ((this._displayMajorLines = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "background", {
        get: function () {
          return this._background;
        },
        set: function (e) {
          this._background !== e &&
            ((this._background = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "cellWidth", {
        get: function () {
          return this._cellWidth;
        },
        set: function (e) {
          (this._cellWidth = e), this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "cellHeight", {
        get: function () {
          return this._cellHeight;
        },
        set: function (e) {
          (this._cellHeight = e), this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "minorLineTickness", {
        get: function () {
          return this._minorLineTickness;
        },
        set: function (e) {
          (this._minorLineTickness = e), this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "minorLineColor", {
        get: function () {
          return this._minorLineColor;
        },
        set: function (e) {
          (this._minorLineColor = e), this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "majorLineTickness", {
        get: function () {
          return this._majorLineTickness;
        },
        set: function (e) {
          (this._majorLineTickness = e), this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "majorLineColor", {
        get: function () {
          return this._majorLineColor;
        },
        set: function (e) {
          (this._majorLineColor = e), this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "majorLineFrequency", {
        get: function () {
          return this._majorLineFrequency;
        },
        set: function (e) {
          (this._majorLineFrequency = e), this._markAsDirty();
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._draw = function (e, t) {
        if ((e.save(), this._applyStates(e), this._isEnabled)) {
          this._background &&
            ((e.fillStyle = this._background),
            e.fillRect(
              this._currentMeasure.left,
              this._currentMeasure.top,
              this._currentMeasure.width,
              this._currentMeasure.height
            ));
          var i = this._currentMeasure.width / this._cellWidth,
            n = this._currentMeasure.height / this._cellHeight,
            r = this._currentMeasure.left + this._currentMeasure.width / 2,
            o = this._currentMeasure.top + this._currentMeasure.height / 2;
          if (this._displayMinorLines) {
            (e.strokeStyle = this._minorLineColor),
              (e.lineWidth = this._minorLineTickness);
            for (var s = -i / 2; s < i / 2; s++) {
              var a = r + s * this.cellWidth;
              e.beginPath(),
                e.moveTo(a, this._currentMeasure.top),
                e.lineTo(
                  a,
                  this._currentMeasure.top + this._currentMeasure.height
                ),
                e.stroke();
            }
            for (var l = -n / 2; l < n / 2; l++) {
              var c = o + l * this.cellHeight;
              e.beginPath(),
                e.moveTo(this._currentMeasure.left, c),
                e.lineTo(
                  this._currentMeasure.left + this._currentMeasure.width,
                  c
                ),
                e.stroke();
            }
          }
          if (this._displayMajorLines) {
            for (
              e.strokeStyle = this._majorLineColor,
                e.lineWidth = this._majorLineTickness,
                s = -i / 2 + this._majorLineFrequency;
              s < i / 2;
              s += this._majorLineFrequency
            )
              (a = r + s * this.cellWidth),
                e.beginPath(),
                e.moveTo(a, this._currentMeasure.top),
                e.lineTo(
                  a,
                  this._currentMeasure.top + this._currentMeasure.height
                ),
                e.stroke();
            for (
              l = -n / 2 + this._majorLineFrequency;
              l < n / 2;
              l += this._majorLineFrequency
            )
              (c = o + l * this.cellHeight),
                e.moveTo(this._currentMeasure.left, c),
                e.lineTo(
                  this._currentMeasure.left + this._currentMeasure.width,
                  c
                ),
                e.closePath(),
                e.stroke();
          }
        }
        e.restore();
      }),
      (t.prototype._getTypeName = function () {
        return "DisplayGrid";
      }),
      t
    );
  })(sf);
  h.RegisteredTypes["BABYLON.GUI.DisplayGrid"] = wf;
  var Nf = (function (e) {
    function t(t) {
      var i = e.call(this, t) || this;
      return (i.name = t), (i._tempMeasure = new nf(0, 0, 0, 0)), i;
    }
    return (
      P(t, e),
      Object.defineProperty(t.prototype, "displayThumb", {
        get: function () {
          return this._displayThumb && null != this.thumbImage;
        },
        set: function (e) {
          this._displayThumb !== e &&
            ((this._displayThumb = e), this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "backgroundImage", {
        get: function () {
          return this._backgroundImage;
        },
        set: function (e) {
          var t = this;
          this._backgroundImage !== e &&
            ((this._backgroundImage = e),
            e &&
              !e.isLoaded &&
              e.onImageLoadedObservable.addOnce(function () {
                return t._markAsDirty();
              }),
            this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "valueBarImage", {
        get: function () {
          return this._valueBarImage;
        },
        set: function (e) {
          var t = this;
          this._valueBarImage !== e &&
            ((this._valueBarImage = e),
            e &&
              !e.isLoaded &&
              e.onImageLoadedObservable.addOnce(function () {
                return t._markAsDirty();
              }),
            this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      Object.defineProperty(t.prototype, "thumbImage", {
        get: function () {
          return this._thumbImage;
        },
        set: function (e) {
          var t = this;
          this._thumbImage !== e &&
            ((this._thumbImage = e),
            e &&
              !e.isLoaded &&
              e.onImageLoadedObservable.addOnce(function () {
                return t._markAsDirty();
              }),
            this._markAsDirty());
        },
        enumerable: !1,
        configurable: !0,
      }),
      (t.prototype._getTypeName = function () {
        return "ImageBasedSlider";
      }),
      (t.prototype._draw = function (e, t) {
        e.save(), this._applyStates(e), this._prepareRenderingData("rectangle");
        var i = this._getThumbPosition(),
          n = this._renderLeft,
          r = this._renderTop,
          o = this._renderWidth,
          s = this._renderHeight;
        this._backgroundImage &&
          (this._tempMeasure.copyFromFloats(n, r, o, s),
          this.isThumbClamped &&
            this.displayThumb &&
            (this.isVertical
              ? (this._tempMeasure.height += this._effectiveThumbThickness)
              : (this._tempMeasure.width += this._effectiveThumbThickness)),
          this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),
          this._backgroundImage._draw(e)),
          this._valueBarImage &&
            (this.isVertical
              ? this.isThumbClamped && this.displayThumb
                ? this._tempMeasure.copyFromFloats(
                    n,
                    r + i,
                    o,
                    s - i + this._effectiveThumbThickness
                  )
                : this._tempMeasure.copyFromFloats(n, r + i, o, s - i)
              : this.isThumbClamped && this.displayThumb
                ? this._tempMeasure.copyFromFloats(
                    n,
                    r,
                    i + this._effectiveThumbThickness / 2,
                    s
                  )
                : this._tempMeasure.copyFromFloats(n, r, i, s),
            this._valueBarImage._currentMeasure.copyFrom(this._tempMeasure),
            this._valueBarImage._draw(e)),
          this.displayThumb &&
            (this.isVertical
              ? this._tempMeasure.copyFromFloats(
                  n - this._effectiveBarOffset,
                  this._currentMeasure.top + i,
                  this._currentMeasure.width,
                  this._effectiveThumbThickness
                )
              : this._tempMeasure.copyFromFloats(
                  this._currentMeasure.left + i,
                  this._currentMeasure.top,
                  this._effectiveThumbThickness,
                  this._currentMeasure.height
                ),
            this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),
            this._thumbImage._draw(e)),
          e.restore();
      }),
      t
    );
  })(Ef);
  (h.RegisteredTypes["BABYLON.GUI.ImageBasedSlider"] = Nf),
    (sf.AddHeader = function (e, t, i, n) {
      var r = new pf("panel"),
        o = !n || n.isHorizontal,
        s = !n || n.controlFirst;
      r.isVertical = !o;
      var a = new uf("header");
      return (
        (a.text = t),
        (a.textHorizontalAlignment = sf.HORIZONTAL_ALIGNMENT_LEFT),
        o ? (a.width = i) : (a.height = i),
        s
          ? (r.addControl(e), r.addControl(a), (a.paddingLeft = "5px"))
          : (r.addControl(a), r.addControl(e), (a.paddingRight = "5px")),
        (a.shadowBlur = e.shadowBlur),
        (a.shadowColor = e.shadowColor),
        (a.shadowOffsetX = e.shadowOffsetX),
        (a.shadowOffsetY = e.shadowOffsetY),
        r
      );
    });
  var Lf = (function () {
      function e(e) {
        (this._fontFamily = "Arial"),
          (this._fontStyle = ""),
          (this._fontWeight = ""),
          (this._fontSize = new Zp(18, Zp.UNITMODE_PIXEL, !1)),
          (this.onChangedObservable = new o()),
          (this._host = e);
      }
      return (
        Object.defineProperty(e.prototype, "fontSize", {
          get: function () {
            return this._fontSize.toString(this._host);
          },
          set: function (e) {
            this._fontSize.toString(this._host) !== e &&
              this._fontSize.fromString(e) &&
              this.onChangedObservable.notifyObservers(this);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "fontFamily", {
          get: function () {
            return this._fontFamily;
          },
          set: function (e) {
            this._fontFamily !== e &&
              ((this._fontFamily = e),
              this.onChangedObservable.notifyObservers(this));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "fontStyle", {
          get: function () {
            return this._fontStyle;
          },
          set: function (e) {
            this._fontStyle !== e &&
              ((this._fontStyle = e),
              this.onChangedObservable.notifyObservers(this));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "fontWeight", {
          get: function () {
            return this._fontWeight;
          },
          set: function (e) {
            this._fontWeight !== e &&
              ((this._fontWeight = e),
              this.onChangedObservable.notifyObservers(this));
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.dispose = function () {
          this.onChangedObservable.clear();
        }),
        e
      );
    })(),
    Ff = (function (e) {
      function t(t, i, n, r, s, a, l) {
        void 0 === i && (i = 0),
          void 0 === n && (n = 0),
          void 0 === s && (s = !1),
          void 0 === a && (a = mn.NEAREST_SAMPLINGMODE);
        var c =
          e.call(
            this,
            t,
            {
              width: i,
              height: n,
            },
            r,
            s,
            a,
            jo.TEXTUREFORMAT_RGBA,
            l
          ) || this;
        return (
          (c._isDirty = !1),
          (c._rootContainer = new af("root")),
          (c._lastControlOver = {}),
          (c._lastControlDown = {}),
          (c._capturingControl = {}),
          (c._linkedControls = new Array()),
          (c._isFullscreen = !1),
          (c._fullscreenViewport = new Kt(0, 0, 1, 1)),
          (c._idealWidth = 0),
          (c._idealHeight = 0),
          (c._useSmallestIdeal = !1),
          (c._renderAtIdealSize = !1),
          (c._blockNextFocusCheck = !1),
          (c._renderScale = 1),
          (c._cursorChanged = !1),
          (c._defaultMousePointerId = 0),
          (c._numLayoutCalls = 0),
          (c._numRenderCalls = 0),
          (c._clipboardData = ""),
          (c.onClipboardObservable = new o()),
          (c.onControlPickedObservable = new o()),
          (c.onBeginLayoutObservable = new o()),
          (c.onEndLayoutObservable = new o()),
          (c.onBeginRenderObservable = new o()),
          (c.onEndRenderObservable = new o()),
          (c.premulAlpha = !1),
          (c.applyYInversionOnUpdate = !0),
          (c._useInvalidateRectOptimization = !0),
          (c._invalidatedRectangle = null),
          (c._clearMeasure = new nf(0, 0, 0, 0)),
          (c.onClipboardCopy = function (e) {
            var t = e,
              i = new hs(us.COPY, t);
            c.onClipboardObservable.notifyObservers(i), t.preventDefault();
          }),
          (c.onClipboardCut = function (e) {
            var t = e,
              i = new hs(us.CUT, t);
            c.onClipboardObservable.notifyObservers(i), t.preventDefault();
          }),
          (c.onClipboardPaste = function (e) {
            var t = e,
              i = new hs(us.PASTE, t);
            c.onClipboardObservable.notifyObservers(i), t.preventDefault();
          }),
          (r = c.getScene()) && c._texture
            ? ((c._rootElement = r.getEngine().getInputElement()),
              (c._renderObserver = r.onBeforeCameraRenderObservable.add(
                function (e) {
                  return c._checkUpdate(e);
                }
              )),
              (c._preKeyboardObserver = r.onPreKeyboardObservable.add(
                function (e) {
                  c._focusedControl &&
                    (e.type === gi.KEYDOWN &&
                      c._focusedControl.processKeyboard(e.event),
                    (e.skipOnPointerObservable = !0));
                }
              )),
              c._rootContainer._link(c),
              (c.hasAlpha = !0),
              (i && n) ||
                ((c._resizeObserver = r
                  .getEngine()
                  .onResizeObservable.add(function () {
                    return c._onResize();
                  })),
                c._onResize()),
              (c._texture.isReady = !0),
              c)
            : c
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "numLayoutCalls", {
          get: function () {
            return this._numLayoutCalls;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "numRenderCalls", {
          get: function () {
            return this._numRenderCalls;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "renderScale", {
          get: function () {
            return this._renderScale;
          },
          set: function (e) {
            e !== this._renderScale &&
              ((this._renderScale = e), this._onResize());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "background", {
          get: function () {
            return this._background;
          },
          set: function (e) {
            this._background !== e &&
              ((this._background = e), this.markAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "idealWidth", {
          get: function () {
            return this._idealWidth;
          },
          set: function (e) {
            this._idealWidth !== e &&
              ((this._idealWidth = e),
              this.markAsDirty(),
              this._rootContainer._markAllAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "idealHeight", {
          get: function () {
            return this._idealHeight;
          },
          set: function (e) {
            this._idealHeight !== e &&
              ((this._idealHeight = e),
              this.markAsDirty(),
              this._rootContainer._markAllAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "useSmallestIdeal", {
          get: function () {
            return this._useSmallestIdeal;
          },
          set: function (e) {
            this._useSmallestIdeal !== e &&
              ((this._useSmallestIdeal = e),
              this.markAsDirty(),
              this._rootContainer._markAllAsDirty());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "renderAtIdealSize", {
          get: function () {
            return this._renderAtIdealSize;
          },
          set: function (e) {
            this._renderAtIdealSize !== e &&
              ((this._renderAtIdealSize = e), this._onResize());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "idealRatio", {
          get: function () {
            var e = 0,
              t = 0;
            return (
              this._idealWidth && (e = this.getSize().width / this._idealWidth),
              this._idealHeight &&
                (t = this.getSize().height / this._idealHeight),
              this._useSmallestIdeal && this._idealWidth && this._idealHeight
                ? window.innerWidth < window.innerHeight
                  ? e
                  : t
                : this._idealWidth
                  ? e
                  : this._idealHeight
                    ? t
                    : 1
            );
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "layer", {
          get: function () {
            return this._layerToDispose;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "rootContainer", {
          get: function () {
            return this._rootContainer;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getChildren = function () {
          return [this._rootContainer];
        }),
        (t.prototype.getDescendants = function (e, t) {
          return this._rootContainer.getDescendants(e, t);
        }),
        Object.defineProperty(t.prototype, "focusedControl", {
          get: function () {
            return this._focusedControl;
          },
          set: function (e) {
            this._focusedControl != e &&
              (this._focusedControl && this._focusedControl.onBlur(),
              e && e.onFocus(),
              (this._focusedControl = e));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "isForeground", {
          get: function () {
            return !this.layer || !this.layer.isBackground;
          },
          set: function (e) {
            this.layer &&
              this.layer.isBackground !== !e &&
              (this.layer.isBackground = !e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "clipboardData", {
          get: function () {
            return this._clipboardData;
          },
          set: function (e) {
            this._clipboardData = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.getClassName = function () {
          return "AdvancedDynamicTexture";
        }),
        (t.prototype.executeOnAllControls = function (e, t) {
          t || (t = this._rootContainer), e(t);
          for (var i = 0, n = t.children; i < n.length; i++) {
            var r = n[i];
            r.children ? this.executeOnAllControls(e, r) : e(r);
          }
        }),
        Object.defineProperty(t.prototype, "useInvalidateRectOptimization", {
          get: function () {
            return this._useInvalidateRectOptimization;
          },
          set: function (e) {
            this._useInvalidateRectOptimization = e;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.invalidateRect = function (e, t, i, n) {
          if (this._useInvalidateRectOptimization)
            if (this._invalidatedRectangle) {
              var r = Math.ceil(
                  Math.max(
                    this._invalidatedRectangle.left +
                      this._invalidatedRectangle.width -
                      1,
                    i
                  )
                ),
                o = Math.ceil(
                  Math.max(
                    this._invalidatedRectangle.top +
                      this._invalidatedRectangle.height -
                      1,
                    n
                  )
                );
              (this._invalidatedRectangle.left = Math.floor(
                Math.min(this._invalidatedRectangle.left, e)
              )),
                (this._invalidatedRectangle.top = Math.floor(
                  Math.min(this._invalidatedRectangle.top, t)
                )),
                (this._invalidatedRectangle.width =
                  r - this._invalidatedRectangle.left + 1),
                (this._invalidatedRectangle.height =
                  o - this._invalidatedRectangle.top + 1);
            } else
              this._invalidatedRectangle = new nf(e, t, i - e + 1, n - t + 1);
        }),
        (t.prototype.markAsDirty = function () {
          this._isDirty = !0;
        }),
        (t.prototype.createStyle = function () {
          return new Lf(this);
        }),
        (t.prototype.addControl = function (e) {
          return this._rootContainer.addControl(e), this;
        }),
        (t.prototype.removeControl = function (e) {
          return this._rootContainer.removeControl(e), this;
        }),
        (t.prototype.dispose = function () {
          var t = this.getScene();
          t &&
            ((this._rootElement = null),
            t.onBeforeCameraRenderObservable.remove(this._renderObserver),
            this._resizeObserver &&
              t.getEngine().onResizeObservable.remove(this._resizeObserver),
            this._pointerMoveObserver &&
              t.onPrePointerObservable.remove(this._pointerMoveObserver),
            this._pointerObserver &&
              t.onPointerObservable.remove(this._pointerObserver),
            this._preKeyboardObserver &&
              t.onPreKeyboardObservable.remove(this._preKeyboardObserver),
            this._canvasPointerOutObserver &&
              t
                .getEngine()
                .onCanvasPointerOutObservable.remove(
                  this._canvasPointerOutObserver
                ),
            this._canvasBlurObserver &&
              t
                .getEngine()
                .onCanvasBlurObservable.remove(this._canvasBlurObserver),
            this._layerToDispose &&
              ((this._layerToDispose.texture = null),
              this._layerToDispose.dispose(),
              (this._layerToDispose = null)),
            this._rootContainer.dispose(),
            this.onClipboardObservable.clear(),
            this.onControlPickedObservable.clear(),
            this.onBeginRenderObservable.clear(),
            this.onEndRenderObservable.clear(),
            this.onBeginLayoutObservable.clear(),
            this.onEndLayoutObservable.clear(),
            e.prototype.dispose.call(this));
        }),
        (t.prototype._onResize = function () {
          var e = this.getScene();
          if (e) {
            var t = e.getEngine(),
              i = this.getSize(),
              n = t.getRenderWidth() * this._renderScale,
              r = t.getRenderHeight() * this._renderScale;
            this._renderAtIdealSize &&
              (this._idealWidth
                ? ((r = (r * this._idealWidth) / n), (n = this._idealWidth))
                : this._idealHeight &&
                  ((n = (n * this._idealHeight) / r), (r = this._idealHeight))),
              (i.width === n && i.height === r) ||
                (this.scaleTo(n, r),
                this.markAsDirty(),
                (this._idealWidth || this._idealHeight) &&
                  this._rootContainer._markAllAsDirty()),
              this.invalidateRect(0, 0, i.width - 1, i.height - 1);
          }
        }),
        (t.prototype._getGlobalViewport = function (e) {
          var t = e.getEngine();
          return this._fullscreenViewport.toGlobal(
            t.getRenderWidth(),
            t.getRenderHeight()
          );
        }),
        (t.prototype.getProjectedPosition = function (e, t) {
          var i = this.getScene();
          if (!i) return p.Zero();
          var n = this._getGlobalViewport(i),
            r = f.Project(e, t, i.getTransformMatrix(), n);
          return r.scaleInPlace(this.renderScale), new p(r.x, r.y);
        }),
        (t.prototype.getProjectedPositionWithZ = function (e, t) {
          var i = this.getScene();
          if (!i) return f.Zero();
          var n = this._getGlobalViewport(i),
            r = f.Project(e, t, i.getTransformMatrix(), n);
          return r.scaleInPlace(this.renderScale), new f(r.x, r.y, r.z);
        }),
        (t.prototype._checkUpdate = function (e) {
          if (
            !this._layerToDispose ||
            0 != (e.layerMask & this._layerToDispose.layerMask)
          ) {
            if (this._isFullscreen && this._linkedControls.length) {
              var t = this.getScene();
              if (!t) return;
              for (
                var i = this._getGlobalViewport(t),
                  n = function (e) {
                    if (!e.isVisible) return "continue";
                    var n = e._linkedMesh;
                    if (!n || n.isDisposed())
                      return (
                        yt.SetImmediate(function () {
                          e.linkWithMesh(null);
                        }),
                        "continue"
                      );
                    var o = n.getBoundingInfo
                        ? n.getBoundingInfo().boundingSphere.center
                        : f.ZeroReadOnly,
                      s = f.Project(
                        o,
                        n.getWorldMatrix(),
                        t.getTransformMatrix(),
                        i
                      );
                    if (s.z < 0 || s.z > 1)
                      return (e.notRenderable = !0), "continue";
                    (e.notRenderable = !1),
                      s.scaleInPlace(r.renderScale),
                      e._moveToProjectedPosition(s);
                  },
                  r = this,
                  o = 0,
                  s = this._linkedControls;
                o < s.length;
                o++
              )
                n(s[o]);
            }
            (this._isDirty || this._rootContainer.isDirty) &&
              ((this._isDirty = !1),
              this._render(),
              this.update(this.applyYInversionOnUpdate, this.premulAlpha));
          }
        }),
        (t.prototype._render = function () {
          var e = this.getSize(),
            t = e.width,
            i = e.height,
            n = this.getContext();
          (n.font = "18px Arial"),
            (n.strokeStyle = "white"),
            this.onBeginLayoutObservable.notifyObservers(this);
          var r = new nf(0, 0, t, i);
          (this._numLayoutCalls = 0),
            this._rootContainer._layout(r, n),
            this.onEndLayoutObservable.notifyObservers(this),
            (this._isDirty = !1),
            this._invalidatedRectangle
              ? this._clearMeasure.copyFrom(this._invalidatedRectangle)
              : this._clearMeasure.copyFromFloats(0, 0, t, i),
            n.clearRect(
              this._clearMeasure.left,
              this._clearMeasure.top,
              this._clearMeasure.width,
              this._clearMeasure.height
            ),
            this._background &&
              (n.save(),
              (n.fillStyle = this._background),
              n.fillRect(
                this._clearMeasure.left,
                this._clearMeasure.top,
                this._clearMeasure.width,
                this._clearMeasure.height
              ),
              n.restore()),
            this.onBeginRenderObservable.notifyObservers(this),
            (this._numRenderCalls = 0),
            this._rootContainer._render(n, this._invalidatedRectangle),
            this.onEndRenderObservable.notifyObservers(this),
            (this._invalidatedRectangle = null);
        }),
        (t.prototype._changeCursor = function (e) {
          this._rootElement &&
            ((this._rootElement.style.cursor = e), (this._cursorChanged = !0));
        }),
        (t.prototype._registerLastControlDown = function (e, t) {
          (this._lastControlDown[t] = e),
            this.onControlPickedObservable.notifyObservers(e);
        }),
        (t.prototype._doPicking = function (e, t, i, n, r, o, s, a) {
          var l = this.getScene();
          if (l) {
            var c = l.getEngine(),
              u = this.getSize();
            if (this._isFullscreen) {
              var h = (l.cameraToUseForPointers || l.activeCamera).viewport;
              (e *= u.width / (c.getRenderWidth() * h.width)),
                (t *= u.height / (c.getRenderHeight() * h.height));
            }
            this._capturingControl[r]
              ? this._capturingControl[r]._processObservables(n, e, t, i, r, o)
              : ((this._cursorChanged = !1),
                this._rootContainer._processPicking(e, t, i, n, r, o, s, a) ||
                  (this._changeCursor(""),
                  n === pi.POINTERMOVE &&
                    this._lastControlOver[r] &&
                    (this._lastControlOver[r]._onPointerOut(
                      this._lastControlOver[r],
                      i
                    ),
                    delete this._lastControlOver[r])),
                this._cursorChanged || this._changeCursor(""),
                this._manageFocus());
          }
        }),
        (t.prototype._cleanControlAfterRemovalFromList = function (e, t) {
          for (var i in e) e.hasOwnProperty(i) && e[i] === t && delete e[i];
        }),
        (t.prototype._cleanControlAfterRemoval = function (e) {
          this._cleanControlAfterRemovalFromList(this._lastControlDown, e),
            this._cleanControlAfterRemovalFromList(this._lastControlOver, e);
        }),
        (t.prototype.attach = function () {
          var e = this,
            t = this.getScene();
          if (t) {
            var i = new Kt(0, 0, 0, 0);
            (this._pointerMoveObserver = t.onPrePointerObservable.add(
              function (n, r) {
                if (
                  !t.isPointerCaptured(n.event.pointerId) &&
                  (n.type === pi.POINTERMOVE ||
                    n.type === pi.POINTERUP ||
                    n.type === pi.POINTERDOWN ||
                    n.type === pi.POINTERWHEEL) &&
                  t
                ) {
                  n.type === pi.POINTERMOVE &&
                    n.event.pointerId &&
                    (e._defaultMousePointerId = n.event.pointerId);
                  var o = t.cameraToUseForPointers || t.activeCamera,
                    s = t.getEngine();
                  o
                    ? o.viewport.toGlobalToRef(
                        s.getRenderWidth(),
                        s.getRenderHeight(),
                        i
                      )
                    : ((i.x = 0),
                      (i.y = 0),
                      (i.width = s.getRenderWidth()),
                      (i.height = s.getRenderHeight()));
                  var a = t.pointerX / s.getHardwareScalingLevel() - i.x,
                    l =
                      t.pointerY / s.getHardwareScalingLevel() -
                      (s.getRenderHeight() - i.y - i.height);
                  e._shouldBlockPointer = !1;
                  var c = n.event.pointerId || e._defaultMousePointerId;
                  e._doPicking(
                    a,
                    l,
                    n,
                    n.type,
                    c,
                    n.event.button,
                    n.event.deltaX,
                    n.event.deltaY
                  ),
                    e._shouldBlockPointer &&
                      (n.skipOnPointerObservable = e._shouldBlockPointer);
                }
              }
            )),
              this._attachToOnPointerOut(t),
              this._attachToOnBlur(t);
          }
        }),
        (t.prototype.registerClipboardEvents = function () {
          self.addEventListener("copy", this.onClipboardCopy, !1),
            self.addEventListener("cut", this.onClipboardCut, !1),
            self.addEventListener("paste", this.onClipboardPaste, !1);
        }),
        (t.prototype.unRegisterClipboardEvents = function () {
          self.removeEventListener("copy", this.onClipboardCopy),
            self.removeEventListener("cut", this.onClipboardCut),
            self.removeEventListener("paste", this.onClipboardPaste);
        }),
        (t.prototype.attachToMesh = function (e, t) {
          var i = this;
          void 0 === t && (t = !0);
          var n = this.getScene();
          n &&
            ((this._pointerObserver = n.onPointerObservable.add(
              function (t, n) {
                if (
                  t.type === pi.POINTERMOVE ||
                  t.type === pi.POINTERUP ||
                  t.type === pi.POINTERDOWN
                ) {
                  var r = t.event.pointerId || i._defaultMousePointerId;
                  if (
                    t.pickInfo &&
                    t.pickInfo.hit &&
                    t.pickInfo.pickedMesh === e
                  ) {
                    var o = t.pickInfo.getTextureCoordinates();
                    if (o) {
                      var s = i.getSize();
                      i._doPicking(
                        o.x * s.width,
                        (i.applyYInversionOnUpdate ? 1 - o.y : o.y) * s.height,
                        t,
                        t.type,
                        r,
                        t.event.button
                      );
                    }
                  } else if (t.type === pi.POINTERUP) {
                    if (
                      (i._lastControlDown[r] &&
                        i._lastControlDown[r]._forcePointerUp(r),
                      delete i._lastControlDown[r],
                      i.focusedControl)
                    ) {
                      var a = i.focusedControl.keepsFocusWith(),
                        l = !0;
                      if (a)
                        for (var c = 0, u = a; c < u.length; c++) {
                          var h = u[c];
                          if (i !== h._host) {
                            var d = h._host;
                            if (
                              d._lastControlOver[r] &&
                              d._lastControlOver[r].isAscendant(h)
                            ) {
                              l = !1;
                              break;
                            }
                          }
                        }
                      l && (i.focusedControl = null);
                    }
                  } else
                    t.type === pi.POINTERMOVE &&
                      (i._lastControlOver[r] &&
                        i._lastControlOver[r]._onPointerOut(
                          i._lastControlOver[r],
                          t,
                          !0
                        ),
                      delete i._lastControlOver[r]);
                }
              }
            )),
            (e.enablePointerMoveEvents = t),
            this._attachToOnPointerOut(n),
            this._attachToOnBlur(n));
        }),
        (t.prototype.moveFocusToControl = function (e) {
          (this.focusedControl = e),
            (this._lastPickedControl = e),
            (this._blockNextFocusCheck = !0);
        }),
        (t.prototype._manageFocus = function () {
          if (this._blockNextFocusCheck)
            return (
              (this._blockNextFocusCheck = !1),
              void (this._lastPickedControl = this._focusedControl)
            );
          if (
            this._focusedControl &&
            this._focusedControl !== this._lastPickedControl
          ) {
            if (this._lastPickedControl.isFocusInvisible) return;
            this.focusedControl = null;
          }
        }),
        (t.prototype._attachToOnPointerOut = function (e) {
          var t = this;
          this._canvasPointerOutObserver = e
            .getEngine()
            .onCanvasPointerOutObservable.add(function (e) {
              t._lastControlOver[e.pointerId] &&
                t._lastControlOver[e.pointerId]._onPointerOut(
                  t._lastControlOver[e.pointerId],
                  null
                ),
                delete t._lastControlOver[e.pointerId],
                t._lastControlDown[e.pointerId] &&
                  t._lastControlDown[e.pointerId] !==
                    t._capturingControl[e.pointerId] &&
                  (t._lastControlDown[e.pointerId]._forcePointerUp(),
                  delete t._lastControlDown[e.pointerId]);
            });
        }),
        (t.prototype._attachToOnBlur = function (e) {
          var t = this;
          this._canvasBlurObserver = e
            .getEngine()
            .onCanvasBlurObservable.add(function (e) {
              Object.entries(t._lastControlDown).forEach(function (e) {
                e[0], e[1]._onCanvasBlur();
              }),
                (t._lastControlDown = {});
            });
        }),
        (t.CreateForMesh = function (e, i, n, r, o, s) {
          void 0 === i && (i = 1024),
            void 0 === n && (n = 1024),
            void 0 === r && (r = !0),
            void 0 === o && (o = !1);
          var a = new t(
              e.name + " AdvancedDynamicTexture",
              i,
              n,
              e.getScene(),
              !0,
              mn.TRILINEAR_SAMPLINGMODE,
              s
            ),
            l = new qr("AdvancedDynamicTextureMaterial", e.getScene());
          return (
            (l.backFaceCulling = !1),
            (l.diffuseColor = b.Black()),
            (l.specularColor = b.Black()),
            o
              ? ((l.diffuseTexture = a),
                (l.emissiveTexture = a),
                (a.hasAlpha = !0))
              : ((l.emissiveTexture = a), (l.opacityTexture = a)),
            (e.material = l),
            a.attachToMesh(e, r),
            a
          );
        }),
        (t.CreateForMeshTexture = function (e, i, n, r, o) {
          void 0 === i && (i = 1024),
            void 0 === n && (n = 1024),
            void 0 === r && (r = !0);
          var s = new t(
            e.name + " AdvancedDynamicTexture",
            i,
            n,
            e.getScene(),
            !0,
            mn.TRILINEAR_SAMPLINGMODE,
            o
          );
          return s.attachToMesh(e, r), s;
        }),
        (t.CreateFullscreenUI = function (e, i, n, r) {
          void 0 === i && (i = !0),
            void 0 === n && (n = null),
            void 0 === r && (r = mn.BILINEAR_SAMPLINGMODE);
          var o = new t(e, 0, 0, n, !1, r),
            s = new Ga(e + "_layer", null, n, !i);
          return (
            (s.texture = o),
            (o._layerToDispose = s),
            (o._isFullscreen = !0),
            o.attach(),
            o
          );
        }),
        t
      );
    })(Zr),
    Bf =
      ((function () {
        function e(e) {
          (this.texture = e),
            (this._captureRenderTime = !1),
            (this._renderTime = new Ot()),
            (this._captureLayoutTime = !1),
            (this._layoutTime = new Ot()),
            (this._onBeginRenderObserver = null),
            (this._onEndRenderObserver = null),
            (this._onBeginLayoutObserver = null),
            (this._onEndLayoutObserver = null);
        }
        Object.defineProperty(e.prototype, "renderTimeCounter", {
          get: function () {
            return this._renderTime;
          },
          enumerable: !1,
          configurable: !0,
        }),
          Object.defineProperty(e.prototype, "layoutTimeCounter", {
            get: function () {
              return this._layoutTime;
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "captureRenderTime", {
            get: function () {
              return this._captureRenderTime;
            },
            set: function (e) {
              var t = this;
              e !== this._captureRenderTime &&
                ((this._captureRenderTime = e),
                e
                  ? ((this._onBeginRenderObserver =
                      this.texture.onBeginRenderObservable.add(function () {
                        t._renderTime.beginMonitoring();
                      })),
                    (this._onEndRenderObserver =
                      this.texture.onEndRenderObservable.add(function () {
                        t._renderTime.endMonitoring(!0);
                      })))
                  : (this.texture.onBeginRenderObservable.remove(
                      this._onBeginRenderObserver
                    ),
                    (this._onBeginRenderObserver = null),
                    this.texture.onEndRenderObservable.remove(
                      this._onEndRenderObserver
                    ),
                    (this._onEndRenderObserver = null)));
            },
            enumerable: !1,
            configurable: !0,
          }),
          Object.defineProperty(e.prototype, "captureLayoutTime", {
            get: function () {
              return this._captureLayoutTime;
            },
            set: function (e) {
              var t = this;
              e !== this._captureLayoutTime &&
                ((this._captureLayoutTime = e),
                e
                  ? ((this._onBeginLayoutObserver =
                      this.texture.onBeginLayoutObservable.add(function () {
                        t._layoutTime.beginMonitoring();
                      })),
                    (this._onEndLayoutObserver =
                      this.texture.onEndLayoutObservable.add(function () {
                        t._layoutTime.endMonitoring(!0);
                      })))
                  : (this.texture.onBeginLayoutObservable.remove(
                      this._onBeginLayoutObserver
                    ),
                    (this._onBeginLayoutObserver = null),
                    this.texture.onEndLayoutObservable.remove(
                      this._onEndLayoutObserver
                    ),
                    (this._onEndLayoutObserver = null)));
            },
            enumerable: !1,
            configurable: !0,
          }),
          (e.prototype.dispose = function () {
            this.texture.onBeginRenderObservable.remove(
              this._onBeginRenderObserver
            ),
              (this._onBeginRenderObserver = null),
              this.texture.onEndRenderObservable.remove(
                this._onEndRenderObserver
              ),
              (this._onEndRenderObserver = null),
              this.texture.onBeginLayoutObservable.remove(
                this._onBeginLayoutObserver
              ),
              (this._onBeginLayoutObserver = null),
              this.texture.onEndLayoutObservable.remove(
                this._onEndLayoutObserver
              ),
              (this._onEndLayoutObserver = null),
              (this.texture = null);
          });
      })(),
      (function () {
        function e(e) {
          void 0 === e && (e = null),
            (this._nodes = {}),
            (this._nodeTypes = {
              element: 1,
              attribute: 2,
              text: 3,
            }),
            (this._isLoaded = !1),
            (this._objectAttributes = {
              textHorizontalAlignment: 1,
              textVerticalAlignment: 2,
              horizontalAlignment: 3,
              verticalAlignment: 4,
              stretch: 5,
            }),
            e && (this._parentClass = e);
        }
        (e.prototype._getChainElement = function (e) {
          var t = window;
          this._parentClass && (t = this._parentClass);
          var i = e;
          i = i.split(".");
          for (var n = 0; n < i.length; n++) t = t[i[n]];
          return t;
        }),
          (e.prototype._getClassAttribute = function (e) {
            var t = e.split(".");
            return h.GetClass("BABYLON.GUI." + t[0])[t[1]];
          }),
          (e.prototype._createGuiElement = function (e, t, i) {
            void 0 === i && (i = !0);
            try {
              var n = new (h.GetClass("BABYLON.GUI." + e.nodeName))();
              t && i && t.addControl(n);
              for (var r = 0; r < e.attributes.length; r++)
                if (!e.attributes[r].name.toLowerCase().includes("datasource"))
                  if (
                    e.attributes[r].name.toLowerCase().includes("observable")
                  ) {
                    var o = this._getChainElement(e.attributes[r].value);
                    n[e.attributes[r].name].add(o);
                  } else
                    "linkWithMesh" == e.attributes[r].name
                      ? this._parentClass
                        ? n.linkWithMesh(
                            this._parentClass[e.attributes[r].value]
                          )
                        : n.linkWithMesh(window[e.attributes[r].value])
                      : e.attributes[r].value.startsWith("{{") &&
                          e.attributes[r].value.endsWith("}}")
                        ? ((o = this._getChainElement(
                            e.attributes[r].value.substring(
                              2,
                              e.attributes[r].value.length - 2
                            )
                          )),
                          (n[e.attributes[r].name] = o))
                        : this._objectAttributes[e.attributes[r].name]
                          ? (n[e.attributes[r].name] = this._getClassAttribute(
                              e.attributes[r].value
                            ))
                          : "true" == e.attributes[r].value ||
                              "false" == e.attributes[r].value
                            ? (n[e.attributes[r].name] =
                                "true" == e.attributes[r].value)
                            : (n[e.attributes[r].name] = isNaN(
                                Number(e.attributes[r].value)
                              )
                                ? e.attributes[r].value
                                : Number(e.attributes[r].value));
              if (!e.attributes.getNamedItem("id"))
                return (
                  (this._nodes[
                    e.nodeName + Object.keys(this._nodes).length + "_gen"
                  ] = n),
                  n
                );
              var s = e.attributes.getNamedItem("id").value;
              if (
                (s.startsWith("{{") &&
                  s.endsWith("}}") &&
                  (s = this._getChainElement(s.substring(2, s.length - 2))),
                this._nodes[s])
              )
                throw "XmlLoader Exception : Duplicate ID, every element should have an unique ID attribute";
              return (this._nodes[s] = n), n;
            } catch (t) {
              throw (
                "XmlLoader Exception : Error parsing Control " +
                e.nodeName +
                "," +
                t +
                "."
              );
            }
          }),
          (e.prototype._parseGrid = function (e, t, i) {
            for (
              var n,
                r,
                o,
                s,
                a,
                l = e.children,
                c = !1,
                u = -1,
                h = -1,
                d = 0,
                p = 0;
              p < l.length;
              p++
            )
              if (l[p].nodeType == this._nodeTypes.element) {
                if ("Row" != l[p].nodeName)
                  throw (
                    "XmlLoader Exception : Expecting Row node, received " +
                    l[p].nodeName
                  );
                if (
                  ((u += 1),
                  (o = l[p].children),
                  !l[p].attributes.getNamedItem("height"))
                )
                  throw "XmlLoader Exception : Height must be defined for grid rows";
                (r = Number(l[p].attributes.getNamedItem("height").nodeValue)),
                  (c =
                    !!l[p].attributes.getNamedItem("isPixel") &&
                    JSON.parse(
                      l[p].attributes.getNamedItem("isPixel").nodeValue
                    )),
                  t.addRowDefinition(r, c);
                for (var f = 0; f < o.length; f++)
                  if (o[f].nodeType == this._nodeTypes.element) {
                    if ("Column" != o[f].nodeName)
                      throw (
                        "XmlLoader Exception : Expecting Column node, received " +
                        o[f].nodeName
                      );
                    if (((h += 1), u > 0 && h > d))
                      throw "XmlLoader Exception : In the Grid element, the number of columns is defined in the first row, do not add more columns in the subsequent rows.";
                    if (0 == u) {
                      if (!o[f].attributes.getNamedItem("width"))
                        throw "XmlLoader Exception : Width must be defined for all the grid columns in the first row";
                      (n = Number(
                        o[f].attributes.getNamedItem("width").nodeValue
                      )),
                        (c =
                          !!o[f].attributes.getNamedItem("isPixel") &&
                          JSON.parse(
                            o[f].attributes.getNamedItem("isPixel").nodeValue
                          )),
                        t.addColumnDefinition(n, c);
                    }
                    s = o[f].children;
                    for (var _ = 0; _ < s.length; _++)
                      s[_].nodeType == this._nodeTypes.element &&
                        ((a = this._createGuiElement(s[_], t, !1)),
                        t.addControl(a, u, h),
                        s[_].firstChild && this._parseXml(s[_].firstChild, a));
                  }
                0 == u && (d = h), (h = -1);
              }
            e.nextSibling && this._parseXml(e.nextSibling, i);
          }),
          (e.prototype._parseElement = function (e, t, i) {
            e.firstChild && this._parseXml(e.firstChild, t),
              e.nextSibling && this._parseXml(e.nextSibling, i);
          }),
          (e.prototype._prepareSourceElement = function (e, t, i, n, r) {
            this._parentClass
              ? (this._parentClass[i] = n[r])
              : (window[i] = n[r]),
              e.firstChild && this._parseXml(e.firstChild, t, !0);
          }),
          (e.prototype._parseElementsFromSource = function (e, t, i) {
            var n = e.attributes.getNamedItem("dataSource").value;
            if (!n.includes(" in "))
              throw "XmlLoader Exception : Malformed XML, Data Source must include an in";
            var r = !0,
              o = n.split(" in ");
            if (o.length < 2)
              throw "XmlLoader Exception : Malformed XML, Data Source must an iterator and a source";
            var s = o[1];
            if (
              (s.startsWith("{") && s.endsWith("}") && (r = !1),
              (!r || (s.startsWith("[") && s.endsWith("]"))) &&
                (s = s.substring(1, s.length - 1)),
              (s = this._parentClass ? this._parentClass[s] : window[s]),
              r)
            )
              for (var a = 0; a < s.length; a++)
                this._prepareSourceElement(e, t, o[0], s, a);
            else for (var a in s) this._prepareSourceElement(e, t, o[0], s, a);
            e.nextSibling && this._parseXml(e.nextSibling, i);
          }),
          (e.prototype._parseXml = function (e, t, i) {
            if (
              (void 0 === i && (i = !1), e.nodeType == this._nodeTypes.element)
            ) {
              i && e.setAttribute("id", t.id + (t._children.length + 1));
              var n = this._createGuiElement(e, t);
              "Grid" == e.nodeName
                ? this._parseGrid(e, n, t)
                : e.attributes.getNamedItem("dataSource")
                  ? this._parseElementsFromSource(e, n, t)
                  : this._parseElement(e, n, t);
            } else e.nextSibling && this._parseXml(e.nextSibling, t, i);
          }),
          (e.prototype.isLoaded = function () {
            return this._isLoaded;
          }),
          (e.prototype.getNodeById = function (e) {
            return this._nodes[e];
          }),
          (e.prototype.getNodes = function () {
            return this._nodes;
          }),
          (e.prototype.loadLayout = function (e, t, i) {
            var n = new XMLHttpRequest();
            (n.onreadystatechange = function () {
              if (4 == n.readyState && 200 == n.status) {
                if (!n.responseXML)
                  throw "XmlLoader Exception : XML file is malformed or corrupted.";
                var e = n.responseXML.documentElement;
                this._parseXml(e.firstChild, t),
                  (this._isLoaded = !0),
                  i && i();
              }
            }.bind(this)),
              n.open("GET", e, !0),
              n.send();
          });
      })(),
      (function (e) {
        function t(t, i) {
          void 0 === i && (i = 0);
          var n = e.call(this, t.x, t.y, t.z) || this;
          return (n.buttonIndex = i), n;
        }
        return P(t, e), t;
      })(f)),
    Vf = (function () {
      function e(e) {
        (this.name = e),
          (this._downCount = 0),
          (this._enterCount = -1),
          (this._downPointerIds = {}),
          (this._isVisible = !0),
          (this.onPointerMoveObservable = new o()),
          (this.onPointerOutObservable = new o()),
          (this.onPointerDownObservable = new o()),
          (this.onPointerUpObservable = new o()),
          (this.onPointerClickObservable = new o()),
          (this.onPointerEnterObservable = new o()),
          (this._behaviors = new Array());
      }
      return (
        Object.defineProperty(e.prototype, "position", {
          get: function () {
            return this._node ? this._node.position : f.Zero();
          },
          set: function (e) {
            this._node && (this._node.position = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "scaling", {
          get: function () {
            return this._node ? this._node.scaling : new f(1, 1, 1);
          },
          set: function (e) {
            this._node && (this._node.scaling = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "behaviors", {
          get: function () {
            return this._behaviors;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.addBehavior = function (e) {
          var t = this;
          if (-1 !== this._behaviors.indexOf(e)) return this;
          e.init();
          var i = this._host.scene;
          return (
            i.isLoading
              ? i.onDataLoadedObservable.addOnce(function () {
                  e.attach(t);
                })
              : e.attach(this),
            this._behaviors.push(e),
            this
          );
        }),
        (e.prototype.removeBehavior = function (e) {
          var t = this._behaviors.indexOf(e);
          return (
            -1 === t ||
              (this._behaviors[t].detach(), this._behaviors.splice(t, 1)),
            this
          );
        }),
        (e.prototype.getBehaviorByName = function (e) {
          for (var t = 0, i = this._behaviors; t < i.length; t++) {
            var n = i[t];
            if (n.name === e) return n;
          }
          return null;
        }),
        Object.defineProperty(e.prototype, "isVisible", {
          get: function () {
            return this._isVisible;
          },
          set: function (e) {
            if (this._isVisible !== e) {
              this._isVisible = e;
              var t = this.mesh;
              t && t.setEnabled(e);
            }
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "typeName", {
          get: function () {
            return this._getTypeName();
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.getClassName = function () {
          return this._getTypeName();
        }),
        (e.prototype._getTypeName = function () {
          return "Control3D";
        }),
        Object.defineProperty(e.prototype, "node", {
          get: function () {
            return this._node;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(e.prototype, "mesh", {
          get: function () {
            return this._node instanceof Yt ? this._node : null;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.linkToTransformNode = function (e) {
          return this._node && (this._node.parent = e), this;
        }),
        (e.prototype._prepareNode = function (e) {
          if (!this._node) {
            if (((this._node = this._createNode(e)), !this.node)) return;
            (this._node.metadata = this),
              (this._node.position = this.position),
              (this._node.scaling = this.scaling);
            var t = this.mesh;
            t && ((t.isPickable = !0), this._affectMaterial(t));
          }
        }),
        (e.prototype._createNode = function (e) {
          return null;
        }),
        (e.prototype._affectMaterial = function (e) {
          e.material = null;
        }),
        (e.prototype._onPointerMove = function (e, t) {
          this.onPointerMoveObservable.notifyObservers(t, -1, e, this);
        }),
        (e.prototype._onPointerEnter = function (e) {
          return !(
            this._enterCount > 0 ||
            (-1 === this._enterCount && (this._enterCount = 0),
            this._enterCount++,
            this.onPointerEnterObservable.notifyObservers(this, -1, e, this),
            this.pointerEnterAnimation && this.pointerEnterAnimation(),
            0)
          );
        }),
        (e.prototype._onPointerOut = function (e) {
          (this._enterCount = 0),
            this.onPointerOutObservable.notifyObservers(this, -1, e, this),
            this.pointerOutAnimation && this.pointerOutAnimation();
        }),
        (e.prototype._onPointerDown = function (e, t, i, n) {
          return 0 !== this._downCount
            ? (this._downCount++, !1)
            : (this._downCount++,
              (this._downPointerIds[i] = !0),
              this.onPointerDownObservable.notifyObservers(
                new Bf(t, n),
                -1,
                e,
                this
              ),
              this.pointerDownAnimation && this.pointerDownAnimation(),
              !0);
        }),
        (e.prototype._onPointerUp = function (e, t, i, n, r) {
          this._downCount--,
            delete this._downPointerIds[i],
            this._downCount < 0
              ? (this._downCount = 0)
              : 0 == this._downCount &&
                (r &&
                  (this._enterCount > 0 || -1 === this._enterCount) &&
                  this.onPointerClickObservable.notifyObservers(
                    new Bf(t, n),
                    -1,
                    e,
                    this
                  ),
                this.onPointerUpObservable.notifyObservers(
                  new Bf(t, n),
                  -1,
                  e,
                  this
                ),
                this.pointerUpAnimation && this.pointerUpAnimation());
        }),
        (e.prototype.forcePointerUp = function (e) {
          if ((void 0 === e && (e = null), null !== e))
            this._onPointerUp(this, f.Zero(), e, 0, !0);
          else {
            for (var t in this._downPointerIds)
              this._onPointerUp(this, f.Zero(), +t, 0, !0);
            this._downCount > 0 &&
              ((this._downCount = 1),
              this._onPointerUp(this, f.Zero(), 0, 0, !0));
          }
        }),
        (e.prototype._processObservables = function (e, t, i, n) {
          if (e === pi.POINTERMOVE) {
            this._onPointerMove(this, t);
            var r = this._host._lastControlOver[i];
            return (
              r && r !== this && r._onPointerOut(this),
              r !== this && this._onPointerEnter(this),
              (this._host._lastControlOver[i] = this),
              !0
            );
          }
          return e === pi.POINTERDOWN
            ? (this._onPointerDown(this, t, i, n),
              (this._host._lastControlDown[i] = this),
              (this._host._lastPickedControl = this),
              !0)
            : (e === pi.POINTERUP || e === pi.POINTERDOUBLETAP) &&
                (this._host._lastControlDown[i] &&
                  this._host._lastControlDown[i]._onPointerUp(
                    this,
                    t,
                    i,
                    n,
                    !0
                  ),
                delete this._host._lastControlDown[i],
                !0);
        }),
        (e.prototype._disposeNode = function () {
          this._node && (this._node.dispose(), (this._node = null));
        }),
        (e.prototype.dispose = function () {
          this.onPointerDownObservable.clear(),
            this.onPointerEnterObservable.clear(),
            this.onPointerMoveObservable.clear(),
            this.onPointerOutObservable.clear(),
            this.onPointerUpObservable.clear(),
            this.onPointerClickObservable.clear(),
            this._disposeNode();
          for (var e = 0, t = this._behaviors; e < t.length; e++) t[e].detach();
        }),
        e
      );
    })(),
    kf = (function (e) {
      function t(t) {
        var i = e.call(this, t) || this;
        return (
          (i._contentResolution = 512),
          (i._contentScaleRatio = 2),
          (i.pointerEnterAnimation = function () {
            i.mesh && (i._currentMaterial.emissiveColor = b.Red());
          }),
          (i.pointerOutAnimation = function () {
            i._currentMaterial.emissiveColor = b.Black();
          }),
          (i.pointerDownAnimation = function () {
            i.mesh && i.mesh.scaling.scaleInPlace(0.95);
          }),
          (i.pointerUpAnimation = function () {
            i.mesh && i.mesh.scaling.scaleInPlace(1 / 0.95);
          }),
          i
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "contentResolution", {
          get: function () {
            return this._contentResolution;
          },
          set: function (e) {
            this._contentResolution !== e &&
              ((this._contentResolution = e), this._resetContent());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "contentScaleRatio", {
          get: function () {
            return this._contentScaleRatio;
          },
          set: function (e) {
            this._contentScaleRatio !== e &&
              ((this._contentScaleRatio = e), this._resetContent());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._disposeFacadeTexture = function () {
          this._facadeTexture &&
            (this._facadeTexture.dispose(), (this._facadeTexture = null));
        }),
        (t.prototype._resetContent = function () {
          this._disposeFacadeTexture(), (this.content = this._content);
        }),
        Object.defineProperty(t.prototype, "content", {
          get: function () {
            return this._content;
          },
          set: function (e) {
            (this._content = e),
              this._host &&
                this._host.utilityLayer &&
                (this._facadeTexture
                  ? this._facadeTexture.rootContainer.clearControls()
                  : ((this._facadeTexture = new Ff(
                      "Facade",
                      this._contentResolution,
                      this._contentResolution,
                      this._host.utilityLayer.utilityLayerScene,
                      !0,
                      mn.TRILINEAR_SAMPLINGMODE
                    )),
                    (this._facadeTexture.rootContainer.scaleX =
                      this._contentScaleRatio),
                    (this._facadeTexture.rootContainer.scaleY =
                      this._contentScaleRatio),
                    (this._facadeTexture.premulAlpha = !0)),
                this._facadeTexture.addControl(e),
                this._applyFacade(this._facadeTexture));
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._applyFacade = function (e) {
          this._currentMaterial.emissiveTexture = e;
        }),
        (t.prototype._getTypeName = function () {
          return "Button3D";
        }),
        (t.prototype._createNode = function (e) {
          for (var t = new Array(6), i = 0; i < 6; i++)
            t[i] = new _(0, 0, 0, 0);
          return (
            (t[1] = new _(0, 0, 1, 1)),
            Eo.CreateBox(
              this.name + "_rootMesh",
              {
                width: 1,
                height: 1,
                depth: 0.08,
                faceUV: t,
              },
              e
            )
          );
        }),
        (t.prototype._affectMaterial = function (e) {
          var t = new qr(this.name + "Material", e.getScene());
          (t.specularColor = b.Black()),
            (e.material = t),
            (this._currentMaterial = t),
            this._resetContent();
        }),
        (t.prototype.dispose = function () {
          e.prototype.dispose.call(this),
            this._disposeFacadeTexture(),
            this._currentMaterial && this._currentMaterial.dispose();
        }),
        t
      );
    })(
      (function (e) {
        function t(t) {
          return e.call(this, t) || this;
        }
        return (
          P(t, e),
          (t.prototype._getTypeName = function () {
            return "AbstractButton3D";
          }),
          (t.prototype._createNode = function (e) {
            return new At("button" + this.name);
          }),
          t
        );
      })(Vf)
    ),
    Uf = (function (e) {
      function t(t) {
        var i = e.call(this, t) || this;
        return (i._blockLayout = !1), (i._children = new Array()), i;
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "children", {
          get: function () {
            return this._children;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "blockLayout", {
          get: function () {
            return this._blockLayout;
          },
          set: function (e) {
            this._blockLayout !== e &&
              ((this._blockLayout = e),
              this._blockLayout || this._arrangeChildren());
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype.updateLayout = function () {
          return this._arrangeChildren(), this;
        }),
        (t.prototype.containsControl = function (e) {
          return -1 !== this._children.indexOf(e);
        }),
        (t.prototype.addControl = function (e) {
          return (
            -1 !== this._children.indexOf(e) ||
              ((e.parent = this),
              (e._host = this._host),
              this._children.push(e),
              this._host.utilityLayer &&
                (e._prepareNode(this._host.utilityLayer.utilityLayerScene),
                e.node && (e.node.parent = this.node),
                this.blockLayout || this._arrangeChildren())),
            this
          );
        }),
        (t.prototype._arrangeChildren = function () {}),
        (t.prototype._createNode = function (e) {
          return new At("ContainerNode", e);
        }),
        (t.prototype.removeControl = function (e) {
          var t = this._children.indexOf(e);
          return (
            -1 !== t &&
              (this._children.splice(t, 1),
              (e.parent = null),
              e._disposeNode()),
            this
          );
        }),
        (t.prototype._getTypeName = function () {
          return "Container3D";
        }),
        (t.prototype.dispose = function () {
          for (var t = 0, i = this._children; t < i.length; t++) i[t].dispose();
          (this._children = []), e.prototype.dispose.call(this);
        }),
        (t.UNSET_ORIENTATION = 0),
        (t.FACEORIGIN_ORIENTATION = 1),
        (t.FACEORIGINREVERSED_ORIENTATION = 2),
        (t.FACEFORWARD_ORIENTATION = 3),
        (t.FACEFORWARDREVERSED_ORIENTATION = 4),
        t
      );
    })(Vf),
    zf = (function (e) {
      function t() {
        var t = e.call(this) || this;
        return (
          (t._columns = 10),
          (t._rows = 0),
          (t._rowThenColum = !0),
          (t._orientation = Uf.FACEORIGIN_ORIENTATION),
          (t.margin = 0),
          t
        );
      }
      return (
        P(t, e),
        Object.defineProperty(t.prototype, "orientation", {
          get: function () {
            return this._orientation;
          },
          set: function (e) {
            var t = this;
            this._orientation !== e &&
              ((this._orientation = e),
              yt.SetImmediate(function () {
                t._arrangeChildren();
              }));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "columns", {
          get: function () {
            return this._columns;
          },
          set: function (e) {
            var t = this;
            this._columns !== e &&
              ((this._columns = e),
              (this._rowThenColum = !0),
              yt.SetImmediate(function () {
                t._arrangeChildren();
              }));
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "rows", {
          get: function () {
            return this._rows;
          },
          set: function (e) {
            var t = this;
            this._rows !== e &&
              ((this._rows = e),
              (this._rowThenColum = !1),
              yt.SetImmediate(function () {
                t._arrangeChildren();
              }));
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._arrangeChildren = function () {
          (this._cellWidth = 0), (this._cellHeight = 0);
          for (
            var e = 0,
              t = 0,
              i = 0,
              n = g.Invert(this.node.computeWorldMatrix(!0)),
              r = 0,
              o = this._children;
            r < o.length;
            r++
          )
            if ((b = o[r]).mesh) {
              i++, b.mesh.computeWorldMatrix(!0);
              var s = b.mesh.getHierarchyBoundingVectors(),
                a = y.Vector3[0],
                l = y.Vector3[1];
              s.max.subtractToRef(s.min, l),
                l.scaleInPlace(0.5),
                f.TransformNormalToRef(l, n, a),
                (this._cellWidth = Math.max(this._cellWidth, 2 * a.x)),
                (this._cellHeight = Math.max(this._cellHeight, 2 * a.y));
            }
          (this._cellWidth += 2 * this.margin),
            (this._cellHeight += 2 * this.margin),
            this._rowThenColum
              ? ((t = this._columns), (e = Math.ceil(i / this._columns)))
              : ((e = this._rows), (t = Math.ceil(i / this._rows)));
          var c = 0.5 * t * this._cellWidth,
            u = 0.5 * e * this._cellHeight,
            h = [],
            d = 0;
          if (this._rowThenColum)
            for (var p = 0; p < e; p++)
              for (
                var _ = 0;
                _ < t &&
                (h.push(
                  new f(
                    _ * this._cellWidth - c + this._cellWidth / 2,
                    p * this._cellHeight - u + this._cellHeight / 2,
                    0
                  )
                ),
                !(++d > i));
                _++
              );
          else
            for (_ = 0; _ < t; _++)
              for (
                p = 0;
                p < e &&
                (h.push(
                  new f(
                    _ * this._cellWidth - c + this._cellWidth / 2,
                    p * this._cellHeight - u + this._cellHeight / 2,
                    0
                  )
                ),
                !(++d > i));
                p++
              );
          d = 0;
          for (var m = 0, v = this._children; m < v.length; m++) {
            var b;
            (b = v[m]).mesh && (this._mapGridNode(b, h[d]), d++);
          }
          this._finalProcessing();
        }),
        (t.prototype._finalProcessing = function () {}),
        t
      );
    })(Uf),
    Gf =
      ((function (e) {
        function t() {
          var t = (null !== e && e.apply(this, arguments)) || this;
          return (t._radius = 5), t;
        }
        P(t, e),
          Object.defineProperty(t.prototype, "radius", {
            get: function () {
              return this._radius;
            },
            set: function (e) {
              var t = this;
              this._radius !== e &&
                ((this._radius = e),
                yt.SetImmediate(function () {
                  t._arrangeChildren();
                }));
            },
            enumerable: !1,
            configurable: !0,
          }),
          (t.prototype._mapGridNode = function (e, t) {
            var i = e.mesh;
            if (i) {
              var n = this._cylindricalMapping(t);
              switch (((e.position = n), this.orientation)) {
                case Uf.FACEORIGIN_ORIENTATION:
                  i.lookAt(new f(2 * n.x, n.y, 2 * n.z));
                  break;
                case Uf.FACEORIGINREVERSED_ORIENTATION:
                  i.lookAt(new f(-n.x, n.y, -n.z));
                  break;
                case Uf.FACEFORWARD_ORIENTATION:
                  break;
                case Uf.FACEFORWARDREVERSED_ORIENTATION:
                  i.rotate(Pt.Y, Math.PI, Tt.LOCAL);
              }
            }
          }),
          (t.prototype._cylindricalMapping = function (e) {
            var t = new f(0, e.y, this._radius),
              i = e.x / this._radius;
            return (
              g.RotationYawPitchRollToRef(i, 0, 0, y.Matrix[0]),
              f.TransformNormal(t, y.Matrix[0])
            );
          });
      })(zf),
      "precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\nuniform mat4 world;\nuniform mat4 viewProjection;\nvarying vec2 vUV;\n#ifdef BORDER\nvarying vec2 scaleInfo;\nuniform float borderWidth;\nuniform vec3 scaleFactor;\n#endif\n#ifdef HOVERLIGHT\nvarying vec3 worldPosition;\n#endif\nvoid main(void) {\nvUV=uv;\n#ifdef BORDER\nvec3 scale=scaleFactor;\nfloat minScale=min(min(scale.x,scale.y),scale.z);\nfloat maxScale=max(max(scale.x,scale.y),scale.z);\nfloat minOverMiddleScale=minScale/(scale.x+scale.y+scale.z-minScale-maxScale);\nfloat areaYZ=scale.y*scale.z;\nfloat areaXZ=scale.x*scale.z;\nfloat areaXY=scale.x*scale.y;\nfloat scaledBorderWidth=borderWidth;\nif (abs(normal.x) == 1.0)\n{\nscale.x=scale.y;\nscale.y=scale.z;\nif (areaYZ>areaXZ && areaYZ>areaXY)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nelse if (abs(normal.y) == 1.0)\n{\nscale.x=scale.z;\nif (areaXZ>areaXY && areaXZ>areaYZ)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nelse\n{\nif (areaXY>areaYZ && areaXY>areaXZ)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nfloat scaleRatio=min(scale.x,scale.y)/max(scale.x,scale.y);\nif (scale.x>scale.y)\n{\nscaleInfo.x=1.0-(scaledBorderWidth*scaleRatio);\nscaleInfo.y=1.0-scaledBorderWidth;\n}\nelse\n{\nscaleInfo.x=1.0-scaledBorderWidth;\nscaleInfo.y=1.0-(scaledBorderWidth*scaleRatio);\n}\n#endif\nvec4 worldPos=world*vec4(position,1.0);\n#ifdef HOVERLIGHT\nworldPosition=worldPos.xyz;\n#endif\ngl_Position=viewProjection*worldPos;\n}\n");
  Ke.ShadersStore.fluentVertexShader = Gf;
  Ke.ShadersStore.fluentPixelShader =
    "precision highp float;\nvarying vec2 vUV;\nuniform vec4 albedoColor;\n#ifdef INNERGLOW\nuniform vec4 innerGlowColor;\n#endif\n#ifdef BORDER\nvarying vec2 scaleInfo;\nuniform float edgeSmoothingValue;\nuniform float borderMinValue;\n#endif\n#ifdef HOVERLIGHT\nvarying vec3 worldPosition;\nuniform vec3 hoverPosition;\nuniform vec4 hoverColor;\nuniform float hoverRadius;\n#endif\n#ifdef TEXTURE\nuniform sampler2D albedoSampler;\n#endif\nvoid main(void) {\nvec3 albedo=albedoColor.rgb;\nfloat alpha=albedoColor.a;\n#ifdef TEXTURE\nalbedo=texture2D(albedoSampler,vUV).rgb;\n#endif\n#ifdef HOVERLIGHT\nfloat pointToHover=(1.0-clamp(length(hoverPosition-worldPosition)/hoverRadius,0.,1.))*hoverColor.a;\nalbedo=clamp(albedo+hoverColor.rgb*pointToHover,0.,1.);\n#else\nfloat pointToHover=1.0;\n#endif\n#ifdef BORDER\nfloat borderPower=10.0;\nfloat inverseBorderPower=1.0/borderPower;\nvec3 borderColor=albedo*borderPower;\nvec2 distanceToEdge;\ndistanceToEdge.x=abs(vUV.x-0.5)*2.0;\ndistanceToEdge.y=abs(vUV.y-0.5)*2.0;\nfloat borderValue=max(smoothstep(scaleInfo.x-edgeSmoothingValue,scaleInfo.x+edgeSmoothingValue,distanceToEdge.x),\nsmoothstep(scaleInfo.y-edgeSmoothingValue,scaleInfo.y+edgeSmoothingValue,distanceToEdge.y));\nborderColor=borderColor*borderValue*max(borderMinValue*inverseBorderPower,pointToHover);\nalbedo+=borderColor;\nalpha=max(alpha,borderValue);\n#endif\n#ifdef INNERGLOW\n\nvec2 uvGlow=(vUV-vec2(0.5,0.5))*(innerGlowColor.a*2.0);\nuvGlow=uvGlow*uvGlow;\nuvGlow=uvGlow*uvGlow;\nalbedo+=mix(vec3(0.0,0.0,0.0),innerGlowColor.rgb,uvGlow.x+uvGlow.y);\n#endif\ngl_FragColor=vec4(albedo,alpha);\n}";
  var Wf = (function (e) {
      function t() {
        var t = e.call(this) || this;
        return (
          (t.INNERGLOW = !1),
          (t.BORDER = !1),
          (t.HOVERLIGHT = !1),
          (t.TEXTURE = !1),
          t.rebuild(),
          t
        );
      }
      return P(t, e), t;
    })(Jt),
    Hf = (function (e) {
      function t(t, i) {
        var n = e.call(this, t, i) || this;
        return (
          (n.innerGlowColorIntensity = 0.5),
          (n.innerGlowColor = new b(1, 1, 1)),
          (n.albedoColor = new b(0.3, 0.35, 0.4)),
          (n.renderBorders = !1),
          (n.borderWidth = 0.5),
          (n.edgeSmoothingValue = 0.02),
          (n.borderMinValue = 0.1),
          (n.renderHoverLight = !1),
          (n.hoverRadius = 1),
          (n.hoverColor = new T(0.3, 0.3, 0.3, 1)),
          (n.hoverPosition = f.Zero()),
          n
        );
      }
      return (
        P(t, e),
        (t.prototype.needAlphaBlending = function () {
          return 1 !== this.alpha;
        }),
        (t.prototype.needAlphaTesting = function () {
          return !1;
        }),
        (t.prototype.getAlphaTestTexture = function () {
          return null;
        }),
        (t.prototype.isReadyForSubMesh = function (e, t, i) {
          if (this.isFrozen && t.effect && t.effect._wasPreviouslyReady)
            return !0;
          t._materialDefines || (t._materialDefines = new Wf());
          var n = this.getScene(),
            r = t._materialDefines;
          if (
            !this.checkReadyOnEveryCall &&
            t.effect &&
            r._renderId === n.getRenderId()
          )
            return !0;
          if (r._areTexturesDirty)
            if (
              ((r.INNERGLOW = this.innerGlowColorIntensity > 0),
              (r.BORDER = this.renderBorders),
              (r.HOVERLIGHT = this.renderHoverLight),
              this._albedoTexture)
            ) {
              if (!this._albedoTexture.isReadyOrNotBlocking()) return !1;
              r.TEXTURE = !0;
            } else r.TEXTURE = !1;
          var o = n.getEngine();
          if (r.isDirty) {
            r.markAsProcessed(), n.resetCachedMaterial();
            var s = [wt.PositionKind];
            s.push(wt.NormalKind), s.push(wt.UVKind);
            var a = [
                "world",
                "viewProjection",
                "innerGlowColor",
                "albedoColor",
                "borderWidth",
                "edgeSmoothingValue",
                "scaleFactor",
                "borderMinValue",
                "hoverColor",
                "hoverPosition",
                "hoverRadius",
              ],
              l = ["albedoSampler"],
              c = new Array();
            Hr.PrepareUniformsAndSamplersList({
              uniformsNames: a,
              uniformBuffersNames: c,
              samplers: l,
              defines: r,
              maxSimultaneousLights: 4,
            });
            var u = r.toString();
            t.setEffect(
              n.getEngine().createEffect(
                "fluent",
                {
                  attributes: s,
                  uniformsNames: a,
                  uniformBuffersNames: c,
                  samplers: l,
                  defines: u,
                  fallbacks: null,
                  onCompiled: this.onCompiled,
                  onError: this.onError,
                  indexParameters: {
                    maxSimultaneousLights: 4,
                  },
                },
                o
              )
            );
          }
          return !(
            !t.effect ||
            !t.effect.isReady() ||
            ((r._renderId = n.getRenderId()),
            (t.effect._wasPreviouslyReady = !0),
            0)
          );
        }),
        (t.prototype.bindForSubMesh = function (e, t, i) {
          var n = this.getScene(),
            r = i._materialDefines;
          if (r) {
            var o = i.effect;
            o &&
              ((this._activeEffect = o),
              this.bindOnlyWorldMatrix(e),
              this._activeEffect.setMatrix(
                "viewProjection",
                n.getTransformMatrix()
              ),
              this._mustRebind(n, o) &&
                (this._activeEffect.setColor4(
                  "albedoColor",
                  this.albedoColor,
                  this.alpha
                ),
                r.INNERGLOW &&
                  this._activeEffect.setColor4(
                    "innerGlowColor",
                    this.innerGlowColor,
                    this.innerGlowColorIntensity
                  ),
                r.BORDER &&
                  (this._activeEffect.setFloat("borderWidth", this.borderWidth),
                  this._activeEffect.setFloat(
                    "edgeSmoothingValue",
                    this.edgeSmoothingValue
                  ),
                  this._activeEffect.setFloat(
                    "borderMinValue",
                    this.borderMinValue
                  ),
                  t
                    .getBoundingInfo()
                    .boundingBox.extendSize.multiplyToRef(
                      t.scaling,
                      y.Vector3[0]
                    ),
                  this._activeEffect.setVector3("scaleFactor", y.Vector3[0])),
                r.HOVERLIGHT &&
                  (this._activeEffect.setDirectColor4(
                    "hoverColor",
                    this.hoverColor
                  ),
                  this._activeEffect.setFloat("hoverRadius", this.hoverRadius),
                  this._activeEffect.setVector3(
                    "hoverPosition",
                    this.hoverPosition
                  )),
                r.TEXTURE &&
                  this._activeEffect.setTexture(
                    "albedoSampler",
                    this._albedoTexture
                  )),
              this._afterBind(t, this._activeEffect));
          }
        }),
        (t.prototype.getActiveTextures = function () {
          return e.prototype.getActiveTextures.call(this);
        }),
        (t.prototype.hasTexture = function (t) {
          return !!e.prototype.hasTexture.call(this, t);
        }),
        (t.prototype.dispose = function (t) {
          e.prototype.dispose.call(this, t);
        }),
        (t.prototype.clone = function (e) {
          var i = this;
          return ge.Clone(function () {
            return new t(e, i.getScene());
          }, this);
        }),
        (t.prototype.serialize = function () {
          var e = ge.Serialize(this);
          return (e.customType = "BABYLON.GUI.FluentMaterial"), e;
        }),
        (t.prototype.getClassName = function () {
          return "FluentMaterial";
        }),
        (t.Parse = function (e, i, n) {
          return ge.Parse(
            function () {
              return new t(e.name, i);
            },
            e,
            i,
            n
          );
        }),
        R(
          [se(), oe("_markAllSubMeshesAsTexturesDirty")],
          t.prototype,
          "innerGlowColorIntensity",
          void 0
        ),
        R([le()], t.prototype, "innerGlowColor", void 0),
        R([le()], t.prototype, "albedoColor", void 0),
        R(
          [se(), oe("_markAllSubMeshesAsTexturesDirty")],
          t.prototype,
          "renderBorders",
          void 0
        ),
        R([se()], t.prototype, "borderWidth", void 0),
        R([se()], t.prototype, "edgeSmoothingValue", void 0),
        R([se()], t.prototype, "borderMinValue", void 0),
        R(
          [se(), oe("_markAllSubMeshesAsTexturesDirty")],
          t.prototype,
          "renderHoverLight",
          void 0
        ),
        R([se()], t.prototype, "hoverRadius", void 0),
        R([pe()], t.prototype, "hoverColor", void 0),
        R([he()], t.prototype, "hoverPosition", void 0),
        R([ae("albedoTexture")], t.prototype, "_albedoTexture", void 0),
        R(
          [oe("_markAllSubMeshesAsTexturesAndMiscDirty")],
          t.prototype,
          "albedoTexture",
          void 0
        ),
        t
      );
    })(Gr);
  (h.RegisteredTypes["BABYLON.GUI.FluentMaterial"] = Hf),
    (function (e) {
      function t(t, i) {
        void 0 === i && (i = !0);
        var n = e.call(this, t) || this;
        return (
          (n._shareMaterials = !0),
          (n._shareMaterials = i),
          (n.pointerEnterAnimation = function () {
            n.mesh && n._frontPlate.setEnabled(!0);
          }),
          (n.pointerOutAnimation = function () {
            n.mesh && n._frontPlate.setEnabled(!1);
          }),
          n
        );
      }
      P(t, e),
        (t.prototype._disposeTooltip = function () {
          (this._tooltipFade = null),
            this._tooltipTextBlock && this._tooltipTextBlock.dispose(),
            this._tooltipTexture && this._tooltipTexture.dispose(),
            this._tooltipMesh && this._tooltipMesh.dispose(),
            this.onPointerEnterObservable.remove(this._tooltipHoverObserver),
            this.onPointerOutObservable.remove(this._tooltipOutObserver);
        }),
        Object.defineProperty(t.prototype, "renderingGroupId", {
          get: function () {
            return this._backPlate.renderingGroupId;
          },
          set: function (e) {
            (this._backPlate.renderingGroupId = e),
              (this._textPlate.renderingGroupId = e),
              (this._frontPlate.renderingGroupId = e),
              this._tooltipMesh && (this._tooltipMesh.renderingGroupId = e);
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "tooltipText", {
          get: function () {
            return this._tooltipTextBlock ? this._tooltipTextBlock.text : null;
          },
          set: function (e) {
            var t = this;
            if (e) {
              if (!this._tooltipFade) {
                this._tooltipMesh = hn.CreatePlane(
                  "",
                  {
                    size: 1,
                  },
                  this._backPlate._scene
                );
                var i = hn.CreatePlane(
                    "",
                    {
                      size: 1,
                      sideOrientation: Qi.DOUBLESIDE,
                    },
                    this._backPlate._scene
                  ),
                  n = new qr("", this._backPlate._scene);
                (n.diffuseColor = b.FromHexString("#212121")),
                  (i.material = n),
                  (i.isPickable = !1),
                  this._tooltipMesh.addChild(i),
                  (i.position.z = 0.05),
                  (this._tooltipMesh.scaling.y = 1 / 3),
                  (this._tooltipMesh.position.y = 0.7),
                  (this._tooltipMesh.position.z = -0.15),
                  (this._tooltipMesh.isPickable = !1),
                  (this._tooltipMesh.parent = this._backPlate),
                  (this._tooltipTexture = Ff.CreateForMesh(this._tooltipMesh)),
                  (this._tooltipTextBlock = new uf()),
                  (this._tooltipTextBlock.scaleY = 3),
                  (this._tooltipTextBlock.color = "white"),
                  (this._tooltipTextBlock.fontSize = 130),
                  this._tooltipTexture.addControl(this._tooltipTextBlock),
                  (this._tooltipFade = new ln()),
                  (this._tooltipFade.delay = 500),
                  this._tooltipMesh.addBehavior(this._tooltipFade),
                  (this._tooltipHoverObserver =
                    this.onPointerEnterObservable.add(function () {
                      t._tooltipFade && t._tooltipFade.fadeIn(!0);
                    })),
                  (this._tooltipOutObserver = this.onPointerOutObservable.add(
                    function () {
                      t._tooltipFade && t._tooltipFade.fadeIn(!1);
                    }
                  ));
              }
              this._tooltipTextBlock && (this._tooltipTextBlock.text = e);
            } else this._disposeTooltip();
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "text", {
          get: function () {
            return this._text;
          },
          set: function (e) {
            this._text !== e && ((this._text = e), this._rebuildContent());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "imageUrl", {
          get: function () {
            return this._imageUrl;
          },
          set: function (e) {
            this._imageUrl !== e &&
              ((this._imageUrl = e), this._rebuildContent());
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "backMaterial", {
          get: function () {
            return this._backMaterial;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "frontMaterial", {
          get: function () {
            return this._frontMaterial;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "plateMaterial", {
          get: function () {
            return this._plateMaterial;
          },
          enumerable: !1,
          configurable: !0,
        }),
        Object.defineProperty(t.prototype, "shareMaterials", {
          get: function () {
            return this._shareMaterials;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._getTypeName = function () {
          return "HolographicButton";
        }),
        (t.prototype._rebuildContent = function () {
          this._disposeFacadeTexture();
          var e = new pf();
          if (((e.isVertical = !0), this._imageUrl)) {
            var t = new hf();
            (t.source = this._imageUrl),
              (t.paddingTop = "40px"),
              (t.height = "180px"),
              (t.width = "100px"),
              (t.paddingBottom = "40px"),
              e.addControl(t);
          }
          if (this._text) {
            var i = new uf();
            (i.text = this._text),
              (i.color = "white"),
              (i.height = "30px"),
              (i.fontSize = 24),
              e.addControl(i);
          }
          this._frontPlate && (this.content = e);
        }),
        (t.prototype._createNode = function (t) {
          return (
            (this._backPlate = Eo.CreateBox(
              this.name + "BackMesh",
              {
                width: 1,
                height: 1,
                depth: 0.08,
              },
              t
            )),
            (this._frontPlate = Eo.CreateBox(
              this.name + "FrontMesh",
              {
                width: 1,
                height: 1,
                depth: 0.08,
              },
              t
            )),
            (this._frontPlate.parent = this._backPlate),
            (this._frontPlate.position.z = -0.08),
            (this._frontPlate.isPickable = !1),
            this._frontPlate.setEnabled(!1),
            (this._textPlate = e.prototype._createNode.call(this, t)),
            (this._textPlate.parent = this._backPlate),
            (this._textPlate.position.z = -0.08),
            (this._textPlate.isPickable = !1),
            this._backPlate
          );
        }),
        (t.prototype._applyFacade = function (e) {
          (this._plateMaterial.emissiveTexture = e),
            (this._plateMaterial.opacityTexture = e);
        }),
        (t.prototype._createBackMaterial = function (e) {
          var t = this;
          (this._backMaterial = new Hf(
            this.name + "Back Material",
            e.getScene()
          )),
            (this._backMaterial.renderHoverLight = !0),
            (this._pickedPointObserver =
              this._host.onPickedPointChangedObservable.add(function (e) {
                e
                  ? ((t._backMaterial.hoverPosition = e),
                    (t._backMaterial.hoverColor.a = 1))
                  : (t._backMaterial.hoverColor.a = 0);
              }));
        }),
        (t.prototype._createFrontMaterial = function (e) {
          (this._frontMaterial = new Hf(
            this.name + "Front Material",
            e.getScene()
          )),
            (this._frontMaterial.innerGlowColorIntensity = 0),
            (this._frontMaterial.alpha = 0.5),
            (this._frontMaterial.renderBorders = !0);
        }),
        (t.prototype._createPlateMaterial = function (e) {
          (this._plateMaterial = new qr(
            this.name + "Plate Material",
            e.getScene()
          )),
            (this._plateMaterial.specularColor = b.Black());
        }),
        (t.prototype._affectMaterial = function (e) {
          this._shareMaterials
            ? (this._host._sharedMaterials.backFluentMaterial
                ? (this._backMaterial =
                    this._host._sharedMaterials.backFluentMaterial)
                : (this._createBackMaterial(e),
                  (this._host._sharedMaterials.backFluentMaterial =
                    this._backMaterial)),
              this._host._sharedMaterials.frontFluentMaterial
                ? (this._frontMaterial =
                    this._host._sharedMaterials.frontFluentMaterial)
                : (this._createFrontMaterial(e),
                  (this._host._sharedMaterials.frontFluentMaterial =
                    this._frontMaterial)))
            : (this._createBackMaterial(e), this._createFrontMaterial(e)),
            this._createPlateMaterial(e),
            (this._backPlate.material = this._backMaterial),
            (this._frontPlate.material = this._frontMaterial),
            (this._textPlate.material = this._plateMaterial),
            this._rebuildContent();
        }),
        (t.prototype.dispose = function () {
          e.prototype.dispose.call(this),
            this._disposeTooltip(),
            this.shareMaterials ||
              (this._backMaterial.dispose(),
              this._frontMaterial.dispose(),
              this._plateMaterial.dispose(),
              this._pickedPointObserver &&
                (this._host.onPickedPointChangedObservable.remove(
                  this._pickedPointObserver
                ),
                (this._pickedPointObserver = null)));
        });
    })(kf),
    (function (e) {
      function t(t, i) {
        var n = e.call(this, i) || this;
        return (
          (n._currentMesh = t),
          (n.pointerEnterAnimation = function () {
            n.mesh && n.mesh.scaling.scaleInPlace(1.1);
          }),
          (n.pointerOutAnimation = function () {
            n.mesh && n.mesh.scaling.scaleInPlace(1 / 1.1);
          }),
          (n.pointerDownAnimation = function () {
            n.mesh && n.mesh.scaling.scaleInPlace(0.95);
          }),
          (n.pointerUpAnimation = function () {
            n.mesh && n.mesh.scaling.scaleInPlace(1 / 0.95);
          }),
          n
        );
      }
      P(t, e),
        (t.prototype._getTypeName = function () {
          return "MeshButton3D";
        }),
        (t.prototype._createNode = function (e) {
          var t = this;
          return (
            this._currentMesh.getChildMeshes().forEach(function (e) {
              e.metadata = t;
            }),
            this._currentMesh
          );
        }),
        (t.prototype._affectMaterial = function (e) {});
    })(kf),
    (function (e) {
      function t() {
        return (null !== e && e.apply(this, arguments)) || this;
      }
      P(t, e),
        (t.prototype._mapGridNode = function (e, t) {
          var i = e.mesh;
          if (i) {
            e.position = t.clone();
            var n = y.Vector3[0];
            switch ((n.copyFrom(t), this.orientation)) {
              case Uf.FACEORIGIN_ORIENTATION:
              case Uf.FACEFORWARD_ORIENTATION:
                n.addInPlace(new f(0, 0, 1)), i.lookAt(n);
                break;
              case Uf.FACEFORWARDREVERSED_ORIENTATION:
              case Uf.FACEORIGINREVERSED_ORIENTATION:
                n.addInPlace(new f(0, 0, -1)), i.lookAt(n);
            }
          }
        });
    })(zf),
    (function (e) {
      function t() {
        var t = (null !== e && e.apply(this, arguments)) || this;
        return (t._iteration = 100), t;
      }
      P(t, e),
        Object.defineProperty(t.prototype, "iteration", {
          get: function () {
            return this._iteration;
          },
          set: function (e) {
            var t = this;
            this._iteration !== e &&
              ((this._iteration = e),
              yt.SetImmediate(function () {
                t._arrangeChildren();
              }));
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._mapGridNode = function (e, t) {
          var i = e.mesh,
            n = this._scatterMapping(t);
          if (i) {
            switch (this.orientation) {
              case Uf.FACEORIGIN_ORIENTATION:
              case Uf.FACEFORWARD_ORIENTATION:
                i.lookAt(new f(0, 0, 1));
                break;
              case Uf.FACEFORWARDREVERSED_ORIENTATION:
              case Uf.FACEORIGINREVERSED_ORIENTATION:
                i.lookAt(new f(0, 0, -1));
            }
            e.position = n;
          }
        }),
        (t.prototype._scatterMapping = function (e) {
          return (
            (e.x = (1 - 2 * Math.random()) * this._cellWidth),
            (e.y = (1 - 2 * Math.random()) * this._cellHeight),
            e
          );
        }),
        (t.prototype._finalProcessing = function () {
          for (var e = [], t = 0, i = this._children; t < i.length; t++) {
            var n = i[t];
            n.mesh && e.push(n.mesh);
          }
          for (var r = 0; r < this._iteration; r++) {
            e.sort(function (e, t) {
              var i = e.position.lengthSquared(),
                n = t.position.lengthSquared();
              return i < n ? 1 : i > n ? -1 : 0;
            });
            for (
              var o = Math.pow(this.margin, 2),
                s = Math.max(this._cellWidth, this._cellHeight),
                a = y.Vector2[0],
                l = y.Vector3[0],
                c = 0;
              c < e.length - 1;
              c++
            )
              for (var u = c + 1; u < e.length; u++)
                if (c != u) {
                  e[u].position.subtractToRef(e[c].position, l),
                    (a.x = l.x),
                    (a.y = l.y);
                  var h = s,
                    d = a.lengthSquared() - o;
                  (d -= Math.min(d, o)) < Math.pow(h, 2) &&
                    (a.normalize(),
                    l.scaleInPlace(0.5 * (h - Math.sqrt(d))),
                    e[u].position.addInPlace(l),
                    e[c].position.subtractInPlace(l));
                }
          }
        });
    })(zf),
    (function (e) {
      function t() {
        var t = (null !== e && e.apply(this, arguments)) || this;
        return (t._radius = 5), t;
      }
      P(t, e),
        Object.defineProperty(t.prototype, "radius", {
          get: function () {
            return this._radius;
          },
          set: function (e) {
            var t = this;
            this._radius !== e &&
              ((this._radius = e),
              yt.SetImmediate(function () {
                t._arrangeChildren();
              }));
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._mapGridNode = function (e, t) {
          var i = e.mesh;
          if (i) {
            var n = this._sphericalMapping(t);
            switch (((e.position = n), this.orientation)) {
              case Uf.FACEORIGIN_ORIENTATION:
                i.lookAt(new f(2 * n.x, 2 * n.y, 2 * n.z));
                break;
              case Uf.FACEORIGINREVERSED_ORIENTATION:
                i.lookAt(new f(-n.x, -n.y, -n.z));
                break;
              case Uf.FACEFORWARD_ORIENTATION:
                break;
              case Uf.FACEFORWARDREVERSED_ORIENTATION:
                i.rotate(Pt.Y, Math.PI, Tt.LOCAL);
            }
          }
        }),
        (t.prototype._sphericalMapping = function (e) {
          var t = new f(0, 0, this._radius),
            i = e.y / this._radius,
            n = -e.x / this._radius;
          return (
            g.RotationYawPitchRollToRef(n, i, 0, y.Matrix[0]),
            f.TransformNormal(t, y.Matrix[0])
          );
        });
    })(zf),
    (function (e) {
      function t(t) {
        void 0 === t && (t = !1);
        var i = e.call(this) || this;
        return (i._isVertical = !1), (i.margin = 0.1), (i._isVertical = t), i;
      }
      P(t, e),
        Object.defineProperty(t.prototype, "isVertical", {
          get: function () {
            return this._isVertical;
          },
          set: function (e) {
            var t = this;
            this._isVertical !== e &&
              ((this._isVertical = e),
              yt.SetImmediate(function () {
                t._arrangeChildren();
              }));
          },
          enumerable: !1,
          configurable: !0,
        }),
        (t.prototype._arrangeChildren = function () {
          for (
            var e,
              t = 0,
              i = 0,
              n = 0,
              r = [],
              o = g.Invert(this.node.computeWorldMatrix(!0)),
              s = 0,
              a = this._children;
            s < a.length;
            s++
          )
            if ((p = a[s]).mesh) {
              n++,
                p.mesh.computeWorldMatrix(!0),
                p.mesh.getWorldMatrix().multiplyToRef(o, y.Matrix[0]);
              var l = p.mesh.getBoundingInfo().boundingBox,
                c = f.TransformNormal(l.extendSize, y.Matrix[0]);
              r.push(c), this._isVertical ? (i += c.y) : (t += c.x);
            }
          this._isVertical
            ? (i += ((n - 1) * this.margin) / 2)
            : (t += ((n - 1) * this.margin) / 2),
            (e = this._isVertical ? -i : -t);
          for (var u = 0, h = 0, d = this._children; h < d.length; h++) {
            var p;
            (p = d[h]).mesh &&
              (n--,
              (c = r[u++]),
              this._isVertical
                ? ((p.position.y = e + c.y), (p.position.x = 0), (e += 2 * c.y))
                : ((p.position.x = e + c.x),
                  (p.position.y = 0),
                  (e += 2 * c.x)),
              (e += n > 0 ? this.margin : 0));
          }
        });
    })(Uf),
    (function () {
      function e(e) {
        var t = this;
        (this._lastControlOver = {}),
          (this._lastControlDown = {}),
          (this.onPickedPointChangedObservable = new o()),
          (this._sharedMaterials = {}),
          (this._scene = e || j.LastCreatedScene),
          (this._sceneDisposeObserver = this._scene.onDisposeObservable.add(
            function () {
              (t._sceneDisposeObserver = null),
                (t._utilityLayer = null),
                t.dispose();
            }
          )),
          (this._utilityLayer = new To(this._scene)),
          (this._utilityLayer.onlyCheckPointerDownEvents = !1),
          (this._utilityLayer.pickUtilitySceneFirst = !1),
          (this._utilityLayer.mainSceneTrackerPredicate = function (e) {
            return e && e.metadata && e.metadata._node;
          }),
          (this._rootContainer = new Uf("RootContainer")),
          (this._rootContainer._host = this);
        var i = this._utilityLayer.utilityLayerScene;
        (this._pointerOutObserver =
          this._utilityLayer.onPointerOutObservable.add(function (e) {
            t._handlePointerOut(e, !0);
          })),
          (this._pointerObserver = i.onPointerObservable.add(function (e, i) {
            t._doPicking(e);
          })),
          (this._utilityLayer.utilityLayerScene.autoClear = !1),
          (this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil = !1),
          new Vr("hemi", f.Up(), this._utilityLayer.utilityLayerScene);
      }
      Object.defineProperty(e.prototype, "scene", {
        get: function () {
          return this._scene;
        },
        enumerable: !1,
        configurable: !0,
      }),
        Object.defineProperty(e.prototype, "utilityLayer", {
          get: function () {
            return this._utilityLayer;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype._handlePointerOut = function (e, t) {
          var i = this._lastControlOver[e];
          i && (i._onPointerOut(i), delete this._lastControlOver[e]),
            t &&
              this._lastControlDown[e] &&
              (this._lastControlDown[e].forcePointerUp(),
              delete this._lastControlDown[e]),
            this.onPickedPointChangedObservable.notifyObservers(null);
        }),
        (e.prototype._doPicking = function (e) {
          if (
            !this._utilityLayer ||
            !this._utilityLayer.shouldRender ||
            !this._utilityLayer.utilityLayerScene.activeCamera
          )
            return !1;
          var t = e.event,
            i = t.pointerId || 0,
            n = t.button,
            r = e.pickInfo;
          if (!r || !r.hit)
            return this._handlePointerOut(i, e.type === pi.POINTERUP), !1;
          var o = r.pickedMesh.metadata;
          return (
            r.pickedPoint &&
              this.onPickedPointChangedObservable.notifyObservers(
                r.pickedPoint
              ),
            o._processObservables(e.type, r.pickedPoint, i, n) ||
              (e.type === pi.POINTERMOVE &&
                (this._lastControlOver[i] &&
                  this._lastControlOver[i]._onPointerOut(
                    this._lastControlOver[i]
                  ),
                delete this._lastControlOver[i])),
            e.type === pi.POINTERUP &&
              (this._lastControlDown[t.pointerId] &&
                (this._lastControlDown[t.pointerId].forcePointerUp(),
                delete this._lastControlDown[t.pointerId]),
              "touch" === t.pointerType && this._handlePointerOut(i, !1)),
            !0
          );
        }),
        Object.defineProperty(e.prototype, "rootContainer", {
          get: function () {
            return this._rootContainer;
          },
          enumerable: !1,
          configurable: !0,
        }),
        (e.prototype.containsControl = function (e) {
          return this._rootContainer.containsControl(e);
        }),
        (e.prototype.addControl = function (e) {
          return this._rootContainer.addControl(e), this;
        }),
        (e.prototype.removeControl = function (e) {
          return this._rootContainer.removeControl(e), this;
        }),
        (e.prototype.dispose = function () {
          for (var e in (this._rootContainer.dispose(), this._sharedMaterials))
            this._sharedMaterials.hasOwnProperty(e) &&
              this._sharedMaterials[e].dispose();
          (this._sharedMaterials = {}),
            this._pointerOutObserver &&
              this._utilityLayer &&
              (this._utilityLayer.onPointerOutObservable.remove(
                this._pointerOutObserver
              ),
              (this._pointerOutObserver = null)),
            this.onPickedPointChangedObservable.clear();
          var t = this._utilityLayer
            ? this._utilityLayer.utilityLayerScene
            : null;
          t &&
            this._pointerObserver &&
            (t.onPointerObservable.remove(this._pointerObserver),
            (this._pointerObserver = null)),
            this._scene &&
              this._sceneDisposeObserver &&
              (this._scene.onDisposeObservable.remove(
                this._sceneDisposeObserver
              ),
              (this._sceneDisposeObserver = null)),
            this._utilityLayer && this._utilityLayer.dispose();
        });
    })();
})();
